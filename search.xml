<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title></title>
    <url>%2F2020%2F04%2F12%2F21.%E9%9D%A2%E8%AF%95%E9%A2%98%E7%9B%AE%2FFlink%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F04%2F12%2F21.%E9%9D%A2%E8%AF%95%E9%A2%98%E7%9B%AE%2FZookeeper%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F04%2F12%2F21.%E9%9D%A2%E8%AF%95%E9%A2%98%E7%9B%AE%2FMysql%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F04%2F12%2F21.%E9%9D%A2%E8%AF%95%E9%A2%98%E7%9B%AE%2FRedis%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[Flink Time]]></title>
    <url>%2F2020%2F04%2F11%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F10-Flink%20Time%2F</url>
    <content type="text"><![CDATA[æ—¶é—´ï¼ˆTimeï¼‰æ—¶é—´ç±»å‹ Flinkä¸­çš„æ—¶é—´ä¸ç°å®ä¸–ç•Œä¸­çš„æ—¶é—´æ˜¯ä¸ä¸€è‡´çš„ï¼Œåœ¨flinkä¸­è¢«åˆ’åˆ†ä¸ºäº‹ä»¶æ—¶é—´ï¼Œæ‘„å…¥æ—¶é—´ï¼Œå¤„ç†æ—¶é—´ä¸‰ç§ã€‚ å¦‚æœä»¥EventTimeä¸ºåŸºå‡†æ¥å®šä¹‰æ—¶é—´çª—å£å°†å½¢æˆEventTimeWindow,è¦æ±‚æ¶ˆæ¯æœ¬èº«å°±åº”è¯¥æºå¸¦EventTime å¦‚æœä»¥IngesingtTimeä¸ºåŸºå‡†æ¥å®šä¹‰æ—¶é—´çª—å£å°†å½¢æˆIngestingTimeWindow,ä»¥sourceçš„systemTimeä¸ºå‡†ã€‚ å¦‚æœä»¥ProcessingTimeåŸºå‡†æ¥å®šä¹‰æ—¶é—´çª—å£å°†å½¢æˆProcessingTimeWindowï¼Œä»¥operatorçš„systemTimeä¸ºå‡†ã€‚ æ—¶é—´è¯¦è§£Processing Time Processing Time æ˜¯æŒ‡äº‹ä»¶è¢«å¤„ç†æ—¶æœºå™¨çš„ç³»ç»Ÿæ—¶é—´ã€‚ å½“æµç¨‹åºåœ¨ Processing Time ä¸Šè¿è¡Œæ—¶ï¼Œæ‰€æœ‰åŸºäºæ—¶é—´çš„æ“ä½œ(å¦‚æ—¶é—´çª—å£)å°†ä½¿ç”¨å½“æ—¶æœºå™¨çš„ç³»ç»Ÿæ—¶é—´ã€‚æ¯å°æ—¶ Processing Time çª—å£å°†åŒ…æ‹¬åœ¨ç³»ç»Ÿæ—¶é’ŸæŒ‡ç¤ºæ•´ä¸ªå°æ—¶ä¹‹é—´åˆ°è¾¾ç‰¹å®šæ“ä½œçš„æ‰€æœ‰äº‹ä»¶ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨ä¸Šåˆ 9:15 å¼€å§‹è¿è¡Œï¼Œåˆ™ç¬¬ä¸€ä¸ªæ¯å°æ—¶ Processing Time çª—å£å°†åŒ…æ‹¬åœ¨ä¸Šåˆ 9:15 åˆ°ä¸Šåˆ 10:00 ä¹‹é—´å¤„ç†çš„äº‹ä»¶ï¼Œä¸‹ä¸€ä¸ªçª—å£å°†åŒ…æ‹¬åœ¨ä¸Šåˆ 10:00 åˆ° 11:00 ä¹‹é—´å¤„ç†çš„äº‹ä»¶ã€‚ Processing Time æ˜¯æœ€ç®€å•çš„ â€œTimeâ€ æ¦‚å¿µï¼Œä¸éœ€è¦æµå’Œæœºå™¨ä¹‹é—´çš„åè°ƒï¼Œå®ƒæä¾›äº†æœ€å¥½çš„æ€§èƒ½å’Œæœ€ä½çš„å»¶è¿Ÿã€‚ä½†æ˜¯ï¼Œåœ¨åˆ†å¸ƒå¼å’Œå¼‚æ­¥çš„ç¯å¢ƒä¸‹ï¼ŒProcessing Time ä¸èƒ½æä¾›ç¡®å®šæ€§ï¼Œå› ä¸ºå®ƒå®¹æ˜“å—åˆ°äº‹ä»¶åˆ°è¾¾ç³»ç»Ÿçš„é€Ÿåº¦ï¼ˆä¾‹å¦‚ä»æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€äº‹ä»¶åœ¨ç³»ç»Ÿå†…æ“ä½œæµåŠ¨çš„é€Ÿåº¦ä»¥åŠä¸­æ–­çš„å½±å“ã€‚ Event Time Event Time æ˜¯äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ï¼Œä¸€èˆ¬å°±æ˜¯æ•°æ®æœ¬èº«æºå¸¦çš„æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´é€šå¸¸æ˜¯åœ¨äº‹ä»¶åˆ°è¾¾ Flink ä¹‹å‰å°±ç¡®å®šçš„ï¼Œå¹¶ä¸”å¯ä»¥ä»æ¯ä¸ªäº‹ä»¶ä¸­è·å–åˆ°äº‹ä»¶æ—¶é—´æˆ³ã€‚åœ¨ Event Time ä¸­ï¼Œæ—¶é—´å–å†³äºæ•°æ®ï¼Œè€Œè·Ÿå…¶ä»–æ²¡ä»€ä¹ˆå…³ç³»ã€‚Event Time ç¨‹åºå¿…é¡»æŒ‡å®šå¦‚ä½•ç”Ÿæˆ Event Time æ°´å°ï¼Œè¿™æ˜¯è¡¨ç¤º Event Time è¿›åº¦çš„æœºåˆ¶ã€‚ å®Œç¾çš„è¯´ï¼Œæ— è®ºäº‹ä»¶ä»€ä¹ˆæ—¶å€™åˆ°è¾¾æˆ–è€…å…¶æ€ä¹ˆæ’åºï¼Œæœ€åå¤„ç† Event Time å°†äº§ç”Ÿå®Œå…¨ä¸€è‡´å’Œç¡®å®šçš„ç»“æœã€‚ä½†æ˜¯ï¼Œé™¤éäº‹ä»¶æŒ‰ç…§å·²çŸ¥é¡ºåºï¼ˆæŒ‰ç…§äº‹ä»¶çš„æ—¶é—´ï¼‰åˆ°è¾¾ï¼Œå¦åˆ™å¤„ç† Event Time æ—¶å°†ä¼šå› ä¸ºè¦ç­‰å¾…ä¸€äº›æ— åºäº‹ä»¶è€Œäº§ç”Ÿä¸€äº›å»¶è¿Ÿã€‚ç”±äºåªèƒ½ç­‰å¾…ä¸€æ®µæœ‰é™çš„æ—¶é—´ï¼Œå› æ­¤å°±éš¾ä»¥ä¿è¯å¤„ç† Event Time å°†äº§ç”Ÿå®Œå…¨ä¸€è‡´å’Œç¡®å®šçš„ç»“æœã€‚ å‡è®¾æ‰€æœ‰æ•°æ®éƒ½å·²åˆ°è¾¾ï¼Œ Event Time æ“ä½œå°†æŒ‰ç…§é¢„æœŸè¿è¡Œï¼Œå³ä½¿åœ¨å¤„ç†æ— åºäº‹ä»¶ã€å»¶è¿Ÿäº‹ä»¶ã€é‡æ–°å¤„ç†å†å²æ•°æ®æ—¶ä¹Ÿä¼šäº§ç”Ÿæ­£ç¡®ä¸”ä¸€è‡´çš„ç»“æœã€‚ ä¾‹å¦‚ï¼Œæ¯å°æ—¶äº‹ä»¶æ—¶é—´çª—å£å°†åŒ…å«å¸¦æœ‰è½å…¥è¯¥å°æ—¶çš„äº‹ä»¶æ—¶é—´æˆ³çš„æ‰€æœ‰è®°å½•ï¼Œæ— è®ºå®ƒä»¬åˆ°è¾¾çš„é¡ºåºå¦‚ä½•ã€‚ è¯·æ³¨æ„ï¼Œæœ‰æ—¶å½“ Event Time ç¨‹åºå®æ—¶å¤„ç†å®æ—¶æ•°æ®æ—¶ï¼Œå®ƒä»¬å°†ä½¿ç”¨ä¸€äº› Processing Time æ“ä½œï¼Œä»¥ç¡®ä¿å®ƒä»¬åŠæ—¶è¿›è¡Œã€‚ Ingestion Time Ingestion Time æ˜¯äº‹ä»¶è¿›å…¥ Flink çš„æ—¶é—´ã€‚ åœ¨æºæ“ä½œå¤„ï¼Œæ¯ä¸ªäº‹ä»¶å°†æºçš„å½“å‰æ—¶é—´ä½œä¸ºæ—¶é—´æˆ³ï¼Œå¹¶ä¸”åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆå¦‚æ—¶é—´çª—å£ï¼‰ä¼šåˆ©ç”¨è¿™ä¸ªæ—¶é—´æˆ³ã€‚ Ingestion Time åœ¨æ¦‚å¿µä¸Šä½äº Event Time å’Œ Processing Time ä¹‹é—´ã€‚ ä¸ Processing Time ç›¸æ¯”ï¼Œå®ƒç¨å¾®è´µä¸€äº›ï¼Œä½†ç»“æœæ›´å¯é¢„æµ‹ã€‚å› ä¸º Ingestion Time ä½¿ç”¨ç¨³å®šçš„æ—¶é—´æˆ³ï¼ˆåœ¨æºå¤„åˆ†é…ä¸€æ¬¡ï¼‰ï¼Œæ‰€ä»¥å¯¹äº‹ä»¶çš„ä¸åŒçª—å£æ“ä½œå°†å¼•ç”¨ç›¸åŒçš„æ—¶é—´æˆ³ï¼Œè€Œåœ¨ Processing Time ä¸­ï¼Œæ¯ä¸ªçª—å£æ“ä½œç¬¦å¯ä»¥å°†äº‹ä»¶åˆ†é…ç»™ä¸åŒçš„çª—å£ï¼ˆåŸºäºæœºå™¨ç³»ç»Ÿæ—¶é—´å’Œåˆ°è¾¾å»¶è¿Ÿï¼‰ã€‚ ä¸ Event Time ç›¸æ¯”ï¼ŒIngestion Time ç¨‹åºæ— æ³•å¤„ç†ä»»ä½•æ— åºäº‹ä»¶æˆ–å»¶è¿Ÿæ•°æ®ï¼Œä½†ç¨‹åºä¸å¿…æŒ‡å®šå¦‚ä½•ç”Ÿæˆæ°´å°ã€‚ åœ¨ Flink ä¸­ï¼Œï¼ŒIngestion Time ä¸ Event Time éå¸¸ç›¸ä¼¼ï¼Œä½† Ingestion Time å…·æœ‰è‡ªåŠ¨åˆ†é…æ—¶é—´æˆ³å’Œè‡ªåŠ¨ç”Ÿæˆæ°´å°åŠŸèƒ½ã€‚ æ—¶é—´æˆ³å’Œæ°´å°åœ¨ä»‹ç»Watermarkç›¸å…³å†…å®¹ä¹‹å‰æˆ‘ä»¬å…ˆæŠ›å‡ºä¸€ä¸ªå…·ä½“çš„é—®é¢˜ï¼Œåœ¨å®é™…çš„æµå¼è®¡ç®—ä¸­æ•°æ®åˆ°æ¥çš„é¡ºåºå¯¹è®¡ç®—ç»“æœçš„æ­£ç¡®æ€§æœ‰è‡³å…³é‡è¦çš„å½±å“ï¼Œæ¯”å¦‚ï¼šæŸæ•°æ®æºä¸­çš„æŸäº›æ•°æ®ç”±äºæŸç§åŸå› (å¦‚ï¼šç½‘ç»œåŸå› ï¼Œå¤–éƒ¨å­˜å‚¨è‡ªèº«åŸå› )ä¼šæœ‰5ç§’çš„å»¶æ—¶ï¼Œä¹Ÿå°±æ˜¯åœ¨å®é™…æ—¶é—´çš„ç¬¬1ç§’äº§ç”Ÿçš„æ•°æ®æœ‰å¯èƒ½åœ¨ç¬¬5ç§’ä¸­äº§ç”Ÿçš„æ•°æ®ä¹‹ååˆ°æ¥(æ¯”å¦‚åˆ°Windowå¤„ç†èŠ‚ç‚¹).é€‰å…·ä½“æŸä¸ªdelayçš„å…ƒç´ æ¥è¯´ï¼Œå‡è®¾åœ¨ä¸€ä¸ª5ç§’çš„Tumbleçª—å£(è¯¦è§Windowä»‹ç»ç« èŠ‚)ï¼Œæœ‰ä¸€ä¸ªEventTimeæ˜¯ 11ç§’çš„æ•°æ®ï¼Œåœ¨ç¬¬16ç§’æ—¶å€™åˆ°æ¥äº†ã€‚å›¾ç¤ºç¬¬11ç§’çš„æ•°æ®ï¼Œåœ¨16ç§’åˆ°æ¥äº†ï¼Œå¦‚ä¸‹å›¾ï¼š é‚£ä¹ˆå¯¹äºä¸€ä¸ªCountèšåˆçš„Tumble(5s)çš„windowï¼Œä¸Šé¢çš„æƒ…å†µå¦‚ä½•å¤„ç†æ‰èƒ½window2=4ï¼Œwindow3=2 å‘¢ï¼ŸApache Flinkçš„æ—¶é—´ç±»å‹å¼€ç¯‡æˆ‘ä»¬æè¿°çš„é—®é¢˜æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„TimeWindowä¸­æ•°æ®ä¹±åºçš„é—®é¢˜ï¼Œä¹±åºæ˜¯ç›¸å¯¹äºäº‹ä»¶äº§ç”Ÿæ—¶é—´å’Œåˆ°è¾¾Apache Flink å®é™…å¤„ç†ç®—å­çš„é¡ºåºè€Œè¨€çš„ï¼Œå…³äºæ—¶é—´åœ¨Apache Flinkä¸­æœ‰å¦‚ä¸‹ä¸‰ç§æ—¶é—´ç±»å‹ï¼Œå¦‚ä¸‹å›¾ï¼š é‚£ä¹ˆå¯¹äºä¸€ä¸ªCountèšåˆçš„Tumble(5s)çš„windowï¼Œä¸Šé¢çš„æƒ…å†µå¦‚ä½•å¤„ç†æ‰èƒ½window2=4ï¼Œwindow3=2 å‘¢ï¼Ÿ Apache Flinkçš„æ—¶é—´ç±»å‹å¼€ç¯‡æˆ‘ä»¬æè¿°çš„é—®é¢˜æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„TimeWindowä¸­æ•°æ®ä¹±åºçš„é—®é¢˜ï¼Œä¹±åºæ˜¯ç›¸å¯¹äºäº‹ä»¶äº§ç”Ÿæ—¶é—´å’Œåˆ°è¾¾Apache Flink å®é™…å¤„ç†ç®—å­çš„é¡ºåºè€Œè¨€çš„ï¼Œå…³äºæ—¶é—´åœ¨Apache Flinkä¸­æœ‰å¦‚ä¸‹ä¸‰ç§æ—¶é—´ç±»å‹ï¼Œå¦‚ä¸‹å›¾ï¼š ProcessingTime æ˜¯æ•°æ®æµå…¥åˆ°å…·ä½“æŸä¸ªç®—å­æ—¶å€™ç›¸åº”çš„ç³»ç»Ÿæ—¶é—´ã€‚ProcessingTime æœ‰æœ€å¥½çš„æ€§èƒ½å’Œæœ€ä½çš„å»¶è¿Ÿã€‚ä½†åœ¨åˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒä¸­ProcessingTimeå…·æœ‰ä¸ç¡®å®šæ€§ï¼Œç›¸åŒæ•°æ®æµå¤šæ¬¡è¿è¡Œæœ‰å¯èƒ½äº§ç”Ÿä¸åŒçš„è®¡ç®—ç»“æœã€‚ IngestionTime IngestionTimeæ˜¯æ•°æ®è¿›å…¥Apache Flinkæ¡†æ¶çš„æ—¶é—´ï¼Œæ˜¯åœ¨Source Operatorä¸­è®¾ç½®çš„ã€‚ä¸ProcessingTimeç›¸æ¯”å¯ä»¥æä¾›æ›´å¯é¢„æµ‹çš„ç»“æœï¼Œå› ä¸ºIngestionTimeçš„æ—¶é—´æˆ³æ¯”è¾ƒç¨³å®š(åœ¨æºå¤„åªè®°å½•ä¸€æ¬¡)ï¼ŒåŒä¸€æ•°æ®åœ¨æµç»ä¸åŒçª—å£æ“ä½œæ—¶å°†ä½¿ç”¨ç›¸åŒçš„æ—¶é—´æˆ³ï¼Œè€Œå¯¹äºProcessingTimeåŒä¸€æ•°æ®åœ¨æµç»ä¸åŒçª—å£ç®—å­ä¼šæœ‰ä¸åŒçš„å¤„ç†æ—¶é—´æˆ³ã€‚ EventTime EventTimeæ˜¯äº‹ä»¶åœ¨è®¾å¤‡ä¸Šäº§ç”Ÿæ—¶å€™æºå¸¦çš„ã€‚åœ¨è¿›å…¥Apache Flinkæ¡†æ¶ä¹‹å‰EventTimeé€šå¸¸è¦åµŒå…¥åˆ°è®°å½•ä¸­ï¼Œå¹¶ä¸”EventTimeä¹Ÿå¯ä»¥ä»è®°å½•ä¸­æå–å‡ºæ¥ã€‚åœ¨å®é™…çš„ç½‘ä¸Šè´­ç‰©è®¢å•ç­‰ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¤§å¤šä¼šä½¿ç”¨EventTimeæ¥è¿›è¡Œæ•°æ®è®¡ç®—ã€‚ å¼€ç¯‡æè¿°çš„é—®é¢˜å’Œæœ¬ç¯‡è¦ä»‹ç»çš„Watermarkæ‰€æ¶‰åŠçš„æ—¶é—´ç±»å‹å‡æ˜¯æŒ‡EventTimeç±»å‹ã€‚ ä»€ä¹ˆæ˜¯WatermarkWatermarkæ˜¯Apache Flinkä¸ºäº†å¤„ç†EventTime çª—å£è®¡ç®—æå‡ºçš„ä¸€ç§æœºåˆ¶,æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§æ—¶é—´æˆ³ï¼Œç”±Apache Flink Sourceæˆ–è€…è‡ªå®šä¹‰çš„Watermarkç”Ÿæˆå™¨æŒ‰ç…§éœ€æ±‚Punctuatedæˆ–è€…Periodicä¸¤ç§æ–¹å¼ç”Ÿæˆçš„ä¸€ç§ç³»ç»ŸEventï¼Œä¸æ™®é€šæ•°æ®æµEventä¸€æ ·æµè½¬åˆ°å¯¹åº”çš„ä¸‹æ¸¸ç®—å­ï¼Œæ¥æ”¶åˆ°Watermark Eventçš„ç®—å­ä»¥æ­¤ä¸æ–­è°ƒæ•´è‡ªå·±ç®¡ç†çš„EventTime clockã€‚ Apache Flink æ¡†æ¶ä¿è¯Watermarkå•è°ƒé€’å¢ï¼Œç®—å­æ¥æ”¶åˆ°ä¸€ä¸ªWatermarkæ—¶å€™ï¼Œæ¡†æ¶çŸ¥é“ä¸ä¼šå†æœ‰ä»»ä½•å°äºè¯¥Watermarkçš„æ—¶é—´æˆ³çš„æ•°æ®å…ƒç´ åˆ°æ¥äº†ï¼Œæ‰€ä»¥Watermarkå¯ä»¥çœ‹åšæ˜¯å‘Šè¯‰Apache Flinkæ¡†æ¶æ•°æ®æµå·²ç»å¤„ç†åˆ°ä»€ä¹ˆä½ç½®(æ—¶é—´ç»´åº¦)çš„æ–¹å¼ã€‚ Watermarkçš„äº§ç”Ÿå’ŒApache Flinkå†…éƒ¨å¤„ç†é€»è¾‘å¦‚ä¸‹å›¾æ‰€ç¤º: Watermarkçš„äº§ç”Ÿæ–¹å¼ç›®å‰Apache Flink æœ‰ä¸¤ç§ç”Ÿäº§Watermarkçš„æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š Punctuated - æ•°æ®æµä¸­æ¯ä¸€ä¸ªé€’å¢çš„EventTimeéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªWatermarkã€‚ åœ¨å®é™…çš„ç”Ÿäº§ä¸­Punctuatedæ–¹å¼åœ¨TPSå¾ˆé«˜çš„åœºæ™¯ä¸‹ä¼šäº§ç”Ÿå¤§é‡çš„Watermarkåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯¹ä¸‹æ¸¸ç®—å­é€ æˆå‹åŠ›ï¼Œæ‰€ä»¥åªæœ‰åœ¨å®æ—¶æ€§è¦æ±‚éå¸¸é«˜çš„åœºæ™¯æ‰ä¼šé€‰æ‹©Punctuatedçš„æ–¹å¼è¿›è¡ŒWatermarkçš„ç”Ÿæˆã€‚ Periodic - å‘¨æœŸæ€§çš„ï¼ˆä¸€å®šæ—¶é—´é—´éš”æˆ–è€…è¾¾åˆ°ä¸€å®šçš„è®°å½•æ¡æ•°ï¼‰äº§ç”Ÿä¸€ä¸ªWatermarkã€‚åœ¨å®é™…çš„ç”Ÿäº§ä¸­Periodicçš„æ–¹å¼å¿…é¡»ç»“åˆæ—¶é—´å’Œç§¯ç´¯æ¡æ•°ä¸¤ä¸ªç»´åº¦ç»§ç»­å‘¨æœŸæ€§äº§ç”ŸWatermarkï¼Œå¦åˆ™åœ¨æç«¯æƒ…å†µä¸‹ä¼šæœ‰å¾ˆå¤§çš„å»¶æ—¶ã€‚ æ‰€ä»¥Watermarkçš„ç”Ÿæˆæ–¹å¼éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯çš„ä¸åŒè¿›è¡Œä¸åŒçš„é€‰æ‹©ã€‚ Watermarkçš„æ¥å£å®šä¹‰å¯¹åº”Apache Flink Watermarkä¸¤ç§ä¸åŒçš„ç”Ÿæˆæ–¹å¼ï¼Œæˆ‘ä»¬äº†è§£ä¸€ä¸‹å¯¹åº”çš„æ¥å£å®šä¹‰ï¼Œå¦‚ä¸‹ï¼š Periodic Watermarks - AssignerWithPeriodicWatermarks 1234567891011121314151617181920212223/*** Returns the current watermark. This method is periodically called by the* system to retrieve the current watermark. The method may return &#123;@code null&#125; to* indicate that no new Watermark is available.** The returned watermark will be emitted only if it is non-null and itsTimestamp* is larger than that of the previously emitted watermark (to preserve the contract of* ascending watermarks). If the current watermark is still* identical to the previous one, no progress in EventTime has happened since* the previous call to this method. If a null value is returned, or theTimestamp* of the returned watermark is smaller than that of the last emitted one, then no* new watermark will be generated.** The interval in which this method is called and Watermarks are generated* depends on &#123;@link ExecutionConfig#getAutoWatermarkInterval()&#125;.** @see org.Apache.flink.streaming.api.watermark.Watermark* @see ExecutionConfig#getAutoWatermarkInterval()** @return &#123;@code Null&#125;, if no watermark should be emitted, or the next watermark to emit.*/@NullableWatermark getCurrentWatermark(); Punctuated Watermarks - AssignerWithPunctuatedWatermarks 1234567891011121314151617181920public interface AssignerWithPunctuatedWatermarks&lt;T&gt; extends TimestampAssigner&lt;T&gt; &#123;/*** Asks this implementation if it wants to emit a watermark. This method is called right after* the &#123;@link #extractTimestamp(Object, long)&#125; method.** The returned watermark will be emitted only if it is non-null and itsTimestamp* is larger than that of the previously emitted watermark (to preserve the contract of* ascending watermarks). If a null value is returned, or theTimestamp of the returned* watermark is smaller than that of the last emitted one, then no new watermark will* be generated.** For an example how to use this method, see the documentation of* &#123;@link AssignerWithPunctuatedWatermarks this class&#125;.** @return &#123;@code Null&#125;, if no watermark should be emitted, or the next watermark to emit.*/@NullableWatermark checkAndGetNextWatermark(T lastElement, long extractedTimestamp);&#125; AssignerWithPunctuatedWatermarks ç»§æ‰¿äº†TimestampAssigneræ¥å£ -TimestampAssigner 1234567891011121314151617public interfaceTimestampAssigner&lt;T&gt; extends Function &#123;/*** Assigns aTimestamp to an element, in milliseconds since the Epoch.** The method is passed the previously assignedTimestamp of the element.* That previousTimestamp may have been assigned from a previous assigner,* by ingestionTime. If the element did not carry aTimestamp before, this value is* &#123;@code Long.MIN_VALUE&#125;.** @param element The element that theTimestamp is wil be assigned to.* @param previousElementTimestamp The previous internalTimestamp of the element,* or a negative value, if noTimestamp has been assigned, yet.* @return The newTimestamp.*/long extractTimestamp(T element, long previousElementTimestamp);&#125; ä»æ¥å£å®šä¹‰å¯ä»¥çœ‹å‡ºï¼ŒWatermarkå¯ä»¥åœ¨Event(Element)ä¸­æå–EventTimeï¼Œè¿›è€Œå®šä¹‰ä¸€å®šçš„è®¡ç®—é€»è¾‘äº§ç”ŸWatermarkçš„æ—¶é—´æˆ³ã€‚ Watermarkè§£å†³å¦‚ä¸Šé—®é¢˜ä»ä¸Šé¢çš„Watermarkç”Ÿæˆæ¥å£å’ŒApache Flinkå†…éƒ¨å¯¹Periodic Watermarkçš„å®ç°æ¥çœ‹ï¼ŒWatermarkçš„æ—¶é—´æˆ³å¯ä»¥å’ŒEventä¸­çš„EventTime ä¸€è‡´ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰ä»»ä½•åˆç†çš„é€»è¾‘ä½¿å¾—Watermarkçš„æ—¶é—´æˆ³ä¸ç­‰äºEventä¸­çš„EventTimeï¼ŒEventä¸­çš„EventTimeè‡ªäº§ç”Ÿé‚£ä¸€åˆ»èµ·å°±ä¸å¯ä»¥æ”¹å˜äº†ï¼Œä¸å—Apache Flinkæ¡†æ¶æ§åˆ¶ï¼Œè€ŒWatermarkçš„äº§ç”Ÿæ˜¯åœ¨Apache Flinkçš„SourceèŠ‚ç‚¹æˆ–å®ç°çš„Watermarkç”Ÿæˆå™¨è®¡ç®—äº§ç”Ÿ(å¦‚ä¸ŠApache Flinkå†…ç½®çš„ Periodic Watermarkå®ç°), Apache Flinkå†…éƒ¨å¯¹å•æµæˆ–å¤šæµçš„åœºæ™¯æœ‰ç»Ÿä¸€çš„Watermarkå¤„ç†ã€‚ å›è¿‡å¤´æ¥æˆ‘ä»¬åœ¨çœ‹çœ‹Watermarkæœºåˆ¶å¦‚ä½•è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œä¸Šé¢çš„é—®é¢˜åœ¨äºå¦‚ä½•å°†è¿Ÿæ¥çš„EventTime ä½11çš„å…ƒç´ æ­£ç¡®å¤„ç†ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬è¿˜éœ€è¦å…ˆäº†è§£ä¸€ä¸‹EventTime windowæ˜¯å¦‚ä½•è§¦å‘çš„ï¼Ÿ EventTime window è®¡ç®—æ¡ä»¶æ˜¯å½“Windowè®¡ç®—çš„Timeræ—¶é—´æˆ³ å°äºç­‰äº å½“å‰ç³»ç»Ÿçš„Watermakçš„æ—¶é—´æˆ³æ—¶å€™è¿›è¡Œè®¡ç®—ã€‚ å½“Watermarkçš„æ—¶é—´æˆ³ç­‰äºEventä¸­æºå¸¦çš„EventTimeæ—¶å€™ï¼Œä¸Šé¢åœºæ™¯ï¼ˆWatermark=EventTime)çš„è®¡ç®—ç»“æœå¦‚ä¸‹ï¼š ä¸Šé¢å¯¹åº”çš„DDL(Alibaba ä¼ä¸šç‰ˆçš„Flinkåˆ†æ”¯)å®šä¹‰å¦‚ä¸‹ï¼š 1234567CREATE TABLE source(...,Event_timeTimeStamp,WATERMARK wk1 FOR Event_time as withOffset(Event_time, 0) ) with (...); å¦‚æœæƒ³æ­£ç¡®å¤„ç†è¿Ÿæ¥çš„æ•°æ®å¯ä»¥å®šä¹‰Watermarkç”Ÿæˆç­–ç•¥ä¸º Watermark = EventTime -5sï¼Œ å¦‚ä¸‹ï¼š ä¸Šé¢å¯¹åº”çš„DDL(Alibaba å†…éƒ¨çš„DDLè¯­æ³•ï¼Œç›®å‰æ­£åœ¨å’Œç¤¾åŒºè®¨è®º)å®šä¹‰å¦‚ä¸‹ï¼š 1234567CREATE TABLE source(...,Event_timeTimeStamp,WATERMARK wk1 FOR Event_time as withOffset(Event_time, 5000) ) with (...); ä¸Šé¢æ­£ç¡®å¤„ç†çš„æ ¹æºæ˜¯æˆ‘ä»¬é‡‡å–äº† å»¶è¿Ÿè§¦å‘ window è®¡ç®— çš„æ–¹å¼æ­£ç¡®å¤„ç†äº† Late Event. ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å‘ç°windowçš„å»¶æ—¶è§¦å‘è®¡ç®—ï¼Œä¹Ÿå¯¼è‡´äº†ä¸‹æ¸¸çš„LATENCYå˜å¤§ï¼Œæœ¬ä¾‹å­ä¸­ä¸‹æ¸¸å¾—åˆ°windowçš„ç»“æœå°±å»¶è¿Ÿäº†5s. å¤šæµçš„Watermarkå¤„ç†åœ¨å®é™…çš„æµè®¡ç®—ä¸­å¾€å¾€ä¸€ä¸ªjobä¸­ä¼šå¤„ç†å¤šä¸ªSourceçš„æ•°æ®ï¼Œå¯¹Sourceçš„æ•°æ®è¿›è¡ŒGroupByåˆ†ç»„ï¼Œé‚£ä¹ˆæ¥è‡ªä¸åŒSourceçš„ç›¸åŒkeyå€¼ä¼šshuffleåˆ°åŒä¸€ä¸ªå¤„ç†èŠ‚ç‚¹ï¼Œå¹¶æºå¸¦å„è‡ªçš„Watermarkï¼ŒApache Flinkå†…éƒ¨è¦ä¿è¯Watermarkè¦ä¿æŒå•è°ƒé€’å¢ï¼Œå¤šä¸ªSourceçš„Watermarkæ±‡èšåˆ°ä¸€èµ·æ—¶å€™å¯èƒ½ä¸æ˜¯å•è°ƒè‡ªå¢çš„ï¼Œè¿™æ ·çš„æƒ…å†µApache Flinkå†…éƒ¨æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Apache Flinkå†…éƒ¨å®ç°æ¯ä¸€ä¸ªè¾¹ä¸Šåªèƒ½æœ‰ä¸€ä¸ªé€’å¢çš„Watermarkï¼Œ å½“å‡ºç°å¤šæµæºå¸¦Eventtimeæ±‡èšåˆ°ä¸€èµ·(GroupBy or Union)æ—¶å€™ï¼ŒApache Flinkä¼šé€‰æ‹©æ‰€æœ‰æµå…¥çš„Eventtimeä¸­æœ€å°çš„ä¸€ä¸ªå‘ä¸‹æ¸¸æµå‡ºã€‚ä»è€Œä¿è¯watermarkçš„å•è°ƒé€’å¢å’Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§.å¦‚ä¸‹å›¾: æœ¬èŠ‚ä»¥ä¸€ä¸ªæµè®¡ç®—å¸¸è§çš„ä¹±åºé—®é¢˜ä»‹ç»äº†Apache Flinkå¦‚ä½•åˆ©ç”¨Watermarkæœºåˆ¶æ¥å¤„ç†ä¹±åºé—®é¢˜. æœ¬ç¯‡å†…å®¹åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä½“ç°äº†EventTime Windowä¸­çš„Triggeræœºåˆ¶ä¾èµ–äº†Watermark(åç»­Windowç¯‡ç« ä¼šä»‹ç»)ã€‚Watermarkæœºåˆ¶æ˜¯æµè®¡ç®—ä¸­å¤„ç†ä¹±åºï¼Œæ­£ç¡®å¤„ç†Late Eventçš„æ ¸å¿ƒæ‰‹æ®µã€‚ ä½¿ç”¨Event Time å¤„ç†å®æ—¶æ•°æ® å¦‚ä¸‹æ˜¯ä¸€æ®µ log æ—¥å¿—ï¼Œæˆ‘ä»¬æ ¹æ®è¯¥æ—¥å¿—æ ¼å¼ï¼Œæ¥åˆ†æå®¢æˆ·çš„ä¸‹å•é‡æƒ…å†µã€‚ æ—¥å¿—æ ¼å¼ï¼š1581490623000,James,51581490624150,John,2â€¦ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»å¹¶è¡ŒSource å’Œ éå¹¶è¡ŒSource ä¸¤ä¸ªæ–¹å‘ï¼Œæ¥ä½¿ç”¨ EventTime å¤„ç†å®æ—¶æ•°æ®ã€‚(æ¥ä¸‹æ¥ç¤ºä¾‹ï¼Œè®¾ç½®å»¶è¿Ÿä¸º0sï¼Œå³ä¸å»¶è¿Ÿ) éå¹¶è¡ŒSourceéå¹¶è¡ŒSourceï¼Œä»¥ socketTextStreamä¸ºä¾‹æ¥ä»‹ç» Flinkä½¿ç”¨ EventTime å¤„ç†å®æ—¶æ•°æ®ã€‚ ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243/*** TODO éå¹¶è¡ŒSource EventTime ** @author liuzebiao * @Date 2020-2-12 15:25*/public class EventTimeDemo &#123; public static void main(String[] args) throws Exception &#123; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); //è®¾ç½®EventTimeä½œä¸ºæ—¶é—´æ ‡å‡† env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime); //è¯»å–sourceï¼Œå¹¶æŒ‡å®š(1581490623000,Mary,3)ä¸­å“ªä¸ªå­—æ®µä¸ºEventTimeæ—¶é—´ //WaterMarks:æ˜¯Flinkä¸­çª—å£å»¶è¿Ÿè§¦å‘çš„æœºåˆ¶ã€‚Time.seconds(0)è¡¨ç¤ºæ— å»¶è¿Ÿã€‚ SingleOutputStreamOperator&lt;String&gt; source = env.socketTextStream("localhost", 8888).assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor&lt;String&gt;(Time.seconds(0)) &#123; @Override public long extractTimestamp(String line) &#123; String[] split = line.split(","); return Long.parseLong(split[0]); &#125; &#125;); SingleOutputStreamOperator&lt;Tuple2&lt;String, Integer&gt;&gt; mapOperator = source.map(line -&gt; &#123; String[] split = line.split(","); return Tuple2.of(split[1], Integer.parseInt(split[2])); &#125;).returns(Types.TUPLE(Types.STRING,Types.INT)); KeyedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple&gt; keyedStream = mapOperator.keyBy(0); //EventTimeæ»šåŠ¨çª—å£ WindowedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple, TimeWindow&gt; windowedStream = keyedStream.window(TumblingEventTimeWindows.of(Time.seconds(5))); SingleOutputStreamOperator&lt;Tuple2&lt;String, Integer&gt;&gt; sum = windowedStream.sum(1); sum.print(); env.execute("EventTimeDemo"); &#125;&#125; æµ‹è¯•ç»“æœ ç»“æœåˆ†æå¤‡æ³¨ï¼š (1581490623000è½¬æ¢åä¸ºï¼š2020-02-12 14:57:03â€‹ 1581490624000è½¬æ¢åä¸ºï¼š2020-02-12 14:57:04) å½“æˆ‘ä»¬åœ¨Socketä¸­è¾“å…¥å¦‚ä¸‹æ•°æ®ï¼š1581490623000,Mary,21581490624000,John,31581490624500,Clerk,11581490624998,Maria,41581490624999,Mary,31581490626000,Mary,31581490630800,Steve,3 (2020-02-12 14:57:10.800) çª—å£å®šä¹‰çš„æ—¶é—´æ˜¯ï¼šå«å¤´ä¸å«å°¾ã€‚å³ï¼š[0,5)ï¼Œå›¾ç‰‡è§£æï¼š(æˆ‘ä»¬å®šä¹‰æ»šåŠ¨çª—å£ä¸º5sï¼Œæˆ‘ä»¬åˆ†æå›¾ç‰‡å‘ç°åˆ°4998æ—¶,å¹¶æ²¡æœ‰è¾“å‡ºå†…å®¹ã€‚å› ä¸º4998è¿˜æ²¡è¶…è¿‡5sï¼Œçª—å£è§„å®šæ˜¯&gt;=ä¸´ç•Œå€¼æ—¶è§¦å‘ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¾“å…¥4999ä¸´ç•Œæ—¶ï¼Œæˆ‘ä»¬å‘ç°è¾“å‡ºå†…å®¹äº†ï¼Œè¯´æ˜ä¸€ä¸ªçª—å£æ»šåŠ¨å®Œæˆï¼Œè¾“å‡ºå†…å®¹åŒ…å«4999è¿™ä¸ªæ—¶é—´çš„å€¼ï¼›å½“è¾“å…¥6000æ—¶ï¼Œ6000åœ¨[5,10)ä¹‹é—´æ²¡æœ‰&gt;10ï¼Œæ‰€ä»¥ä¸è¾“å‡ºã€‚è¾“å…¥30800ã€2020-02-12 14:57:10.800)ã€‘ï¼Œå·²ç»è¶…è¿‡10sï¼Œæ‰€ä»¥ç»“æœåªè¾“å‡º1ä¸ª (Mary,3)ï¼Œå› ä¸ºSteveå·²ç»è¢«åˆ†åˆ°å¦ä¸€ä¸ªçª—å£äº†) è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ï¼šå½“è¾“å…¥åˆ° 4999 æ—¶ï¼Œåªæ˜¯Maryè¿™ä¸ªåˆ†ç»„æ»¡è¶³5sè¿™ä¸ªæ¡ä»¶ï¼Œä½†æ˜¯å…¶å®ƒåˆ†ç»„Johnï¼ŒClerk ç­‰ä¹ŸåŒæ­¥è¾“å‡ºç»“æœäº†ã€‚æ˜¾ç„¶è¿™ä¸ç¬¦åˆé€»è¾‘ã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿæ˜¯å› ä¸ºSocketStream æ˜¯éå¹¶è¡Œæ•°æ®æµï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°è¿™æ ·å­çš„ç»“æœã€‚(æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ˜¯ç”¨å¹¶è¡Œæ•°æ®æµKafkaSourceæ¥åˆ†æ) å¹¶è¡ŒSourceå¹¶è¡ŒSourceï¼Œä»¥ KafkaSouce ä¸ºä¾‹æ¥ä»‹ç» Flinkä½¿ç”¨ EventTime å¤„ç†å®æ—¶æ•°æ®ã€‚ ä»£ç  å¹¶è¡ŒKafkaSource EventTimeç¤ºä¾‹(è¯»å– topicä¸º window_demoä¸­çš„æ¶ˆæ¯)ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152/*** TODO å¹¶è¡ŒKafkaSource EventTimeç¤ºä¾‹(è¯»å– topicä¸º window_demoä¸­çš„æ¶ˆæ¯)** @author liuzebiao* @Date 2020-2-12 15:25*/public class EventTimeDemo &#123; public static void main(String[] args) throws Exception &#123; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); //è®¾ç½®EventTimeä½œä¸ºæ—¶é—´æ ‡å‡† env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime); //Kafka props Properties properties = new Properties(); //æŒ‡å®šKafkaçš„Brokeråœ°å€ properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, "192.168.204.210:9092,192.168.204.211:9092,192.168.204.212:9092"); //æŒ‡å®šç»„ID properties.put(ConsumerConfig.GROUP_ID_CONFIG, "flinkDemoGroup"); //å¦‚æœæ²¡æœ‰è®°å½•åç§»é‡ï¼Œç¬¬ä¸€æ¬¡ä»æœ€å¼€å§‹æ¶ˆè´¹ properties.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest"); FlinkKafkaConsumer&lt;String&gt; kafkaSource = new FlinkKafkaConsumer("window_demo", new SimpleStringSchema(), properties); //2.é€šè¿‡addSource()æ–¹å¼ï¼Œåˆ›å»º Kafka DataStream //è¯»å–sourceï¼Œå¹¶æŒ‡å®š(1581490623000,Mary,3)ä¸­å“ªä¸ªå­—æ®µä¸ºEventTimeæ—¶é—´ SingleOutputStreamOperator&lt;String&gt; source = env.addSource(kafkaSource).assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor&lt;String&gt;(Time.seconds(0)) &#123; @Override public long extractTimestamp(String line) &#123; String[] split = line.split(","); return Long.parseLong(split[0]); &#125; &#125;); SingleOutputStreamOperator&lt;Tuple2&lt;String, Integer&gt;&gt; mapOperator = source.map(line -&gt; &#123; String[] split = line.split(","); return Tuple2.of(split[1], Integer.parseInt(split[2])); &#125;).returns(Types.TUPLE(Types.STRING,Types.INT)); KeyedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple&gt; keyedStream = mapOperator.keyBy(0); //EventTimeæ»šåŠ¨çª—å£ WindowedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple, TimeWindow&gt; windowedStream = keyedStream.window(TumblingEventTimeWindows.of(Time.seconds(5))); SingleOutputStreamOperator&lt;Tuple2&lt;String, Integer&gt;&gt; sum = windowedStream.sum(1); sum.print(); env.execute("EventTimeDemo"); &#125;&#125; æµ‹è¯•ç»“æœ åˆ›å»º Topic å‘½ä»¤å¦‚ä¸‹ï¼š 12bin/kafka-topics.sh --create --zookeeper 192.168.204.210:2181,192.168.204.211:2181,192.168.204.212:2181 --replication-factor 1 --partitions 3 --topic window_demo# (ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹ï¼šæ­¤å¤„åˆ›å»ºäº†3ä¸ªåˆ†åŒº) åˆ›å»º Topic æˆåŠŸæˆªå›¾(ç‚¹å‡»æ”¾å¤§æŸ¥çœ‹)ï¼š ä½¿ç”¨å‘½ä»¤ï¼Œå†™å…¥æ•°æ®åˆ°Kafkaï¼š 1bin/kafka-console-producer.sh --broker-list 192.168.204.210:9092 --topic window_demo ä½¿ç”¨å‘½ä»¤å†™å…¥ä»¥ä¸‹æ•°æ®ï¼š 123451581490623000,Mary,21581490624000,John,31581490624500,Clerk,11581490624998,Maria,41581490624999,Mary,3 æµ‹è¯•ç»“æœï¼š ç»“æœåˆ†æâ€‹ åœ¨å¹¶è¡ŒSourceä¸€ä¾‹ä¸­ï¼Œå½“æˆ‘ä»¬è¾“å…¥1581490624999,Mary,3æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°æ§åˆ¶å°ä¼šç›´æ¥å¸®æˆ‘ä»¬è¾“å‡ºè®¡ç®—ç»“æœã€‚ â€‹ ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨ KafkaSource æ—¶ï¼Œæˆ‘ä»¬è¿ç»­è¾“å…¥äº† 3æ¬¡1581490624999,Mary,3ï¼Œæˆ‘ä»¬æ‰çœ‹åˆ°æ§åˆ¶å°å¸®æˆ‘ä»¬è¾“å‡ºè®¡ç®—äº†ç»“æœã€‚ â€‹ é‚£è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯ å¹¶è¡ŒSource å’Œ éå¹¶è¡ŒSource çš„åŸå› å¯¼è‡´çš„ï¼ˆè¿™é‡Œæ¶‰åŠåˆ° KafkaSource åˆ›å»ºçš„ topicï¼Œæœ‰ 3 ä¸ªåˆ†åŒºçš„åŸå› ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink å¹¿æ’­å˜é‡]]></title>
    <url>%2F2020%2F04%2F10%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F12-Flink%20%E5%B9%BF%E6%92%AD%E5%8F%98%E9%87%8F%2F</url>
    <content type="text"><![CDATA[å¹¿æ’­å˜é‡ç®€ä»‹åœ¨Flinkä¸­ï¼ŒåŒä¸€ä¸ªç®—å­å¯èƒ½å­˜åœ¨è‹¥å¹²ä¸ªä¸åŒçš„å¹¶è¡Œå®ä¾‹ï¼Œè®¡ç®—è¿‡ç¨‹å¯èƒ½ä¸åœ¨åŒä¸€ä¸ªSlotä¸­è¿›è¡Œï¼Œä¸åŒç®—å­ä¹‹é—´æ›´æ˜¯å¦‚æ­¤ï¼Œå› æ­¤ä¸åŒç®—å­çš„è®¡ç®—æ•°æ®ä¹‹é—´ä¸èƒ½åƒJavaæ•°ç»„ä¹‹é—´ä¸€æ ·äº’ç›¸è®¿é—®ï¼Œè€Œå¹¿æ’­å˜é‡Broadcastä¾¿æ˜¯è§£å†³è¿™ç§æƒ…å†µçš„ã€‚ æˆ‘ä»¬å¯ä»¥æŠŠå¹¿æ’­å˜é‡ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå…¬å…±çš„å…±äº«å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªdataset æ•°æ®é›†å¹¿æ’­å‡ºå»ï¼Œç„¶åä¸åŒçš„taskåœ¨èŠ‚ç‚¹ä¸Šéƒ½èƒ½å¤Ÿè·å–åˆ°ï¼Œè¿™ä¸ªæ•°æ®åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªä¼šå­˜åœ¨ä¸€ä»½ã€ ç”¨æ³•123456789101ï¼šåˆå§‹åŒ–æ•°æ® DataSet&lt;Integer&gt; num = env.fromElements(1, 2, 3) 2ï¼šå¹¿æ’­æ•°æ® .withBroadcastSet(toBroadcast, &quot;num&quot;); 3ï¼šè·å–æ•°æ® Collection&lt;Integer&gt; broadcastSet = getRuntimeContext().getBroadcastVariable(&quot;num&quot;); æ³¨æ„ï¼š 1ï¼šå¹¿æ’­å‡ºå»çš„å˜é‡å­˜åœ¨äºæ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¿™ä¸ªæ•°æ®é›†ä¸èƒ½å¤ªå¤§ã€‚å› ä¸ºå¹¿æ’­å‡ºå»çš„æ•°æ®ï¼Œä¼šå¸¸é©»å†…å­˜ï¼Œé™¤éç¨‹åºæ‰§è¡Œç»“æŸ 2ï¼šå¹¿æ’­å˜é‡åœ¨åˆå§‹åŒ–å¹¿æ’­å‡ºå»ä»¥åä¸æ”¯æŒä¿®æ”¹ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚ æ³¨æ„äº‹é¡¹ä½¿ç”¨å¹¿æ’­çŠ¶æ€ï¼Œtask ä¹‹é—´ä¸ä¼šç›¸äº’é€šä¿¡åªæœ‰å¹¿æ’­çš„ä¸€è¾¹å¯ä»¥ä¿®æ”¹å¹¿æ’­çŠ¶æ€çš„å†…å®¹ã€‚ç”¨æˆ·å¿…é¡»ä¿è¯æ‰€æœ‰ operator å¹¶å‘å®ä¾‹ä¸Šå¯¹å¹¿æ’­çŠ¶æ€çš„ä¿®æ”¹è¡Œä¸ºéƒ½æ˜¯ä¸€è‡´çš„ã€‚æˆ–è€…è¯´ï¼Œå¦‚æœä¸åŒçš„å¹¶å‘å®ä¾‹æ‹¥æœ‰ä¸åŒçš„å¹¿æ’­çŠ¶æ€å†…å®¹ï¼Œå°†å¯¼è‡´ä¸ä¸€è‡´çš„ç»“æœã€‚ å¹¿æ’­çŠ¶æ€ä¸­äº‹ä»¶çš„é¡ºåºåœ¨å„ä¸ªå¹¶å‘å®ä¾‹ä¸­å¯èƒ½ä¸å°½ç›¸åŒå¹¿æ’­æµçš„å…ƒç´ ä¿è¯äº†å°†æ‰€æœ‰å…ƒç´ ï¼ˆæœ€ç»ˆï¼‰éƒ½å‘ç»™ä¸‹æ¸¸æ‰€æœ‰çš„å¹¶å‘å®ä¾‹ï¼Œä½†æ˜¯å…ƒç´ çš„åˆ°è¾¾çš„é¡ºåºå¯èƒ½åœ¨å¹¶å‘å®ä¾‹ä¹‹é—´å¹¶ä¸ç›¸åŒã€‚å› æ­¤ï¼Œå¯¹å¹¿æ’­çŠ¶æ€çš„ä¿®æ”¹ä¸èƒ½ä¾èµ–äºè¾“å…¥æ•°æ®çš„é¡ºåºã€‚ æ‰€æœ‰operator taskéƒ½ä¼šå¿«ç…§ä¸‹ä»–ä»¬çš„å¹¿æ’­çŠ¶æ€åœ¨checkpointæ—¶ï¼Œæ‰€æœ‰çš„ task éƒ½ä¼š checkpoint ä¸‹ä»–ä»¬çš„å¹¿æ’­çŠ¶æ€ï¼Œéšç€å¹¶å‘åº¦çš„å¢åŠ ï¼Œcheckpoint çš„å¤§å°ä¹Ÿä¼šéšä¹‹å¢åŠ  å¹¿æ’­å˜é‡å­˜åœ¨å†…å­˜ä¸­å¹¿æ’­å‡ºå»çš„å˜é‡å­˜åœ¨äºæ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¿™ä¸ªæ•°æ®é›†ä¸èƒ½å¤ªå¤§ï¼Œç™¾å…†å·¦å³å¯ä»¥æ¥å—ï¼ŒGbä¸èƒ½æ¥å— æ¡ˆä¾‹12345678910111213141516171819202122232425public class BroadCastTest &#123; public static void main(String[] args) throws Exception&#123; ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); //1.å°è£…ä¸€ä¸ªDataSet DataSet&lt;Integer&gt; broadcast = env.fromElements(1, 2, 3); DataSet&lt;String&gt; data = env.fromElements(&quot;a&quot;, &quot;b&quot;); data.map(new RichMapFunction&lt;String, String&gt;() &#123; private List list = new ArrayList(); @Override public void open(Configuration parameters) throws Exception &#123; // 3. è·å–å¹¿æ’­çš„DataSetæ•°æ® ä½œä¸ºä¸€ä¸ªCollection Collection&lt;Integer&gt; broadcastSet = getRuntimeContext().getBroadcastVariable(&quot;number&quot;); list.addAll(broadcastSet); &#125; @Override public String map(String value) throws Exception &#123; return value + &quot;: &quot;+ list; &#125; &#125;).withBroadcastSet(broadcast, &quot;number&quot;) // 2. å¹¿æ’­çš„broadcast .printToErr();//æ‰“å°åˆ°erræ–¹ä¾¿æŸ¥çœ‹ &#125;&#125; è¾“å‡ºç»“æœï¼š 12a: [1, 2, 3]b: [1, 2, 3]]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink å¹¶è¡Œåº¦]]></title>
    <url>%2F2020%2F04%2F10%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F11-Flink%20%E5%B9%B6%E8%A1%8C%E5%BA%A6%2F</url>
    <content type="text"><![CDATA[å¹¶è¡Œæ‰§è¡Œæœ¬èŠ‚ä»‹ç»å¦‚ä½•åœ¨Flinkä¸­é…ç½®ç¨‹åºçš„å¹¶è¡Œæ‰§è¡Œã€‚FLinkç¨‹åºç”±å¤šä¸ªä»»åŠ¡ï¼ˆè½¬æ¢/æ“ä½œç¬¦ã€æ•°æ®æºå’Œsinksï¼‰ç»„æˆã€‚ä»»åŠ¡è¢«åˆ†æˆå¤šä¸ªå¹¶è¡Œå®ä¾‹æ¥æ‰§è¡Œï¼Œæ¯ä¸ªå¹¶è¡Œå®ä¾‹å¤„ç†ä»»åŠ¡çš„è¾“å…¥æ•°æ®çš„å­é›†ã€‚ä»»åŠ¡çš„å¹¶è¡Œå®ä¾‹çš„æ•°é‡ç§°ä¹‹ä¸ºå¹¶è¡Œæ€§ã€‚ å¦‚æœè¦ä½¿ç”¨ä¿å­˜ç‚¹ï¼Œè¿˜åº”è¯¥è€ƒè™‘è®¾ç½®æœ€å¤§å¹¶è¡Œæ€§ï¼ˆæˆ–æœ€å¤§å¹¶è¡Œæ€§ï¼‰ã€‚å½“ä»ä¿å­˜ç‚¹è¿˜åŸæ—¶ï¼Œå¯ä»¥æ”¹å˜ç‰¹å®šè¿ç®—ç¬¦æˆ–æ•´ä¸ªç¨‹åºçš„å¹¶è¡Œæ€§ï¼Œå¹¶ä¸”è¯¥è®¾ç½®æŒ‡å®šå¹¶è¡Œæ€§çš„ä¸Šé™ã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºFLINKå†…éƒ¨å°†çŠ¶æ€åˆ’åˆ†ä¸ºkey-groupsï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸èƒ½æ‹¥æœ‰+INFçš„key-groupæ•°ï¼Œå› ä¸ºè¿™å°†å¯¹æ€§èƒ½æœ‰å®³ã€‚ Flinkä¸­äººç‰©çš„å¹¶è¡Œåº¦å¯ä»¥ä»å¤šä¸ªä¸åŒå±‚é¢è®¾ç½®ï¼š 1ï¼Œ æ“ä½œç®—å­å±‚é¢ 2ï¼Œ æ‰§è¡Œç¯å¢ƒå±‚é¢â€˜ 3ï¼Œ å®¢æˆ·ç«¯å±‚é¢ 4ï¼Œ ç³»ç»Ÿå±‚é¢ 5ï¼Œè®¾ç½®slots æ“ä½œç®—å­å±‚æ“ä½œç®—å­ï¼Œæ•°æ®æºï¼Œæ•°æ®æ¥æ”¶å™¨ç­‰è¿™äº›å¹¶è¡Œåº¦éƒ½å¯ä»¥é€šè¿‡è°ƒç”¨ä»–ä»¬çš„setParallelism()æ–¹æ³•è®¾ç½®ã€‚ä¾‹å¦‚ï¼š 1234567891011121314151617val env = StreamExecutionEnvironment.getExecutionEnvironmentval text = [...]val wordCounts = text .flatMap&#123; _.split(" ") map &#123; (_, 1) &#125; &#125; .keyBy(0) .timeWindow(Time.seconds(5)) .sum(1).setParallelism(5)wordCounts.print()env.execute("Word Count Example") æ‰§è¡Œç¯å¢ƒå±‚é¢flinkç¨‹åºæ‰§è¡Œéœ€è¦æ‰§è¡Œç¯å¢ƒä¸Šä¸‹æ–‡ã€‚æ‰§è¡Œç¯å¢ƒä¸ºå…¶è¦æ‰§è¡Œçš„æ“ä½œç®—å­ï¼Œæ•°æ®æºï¼Œæ•°æ®sinkséƒ½æ˜¯è®¾ç½®äº†é»˜è®¤çš„å¹¶è¡Œåº¦ã€‚æ‰§è¡Œç¯å¢ƒçš„å¹¶è¡Œåº¦å¯ä»¥é€šè¿‡æ“ä½œç®—å­æ˜¾ç¤ºæŒ‡å®šå¹¶è¡Œåº¦æ¥è¦†ç›–æ‰ã€‚ é»˜è®¤çš„æ‰§è¡Œç¯å¢ƒå¹¶è¡Œåº¦å¯ä»¥é€šè¿‡è°ƒç”¨setParallelism()æ¥è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œæ“ä½œç®—å­ï¼Œæ•°æ®æºï¼Œæ•°æ®æ¥æ”¶å™¨ï¼Œå¹¶è¡Œåº¦éƒ½è®¾ç½®ä¸º3ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œç¯å¢ƒå±‚é¢ï¼Œè®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼š 12345678910111213141516171819val env = StreamExecutionEnvironment.getExecutionEnvironmentenv.setParallelism(3)val text = [...]val wordCounts = text .flatMap&#123; _.split(" ") map &#123; (_, 1) &#125; &#125; .keyBy(0) .timeWindow(Time.seconds(5)) .sum(1)wordCounts.print()env.execute("Word Count Example") å®¢æˆ·ç«¯å±‚åœ¨æäº¤job åˆ°flinkçš„æ—¶å€™ï¼Œåœ¨å®¢æˆ·ç«¯ä¾§ä¹Ÿå¯ä»¥è®¾ç½®flinkçš„å¹¶è¡Œåº¦ã€‚å®¢æˆ·ç«¯å³å¯ä»¥æ˜¯javaå·¥ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯scalaå·¥ç¨‹ã€‚Flinkçš„Command-line Interface (CLI)å°±æ˜¯è¿™æ ·ä¸€ç§å®¢æˆ·ç«¯ã€‚ åœ¨å®¢æˆ·ç«¯ä¾§flinkå¯ä»¥é€šè¿‡-på‚æ•°æ¥è®¾ç½®å¹¶è¡Œåº¦ã€‚ä¾‹å¦‚ï¼š 1./bin/flink run -p 10 ../examples/*WordCount-java*.jar åœ¨java/scalaå®¢æˆ·ç«¯ï¼Œå¹¶è¡Œåº¦è®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼š 12345678910111213141516171819try &#123; PackagedProgram program = new PackagedProgram(file, args) InetSocketAddress jobManagerAddress = RemoteExecutor.getInetFromHostport("localhost:6123") Configuration config = new Configuration() Client client = new Client(jobManagerAddress, new Configuration(), program.getUserCodeClassLoader()) // set the parallelism to 10 here client.run(program, 10, true)&#125; catch &#123; case e: Exception =&gt; e.printStackTrace&#125; ç³»ç»Ÿå±‚é¢ç³»ç»Ÿå±‚é¢çš„å¹¶è¡Œåº¦è®¾ç½®ï¼Œä¼šé’ˆå¯¹æ‰€æœ‰çš„æ‰§è¡Œç¯å¢ƒç”Ÿæ•ˆï¼Œå¯ä»¥é€šè¿‡parallelism.defaultï¼Œå±æ€§åœ¨conf/flink-conf.yamlæ–‡ä»¶ä¸­è®¾ç½®ã€‚ è®¾ç½®æœ€å¤§å¹¶è¡Œåº¦è®¾ç½®æœ€å¤§å¹¶è¡Œåº¦ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ–¹æ³•æ˜¯setMaxParallelism()ï¼Œå…¶è°ƒç”¨ä½ç½®å’ŒsetParallelism()ä¸€æ ·ã€‚ é»˜è®¤çš„æœ€å¤§å¹¶è¡Œåº¦æ˜¯è¿‘ä¼¼äºoperatorParallelism + (operatorParallelism / 2)ï¼Œä¸‹é™æ˜¯127ï¼Œä¸Šçº¿æ˜¯32768. å€¼å¾—æ³¨æ„çš„æ˜¯å°†æœ€å¤§çš„å¹¶è¡Œçš„è®¾ç½®ä¸ºè¶…çº§å¤§çš„æ•°å¯èƒ½ä¼šå¯¹æ€§èƒ½é€ æˆä¸åˆ©çš„å½±å“ï¼Œå› ä¸ºä¸€äº›çŠ¶æ€åç«¯æ˜¯å¿…é¡»è¦ä¿å­˜å†…éƒ¨æ•°æ®ç»“æ„çš„ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„è·Ÿkey-groupæ•°é‡ç›¸åŒ¹é…ï¼ˆè¿™æ˜¯å¯é‡å®šçŠ¶æ€çš„å†…éƒ¨å®ç°æœºåˆ¶ï¼‰ã€‚ é…ç½®taskmanagerslotflinké€šè¿‡å°†é¡¹ç›®åˆ†æˆtasksï¼Œæ¥å®ç°å¹¶è¡Œçš„æ‰§è¡Œé¡¹ç›®ï¼Œåˆ’åˆ†çš„tasksä¼šè¢«å‘åˆ°slotå»å¤„ç†ã€‚ é›†ç¾¤ä¸­Flinkçš„taskmanageræä¾›å¤„ç†slotã€‚Slotsæ•°é‡æœ€åˆé€‚çš„æ˜¯è·Ÿtaskmanagerçš„coresæ•°é‡æˆæ­£æ¯”ã€‚å½“ç„¶ï¼Œtaskmanager.numberOfTaskSlotsçš„æ¨èå€¼å°±æ˜¯cpuæ ¸å¿ƒçš„æ•°ç›®ã€‚ å½“å¯åŠ¨ä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¶æä¾›é»˜è®¤çš„slotæ•°ç›®ï¼Œå…¶å®ä¹Ÿå³æ˜¯flinkå·¥ç¨‹çš„å¹¶è¡Œåº¦ï¼Œè®¾ç½®æ–¹å¼åœ¨ä¸Šé¢å·²ç»æœ‰è¯¦ç»†ä»‹ç»ã€‚]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink åˆ†å¸ƒå¼ç¼“å­˜]]></title>
    <url>%2F2020%2F04%2F10%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F9-Flink%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼ç¼“å­˜Flinkæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼ç¼“å­˜ï¼Œç±»ä¼¼äºhadoopï¼Œå¯ä»¥ä½¿ç”¨æˆ·åœ¨å¹¶è¡Œå‡½æ•°ä¸­å¾ˆæ–¹ä¾¿çš„è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå¹¶æŠŠå®ƒæ”¾åœ¨taskmanagerèŠ‚ç‚¹ä¸­ï¼Œé˜²æ­¢taské‡å¤æ‹‰å–ã€‚æ­¤ç¼“å­˜çš„å·¥ä½œæœºåˆ¶å¦‚ä¸‹ï¼šç¨‹åºæ³¨å†Œä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•(æœ¬åœ°æˆ–è€…è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚hdfsæˆ–è€…s3)ï¼Œé€šè¿‡ExecutionEnvironmentæ³¨å†Œç¼“å­˜æ–‡ä»¶å¹¶ä¸ºå®ƒèµ·ä¸€ä¸ªåç§°ã€‚å½“ç¨‹åºæ‰§è¡Œï¼ŒFlinkè‡ªåŠ¨å°†æ–‡ä»¶æˆ–è€…ç›®å½•å¤åˆ¶åˆ°æ‰€æœ‰taskmanagerèŠ‚ç‚¹çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œä»…ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è¿™ä¸ªæŒ‡å®šçš„åç§°æŸ¥æ‰¾æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œç„¶åä»taskmanagerèŠ‚ç‚¹çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè®¿é—®å®ƒã€‚ ç¤ºä¾‹åœ¨ExecutionEnvironmentä¸­æ³¨å†Œä¸€ä¸ªæ–‡ä»¶ï¼š 12345//è·å–è¿è¡Œç¯å¢ƒExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();//1ï¼šæ³¨å†Œä¸€ä¸ªæ–‡ä»¶,å¯ä»¥ä½¿ç”¨hdfsä¸Šçš„æ–‡ä»¶ ä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶è¿›è¡Œæµ‹è¯•env.registerCachedFile("/Users/wangzhiwu/WorkSpace/quickstart/text","a.txt"); åœ¨ç”¨æˆ·å‡½æ•°ä¸­è®¿é—®ç¼“å­˜æ–‡ä»¶æˆ–è€…ç›®å½•(è¿™é‡Œæ˜¯ä¸€ä¸ªmapå‡½æ•°)ã€‚è¿™ä¸ªå‡½æ•°å¿…é¡»ç»§æ‰¿RichFunction,å› ä¸ºå®ƒéœ€è¦ä½¿ç”¨RuntimeContextè¯»å–æ•°æ®: 1234567891011121314151617181920212223242526DataSet&lt;String&gt; result = data.map(new RichMapFunction&lt;String, String&gt;() &#123; private ArrayList&lt;String&gt; dataList = new ArrayList&lt;String&gt;(); @Override public void open(Configuration parameters) throws Exception &#123; super.open(parameters); //2ï¼šä½¿ç”¨æ–‡ä»¶ File myFile = getRuntimeContext().getDistributedCache().getFile("a.txt"); List&lt;String&gt; lines = FileUtils.readLines(myFile); for (String line : lines) &#123; this.dataList.add(line); System.err.println("åˆ†å¸ƒå¼ç¼“å­˜ä¸º:" + line); &#125; &#125; @Override public String map(String value) throws Exception &#123; //åœ¨è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨dataList System.err.println("ä½¿ç”¨datalistï¼š" + dataList + "------------" +value); //ä¸šåŠ¡é€»è¾‘ return dataList +"ï¼š" + value; &#125; &#125;); result.printToErr(); &#125; å®Œæ•´ä»£ç å¦‚ä¸‹,ä»”ç»†çœ‹æ³¨é‡Šï¼š 123456789101112131415161718192021222324252627282930313233343536373839public class DisCacheTest &#123; public static void main(String[] args) throws Exception&#123; //è·å–è¿è¡Œç¯å¢ƒ ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); //1ï¼šæ³¨å†Œä¸€ä¸ªæ–‡ä»¶,å¯ä»¥ä½¿ç”¨hdfsä¸Šçš„æ–‡ä»¶ ä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶è¿›è¡Œæµ‹è¯• //text ä¸­æœ‰4ä¸ªå•è¯:hello flink hello FLINK env.registerCachedFile("/Users/wangzhiwu/WorkSpace/quickstart/text","a.txt"); DataSource&lt;String&gt; data = env.fromElements("a", "b", "c", "d"); DataSet&lt;String&gt; result = data.map(new RichMapFunction&lt;String, String&gt;() &#123; private ArrayList&lt;String&gt; dataList = new ArrayList&lt;String&gt;(); @Override public void open(Configuration parameters) throws Exception &#123; super.open(parameters); //2ï¼šä½¿ç”¨æ–‡ä»¶ File myFile = getRuntimeContext().getDistributedCache().getFile("a.txt"); List&lt;String&gt; lines = FileUtils.readLines(myFile); for (String line : lines) &#123; this.dataList.add(line); System.err.println("åˆ†å¸ƒå¼ç¼“å­˜ä¸º:" + line); &#125; &#125; @Override public String map(String value) throws Exception &#123; //åœ¨è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨dataList System.err.println("ä½¿ç”¨datalistï¼š" + dataList + "------------" +value); //ä¸šåŠ¡é€»è¾‘ return dataList +"ï¼š" + value; &#125; &#125;); result.printToErr(); &#125;&#125;// è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 1234[hello, flink, hello, FLINK]ï¼ša[hello, flink, hello, FLINK]ï¼šb[hello, flink, hello, FLINK]ï¼šc[hello, flink, hello, FLINK]ï¼šd]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink DataStreamAPI]]></title>
    <url>%2F2020%2F04%2F10%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F7-Flink%20DataStreamAPI%2F</url>
    <content type="text"><![CDATA[DataStreamç®—å­å°†ä¸€ä¸ªæˆ–å¤šä¸ªDataStreamè½¬æ¢ä¸ºæ–°DataStreamã€‚ç¨‹åºå¯ä»¥å°†å¤šä¸ªè½¬æ¢ç»„åˆæˆå¤æ‚çš„æ•°æ®æµæ‹“æ‰‘ã€‚DataStreamAPIå’ŒDataSetAPIä¸»è¦çš„åŒºåˆ«åœ¨äºTransformationéƒ¨åˆ†ã€‚ DataStream Transformationmap DataStreamâ†’DataStreamç”¨ä¸€ä¸ªæ•°æ®å…ƒç”Ÿæˆä¸€ä¸ªæ•°æ®å…ƒã€‚ä¸€ä¸ªmapå‡½æ•°ï¼Œå®ƒå°†è¾“å…¥æµçš„å€¼åŠ å€ï¼š 1234567DataStream&lt;Integer&gt; dataStream = //...dataStream.map(new MapFunction&lt;Integer, Integer&gt;() &#123; @Override public Integer map(Integer value) throws Exception &#123; return 2 * value; &#125;&#125;); FlatMap DataStreamâ†’DataStream é‡‡ç”¨ä¸€ä¸ªæ•°æ®å…ƒå¹¶ç”Ÿæˆé›¶ä¸ªï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å…ƒã€‚å°†å¥å­åˆ†å‰²ä¸ºå•è¯çš„flatmapå‡½æ•°ï¼š 123456789dataStream.flatMap(new FlatMapFunction&lt;String, String&gt;() &#123; @Override public void flatMap(String value, Collector&lt;String&gt; out) throws Exception &#123; for(String word: value.split(" "))&#123; out.collect(word); &#125; &#125;&#125;); Filter DataStreamâ†’DataStreamè®¡ç®—æ¯ä¸ªæ•°æ®å…ƒçš„å¸ƒå°”å‡½æ•°ï¼Œå¹¶ä¿å­˜å‡½æ•°è¿”å›trueçš„æ•°æ®å…ƒã€‚è¿‡æ»¤æ‰é›¶å€¼çš„è¿‡æ»¤å™¨ï¼š 123456dataStream.filter(new FilterFunction&lt;Integer&gt;() &#123; @Override public boolean filter(Integer value) throws Exception &#123; return value != 0; &#125;&#125;); KeyBy DataStreamâ†’KeyedStream é€»è¾‘ä¸Šå°†æµåˆ†åŒºä¸ºä¸ç›¸äº¤çš„åˆ†åŒºã€‚å…·æœ‰ç›¸åŒKeysçš„æ‰€æœ‰è®°å½•éƒ½åˆ†é…ç»™åŒä¸€åˆ†åŒºã€‚åœ¨å†…éƒ¨ï¼ŒkeyByï¼ˆï¼‰æ˜¯ä½¿ç”¨æ•£åˆ—åˆ†åŒºå®ç°çš„ã€‚æŒ‡å®šé”®æœ‰ä¸åŒçš„æ–¹æ³•ã€‚ æ­¤è½¬æ¢è¿”å›KeyedStreamï¼Œå…¶ä¸­åŒ…æ‹¬ä½¿ç”¨è¢«KeysåŒ–çŠ¶æ€æ‰€éœ€çš„KeyedStreamã€‚ 12dataStream.keyBy("someKey") // Key by field "someKey"dataStream.keyBy(0) // Key by the first element of a Tuple ğŸŒºæ³¨æ„ï¼š å¦‚æœå‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œåˆ™ç±»å‹ä¸èƒ½æˆä¸ºkeyï¼š å®ƒæ˜¯POJOç±»å‹ä½†ä¸è¦†ç›–hashCodeï¼ˆï¼‰æ–¹æ³•å¹¶ä¾èµ–äºObject.hashCodeï¼ˆï¼‰å®ç° ä»»ä½•ç±»å‹çš„æ•°ç»„ ReduceKeyedStreamâ†’DataStream å°†å½“å‰æ•°æ®å…ƒä¸æœ€åä¸€ä¸ªReduceçš„å€¼ç»„åˆå¹¶å‘å‡ºæ–°å€¼ã€‚ä¾‹å¦‚ï¼šreduceå‡½æ•°ï¼Œç”¨äºåˆ›å»ºéƒ¨åˆ†å’Œçš„æµï¼š 1234567keyedStream.reduce(new ReduceFunction&lt;Integer&gt;() &#123; @Override public Integer reduce(Integer value1, Integer value2) throws Exception &#123; return value1 + value2; &#125;&#125;); FoldKeyedStreamâ†’DataStream å…·æœ‰åˆå§‹å€¼çš„è¢«KeysåŒ–æ•°æ®æµä¸Šçš„â€œæ»šåŠ¨â€æŠ˜å ã€‚å°†å½“å‰æ•°æ®å…ƒä¸æœ€åæŠ˜å çš„å€¼ç»„åˆå¹¶å‘å‡ºæ–°å€¼ã€‚ æŠ˜å å‡½æ•°ï¼Œå½“åº”ç”¨äºåºåˆ—ï¼ˆ1,2,3,4,5ï¼‰æ—¶ï¼Œå‘å‡ºåºåˆ—â€œstart-1â€ï¼Œâ€œstart-1-2â€ï¼Œâ€œstart-1-2-3â€,. .. 1234567DataStream&lt;String&gt; result = keyedStream.fold("start", new FoldFunction&lt;Integer, String&gt;() &#123; @Override public String fold(String current, Integer value) &#123; return current + "-" + value; &#125; &#125;); èšåˆ KeyedStreamâ†’DataStream åœ¨è¢«KeysåŒ–æ•°æ®æµä¸Šæ»šåŠ¨èšåˆã€‚minå’ŒminByä¹‹é—´çš„å·®å¼‚æ˜¯minè¿”å›æœ€å°å€¼ï¼Œè€ŒminByè¿”å›è¯¥å­—æ®µä¸­å…·æœ‰æœ€å°å€¼çš„æ•°æ®å…ƒ(maxå’ŒmaxByç›¸åŒ)ã€‚ 12345678910keyedStream.sum(0);keyedStream.sum("key");keyedStream.min(0);keyedStream.min("key");keyedStream.max(0);keyedStream.max("key");keyedStream.minBy(0);keyedStream.minBy("key");keyedStream.maxBy(0);keyedStream.maxBy("key"); Windowå‡½æ•°å…³äºFlinkçš„çª—å£æ¦‚å¿µï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢æœ‰è¯¦ç»†ä»‹ç»ã€‚ WindowKeyedStreamâ†’WindowedStream å¯ä»¥åœ¨å·²ç»åˆ†åŒºçš„KeyedStreamä¸Šå®šä¹‰Windowsã€‚Windowsæ ¹æ®æŸäº›ç‰¹å¾ï¼ˆä¾‹å¦‚ï¼Œåœ¨æœ€å5ç§’å†…åˆ°è¾¾çš„æ•°æ®ï¼‰å¯¹æ¯ä¸ªKeysä¸­çš„æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚ 123dataStream.keyBy(0).window(TumblingEventTimeWindows.of(Time.seconds(5))); // Last 5 seconds of data Window ApplyWindowedStreamâ†’DataStreamAllWindowedStreamâ†’DataStream å°†ä¸€èˆ¬å‡½æ•°åº”ç”¨äºæ•´ä¸ªçª—å£ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ‰‹åŠ¨æ±‚å’Œçª—å£æ•°æ®å…ƒçš„å‡½æ•°ã€‚ æ³¨æ„ï¼šå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨windowAllè½¬æ¢ï¼Œåˆ™éœ€è¦ä½¿ç”¨AllWindowFunctionã€‚ 12345678910111213141516171819202122232425windowedStream.apply (new WindowFunction&lt;Tuple2&lt;String,Integer&gt;, Integer, Tuple, Window&gt;() &#123; public void apply (Tuple tuple, Window window, Iterable&lt;Tuple2&lt;String, Integer&gt;&gt; values, Collector&lt;Integer&gt; out) throws Exception &#123; int sum = 0; for (value t: values) &#123; sum += t.f1; &#125; out.collect (new Integer(sum)); &#125;&#125;);// applying an AllWindowFunction on non-keyed window streamallWindowedStream.apply (new AllWindowFunction&lt;Tuple2&lt;String,Integer&gt;, Integer, Window&gt;() &#123; public void apply (Window window, Iterable&lt;Tuple2&lt;String, Integer&gt;&gt; values, Collector&lt;Integer&gt; out) throws Exception &#123; int sum = 0; for (value t: values) &#123; sum += t.f1; &#125; out.collect (new Integer(sum)); &#125;&#125;); Window ReduceWindowedStreamâ†’DataStream å°†reduceå‡½æ•°åº”ç”¨äºçª—å£å¹¶è¿”å›reduceåçš„å€¼ã€‚ 12345windowedStream.reduce (new ReduceFunction&lt;Tuple2&lt;String,Integer&gt;&gt;() &#123; public Tuple2&lt;String, Integer&gt; reduce(Tuple2&lt;String, Integer&gt; value1, Tuple2&lt;String, Integer&gt; value2) throws Exception &#123; return new Tuple2&lt;String,Integer&gt;(value1.f0, value1.f1 + value2.f1); &#125;&#125;); æå–æ—¶é—´æˆ³ å…³äºTimeæˆ‘ä»¬åœ¨åé¢æœ‰ä¸“é—¨çš„ç« èŠ‚è¿›è¡Œä»‹ç» DataStreamâ†’DataStream ä»è®°å½•ä¸­æå–æ—¶é—´æˆ³ï¼Œä»¥ä¾¿ä½¿ç”¨ä½¿ç”¨äº‹ä»¶æ—¶é—´è¯­ä¹‰çš„çª—å£ã€‚ 1stream.assignTimestamps (new TimeStampExtractor() &#123;...&#125;); Partition åˆ†åŒº è‡ªå®šä¹‰åˆ†åŒºDataStreamâ†’DataStreamä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„åˆ†åŒºç¨‹åºä¸ºæ¯ä¸ªæ•°æ®å…ƒé€‰æ‹©ç›®æ ‡ä»»åŠ¡ã€‚ 12dataStream.partitionCustom(partitioner, "someKey");dataStream.partitionCustom(partitioner, 0); éšæœºåˆ†åŒºDataStreamâ†’DataStreamæ ¹æ®å‡åŒ€åˆ†å¸ƒéšæœºåˆ†é…æ•°æ®å…ƒã€‚ 1dataStream.shuffle(); Rebalance ï¼ˆå¾ªç¯åˆ†åŒºï¼‰DataStreamâ†’DataStreamåˆ†åŒºæ•°æ®å…ƒå¾ªç¯ï¼Œæ¯ä¸ªåˆ†åŒºåˆ›å»ºç›¸ç­‰çš„è´Ÿè½½ã€‚åœ¨å­˜åœ¨æ•°æ®å€¾æ–œæ—¶ç”¨äºæ€§èƒ½ä¼˜åŒ–ã€‚ 1dataStream.rebalance(); rescaleDataStreamâ†’DataStream å¦‚æœä¸Šæ¸¸ ç®—å­æ“ä½œå…·æœ‰å¹¶è¡Œæ€§2å¹¶ä¸”ä¸‹æ¸¸ç®—å­æ“ä½œå…·æœ‰å¹¶è¡Œæ€§6ï¼Œåˆ™ä¸€ä¸ªä¸Šæ¸¸ ç®—å­æ“ä½œå°†åˆ†é…å…ƒä»¶åˆ°ä¸‰ä¸ªä¸‹æ¸¸ç®—å­æ“ä½œï¼Œè€Œå¦ä¸€ä¸ªä¸Šæ¸¸ç®—å­æ“ä½œå°†åˆ†é…åˆ°å…¶ä»–ä¸‰ä¸ªä¸‹æ¸¸ ç®—å­æ“ä½œã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸‹æ¸¸ç®—å­æ“ä½œå…·æœ‰å¹¶è¡Œæ€§2è€Œä¸Šæ¸¸ ç®—å­æ“ä½œå…·æœ‰å¹¶è¡Œæ€§6ï¼Œåˆ™ä¸‰ä¸ªä¸Šæ¸¸ ç®—å­æ“ä½œå°†åˆ†é…åˆ°ä¸€ä¸ªä¸‹æ¸¸ç®—å­æ“ä½œï¼Œè€Œå…¶ä»–ä¸‰ä¸ªä¸Šæ¸¸ç®—å­æ“ä½œå°†åˆ†é…åˆ°å¦ä¸€ä¸ªä¸‹æ¸¸ç®—å­æ“ä½œã€‚ åœ¨ä¸åŒå¹¶è¡Œåº¦ä¸æ˜¯å½¼æ­¤çš„å€æ•°çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªä¸‹æ¸¸ ç®—å­æ“ä½œå°†å…·æœ‰æ¥è‡ªä¸Šæ¸¸ ç®—å­æ“ä½œçš„ä¸åŒæ•°é‡çš„è¾“å…¥ã€‚ è¯·å‚é˜…æ­¤å›¾ä»¥è·å–ä¸Šä¾‹ä¸­è¿æ¥æ¨¡å¼çš„å¯è§†åŒ–ï¼š 1dataStream.rescale(); å¹¿æ’­DataStreamâ†’DataStreamå‘æ¯ä¸ªåˆ†åŒºå¹¿æ’­æ•°æ®å…ƒã€‚ 1dataStream.broadcast();]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink DataSetAPI]]></title>
    <url>%2F2020%2F04%2F10%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F6-Flink%20DataSetAPI%2F</url>
    <content type="text"><![CDATA[ç¼–ç¨‹ç»“æ„1234567891011121314151617181920public class SocketTextStreamWordCount &#123; public static void main(String[] args) throws Exception &#123; if (args.length != 2)&#123;System.err.println("USAGE:\nSocketTextStreamWordCount &lt;hostname&gt; &lt;port&gt;"); return; &#125; String hostName = args[0]; Integer port = Integer.parseInt(args[1]); final StreamExecutionEnvironment env = StreamExecutionEnvironment .getExecutionEnvironment(); DataStream&lt;String&gt; text = env.socketTextStream(hostName, port); DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; counts = text.flatMap(new LineSplitter()) .keyBy(0) .sum(1); counts.print(); env.execute("Java WordCount from SocketTextStream Example"); &#125; ä¸Šé¢çš„SocketTextStreamWordCountæ˜¯ä¸€ä¸ªå…¸å‹çš„Flinkç¨‹åºï¼Œä»–ç”±ä¸€ä¸‹åŠæ ¼éƒ¨åˆ†æ„æˆï¼š è·å¾—ä¸€ä¸ªexecution environmentï¼Œ åŠ è½½/åˆ›å»ºåˆå§‹æ•°æ®ï¼Œ æŒ‡å®šæ­¤æ•°æ®çš„è½¬æ¢ï¼Œ æŒ‡å®šæ”¾ç½®è®¡ç®—ç»“æœçš„ä½ç½®ï¼Œ è§¦å‘ç¨‹åºæ‰§è¡Œ DataSet APIåˆ†ç±»ï¼š Source: æ•°æ®æºåˆ›å»ºåˆå§‹æ•°æ®é›†ï¼Œä¾‹å¦‚æ¥è‡ªæ–‡ä»¶æˆ–Javaé›†åˆ Transformation: æ•°æ®è½¬æ¢å°†ä¸€ä¸ªæˆ–å¤šä¸ªDataSetè½¬æ¢ä¸ºæ–°çš„DataSet Sink: å°†è®¡ç®—ç»“æœå­˜å‚¨æˆ–è¿”å› DataSet SourcesåŸºäºæ–‡ä»¶çš„ readTextFile(path)/ TextInputFormat- æŒ‰è¡Œè¯»å–æ–‡ä»¶å¹¶å°†å…¶ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚ readTextFileWithValue(path)/ TextValueInputFormat- æŒ‰è¡Œè¯»å–æ–‡ä»¶å¹¶å°†å®ƒä»¬ä½œä¸ºStringValuesè¿”å›ã€‚StringValuesæ˜¯å¯å˜å­—ç¬¦ä¸²ã€‚ readCsvFile(path)/ CsvInputFormat- è§£æé€—å·ï¼ˆæˆ–å…¶ä»–å­—ç¬¦ï¼‰åˆ†éš”å­—æ®µçš„æ–‡ä»¶ã€‚è¿”å›å…ƒç»„æˆ–POJOçš„DataSetã€‚æ”¯æŒåŸºæœ¬javaç±»å‹åŠå…¶Valueå¯¹åº”ä½œä¸ºå­—æ®µç±»å‹ã€‚ readFileOfPrimitives(path, Class)/ PrimitiveInputFormat- è§£ææ–°è¡Œï¼ˆæˆ–å…¶ä»–å­—ç¬¦åºåˆ—ï¼‰åˆ†éš”çš„åŸå§‹æ•°æ®ç±»å‹ï¼ˆå¦‚Stringæˆ–ï¼‰çš„æ–‡ä»¶Integerã€‚ readFileOfPrimitives(path, delimiter, Class)/ PrimitiveInputFormat- è§£ææ–°è¡Œï¼ˆæˆ–å…¶ä»–å­—ç¬¦åºåˆ—ï¼‰åˆ†éš”çš„åŸå§‹æ•°æ®ç±»å‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚Stringæˆ–Integerä½¿ç”¨ç»™å®šçš„åˆ†éš”ç¬¦ã€‚ readSequenceFile(Key, Value, path)/ SequenceFileInputFormat- åˆ›å»ºä¸€ä¸ªJobConfå¹¶ä»ç±»å‹ä¸ºSequenceFileInputFormatï¼ŒKey classå’ŒValueç±»çš„æŒ‡å®šè·¯å¾„ä¸­è¯»å–æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºTuple2 &lt;Keyï¼ŒValue&gt;è¿”å›ã€‚ åŸºäºé›†åˆ fromCollection(Collection) - ä»Java Java.util.Collectionåˆ›å»ºæ•°æ®é›†ã€‚é›†åˆä¸­çš„æ‰€æœ‰æ•°æ®å…ƒå¿…é¡»å±äºåŒä¸€ç±»å‹ã€‚ fromCollection(Iterator, Class) - ä»è¿­ä»£å™¨åˆ›å»ºæ•°æ®é›†ã€‚è¯¥ç±»æŒ‡å®šè¿­ä»£å™¨è¿”å›çš„æ•°æ®å…ƒçš„æ•°æ®ç±»å‹ã€‚ fromElements(T ...) - æ ¹æ®ç»™å®šçš„å¯¹è±¡åºåˆ—åˆ›å»ºæ•°æ®é›†ã€‚æ‰€æœ‰å¯¹è±¡å¿…é¡»å±äºåŒä¸€ç±»å‹ã€‚ fromParallelCollection(SplittableIterator, Class)- å¹¶è¡Œåœ°ä»è¿­ä»£å™¨åˆ›å»ºæ•°æ®é›†ã€‚è¯¥ç±»æŒ‡å®šè¿­ä»£å™¨è¿”å›çš„æ•°æ®å…ƒçš„æ•°æ®ç±»å‹ã€‚ generateSequence(from, to) - å¹¶è¡Œç”Ÿæˆç»™å®šé—´éš”ä¸­çš„æ•°å­—åºåˆ—ã€‚ é€šç”¨æ–¹æ³• readFile(inputFormat, path)/ FileInputFormat- æ¥å—æ–‡ä»¶è¾“å…¥æ ¼å¼ã€‚ createInput(inputFormat)/ InputFormat- æ¥å—é€šç”¨è¾“å…¥æ ¼å¼ã€‚ ä»£ç ç¤ºä¾‹123456789101112131415161718192021222324252627282930313233ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();// ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè¯»DataSet&lt;String&gt; localLines = env.readTextFile("file:///path/to/my/textfile");// è¯»å–HDFSæ–‡ä»¶DataSet&lt;String&gt; hdfsLines = env.readTextFile("hdfs://nnHost:nnPort/path/to/my/textfile");// è¯»å–CSVæ–‡ä»¶DataSet&lt;Tuple3&lt;Integer, String, Double&gt;&gt; csvInput = env.readCsvFile("hdfs:///the/CSV/file").types(Integer.class, String.class, Double.class);// è¯»å–CSVæ–‡ä»¶ä¸­çš„éƒ¨åˆ†ï¼Œå­—æ®µé€‰æ‹©1ä»£è¡¨é€‰æ‹©ï¼Œ0ä»£è¡¨å¼ƒç”¨DataSet&lt;Tuple2&lt;String, Double&gt;&gt; csvInput = env.readCsvFile("hdfs:///the/CSV/file").includeFields("10010").types(String.class, Double.class);// è¯»å–CSVæ˜ å°„ä¸ºä¸€ä¸ªjavaç±»DataSet&lt;Person&gt;&gt; csvInput = env.readCsvFile("hdfs:///the/CSV/file").pojoType(Person.class, "name", "age", "zipcode");// è¯»å–ä¸€ä¸ªæŒ‡å®šä½ç½®åºåˆ—åŒ–åçš„æ–‡ä»¶DataSet&lt;Tuple2&lt;IntWritable, Text&gt;&gt; tuples = env.readSequenceFile(IntWritable.class, Text.class, "hdfs://nnHost:nnPort/path/to/file");// ä»è¾“å…¥å­—ç¬¦åˆ›å»ºDataSet&lt;String&gt; value = env.fromElements("Foo", "bar", "foobar", "fubar");// åˆ›å»ºä¸€ä¸ªæ•°å­—åºåˆ—DataSet&lt;Long&gt; numbers = env.generateSequence(1, 10000000);// ä»å…³ç³»å‹æ•°æ®åº“è¯»å–DataSet&lt;Tuple2&lt;String, Integer&gt; dbData =env.createInput(JDBCInputFormat.buildJDBCInputFormat() .setDrivername("org.apache.derby.jdbc.EmbeddedDriver") .setDBUrl("jdbc:derby:memory:persons").setQuery("select name, age from persons").setRowTypeInfo(new RowTypeInfo(BasicTypeInfo.STRING_TYPE_INFO, BasicTypeInfo.INT_TYPE_INFO)).finish()); DataSet Transformation è¯¦ç»†å¯ä»¥å‚è€ƒå®˜ç½‘:https://flink.sojb.cn/dev/batch/dataset_transformations.html#filter Map é‡‡ç”¨ä¸€ä¸ªæ•°æ®å…ƒå¹¶ç”Ÿæˆä¸€ä¸ªæ•°æ®å…ƒã€‚ 123data.map(new MapFunction&lt;String, Integer&gt;() &#123; public Integer map(String value) &#123; return Integer.parseInt(value); &#125;&#125;); FlatMap é‡‡ç”¨ä¸€ä¸ªæ•°æ®å…ƒå¹¶ç”Ÿæˆé›¶ä¸ªï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å…ƒã€‚ 1234567data.flatMap(new FlatMapFunction&lt;String, String&gt;() &#123; public void flatMap(String value, Collector&lt;String&gt; out) &#123; for (String s : value.split(" ")) &#123; out.collect(s); &#125; &#125;&#125;); MapPartition åœ¨å•ä¸ªå‡½æ•°è°ƒç”¨ä¸­è½¬æ¢å¹¶è¡Œåˆ†åŒºã€‚è¯¥å‡½æ•°å°†åˆ†åŒºä½œä¸ºIterableæµæ¥è·å–ï¼Œå¹¶ä¸”å¯ä»¥ç”Ÿæˆä»»æ„æ•°é‡çš„ç»“æœå€¼ã€‚æ¯ä¸ªåˆ†åŒºä¸­çš„æ•°æ®å…ƒæ•°é‡å–å†³äºå¹¶è¡Œåº¦å’Œå…ˆå‰çš„ ç®—å­æ“ä½œã€‚ 123456789data.mapPartition(new MapPartitionFunction&lt;String, Long&gt;() &#123; public void mapPartition(Iterable&lt;String&gt; values, Collector&lt;Long&gt; out) &#123; long c = 0; for (String s : values) &#123; c++; &#125; out.collect(c); &#125;&#125;); Filter è®¡ç®—æ¯ä¸ªæ•°æ®å…ƒçš„å¸ƒå°”å‡½æ•°ï¼Œå¹¶ä¿å­˜å‡½æ•°è¿”å›trueçš„æ•°æ®å…ƒã€‚é‡è¦ä¿¡æ¯ï¼šç³»ç»Ÿå‡å®šè¯¥å‡½æ•°ä¸ä¼šä¿®æ”¹åº”ç”¨è°“è¯çš„æ•°æ®å…ƒã€‚è¿åæ­¤å‡è®¾å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯çš„ç»“æœã€‚ 123data.filter(new FilterFunction&lt;Integer&gt;() &#123; public boolean filter(Integer value) &#123; return value &gt; 1000; &#125;&#125;); Reduce é€šè¿‡å°†ä¸¤ä¸ªæ•°æ®å…ƒé‡å¤ç»„åˆæˆä¸€ä¸ªæ•°æ®å…ƒï¼Œå°†ä¸€ç»„æ•°æ®å…ƒç»„åˆæˆä¸€ä¸ªæ•°æ®å…ƒã€‚Reduceå¯ä»¥åº”ç”¨äºå®Œæ•´æ•°æ®é›†æˆ–åˆ†ç»„æ•°æ®é›†ã€‚ 123data.reduce(new ReduceFunction&lt;Integer&gt; &#123; public Integer reduce(Integer a, Integer b) &#123; return a + b; &#125;&#125;); å¦‚æœå°†reduceåº”ç”¨äºåˆ†ç»„æ•°æ®é›†ï¼Œåˆ™å¯ä»¥é€šè¿‡æä¾›CombineHint æ¥æŒ‡å®šè¿è¡Œæ—¶æ‰§è¡Œreduceçš„ç»„åˆé˜¶æ®µçš„æ–¹å¼ setCombineHintã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒåŸºäºæ•£åˆ—çš„ç­–ç•¥åº”è¯¥æ›´å¿«ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä¸åŒé”®çš„æ•°é‡ä¸è¾“å…¥æ•°æ®å…ƒçš„æ•°é‡ç›¸æ¯”è¾ƒå°ï¼ˆä¾‹å¦‚1/10ï¼‰ã€‚ ReduceGroup å°†ä¸€ç»„æ•°æ®å…ƒç»„åˆæˆä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å…ƒã€‚ReduceGroupå¯ä»¥åº”ç”¨äºå®Œæ•´æ•°æ®é›†æˆ–åˆ†ç»„æ•°æ®é›†ã€‚ 123456789data.reduceGroup(new GroupReduceFunction&lt;Integer, Integer&gt; &#123; public void reduce(Iterable&lt;Integer&gt; values, Collector&lt;Integer&gt; out) &#123; int prefixSum = 0; for (Integer i : values) &#123; prefixSum += i; out.collect(prefixSum); &#125; &#125;&#125;); Aggregate å°†ä¸€ç»„å€¼èšåˆä¸ºå•ä¸ªå€¼ã€‚èšåˆå‡½æ•°å¯ä»¥è¢«è®¤ä¸ºæ˜¯å†…ç½®çš„reduceå‡½æ•°ã€‚èšåˆå¯ä»¥åº”ç”¨äºå®Œæ•´æ•°æ®é›†æˆ–åˆ†ç»„æ•°æ®é›†ã€‚ 12Dataset&lt;Tuple3&lt;Integer, String, Double&gt;&gt; input = // [...]DataSet&lt;Tuple3&lt;Integer, String, Double&gt;&gt; output = input.aggregate(SUM, 0).and(MIN, 2); æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ç®€å†™è¯­æ³•è¿›è¡Œæœ€å°ï¼Œæœ€å¤§å’Œæ€»å’Œèšåˆã€‚ 12Dataset&lt;Tuple3&lt;Integer, String, Double&gt;&gt; input = // [...]DataSet&lt;Tuple3&lt;Integer, String, Double&gt;&gt; output = input.sum(0).andMin(2); Distinct è¿”å›æ•°æ®é›†çš„ä¸åŒæ•°æ®å…ƒã€‚å®ƒç›¸å¯¹äºæ•°æ®å…ƒçš„æ‰€æœ‰å­—æ®µæˆ–å­—æ®µå­é›†ä»è¾“å…¥DataSetä¸­åˆ é™¤é‡å¤æ¡ç›®ã€‚ 1data.distinct(); ä½¿ç”¨reduceå‡½æ•°å®ç°Distinctã€‚æ‚¨å¯ä»¥é€šè¿‡æä¾›CombineHint æ¥æŒ‡å®šè¿è¡Œæ—¶æ‰§è¡Œreduceçš„ç»„åˆé˜¶æ®µçš„æ–¹å¼ setCombineHintã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒåŸºäºæ•£åˆ—çš„ç­–ç•¥åº”è¯¥æ›´å¿«ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä¸åŒé”®çš„æ•°é‡ä¸è¾“å…¥æ•°æ®å…ƒçš„æ•°é‡ç›¸æ¯”è¾ƒå°ï¼ˆä¾‹å¦‚1/10ï¼‰ã€‚ Join é€šè¿‡åˆ›å»ºåœ¨å…¶é”®ä¸Šç›¸ç­‰çš„æ‰€æœ‰æ•°æ®å…ƒå¯¹æ¥è¿æ¥ä¸¤ä¸ªæ•°æ®é›†ã€‚å¯é€‰åœ°ä½¿ç”¨JoinFunctionå°†æ•°æ®å…ƒå¯¹è½¬æ¢ä¸ºå•ä¸ªæ•°æ®å…ƒï¼Œæˆ–ä½¿ç”¨FlatJoinFunctionå°†æ•°æ®å…ƒå¯¹è½¬æ¢ä¸ºä»»æ„å¤šä¸ªï¼ˆåŒ…æ‹¬æ— ï¼‰æ•°æ®å…ƒã€‚è¯·å‚é˜…é”®éƒ¨åˆ†ä»¥äº†è§£å¦‚ä½•å®šä¹‰è¿æ¥é”®ã€‚ 123result = input1.join(input2) .where(0) // key of the first input (tuple field 0) .equalTo(1); // key of the second input (tuple field 1) æ‚¨å¯ä»¥é€šè¿‡Join HintsæŒ‡å®šè¿è¡Œæ—¶æ‰§è¡Œè¿æ¥çš„æ–¹å¼ã€‚æç¤ºæè¿°äº†é€šè¿‡åˆ†åŒºæˆ–å¹¿æ’­è¿›è¡Œè¿æ¥ï¼Œä»¥åŠå®ƒæ˜¯ä½¿ç”¨åŸºäºæ’åºè¿˜æ˜¯åŸºäºæ•£åˆ—çš„ç®—æ³•ã€‚å¦‚æœæœªæŒ‡å®šæç¤ºï¼Œç³»ç»Ÿå°†å°è¯•ä¼°ç®—è¾“å…¥å¤§å°ï¼Œå¹¶æ ¹æ®è¿™äº›ä¼°è®¡é€‰æ‹©æœ€ä½³ç­–ç•¥ã€‚ 1234// This executes a join by broadcasting the first data set// using a hash table for the broadcast dataresult = input1.join(input2, JoinHint.BROADCAST_HASH_FIRST) .where(0).equalTo(1); è¯·æ³¨æ„ï¼Œè¿æ¥è½¬æ¢ä»…é€‚ç”¨äºç­‰è¿æ¥ã€‚å…¶ä»–è¿æ¥ç±»å‹éœ€è¦ä½¿ç”¨OuterJoinæˆ–CoGroupè¡¨ç¤ºã€‚ OuterJoin åœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸Šæ‰§è¡Œå·¦ï¼Œå³æˆ–å…¨å¤–è¿æ¥ã€‚å¤–è¿æ¥ç±»ä¼¼äºå¸¸è§„ï¼ˆå†…éƒ¨ï¼‰è¿æ¥ï¼Œå¹¶åˆ›å»ºåœ¨å…¶é”®ä¸Šç›¸ç­‰çš„æ‰€æœ‰æ•°æ®å…ƒå¯¹ã€‚æ­¤å¤–ï¼Œå¦‚æœåœ¨å¦ä¸€ä¾§æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„Keysï¼Œåˆ™ä¿å­˜â€œå¤–éƒ¨â€ä¾§ï¼ˆå·¦ä¾§ï¼Œå³ä¾§æˆ–ä¸¤è€…éƒ½æ»¡ï¼‰çš„è®°å½•ã€‚åŒ¹é…æ•°æ®å…ƒå¯¹ï¼ˆæˆ–ä¸€ä¸ªæ•°æ®å…ƒå’Œnullå¦ä¸€ä¸ªè¾“å…¥çš„å€¼ï¼‰è¢«èµ‹äºˆJoinFunctionä»¥å°†æ•°æ®å…ƒå¯¹è½¬æ¢ä¸ºå•ä¸ªæ•°æ®å…ƒï¼Œæˆ–è€…è½¬æ¢ä¸ºFlatJoinFunctionä»¥å°†æ•°æ®å…ƒå¯¹è½¬æ¢ä¸ºä»»æ„å¤šä¸ªï¼ˆåŒ…æ‹¬æ— ï¼‰æ•°æ®å…ƒã€‚è¯·å‚é˜…é”®éƒ¨åˆ†ä»¥äº†è§£å¦‚ä½•å®šä¹‰è¿æ¥é”®ã€‚ 1234567891011input1.leftOuterJoin(input2) // rightOuterJoin or fullOuterJoin for right or full outer joins .where(0) // key of the first input (tuple field 0) .equalTo(1) // key of the second input (tuple field 1) .with(new JoinFunction&lt;String, String, String&gt;() &#123; public String join(String v1, String v2) &#123; // NOTE: // - v2 might be null for leftOuterJoin // - v1 might be null for rightOuterJoin // - v1 OR v2 might be null for fullOuterJoin &#125; &#125;); CoGroup reduce ç®—å­æ“ä½œçš„äºŒç»´å˜ä½“ã€‚å°†ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µä¸Šçš„æ¯ä¸ªè¾“å…¥åˆ†ç»„ï¼Œç„¶åå…³è”ç»„ã€‚æ¯å¯¹ç»„è°ƒç”¨è½¬æ¢å‡½æ•°ã€‚ 12345678data1.coGroup(data2) .where(0) .equalTo(1) .with(new CoGroupFunction&lt;String, String, String&gt;() &#123; public void coGroup(Iterable&lt;String&gt; in1, Iterable&lt;String&gt; in2, Collector&lt;String&gt; out) &#123; out.collect(...); &#125; &#125;); Cross æ„å»ºä¸¤ä¸ªè¾“å…¥çš„ç¬›å¡å°”ç§¯ï¼ˆäº¤å‰ä¹˜ç§¯ï¼‰ï¼Œåˆ›å»ºæ‰€æœ‰æ•°æ®å…ƒå¯¹ã€‚å¯é€‰æ‹©ä½¿ç”¨CrossFunctionå°†æ•°æ®å…ƒå¯¹è½¬æ¢ä¸ºå•ä¸ªæ•°æ®å…ƒ 123DataSet&lt;Integer&gt; data1 = // [...]DataSet&lt;String&gt; data2 = // [...]DataSet&lt;Tuple2&lt;Integer, String&gt;&gt; result = data1.cross(data2); æ³¨ï¼šäº¤å‰æ˜¯ä¸€ä¸ªæ½œåœ¨çš„éå¸¸è®¡ç®—å¯†é›†å‹ ç®—å­æ“ä½œå®ƒç”šè‡³å¯ä»¥æŒ‘æˆ˜å¤§çš„è®¡ç®—é›†ç¾¤ï¼å»ºè®®ä½¿ç”¨crossWithTinyï¼ˆï¼‰å’ŒcrossWithHugeï¼ˆï¼‰æ¥æç¤ºç³»ç»Ÿçš„DataSetå¤§å°ã€‚ Union ç”Ÿæˆä¸¤ä¸ªæ•°æ®é›†çš„å¹¶é›†ã€‚ 123DataSet&lt;String&gt; data1 = // [...]DataSet&lt;String&gt; data2 = // [...]DataSet&lt;String&gt; result = data1.union(data2); Rebalance å‡åŒ€åœ°Rebalance æ•°æ®é›†çš„å¹¶è¡Œåˆ†åŒºä»¥æ¶ˆé™¤æ•°æ®åå·®ã€‚åªæœ‰ç±»ä¼¼Mapçš„è½¬æ¢å¯èƒ½ä¼šéµå¾ªRebalance è½¬æ¢ã€‚ 123DataSet&lt;String&gt; in = // [...]DataSet&lt;String&gt; result = in.rebalance() .map(new Mapper()); Hash-Partition æ•£åˆ—åˆ†åŒºç»™å®šé”®ä¸Šçš„æ•°æ®é›†ã€‚é”®å¯ä»¥æŒ‡å®šä¸ºä½ç½®é”®ï¼Œè¡¨è¾¾é”®å’Œé”®é€‰æ‹©å™¨å‡½æ•°ã€‚ 123DataSet&lt;Tuple2&lt;String,Integer&gt;&gt; in = // [...]DataSet&lt;Integer&gt; result = in.partitionByHash(0) .mapPartition(new PartitionMapper()); Range-Partition Range-Partitionç»™å®šé”®ä¸Šçš„æ•°æ®é›†ã€‚é”®å¯ä»¥æŒ‡å®šä¸ºä½ç½®é”®ï¼Œè¡¨è¾¾é”®å’Œé”®é€‰æ‹©å™¨å‡½æ•°ã€‚ 123DataSet&lt;Tuple2&lt;String,Integer&gt;&gt; in = // [...]DataSet&lt;Integer&gt; result = in.partitionByRange(0) .mapPartition(new PartitionMapper()); Custom Partitioning æ‰‹åŠ¨æŒ‡å®šæ•°æ®åˆ†åŒºã€‚æ³¨æ„ï¼šæ­¤æ–¹æ³•ä»…é€‚ç”¨äºå•ä¸ªå­—æ®µé”®ã€‚ 12DataSet&lt;Tuple2&lt;String,Integer&gt;&gt; in = // [...]DataSet&lt;Integer&gt; result = in.partitionCustom(Partitioner&lt;K&gt; partitioner, key) Sort Partition æœ¬åœ°æŒ‰æŒ‡å®šé¡ºåºå¯¹æŒ‡å®šå­—æ®µä¸Šçš„æ•°æ®é›†çš„æ‰€æœ‰åˆ†åŒºè¿›è¡Œæ’åºã€‚å¯ä»¥å°†å­—æ®µæŒ‡å®šä¸ºå…ƒç»„ä½ç½®æˆ–å­—æ®µè¡¨è¾¾å¼ã€‚é€šè¿‡é“¾æ¥sortPartitionï¼ˆï¼‰è°ƒç”¨æ¥å®Œæˆå¯¹å¤šä¸ªå­—æ®µçš„æ’åºã€‚ 123DataSet&lt;Tuple2&lt;String,Integer&gt;&gt; in = // [...]DataSet&lt;Integer&gt; result = in.sortPartition(1, Order.ASCENDING) .mapPartition(new PartitionMapper()); First-n è¿”å›æ•°æ®é›†çš„å‰nä¸ªï¼ˆä»»æ„ï¼‰æ•°æ®å…ƒã€‚First-nå¯ä»¥åº”ç”¨äºå¸¸è§„æ•°æ®é›†ï¼Œåˆ†ç»„æ•°æ®é›†æˆ–åˆ†ç»„æ’åºæ•°æ®é›†ã€‚åˆ†ç»„é”®å¯ä»¥æŒ‡å®šä¸ºé”®é€‰æ‹©å™¨å‡½æ•°æˆ–å­—æ®µä½ç½®é”®ã€‚ 1234567DataSet&lt;Tuple2&lt;String,Integer&gt;&gt; in = // [...]// regular data setDataSet&lt;Tuple2&lt;String,Integer&gt;&gt; result1 = in.first(3);// grouped data setDataSet&lt;Tuple2&lt;String,Integer&gt;&gt; result2 = in.groupBy(0) .first(3);// grouped-sorted data setDataSet&lt;Tuple2&lt;String,Integer&gt;&gt; result3 = in.groupBy(0) .sortGroup(1, Order.ASCENDING) .first(3); DataSet Sinkæ•°æ®æ¥æ”¶å™¨ä½¿ç”¨DataSetç”¨äºå­˜å‚¨æˆ–è¿”å›ã€‚ä½¿ç”¨OutputFormatæè¿°æ•°æ®æ¥æ”¶å™¨ç®—å­æ“ä½œ ã€‚Flinkå¸¦æœ‰å„ç§å†…ç½®è¾“å‡ºæ ¼å¼ï¼Œè¿™äº›æ ¼å¼å°è£…åœ¨DataSetä¸Šçš„ç®—å­æ“ä½œä¸­ï¼š writeAsText()/ TextOutputFormat- æŒ‰å­—ç¬¦ä¸²é¡ºåºå†™å…¥æ•°æ®å…ƒã€‚é€šè¿‡è°ƒç”¨æ¯ä¸ªæ•°æ®å…ƒçš„toStringï¼ˆï¼‰æ–¹æ³•è·å¾—å­—ç¬¦ä¸²ã€‚ writeAsFormattedText()/ TextOutputFormat- æŒ‰å­—ç¬¦ä¸²é¡ºåºå†™æ•°æ®å…ƒã€‚é€šè¿‡ä¸ºæ¯ä¸ªæ•°æ®å…ƒè°ƒç”¨ç”¨æˆ·å®šä¹‰çš„formatï¼ˆï¼‰æ–¹æ³•æ¥è·å–å­—ç¬¦ä¸²ã€‚ writeAsCsv(â€¦)/ CsvOutputFormat- å°†å…ƒç»„å†™ä¸ºé€—å·åˆ†éš”å€¼æ–‡ä»¶ã€‚è¡Œå’Œå­—æ®µåˆ†éš”ç¬¦æ˜¯å¯é…ç½®çš„ã€‚æ¯ä¸ªå­—æ®µçš„å€¼æ¥è‡ªå¯¹è±¡çš„toStringï¼ˆï¼‰æ–¹æ³•ã€‚ print()/ printToErr()/ print(String msg)/ printToErr(String msg)- åœ¨æ ‡å‡†è¾“å‡º/æ ‡å‡†é”™è¯¯æµä¸Šæ‰“å°æ¯ä¸ªæ•°æ®å…ƒçš„toStringï¼ˆï¼‰å€¼ã€‚å¯é€‰åœ°ï¼Œå¯ä»¥æä¾›å‰ç¼€ï¼ˆmsgï¼‰ï¼Œå…¶å‰ç¼€ä¸ºè¾“å‡ºã€‚è¿™æœ‰åŠ©äºåŒºåˆ†ä¸åŒçš„æ‰“å°è°ƒç”¨ã€‚å¦‚æœå¹¶è¡Œåº¦å¤§äº1ï¼Œåˆ™è¾“å‡ºä¹Ÿå°†ä¸ç”Ÿæˆè¾“å‡ºçš„ä»»åŠ¡çš„æ ‡è¯†ç¬¦ä¸€èµ·æ·»åŠ ã€‚ write()/ FileOutputFormat- è‡ªå®šä¹‰æ–‡ä»¶è¾“å‡ºçš„æ–¹æ³•å’ŒåŸºç±»ã€‚æ”¯æŒè‡ªå®šä¹‰å¯¹è±¡åˆ°å­—èŠ‚çš„è½¬æ¢ã€‚ output()/ OutputFormat- å¤§å¤šæ•°é€šç”¨è¾“å‡ºæ–¹æ³•ï¼Œç”¨äºéåŸºäºæ–‡ä»¶çš„æ•°æ®æ¥æ”¶å™¨ï¼ˆä¾‹å¦‚å°†ç»“æœå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼‰ã€‚ å¯ä»¥å°†DataSetè¾“å…¥åˆ°å¤šä¸ª ç®—å­æ“ä½œã€‚ç¨‹åºå¯ä»¥ç¼–å†™æˆ–æ‰“å°æ•°æ®é›†ï¼ŒåŒæ—¶å¯¹å®ƒä»¬æ‰§è¡Œå…¶ä»–è½¬æ¢ã€‚ ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526// text dataDataSet&lt;String&gt; textData = // [...]// write DataSet to a file on the local file systemtextData.writeAsText("file:///my/result/on/localFS");// write DataSet to a file on a HDFS with a namenode running at nnHost:nnPorttextData.writeAsText("hdfs://nnHost:nnPort/my/result/on/localFS");// write DataSet to a file and overwrite the file if it existstextData.writeAsText("file:///my/result/on/localFS", WriteMode.OVERWRITE);// tuples as lines with pipe as the separator "a|b|c"DataSet&lt;Tuple3&lt;String, Integer, Double&gt;&gt; values = // [...]values.writeAsCsv("file:///path/to/the/result/file", "\n", "|");// this writes tuples in the text formatting "(a, b, c)", rather than as CSV linesvalues.writeAsText("file:///path/to/the/result/file");// this writes values as strings using a user-defined TextFormatter objectvalues.writeAsFormattedText("file:///path/to/the/result/file", new TextFormatter&lt;Tuple2&lt;Integer, Integer&gt;&gt;() &#123; public String format (Tuple2&lt;Integer, Integer&gt; value) &#123; return value.f1 + " - " + value.f0; &#125; &#125;); ä½¿ç”¨è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼ï¼š 1234567891011DataSet&lt;Tuple3&lt;String, Integer, Double&gt;&gt; myResult = [...]// write Tuple DataSet to a relational databasemyResult.output( // build and configure OutputFormat JDBCOutputFormat.buildJDBCOutputFormat() .setDrivername("org.apache.derby.jdbc.EmbeddedDriver") .setDBUrl("jdbc:derby:memory:persons") .setQuery("insert into persons (name, age, height) values (?,?,?)") .finish() ); åºåˆ—åŒ–å™¨ Flinkè‡ªå¸¦äº†é’ˆå¯¹è¯¸å¦‚intï¼Œlongï¼ŒStringç­‰æ ‡å‡†ç±»å‹çš„åºåˆ—åŒ–å™¨ é’ˆå¯¹Flinkæ— æ³•å®ç°åºåˆ—åŒ–çš„æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥äº¤ç»™Avroå’ŒKryo ä½¿ç”¨æ–¹æ³•ï¼šExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); 123ä½¿ç”¨avroåºåˆ—åŒ–ï¼šenv.getConfig().enableForceAvro();ä½¿ç”¨kryoåºåˆ—åŒ–ï¼šenv.getConfig().enableForceKryo();ä½¿ç”¨è‡ªå®šä¹‰åºåˆ—åŒ–ï¼šenv.getConfig().addDefaultKryoSerializer(Class&lt;?&gt; type, Class&lt;? extends Serializer&lt;?&gt;&gt; serializerClass) æ•°æ®ç±»å‹ Java Tuple å’Œ Scala case class Java POJOsï¼šjavaå®ä½“ç±» Primitive Typesé»˜è®¤æ”¯æŒjavaå’ŒscalaåŸºæœ¬æ•°æ®ç±»å‹ General Class Typesé»˜è®¤æ”¯æŒå¤§å¤šæ•°javaå’Œscala class Hadoop Writablesæ”¯æŒhadoopä¸­å®ç°äº†org.apache.hadoop.Writableçš„æ•°æ®ç±»å‹ Special Typesä¾‹å¦‚scalaä¸­çš„Either Option å’ŒTry]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink é‡å¯ç­–ç•¥]]></title>
    <url>%2F2020%2F04%2F10%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F8-Flink%20%E9%87%8D%E5%90%AF%E7%AD%96%E7%95%A5%2F</url>
    <content type="text"><![CDATA[Flinkçš„é‡å¯ç­–ç•¥Flinkæ”¯æŒä¸åŒçš„é‡å¯ç­–ç•¥ï¼Œè¿™äº›é‡å¯ç­–ç•¥æ§åˆ¶ç€jobå¤±è´¥åå¦‚ä½•é‡å¯ã€‚é›†ç¾¤å¯ä»¥é€šè¿‡é»˜è®¤çš„é‡å¯ç­–ç•¥æ¥é‡å¯ï¼Œè¿™ä¸ªé»˜è®¤çš„é‡å¯ç­–ç•¥é€šå¸¸åœ¨æœªæŒ‡å®šé‡å¯ç­–ç•¥çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œè€Œå¦‚æœJobæäº¤çš„æ—¶å€™æŒ‡å®šäº†é‡å¯ç­–ç•¥ï¼Œè¿™ä¸ªé‡å¯ç­–ç•¥å°±ä¼šè¦†ç›–æ‰é›†ç¾¤çš„é»˜è®¤é‡å¯ç­–ç•¥ã€‚ æ¦‚è§ˆé»˜è®¤çš„é‡å¯ç­–ç•¥æ˜¯é€šè¿‡Flinkçš„flink-conf.yamlæ¥æŒ‡å®šçš„ï¼Œè¿™ä¸ªé…ç½®å‚æ•°restart-strategyå®šä¹‰äº†å“ªç§ç­–ç•¥ä¼šè¢«é‡‡ç”¨ã€‚å¦‚æœcheckpointæœªå¯åŠ¨ï¼Œå°±ä¼šé‡‡ç”¨no restartç­–ç•¥ï¼Œå¦‚æœå¯åŠ¨äº†checkpointæœºåˆ¶ï¼Œä½†æ˜¯æœªæŒ‡å®šé‡å¯ç­–ç•¥çš„è¯ï¼Œå°±ä¼šé‡‡ç”¨fixed-delayç­–ç•¥ï¼Œé‡è¯•Integer.MAX_VALUEæ¬¡ã€‚è¯·å‚è€ƒä¸‹é¢çš„å¯ç”¨é‡å¯ç­–ç•¥æ¥äº†è§£å“ªäº›å€¼æ˜¯æ”¯æŒçš„ã€‚ æ¯ä¸ªé‡å¯ç­–ç•¥éƒ½æœ‰è‡ªå·±çš„å‚æ•°æ¥æ§åˆ¶å®ƒçš„è¡Œä¸ºï¼Œè¿™äº›å€¼ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼Œæ¯ä¸ªé‡å¯ç­–ç•¥çš„æè¿°éƒ½åŒ…å«ç€å„è‡ªçš„é…ç½®å€¼ä¿¡æ¯ã€‚ é‡å¯ç­–ç•¥ é‡å¯ç­–ç•¥å€¼ Fixed delay fixed-delay Failure rate failure-rate No restart None é™¤äº†å®šä¹‰ä¸€ä¸ªé»˜è®¤çš„é‡å¯ç­–ç•¥ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ä¸ºæ¯ä¸€ä¸ªJobæŒ‡å®šå®ƒè‡ªå·±çš„é‡å¯ç­–ç•¥ï¼Œè¿™ä¸ªé‡å¯ç­–ç•¥å¯ä»¥åœ¨ExecutionEnvironmentä¸­è°ƒç”¨setRestartStrategy()æ–¹æ³•æ¥ç¨‹åºåŒ–åœ°è°ƒç”¨ï¼Œä¸»æ„è¿™ç§æ–¹å¼åŒæ ·é€‚ç”¨äºStreamExecutionEnvironmentã€‚ ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•ä¸ºæˆ‘ä»¬çš„Jobè®¾ç½®ä¸€ä¸ªå›ºå®šå»¶è¿Ÿé‡å¯ç­–ç•¥ï¼Œä¸€æ—¦æœ‰å¤±è´¥ï¼Œç³»ç»Ÿå°±ä¼šå°è¯•æ¯10ç§’é‡å¯ä¸€æ¬¡ï¼Œé‡å¯3æ¬¡ã€‚ Javaä»£ç  12345ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();env.setRestartStrategy(RestartStrategies.fixedDelayRestart( 3, // å°è¯•é‡å¯æ¬¡æ•° Time.of(10, TimeUnit.SECONDS) // å»¶è¿Ÿæ—¶é—´é—´éš”)); Scalaä»£ç : 12345val env = ExecutionEnvironment.getExecutionEnvironment()env.setRestartStrategy(RestartStrategies.fixedDelayRestart( 3, // é‡å¯æ¬¡æ•° Time.of(10, TimeUnit.SECONDS) // å»¶è¿Ÿæ—¶é—´é—´éš”)) é‡å¯ç­–ç•¥ä¸‹é¢éƒ¨åˆ†æè¿°äº†é‡å¯ç­–ç•¥ç‰¹å®šçš„é…ç½®é¡¹ å›ºå®šå»¶è¿Ÿé‡å¯ç­–ç•¥(Fixed Delay Restart Strategy)å›ºå®šå»¶è¿Ÿé‡å¯ç­–ç•¥ä¼šå°è¯•ä¸€ä¸ªç»™å®šçš„æ¬¡æ•°æ¥é‡å¯Jobï¼Œå¦‚æœè¶…è¿‡äº†æœ€å¤§çš„é‡å¯æ¬¡æ•°ï¼ŒJobæœ€ç»ˆå°†å¤±è´¥ã€‚åœ¨è¿ç»­çš„ä¸¤æ¬¡é‡å¯å°è¯•ä¹‹é—´ï¼Œé‡å¯ç­–ç•¥ä¼šç­‰å¾…ä¸€ä¸ªå›ºå®šçš„æ—¶é—´ã€‚ é‡å¯ç­–ç•¥å¯ä»¥é…ç½®flink-conf.yamlçš„ä¸‹é¢é…ç½®å‚æ•°æ¥å¯ç”¨ï¼Œä½œä¸ºé»˜è®¤çš„é‡å¯ç­–ç•¥: 1restart-strategy: fixed-delay é…ç½®å‚æ•° æè¿° é»˜è®¤å€¼ restart-strategy.fixed-delay.attempts åœ¨Jobæœ€ç»ˆå®£å‘Šå¤±è´¥ä¹‹å‰ï¼ŒFlinkå°è¯•æ‰§è¡Œçš„æ¬¡æ•° 1ï¼Œå¦‚æœå¯ç”¨checkpointçš„è¯æ˜¯Integer.MAX_VALUE restart-strategy.fixed-delay.delay å»¶è¿Ÿé‡å¯æ„å‘³ç€ä¸€ä¸ªæ‰§è¡Œå¤±è´¥ä¹‹åï¼Œå¹¶ä¸ä¼šç«‹å³é‡å¯ï¼Œè€Œæ˜¯è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚ akka.ask.timeout,å¦‚æœå¯ç”¨checkpointçš„è¯æ˜¯1s ä¾‹å­: 12restart-strategy.fixed-delay.attempts: 3restart-strategy.fixed-delay.delay: 10 s å›ºå®šå»¶è¿Ÿé‡å¯ä¹Ÿå¯ä»¥åœ¨ç¨‹åºä¸­è®¾ç½®: Javaä»£ç : 12345ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();env.setRestartStrategy(RestartStrategies.fixedDelayRestart( 3, // é‡å¯æ¬¡æ•° Time.of(10, TimeUnit.SECONDS) // é‡å¯æ—¶é—´é—´éš”)); Scalaä»£ç : 12345val env = ExecutionEnvironment.getExecutionEnvironment()env.setRestartStrategy(RestartStrategies.fixedDelayRestart( 3, // é‡å¯æ¬¡æ•° Time.of(10, TimeUnit.SECONDS) // é‡å¯æ—¶é—´é—´éš”)) å¤±è´¥ç‡é‡å¯ç­–ç•¥å¤±è´¥ç‡é‡å¯ç­–ç•¥åœ¨Jobå¤±è´¥åä¼šé‡å¯ï¼Œä½†æ˜¯è¶…è¿‡å¤±è´¥ç‡åï¼ŒJobä¼šæœ€ç»ˆè¢«è®¤å®šå¤±è´¥ã€‚åœ¨ä¸¤ä¸ªè¿ç»­çš„é‡å¯å°è¯•ä¹‹é—´ï¼Œé‡å¯ç­–ç•¥ä¼šç­‰å¾…ä¸€ä¸ªå›ºå®šçš„æ—¶é—´ã€‚ å¤±è´¥ç‡é‡å¯ç­–ç•¥å¯ä»¥åœ¨flink-conf.yamlä¸­è®¾ç½®ä¸‹é¢çš„é…ç½®å‚æ•°æ¥å¯ç”¨: 1restart-strategy:failure-rate é…ç½®å‚æ•° æè¿° é»˜è®¤å€¼ restart-strategy.failure-rate.max-failures-per-interval åœ¨ä¸€ä¸ªJobè®¤å®šä¸ºå¤±è´¥ä¹‹å‰ï¼Œæœ€å¤§çš„é‡å¯æ¬¡æ•° 1 restart-strategy.failure-rate.failure-rate-interval è®¡ç®—å¤±è´¥ç‡çš„æ—¶é—´é—´éš” 1åˆ†é’Ÿ restart-strategy.failure-rate.delay ä¸¤æ¬¡è¿ç»­é‡å¯å°è¯•ä¹‹é—´çš„æ—¶é—´é—´éš” akka.ask.timeout 123restart-strategy.failure-rate.max-failures-per-interval: 3restart-strategy.failure-rate.failure-rate-interval: 5 minrestart-strategy.failure-rate.delay: 10 s å¤±è´¥ç‡é‡å¯ç­–ç•¥ä¹Ÿå¯ä»¥åœ¨ç¨‹åºä¸­è®¾ç½®: Javaä»£ç : 123456ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();env.setRestartStrategy(RestartStrategies.failureRateRestart( 3, // æ¯ä¸ªæµ‹é‡æ—¶é—´é—´éš”æœ€å¤§å¤±è´¥æ¬¡æ•° Time.of(5, TimeUnit.MINUTES), //å¤±è´¥ç‡æµ‹é‡çš„æ—¶é—´é—´éš” Time.of(10, TimeUnit.SECONDS) // ä¸¤æ¬¡è¿ç»­é‡å¯å°è¯•çš„æ—¶é—´é—´éš”)); Scalaä»£ç : 123456val env = ExecutionEnvironment.getExecutionEnvironment()env.setRestartStrategy(RestartStrategies.failureRateRestart( 3, // æ¯ä¸ªæµ‹é‡æ—¶é—´é—´éš”æœ€å¤§å¤±è´¥æ¬¡æ•° Time.of(5, TimeUnit.MINUTES), //å¤±è´¥ç‡æµ‹é‡çš„æ—¶é—´é—´éš” Time.of(10, TimeUnit.SECONDS) // ä¸¤æ¬¡è¿ç»­é‡å¯å°è¯•çš„æ—¶é—´é—´éš”)) æ— é‡å¯ç­–ç•¥Jobç›´æ¥å¤±è´¥ï¼Œä¸ä¼šå°è¯•è¿›è¡Œé‡å¯ 1restart-strategy: none æ— é‡å¯ç­–ç•¥ä¹Ÿå¯ä»¥åœ¨ç¨‹åºä¸­è®¾ç½® Javaä»£ç : 12ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();env.setRestartStrategy(RestartStrategies.noRestart()); Scalaä»£ç : 12val env = ExecutionEnvironment.getExecutionEnvironment()env.setRestartStrategy(RestartStrategies.noRestart())]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink é›†ç¾¤éƒ¨ç½²]]></title>
    <url>%2F2020%2F04%2F09%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F5-Flink%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[ä¸€ã€éƒ¨ç½²æ¨¡å¼Flink æ”¯æŒä½¿ç”¨å¤šç§éƒ¨ç½²æ¨¡å¼æ¥æ»¡è¶³ä¸åŒè§„æ¨¡åº”ç”¨çš„éœ€æ±‚ï¼Œå¸¸è§çš„æœ‰å•æœºæ¨¡å¼ï¼ŒStandalone Cluster æ¨¡å¼ï¼ŒåŒæ—¶ Flink ä¹Ÿæ”¯æŒéƒ¨ç½²åœ¨å…¶ä»–ç¬¬ä¸‰æ–¹å¹³å°ä¸Šï¼Œå¦‚ YARNï¼ŒMesosï¼ŒDockerï¼ŒKubernetes ç­‰ã€‚ä»¥ä¸‹ä¸»è¦ä»‹ç»å…¶å•æœºæ¨¡å¼å’Œ Standalone Cluster æ¨¡å¼çš„éƒ¨ç½²ã€‚ äºŒã€å•æœºæ¨¡å¼å•æœºæ¨¡å¼æ˜¯ä¸€ç§å¼€ç®±å³ç”¨çš„æ¨¡å¼ï¼Œå¯ä»¥åœ¨å•å°æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œé€‚ç”¨äºæ—¥å¸¸çš„å¼€å‘å’Œè°ƒè¯•ã€‚å…·ä½“æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š 2.1 å®‰è£…éƒ¨ç½²1. å‰ç½®æ¡ä»¶ Flink çš„è¿è¡Œä¾èµ– JAVA ç¯å¢ƒï¼Œæ•…éœ€è¦é¢„å…ˆå®‰è£…å¥½ JDKï¼Œå…·ä½“æ­¥éª¤å¯ä»¥å‚è€ƒï¼šLinux ç¯å¢ƒä¸‹ JDK å®‰è£… 2. ä¸‹è½½ &amp; è§£å‹ &amp; è¿è¡Œ Flink æ‰€æœ‰ç‰ˆæœ¬çš„å®‰è£…åŒ…å¯ä»¥ç›´æ¥ä»å…¶å®˜ç½‘è¿›è¡Œä¸‹è½½ï¼Œè¿™é‡Œæˆ‘ä¸‹è½½çš„ Flink çš„ç‰ˆæœ¬ä¸º 1.9.1 ï¼Œè¦æ±‚çš„ JDK ç‰ˆæœ¬ä¸º 1.8.x +ã€‚ ä¸‹è½½åè§£å‹åˆ°æŒ‡å®šç›®å½•ï¼š 1tar -zxvf flink-1.9.1-bin-scala_2.12.tgz -C /usr/app ä¸éœ€è¦è¿›è¡Œä»»ä½•é…ç½®ï¼Œç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°±å¯ä»¥å¯åŠ¨å•æœºç‰ˆæœ¬çš„ Flinkï¼š 1bin/start-cluster.sh 3. WEB UI ç•Œé¢ Flink æä¾›äº† WEB ç•Œé¢ç”¨äºç›´è§‚çš„ç®¡ç† Flink é›†ç¾¤ï¼Œè®¿é—®ç«¯å£ä¸º 8081ï¼š Flink çš„ WEB UI ç•Œé¢æ”¯æŒå¤§å¤šæ•°å¸¸ç”¨åŠŸèƒ½ï¼Œå¦‚æäº¤ä½œä¸šï¼Œå–æ¶ˆä½œä¸šï¼ŒæŸ¥çœ‹å„ä¸ªèŠ‚ç‚¹è¿è¡Œæƒ…å†µï¼ŒæŸ¥çœ‹ä½œä¸šæ‰§è¡Œæƒ…å†µç­‰ï¼Œå¤§å®¶å¯ä»¥åœ¨éƒ¨ç½²å®Œæˆåï¼Œè¿›å…¥è¯¥é¡µé¢è¿›è¡Œè¯¦ç»†çš„æµè§ˆã€‚ 2.2 ä½œä¸šæäº¤å¯åŠ¨åå¯ä»¥è¿è¡Œå®‰è£…åŒ…ä¸­è‡ªå¸¦çš„è¯é¢‘ç»Ÿè®¡æ¡ˆä¾‹ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š 1. å¼€å¯ç«¯å£ 1nc -lk 9999 2. æäº¤ä½œä¸š 1bin/flink run examples/streaming/SocketWindowWordCount.jar --port 9999 è¯¥ JAR åŒ…çš„æºç å¯ä»¥åœ¨ Flink å®˜æ–¹çš„ GitHub ä»“åº“ä¸­æ‰¾åˆ°ï¼Œåœ°å€ä¸º ï¼šSocketWindowWordCount ï¼Œå¯é€‰ä¼ å‚æœ‰ hostnameï¼Œ portï¼Œå¯¹åº”çš„è¯é¢‘æ•°æ®éœ€è¦ä½¿ç”¨ç©ºæ ¼è¿›è¡Œåˆ†å‰²ã€‚ 3. è¾“å…¥æµ‹è¯•æ•°æ® 1a a b b c c c a e 4. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º å¯ä»¥é€šè¿‡ WEB UI çš„æ§åˆ¶å°æŸ¥çœ‹ä½œä¸šç»Ÿè¿è¡Œæƒ…å†µï¼š ä¹Ÿå¯ä»¥é€šè¿‡ WEB æ§åˆ¶å°æŸ¥çœ‹åˆ°ç»Ÿè®¡ç»“æœï¼š 2.3 åœæ­¢ä½œä¸šå¯ä»¥ç›´æ¥åœ¨ WEB ç•Œé¢ä¸Šç‚¹å‡»å¯¹åº”ä½œä¸šçš„ Cancel Job æŒ‰é’®è¿›è¡Œå–æ¶ˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œå–æ¶ˆã€‚ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œå–æ¶ˆæ—¶ï¼Œéœ€è¦å…ˆè·å–åˆ°ä½œä¸šçš„ JobIdï¼Œå¯ä»¥ä½¿ç”¨ flink list å‘½ä»¤æŸ¥çœ‹ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š 123456[root@hadoop001 flink-1.9.1]# ./bin/flink listWaiting for response...------------------ Running/Restarting Jobs -------------------05.11.2019 08:19:53 : ba2b1cc41a5e241c32d574c93de8a2bc : Socket Window WordCount (RUNNING)--------------------------------------------------------------No scheduled jobs. è·å–åˆ° JobId åï¼Œå°±å¯ä»¥ä½¿ç”¨ flink cancel å‘½ä»¤å–æ¶ˆä½œä¸šï¼š 1bin/flink cancel ba2b1cc41a5e241c32d574c93de8a2bc 2.4 åœæ­¢ Flinkå‘½ä»¤å¦‚ä¸‹ï¼š 1bin/stop-cluster.sh ä¸‰ã€Standalone ClusterStandalone Cluster æ¨¡å¼æ˜¯ Flink è‡ªå¸¦çš„ä¸€ç§é›†ç¾¤æ¨¡å¼ï¼Œå…·ä½“é…ç½®æ­¥éª¤å¦‚ä¸‹ï¼š 3.1 å‰ç½®æ¡ä»¶ä½¿ç”¨è¯¥æ¨¡å¼å‰ï¼Œéœ€è¦ç¡®ä¿æ‰€æœ‰æœåŠ¡å™¨é—´éƒ½å·²ç»é…ç½®å¥½ SSH å…å¯†ç™»å½•æœåŠ¡ã€‚è¿™é‡Œæˆ‘ä»¥ä¸‰å°æœåŠ¡å™¨ä¸ºä¾‹ï¼Œä¸»æœºååˆ†åˆ«ä¸º hadoop001ï¼Œhadoop002ï¼Œhadoop003 , å…¶ä¸­ hadoop001 ä¸º master èŠ‚ç‚¹ï¼Œå…¶ä½™ä¸¤å°ä¸º slave èŠ‚ç‚¹ï¼Œæ­å»ºæ­¥éª¤å¦‚ä¸‹ï¼š 3.2 æ­å»ºæ­¥éª¤ä¿®æ”¹ conf/flink-conf.yaml ä¸­ jobmanager èŠ‚ç‚¹çš„é€šè®¯åœ°å€ä¸º hadoop001: 1jobmanager.rpc.address: hadoop001 ä¿®æ”¹ conf/slaves é…ç½®æ–‡ä»¶ï¼Œå°† hadoop002 å’Œ hadoop003 é…ç½®ä¸º slave èŠ‚ç‚¹ï¼š 12hadoop002hadoop003 å°†é…ç½®å¥½çš„ Flink å®‰è£…åŒ…åˆ†å‘åˆ°å…¶ä»–ä¸¤å°æœåŠ¡å™¨ä¸Šï¼š 12scp -r /usr/app/flink-1.9.1 hadoop002:/usr/appscp -r /usr/app/flink-1.9.1 hadoop003:/usr/app åœ¨ hadoop001 ä¸Šä½¿ç”¨å’Œå•æœºæ¨¡å¼ç›¸åŒçš„å‘½ä»¤æ¥å¯åŠ¨é›†ç¾¤ï¼š 1bin/start-cluster.sh æ­¤æ—¶æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š å¯åŠ¨å®Œæˆåå¯ä»¥ä½¿ç”¨ Jps å‘½ä»¤æˆ–è€…é€šè¿‡ WEB ç•Œé¢æ¥æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸã€‚ 3.3 å¯é€‰é…ç½®é™¤äº†ä¸Šé¢ä»‹ç»çš„ jobmanager.rpc.address æ˜¯å¿…é€‰é…ç½®å¤–ï¼ŒFlink hè¿˜æ”¯æŒä½¿ç”¨å…¶ä»–å¯é€‰å‚æ•°æ¥ä¼˜åŒ–é›†ç¾¤æ€§èƒ½ï¼Œä¸»è¦å¦‚ä¸‹ï¼š jobmanager.heap.sizeï¼šJobManager çš„ JVM å †å†…å­˜å¤§å°ï¼Œé»˜è®¤ä¸º 1024m ã€‚ taskmanager.heap.sizeï¼šTaskmanager çš„ JVM å †å†…å­˜å¤§å°ï¼Œé»˜è®¤ä¸º 1024m ã€‚ taskmanager.numberOfTaskSlotsï¼šTaskmanager ä¸Š slots çš„æ•°é‡ï¼Œé€šå¸¸è®¾ç½®ä¸º CPU æ ¸å¿ƒçš„æ•°é‡ï¼Œæˆ–å…¶ä¸€åŠã€‚ parallelism.defaultï¼šä»»åŠ¡é»˜è®¤çš„å¹¶è¡Œåº¦ã€‚ io.tmp.dirsï¼šå­˜å‚¨ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰é…ç½®ï¼Œåˆ™é»˜è®¤é‡‡ç”¨æœåŠ¡å™¨çš„ä¸´æ—¶ç›®å½•ï¼Œå¦‚ LInux çš„ /tmp ç›®å½•ã€‚ æ›´å¤šé…ç½®å¯ä»¥å‚è€ƒ Flink çš„å®˜æ–¹æ‰‹å†Œï¼šConfiguration 4.3 å¸¸è§å¼‚å¸¸å¦‚æœè¿›ç¨‹æ²¡æœ‰å¯åŠ¨ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹ log ç›®å½•ä¸‹çš„æ—¥å¿—æ¥å®šä½é”™è¯¯ï¼Œå¸¸è§çš„ä¸€ä¸ªé”™è¯¯å¦‚ä¸‹ï¼š 12345678910112019-11-05 09:18:35,877 INFO org.apache.flink.runtime.entrypoint.ClusterEntrypoint - Shutting StandaloneSessionClusterEntrypoint down with application status FAILED. Diagnosticsjava.io.IOException: Could not create FileSystem for highly available storage (high-availability.storageDir).......Caused by: org.apache.flink.core.fs.UnsupportedFileSystemSchemeException: Could not find a file system implementation for scheme 'hdfs'. The scheme is not directly supported by Flink and no Hadoop file system to support this scheme could be loaded......Caused by: org.apache.flink.core.fs.UnsupportedFileSystemSchemeException: Hadoop is not in the classpath/dependencies....... å¯ä»¥çœ‹åˆ°æ˜¯å› ä¸ºåœ¨ classpath ç›®å½•ä¸‹æ‰¾ä¸åˆ° Hadoop çš„ç›¸å…³ä¾èµ–ï¼Œæ­¤æ—¶éœ€è¦æ£€æŸ¥æ˜¯å¦åœ¨ç¯å¢ƒå˜é‡ä¸­é…ç½®äº† Hadoop çš„å®‰è£…è·¯å¾„ï¼Œå¦‚æœè·¯å¾„å·²ç»é…ç½®ä½†ä»ç„¶å­˜åœ¨ä¸Šé¢çš„é—®é¢˜ï¼Œå¯ä»¥ä» Flink å®˜ç½‘ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ Hadoop ç»„ä»¶åŒ…ï¼š ä¸‹è½½å®Œæˆåï¼Œå°†è¯¥ JAR åŒ…ä¸Šä¼ è‡³æ‰€æœ‰ Flink å®‰è£…ç›®å½•çš„ lib ç›®å½•å³å¯ã€‚ å››ã€On YarnYarnçš„ç®€ä»‹ï¼š ResourceManagerResourceManager è´Ÿè´£æ•´ä¸ªé›†ç¾¤çš„èµ„æºç®¡ç†å’Œåˆ†é…ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€çš„èµ„æºç®¡ç†ç³»ç»Ÿã€‚ NodeManager ä»¥å¿ƒè·³çš„æ–¹å¼å‘ ResourceManager æ±‡æŠ¥èµ„æºä½¿ç”¨æƒ…å†µï¼ˆç›®å‰ä¸»è¦æ˜¯ CPU å’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼‰ã€‚RM åªæ¥å— NM çš„èµ„æºå›æŠ¥ä¿¡æ¯ï¼Œå¯¹äºå…·ä½“çš„èµ„æºå¤„ç†åˆ™äº¤ç»™ NM è‡ªå·±å¤„ç†ã€‚ NodeManagerNodeManager æ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„èµ„æºå’Œä»»åŠ¡ç®¡ç†å™¨ï¼Œå®ƒæ˜¯ç®¡ç†è¿™å°æœºå™¨çš„ä»£ç†ï¼Œè´Ÿè´£è¯¥èŠ‚ç‚¹ç¨‹åºçš„è¿è¡Œï¼Œä»¥åŠè¯¥èŠ‚ç‚¹èµ„æºçš„ç®¡ç†å’Œç›‘æ§ã€‚YARN é›†ç¾¤æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œä¸€ä¸ªNodeManagerã€‚NodeManager å®šæ—¶å‘ ResourceManager æ±‡æŠ¥æœ¬èŠ‚ç‚¹èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰çš„ä½¿ç”¨æƒ…å†µå’ŒContainer çš„è¿è¡ŒçŠ¶æ€ã€‚å½“ ResourceManager å®•æœºæ—¶ NodeManager è‡ªåŠ¨è¿æ¥ RM å¤‡ç”¨èŠ‚ç‚¹ã€‚NodeManager æ¥æ”¶å¹¶å¤„ç†æ¥è‡ª ApplicationMaster çš„ Container å¯åŠ¨ã€åœæ­¢ç­‰å„ç§è¯·æ±‚ã€‚ ApplicationMasterè´Ÿè´£ä¸ RM è°ƒåº¦å™¨åå•†ä»¥è·å–èµ„æºï¼ˆç”¨ Container è¡¨ç¤ºï¼‰ã€‚å°†å¾—åˆ°çš„ä»»åŠ¡è¿›ä¸€æ­¥åˆ†é…ç»™å†…éƒ¨çš„ä»»åŠ¡(èµ„æºçš„äºŒæ¬¡åˆ†é…)ã€‚ä¸ NM é€šä¿¡ä»¥å¯åŠ¨/åœæ­¢ä»»åŠ¡ã€‚ç›‘æ§æ‰€æœ‰ä»»åŠ¡è¿è¡ŒçŠ¶æ€ï¼Œå¹¶åœ¨ä»»åŠ¡è¿è¡Œå¤±è´¥æ—¶é‡æ–°ä¸ºä»»åŠ¡ç”³è¯·èµ„æºä»¥é‡å¯ä»»åŠ¡ Flink on yarn é›†ç¾¤å¯åŠ¨æ­¥éª¤ æ­¥éª¤1 ç”¨æˆ·å‘YARNä¸­æäº¤åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…æ‹¬ApplicationMasterç¨‹åºã€å¯åŠ¨ApplicationMasterçš„å‘½ä»¤ã€ç”¨æˆ·ç¨‹åºç­‰ã€‚ æ­¥éª¤2 ResourceManagerä¸ºè¯¥åº”ç”¨ç¨‹åºåˆ†é…ç¬¬ä¸€ä¸ªContainerï¼Œå¹¶ä¸å¯¹åº”çš„Node-Manageré€šä¿¡ï¼Œè¦æ±‚å®ƒåœ¨è¿™ä¸ªContainerä¸­å¯åŠ¨åº”ç”¨ç¨‹åºçš„ApplicationMasterã€‚ æ­¥éª¤3 ApplicationMasteré¦–å…ˆå‘ResourceManageræ³¨å†Œï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡ResourceManageræŸ¥çœ‹åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œç„¶åå®ƒå°†ä¸ºå„ä¸ªä»»åŠ¡ç”³è¯·èµ„æºï¼Œå¹¶ç›‘æ§å®ƒçš„è¿è¡ŒçŠ¶æ€ï¼Œç›´åˆ°è¿è¡Œç»“æŸï¼Œå³é‡å¤æ­¥éª¤4~7ã€‚ æ­¥éª¤4 ApplicationMasteré‡‡ç”¨è½®è¯¢çš„æ–¹å¼é€šè¿‡RPCåè®®å‘ResourceManagerç”³è¯·å’Œé¢†å–èµ„æºã€‚ æ­¥éª¤5 ä¸€æ—¦ApplicationMasterç”³è¯·åˆ°èµ„æºåï¼Œä¾¿ä¸å¯¹åº”çš„NodeManageré€šä¿¡ï¼Œè¦æ±‚å®ƒå¯åŠ¨ä»»åŠ¡ã€‚ æ­¥éª¤6 NodeManagerä¸ºä»»åŠ¡è®¾ç½®å¥½è¿è¡Œç¯å¢ƒï¼ˆåŒ…æ‹¬ç¯å¢ƒå˜é‡ã€JARåŒ…ã€äºŒè¿›åˆ¶ç¨‹åºç­‰ï¼‰åï¼Œå°†ä»»åŠ¡å¯åŠ¨å‘½ä»¤å†™åˆ°ä¸€ä¸ªè„šæœ¬ä¸­ï¼Œå¹¶é€šè¿‡è¿è¡Œè¯¥è„šæœ¬å¯åŠ¨ä»»åŠ¡ã€‚ æ­¥éª¤7 å„ä¸ªä»»åŠ¡é€šè¿‡æŸä¸ªRPCåè®®å‘ApplicationMasteræ±‡æŠ¥è‡ªå·±çš„çŠ¶æ€å’Œè¿›åº¦ï¼Œä»¥è®©ApplicationMasteréšæ—¶æŒæ¡å„ä¸ªä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œä»è€Œå¯ä»¥åœ¨ä»»åŠ¡å¤±è´¥æ—¶é‡æ–°å¯åŠ¨ä»»åŠ¡ã€‚ åœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å¯éšæ—¶é€šè¿‡RPCå‘ApplicationMasteræŸ¥è¯¢åº”ç”¨ç¨‹åºçš„å½“å‰è¿è¡ŒçŠ¶æ€ã€‚ æ­¥éª¤8 åº”ç”¨ç¨‹åºè¿è¡Œå®Œæˆåï¼ŒApplicationMasterå‘ResourceManageræ³¨é”€å¹¶å…³é—­è‡ªå·± on yarn é›†ç¾¤éƒ¨ç½²è®¾ç½®Hadoopç¯å¢ƒå˜é‡ï¼š 12[root@hadoop2 flink-1.7.2]# vi /etc/profileexport HADOOP_CONF_DIR=è¿™é‡Œæ˜¯ä½ è‡ªå·±çš„hadoopè·¯å¾„ bin/yarn-session.sh -h æŸ¥çœ‹ä½¿ç”¨æ–¹æ³•: åœ¨å¯åŠ¨çš„æ˜¯å¯ä»¥æŒ‡å®šTaskManagerçš„ä¸ªæ•°ä»¥åŠå†…å­˜(é»˜è®¤æ˜¯1G)ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šJobManagerçš„å†…å­˜ï¼Œä½†æ˜¯JobManagerçš„ä¸ªæ•°åªèƒ½æ˜¯ä¸€ä¸ª æˆ‘ä»¬å¼€å¯åŠ¨ä¸€ä¸ªYARN sessionï¼š 1./bin/yarn-session.sh -n 4 -tm 8192 -s 8 ä¸Šé¢å‘½ä»¤å¯åŠ¨äº†4ä¸ªTaskManagerï¼Œæ¯ä¸ªTaskManagerå†…å­˜ä¸º8Gä¸”å ç”¨äº†8ä¸ªæ ¸(æ˜¯æ¯ä¸ªTaskManagerï¼Œé»˜è®¤æ˜¯1ä¸ªæ ¸)ã€‚åœ¨å¯åŠ¨YARN sessionçš„æ—¶å€™ä¼šåŠ è½½conf/flink-config.yamlé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å»ä¿®æ”¹é‡Œé¢çš„ç›¸å…³å‚æ•°. YARN sessionå¯åŠ¨ä¹‹åå°±å¯ä»¥ä½¿ç”¨bin/flinkæ¥å¯åŠ¨æäº¤ä½œä¸š: ä¾‹å¦‚ï¼š 1./bin/flink run -c com.demo.wangzhiwu.WordCount $DEMO_DIR/target/flink-demo-1.0.SNAPSHOT.jar --port 9000 flink runçš„ç”¨æ³•å¦‚ä¸‹ï¼š 1234567ç”¨æ³•: run [OPTIONS] &lt;jar-file&gt; &lt;arguments&gt; &quot;run&quot; æ“ä½œå‚æ•°: -c,--class &lt;classname&gt; å¦‚æœæ²¡æœ‰åœ¨jaråŒ…ä¸­æŒ‡å®šå…¥å£ç±»ï¼Œåˆ™éœ€è¦åœ¨è¿™é‡Œé€šè¿‡è¿™ä¸ªå‚æ•°æŒ‡å®š -m,--jobmanager &lt;host:port&gt; æŒ‡å®šéœ€è¦è¿æ¥çš„jobmanager(ä¸»èŠ‚ç‚¹)åœ°å€ ä½¿ç”¨è¿™ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šä¸€ä¸ªä¸åŒäºé…ç½®æ–‡ä»¶ä¸­çš„jobmanager -p,--parallelism &lt;parallelism&gt; æŒ‡å®šç¨‹åºçš„å¹¶è¡Œåº¦ã€‚å¯ä»¥è¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤å€¼ã€‚ ä½¿ç”¨run å‘½ä»¤å‘yarné›†ç¾¤æäº¤ä¸€ä¸ªjobã€‚å®¢æˆ·ç«¯å¯ä»¥ç¡®å®šjobmanagerçš„åœ°å€ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡-må‚æ•°æŒ‡å®šjobmanagerã€‚jobmanagerçš„åœ°å€åœ¨yarnæ§åˆ¶å°ä¸Šå¯ä»¥çœ‹åˆ°ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š ä¸Šé¢çš„YARN sessionæ˜¯åœ¨Hadoop YARNç¯å¢ƒä¸‹å¯åŠ¨ä¸€ä¸ªFlink clusteré›†ç¾¤ï¼Œé‡Œé¢çš„èµ„æºæ˜¯å¯ä»¥å…±äº«ç»™å…¶ä»–çš„Flinkä½œä¸šã€‚æˆ‘ä»¬è¿˜å¯ä»¥åœ¨YARNä¸Šå¯åŠ¨ä¸€ä¸ªFlinkä½œä¸šã€‚è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨./bin/flinkï¼Œä½†æ˜¯ä¸éœ€è¦äº‹å…ˆå¯åŠ¨YARN sessionï¼š 123./bin/flink run -m yarn-cluster -yn 2 ./examples/batch/WordCount.jar \ --input hdfs://user/hadoop/input.txt \ --output hdfs://user/hadoop/output.txt ä¸Šé¢çš„å‘½ä»¤åŒæ ·ä¼šå¯åŠ¨ä¸€ä¸ªç±»ä¼¼äºYARN sessionå¯åŠ¨çš„é¡µé¢ã€‚å…¶ä¸­çš„-ynæ˜¯æŒ‡TaskManagerçš„ä¸ªæ•°ï¼Œå¿…é¡»è¦æŒ‡å®šã€‚ åå°è¿è¡Œ yarn sessionå¦‚æœä½ ä¸å¸Œæœ›flink yarn clientä¸€ç›´è¿è¡Œï¼Œä¹Ÿå¯ä»¥å¯åŠ¨ä¸€ä¸ªåå°è¿è¡Œçš„yarn sessionã€‚ä½¿ç”¨è¿™ä¸ªå‚æ•°ï¼š-d æˆ–è€… â€“detachedåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œflink yarn clientå°†ä¼šåªæäº¤ä»»åŠ¡åˆ°é›†ç¾¤ç„¶åå…³é—­è‡ªå·±ã€‚æ³¨æ„ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— æ³•ä½¿ç”¨flinkåœæ­¢yarn sessionã€‚å¿…é¡»ä½¿ç”¨yarnå·¥å…·æ¥åœæ­¢yarn session 1yarn application -kill &lt;applicationId&gt; flink on yarnçš„æ•…éšœæ¢å¤flink çš„ yarn å®¢æˆ·ç«¯é€šè¿‡ä¸‹é¢çš„é…ç½®å‚æ•°æ¥æ§åˆ¶å®¹å™¨çš„æ•…éšœæ¢å¤ã€‚è¿™äº›å‚æ•°å¯ä»¥é€šè¿‡conf/flink-conf.yaml æˆ–è€…åœ¨å¯åŠ¨yarn sessionçš„æ—¶å€™é€šè¿‡-Då‚æ•°æ¥æŒ‡å®šã€‚ yarn.reallocate-failedï¼šè¿™ä¸ªå‚æ•°æ§åˆ¶äº†flinkæ˜¯å¦åº”è¯¥é‡æ–°åˆ†é…å¤±è´¥çš„taskmanagerå®¹å™¨ã€‚é»˜è®¤æ˜¯trueã€‚ yarn.maximum-failed-containersï¼šapplicationMasterå¯ä»¥æ¥å—çš„å®¹å™¨æœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œè¾¾åˆ°è¿™ä¸ªå‚æ•°ï¼Œå°±ä¼šè®¤ä¸ºyarn sessionå¤±è´¥ã€‚é»˜è®¤è¿™ä¸ªæ¬¡æ•°å’Œåˆå§‹åŒ–è¯·æ±‚çš„taskmanageræ•°é‡ç›¸ç­‰(-n å‚æ•°æŒ‡å®šçš„)ã€‚ yarn.application-attemptsï¼šapplicationMasteré‡è¯•çš„æ¬¡æ•°ã€‚å¦‚æœè¿™ä¸ªå€¼è¢«è®¾ç½®ä¸º1(é»˜è®¤å°±æ˜¯1)ï¼Œå½“application masterå¤±è´¥çš„æ—¶å€™ï¼Œyarn sessionä¹Ÿä¼šå¤±è´¥ã€‚è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼çš„è¯ï¼Œyarnä¼šå°è¯•é‡å¯applicationMasterã€‚ æ—¥å¿—æ–‡ä»¶æŸ¥çœ‹åœ¨æŸç§æƒ…å†µä¸‹ï¼Œflink yarn session éƒ¨ç½²å¤±è´¥æ˜¯ç”±äºå®ƒè‡ªèº«çš„åŸå› ï¼Œç”¨æˆ·å¿…é¡»ä¾èµ–äºyarnçš„æ—¥å¿—æ¥è¿›è¡Œåˆ†æã€‚æœ€æœ‰ç”¨çš„å°±æ˜¯yarn log aggregation ã€‚å¯åŠ¨å®ƒï¼Œç”¨æˆ·å¿…é¡»åœ¨yarn-site.xmlæ–‡ä»¶ä¸­è®¾ç½®yarn.log-aggregation-enable å±æ€§ä¸ºtrueã€‚ä¸€æ—¦å¯ç”¨äº†ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸ªå¤±è´¥çš„yarn sessionçš„æ‰€æœ‰è¯¦ç»†æ—¥å¿—ã€‚ 1yarn logs -applicationId &lt;application ID&gt; æ¦‚è¿°JobManager åè°ƒæ¯ä¸ª Flink éƒ¨ç½²ã€‚å®ƒè´Ÿè´£è°ƒåº¦å’Œèµ„æºç®¡ç†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Flink é›†ç¾¤åªæœ‰ä¸€ä¸ª JobManager å®ä¾‹ã€‚ è¿™ä¼šäº§ç”Ÿå•ç‚¹æ•…éšœ(SPOF)ï¼šå¦‚æœ JobManager å´©æºƒï¼Œåˆ™æ— æ³•æäº¤æ–°ä½œä¸šå¹¶ä¸”å¯¼è‡´è¿è¡Œä¸­çš„ä½œä¸šè¿è¡Œå¤±è´¥ã€‚ä½¿ç”¨ JobManager é«˜å¯ç”¨æ€§æ¨¡å¼ï¼Œå¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä»è€Œæ¶ˆé™¤ SPOFã€‚æ‚¨å¯ä»¥ä¸ºStandaloneå’Œ YARN é›†ç¾¤é…ç½®é«˜å¯ç”¨æ€§ã€‚ äº”ã€Standaloneé›†ç¾¤é«˜å¯ç”¨æ€§é’ˆå¯¹ Standalone é›†ç¾¤çš„ JobManager é«˜å¯ç”¨æ€§çš„ä¸€èˆ¬æ¦‚å¿µæ˜¯ï¼Œä»»ä½•æ—¶å€™éƒ½æœ‰ä¸€ä¸ª ä¸» JobManager å’Œå¤šä¸ªå¤‡ JobManagersï¼Œä»¥ä¾¿åœ¨ä¸»èŠ‚ç‚¹å¤±è´¥æ—¶æœ‰å¤‡ JobManagers æ¥æ¥ç®¡é›†ç¾¤ã€‚è¿™ä¿è¯äº†æ²¡æœ‰å•ç‚¹æ•…éšœï¼Œä¸€æ—¦å¤‡ JobManager æ¥ç®¡é›†ç¾¤ï¼Œä½œä¸šå°±å¯ä»¥æ­£å¸¸è¿è¡Œã€‚ä¸»å¤‡ JobManager å®ä¾‹ä¹‹é—´æ²¡æœ‰æ˜æ˜¾çš„åŒºåˆ«ã€‚æ¯ä¸ª JobManager éƒ½å¯ä»¥å……å½“ä¸»å¤‡èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹ä¸‰ä¸ª JobManager å®ä¾‹çš„è®¾ç½®: é…ç½®è¦å¯ç”¨ JobManager é«˜å¯ç”¨æ€§ï¼Œæ‚¨å¿…é¡»å°†é«˜å¯ç”¨æ€§æ¨¡å¼è®¾ç½®ä¸º zookeeperï¼Œé…ç½® zookeeper quorum å°†æ‰€æœ‰ JobManager ä¸»æœºåŠå…¶ web UI ç«¯å£å†™å…¥é…ç½®æ–‡ä»¶ã€‚Flinkåˆ©ç”¨ ZooKeeper åœ¨æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ JobManager å®ä¾‹ä¹‹é—´è¿›è¡Œåˆ†å¸ƒå¼åè°ƒã€‚ ZooKeeper æ˜¯ç‹¬ç«‹äº Flink çš„æœåŠ¡ï¼Œé€šè¿‡ Leader é€‰ä¸¾å’Œè½»é‡çº§ä¸€è‡´çŠ¶æ€å­˜å‚¨æä¾›é«˜å¯é çš„åˆ†å¸ƒå¼åè°ƒã€‚ Mastersæ–‡ä»¶ (mastersæœåŠ¡å™¨)è¦å¯åŠ¨HAé›†ç¾¤ï¼Œè¯·åœ¨ä»¥ä¸‹ä½ç½®é…ç½®Masteræ–‡ä»¶ conf/masters:mastersæ–‡ä»¶ï¼šmastersæ–‡ä»¶åŒ…å«å¯åŠ¨ jobmanager çš„æ‰€æœ‰ä¸»æœºå’Œ web ç”¨æˆ·ç•Œé¢ç»‘å®šçš„ç«¯å£ã€‚ 123jobManagerAddress1:webUIPort1 [...]jobManagerAddressX:webUIPortX é»˜è®¤æƒ…å†µä¸‹ï¼Œjob manageré€‰ä¸€ä¸ªéšæœºç«¯å£ä½œä¸ºè¿›ç¨‹éšæœºé€šä¿¡ç«¯å£ã€‚æ‚¨å¯ä»¥é€šè¿‡ high-availability.jobmanager.port é”®ä¿®æ”¹æ­¤è®¾ç½®ã€‚æ­¤é…ç½®æ¥å—å•ä¸ªç«¯å£ï¼ˆä¾‹å¦‚50010ï¼‰ï¼ŒèŒƒå›´ï¼ˆ50000-50025ï¼‰æˆ–ä¸¤è€…çš„ç»„åˆï¼ˆ50010,50011,50020-50025,50050-50075ï¼‰ã€‚ é…ç½®æ–‡ä»¶ï¼ˆflink-conf.yamlï¼‰è¦å¯åŠ¨HAé›†ç¾¤ï¼Œè¯·å°†ä»¥ä¸‹é…ç½®é”®æ·»åŠ åˆ° conf/flink-conf.yaml: é«˜å¯ç”¨æ€§æ¨¡å¼ï¼ˆå¿…éœ€ï¼‰ï¼šåœ¨ conf/flink-conf.yaml ä¸­ï¼Œå¿…é¡»å°†é«˜å¯ç”¨æ€§æ¨¡å¼è®¾ç½®ä¸ºzookeeperï¼Œä»¥æ‰“å¼€é«˜å¯ç”¨æ¨¡å¼ã€‚æˆ–è€…å°†æ­¤é€‰é¡¹è®¾ç½®ä¸ºå·¥å‚ç±»çš„ FQNï¼ŒFlink é€šè¿‡åˆ›å»º HighAvailabilityServices å®ä¾‹ä½¿ç”¨ã€‚ 1high-availability: zookeeper Zookeeper quorumï¼ˆå¿…éœ€ï¼‰ï¼š ZooKeeper quorum æ˜¯ ZooKeeper æœåŠ¡å™¨çš„å¤åˆ¶ç»„ï¼Œå®ƒæä¾›åˆ†å¸ƒå¼åè°ƒæœåŠ¡ã€‚ 1high-availability.zookeeper.quorum:address1:2181[,...],addressX:2181 æ¯ä¸ª addressX:port éƒ½æ˜¯ä¸€ä¸ª ZooKeeper æœåŠ¡å™¨çš„ipåŠå…¶ç«¯å£ï¼ŒFlink å¯ä»¥åœ¨æŒ‡å®šçš„åœ°å€å’Œç«¯å£è®¿é—®zookeeperã€‚ ZooKeeper root ï¼ˆæ¨èï¼‰ï¼š ZooKeeper æ ¹èŠ‚ç‚¹ï¼Œåœ¨è¯¥èŠ‚ç‚¹ä¸‹æ”¾ç½®æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ã€‚ 1high-availability.zookeeper.path.root: /flink ZooKeeper cluster-idï¼ˆæ¨èï¼‰ï¼š ZooKeeperçš„cluster-idèŠ‚ç‚¹ï¼Œåœ¨è¯¥èŠ‚ç‚¹ä¸‹æ”¾ç½®é›†ç¾¤çš„æ‰€æœ‰ç›¸å…³æ•°æ®ã€‚ 1high-availability.cluster-id: /default_ns # important: customize per cluster é‡è¦ï¼š åœ¨è¿è¡Œ YARN æˆ–å…¶ä»–ç¾¤é›†ç®¡ç†å™¨ä¸­è¿è¡Œæ—¶ï¼Œä¸è¦æ‰‹åŠ¨è®¾ç½®æ­¤å€¼ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå°†æ ¹æ®åº”ç”¨ç¨‹åº ID è‡ªåŠ¨ç”Ÿæˆ cluster-idã€‚ æ‰‹åŠ¨è®¾ç½® cluster-id ä¼šè¦†ç›– YARN ä¸­çš„è‡ªåŠ¨ç”Ÿæˆçš„ IDã€‚åè¿‡æ¥ï¼Œä½¿ç”¨ -z CLI é€‰é¡¹æŒ‡å®š cluster-id ä¼šè¦†ç›–æ‰‹åŠ¨é…ç½®ã€‚å¦‚æœåœ¨è£¸æœºä¸Šè¿è¡Œå¤šä¸ª Flink HA é›†ç¾¤ï¼Œåˆ™å¿…é¡»ä¸ºæ¯ä¸ªé›†ç¾¤æ‰‹åŠ¨é…ç½®å•ç‹¬çš„ cluster-idã€‚ å­˜å‚¨ç›®å½•ï¼ˆå¿…éœ€ï¼‰ï¼š JobManager å…ƒæ•°æ®ä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿ storageDir ä¸­ï¼Œåœ¨ ZooKeeper ä¸­ä»…ä¿å­˜äº†æŒ‡å‘æ­¤çŠ¶æ€çš„æŒ‡é’ˆã€‚ 1high-availability.storageDir: hdfs://xxx/flink/recovery è¯¥storageDir ä¸­ä¿å­˜äº† JobManager æ¢å¤çŠ¶æ€æ‰€éœ€çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚é…ç½® master æ–‡ä»¶å’Œ ZooKeeper quorum ä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æä¾›çš„é›†ç¾¤å¯åŠ¨è„šæœ¬ã€‚å®ƒä»¬å°†å¯åŠ¨ HA ç¾¤é›†ã€‚è¯·æ³¨æ„ï¼Œå¯åŠ¨ Flink HA é›†ç¾¤å‰ï¼Œå¿…é¡»å¯åŠ¨ Zookeeper é›†ç¾¤ï¼Œå¹¶ç¡®ä¿ä¸ºè¦å¯åŠ¨çš„æ¯ä¸ª HA ç¾¤é›†é…ç½®å•ç‹¬çš„ ZooKeeper æ ¹è·¯å¾„ã€‚ ç¤ºä¾‹ï¼šå…·æœ‰2ä¸ª JobManager çš„ Standalone é›†ç¾¤ åœ¨conf/flink-conf.yaml ä¸­é…ç½®é«˜å¯ç”¨æ¨¡å¼å’Œ ZooKeeper quorumï¼š 12345high-availability: zookeeperhigh-availability.zookeeper.quorum: localhost:2181high-availability.zookeeper.path.root: /flinkhigh-availability.cluster-id: /cluster_onehigh-availability.storageDir: hdfs://xx/flink/recovery åœ¨ conf/master ä¸­é…ç½® master: 12localhost:8081localhost:8082 åœ¨ conf/zoo.cfg ä¸­é…ç½® ZooKeeper æœåŠ¡ï¼ˆç›®å‰ï¼Œæ¯å°æœºå™¨åªèƒ½è¿è¡Œä¸€ä¸ª ZooKeeper è¿›ç¨‹ï¼‰ 1server.0=localhost:2888:3888 å¯åŠ¨ ZooKeeper quorumï¼š 12$ bin/start-zookeeper-quorum.shStarting zookeeper daemon on host localhost. å¯åŠ¨ Flink HA é›†ç¾¤ï¼š 12345$ bin/start-cluster.shStarting HA cluster with 2 masters and 1 peers in ZooKeeper quorum.Starting jobmanager daemon on host localhost.Starting jobmanager daemon on host localhost.Starting taskmanager daemon on host localhost. åœæ­¢ Zookeeper quorum å’Œé›†ç¾¤ï¼š 123456$ bin/stop-cluster.shStopping taskmanager daemon (pid: 7647) on localhost.Stopping jobmanager daemon (pid: 7495) on host localhost.Stopping jobmanager daemon (pid: 7349) on host localhost.$ bin/stop-zookeeper-quorum.shStopping zookeeper daemon (pid: 7101) on host localhost. å…­ã€YARN é›†ç¾¤çš„é«˜å¯ç”¨æ€§åœ¨è¿è¡Œé«˜å¯ç”¨æ€§ YARN é›†ç¾¤æ—¶ï¼Œæˆ‘ä»¬ä¸ä¼šè¿è¡Œå¤šä¸ª JobManager (ApplicationMaster) å®ä¾‹ï¼Œè€Œåªè¿è¡Œä¸€ä¸ªï¼Œè¯¥JobManagerå®ä¾‹å¤±è´¥æ—¶ï¼ŒYARNä¼šå°†å…¶é‡æ–°å¯åŠ¨ã€‚Yarnçš„å…·ä½“è¡Œä¸ºå–å†³äºæ‚¨ä½¿ç”¨çš„ YARN ç‰ˆæœ¬ã€‚ é…ç½®Application Masteræœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆyarn-site.xmlï¼‰åœ¨YARN é…ç½®æ–‡ä»¶ yarn-site.xml ä¸­ï¼Œéœ€è¦é…ç½® application master çš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼š 1234567&lt;property&gt; &lt;name&gt;yarn.resourcemanager.am.max-attempts&lt;/name&gt; &lt;value&gt;4&lt;/value&gt; &lt;description&gt; The maximum number of application master execution attempts. &lt;/description&gt;&lt;/property&gt; å½“å‰ YARN ç‰ˆæœ¬çš„é»˜è®¤å€¼æ˜¯2(è¡¨ç¤ºå…è®¸å•ä¸ªJobManagerå¤±è´¥ä¸¤æ¬¡)ã€‚ Application Attemptsï¼ˆflink-conf.yamlï¼‰ï¼šé™¤äº†HAé…ç½®(å‚è€ƒä¸Šæ–‡)ä¹‹å¤–ï¼Œæ‚¨è¿˜å¿…é¡»é…ç½®æœ€å¤§é‡è¯•æ¬¡æ•° conf/flink-conf.yaml: 1yarn.application-attempts: 10 è¿™æ„å‘³ç€åœ¨å¦‚æœç¨‹åºå¯åŠ¨å¤±è´¥ï¼ŒYARNä¼šå†é‡è¯•9æ¬¡ï¼ˆ9 æ¬¡é‡è¯• + 1æ¬¡å¯åŠ¨ï¼‰ã€‚å¦‚æœ YARN æ“ä½œéœ€è¦ï¼Œå¦‚æœå¯åŠ¨10æ¬¡ä½œä¸šè¿˜å¤±è´¥ï¼Œyarnæ‰ä¼šå°†è¯¥ä»»åŠ¡çš„çŠ¶æ€ç½®ä¸ºå¤±è´¥ã€‚å¦‚æœæŠ¢å ï¼ŒèŠ‚ç‚¹ç¡¬ä»¶æ•…éšœæˆ–é‡å¯ï¼ŒNodeManager é‡æ–°åŒæ­¥ç­‰æ“ä½œéœ€è¦ï¼ŒYARNç»§ç»­å°è¯•å¯åŠ¨åº”ç”¨ã€‚ è¿™äº›é‡å¯ä¸è®¡å…¥ yarn.application-attempts ä¸ªæ•°ä¸­ã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„ yarn.resourcemanager.am.max-attempts ä¸ºyarnä¸­ç¨‹åºé‡å¯ä¸Šé™ã€‚å› æ­¤ï¼Œ Flink ä¸­è®¾ç½®çš„ç¨‹åºå°è¯•æ¬¡æ•°ä¸èƒ½è¶…è¿‡ YARN çš„é›†ç¾¤è®¾ç½®ã€‚ ç¤ºä¾‹ï¼šé«˜å¯ç”¨çš„YARN Session1.é…ç½® HA æ¨¡å¼å’Œ ZooKeeper é›†ç¾¤åœ¨ conf/flink-conf.yaml ä¸­ï¼š 12345high-availability: zookeeperhigh-availability.zookeeper.quorum: localhost:2181high-availability.storageDir: hdfs:///flink/recoveryhigh-availability.zookeeper.path.root: /flinkyarn.application-attempts: 10 é…ç½® ZooKeeper æœåŠ¡åœ¨ conf/zoo.cfg ä¸­(ç›®å‰æ¯å°æœºå™¨åªèƒ½è¿è¡Œä¸€ä¸ª ZooKeeper è¿›ç¨‹)ï¼š 1server.0=localhost:2888:3888 å¯åŠ¨ ZooKeeper é›†ç¾¤ï¼š 12$ bin/start-zookeeper-quorum.shStarting zookeeper daemon on host localhost. å¯åŠ¨ HA é›†ç¾¤ï¼š 1$ bin / yarn-session.sh -n 2 é…ç½® Zookeeper å®‰å…¨æ€§å¦‚æœ ZooKeeper ä½¿ç”¨ Kerberos ä»¥å®‰å…¨æ¨¡å¼è¿è¡Œï¼Œflink-conf.yaml æ ¹æ®éœ€è¦è¦†ç›–ä»¥ä¸‹é…ç½®ï¼š 1234567zookeeper.sasl.service-name: zookeeper # é»˜è®¤è®¾ç½®æ˜¯ â€œzookeeperâ€ ã€‚å¦‚æœ ZooKeeper é›†ç¾¤é…ç½®äº†# ä¸åŒçš„æœåŠ¡åç§°ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¿™é‡Œæä¾›ã€‚zookeeper.sasl.login-context-name: Client # é»˜è®¤è®¾ç½®æ˜¯ â€œClientâ€ã€‚è¯¥å€¼é…ç½®éœ€è¦åŒ¹é…# &quot;security.kerberos.login.contexts&quot;ä¸­çš„å…¶ä¸­ä¸€ä¸ªå€¼ã€‚ æœ‰å…³ Kerberos å®‰å…¨æ€§çš„ Flink é…ç½®çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… æ­¤å¤„ã€‚æ‚¨è¿˜å¯ä»¥åœ¨ æ­¤å¤„ æ‰¾åˆ°å…³äº Flink å†…éƒ¨å¦‚ä½•è®¾ç½®åŸºäº kerberos çš„å®‰å…¨æ€§çš„è¯¦ç»†ä¿¡æ¯ã€‚ Bootstrap ZooKeeperå¦‚æœæ‚¨æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„ZooKeeperï¼Œåˆ™å¯ä»¥ä½¿ç”¨Flinkç¨‹åºé™„å¸¦çš„è„šæœ¬ã€‚è¿™æ˜¯ä¸€ä¸ª ZooKeeper é…ç½®æ¨¡æ¿ conf/zoo.cfgã€‚æ‚¨å¯ä»¥ä¸ºä¸»æœºé…ç½®ä¸ºä½¿ç”¨ server.X æ¡ç›®è¿è¡Œ ZooKeeperï¼Œå…¶ä¸­ X æ˜¯æ¯ä¸ªæœåŠ¡å™¨çš„å”¯ä¸€IP: 123server.X=addressX:peerPort:leaderPort[...]server.Y=addressY:peerPort:leaderPort è¯¥è„šæœ¬ bin/start-zookeeper-quorum.sh å°†åœ¨æ¯ä¸ªé…ç½®çš„ä¸»æœºä¸Šå¯åŠ¨ ZooKeeper æœåŠ¡å™¨ã€‚ Flink wrapper ä¼šå¯åŠ¨ ZooKeeper æœåŠ¡ï¼Œè¯¥ wraper ä» conf/zoo.cfg ä¸­è¯»å–é…ç½®ï¼Œå¹¶è®¾ç½®ä¸€äº›å¿…éœ€çš„é…ç½®é¡¹ã€‚åœ¨ç”Ÿäº§è®¾ç½®ä¸­ï¼Œå»ºè®®æ‚¨ä½¿ç”¨è‡ªå·±å®‰è£…çš„ ZooKeeperã€‚]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink çŠ¶æ€ç®¡ç†ä¸æ£€æŸ¥ç‚¹æœºåˆ¶]]></title>
    <url>%2F2020%2F04%2F09%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F4-Flink%20%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E4%B8%8E%E6%A3%80%E6%9F%A5%E7%82%B9%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[ä¸€ã€çŠ¶æ€åˆ†ç±»ç›¸å¯¹äºå…¶ä»–æµè®¡ç®—æ¡†æ¶ï¼ŒFlink ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç‰¹æ€§å°±æ˜¯å…¶æ”¯æŒæœ‰çŠ¶æ€è®¡ç®—ã€‚å³ä½ å¯ä»¥å°†ä¸­é—´çš„è®¡ç®—ç»“æœè¿›è¡Œä¿å­˜ï¼Œå¹¶æä¾›ç»™åç»­çš„è®¡ç®—ä½¿ç”¨ï¼š å…·ä½“è€Œè¨€ï¼ŒFlink åˆå°†çŠ¶æ€ (State) åˆ†ä¸º Keyed State ä¸ Operator Stateï¼š 2.1 ç®—å­çŠ¶æ€ç®—å­çŠ¶æ€ (Operator State)ï¼šé¡¾åæ€ä¹‰ï¼ŒçŠ¶æ€æ˜¯å’Œç®—å­è¿›è¡Œç»‘å®šçš„ï¼Œä¸€ä¸ªç®—å­çš„çŠ¶æ€ä¸èƒ½è¢«å…¶ä»–ç®—å­æ‰€è®¿é—®åˆ°ã€‚å®˜æ–¹æ–‡æ¡£ä¸Šå¯¹ Operator State çš„è§£é‡Šæ˜¯ï¼šeach operator state is bound to one parallel operator instanceï¼Œæ‰€ä»¥æ›´ä¸ºç¡®åˆ‡çš„è¯´ä¸€ä¸ªç®—å­çŠ¶æ€æ˜¯ä¸ä¸€ä¸ªå¹¶å‘çš„ç®—å­å®ä¾‹æ‰€ç»‘å®šçš„ï¼Œå³å‡è®¾ç®—å­çš„å¹¶è¡Œåº¦æ˜¯ 2ï¼Œé‚£ä¹ˆå…¶åº”æœ‰ä¸¤ä¸ªå¯¹åº”çš„ç®—å­çŠ¶æ€ï¼š 2.2 é”®æ§çŠ¶æ€é”®æ§çŠ¶æ€ (Keyed State) ï¼šæ˜¯ä¸€ç§ç‰¹æ®Šçš„ç®—å­çŠ¶æ€ï¼Œå³çŠ¶æ€æ˜¯æ ¹æ® key å€¼è¿›è¡ŒåŒºåˆ†çš„ï¼ŒFlink ä¼šä¸ºæ¯ç±»é”®å€¼ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€å®ä¾‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªé¢œè‰²ä»£è¡¨ä¸åŒ key å€¼ï¼Œå¯¹åº”å››ä¸ªä¸åŒçš„çŠ¶æ€å®ä¾‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯é”®æ§çŠ¶æ€åªèƒ½åœ¨ KeyedStream ä¸Šè¿›è¡Œä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ stream.keyBy(...) æ¥å¾—åˆ° KeyedStream ã€‚ äºŒã€çŠ¶æ€ç¼–ç¨‹2.1 é”®æ§çŠ¶æ€Flink æä¾›äº†ä»¥ä¸‹æ•°æ®æ ¼å¼æ¥ç®¡ç†å’Œå­˜å‚¨é”®æ§çŠ¶æ€ (Keyed State)ï¼š ValueStateï¼šå­˜å‚¨å•å€¼ç±»å‹çš„çŠ¶æ€ã€‚å¯ä»¥ä½¿ç”¨ update(T) è¿›è¡Œæ›´æ–°ï¼Œå¹¶é€šè¿‡ T value() è¿›è¡Œæ£€ç´¢ã€‚ ListStateï¼šå­˜å‚¨åˆ—è¡¨ç±»å‹çš„çŠ¶æ€ã€‚å¯ä»¥ä½¿ç”¨ add(T) æˆ– addAll(List) æ·»åŠ å…ƒç´ ï¼›å¹¶é€šè¿‡ get() è·å¾—æ•´ä¸ªåˆ—è¡¨ã€‚ ReducingStateï¼šç”¨äºå­˜å‚¨ç»è¿‡ ReduceFunction è®¡ç®—åçš„ç»“æœï¼Œä½¿ç”¨ add(T) å¢åŠ å…ƒç´ ã€‚ AggregatingStateï¼šç”¨äºå­˜å‚¨ç»è¿‡ AggregatingState è®¡ç®—åçš„ç»“æœï¼Œä½¿ç”¨ add(IN) æ·»åŠ å…ƒç´ ã€‚ FoldingStateï¼šå·²è¢«æ ‡è¯†ä¸ºåºŸå¼ƒï¼Œä¼šåœ¨æœªæ¥ç‰ˆæœ¬ä¸­ç§»é™¤ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ AggregatingState ä»£æ›¿ã€‚ MapStateï¼šç»´æŠ¤ Map ç±»å‹çš„çŠ¶æ€ã€‚ ä»¥ä¸Šæ‰€æœ‰å¢åˆ æ”¹æŸ¥æ–¹æ³•ä¸å¿…ç¡¬è®°ï¼Œåœ¨ä½¿ç”¨æ—¶é€šè¿‡è¯­æ³•æç¤ºæ¥è°ƒç”¨å³å¯ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªå…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹ï¼šå‡è®¾æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œå½“ç›‘æ§æ•°æ®è¶…è¿‡é˜ˆå€¼ä¸€å®šæ¬¡æ•°åï¼Œéœ€è¦å‘å‡ºæŠ¥è­¦ä¿¡æ¯ã€‚è¿™é‡Œä¹‹æ‰€ä»¥è¦è¾¾åˆ°ä¸€å®šæ¬¡æ•°ï¼Œæ˜¯å› ä¸ºç”±äºå¶å‘åŸå› ï¼Œå¶å°”ä¸€æ¬¡è¶…è¿‡é˜ˆå€¼å¹¶ä¸èƒ½ä»£è¡¨ä»€ä¹ˆï¼Œæ•…éœ€è¦è¾¾åˆ°ä¸€å®šæ¬¡æ•°åæ‰è§¦å‘æŠ¥è­¦ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨åˆ° Flink çš„çŠ¶æ€ç¼–ç¨‹ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839public class ThresholdWarning extends RichFlatMapFunction&lt;Tuple2&lt;String, Long&gt;, Tuple2&lt;String, List&lt;Long&gt;&gt;&gt; &#123; // é€šè¿‡ListStateæ¥å­˜å‚¨éæ­£å¸¸æ•°æ®çš„çŠ¶æ€ private transient ListState&lt;Long&gt; abnormalData; // éœ€è¦ç›‘æ§çš„é˜ˆå€¼ private Long threshold; // è§¦å‘æŠ¥è­¦çš„æ¬¡æ•° private Integer numberOfTimes; ThresholdWarning(Long threshold, Integer numberOfTimes) &#123; this.threshold = threshold; this.numberOfTimes = numberOfTimes; &#125; @Override public void open(Configuration parameters) &#123; // é€šè¿‡çŠ¶æ€åç§°(å¥æŸ„)è·å–çŠ¶æ€å®ä¾‹ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»º abnormalData = getRuntimeContext().getListState( new ListStateDescriptor&lt;&gt;("abnormalData", Long.class)); &#125; @Override public void flatMap(Tuple2&lt;String, Long&gt; value, Collector&lt;Tuple2&lt;String, List&lt;Long&gt;&gt;&gt; out) throws Exception &#123; Long inputValue = value.f1; // å¦‚æœè¾“å…¥å€¼è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™è®°å½•è¯¥æ¬¡ä¸æ­£å¸¸çš„æ•°æ®ä¿¡æ¯ if (inputValue &gt;= threshold) &#123; abnormalData.add(inputValue); &#125; ArrayList&lt;Long&gt; list = Lists.newArrayList(abnormalData.get().iterator()); // å¦‚æœä¸æ­£å¸¸çš„æ•°æ®å‡ºç°è¾¾åˆ°ä¸€å®šæ¬¡æ•°ï¼Œåˆ™è¾“å‡ºæŠ¥è­¦ä¿¡æ¯ if (list.size() &gt;= numberOfTimes) &#123; out.collect(Tuple2.of(value.f0 + " è¶…è¿‡æŒ‡å®šé˜ˆå€¼ ", list)); // æŠ¥è­¦ä¿¡æ¯è¾“å‡ºåï¼Œæ¸…ç©ºçŠ¶æ€ abnormalData.clear(); &#125; &#125;&#125; è°ƒç”¨è‡ªå®šä¹‰çš„çŠ¶æ€ç›‘æ§ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ aï¼Œb æ¥ä»£è¡¨ä¸åŒç±»å‹çš„ç›‘æ§æ•°æ®ï¼Œåˆ†åˆ«å¯¹å…¶æ•°æ®è¿›è¡Œç›‘æ§ï¼š 1234567891011final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStreamSource&lt;Tuple2&lt;String, Long&gt;&gt; tuple2DataStreamSource = env.fromElements( Tuple2.of("a", 50L), Tuple2.of("a", 80L), Tuple2.of("a", 400L), Tuple2.of("a", 100L), Tuple2.of("a", 200L), Tuple2.of("a", 200L), Tuple2.of("b", 100L), Tuple2.of("b", 200L), Tuple2.of("b", 200L), Tuple2.of("b", 500L), Tuple2.of("b", 600L), Tuple2.of("b", 700L));tuple2DataStreamSource .keyBy(0) .flatMap(new ThresholdWarning(100L, 3)) // è¶…è¿‡100çš„é˜ˆå€¼3æ¬¡åå°±è¿›è¡ŒæŠ¥è­¦ .printToErr();env.execute("Managed Keyed State"); è¾“å‡ºå¦‚ä¸‹ç»“æœå¦‚ä¸‹ï¼š 2.2 çŠ¶æ€æœ‰æ•ˆæœŸä»¥ä¸Šä»»ä½•ç±»å‹çš„ keyed state éƒ½æ”¯æŒé…ç½®æœ‰æ•ˆæœŸ (TTL) ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 1234567891011StateTtlConfig ttlConfig = StateTtlConfig // è®¾ç½®æœ‰æ•ˆæœŸä¸º 10 ç§’ .newBuilder(Time.seconds(10)) // è®¾ç½®æœ‰æ•ˆæœŸæ›´æ–°è§„åˆ™ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå½“åˆ›å»ºå’Œå†™å…¥æ—¶ï¼Œéƒ½é‡ç½®å…¶æœ‰æ•ˆæœŸåˆ°è§„å®šçš„10ç§’ .setUpdateType(StateTtlConfig.UpdateType.OnCreateAndWrite) /*è®¾ç½®åªè¦å€¼è¿‡æœŸå°±ä¸å¯è§ï¼Œå¦å¤–ä¸€ä¸ªå¯é€‰å€¼æ˜¯ReturnExpiredIfNotCleanedUpï¼Œ ä»£è¡¨å³ä½¿å€¼è¿‡æœŸäº†ï¼Œä½†å¦‚æœè¿˜æ²¡æœ‰è¢«ç‰©ç†åˆ é™¤ï¼Œå°±æ˜¯å¯è§çš„*/ .setStateVisibility(StateTtlConfig.StateVisibility.NeverReturnExpired) .build();ListStateDescriptor&lt;Long&gt; descriptor = new ListStateDescriptor&lt;&gt;("abnormalData", Long.class);descriptor.enableTimeToLive(ttlConfig); 2.3 ç®—å­çŠ¶æ€ç›¸æ¯”äºé”®æ§çŠ¶æ€ï¼Œç®—å­çŠ¶æ€ç›®å‰æ”¯æŒçš„å­˜å‚¨ç±»å‹åªæœ‰ä»¥ä¸‹ä¸‰ç§ï¼š ListStateï¼šå­˜å‚¨åˆ—è¡¨ç±»å‹çš„çŠ¶æ€ã€‚ UnionListStateï¼šå­˜å‚¨åˆ—è¡¨ç±»å‹çš„çŠ¶æ€ï¼Œä¸ ListState çš„åŒºåˆ«åœ¨äºï¼šå¦‚æœå¹¶è¡Œåº¦å‘ç”Ÿå˜åŒ–ï¼ŒListState ä¼šå°†è¯¥ç®—å­çš„æ‰€æœ‰å¹¶å‘çš„çŠ¶æ€å®ä¾‹è¿›è¡Œæ±‡æ€»ï¼Œç„¶åå‡åˆ†ç»™æ–°çš„ Taskï¼›è€Œ UnionListState åªæ˜¯å°†æ‰€æœ‰å¹¶å‘çš„çŠ¶æ€å®ä¾‹æ±‡æ€»èµ·æ¥ï¼Œå…·ä½“çš„åˆ’åˆ†è¡Œä¸ºåˆ™ç”±ç”¨æˆ·è¿›è¡Œå®šä¹‰ã€‚ BroadcastStateï¼šç”¨äºå¹¿æ’­çš„ç®—å­çŠ¶æ€ã€‚ è¿™é‡Œæˆ‘ä»¬ç»§ç»­æ²¿ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œå‡è®¾æ­¤æ—¶æˆ‘ä»¬ä¸éœ€è¦åŒºåˆ†ç›‘æ§æ•°æ®çš„ç±»å‹ï¼Œåªè¦æœ‰ç›‘æ§æ•°æ®è¶…è¿‡é˜ˆå€¼å¹¶è¾¾åˆ°æŒ‡å®šçš„æ¬¡æ•°åï¼Œå°±è¿›è¡ŒæŠ¥è­¦ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class ThresholdWarning extends RichFlatMapFunction&lt;Tuple2&lt;String, Long&gt;, Tuple2&lt;String, List&lt;Tuple2&lt;String, Long&gt;&gt;&gt;&gt; implements CheckpointedFunction &#123; // éæ­£å¸¸æ•°æ® private List&lt;Tuple2&lt;String, Long&gt;&gt; bufferedData; // checkPointedState private transient ListState&lt;Tuple2&lt;String, Long&gt;&gt; checkPointedState; // éœ€è¦ç›‘æ§çš„é˜ˆå€¼ private Long threshold; // æ¬¡æ•° private Integer numberOfTimes; ThresholdWarning(Long threshold, Integer numberOfTimes) &#123; this.threshold = threshold; this.numberOfTimes = numberOfTimes; this.bufferedData = new ArrayList&lt;&gt;(); &#125; @Override public void initializeState(FunctionInitializationContext context) throws Exception &#123; // æ³¨æ„è¿™é‡Œè·å–çš„æ˜¯OperatorStateStore checkPointedState = context.getOperatorStateStore(). getListState(new ListStateDescriptor&lt;&gt;("abnormalData", TypeInformation.of(new TypeHint&lt;Tuple2&lt;String, Long&gt;&gt;() &#123; &#125;))); // å¦‚æœå‘ç”Ÿé‡å¯ï¼Œåˆ™éœ€è¦ä»å¿«ç…§ä¸­å°†çŠ¶æ€è¿›è¡Œæ¢å¤ if (context.isRestored()) &#123; for (Tuple2&lt;String, Long&gt; element : checkPointedState.get()) &#123; bufferedData.add(element); &#125; &#125; &#125; @Override public void flatMap(Tuple2&lt;String, Long&gt; value, Collector&lt;Tuple2&lt;String, List&lt;Tuple2&lt;String, Long&gt;&gt;&gt;&gt; out) &#123; Long inputValue = value.f1; // è¶…è¿‡é˜ˆå€¼åˆ™è¿›è¡Œè®°å½• if (inputValue &gt;= threshold) &#123; bufferedData.add(value); &#125; // è¶…è¿‡æŒ‡å®šæ¬¡æ•°åˆ™è¾“å‡ºæŠ¥è­¦ä¿¡æ¯ if (bufferedData.size() &gt;= numberOfTimes) &#123; // é¡ºä¾¿è¾“å‡ºçŠ¶æ€å®ä¾‹çš„hashcode out.collect(Tuple2.of(checkPointedState.hashCode() + "é˜ˆå€¼è­¦æŠ¥ï¼", bufferedData)); bufferedData.clear(); &#125; &#125; @Override public void snapshotState(FunctionSnapshotContext context) throws Exception &#123; // åœ¨è¿›è¡Œå¿«ç…§æ—¶ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°checkPointedState checkPointedState.clear(); for (Tuple2&lt;String, Long&gt; element : bufferedData) &#123; checkPointedState.add(element); &#125; &#125;&#125; è°ƒç”¨è‡ªå®šä¹‰ç®—å­çŠ¶æ€ï¼Œè¿™é‡Œéœ€è¦å°†å¹¶è¡Œåº¦è®¾ç½®ä¸º 1ï¼š 1234567891011121314final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();// å¼€å¯æ£€æŸ¥ç‚¹æœºåˆ¶env.enableCheckpointing(1000);// è®¾ç½®å¹¶è¡Œåº¦ä¸º1DataStreamSource&lt;Tuple2&lt;String, Long&gt;&gt; tuple2DataStreamSource = env.setParallelism(1).fromElements( Tuple2.of("a", 50L), Tuple2.of("a", 80L), Tuple2.of("a", 400L), Tuple2.of("a", 100L), Tuple2.of("a", 200L), Tuple2.of("a", 200L), Tuple2.of("b", 100L), Tuple2.of("b", 200L), Tuple2.of("b", 200L), Tuple2.of("b", 500L), Tuple2.of("b", 600L), Tuple2.of("b", 700L));tuple2DataStreamSource .flatMap(new ThresholdWarning(100L, 3)) .printToErr();env.execute("Managed Keyed State");&#125; æ­¤æ—¶è¾“å‡ºå¦‚ä¸‹ï¼š åœ¨ä¸Šé¢çš„è°ƒç”¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†ç¨‹åºçš„å¹¶è¡Œåº¦è®¾ç½®ä¸º 1ï¼Œå¯ä»¥çœ‹åˆ°ä¸‰æ¬¡è¾“å‡ºä¸­çŠ¶æ€å®ä¾‹çš„ hashcode å…¨æ˜¯ä¸€è‡´çš„ï¼Œè¯æ˜å®ƒä»¬éƒ½åŒä¸€ä¸ªçŠ¶æ€å®ä¾‹ã€‚å‡è®¾å°†å¹¶è¡Œåº¦è®¾ç½®ä¸º 2ï¼Œæ­¤æ—¶è¾“å‡ºå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°æ­¤æ—¶ä¸¤æ¬¡è¾“å‡ºä¸­çŠ¶æ€å®ä¾‹çš„ hashcode æ˜¯ä¸ä¸€è‡´çš„ï¼Œä»£è¡¨å®ƒä»¬ä¸æ˜¯åŒä¸€ä¸ªçŠ¶æ€å®ä¾‹ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸Šæ–‡æåˆ°çš„ï¼Œä¸€ä¸ªç®—å­çŠ¶æ€æ˜¯ä¸ä¸€ä¸ªå¹¶å‘çš„ç®—å­å®ä¾‹æ‰€ç»‘å®šçš„ã€‚åŒæ—¶è¿™é‡Œåªè¾“å‡ºä¸¤æ¬¡ï¼Œæ˜¯å› ä¸ºåœ¨å¹¶å‘å¤„ç†çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹ 1 å¯èƒ½æ‹¿åˆ° 5 ä¸ªéæ­£å¸¸å€¼ï¼Œçº¿ç¨‹ 2 å¯èƒ½æ‹¿åˆ° 4 ä¸ªéæ­£å¸¸å€¼ï¼Œå› ä¸ºè¦å¤§äº 3 æ¬¡æ‰èƒ½è¾“å‡ºï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹å°±ä¼šå‡ºç°åªè¾“å‡ºä¸¤æ¡è®°å½•çš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦å°†ç¨‹åºçš„å¹¶è¡Œåº¦è®¾ç½®ä¸º 1ã€‚ ä¸‰ã€æ£€æŸ¥ç‚¹æœºåˆ¶3.1 CheckPointsä¸ºäº†ä½¿ Flink çš„çŠ¶æ€å…·æœ‰è‰¯å¥½çš„å®¹é”™æ€§ï¼ŒFlink æä¾›äº†æ£€æŸ¥ç‚¹æœºåˆ¶ (CheckPoints) ã€‚é€šè¿‡æ£€æŸ¥ç‚¹æœºåˆ¶ï¼ŒFlink å®šæœŸåœ¨æ•°æ®æµä¸Šç”Ÿæˆ checkpoint barrier ï¼Œå½“æŸä¸ªç®—å­æ”¶åˆ° barrier æ—¶ï¼Œå³ä¼šåŸºäºå½“å‰çŠ¶æ€ç”Ÿæˆä¸€ä»½å¿«ç…§ï¼Œç„¶åå†å°†è¯¥ barrier ä¼ é€’åˆ°ä¸‹æ¸¸ç®—å­ï¼Œä¸‹æ¸¸ç®—å­æ¥æ”¶åˆ°è¯¥ barrier åï¼Œä¹ŸåŸºäºå½“å‰çŠ¶æ€ç”Ÿæˆä¸€ä»½å¿«ç…§ï¼Œä¾æ¬¡ä¼ é€’ç›´è‡³åˆ°æœ€åçš„ Sink ç®—å­ä¸Šã€‚å½“å‡ºç°å¼‚å¸¸åï¼ŒFlink å°±å¯ä»¥æ ¹æ®æœ€è¿‘çš„ä¸€æ¬¡çš„å¿«ç…§æ•°æ®å°†æ‰€æœ‰ç®—å­æ¢å¤åˆ°å…ˆå‰çš„çŠ¶æ€ã€‚ 3.2 å¼€å¯æ£€æŸ¥ç‚¹é»˜è®¤æƒ…å†µä¸‹ï¼Œæ£€æŸ¥ç‚¹æœºåˆ¶æ˜¯å…³é—­çš„ï¼Œéœ€è¦åœ¨ç¨‹åºä¸­è¿›è¡Œå¼€å¯ï¼š 1234567891011121314151617// å¼€å¯æ£€æŸ¥ç‚¹æœºåˆ¶ï¼Œå¹¶æŒ‡å®šçŠ¶æ€æ£€æŸ¥ç‚¹ä¹‹é—´çš„æ—¶é—´é—´éš”env.enableCheckpointing(1000); // å…¶ä»–å¯é€‰é…ç½®å¦‚ä¸‹ï¼š// è®¾ç½®è¯­ä¹‰env.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);// è®¾ç½®ä¸¤ä¸ªæ£€æŸ¥ç‚¹ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”env.getCheckpointConfig().setMinPauseBetweenCheckpoints(500);// è®¾ç½®æ‰§è¡ŒCheckpointæ“ä½œæ—¶çš„è¶…æ—¶æ—¶é—´env.getCheckpointConfig().setCheckpointTimeout(60000);// è®¾ç½®æœ€å¤§å¹¶å‘æ‰§è¡Œçš„æ£€æŸ¥ç‚¹çš„æ•°é‡env.getCheckpointConfig().setMaxConcurrentCheckpoints(1);// å°†æ£€æŸ¥ç‚¹æŒä¹…åŒ–åˆ°å¤–éƒ¨å­˜å‚¨env.getCheckpointConfig().enableExternalizedCheckpoints( ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION);// å¦‚æœæœ‰æ›´è¿‘çš„ä¿å­˜ç‚¹æ—¶ï¼Œæ˜¯å¦å°†ä½œä¸šå›é€€åˆ°è¯¥æ£€æŸ¥ç‚¹env.getCheckpointConfig().setPreferCheckpointForRecovery(true); 3.3 ä¿å­˜ç‚¹æœºåˆ¶ä¿å­˜ç‚¹æœºåˆ¶ (Savepoints) æ˜¯æ£€æŸ¥ç‚¹æœºåˆ¶çš„ä¸€ç§ç‰¹æ®Šçš„å®ç°ï¼Œå®ƒå…è®¸ä½ é€šè¿‡æ‰‹å·¥çš„æ–¹å¼æ¥è§¦å‘ Checkpointï¼Œå¹¶å°†ç»“æœæŒä¹…åŒ–å­˜å‚¨åˆ°æŒ‡å®šè·¯å¾„ä¸­ï¼Œä¸»è¦ç”¨äºé¿å… Flink é›†ç¾¤åœ¨é‡å¯æˆ–å‡çº§æ—¶å¯¼è‡´çŠ¶æ€ä¸¢å¤±ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 12# è§¦å‘æŒ‡å®šidçš„ä½œä¸šçš„Savepointï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°æŒ‡å®šç›®å½•ä¸‹bin/flink savepoint :jobId [:targetDirectory] æ›´å¤šå‘½ä»¤å’Œé…ç½®å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šsavepoints å››ã€çŠ¶æ€åç«¯4.1 çŠ¶æ€ç®¡ç†å™¨åˆ†ç±»é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„çŠ¶æ€éƒ½å­˜å‚¨åœ¨ JVM çš„å †å†…å­˜ä¸­ï¼Œåœ¨çŠ¶æ€æ•°æ®è¿‡å¤šçš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹å¼å¾ˆæœ‰å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼Œå› æ­¤ Flink è¯¥æä¾›äº†å…¶å®ƒæ–¹å¼æ¥å­˜å‚¨çŠ¶æ€æ•°æ®ï¼Œè¿™äº›å­˜å‚¨æ–¹å¼ç»Ÿä¸€ç§°ä¸ºçŠ¶æ€åç«¯ (æˆ–çŠ¶æ€ç®¡ç†å™¨)ï¼š ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š 1. MemoryStateBackendé»˜è®¤çš„æ–¹å¼ï¼Œå³åŸºäº JVM çš„å †å†…å­˜è¿›è¡Œå­˜å‚¨ï¼Œä¸»è¦é€‚ç”¨äºæœ¬åœ°å¼€å‘å’Œè°ƒè¯•ã€‚ 2. FsStateBackendåŸºäºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå­˜å‚¨ï¼Œå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥æ˜¯ HDFS ç­‰åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚ éœ€è¦æ³¨æ„è€Œæ˜¯è™½ç„¶é€‰æ‹©ä½¿ç”¨äº† FsStateBackend ï¼Œä½†æ­£åœ¨è¿›è¡Œçš„æ•°æ®ä»ç„¶æ˜¯å­˜å‚¨åœ¨ TaskManager çš„å†…å­˜ä¸­çš„ï¼Œåªæœ‰åœ¨ checkpoint æ—¶ï¼Œæ‰ä¼šå°†çŠ¶æ€å¿«ç…§å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿä¸Šã€‚ 3. RocksDBStateBackendRocksDBStateBackend æ˜¯ Flink å†…ç½®çš„ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†å™¨ï¼Œé‡‡ç”¨åµŒå…¥å¼çš„ key-value å‹æ•°æ®åº“ RocksDB æ¥å­˜å‚¨æ­£åœ¨è¿›è¡Œçš„æ•°æ®ã€‚ç­‰åˆ° checkpoint æ—¶ï¼Œå†å°†å…¶ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°æŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ‰€ä»¥é‡‡ç”¨ RocksDBStateBackend æ—¶ä¹Ÿéœ€è¦é…ç½®æŒä¹…åŒ–å­˜å‚¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšæ˜¯å› ä¸º RocksDB ä½œä¸ºåµŒå…¥å¼æ•°æ®åº“å®‰å…¨æ€§æ¯”è¾ƒä½ï¼Œä½†æ¯”èµ·å…¨æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼ï¼Œå…¶è¯»å–é€Ÿç‡æ›´å¿«ï¼›æ¯”èµ·å…¨å†…å­˜çš„æ–¹å¼ï¼Œå…¶å­˜å‚¨ç©ºé—´æ›´å¤§ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ç§æ¯”è¾ƒå‡è¡¡çš„æ–¹æ¡ˆã€‚ 4.2 é…ç½®æ–¹å¼Flink æ”¯æŒä½¿ç”¨ä¸¤ç§æ–¹å¼æ¥é…ç½®åç«¯ç®¡ç†å™¨ï¼š ç¬¬ä¸€ç§æ–¹å¼ï¼šåŸºäºä»£ç æ–¹å¼è¿›è¡Œé…ç½®ï¼Œåªå¯¹å½“å‰ä½œä¸šç”Ÿæ•ˆï¼š 1234// é…ç½® FsStateBackendenv.setStateBackend(new FsStateBackend("hdfs://namenode:40010/flink/checkpoints"));// é…ç½® RocksDBStateBackendenv.setStateBackend(new RocksDBStateBackend("hdfs://namenode:40010/flink/checkpoints")); é…ç½® RocksDBStateBackend æ—¶ï¼Œéœ€è¦é¢å¤–å¯¼å…¥ä¸‹é¢çš„ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-statebackend-rocksdb_2.11&lt;/artifactId&gt; &lt;version&gt;1.9.0&lt;/version&gt;&lt;/dependency&gt; ç¬¬äºŒç§æ–¹å¼ï¼šåŸºäº flink-conf.yaml é…ç½®æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œå¯¹æ‰€æœ‰éƒ¨ç½²åœ¨è¯¥é›†ç¾¤ä¸Šçš„ä½œä¸šéƒ½ç”Ÿæ•ˆï¼š 12state.backend: filesystemstate.checkpoints.dir: hdfs://namenode:40010/flink/checkpoints]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink çª—å£]]></title>
    <url>%2F2020%2F04%2F09%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F3-Flink%20%E7%AA%97%E5%8F%A3%2F</url>
    <content type="text"><![CDATA[ä¸€ã€çª—å£æ¦‚å¿µåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç»Ÿè®¡çš„æ•°æ®æµéƒ½æ˜¯æ— ç•Œçš„ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ç­‰å¾…æ•´ä¸ªæ•°æ®æµç»ˆæ­¢åæ‰è¿›è¡Œç»Ÿè®¡ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹æŸä¸ªæ—¶é—´èŒƒå›´æˆ–è€…æ•°é‡èŒƒå›´å†…çš„æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æï¼šå¦‚æ¯éš”äº”åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡è¿‡å»ä¸€å°æ—¶å†…æ‰€æœ‰å•†å“çš„ç‚¹å‡»é‡ï¼›æˆ–è€…æ¯å‘ç”Ÿ1000æ¬¡ç‚¹å‡»åï¼Œéƒ½å»ç»Ÿè®¡ä¸€ä¸‹æ¯ä¸ªå•†å“ç‚¹å‡»ç‡çš„å æ¯”ã€‚åœ¨ Flink ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çª—å£ (Window) æ¥å®ç°è¿™ç±»åŠŸèƒ½ã€‚æŒ‰ç…§ç»Ÿè®¡ç»´åº¦çš„ä¸åŒï¼ŒFlink ä¸­çš„çª—å£å¯ä»¥åˆ†ä¸º æ—¶é—´çª—å£ (Time Windows) å’Œ è®¡æ•°çª—å£ (Count Windows) ã€‚ äºŒã€çª—å£ç±»å‹ flinkæ”¯æŒä¸¤ç§åˆ’åˆ†çª—å£çš„æ–¹å¼(timeå’Œcount) å¦‚æœæ ¹æ®æ—¶é—´åˆ’åˆ†çª—å£ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªtime-windowï¼Œå¦‚æœæ ¹æ®æ•°æ®æ•°é‡è¿›è¡Œåˆ’åˆ†ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªcount-window flinkæ”¯æŒçª—å£çš„ä¸¤ä¸ªé‡è¦å±æ€§(sizeå’Œinterval) å¦‚æœ size=intervalï¼Œé‚£ä¹ˆå°±ä¼šå½¢æˆtrumbiling-window(æ»šåŠ¨çª—å£/æ— é‡å æ•°æ®) å¦‚æœ size&gt;intervalï¼Œé‚£ä¹ˆå°±ä¼šå½¢æˆsliding-window(æ»‘åŠ¨çª—å£/æœ‰é‡å æ•°æ®) å¦‚æœ size&lt;interval, è¿™ç§çª—å£å°†ä¼šä¸¢å¤±æ•°æ®ã€‚æ¯”å¦‚æ¯5ç§’é’Ÿï¼Œç»Ÿè®¡è¿‡å»3ç§’é’Ÿé€šè¿‡è·¯å£æ±½è½¦çš„æ•°æ®ï¼Œå°†ä¼šæ¼æ‰2ç§’é’Ÿçš„æ•°æ®ã€‚ é€šè¿‡ç»„åˆå¯ä»¥å¾—å‡ºå››ç§åŸºæœ¬çª—å£ time-tumbling-window æ— é‡å æ•°æ®ä¹‹é—´çª—å£ï¼Œè®¾ç½®æ–¹å¼ç¤ºä¾‹: timeWindow(Time.seconds(5)) time-sliding-window æœ‰é‡å æ•°æ®çš„æ—¶é—´çª—å£ï¼Œè®¾ç½®æ–¹å¼ç¤ºä¾‹: timeWindow(Time.seconds(5), Time.seconds(3)) count-tumbling-window æ— é‡å æ•°æ®çš„æ•°é‡çª—å£ï¼Œè®¾ç½®æ–¹å¼ç¤ºä¾‹: countWindow(5) count-sliding-window æœ‰é‡å æ•°æ®çš„æ•°é‡çª—å£ï¼Œè®¾ç½®æ–¹å¼ç¤ºä¾‹: countWindow(5, 3) flink æ”¯æŒåœ¨streamä¸Šçš„é€šè¿‡keyå»åŒºåˆ†å¤šä¸ªçª—å£ äºŒã€Time WindowsTime Windows ç”¨äºä»¥æ—¶é—´ä¸ºç»´åº¦æ¥è¿›è¡Œæ•°æ®èšåˆï¼Œå…·ä½“åˆ†ä¸ºä»¥ä¸‹å››ç±»ï¼š 2.1 Tumbling Windowsæ»šåŠ¨çª—å£ (Tumbling Windows) æ˜¯æŒ‡å½¼æ­¤ä¹‹é—´æ²¡æœ‰é‡å çš„çª—å£ã€‚ä¾‹å¦‚ï¼šæ¯éš”1å°æ—¶ç»Ÿè®¡è¿‡å»1å°æ—¶å†…çš„å•†å“ç‚¹å‡»é‡ï¼Œé‚£ä¹ˆ 1 å¤©å°±åªèƒ½åˆ†ä¸º 24 ä¸ªçª—å£ï¼Œæ¯ä¸ªçª—å£å½¼æ­¤ä¹‹é—´æ˜¯ä¸å­˜åœ¨é‡å çš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š è¿™é‡Œæˆ‘ä»¬ä»¥è¯é¢‘ç»Ÿè®¡ä¸ºä¾‹ï¼Œç»™å‡ºä¸€ä¸ªå…·ä½“çš„ç”¨ä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();// æ¥æ”¶socketä¸Šçš„æ•°æ®è¾“å…¥DataStreamSource&lt;String&gt; streamSource = env.socketTextStream("hadoop001", 9999, "\n", 3);streamSource.flatMap(new FlatMapFunction&lt;String, Tuple2&lt;String, Long&gt;&gt;() &#123; @Override public void flatMap(String value, Collector&lt;Tuple2&lt;String, Long&gt;&gt; out) throws Exception &#123; String[] words = value.split("\t"); for (String word : words) &#123; out.collect(new Tuple2&lt;&gt;(word, 1L)); &#125; &#125;&#125;).keyBy(0).timeWindow(Time.seconds(3)).sum(1).print(); //æ¯éš”3ç§’ç»Ÿè®¡ä¸€æ¬¡æ¯ä¸ªå•è¯å‡ºç°çš„æ•°é‡env.execute("Flink Streaming"); æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š å‡å¦‚æˆ‘ä»¬éœ€è¦ç»Ÿè®¡æ¯ä¸€åˆ†é’Ÿä¸­ç”¨æˆ·è´­ä¹°çš„å•†å“çš„æ€»æ•°ï¼Œéœ€è¦å°†ç”¨æˆ·çš„è¡Œä¸ºäº‹ä»¶æŒ‰æ¯ä¸€åˆ†é’Ÿè¿›è¡Œåˆ‡åˆ†ï¼Œè¿™ç§åˆ‡åˆ†è¢«æˆä¸ºç¿»æ»šæ—¶é—´çª—å£ï¼ˆTumbling Time Windowï¼‰ã€‚ç¿»æ»šçª—å£èƒ½å°†æ•°æ®æµåˆ‡åˆ†æˆä¸é‡å çš„çª—å£ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶åªèƒ½å±äºä¸€ä¸ªçª—å£ã€‚ 123456789// ç”¨æˆ·idå’Œè´­ä¹°æ•°é‡ streamval counts: DataStream[(Int, Int)] = ...val tumblingCnts: DataStream[(Int, Int)] = counts // ç”¨userIdåˆ†ç»„ .keyBy(0) // 1åˆ†é’Ÿçš„ç¿»æ»šçª—å£å®½åº¦ .timeWindow(Time.minutes(1)) // è®¡ç®—è´­ä¹°æ•°é‡ .sum(1) 2.2 Sliding Windowsæ»‘åŠ¨çª—å£ç”¨äºæ»šåŠ¨è¿›è¡Œèšåˆåˆ†æï¼Œä¾‹å¦‚ï¼šæ¯éš” 6 åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡è¿‡å»ä¸€å°æ—¶å†…æ‰€æœ‰å•†å“çš„ç‚¹å‡»é‡ï¼Œé‚£ä¹ˆç»Ÿè®¡çª—å£å½¼æ­¤ä¹‹é—´å°±æ˜¯å­˜åœ¨é‡å çš„ï¼Œå³ 1å¤©å¯ä»¥åˆ†ä¸º 240 ä¸ªçª—å£ã€‚å›¾ç¤ºå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ° window 1 - 4 è¿™å››ä¸ªçª—å£å½¼æ­¤ä¹‹é—´éƒ½å­˜åœ¨ç€æ—¶é—´ç›¸ç­‰çš„é‡å éƒ¨åˆ†ã€‚æƒ³è¦å®ç°æ»‘åŠ¨çª—å£ï¼Œåªéœ€è¦åœ¨ä½¿ç”¨ timeWindow æ–¹æ³•æ—¶é¢å¤–ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºæ»šåŠ¨æ—¶é—´å³å¯ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 12// æ¯éš”3ç§’ç»Ÿè®¡ä¸€æ¬¡è¿‡å»1åˆ†é’Ÿå†…çš„æ•°æ®keyBy(0).timeWindow(Time.minutes(1),Time.seconds(3)).sum(1) 2.3 Session Windowså½“ç”¨æˆ·åœ¨è¿›è¡ŒæŒç»­æµè§ˆæ—¶ï¼Œå¯èƒ½æ¯æ—¶æ¯åˆ»éƒ½ä¼šæœ‰ç‚¹å‡»æ•°æ®ï¼Œä¾‹å¦‚åœ¨æ´»åŠ¨åŒºé—´å†…ï¼Œç”¨æˆ·å¯èƒ½é¢‘ç¹çš„å°†æŸç±»å•†å“åŠ å…¥å’Œç§»é™¤è´­ç‰©è½¦ï¼Œè€Œä½ åªæƒ³çŸ¥é“ç”¨æˆ·æœ¬æ¬¡æµè§ˆæœ€ç»ˆçš„è´­ç‰©è½¦æƒ…å†µï¼Œæ­¤æ—¶å°±å¯ä»¥åœ¨ç”¨æˆ·æŒæœ‰çš„ä¼šè¯ç»“æŸåå†è¿›è¡Œç»Ÿè®¡ã€‚æƒ³è¦å®ç°è¿™ç±»ç»Ÿè®¡ï¼Œå¯ä»¥é€šè¿‡ Session Windows æ¥è¿›è¡Œå®ç°ã€‚ å…·ä½“çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š 1234// ä»¥å¤„ç†æ—¶é—´ä¸ºè¡¡é‡æ ‡å‡†ï¼Œå¦‚æœ10ç§’å†…æ²¡æœ‰ä»»ä½•æ•°æ®è¾“å…¥ï¼Œå°±è®¤ä¸ºä¼šè¯å·²ç»å…³é—­ï¼Œæ­¤æ—¶è§¦å‘ç»Ÿè®¡window(ProcessingTimeSessionWindows.withGap(Time.seconds(10)))// ä»¥äº‹ä»¶æ—¶é—´ä¸ºè¡¡é‡æ ‡å‡† window(EventTimeSessionWindows.withGap(Time.seconds(10))) 2.4 Global Windowsæœ€åä¸€ä¸ªçª—å£æ˜¯å…¨å±€çª—å£ï¼Œ å…¨å±€çª—å£ä¼šå°†æ‰€æœ‰ key ç›¸åŒçš„å…ƒç´ åˆ†é…åˆ°åŒä¸€ä¸ªçª—å£ä¸­ï¼Œå…¶é€šå¸¸é…åˆè§¦å‘å™¨ (trigger) è¿›è¡Œä½¿ç”¨ã€‚å¦‚æœæ²¡æœ‰ç›¸åº”è§¦å‘å™¨ï¼Œåˆ™è®¡ç®—å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚ è¿™é‡Œç»§ç»­ä»¥ä¸Šé¢è¯é¢‘ç»Ÿè®¡çš„æ¡ˆä¾‹ä¸ºä¾‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 12// å½“å•è¯ç´¯è®¡å‡ºç°çš„æ¬¡æ•°æ¯è¾¾åˆ°10æ¬¡æ—¶ï¼Œåˆ™è§¦å‘è®¡ç®—ï¼Œè®¡ç®—æ•´ä¸ªçª—å£å†…è¯¥å•è¯å‡ºç°çš„æ€»æ•°window(GlobalWindows.create()).trigger(CountTrigger.of(10)).sum(1).print(); ä¸‰ã€Count WindowsCount Windows ç”¨äºä»¥æ•°é‡ä¸ºç»´åº¦æ¥è¿›è¡Œæ•°æ®èšåˆï¼ŒåŒæ ·ä¹Ÿåˆ†ä¸ºæ»šåŠ¨çª—å£å’Œæ»‘åŠ¨çª—å£ï¼Œå®ç°æ–¹å¼ä¹Ÿå’Œæ—¶é—´çª—å£å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯è°ƒç”¨çš„ API ä¸åŒï¼Œå…·ä½“å¦‚ä¸‹ï¼š 1234// æ»šåŠ¨è®¡æ•°çª—å£ï¼Œæ¯1000æ¬¡ç‚¹å‡»åˆ™è®¡ç®—ä¸€æ¬¡countWindow(1000)// æ»‘åŠ¨è®¡æ•°çª—å£ï¼Œæ¯10æ¬¡ç‚¹å‡»å‘ç”Ÿåï¼Œåˆ™è®¡ç®—è¿‡å»1000æ¬¡ç‚¹å‡»çš„æƒ…å†µcountWindow(1000,10) å®é™…ä¸Šè®¡æ•°çª—å£å†…éƒ¨å°±æ˜¯è°ƒç”¨çš„æˆ‘ä»¬ä¸Šä¸€éƒ¨åˆ†ä»‹ç»çš„å…¨å±€çª—å£æ¥å®ç°çš„ï¼Œå…¶æºç å¦‚ä¸‹ï¼š 123456789public WindowedStream&lt;T, KEY, GlobalWindow&gt; countWindow(long size) &#123; return window(GlobalWindows.create()).trigger(PurgingTrigger.of(CountTrigger.of(size)));&#125;public WindowedStream&lt;T, KEY, GlobalWindow&gt; countWindow(long size, long slide) &#123; return window(GlobalWindows.create()) .evictor(CountEvictor.of(size)) .trigger(CountTrigger.of(slide));&#125;]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink-Kafka-Connector]]></title>
    <url>%2F2020%2F04%2F09%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F13-Flink-Kafka-Connector%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹Flink-kafka-connectorç”¨æ¥åšä»€ä¹ˆï¼Ÿ Kafkaä¸­çš„partitionæœºåˆ¶å’ŒFlinkçš„å¹¶è¡Œåº¦æœºåˆ¶ç»“åˆï¼Œå®ç°æ•°æ®æ¢å¤Kafkaå¯ä»¥ä½œä¸ºFlinkçš„sourceå’Œsinkä»»åŠ¡å¤±è´¥ï¼Œé€šè¿‡è®¾ç½®kafkaçš„offsetæ¥æ¢å¤åº”ç”¨ kafkaç®€å•ä»‹ç»å…³äºkafkaï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸“é¢˜æ–‡ç« ä»‹ç»ï¼Œè¿™é‡Œç®€å•ä»‹ç»å‡ ä¸ªå¿…é¡»çŸ¥é“çš„æ¦‚å¿µã€‚ 1.ç”Ÿäº§è€…ï¼ˆProducerï¼‰â€‹ é¡¾åæ€ä¹‰ï¼Œç”Ÿäº§è€…å°±æ˜¯ç”Ÿäº§æ¶ˆæ¯çš„ç»„ä»¶ï¼Œå®ƒçš„ä¸»è¦å·¥ä½œå°±æ˜¯æºæºä¸æ–­åœ°ç”Ÿäº§å‡ºæ¶ˆæ¯ï¼Œç„¶åå‘é€ç»™æ¶ˆæ¯é˜Ÿåˆ—ã€‚ç”Ÿäº§è€…å¯ä»¥å‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€å„ç§ç±»å‹çš„æ¶ˆæ¯ï¼Œå¦‚ç‹­ä¹‰çš„å­—ç¬¦ä¸²æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥å‘é€äºŒè¿›åˆ¶æ¶ˆæ¯ã€‚ç”Ÿäº§è€…æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æ•°æ®æºï¼Œåªæœ‰é€šè¿‡ç”Ÿäº§è€…æŒç»­ä¸æ–­åœ°å‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ‰èƒ½ä¸æ–­å¤„ç†æ¶ˆæ¯ã€‚2.æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰â€‹ æ‰€è°“æ¶ˆè´¹è€…ï¼ŒæŒ‡çš„æ˜¯ä¸æ–­æ¶ˆè´¹ï¼ˆè·å–ï¼‰æ¶ˆæ¯çš„ç»„ä»¶ï¼Œå®ƒè·å–æ¶ˆæ¯çš„æ¥æºå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå³Kafkaæœ¬èº«ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œç”Ÿäº§è€…ä¸æ–­å‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œè€Œæ¶ˆè´¹è€…åˆ™ä¸æ–­ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚3.ä¸»é¢˜ï¼ˆTopicï¼‰â€‹ ä¸»é¢˜æ˜¯Kafkaä¸­ä¸€ä¸ªæä¸ºé‡è¦çš„æ¦‚å¿µã€‚é¦–å…ˆï¼Œä¸»é¢˜æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå®ƒç”¨äºä»é€»è¾‘ä¸Šæ¥å½’ç±»ä¸å­˜å‚¨æ¶ˆæ¯æœ¬èº«ã€‚å¤šä¸ªç”Ÿäº§è€…å¯ä»¥å‘ä¸€ä¸ªTopicå‘é€æ¶ˆæ¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸€ä¸ªTopicä¸­çš„æ¶ˆæ¯ã€‚Topicè¿˜æœ‰åˆ†åŒºå’Œå‰¯æœ¬çš„æ¦‚å¿µã€‚Topicä¸æ¶ˆæ¯è¿™ä¸¤ä¸ªæ¦‚å¿µä¹‹é—´å¯†åˆ‡ç›¸å…³ï¼ŒKafkaä¸­çš„æ¯ä¸€æ¡æ¶ˆæ¯éƒ½å½’å±äºæŸä¸€ä¸ªTopicï¼Œè€Œä¸€ä¸ªTopicä¸‹é¢å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„æ¶ˆæ¯ã€‚ kafkaç®€å•æ“ä½œå¯åŠ¨zkï¼šnohup bin/zookeeper-server-start.sh config/zookeeper.properties &amp; å¯åŠ¨server: nohup bin/kafka-server-start.sh config/server.properties &amp; åˆ›å»ºä¸€ä¸ªtopicï¼šbin/kafka-topics.sh â€“create â€“zookeeper localhost:2181 â€“replication-factor 1 â€“partitions 1 â€“topic test æŸ¥çœ‹topicï¼šbin/kafka-topics.sh â€“list â€“zookeeper localhost:2181 å‘é€æ•°æ®ï¼šbin/kafka-console-producer.sh â€“broker-list localhost:9092 â€“topic test å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ï¼šbin/kafka-console-consumer.sh â€“bootstrap-server localhost:9092 â€“topic test â€“from-beginning åˆ é™¤topicï¼š bin/kafka-topics.sh â€“delete â€“zookeeper localhost:2181 â€“topic topn Flinkæ¶ˆè´¹Kafkaæ³¨æ„äº‹é¡¹ setStartFromGroupOffsets()ã€é»˜è®¤æ¶ˆè´¹ç­–ç•¥ã€‘ é»˜è®¤è¯»å–ä¸Šæ¬¡ä¿å­˜çš„offsetä¿¡æ¯å¦‚æœæ˜¯åº”ç”¨ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œè¯»å–ä¸åˆ°ä¸Šæ¬¡çš„offsetä¿¡æ¯ï¼Œåˆ™ä¼šæ ¹æ®è¿™ä¸ªå‚æ•°auto.offset.resetçš„å€¼æ¥è¿›è¡Œæ¶ˆè´¹æ•°æ® setStartFromEarliest()ä»æœ€æ—©çš„æ•°æ®å¼€å§‹è¿›è¡Œæ¶ˆè´¹ï¼Œå¿½ç•¥å­˜å‚¨çš„offsetä¿¡æ¯ setStartFromLatest()ä»æœ€æ–°çš„æ•°æ®è¿›è¡Œæ¶ˆè´¹ï¼Œå¿½ç•¥å­˜å‚¨çš„offsetä¿¡æ¯ setStartFromSpecificOffsets(Map&lt;KafkaTopicPartition, Long&gt;)ä»æŒ‡å®šä½ç½®è¿›è¡Œæ¶ˆè´¹ å½“checkpointæœºåˆ¶å¼€å¯çš„æ—¶å€™ï¼ŒKafkaConsumerä¼šå®šæœŸæŠŠkafkaçš„offsetä¿¡æ¯è¿˜æœ‰å…¶ä»–operatorçš„çŠ¶æ€ä¿¡æ¯ä¸€å—ä¿å­˜èµ·æ¥ã€‚å½“jobå¤±è´¥é‡å¯çš„æ—¶å€™ï¼ŒFlinkä¼šä»æœ€è¿‘ä¸€æ¬¡çš„checkpointä¸­è¿›è¡Œæ¢å¤æ•°æ®ï¼Œé‡æ–°æ¶ˆè´¹kafkaä¸­çš„æ•°æ®ã€‚ ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨æ”¯æŒå®¹é”™çš„kafka Consumerï¼Œéœ€è¦å¼€å¯checkpointenv.enableCheckpointing(5000); // æ¯5s checkpointä¸€æ¬¡ æ­å»ºKafkaå•æœºç¯å¢ƒæˆ‘æœ¬åœ°å®‰è£…äº†ä¸€ä¸ªkafka_2.11-2.1.0ç‰ˆæœ¬çš„kafka å¯åŠ¨Zookeeperå’Œkafka server: 123å¯åŠ¨zkï¼šnohup bin/zookeeper-server-start.sh config/zookeeper.properties &amp;å¯åŠ¨server: nohup bin/kafka-server-start.sh config/server.properties &amp; åˆ›å»ºä¸€ä¸ªtopic: 1bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test Kafkaä½œä¸ºFlink Sinké¦–å…ˆpomä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-kafka_2.11&lt;/artifactId&gt; &lt;version&gt;1.7.0&lt;/version&gt;&lt;/dependency&gt; å‘kafkaå†™å…¥æ•°æ®ï¼š 1234567891011121314151617181920public class KafkaProducer &#123; public static void main(String[] args) throws Exception&#123; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); DataStreamSource&lt;String&gt; text = env.addSource(new MyNoParalleSource()).setParallelism(1); Properties properties = new Properties(); properties.setProperty("bootstrap.servers", "localhost:9092"); //new FlinkKafkaProducer("topn",new KeyedSerializationSchemaWrapper(new SimpleStringSchema()),properties,FlinkKafkaProducer.Semantic.EXACTLY_ONCE); FlinkKafkaProducer&lt;String&gt; producer = new FlinkKafkaProducer("test",new SimpleStringSchema(),properties);/* //event-timestampäº‹ä»¶çš„å‘ç”Ÿæ—¶é—´ producer.setWriteTimestampToKafka(true);*/ text.addSink(producer); env.execute(); &#125;&#125;// å¤§å®¶è¿™é‡Œç‰¹åˆ«æ³¨æ„ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå¹¶è¡Œåº¦ä¸º1çš„MyNoParalleSourceæ¥ç”Ÿäº§æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637//ä½¿ç”¨å¹¶è¡Œåº¦ä¸º1çš„sourcepublic class MyNoParalleSource implements SourceFunction&lt;String&gt; &#123;//1 //private long count = 1L; private boolean isRunning = true; /** * ä¸»è¦çš„æ–¹æ³• * å¯åŠ¨ä¸€ä¸ªsource * å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½éœ€è¦åœ¨è¿™ä¸ªrunæ–¹æ³•ä¸­å®ç°ä¸€ä¸ªå¾ªç¯ï¼Œè¿™æ ·å°±å¯ä»¥å¾ªç¯äº§ç”Ÿæ•°æ®äº† * * @param ctx * @throws Exception */ @Override public void run(SourceContext&lt;String&gt; ctx) throws Exception &#123; while(isRunning)&#123; //å›¾ä¹¦çš„æ’è¡Œæ¦œ List&lt;String&gt; books = new ArrayList&lt;&gt;(); books.add("Pyhtonä»å…¥é—¨åˆ°æ”¾å¼ƒ");//10 books.add("Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ");//8 books.add("Phpä»å…¥é—¨åˆ°æ”¾å¼ƒ");//5 books.add("C++ä»å…¥é—¨åˆ°æ”¾å¼ƒ");//3 books.add("Scalaä»å…¥é—¨åˆ°æ”¾å¼ƒ");//0-4 int i = new Random().nextInt(5); ctx.collect(books.get(i)); //æ¯2ç§’äº§ç”Ÿä¸€æ¡æ•°æ® Thread.sleep(2000); &#125; &#125; //å–æ¶ˆä¸€ä¸ªcancelçš„æ—¶å€™ä¼šè°ƒç”¨çš„æ–¹æ³• @Override public void cancel() &#123; isRunning = false; &#125;&#125; ä»£ç å®ç°äº†ä¸€ä¸ªå‘é€å™¨ï¼Œæ¥å‘é€ä¹¦å&lt;Pyhtonä»å…¥é—¨åˆ°æ”¾å¼ƒ&gt;&lt;Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ&gt;ç­‰â€¦ ç„¶åå³é”®è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š å¼€å§‹æºæºä¸æ–­çš„ç”Ÿäº§æ•°æ®äº†ã€‚ ç„¶åæˆ‘ä»¬ç”¨å‘½ä»¤å»æŸ¥çœ‹ä¸€ä¸‹ kafka testè¿™ä¸ªtopicï¼š 1bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning è¾“å‡ºå¦‚ä¸‹ï¼š Kafkaä½œä¸ºFlink Sourceç›´æ¥ä¸Šä»£ç ï¼š 123456789101112131415161718public class KafkaConsumer &#123; public static void main(String[] args) throws Exception&#123; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); Properties properties = new Properties(); properties.setProperty("bootstrap.servers", "localhost:9092"); FlinkKafkaConsumer&lt;String&gt; consumer = new FlinkKafkaConsumer&lt;&gt;("test", new SimpleStringSchema(), properties); //ä»æœ€æ—©å¼€å§‹æ¶ˆè´¹ consumer.setStartFromEarliest(); DataStream&lt;String&gt; stream = env .addSource(consumer); stream.print(); //stream.map(); env.execute(); &#125;&#125; æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š å°†æˆ‘ä»¬ä¹‹å‰å‘å¾€kafkaçš„æ¶ˆæ¯å…¨éƒ¨æ‰“å°å‡ºæ¥äº†ã€‚]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink ä»‹ç»]]></title>
    <url>%2F2020%2F04%2F09%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F1-Flink%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[ä¸€ã€Flink ç®€ä»‹Apache Flink è¯ç”ŸäºæŸæ—å·¥ä¸šå¤§å­¦çš„ä¸€ä¸ªç ”ç©¶æ€§é¡¹ç›®ï¼ŒåŸå StratoSphere ã€‚2014 å¹´ï¼Œç”± StratoSphere é¡¹ç›®å­µåŒ–å‡º Flinkï¼Œå¹¶äºåŒå¹´æèµ  Apacheï¼Œä¹‹åæˆä¸º Apache çš„é¡¶çº§é¡¹ç›®ã€‚2019 å¹´ 1 å¹´ï¼Œé˜¿é‡Œå·´å·´æ”¶è´­äº† Flink çš„æ¯å…¬å¸ Data Artisansï¼Œå¹¶å®£å¸ƒå¼€æºå†…éƒ¨çš„ Blinkï¼ŒBlink æ˜¯é˜¿é‡Œå·´å·´åŸºäº Flink ä¼˜åŒ–åçš„ç‰ˆæœ¬ï¼Œå¢åŠ äº†å¤§é‡çš„æ–°åŠŸèƒ½ï¼Œå¹¶åœ¨æ€§èƒ½å’Œç¨³å®šæ€§ä¸Šè¿›è¡Œäº†å„ç§ä¼˜åŒ–ï¼Œç»å†è¿‡é˜¿é‡Œå†…éƒ¨å¤šç§å¤æ‚ä¸šåŠ¡çš„æŒ‘æˆ˜å’Œæ£€éªŒã€‚åŒæ—¶é˜¿é‡Œå·´å·´ä¹Ÿè¡¨ç¤ºä¼šé€æ­¥å°†è¿™äº›æ–°åŠŸèƒ½å’Œç‰¹æ€§ Merge å›ç¤¾åŒºç‰ˆæœ¬çš„ Flink ä¸­ï¼Œå› æ­¤ Flink æˆä¸ºç›®å‰æœ€ä¸ºç«çƒ­çš„å¤§æ•°æ®å¤„ç†æ¡†æ¶ã€‚ ç®€å•æ¥è¯´ï¼ŒFlink æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¤„ç†æ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿå¯¹æœ‰ç•Œå’Œæ— ç•Œçš„æ•°æ®æµè¿›è¡Œé«˜æ•ˆçš„å¤„ç†ã€‚Flink çš„æ ¸å¿ƒæ˜¯æµå¤„ç†ï¼Œå½“ç„¶å®ƒä¹Ÿèƒ½æ”¯æŒæ‰¹å¤„ç†ï¼ŒFlink å°†æ‰¹å¤„ç†çœ‹æˆæ˜¯æµå¤„ç†çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå³æ•°æ®æµæ˜¯æœ‰æ˜ç¡®ç•Œé™çš„ã€‚è¿™å’Œ Spark Streaming çš„æ€æƒ³æ˜¯å®Œå…¨ç›¸åçš„ï¼ŒSpark Streaming çš„æ ¸å¿ƒæ˜¯æ‰¹å¤„ç†ï¼Œå®ƒå°†æµå¤„ç†çœ‹æˆæ˜¯æ‰¹å¤„ç†çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œ å³æŠŠæ•°æ®æµè¿›è¡Œæå°ç²’åº¦çš„æ‹†åˆ†ï¼Œæ‹†åˆ†ä¸ºå¤šä¸ªå¾®æ‰¹å¤„ç†ã€‚ Flink æœ‰ç•Œæ•°æ®æµå’Œæ— ç•Œæ•°æ®æµï¼š Spark Streaming æ•°æ®æµçš„æ‹†åˆ†ï¼š äºŒã€Flink æ ¸å¿ƒæ¶æ„2.0 Flinkç»„ä»¶æ ˆFlink é‡‡ç”¨åˆ†å±‚çš„æ¶æ„è®¾è®¡ï¼Œä»è€Œä¿è¯å„å±‚åœ¨åŠŸèƒ½å’ŒèŒè´£ä¸Šçš„æ¸…æ™°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”±ä¸Šè€Œä¸‹åˆ†åˆ«æ˜¯ API &amp; Libraries å±‚ã€Runtime æ ¸å¿ƒå±‚ä»¥åŠç‰©ç†éƒ¨ç½²å±‚ï¼š 2.1 API &amp; Libraries å±‚è¿™ä¸€å±‚ä¸»è¦æä¾›äº†ç¼–ç¨‹ API å’Œ é¡¶å±‚ç±»åº“ï¼š ç¼–ç¨‹ API : ç”¨äºè¿›è¡Œæµå¤„ç†çš„ DataStream API å’Œç”¨äºè¿›è¡Œæ‰¹å¤„ç†çš„ DataSet APIï¼› é¡¶å±‚ç±»åº“ï¼šåŒ…æ‹¬ç”¨äºå¤æ‚äº‹ä»¶å¤„ç†çš„ CEP åº“ï¼›ç”¨äºç»“æ„åŒ–æ•°æ®æŸ¥è¯¢çš„ SQL &amp; Table åº“ï¼Œä»¥åŠåŸºäºæ‰¹å¤„ç†çš„æœºå™¨å­¦ä¹ åº“ FlinkML å’Œ å›¾å½¢å¤„ç†åº“ Gellyã€‚ 2.2 Runtime æ ¸å¿ƒå±‚è¿™ä¸€å±‚æ˜¯ Flink åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶çš„æ ¸å¿ƒå®ç°å±‚ï¼ŒåŒ…æ‹¬ä½œä¸šè½¬æ¢ï¼Œä»»åŠ¡è°ƒåº¦ï¼Œèµ„æºåˆ†é…ï¼Œä»»åŠ¡æ‰§è¡Œç­‰åŠŸèƒ½ï¼ŒåŸºäºè¿™ä¸€å±‚çš„å®ç°ï¼Œå¯ä»¥åœ¨æµå¼å¼•æ“ä¸‹åŒæ—¶è¿è¡Œæµå¤„ç†ç¨‹åºå’Œæ‰¹å¤„ç†ç¨‹åºã€‚æ¯”å¦‚ï¼šæ”¯æŒåˆ†å¸ƒå¼Streamå¤„ç†ã€JobGraphåˆ°ExecutionGraphçš„æ˜ å°„ã€è°ƒåº¦ç­‰ç­‰ï¼Œä¸ºä¸Šå±‚APIå±‚æä¾›åŸºç¡€æœåŠ¡ 2.3 ç‰©ç†éƒ¨ç½²å±‚Flink çš„ç‰©ç†éƒ¨ç½²å±‚ï¼Œç”¨äºæ”¯æŒåœ¨ä¸åŒå¹³å°ä¸Šéƒ¨ç½²è¿è¡Œ Flink åº”ç”¨ã€‚ ä¸»è¦æ¶‰åŠäº†Flinkçš„éƒ¨ç½²æ¨¡å¼ï¼ŒFlinkæ”¯æŒå¤šç§éƒ¨ç½²æ¨¡å¼ï¼šæœ¬åœ°ã€é›†ç¾¤ï¼ˆStandalone/YARNï¼‰ã€äº‘ï¼ˆGCE/EC2ï¼‰ ä¸‰ã€Flink åˆ†å±‚ APIåœ¨ä¸Šé¢ä»‹ç»çš„ API &amp; Libraries è¿™ä¸€å±‚ï¼ŒFlink åˆè¿›è¡Œäº†æ›´ä¸ºå…·ä½“çš„åˆ’åˆ†ã€‚å…·ä½“å¦‚ä¸‹ï¼š æŒ‰ç…§å¦‚ä¸Šçš„å±‚æ¬¡ç»“æ„ï¼ŒAPI çš„ä¸€è‡´æ€§ç”±ä¸‹è‡³ä¸Šä¾æ¬¡é€’å¢ï¼Œæ¥å£çš„è¡¨ç°èƒ½åŠ›ç”±ä¸‹è‡³ä¸Šä¾æ¬¡é€’å‡ï¼Œå„å±‚çš„æ ¸å¿ƒåŠŸèƒ½å¦‚ä¸‹ï¼š 3.1 SQL &amp; Table APISQL &amp; Table API åŒæ—¶é€‚ç”¨äºæ‰¹å¤„ç†å’Œæµå¤„ç†ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥å¯¹æœ‰ç•Œæ•°æ®æµå’Œæ— ç•Œæ•°æ®æµä»¥ç›¸åŒçš„è¯­ä¹‰è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶äº§ç”Ÿç›¸åŒçš„ç»“æœã€‚é™¤äº†åŸºæœ¬æŸ¥è¯¢å¤–ï¼Œ å®ƒè¿˜æ”¯æŒè‡ªå®šä¹‰çš„æ ‡é‡å‡½æ•°ï¼Œèšåˆå‡½æ•°ä»¥åŠè¡¨å€¼å‡½æ•°ï¼Œå¯ä»¥æ»¡è¶³å¤šæ ·åŒ–çš„æŸ¥è¯¢éœ€æ±‚ã€‚ 3.2 DataStream &amp; DataSet APIDataStream &amp; DataSet API æ˜¯ Flink æ•°æ®å¤„ç†çš„æ ¸å¿ƒ APIï¼Œæ”¯æŒä½¿ç”¨ Java è¯­è¨€æˆ– Scala è¯­è¨€è¿›è¡Œè°ƒç”¨ï¼Œæä¾›äº†æ•°æ®è¯»å–ï¼Œæ•°æ®è½¬æ¢å’Œæ•°æ®è¾“å‡ºç­‰ä¸€ç³»åˆ—å¸¸ç”¨æ“ä½œçš„å°è£…ã€‚ 3.3 Stateful Stream ProcessingStateful Stream Processing æ˜¯æœ€ä½çº§åˆ«çš„æŠ½è±¡ï¼Œå®ƒé€šè¿‡ Process Function å‡½æ•°å†…åµŒåˆ° DataStream API ä¸­ã€‚ Process Function æ˜¯ Flink æä¾›çš„æœ€åº•å±‚ APIï¼Œå…·æœ‰æœ€å¤§çš„çµæ´»æ€§ï¼Œå…è®¸å¼€å‘è€…å¯¹äºæ—¶é—´å’ŒçŠ¶æ€è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ã€‚ å››ã€Flink é›†ç¾¤æ¶æ„4.1 æ ¸å¿ƒç»„ä»¶æŒ‰ç…§ä¸Šé¢çš„ä»‹ç»ï¼ŒFlink æ ¸å¿ƒæ¶æ„çš„ç¬¬äºŒå±‚æ˜¯ Runtime å±‚ï¼Œ è¯¥å±‚é‡‡ç”¨æ ‡å‡†çš„ Master - Slave ç»“æ„ï¼Œ å…¶ä¸­ï¼ŒMaster éƒ¨åˆ†åˆåŒ…å«äº†ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼šDispatcherã€ResourceManager å’Œ JobManagerï¼Œè€Œ Slave åˆ™ä¸»è¦æ˜¯ TaskManager è¿›ç¨‹ã€‚å®ƒä»¬çš„åŠŸèƒ½åˆ†åˆ«å¦‚ä¸‹ï¼š JobManagers (ä¹Ÿç§°ä¸º masters) ï¼šJobManagers æ¥æ”¶ç”± Dispatcher ä¼ é€’è¿‡æ¥çš„æ‰§è¡Œç¨‹åºï¼Œè¯¥æ‰§è¡Œç¨‹åºåŒ…å«äº†ä½œä¸šå›¾ (JobGraph)ï¼Œé€»è¾‘æ•°æ®æµå›¾ (logical dataflow graph) åŠå…¶æ‰€æœ‰çš„ classes æ–‡ä»¶ä»¥åŠç¬¬ä¸‰æ–¹ç±»åº“ (libraries) ç­‰ç­‰ ã€‚ç´§æ¥ç€ JobManagers ä¼šå°† JobGraph è½¬æ¢ä¸ºæ‰§è¡Œå›¾ (ExecutionGraph)ï¼Œç„¶åå‘ ResourceManager ç”³è¯·èµ„æºæ¥æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œä¸€æ—¦ç”³è¯·åˆ°èµ„æºï¼Œå°±å°†æ‰§è¡Œå›¾åˆ†å‘ç»™å¯¹åº”çš„ TaskManagers ã€‚å› æ­¤æ¯ä¸ªä½œä¸š (Job) è‡³å°‘æœ‰ä¸€ä¸ª JobManagerï¼›é«˜å¯ç”¨éƒ¨ç½²ä¸‹å¯ä»¥æœ‰å¤šä¸ª JobManagersï¼Œå…¶ä¸­ä¸€ä¸ªä½œä¸º leaderï¼Œå…¶ä½™çš„åˆ™å¤„äº standby çŠ¶æ€ã€‚ TaskManagers (ä¹Ÿç§°ä¸º workers) : TaskManagers è´Ÿè´£å®é™…çš„å­ä»»åŠ¡ (subtasks) çš„æ‰§è¡Œï¼Œæ¯ä¸ª TaskManagers éƒ½æ‹¥æœ‰ä¸€å®šæ•°é‡çš„ slotsã€‚Slot æ˜¯ä¸€ç»„å›ºå®šå¤§å°çš„èµ„æºçš„åˆé›† (å¦‚è®¡ç®—èƒ½åŠ›ï¼Œå­˜å‚¨ç©ºé—´)ã€‚TaskManagers å¯åŠ¨åï¼Œä¼šå°†å…¶æ‰€æ‹¥æœ‰çš„ slots æ³¨å†Œåˆ° ResourceManager ä¸Šï¼Œç”± ResourceManager è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚ Dispatcherï¼šè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯æäº¤çš„æ‰§è¡Œç¨‹åºï¼Œå¹¶ä¼ é€’ç»™ JobManager ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æä¾›äº†ä¸€ä¸ª WEB UI ç•Œé¢ï¼Œç”¨äºç›‘æ§ä½œä¸šçš„æ‰§è¡Œæƒ…å†µã€‚ Clientï¼š ç”¨æˆ·æäº¤ä¸€ä¸ªFlinkç¨‹åºæ—¶ï¼Œä¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ªClientï¼Œè¯¥Clienté¦–å…ˆä¼šå¯¹ç”¨æˆ·æäº¤çš„Flinkç¨‹åºè¿›è¡Œé¢„å¤„ç†ï¼Œå¹¶æäº¤åˆ°Flinké›†ç¾¤ï¼Œ Clientä¼šå°†ç”¨æˆ·æäº¤çš„Flinkç¨‹åºç»„è£…ä¸€ä¸ªJobGraphï¼Œ å¹¶ä¸”æ˜¯ä»¥JobGraphçš„å½¢å¼æäº¤çš„ ResourceManager ï¼šè´Ÿè´£ç®¡ç† slots å¹¶åè°ƒé›†ç¾¤èµ„æºã€‚ResourceManager æ¥æ”¶æ¥è‡ª JobManager çš„èµ„æºè¯·æ±‚ï¼Œå¹¶å°†å­˜åœ¨ç©ºé—² slots çš„ TaskManagers åˆ†é…ç»™ JobManager æ‰§è¡Œä»»åŠ¡ã€‚Flink åŸºäºä¸åŒçš„éƒ¨ç½²å¹³å°ï¼Œå¦‚ YARN , Mesosï¼ŒK8s ç­‰æä¾›äº†ä¸åŒçš„èµ„æºç®¡ç†å™¨ï¼Œå½“ TaskManagers æ²¡æœ‰è¶³å¤Ÿçš„ slots æ¥æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒä¼šå‘ç¬¬ä¸‰æ–¹å¹³å°å‘èµ·ä¼šè¯æ¥è¯·æ±‚é¢å¤–çš„èµ„æºã€‚ 4.2 Task &amp; SubTaskä¸Šé¢æˆ‘ä»¬æåˆ°ï¼šTaskManagers å®é™…æ‰§è¡Œçš„æ˜¯ SubTaskï¼Œè€Œä¸æ˜¯ Taskï¼Œè¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸¤è€…çš„åŒºåˆ«ï¼š åœ¨æ‰§è¡Œåˆ†å¸ƒå¼è®¡ç®—æ—¶ï¼ŒFlink å°†å¯ä»¥é“¾æ¥çš„æ“ä½œ (operators) é“¾æ¥åˆ°ä¸€èµ·ï¼Œè¿™å°±æ˜¯ Taskã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšï¼Œ æ˜¯ä¸ºäº†å‡å°‘çº¿ç¨‹é—´åˆ‡æ¢å’Œç¼“å†²è€Œå¯¼è‡´çš„å¼€é”€ï¼Œåœ¨é™ä½å»¶è¿Ÿçš„åŒæ—¶å¯ä»¥æé«˜æ•´ä½“çš„ååé‡ã€‚ ä½†ä¸æ˜¯æ‰€æœ‰çš„ operator éƒ½å¯ä»¥è¢«é“¾æ¥ï¼Œå¦‚ä¸‹ keyBy ç­‰æ“ä½œä¼šå¯¼è‡´ç½‘ç»œ shuffle å’Œé‡åˆ†åŒºï¼Œå› æ­¤å…¶å°±ä¸èƒ½è¢«é“¾æ¥ï¼Œåªèƒ½è¢«å•ç‹¬ä½œä¸ºä¸€ä¸ª Taskã€‚ ç®€å•æ¥è¯´ï¼Œä¸€ä¸ª Task å°±æ˜¯ä¸€ä¸ªå¯ä»¥é“¾æ¥çš„æœ€å°çš„æ“ä½œé“¾ (Operator Chains) ã€‚å¦‚ä¸‹å›¾ï¼Œsource å’Œ map ç®—å­è¢«é“¾æ¥åˆ°ä¸€å—ï¼Œå› æ­¤æ•´ä¸ªä½œä¸šå°±åªæœ‰ä¸‰ä¸ª Taskï¼š è§£é‡Šå®Œ Task ï¼Œæˆ‘ä»¬åœ¨è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ SubTaskï¼Œå…¶å‡†ç¡®çš„ç¿»è¯‘æ˜¯ï¼š A subtask is one parallel slice of a taskï¼Œå³ä¸€ä¸ª Task å¯ä»¥æŒ‰ç…§å…¶å¹¶è¡Œåº¦æ‹†åˆ†ä¸ºå¤šä¸ª SubTaskã€‚å¦‚ä¸Šå›¾ï¼Œsource &amp; map å…·æœ‰ä¸¤ä¸ªå¹¶è¡Œåº¦ï¼ŒKeyBy å…·æœ‰ä¸¤ä¸ªå¹¶è¡Œåº¦ï¼ŒSink å…·æœ‰ä¸€ä¸ªå¹¶è¡Œåº¦ï¼Œå› æ­¤æ•´ä¸ªè™½ç„¶åªæœ‰ 3 ä¸ª Taskï¼Œä½†æ˜¯å´æœ‰ 5 ä¸ª SubTaskã€‚Jobmanager è´Ÿè´£å®šä¹‰å’Œæ‹†åˆ†è¿™äº› SubTaskï¼Œå¹¶å°†å…¶äº¤ç»™ Taskmanagers æ¥æ‰§è¡Œï¼Œæ¯ä¸ª SubTask éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ã€‚ 4.3 èµ„æºç®¡ç†ç†è§£äº† SubTasks ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å…¶ä¸ Slots çš„å¯¹åº”æƒ…å†µã€‚ä¸€ç§å¯èƒ½çš„åˆ†é…æƒ…å†µå¦‚ä¸‹ï¼š è¿™æ—¶æ¯ä¸ª SubTask çº¿ç¨‹è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„ TaskSlotï¼Œ å®ƒä»¬å…±äº«æ‰€å±çš„ TaskManager è¿›ç¨‹çš„TCP è¿æ¥ï¼ˆé€šè¿‡å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼‰å’Œå¿ƒè·³ä¿¡æ¯ (heartbeat messages)ï¼Œä»è€Œå¯ä»¥é™ä½æ•´ä½“çš„æ€§èƒ½å¼€é”€ã€‚æ­¤æ—¶çœ‹ä¼¼æ˜¯æœ€å¥½çš„æƒ…å†µï¼Œä½†æ˜¯æ¯ä¸ªæ“ä½œéœ€è¦çš„èµ„æºéƒ½æ˜¯ä¸å°½ç›¸åŒçš„ï¼Œè¿™é‡Œå‡è®¾è¯¥ä½œä¸š keyBy æ“ä½œæ‰€éœ€èµ„æºçš„æ•°é‡æ¯” Sink å¤šå¾ˆå¤š ï¼Œé‚£ä¹ˆæ­¤æ—¶ Sink æ‰€åœ¨ Slot çš„èµ„æºå°±æ²¡æœ‰å¾—åˆ°æœ‰æ•ˆçš„åˆ©ç”¨ã€‚ åŸºäºè¿™ä¸ªåŸå› ï¼ŒFlink å…è®¸å¤šä¸ª subtasks å…±äº« slotsï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒ tasks çš„ subtasksï¼Œä½†åªè¦å®ƒä»¬æ¥è‡ªåŒä¸€ä¸ª Job å°±å¯ä»¥ã€‚å‡è®¾ä¸Šé¢ souce &amp; map å’Œ keyBy çš„å¹¶è¡Œåº¦è°ƒæ•´ä¸º 6ï¼Œè€Œ Slot çš„æ•°é‡ä¸å˜ï¼Œæ­¤æ—¶æƒ…å†µå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ä¸€ä¸ª Task Slot ä¸­è¿è¡Œäº†å¤šä¸ª SubTask å­ä»»åŠ¡ï¼Œæ­¤æ—¶æ¯ä¸ªå­ä»»åŠ¡ä»ç„¶åœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œåªä¸è¿‡å…±äº«ä¸€ç»„ Sot èµ„æºè€Œå·²ã€‚é‚£ä¹ˆ Flink åˆ°åº•å¦‚ä½•ç¡®å®šä¸€ä¸ª Job è‡³å°‘éœ€è¦å¤šå°‘ä¸ª Slot å‘¢ï¼ŸFlink å¯¹äºè¿™ä¸ªé—®é¢˜çš„å¤„ç†å¾ˆç®€å•ï¼Œé»˜è®¤æƒ…å†µä¸€ä¸ª Job æ‰€éœ€è¦çš„ Slot çš„æ•°é‡å°±ç­‰äºå…¶ Operation æ“ä½œçš„æœ€é«˜å¹¶è¡Œåº¦ã€‚å¦‚ä¸‹ï¼Œ Aï¼ŒBï¼ŒD æ“ä½œçš„å¹¶è¡Œåº¦ä¸º 4ï¼Œè€Œ Cï¼ŒE æ“ä½œçš„å¹¶è¡Œåº¦ä¸º 2ï¼Œé‚£ä¹ˆæ­¤æ—¶æ•´ä¸ª Job å°±éœ€è¦è‡³å°‘å››ä¸ª Slots æ¥å®Œæˆã€‚é€šè¿‡è¿™ä¸ªæœºåˆ¶ï¼ŒFlink å°±å¯ä»¥ä¸å¿…å»å…³å¿ƒä¸€ä¸ª Job åˆ°åº•ä¼šè¢«æ‹†åˆ†ä¸ºå¤šå°‘ä¸ª Tasks å’Œ SubTasksã€‚ 4.4 ç»„ä»¶é€šè®¯ Flinkæ˜¯åŸºäºMaster-Slaveé£æ ¼çš„æ¶æ„ Flinké›†ç¾¤å¯åŠ¨æ—¶ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªJobManagerè¿›ç¨‹ã€è‡³å°‘ä¸€ä¸ªTaskManagerè¿›ç¨‹ Flink çš„æ‰€æœ‰ç»„ä»¶éƒ½åŸºäº Actor System æ¥è¿›è¡Œé€šè®¯ã€‚Actor systemæ˜¯å¤šç§è§’è‰²çš„ actor çš„å®¹å™¨ï¼Œå®ƒæä¾›è°ƒåº¦ï¼Œé…ç½®ï¼Œæ—¥å¿—è®°å½•ç­‰å¤šç§æœåŠ¡ï¼Œå¹¶åŒ…å«ä¸€ä¸ªå¯ä»¥å¯åŠ¨æ‰€æœ‰ actor çš„çº¿ç¨‹æ± ï¼Œå¦‚æœ actor æ˜¯æœ¬åœ°çš„ï¼Œåˆ™æ¶ˆæ¯é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œå…±äº«ï¼Œä½†å¦‚æœ actor æ˜¯è¿œç¨‹çš„ï¼Œåˆ™é€šè¿‡ RPC çš„è°ƒç”¨æ¥ä¼ é€’æ¶ˆæ¯ã€‚ äº”ã€Flinkç¼–ç¨‹æ¨¡å‹ Flinkç¨‹åºçš„åŸºç¡€æ„å»ºæ¨¡å—æ˜¯æµ(streams) ä¸ è½¬æ¢(transformations) æ¯ä¸€ä¸ªæ•°æ®æµèµ·å§‹äºä¸€ä¸ªæˆ–å¤šä¸ª sourceï¼Œå¹¶ç»ˆæ­¢äºä¸€ä¸ªæˆ–å¤šä¸ª sink æ¯ä¸€ä¸ªæ•°æ®æµèµ·å§‹äºä¸€ä¸ªæˆ–å¤šä¸ª sourceï¼Œå¹¶ç»ˆæ­¢äºä¸€ä¸ªæˆ–å¤šä¸ª sink ä¸‹é¢æ˜¯ä¸€ä¸ªç”±Flinkç¨‹åºæ˜ å°„ä¸ºStreaming Dataflowçš„ç¤ºæ„å›¾: å¹¶è¡Œæ•°æ®æµç¤ºæ„å›¾: äº”ã€Flinkçš„ä¼˜åŠ¿ æ”¯æŒé«˜ååã€ä½å»¶è¿Ÿã€é«˜æ€§èƒ½çš„æµå¤„ç† æ”¯æŒé«˜åº¦çµæ´»çš„çª—å£ï¼ˆWindowï¼‰æ“ä½œ æ”¯æŒæœ‰çŠ¶æ€è®¡ç®—çš„Exactly-onceè¯­ä¹‰ æä¾›DataStream APIå’ŒDataSet API æä¾›DataStream APIå’ŒDataSet API å…­ã€Flink çš„ä¼˜ç‚¹æœ€ååŸºäºä¸Šé¢çš„ä»‹ç»ï¼Œæ¥æ€»ç»“ä¸€ä¸‹ Flink çš„ä¼˜ç‚¹ï¼š Flink æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨ (Event-driven) çš„åº”ç”¨ï¼Œèƒ½å¤ŸåŒæ—¶æ”¯æŒæµå¤„ç†å’Œæ‰¹å¤„ç†ï¼› åŸºäºå†…å­˜çš„è®¡ç®—ï¼Œèƒ½å¤Ÿä¿è¯é«˜ååå’Œä½å»¶è¿Ÿï¼Œå…·æœ‰ä¼˜è¶Šçš„æ€§èƒ½è¡¨ç°ï¼› æ”¯æŒç²¾ç¡®ä¸€æ¬¡ (Exactly-once) è¯­æ„ï¼Œèƒ½å¤Ÿå®Œç¾åœ°ä¿è¯ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ï¼› åˆ†å±‚ API ï¼Œèƒ½å¤Ÿæ»¡è¶³å„ä¸ªå±‚æ¬¡çš„å¼€å‘éœ€æ±‚ï¼› æ”¯æŒé«˜å¯ç”¨é…ç½®ï¼Œæ”¯æŒä¿å­˜ç‚¹æœºåˆ¶ï¼Œèƒ½å¤Ÿæä¾›å®‰å…¨æ€§å’Œç¨³å®šæ€§ä¸Šçš„ä¿è¯ï¼› å¤šæ ·åŒ–çš„éƒ¨ç½²æ–¹å¼ï¼Œæ”¯æŒæœ¬åœ°ï¼Œè¿œç«¯ï¼Œäº‘ç«¯ç­‰å¤šç§éƒ¨ç½²æ–¹æ¡ˆï¼› å…·æœ‰æ¨ªå‘æ‰©å±•æ¶æ„ï¼Œèƒ½å¤ŸæŒ‰ç…§ç”¨æˆ·çš„éœ€æ±‚è¿›è¡ŒåŠ¨æ€æ‰©å®¹ï¼› æ´»è·ƒåº¦æé«˜çš„ç¤¾åŒºå’Œå®Œå–„çš„ç”Ÿæ€åœˆçš„æ”¯æŒã€‚ ä¸ƒã€ å¼€å‘ç¯å¢ƒæ­å»ºä½¿ç”¨ IDEA æ„å»ºå¦‚æœä½ ä½¿ç”¨çš„æ˜¯å¼€å‘å·¥å…·æ˜¯ IDEA ï¼Œå¯ä»¥ç›´æ¥åœ¨é¡¹ç›®åˆ›å»ºé¡µé¢é€‰æ‹© Maven Flink Archetype è¿›è¡Œé¡¹ç›®åˆå§‹åŒ–ï¼š å¦‚æœä½ çš„ IDEA æ²¡æœ‰ä¸Šè¿° Archetypeï¼Œ å¯ä»¥é€šè¿‡ç‚¹å‡»å³ä¸Šè§’çš„ ADD ARCHETYPE ï¼Œæ¥è¿›è¡Œæ·»åŠ ï¼Œä¾æ¬¡å¡«å…¥æ‰€éœ€ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éƒ½å¯ä»¥ä»ä¸Šè¿°çš„ archetype:generate è¯­å¥ä¸­è·å–ã€‚ç‚¹å‡» OK ä¿å­˜åï¼Œè¯¥ Archetype å°±ä¼šä¸€ç›´å­˜åœ¨äºä½ çš„ IDEA ä¸­ï¼Œä¹‹åæ¯æ¬¡åˆ›å»ºé¡¹ç›®æ—¶ï¼Œåªéœ€è¦ç›´æ¥é€‰æ‹©è¯¥ Archetype å³å¯ï¼š é€‰ä¸­ Flink Archetype ï¼Œç„¶åç‚¹å‡» NEXT æŒ‰é’®ï¼Œä¹‹åçš„æ‰€æœ‰æ­¥éª¤éƒ½å’Œæ­£å¸¸çš„ Maven å·¥ç¨‹ç›¸åŒã€‚ é¡¹ç›®ç»“æ„åˆ›å»ºå®Œæˆåçš„è‡ªåŠ¨ç”Ÿæˆçš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š å…¶ä¸­ BatchJob ä¸ºæ‰¹å¤„ç†çš„æ ·ä¾‹ä»£ç ï¼Œæºç å¦‚ä¸‹ï¼š 123456789import org.apache.flink.api.scala._object BatchJob &#123; def main(args: Array[String]) &#123; val env = ExecutionEnvironment.getExecutionEnvironment .... env.execute("Flink Batch Scala API Skeleton") &#125;&#125; getExecutionEnvironment ä»£è¡¨è·å–æ‰¹å¤„ç†çš„æ‰§è¡Œç¯å¢ƒï¼Œå¦‚æœæ˜¯æœ¬åœ°è¿è¡Œåˆ™è·å–åˆ°çš„å°±æ˜¯æœ¬åœ°çš„æ‰§è¡Œç¯å¢ƒï¼›å¦‚æœåœ¨é›†ç¾¤ä¸Šè¿è¡Œï¼Œå¾—åˆ°çš„å°±æ˜¯é›†ç¾¤çš„æ‰§è¡Œç¯å¢ƒã€‚å¦‚æœæƒ³è¦è·å–æµå¤„ç†çš„æ‰§è¡Œç¯å¢ƒï¼Œåˆ™åªéœ€è¦å°† ExecutionEnvironment æ›¿æ¢ä¸º StreamExecutionEnvironmentï¼Œ å¯¹åº”çš„ä»£ç æ ·ä¾‹åœ¨ StreamingJob ä¸­ï¼š 123456789import org.apache.flink.streaming.api.scala._object StreamingJob &#123; def main(args: Array[String]) &#123; val env = StreamExecutionEnvironment.getExecutionEnvironment ... env.execute("Flink Streaming Scala API Skeleton") &#125;&#125; éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºæµå¤„ç†é¡¹ç›® env.execute() è¿™å¥ä»£ç æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™æµå¤„ç†ç¨‹åºå°±ä¸ä¼šè¢«æ‰§è¡Œï¼Œä½†æ˜¯å¯¹äºæ‰¹å¤„ç†é¡¹ç›®åˆ™æ˜¯å¯é€‰çš„ã€‚ ä¸»è¦ä¾èµ–åŸºäº Maven éª¨æ¶åˆ›å»ºçš„é¡¹ç›®ä¸»è¦æä¾›äº†ä»¥ä¸‹æ ¸å¿ƒä¾èµ–ï¼šå…¶ä¸­ flink-scala ç”¨äºæ”¯æŒå¼€å‘æ‰¹å¤„ç†ç¨‹åº ï¼›flink-streaming-scala ç”¨äºæ”¯æŒå¼€å‘æµå¤„ç†ç¨‹åº ï¼›scala-library ç”¨äºæä¾› Scala è¯­è¨€æ‰€éœ€è¦çš„ç±»åº“ã€‚å¦‚æœåœ¨ä½¿ç”¨ Maven éª¨æ¶åˆ›å»ºæ—¶é€‰æ‹©çš„æ˜¯ Java è¯­è¨€ï¼Œåˆ™é»˜è®¤æä¾›çš„åˆ™æ˜¯ flink-java å’Œ flink-streaming-java ä¾èµ–ã€‚ 12345678910111213141516171819202122&lt;!-- Apache Flink dependencies --&gt;&lt;!-- These dependencies are provided, because they should not be packaged into the JAR file. --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-scala_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-scala_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- Scala Library, provided by Flink as well. --&gt;&lt;dependency&gt; &lt;groupId&gt;org.scala-lang&lt;/groupId&gt; &lt;artifactId&gt;scala-library&lt;/artifactId&gt; &lt;version&gt;$&#123;scala.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ä»¥ä¸Šä¾èµ–çš„ scope æ ‡ç­¾å…¨éƒ¨è¢«æ ‡è¯†ä¸º provided ï¼Œè¿™æ„å‘³ç€è¿™äº›ä¾èµ–éƒ½ä¸ä¼šè¢«æ‰“å…¥æœ€ç»ˆçš„ JAR åŒ…ã€‚å› ä¸º Flink çš„å®‰è£…åŒ…ä¸­å·²ç»æä¾›äº†è¿™äº›ä¾èµ–ï¼Œä½äºå…¶ lib ç›®å½•ä¸‹ï¼Œåä¸º flink-dist_*.jar ï¼Œå®ƒåŒ…å«äº† Flink çš„æ‰€æœ‰æ ¸å¿ƒç±»å’Œä¾èµ–ï¼š scope æ ‡ç­¾è¢«æ ‡è¯†ä¸º provided ä¼šå¯¼è‡´ä½ åœ¨ IDEA ä¸­å¯åŠ¨é¡¹ç›®æ—¶ä¼šæŠ›å‡º ClassNotFoundException å¼‚å¸¸ã€‚åŸºäºè¿™ä¸ªåŸå› ï¼Œåœ¨ä½¿ç”¨ IDEA åˆ›å»ºé¡¹ç›®æ—¶è¿˜è‡ªåŠ¨ç”Ÿæˆäº†ä»¥ä¸‹ profile é…ç½®ï¼š 1234567891011121314151617181920212223242526272829303132333435&lt;!-- This profile helps to make things run out of the box in IntelliJ --&gt;&lt;!-- Its adds Flink's core classes to the runtime class path. --&gt;&lt;!-- Otherwise they are missing in IntelliJ, because the dependency is 'provided' --&gt;&lt;profiles&gt; &lt;profile&gt; &lt;id&gt;add-dependencies-for-IDEA&lt;/id&gt; &lt;activation&gt; &lt;property&gt; &lt;name&gt;idea.version&lt;/name&gt; &lt;/property&gt; &lt;/activation&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-scala_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-scala_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.scala-lang&lt;/groupId&gt; &lt;artifactId&gt;scala-library&lt;/artifactId&gt; &lt;version&gt;$&#123;scala.version&#125;&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/profile&gt;&lt;/profiles&gt; åœ¨ id ä¸º add-dependencies-for-IDEA çš„ profile ä¸­ï¼Œæ‰€æœ‰çš„æ ¸å¿ƒä¾èµ–éƒ½è¢«æ ‡è¯†ä¸º compileï¼Œæ­¤æ—¶ä½ å¯ä»¥æ— éœ€æ”¹åŠ¨ä»»ä½•ä»£ç ï¼Œåªéœ€è¦åœ¨ IDEA çš„ Maven é¢æ¿ä¸­å‹¾é€‰è¯¥ profileï¼Œå³å¯ç›´æ¥åœ¨ IDEA ä¸­è¿è¡Œ Flink é¡¹ç›®ï¼š è¯é¢‘ç»Ÿè®¡æ¡ˆä¾‹é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œå¯ä»¥å…ˆä¹¦å†™ä¸€ä¸ªç®€å•çš„è¯é¢‘ç»Ÿè®¡çš„æ¡ˆä¾‹æ¥å°è¯•è¿è¡Œ Flink é¡¹ç›®ï¼Œä»¥ä¸‹ä»¥ Scala è¯­è¨€ä¸ºä¾‹ï¼Œåˆ†åˆ«ä»‹ç»æµå¤„ç†ç¨‹åºå’Œæ‰¹å¤„ç†ç¨‹åºçš„ç¼–ç¨‹ç¤ºä¾‹ï¼š æ‰¹å¤„ç†ç¤ºä¾‹ 123456789101112131415import org.apache.flink.api.scala._object WordCountBatch &#123; def main(args: Array[String]): Unit = &#123; val benv = ExecutionEnvironment.getExecutionEnvironment val dataSet = benv.readTextFile("D:\\wordcount.txt") dataSet.flatMap &#123; _.toLowerCase.split(",")&#125; .filter (_.nonEmpty) .map &#123; (_, 1) &#125; .groupBy(0) .sum(1) .print() &#125;&#125; å…¶ä¸­ wordcount.txt ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š 1234a,a,a,a,ab,b,bc,cd,d æœ¬æœºä¸éœ€è¦é…ç½®å…¶ä»–ä»»ä½•çš„ Flink ç¯å¢ƒï¼Œç›´æ¥è¿è¡Œ Main æ–¹æ³•å³å¯ æµå¤„ç†ç¤ºä¾‹ 1234567891011121314151617181920import org.apache.flink.streaming.api.scala._import org.apache.flink.streaming.api.windowing.time.Timeobject WordCountStreaming &#123; def main(args: Array[String]): Unit = &#123; val senv = StreamExecutionEnvironment.getExecutionEnvironment val dataStream: DataStream[String] = senv.socketTextStream("192.168.0.229", 9999, '\n') dataStream.flatMap &#123; line =&gt; line.toLowerCase.split(",") &#125; .filter(_.nonEmpty) .map &#123; word =&gt; (word, 1) &#125; .keyBy(0) .timeWindow(Time.seconds(3)) .sum(1) .print() senv.execute("Streaming WordCount") &#125;&#125; è¿™é‡Œä»¥ç›‘å¬æŒ‡å®šç«¯å£å·ä¸Šçš„å†…å®¹ä¸ºä¾‹ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¼€å¯ç«¯å£æœåŠ¡ï¼š 1nc -lk 9999 ä¹‹åè¾“å…¥æµ‹è¯•æ•°æ®å³å¯è§‚å¯Ÿåˆ°æµå¤„ç†ç¨‹åºçš„å¤„ç†æƒ…å†µã€‚ å…«ã€ä½¿ç”¨ Scala Shellå¯¹äºæ—¥å¸¸çš„ Demo é¡¹ç›®ï¼Œå¦‚æœä½ ä¸æƒ³é¢‘ç¹åœ°å¯åŠ¨ IDEA æ¥è§‚å¯Ÿæµ‹è¯•ç»“æœï¼Œå¯ä»¥åƒ Spark ä¸€æ ·ï¼Œç›´æ¥ä½¿ç”¨ Scala Shell æ¥è¿è¡Œç¨‹åºï¼Œè¿™å¯¹äºæ—¥å¸¸çš„å­¦ä¹ æ¥è¯´ï¼Œæ•ˆæœæ›´åŠ ç›´è§‚ï¼Œä¹Ÿæ›´çœæ—¶ã€‚Flink å®‰è£…åŒ…çš„ä¸‹è½½åœ°å€å¦‚ä¸‹ï¼š 1https://flink.apache.org/downloads.html Flink å¤§å¤šæ•°ç‰ˆæœ¬éƒ½æä¾›æœ‰ Scala 2.11 å’Œ Scala 2.12 ä¸¤ä¸ªç‰ˆæœ¬çš„å®‰è£…åŒ…å¯ä¾›ä¸‹è½½ï¼š ä¸‹è½½å®Œæˆåè¿›è¡Œè§£å‹å³å¯ï¼ŒScala Shell ä½äºå®‰è£…ç›®å½•çš„ bin ç›®å½•ä¸‹ï¼Œç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯ä»¥æœ¬åœ°æ¨¡å¼å¯åŠ¨ï¼š 1./start-scala-shell.sh local å‘½ä»¤è¡Œå¯åŠ¨å®Œæˆåï¼Œå…¶å·²ç»æä¾›äº†æ‰¹å¤„ç† ï¼ˆbenv å’Œ btenvï¼‰å’Œæµå¤„ç†ï¼ˆsenv å’Œ stenvï¼‰çš„è¿è¡Œç¯å¢ƒï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ Scala Flink ç¨‹åºï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š æœ€åè§£é‡Šä¸€ä¸ªå¸¸è§çš„å¼‚å¸¸ï¼šè¿™é‡Œæˆ‘ä½¿ç”¨çš„ Flink ç‰ˆæœ¬ä¸º 1.9.1ï¼Œå¯åŠ¨æ—¶ä¼šæŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸ã€‚è¿™é‡Œå› ä¸ºæŒ‰ç…§å®˜æ–¹çš„è¯´æ˜ï¼Œç›®å‰æ‰€æœ‰ Scala 2.12 ç‰ˆæœ¬çš„å®‰è£…åŒ…æš‚æ—¶éƒ½ä¸æ”¯æŒ Scala Shellï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦ä½¿ç”¨ Scala Shellï¼Œåªèƒ½é€‰æ‹© Scala 2.11 ç‰ˆæœ¬çš„å®‰è£…åŒ…ã€‚ 12[root@hadoop001 bin]# ./start-scala-shell.sh localé”™è¯¯: æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» org.apache.flink.api.scala.FlinkShell]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink-Redis-Sink]]></title>
    <url>%2F2020%2F04%2F09%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F15-Flink-Redis-Sink%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹æµå¼è®¡ç®—ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æœ‰ä¸€äº›åœºæ™¯æ˜¯æ¶ˆè´¹Kafkaæ•°æ®ï¼Œè¿›è¡Œå¤„ç†ï¼Œç„¶åå­˜å‚¨åˆ°å…¶ä»–çš„æ•°æ®åº“æˆ–è€…ç¼“å­˜æˆ–è€…é‡æ–°å‘é€å›å…¶ä»–çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚æœ¬æ–‡è®²è¿°ä¸€ä¸ªç®€å•çš„Redisä½œä¸ºSinkçš„æ¡ˆä¾‹ã€‚ å…³äºRedis SinkFlinkæä¾›äº†å°è£…å¥½çš„å†™å…¥Redisçš„åŒ…ç»™æˆ‘ä»¬ç”¨ï¼Œé¦–å…ˆæˆ‘ä»¬è¦æ–°å¢ä¸€ä¸ªä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-redis_2.10&lt;/artifactId&gt; &lt;version&gt;1.1.5&lt;/version&gt;&lt;/dependency&gt; ç„¶åæˆ‘ä»¬å®ç°ä¸€ä¸ªè‡ªå·±çš„RedisSinkExampleï¼š 1234567891011121314//æŒ‡å®šRedis setpublic static final class RedisSinkExample implements RedisMapper&lt;Tuple2&lt;String,Integer&gt;&gt; &#123; public RedisCommandDescription getCommandDescription() &#123; return new RedisCommandDescription(RedisCommand.SET, null); &#125; public String getKeyFromData(Tuple2&lt;String, Integer&gt; data) &#123; return data.f0; &#125; public String getValueFromData(Tuple2&lt;String, Integer&gt; data) &#123; return data.f1.toString(); &#125;&#125; æˆ‘ä»¬ç”¨æœ€ç®€å•çš„å•æœºRedisçš„SETå‘½ä»¤è¿›è¡Œæ¼”ç¤ºã€‚ å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼Œå®ç°ä¸€ä¸ªè¯»å–Kafkaçš„æ¶ˆæ¯ï¼Œç„¶åè¿›è¡ŒWordCountï¼Œå¹¶æŠŠç»“æœæ›´æ–°åˆ°redisä¸­ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public class RedisSinkTest &#123;public static void main(String[] args) throws Exception&#123; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime); env.enableCheckpointing(2000); env.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE); //è¿æ¥kafka Properties properties = new Properties(); properties.setProperty("bootstrap.servers", "127.0.0.1:9092"); FlinkKafkaConsumer&lt;String&gt; consumer = new FlinkKafkaConsumer&lt;&gt;("test", new SimpleStringSchema(), properties); consumer.setStartFromEarliest(); DataStream&lt;String&gt; stream = env.addSource(consumer); DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; counts = stream.flatMap(new LineSplitter()).keyBy(0).sum(1); //å®ä¾‹åŒ–FlinkJedisPoolConfig é…ç½®redis FlinkJedisPoolConfig conf = new FlinkJedisPoolConfig.Builder().setHost("127.0.0.1").setPort("6379").build(); //å®ä¾‹åŒ–RedisSinkï¼Œå¹¶é€šè¿‡flinkçš„addSinkçš„æ–¹å¼å°†flinkè®¡ç®—çš„ç»“æœæ’å…¥åˆ°redis counts.addSink(new RedisSink&lt;&gt;(conf,new RedisSinkExample())); env.execute("WordCount From Kafka To Redis"); &#125;// public static final class LineSplitter implements FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt; &#123; @Override public void flatMap(String value, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; out) &#123; String[] tokens = value.toLowerCase().split("\\W+"); for (String token : tokens) &#123; if (token.length() &gt; 0) &#123; out.collect(new Tuple2&lt;String, Integer&gt;(token, 1)); &#125; &#125; &#125; &#125; //æŒ‡å®šRedis set public static final class RedisSinkExample implements RedisMapper&lt;Tuple2&lt;String,Integer&gt;&gt; &#123; public RedisCommandDescription getCommandDescription() &#123; return new RedisCommandDescription(RedisCommand.SET, null); &#125; public String getKeyFromData(Tuple2&lt;String, Integer&gt; data) &#123; return data.f0; &#125; public String getValueFromData(Tuple2&lt;String, Integer&gt; data) &#123; return data.f1.toString(); &#125; &#125;&#125;]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink SQL]]></title>
    <url>%2F2020%2F04%2F09%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F14-Flink%20SQL%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹Apache Flinkå…·æœ‰ä¸¤ä¸ªå…³ç³»API - è¡¨APIå’ŒSQL - ç”¨äºç»Ÿä¸€æµå’Œæ‰¹å¤„ç†ã€‚Table APIæ˜¯Scalaå’ŒJavaçš„è¯­è¨€é›†æˆæŸ¥è¯¢APIï¼Œå…è®¸ä»¥éå¸¸ç›´è§‚çš„æ–¹å¼ç»„åˆæ¥è‡ªå…³ç³»è¿ç®—ç¬¦çš„æŸ¥è¯¢ï¼ŒTable APIå’ŒSQLæ¥å£å½¼æ­¤ç´§å¯†é›†æˆï¼Œä»¥åŠFlinkçš„DataStreamå’ŒDataSet APIã€‚æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨åŸºäºAPIæ„å»ºçš„æ‰€æœ‰APIå’Œåº“ä¹‹é—´åˆ‡æ¢ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨CEPåº“ä»DataStreamä¸­æå–æ¨¡å¼ï¼Œç„¶åä½¿ç”¨Table APIåˆ†ææ¨¡å¼ï¼Œæˆ–è€…å¯ä»¥åœ¨é¢„å¤„ç†ä¸Šè¿è¡ŒGellyå›¾ç®—æ³•ä¹‹å‰ä½¿ç”¨SQLæŸ¥è¯¢æ‰«æï¼Œè¿‡æ»¤å’Œèšåˆæ‰¹å¤„ç†è¡¨æ•°æ®ã€‚ Flink SQLçš„ç¼–ç¨‹æ¨¡å‹åˆ›å»ºä¸€ä¸ªTableEnvironmentTableEnvironmentæ˜¯Table APIå’ŒSQLé›†æˆçš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒä¸»è¦è´Ÿè´£: 1ã€åœ¨å†…éƒ¨ç›®å½•ä¸­æ³¨å†Œä¸€ä¸ªTable 2ã€æ³¨å†Œä¸€ä¸ªå¤–éƒ¨ç›®å½• 3ã€æ‰§è¡ŒSQLæŸ¥è¯¢ 4ã€æ³¨å†Œä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°(æ ‡é‡ã€è¡¨åŠèšåˆ) 5ã€å°†DataStreamæˆ–è€…DataSetè½¬æ¢æˆTable 6ã€æŒæœ‰ExecutionEnvironmentæˆ–è€…StreamExecutionEnvironmentçš„å¼•ç”¨ä¸€ä¸ªTableæ€»æ˜¯ä¼šç»‘å®šåˆ°ä¸€ä¸ªæŒ‡å®šçš„TableEnvironmentä¸­ï¼Œç›¸åŒçš„æŸ¥è¯¢ä¸åŒçš„TableEnvironmentæ˜¯æ— æ³•é€šè¿‡joinã€unionåˆå¹¶åœ¨ä¸€èµ·ã€‚TableEnvironmentæœ‰ä¸€ä¸ªåœ¨å†…éƒ¨é€šè¿‡è¡¨åç»„ç»‡èµ·æ¥çš„è¡¨ç›®å½•ï¼ŒTable APIæˆ–è€…SQLæŸ¥è¯¢å¯ä»¥è®¿é—®æ³¨å†Œåœ¨ç›®å½•ä¸­çš„è¡¨ï¼Œå¹¶é€šè¿‡åç§°æ¥å¼•ç”¨å®ƒä»¬ã€‚ åœ¨ç›®å½•ä¸­æ³¨å†Œè¡¨TableEnvironmentå…è®¸é€šè¿‡å„ç§æºæ¥æ³¨å†Œä¸€ä¸ªè¡¨: 1ã€ä¸€ä¸ªå·²å­˜åœ¨çš„Tableå¯¹è±¡ï¼Œé€šå¸¸æ˜¯Table APIæˆ–è€…SQLæŸ¥è¯¢çš„ç»“æœâ€‹ Table projTable = tableEnv.scan(â€œXâ€).select(â€¦); 2ã€TableSourceï¼Œå¯ä»¥è®¿é—®å¤–éƒ¨æ•°æ®å¦‚æ–‡ä»¶ã€æ•°æ®åº“æˆ–è€…æ¶ˆæ¯ç³»ç»Ÿâ€‹ TableSource csvSource = new CsvTableSource(â€œ/path/to/fileâ€, â€¦); 3ã€ç¨‹åºä¸­çš„DataStreamæˆ–è€…DataSetâ€‹ å°†DataSetè½¬æ¢ä¸ºTableâ€‹ Table table= tableEnv.fromDataSet(dataSet); æ³¨å†ŒTableSinkæ³¨å†ŒTableSinkå¯ç”¨äºå°† Table APIæˆ–SQLæŸ¥è¯¢çš„ç»“æœå‘é€åˆ°å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚æ•°æ®åº“ï¼Œé”®å€¼å­˜å‚¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æˆ–æ–‡ä»¶ç³»ç»Ÿï¼ˆåœ¨ä¸åŒçš„ç¼–ç ä¸­ï¼Œä¾‹å¦‚ï¼ŒCSVï¼ŒApache [Parquet] ï¼ŒAvroï¼ŒORC]ï¼Œâ€¦â€¦ï¼‰: 1234TableSink csvSink = new CsvTableSink(&quot;/path/to/file&quot;, ...); String[] fieldNames = &#123;&quot;a&quot;, &quot;b&quot;, &quot;c&quot;&#125;; TypeInformation[] fieldTypes = &#123;Types.INT, Types.STRING, Types.LONG&#125;; tableEnv.registerTableSink(&quot;CsvSinkTable&quot;, fieldNames, fieldTypes, csvSink); å®æˆ˜æ¡ˆä¾‹ä¸€åŸºäºFlink SQLçš„WordCount: 12345678910111213141516171819202122232425262728293031323334353637383940public class WordCountSQL &#123; public static void main(String[] args) throws Exception&#123; ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); BatchTableEnvironment tEnv = TableEnvironment.getTableEnvironment(env); List list = new ArrayList(); String wordsStr = "Hello Flink Hello TOM"; String[] words = wordsStr.split("\\W+"); for(String word : words)&#123; WC wc = new WC(word, 1); list.add(wc); &#125; DataSet&lt;WC&gt; input = env.fromCollection(list); tEnv.registerDataSet("WordCount", input, "word, frequency"); Table table = tEnv.sqlQuery( "SELECT word, SUM(frequency) as frequency FROM WordCount GROUP BY word"); DataSet&lt;WC&gt; result = tEnv.toDataSet(table, WC.class); result.print(); &#125;//main public static class WC &#123; public String word;//hello public long frequency;//1 // public constructor to make it a Flink POJO public WC() &#123;&#125; public WC(String word, long frequency) &#123; this.word = word; this.frequency = frequency; &#125; @Override public String toString() &#123; return "WC " + word + " " + frequency; &#125; &#125;&#125; è¾“å‡ºå¦‚ä¸‹ï¼š 123WC TOM 1WC Hello 2WC Flink 1 å®æˆ˜æ¡ˆä¾‹äºŒæœ¬ä¾‹ç¨å¾®å¤æ‚ï¼Œé¦–å…ˆè¯»å–ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹è¿›è¡Œç»Ÿè®¡ï¼Œå¹¶å†™å…¥åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687public class SQLTest &#123; public static void main(String[] args) throws Exception&#123; ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); BatchTableEnvironment tableEnv = BatchTableEnvironment.getTableEnvironment(env); env.setParallelism(1); DataSource&lt;String&gt; input = env.readTextFile("test.txt"); input.print(); //è½¬æ¢æˆdataset DataSet&lt;Orders&gt; topInput = input.map(new MapFunction&lt;String, Orders&gt;() &#123; @Override public Orders map(String s) throws Exception &#123; String[] splits = s.split(" "); return new Orders(Integer.valueOf(splits[0]), String.valueOf(splits[1]),String.valueOf(splits[2]), Double.valueOf(splits[3])); &#125; &#125;); //å°†DataSetè½¬æ¢ä¸ºTable Table order = tableEnv.fromDataSet(topInput); //ordersè¡¨å tableEnv.registerTable("Orders",order); Table tapiResult = tableEnv.scan("Orders").select("name"); tapiResult.printSchema(); Table sqlQuery = tableEnv.sqlQuery("select name, sum(price) as total from Orders group by name order by total desc"); //è½¬æ¢å›dataset DataSet&lt;Result&gt; result = tableEnv.toDataSet(sqlQuery, Result.class); //å°†dataset mapæˆtupleè¾“å‡º /*result.map(new MapFunction&lt;Result, Tuple2&lt;String,Double&gt;&gt;() &#123; @Override public Tuple2&lt;String, Double&gt; map(Result result) throws Exception &#123; String name = result.name; Double total = result.total; return Tuple2.of(name,total); &#125; &#125;).print();*/ TableSink sink = new CsvTableSink("SQLTEST.txt", "|"); //writeToSink /*sqlQuery.writeToSink(sink); env.execute();*/ String[] fieldNames = &#123;"name", "total"&#125;; TypeInformation[] fieldTypes = &#123;Types.STRING, Types.DOUBLE&#125;; tableEnv.registerTableSink("SQLTEST", fieldNames, fieldTypes, sink); sqlQuery.insertInto("SQLTEST"); env.execute(); &#125; /** * æºæ•°æ®çš„æ˜ å°„ç±» */ public static class Orders &#123; /** * åºå·ï¼Œå§“åï¼Œä¹¦åï¼Œä»·æ ¼ */ public Integer id; public String name; public String book; public Double price; public Orders() &#123; super(); &#125; public Orders(Integer id, String name, String book, Double price) &#123; this.id = id; this.name = name; this.book = book; this.price = price; &#125; &#125; /** * ç»Ÿè®¡ç»“æœå¯¹åº”çš„ç±» */ public static class Result &#123; public String name; public Double total; public Result() &#123;&#125; &#125;&#125;]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flink(Source-KafkaSink-Mysql)]]></title>
    <url>%2F2020%2F04%2F09%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F16-Flink(Source-KafkaSink-Mysql)%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä»‹ç»æ¶ˆè´¹Kafkaçš„æ¶ˆæ¯å®æ—¶å†™å…¥Mysql mavenæ–°å¢ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.39&lt;/version&gt;&lt;/dependency&gt; 2.é‡å†™RichSinkFunction,å®ç°ä¸€ä¸ªMysql Sink 123456789101112131415161718192021222324252627public class MysqlSink extends RichSinkFunction&lt;Tuple3&lt;Integer, String, Integer&gt;&gt; &#123; private Connection connection; private PreparedStatement preparedStatement; String username = ""; String password = ""; String drivername = ""; //é…ç½®æ”¹æˆè‡ªå·±çš„é…ç½® String dburl = ""; @Override public void invoke(Tuple3&lt;Integer, String, Integer&gt; value) throws Exception &#123; Class.forName(drivername); connection = DriverManager.getConnection(dburl, username, password); String sql = "replace into table(id,num,price) values(?,?,?)"; //å‡è®¾mysql æœ‰3åˆ— id,num,price preparedStatement = connection.prepareStatement(sql); preparedStatement.setInt(1, value.f0); preparedStatement.setString(2, value.f1); preparedStatement.setInt(3, value.f2); preparedStatement.executeUpdate(); if (preparedStatement != null) &#123; preparedStatement.close(); &#125; if (connection != null) &#123; connection.close(); &#125; &#125;&#125; Flinkä¸»ç±» 123456789101112131415161718192021222324252627public class MysqlSinkTest &#123; public static void main(String[] args) throws Exception &#123; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); Properties properties = new Properties(); properties.setProperty("bootstrap.servers", "localhost:9092"); // 1,abc,100 ç±»ä¼¼è¿™æ ·çš„æ•°æ®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯å¾ˆå¤æ‚çš„jsonæ•°æ®ï¼Œå»åšè§£æ FlinkKafkaConsumer&lt;String&gt; consumer = new FlinkKafkaConsumer&lt;&gt;("test", new SimpleStringSchema(), properties); env.getConfig().disableSysoutLogging(); //è®¾ç½®æ­¤å¯ä»¥å±è”½æ‰æ—¥è®°æ‰“å°æƒ…å†µ env.getConfig().setRestartStrategy( RestartStrategies.fixedDelayRestart(5, 5000)); env.enableCheckpointing(2000); DataStream&lt;String&gt; stream = env .addSource(consumer); DataStream&lt;Tuple3&lt;Integer, String, Integer&gt;&gt; sourceStream = stream.filter((FilterFunction&lt;String&gt;) value -&gt; StringUtils.isNotBlank(value)).map((MapFunction&lt;String, Tuple3&lt;Integer, String, Integer&gt;&gt;) value -&gt; &#123; String[] args1 = value.split(","); return new Tuple3&lt;Integer, String, Integer&gt;(Integer .valueOf(args1[0]), args1[1],Integer .valueOf(args1[2])); &#125;); sourceStream.addSink(new MysqlSink()); env.execute("data to mysql start"); &#125;&#125;]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Sourceã€Transformã€Sink]]></title>
    <url>%2F2020%2F04%2F09%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FFlink%2F2-Source%E3%80%81Transform%E3%80%81Sink%2F</url>
    <content type="text"><![CDATA[Data Sourceä¸€ã€å†…ç½® Data SourceFlink Data Source ç”¨äºå®šä¹‰ Flink ç¨‹åºçš„æ•°æ®æ¥æºï¼ŒFlink å®˜æ–¹æä¾›äº†å¤šç§æ•°æ®è·å–æ–¹æ³•ï¼Œç”¨äºå¸®åŠ©å¼€å‘è€…ç®€å•å¿«é€Ÿåœ°æ„å»ºè¾“å…¥æµï¼Œå…·ä½“å¦‚ä¸‹ï¼š 1.1 åŸºäºæ–‡ä»¶æ„å»º1. readTextFile(path)ï¼šæŒ‰ç…§ TextInputFormat æ ¼å¼è¯»å–æ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 1env.readTextFile(filePath).print(); 2. readFile(fileInputFormat, path) ï¼šæŒ‰ç…§æŒ‡å®šæ ¼å¼è¯»å–æ–‡ä»¶ã€‚ 3. readFile(inputFormat, filePath, watchType, interval, typeInformation)ï¼šæŒ‰ç…§æŒ‡å®šæ ¼å¼å‘¨æœŸæ€§çš„è¯»å–æ–‡ä»¶ã€‚å…¶ä¸­å„ä¸ªå‚æ•°çš„å«ä¹‰å¦‚ä¸‹ï¼š inputFormatï¼šæ•°æ®æµçš„è¾“å…¥æ ¼å¼ã€‚ filePathï¼šæ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ HDFS ä¸Šçš„æ–‡ä»¶è·¯å¾„ã€‚ watchTypeï¼šè¯»å–æ–¹å¼ï¼Œå®ƒæœ‰ä¸¤ä¸ªå¯é€‰å€¼ï¼Œåˆ†åˆ«æ˜¯ FileProcessingMode.PROCESS_ONCE å’Œ FileProcessingMode.PROCESS_CONTINUOUSLYï¼šå‰è€…è¡¨ç¤ºå¯¹æŒ‡å®šè·¯å¾„ä¸Šçš„æ•°æ®åªè¯»å–ä¸€æ¬¡ï¼Œç„¶åé€€å‡ºï¼›åè€…è¡¨ç¤ºå¯¹è·¯å¾„è¿›è¡Œå®šæœŸåœ°æ‰«æå’Œè¯»å–ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœ watchType è¢«è®¾ç½®ä¸º PROCESS_CONTINUOUSLYï¼Œé‚£ä¹ˆå½“æ–‡ä»¶è¢«ä¿®æ”¹æ—¶ï¼Œå…¶æ‰€æœ‰çš„å†…å®¹ (åŒ…å«åŸæœ‰çš„å†…å®¹å’Œæ–°å¢çš„å†…å®¹) éƒ½å°†è¢«é‡æ–°å¤„ç†ï¼Œå› æ­¤è¿™ä¼šæ‰“ç ´ Flink çš„ exactly-once è¯­ä¹‰ã€‚ intervalï¼šå®šæœŸæ‰«æçš„æ—¶é—´é—´éš”ã€‚ typeInformationï¼šè¾“å…¥æµä¸­å…ƒç´ çš„ç±»å‹ã€‚ ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678final String filePath = "D:\\log4j.properties";final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();env.readFile(new TextInputFormat(new Path(filePath)), filePath, FileProcessingMode.PROCESS_ONCE, 1, BasicTypeInfo.STRING_TYPE_INFO).print();env.execute(); 1.2 åŸºäºé›†åˆæ„å»º1. fromCollection(Collection)ï¼šåŸºäºé›†åˆæ„å»ºï¼Œé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ å¿…é¡»æ˜¯åŒä¸€ç±»å‹ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 1env.fromCollection(Arrays.asList(1,2,3,4,5)).print(); 2. fromElements(T â€¦)ï¼š åŸºäºå…ƒç´ æ„å»ºï¼Œæ‰€æœ‰å…ƒç´ å¿…é¡»æ˜¯åŒä¸€ç±»å‹ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 1env.fromElements(1,2,3,4,5).print(); 3. generateSequence(from, to)ï¼šåŸºäºç»™å®šçš„åºåˆ—åŒºé—´è¿›è¡Œæ„å»ºã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 1env.generateSequence(0,100); 4. fromCollection(Iterator, Class)ï¼šåŸºäºè¿­ä»£å™¨è¿›è¡Œæ„å»ºã€‚ç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºå®šä¹‰è¿­ä»£å™¨ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºå®šä¹‰è¾“å‡ºå…ƒç´ çš„ç±»å‹ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 1env.fromCollection(new CustomIterator(), BasicTypeInfo.INT_TYPE_INFO).print(); å…¶ä¸­ CustomIterator ä¸ºè‡ªå®šä¹‰çš„è¿­ä»£å™¨ï¼Œè¿™é‡Œä»¥äº§ç”Ÿ 1 åˆ° 100 åŒºé—´å†…çš„æ•°æ®ä¸ºä¾‹ï¼Œæºç å¦‚ä¸‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è‡ªå®šä¹‰è¿­ä»£å™¨é™¤äº†è¦å®ç° Iterator æ¥å£å¤–ï¼Œè¿˜å¿…é¡»è¦å®ç°åºåˆ—åŒ–æ¥å£ Serializable ï¼Œå¦åˆ™ä¼šæŠ›å‡ºåºåˆ—åŒ–å¤±è´¥çš„å¼‚å¸¸ï¼š 1234567891011121314151617import java.io.Serializable;import java.util.Iterator;public class CustomIterator implements Iterator&lt;Integer&gt;, Serializable &#123; private Integer i = 0; @Override public boolean hasNext() &#123; return i &lt; 100; &#125; @Override public Integer next() &#123; i++; return i; &#125;&#125; 5. fromParallelCollection(SplittableIterator, Class)ï¼šæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºå®šä¹‰è¾“å‡ºå…ƒç´ çš„ç±»å‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•° SplittableIterator æ˜¯è¿­ä»£å™¨çš„æŠ½è±¡åŸºç±»ï¼Œå®ƒç”¨äºå°†åŸå§‹è¿­ä»£å™¨çš„å€¼æ‹†åˆ†åˆ°å¤šä¸ªä¸ç›¸äº¤çš„è¿­ä»£å™¨ä¸­ã€‚ 1.3 åŸºäº Socket æ„å»ºFlink æä¾›äº† socketTextStream æ–¹æ³•ç”¨äºæ„å»ºåŸºäº Socket çš„æ•°æ®æµï¼ŒsocketTextStream æ–¹æ³•æœ‰ä»¥ä¸‹å››ä¸ªä¸»è¦å‚æ•°ï¼š hostnameï¼šä¸»æœºåï¼› portï¼šç«¯å£å·ï¼Œè®¾ç½®ä¸º 0 æ—¶ï¼Œè¡¨ç¤ºç«¯å£å·è‡ªåŠ¨åˆ†é…ï¼› delimiterï¼šç”¨äºåˆ†éš”æ¯æ¡è®°å½•çš„åˆ†éš”ç¬¦ï¼› maxRetryï¼šå½“ Socket ä¸´æ—¶å…³é—­æ—¶ï¼Œç¨‹åºçš„æœ€å¤§é‡è¯•é—´éš”ï¼Œå•ä½ä¸ºç§’ã€‚è®¾ç½®ä¸º 0 æ—¶è¡¨ç¤ºä¸è¿›è¡Œé‡è¯•ï¼›è®¾ç½®ä¸ºè´Ÿå€¼åˆ™è¡¨ç¤ºä¸€ç›´é‡è¯•ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 1env.socketTextStream("192.168.0.229", 9999, "\n", 3).print(); äºŒã€è‡ªå®šä¹‰ Data Source2.1 SourceFunctioné™¤äº†å†…ç½®çš„æ•°æ®æºå¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥ä½¿ç”¨ addSource æ–¹æ³•æ¥æ·»åŠ è‡ªå®šä¹‰çš„æ•°æ®æºã€‚è‡ªå®šä¹‰çš„æ•°æ®æºå¿…é¡»è¦å®ç° SourceFunction æ¥å£ï¼Œè¿™é‡Œä»¥äº§ç”Ÿ [0 , 1000) åŒºé—´å†…çš„æ•°æ®ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();env.addSource(new SourceFunction&lt;Long&gt;() &#123; private long count = 0L; private volatile boolean isRunning = true; public void run(SourceContext&lt;Long&gt; ctx) &#123; while (isRunning &amp;&amp; count &lt; 1000) &#123; // é€šè¿‡collectå°†è¾“å…¥å‘é€å‡ºå» ctx.collect(count); count++; &#125; &#125; public void cancel() &#123; isRunning = false; &#125;&#125;).print();env.execute(); 2.2 ParallelSourceFunction å’Œ RichParallelSourceFunctionä¸Šé¢é€šè¿‡ SourceFunction å®ç°çš„æ•°æ®æºæ˜¯ä¸å…·æœ‰å¹¶è¡Œåº¦çš„ï¼Œå³ä¸æ”¯æŒåœ¨å¾—åˆ°çš„ DataStream ä¸Šè°ƒç”¨ setParallelism(n) æ–¹æ³•ï¼Œæ­¤æ—¶ä¼šæŠ›å‡ºå¦‚ä¸‹çš„å¼‚å¸¸ï¼š 1Exception in thread "main" java.lang.IllegalArgumentException: Source: 1 is not a parallel source å¦‚æœä½ æƒ³è¦å®ç°å…·æœ‰å¹¶è¡Œåº¦çš„è¾“å…¥æµï¼Œåˆ™éœ€è¦å®ç° ParallelSourceFunction æˆ– RichParallelSourceFunction æ¥å£ï¼Œå…¶ä¸ SourceFunction çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š ParallelSourceFunction ç›´æ¥ç»§æ‰¿è‡ª ParallelSourceFunctionï¼Œå…·æœ‰å¹¶è¡Œåº¦çš„åŠŸèƒ½ã€‚RichParallelSourceFunction åˆ™ç»§æ‰¿è‡ª AbstractRichFunctionï¼ŒåŒæ—¶å®ç°äº† ParallelSourceFunction æ¥å£ï¼Œæ‰€ä»¥å…¶é™¤äº†å…·æœ‰å¹¶è¡Œåº¦çš„åŠŸèƒ½å¤–ï¼Œè¿˜æä¾›äº†é¢å¤–çš„ä¸ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚ open() ï¼Œclosen() ã€‚ ä¸‰ã€Streaming Connectors3.1 å†…ç½®è¿æ¥å™¨é™¤äº†è‡ªå®šä¹‰æ•°æ®æºå¤–ï¼Œ Flink è¿˜å†…ç½®äº†å¤šç§è¿æ¥å™¨ï¼Œç”¨äºæ»¡è¶³å¤§å¤šæ•°çš„æ•°æ®æ”¶é›†åœºæ™¯ã€‚å½“å‰å†…ç½®è¿æ¥å™¨çš„æ”¯æŒæƒ…å†µå¦‚ä¸‹ï¼š Apache Kafka (æ”¯æŒ source å’Œ sink) Apache Cassandra (sink) Amazon Kinesis Streams (source/sink) Elasticsearch (sink) Hadoop FileSystem (sink) RabbitMQ (source/sink) Apache NiFi (source/sink) Twitter Streaming API (source) Google PubSub (source/sink) é™¤äº†ä¸Šè¿°çš„è¿æ¥å™¨å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡ Apache Bahir çš„è¿æ¥å™¨æ‰©å±• Flinkã€‚Apache Bahir æ—¨åœ¨ä¸ºåˆ†å¸ƒå¼æ•°æ®åˆ†æç³»ç»Ÿ (å¦‚ Sparkï¼ŒFlink) ç­‰æä¾›åŠŸèƒ½ä¸Šçš„æ‰©å±•ï¼Œå½“å‰å…¶æ”¯æŒçš„ä¸ Flink ç›¸å…³çš„è¿æ¥å™¨å¦‚ä¸‹ï¼š Apache ActiveMQ (source/sink) Apache Flume (sink) Redis (sink) Akka (sink) Netty (source) éšç€ Flink çš„ä¸æ–­å‘å±•ï¼Œå¯ä»¥é¢„è§åˆ°å…¶ä¼šæ”¯æŒè¶Šæ¥è¶Šå¤šç±»å‹çš„è¿æ¥å™¨ï¼Œå…³äºè¿æ¥å™¨çš„åç»­å‘å±•æƒ…å†µï¼Œå¯ä»¥æŸ¥çœ‹å…¶å®˜æ–¹æ–‡æ¡£ï¼šStreaming Connectors ã€‚åœ¨æ‰€æœ‰ DataSource è¿æ¥å™¨ä¸­ï¼Œä½¿ç”¨çš„å¹¿æ³›çš„å°±æ˜¯ Kafkaï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä»¥å…¶ä¸ºä¾‹ï¼Œæ¥ä»‹ç» Connectors çš„æ•´åˆæ­¥éª¤ã€‚ 3.2 æ•´åˆ Kakfa1. å¯¼å…¥ä¾èµ–æ•´åˆ Kafka æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ‰€ä½¿ç”¨çš„ Kafka çš„ç‰ˆæœ¬ï¼Œä¸åŒç‰ˆæœ¬é—´æ‰€éœ€çš„ Maven ä¾èµ–å’Œå¼€å‘æ—¶æ‰€è°ƒç”¨çš„ç±»å‡ä¸ç›¸åŒï¼Œå…·ä½“å¦‚ä¸‹ï¼š Maven ä¾èµ– Flink ç‰ˆæœ¬ Consumer and Producer ç±»çš„åç§° Kafka ç‰ˆæœ¬ flink-connector-kafka-0.8_2.11 1.0.0 + FlinkKafkaConsumer08 FlinkKafkaProducer08 0.8.x flink-connector-kafka-0.9_2.11 1.0.0 + FlinkKafkaConsumer09 FlinkKafkaProducer09 0.9.x flink-connector-kafka-0.10_2.11 1.2.0 + FlinkKafkaConsumer010 FlinkKafkaProducer010 0.10.x flink-connector-kafka-0.11_2.11 1.4.0 + FlinkKafkaConsumer011 FlinkKafkaProducer011 0.11.x flink-connector-kafka_2.11 1.7.0 + FlinkKafkaConsumer FlinkKafkaProducer &gt;= 1.0.0 è¿™é‡Œæˆ‘ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º kafka_2.12-2.2.0ï¼Œæ·»åŠ çš„ä¾èµ–å¦‚ä¸‹ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-kafka_2.11&lt;/artifactId&gt; &lt;version&gt;1.9.0&lt;/version&gt;&lt;/dependency&gt; 2. ä»£ç å¼€å‘è¿™é‡Œä»¥æœ€ç®€å•çš„åœºæ™¯ä¸ºä¾‹ï¼Œæ¥æ”¶ Kafka ä¸Šçš„æ•°æ®å¹¶æ‰“å°ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();Properties properties = new Properties();// æŒ‡å®šKafkaçš„è¿æ¥ä½ç½®properties.setProperty("bootstrap.servers", "hadoop001:9092");// æŒ‡å®šç›‘å¬çš„ä¸»é¢˜ï¼Œå¹¶å®šä¹‰Kafkaå­—èŠ‚æ¶ˆæ¯åˆ°Flinkå¯¹è±¡ä¹‹é—´çš„è½¬æ¢è§„åˆ™DataStream&lt;String&gt; stream = env .addSource(new FlinkKafkaConsumer&lt;&gt;("flink-stream-in-topic", new SimpleStringSchema(), properties));stream.print();env.execute("Flink Streaming"); 3.3 æ•´åˆæµ‹è¯•1. å¯åŠ¨ KakfaKafka çš„è¿è¡Œä¾èµ–äº zookeeperï¼Œéœ€è¦é¢„å…ˆå¯åŠ¨ï¼Œå¯ä»¥å¯åŠ¨ Kafka å†…ç½®çš„ zookeeperï¼Œä¹Ÿå¯ä»¥å¯åŠ¨è‡ªå·±å®‰è£…çš„ï¼š 12345# zookeeperå¯åŠ¨å‘½ä»¤bin/zkServer.sh start# å†…ç½®zookeeperå¯åŠ¨å‘½ä»¤bin/zookeeper-server-start.sh config/zookeeper.properties å¯åŠ¨å•èŠ‚ç‚¹ kafka ç”¨äºæµ‹è¯•ï¼š 1# bin/kafka-server-start.sh config/server.properties 2. åˆ›å»º Topic123456789# åˆ›å»ºç”¨äºæµ‹è¯•ä¸»é¢˜bin/kafka-topics.sh --create \ --bootstrap-server hadoop001:9092 \ --replication-factor 1 \ --partitions 1 \ --topic flink-stream-in-topic# æŸ¥çœ‹æ‰€æœ‰ä¸»é¢˜ bin/kafka-topics.sh --list --bootstrap-server hadoop001:9092 3. å¯åŠ¨ Producerè¿™é‡Œ å¯åŠ¨ä¸€ä¸ª Kafka ç”Ÿäº§è€…ï¼Œç”¨äºå‘é€æµ‹è¯•æ•°æ®ï¼š 1bin/kafka-console-producer.sh --broker-list hadoop001:9092 --topic flink-stream-in-topic 4. æµ‹è¯•ç»“æœåœ¨ Producer ä¸Šè¾“å…¥ä»»æ„æµ‹è¯•æ•°æ®ï¼Œä¹‹åè§‚å¯Ÿç¨‹åºæ§åˆ¶å°çš„è¾“å‡ºï¼š ç¨‹åºæ§åˆ¶å°çš„è¾“å‡ºå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸæ¥æ”¶å¹¶æ‰“å°å‡ºç›¸å…³çš„æ•°æ®ã€‚ Transformä¸€ã€Transformations åˆ†ç±»Flink çš„ Transformations æ“ä½œä¸»è¦ç”¨äºå°†ä¸€ä¸ªå’Œå¤šä¸ª DataStream æŒ‰éœ€è½¬æ¢æˆæ–°çš„ DataStreamã€‚å®ƒä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š DataStream Transformationsï¼šè¿›è¡Œæ•°æ®æµç›¸å…³è½¬æ¢æ“ä½œï¼› Physical partitioningï¼šç‰©ç†åˆ†åŒºã€‚Flink æä¾›çš„åº•å±‚ API ï¼Œå…è®¸ç”¨æˆ·å®šä¹‰æ•°æ®çš„åˆ†åŒºè§„åˆ™ï¼› Task chaining and resource groupsï¼šä»»åŠ¡é“¾å’Œèµ„æºç»„ã€‚å…è®¸ç”¨æˆ·è¿›è¡Œä»»åŠ¡é“¾å’Œèµ„æºç»„çš„ç»†ç²’åº¦çš„æ§åˆ¶ã€‚ ä»¥ä¸‹åˆ†åˆ«å¯¹å…¶ä¸»è¦ API è¿›è¡Œä»‹ç»ï¼š äºŒã€DataStream Transformations2.1 Map [DataStream â†’ DataStream]å¯¹ä¸€ä¸ª DataStream ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ‰§è¡Œç‰¹å®šçš„è½¬æ¢æ“ä½œï¼š 123DataStream&lt;Integer&gt; integerDataStream = env.fromElements(1, 2, 3, 4, 5);integerDataStream.map((MapFunction&lt;Integer, Object&gt;) value -&gt; value * 2).print();// è¾“å‡º 2,4,6,8,10 2.2 FlatMap [DataStream â†’ DataStream]FlatMap ä¸ Map ç±»ä¼¼ï¼Œä½†æ˜¯ FlatMap ä¸­çš„ä¸€ä¸ªè¾“å…¥å…ƒç´ å¯ä»¥è¢«æ˜ å°„æˆä¸€ä¸ªæˆ–è€…å¤šä¸ªè¾“å‡ºå…ƒç´ ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213String string01 = "one one one two two";String string02 = "third third third four";DataStream&lt;String&gt; stringDataStream = env.fromElements(string01, string02);stringDataStream.flatMap(new FlatMapFunction&lt;String, String&gt;() &#123; @Override public void flatMap(String value, Collector&lt;String&gt; out) throws Exception &#123; for (String s : value.split(" ")) &#123; out.collect(s); &#125; &#125;&#125;).print();// è¾“å‡ºæ¯ä¸€ä¸ªç‹¬ç«‹çš„å•è¯ï¼Œä¸ºèŠ‚çœæ’ç‰ˆï¼Œè¿™é‡Œå»æ‰æ¢è¡Œï¼Œåæ–‡äº¦åŒone one one two two third third third four 2.3 Filter [DataStream â†’ DataStream]ç”¨äºè¿‡æ»¤ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼š 1env.fromElements(1, 2, 3, 4, 5).filter(x -&gt; x &gt; 3).print(); 2.4 KeyBy å’Œ Reduce KeyBy [DataStream â†’ KeyedStream] ï¼šç”¨äºå°†ç›¸åŒ Key å€¼çš„æ•°æ®åˆ†åˆ°ç›¸åŒçš„åˆ†åŒºä¸­ï¼› Reduce [KeyedStream â†’ DataStream] ï¼šç”¨äºå¯¹æ•°æ®æ‰§è¡Œå½’çº¦è®¡ç®—ã€‚ å¦‚ä¸‹ä¾‹å­å°†æ•°æ®æŒ‰ç…§ key å€¼åˆ†åŒºåï¼Œæ»šåŠ¨è¿›è¡Œæ±‚å’Œè®¡ç®—ï¼š 12345678910111213DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; tuple2DataStream = env.fromElements(new Tuple2&lt;&gt;("a", 1), new Tuple2&lt;&gt;("a", 2), new Tuple2&lt;&gt;("b", 3), new Tuple2&lt;&gt;("b", 5));KeyedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple&gt; keyedStream = tuple2DataStream.keyBy(0);keyedStream.reduce((ReduceFunction&lt;Tuple2&lt;String, Integer&gt;&gt;) (value1, value2) -&gt; new Tuple2&lt;&gt;(value1.f0, value1.f1 + value2.f1)).print();// æŒç»­è¿›è¡Œæ±‚å’Œè®¡ç®—ï¼Œè¾“å‡ºï¼š(a,1)(a,3)(b,3)(b,8) KeyBy æ“ä½œå­˜åœ¨ä»¥ä¸‹ä¸¤ä¸ªé™åˆ¶ï¼š KeyBy æ“ä½œç”¨äºç”¨æˆ·è‡ªå®šä¹‰çš„ POJOs ç±»å‹æ—¶ï¼Œè¯¥è‡ªå®šä¹‰ç±»å‹å¿…é¡»é‡å†™ hashCode æ–¹æ³•ï¼› KeyBy æ“ä½œä¸èƒ½ç”¨äºæ•°ç»„ç±»å‹ã€‚ 2.5 Aggregations [KeyedStream â†’ DataStream]Aggregations æ˜¯å®˜æ–¹æä¾›çš„èšåˆç®—å­ï¼Œå°è£…äº†å¸¸ç”¨çš„èšåˆæ“ä½œï¼Œå¦‚ä¸Šåˆ©ç”¨ Reduce è¿›è¡Œæ±‚å’Œçš„æ“ä½œä¹Ÿå¯ä»¥åˆ©ç”¨ Aggregations ä¸­çš„ sum ç®—å­é‡å†™ä¸ºä¸‹é¢çš„å½¢å¼ï¼š 1tuple2DataStream.keyBy(0).sum(1).print(); é™¤äº† sum å¤–ï¼ŒFlink è¿˜æä¾›äº† min , max , minByï¼ŒmaxBy ç­‰å¸¸ç”¨èšåˆç®—å­ï¼š 123456789101112// æ»šåŠ¨è®¡ç®—æŒ‡å®škeyçš„æœ€å°å€¼ï¼Œå¯ä»¥é€šè¿‡indexæˆ–è€…fieldNameæ¥æŒ‡å®škeykeyedStream.min(0);keyedStream.min("key");// æ»šåŠ¨è®¡ç®—æŒ‡å®škeyçš„æœ€å¤§å€¼keyedStream.max(0);keyedStream.max("key");// æ»šåŠ¨è®¡ç®—æŒ‡å®škeyçš„æœ€å°å€¼ï¼Œå¹¶è¿”å›å…¶å¯¹åº”çš„å…ƒç´ keyedStream.minBy(0);keyedStream.minBy("key");// æ»šåŠ¨è®¡ç®—æŒ‡å®škeyçš„æœ€å¤§å€¼ï¼Œå¹¶è¿”å›å…¶å¯¹åº”çš„å…ƒç´ keyedStream.maxBy(0);keyedStream.maxBy("key"); 2.6 Union [DataStream* â†’ DataStream]ç”¨äºè¿æ¥ä¸¤ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ç±»å‹ç›¸åŒçš„ DataStream ã€‚å½“ç„¶ä¸€ä¸ª DataStream ä¹Ÿå¯ä»¥ä¸å…¶æœ¬ç”Ÿè¿›è¡Œè¿æ¥ï¼Œæ­¤æ—¶è¯¥ DataStream ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šè¢«è·å–ä¸¤æ¬¡ï¼š 123456DataStreamSource&lt;Tuple2&lt;String, Integer&gt;&gt; streamSource01 = env.fromElements(new Tuple2&lt;&gt;("a", 1), new Tuple2&lt;&gt;("a", 2));DataStreamSource&lt;Tuple2&lt;String, Integer&gt;&gt; streamSource02 = env.fromElements(new Tuple2&lt;&gt;("b", 1), new Tuple2&lt;&gt;("b", 2));streamSource01.union(streamSource02);streamSource01.union(streamSource01,streamSource02); 2.7 Connect [DataStream,DataStream â†’ ConnectedStreams]Connect æ“ä½œç”¨äºè¿æ¥ä¸¤ä¸ªæˆ–è€…å¤šä¸ªç±»å‹ä¸åŒçš„ DataStream ï¼Œå…¶è¿”å›çš„ç±»å‹æ˜¯ ConnectedStreams ï¼Œæ­¤æ—¶è¢«è¿æ¥çš„å¤šä¸ª DataStreams å¯ä»¥å…±äº«å½¼æ­¤ä¹‹é—´çš„æ•°æ®çŠ¶æ€ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ç”±äºä¸åŒ DataStream ä¹‹é—´çš„æ•°æ®ç±»å‹æ˜¯ä¸åŒçš„ï¼Œå¦‚æœæƒ³è¦è¿›è¡Œåç»­çš„è®¡ç®—æ“ä½œï¼Œè¿˜éœ€è¦é€šè¿‡ CoMap æˆ– CoFlatMap å°† ConnectedStreams è½¬æ¢å› DataStreamï¼š 12345678910111213141516171819DataStreamSource&lt;Tuple2&lt;String, Integer&gt;&gt; streamSource01 = env.fromElements(new Tuple2&lt;&gt;("a", 3), new Tuple2&lt;&gt;("b", 5));DataStreamSource&lt;Integer&gt; streamSource02 = env.fromElements(2, 3, 9);// ä½¿ç”¨connectè¿›è¡Œè¿æ¥ConnectedStreams&lt;Tuple2&lt;String, Integer&gt;, Integer&gt; connect = streamSource01.connect(streamSource02);connect.map(new CoMapFunction&lt;Tuple2&lt;String, Integer&gt;, Integer, Integer&gt;() &#123; @Override public Integer map1(Tuple2&lt;String, Integer&gt; value) throws Exception &#123; return value.f1; &#125; @Override public Integer map2(Integer value) throws Exception &#123; return value; &#125;&#125;).map(x -&gt; x * 100).print();// è¾“å‡ºï¼š300 500 200 900 300 2.8 Split å’Œ Select Split [DataStream â†’ SplitStream]ï¼šç”¨äºå°†ä¸€ä¸ª DataStream æŒ‰ç…§æŒ‡å®šè§„åˆ™è¿›è¡Œæ‹†åˆ†ä¸ºå¤šä¸ª DataStreamï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œè¿›è¡Œçš„æ˜¯é€»è¾‘æ‹†åˆ†ï¼Œå³ Split åªæ˜¯å°†æ•°æ®è´´ä¸Šä¸åŒçš„ç±»å‹æ ‡ç­¾ï¼Œä½†æœ€ç»ˆè¿”å›çš„ä»ç„¶åªæ˜¯ä¸€ä¸ª SplitStreamï¼› Select [SplitStream â†’ DataStream]ï¼šæƒ³è¦ä»é€»è¾‘æ‹†åˆ†çš„ SplitStream ä¸­è·å–çœŸå®çš„ä¸åŒç±»å‹çš„ DataStreamï¼Œéœ€è¦ä½¿ç”¨ Select ç®—å­ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213DataStreamSource&lt;Integer&gt; streamSource = env.fromElements(1, 2, 3, 4, 5, 6, 7, 8);// æ ‡è®°SplitStream&lt;Integer&gt; split = streamSource.split(new OutputSelector&lt;Integer&gt;() &#123; @Override public Iterable&lt;String&gt; select(Integer value) &#123; List&lt;String&gt; output = new ArrayList&lt;String&gt;(); output.add(value % 2 == 0 ? "even" : "odd"); return output; &#125;&#125;);// è·å–å¶æ•°æ•°æ®é›†split.select("even").print();// è¾“å‡º 2,4,6,8 2.9 project [DataStream â†’ DataStream]project ä¸»è¦ç”¨äºè·å– tuples ä¸­çš„æŒ‡å®šå­—æ®µé›†ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678DataStreamSource&lt;Tuple3&lt;String, Integer, String&gt;&gt; streamSource = env.fromElements( new Tuple3&lt;&gt;("li", 22, "2018-09-23"), new Tuple3&lt;&gt;("ming", 33, "2020-09-23"));streamSource.project(0,2).print();// è¾“å‡º(li,2018-09-23)(ming,2020-09-23) ä¸‰ã€ç‰©ç†åˆ†åŒºç‰©ç†åˆ†åŒº (Physical partitioning) æ˜¯ Flink æä¾›çš„åº•å±‚çš„ APIï¼Œå…è®¸ç”¨æˆ·é‡‡ç”¨å†…ç½®çš„åˆ†åŒºè§„åˆ™æˆ–è€…è‡ªå®šä¹‰çš„åˆ†åŒºè§„åˆ™æ¥å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œä»è€Œé¿å…æ•°æ®åœ¨æŸäº›åˆ†åŒºä¸Šè¿‡äºå€¾æ–œï¼Œå¸¸ç”¨çš„åˆ†åŒºè§„åˆ™å¦‚ä¸‹ï¼š 3.1 Random partitioning [DataStream â†’ DataStream]éšæœºåˆ†åŒº (Random partitioning) ç”¨äºéšæœºçš„å°†æ•°æ®åˆ†å¸ƒåˆ°æ‰€æœ‰ä¸‹æ¸¸åˆ†åŒºä¸­ï¼Œé€šè¿‡ shuffle æ–¹æ³•æ¥è¿›è¡Œå®ç°ï¼š 1dataStream.shuffle(); 3.2 Rebalancing [DataStream â†’ DataStream]Rebalancing é‡‡ç”¨è½®è¯¢çš„æ–¹å¼å°†æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œå…¶é€‚åˆäºå­˜åœ¨æ•°æ®å€¾æ–œçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡ rebalance æ–¹æ³•è¿›è¡Œå®ç°ï¼š 1dataStream.rebalance(); 3.3 Rescaling [DataStream â†’ DataStream]å½“é‡‡ç”¨ Rebalancing è¿›è¡Œåˆ†åŒºå¹³è¡¡æ—¶ï¼Œå…¶å®ç°çš„æ˜¯å…¨å±€æ€§çš„è´Ÿè½½å‡è¡¡ï¼Œæ•°æ®ä¼šé€šè¿‡ç½‘ç»œä¼ è¾“åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šå¹¶å®Œæˆåˆ†åŒºæ•°æ®çš„å‡è¡¡ã€‚ è€Œ Rescaling åˆ™æ˜¯ä½é…ç‰ˆæœ¬çš„ rebalanceï¼Œå®ƒä¸éœ€è¦é¢å¤–çš„ç½‘ç»œå¼€é”€ï¼Œå®ƒåªä¼šå¯¹ä¸Šä¸‹æ¸¸çš„ç®—å­ä¹‹é—´è¿›è¡Œé‡æ–°å‡è¡¡ï¼Œé€šè¿‡ rescale æ–¹æ³•è¿›è¡Œå®ç°ï¼š 1dataStream.rescale(); ReScale è¿™ä¸ªå•è¯å…·æœ‰é‡æ–°ç¼©æ”¾çš„æ„ä¹‰ï¼Œå…¶å¯¹åº”çš„æ“ä½œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå…·ä½“å¦‚ä¸‹ï¼šå¦‚æœä¸Šæ¸¸ operation å¹¶è¡Œåº¦ä¸º 2ï¼Œè€Œä¸‹æ¸¸çš„ operation å¹¶è¡Œåº¦ä¸º 6ï¼Œåˆ™å…¶ä¸­ 1 ä¸ªä¸Šæ¸¸çš„ operation ä¼šå°†å…ƒç´ åˆ†å‘åˆ° 3 ä¸ªä¸‹æ¸¸ operationï¼Œå¦ 1 ä¸ªä¸Šæ¸¸ operation åˆ™ä¼šå°†å…ƒç´ åˆ†å‘åˆ°å¦å¤– 3 ä¸ªä¸‹æ¸¸ operationã€‚åä¹‹äº¦ç„¶ï¼Œå¦‚æœä¸Šæ¸¸çš„ operation å¹¶è¡Œåº¦ä¸º 6ï¼Œè€Œä¸‹æ¸¸ operation å¹¶è¡Œåº¦ä¸º 2ï¼Œåˆ™å…¶ä¸­ 3 ä¸ªä¸Šæ¸¸ operation ä¼šå°†å…ƒç´ åˆ†å‘åˆ° 1 ä¸ªä¸‹æ¸¸ operationï¼Œå¦ 3 ä¸ªä¸Šæ¸¸ operation ä¼šå°†å…ƒç´ åˆ†å‘åˆ°å¦å¤– 1 ä¸ªä¸‹æ¸¸operationï¼š 3.4 Broadcasting [DataStream â†’ DataStream]å°†æ•°æ®åˆ†å‘åˆ°æ‰€æœ‰åˆ†åŒºä¸Šã€‚é€šå¸¸ç”¨äºå°æ•°æ®é›†ä¸å¤§æ•°æ®é›†è¿›è¡Œå…³è”çš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶å¯ä»¥å°†å°æ•°æ®é›†å¹¿æ’­åˆ°æ‰€æœ‰åˆ†åŒºä¸Šï¼Œé¿å…é¢‘ç¹çš„è·¨åˆ†åŒºå…³è”ï¼Œé€šè¿‡ broadcast æ–¹æ³•è¿›è¡Œå®ç°ï¼š 1dataStream.broadcast(); 3.5 Custom partitioning [DataStream â†’ DataStream]Flink è¿è¡Œç”¨æˆ·é‡‡ç”¨è‡ªå®šä¹‰çš„åˆ†åŒºè§„åˆ™æ¥å®ç°åˆ†åŒºï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡å®ç° Partitioner æ¥å£æ¥è‡ªå®šä¹‰åˆ†åŒºè§„åˆ™ï¼Œå¹¶æŒ‡å®šå¯¹åº”çš„åˆ†åŒºé”®ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516171819202122 DataStreamSource&lt;Tuple2&lt;String, Integer&gt;&gt; streamSource = env.fromElements(new Tuple2&lt;&gt;("Hadoop", 1), new Tuple2&lt;&gt;("Spark", 1), new Tuple2&lt;&gt;("Flink-streaming", 2), new Tuple2&lt;&gt;("Flink-batch", 4), new Tuple2&lt;&gt;("Storm", 4), new Tuple2&lt;&gt;("HBase", 3));streamSource.partitionCustom(new Partitioner&lt;String&gt;() &#123; @Override public int partition(String key, int numPartitions) &#123; // å°†ç¬¬ä¸€ä¸ªå­—æ®µåŒ…å«flinkçš„Tuple2åˆ†é…åˆ°åŒä¸€ä¸ªåˆ†åŒº return key.toLowerCase().contains("flink") ? 0 : 1; &#125;&#125;, 0).print();// è¾“å‡ºå¦‚ä¸‹ï¼š1&gt; (Flink-streaming,2)1&gt; (Flink-batch,4)2&gt; (Hadoop,1)2&gt; (Spark,1)2&gt; (Storm,4)2&gt; (HBase,3) å››ã€ä»»åŠ¡é“¾å’Œèµ„æºç»„ä»»åŠ¡é“¾å’Œèµ„æºç»„ ( Task chaining and resource groups ) ä¹Ÿæ˜¯ Flink æä¾›çš„åº•å±‚ APIï¼Œç”¨äºæ§åˆ¶ä»»åŠ¡é“¾å’Œèµ„æºåˆ†é…ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ“ä½œå…è®¸ (ä¾‹å¦‚ç›¸é‚»çš„ä¸¤æ¬¡ map æ“ä½œ) ï¼Œåˆ™ Flink ä¼šå°è¯•å°†å®ƒä»¬åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…è¿›è¡Œï¼Œä»è€Œå¯ä»¥è·å–æ›´å¥½çš„æ€§èƒ½ã€‚ä½†æ˜¯ Flink ä¹Ÿå…è®¸ç”¨æˆ·è‡ªå·±æ¥æ§åˆ¶è¿™äº›è¡Œä¸ºï¼Œè¿™å°±æ˜¯ä»»åŠ¡é“¾å’Œèµ„æºç»„ APIï¼š 4.1 startNewChainstartNewChain ç”¨äºåŸºäºå½“å‰ operation å¼€å¯ä¸€ä¸ªæ–°çš„ä»»åŠ¡é“¾ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼ŒåŸºäºç¬¬ä¸€ä¸ª map å¼€å¯ä¸€ä¸ªæ–°çš„ä»»åŠ¡é“¾ï¼Œæ­¤æ—¶å‰ä¸€ä¸ª map å’Œ åä¸€ä¸ª map å°†å¤„äºåŒä¸€ä¸ªæ–°çš„ä»»åŠ¡é“¾ä¸­ï¼Œä½†å®ƒä»¬ä¸ filter æ“ä½œåˆ™åˆ†åˆ«å¤„äºä¸åŒçš„ä»»åŠ¡é“¾ä¸­ï¼š 1someStream.filter(...).map(...).startNewChain().map(...); 4.2 disableChaining disableChaining æ“ä½œç”¨äºç¦æ­¢å°†å…¶ä»–æ“ä½œä¸å½“å‰æ“ä½œæ”¾ç½®äºåŒä¸€ä¸ªä»»åŠ¡é“¾ä¸­ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 1someStream.map(...).disableChaining(); 4.3 slotSharingGroupslot æ˜¯ä»»åŠ¡ç®¡ç†å™¨ (TaskManager) æ‰€æ‹¥æœ‰èµ„æºçš„å›ºå®šå­é›†ï¼Œæ¯ä¸ªæ“ä½œ (operation) çš„å­ä»»åŠ¡ (sub task) éƒ½éœ€è¦è·å– slot æ¥æ‰§è¡Œè®¡ç®—ï¼Œä½†æ¯ä¸ªæ“ä½œæ‰€éœ€è¦èµ„æºçš„å¤§å°éƒ½æ˜¯ä¸ç›¸åŒçš„ï¼Œä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨èµ„æºï¼ŒFlink å…è®¸ä¸åŒæ“ä½œçš„å­ä»»åŠ¡è¢«éƒ¨ç½²åˆ°åŒä¸€ slot ä¸­ã€‚slotSharingGroup ç”¨äºè®¾ç½®æ“ä½œçš„ slot å…±äº«ç»„ (slot sharing group) ï¼ŒFlink ä¼šå°†å…·æœ‰ç›¸åŒ slot å…±äº«ç»„çš„æ“ä½œæ”¾åˆ°åŒä¸€ä¸ª slot ä¸­ ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 1someStream.filter(...).slotSharingGroup("slotSharingGroupName"); Sinkä¸€ã€Data Sinksåœ¨ä½¿ç”¨ Flink è¿›è¡Œæ•°æ®å¤„ç†æ—¶ï¼Œæ•°æ®ç» Data Source æµå…¥ï¼Œç„¶åé€šè¿‡ç³»åˆ— Transformations çš„è½¬åŒ–ï¼Œæœ€ç»ˆå¯ä»¥é€šè¿‡ Sink å°†è®¡ç®—ç»“æœè¿›è¡Œè¾“å‡ºï¼ŒFlink Data Sinks å°±æ˜¯ç”¨äºå®šä¹‰æ•°æ®æµæœ€ç»ˆçš„è¾“å‡ºä½ç½®ã€‚Flink æä¾›äº†å‡ ä¸ªè¾ƒä¸ºç®€å•çš„ Sink API ç”¨äºæ—¥å¸¸çš„å¼€å‘ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 1.1 writeAsTextwriteAsText ç”¨äºå°†è®¡ç®—ç»“æœä»¥æ–‡æœ¬çš„æ–¹å¼å¹¶è¡Œåœ°å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹ï¼Œé™¤äº†è·¯å¾„å‚æ•°æ˜¯å¿…é€‰å¤–ï¼Œè¯¥æ–¹æ³•è¿˜å¯ä»¥é€šè¿‡æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°æ¥å®šä¹‰è¾“å‡ºæ¨¡å¼ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¸¤ä¸ªå¯é€‰å€¼ï¼š WriteMode.NO_OVERWRITEï¼šå½“æŒ‡å®šè·¯å¾„ä¸Šä¸å­˜åœ¨ä»»ä½•æ–‡ä»¶æ—¶ï¼Œæ‰æ‰§è¡Œå†™å‡ºæ“ä½œï¼› WriteMode.OVERWRITEï¼šä¸è®ºæŒ‡å®šè·¯å¾„ä¸Šæ˜¯å¦å­˜åœ¨æ–‡ä»¶ï¼Œéƒ½æ‰§è¡Œå†™å‡ºæ“ä½œï¼›å¦‚æœåŸæ¥å·²æœ‰æ–‡ä»¶ï¼Œåˆ™è¿›è¡Œè¦†ç›–ã€‚ ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 1streamSource.writeAsText("D:\\out", FileSystem.WriteMode.OVERWRITE); ä»¥ä¸Šå†™å‡ºæ˜¯ä»¥å¹¶è¡Œçš„æ–¹å¼å†™å‡ºåˆ°å¤šä¸ªæ–‡ä»¶ï¼Œå¦‚æœæƒ³è¦å°†è¾“å‡ºç»“æœå…¨éƒ¨å†™å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œéœ€è¦è®¾ç½®å…¶å¹¶è¡Œåº¦ä¸º 1ï¼š 1streamSource.writeAsText("D:\\out", FileSystem.WriteMode.OVERWRITE).setParallelism(1); 1.2 writeAsCsvwriteAsCsv ç”¨äºå°†è®¡ç®—ç»“æœä»¥ CSV çš„æ–‡ä»¶æ ¼å¼å†™å‡ºåˆ°æŒ‡å®šç›®å½•ï¼Œé™¤äº†è·¯å¾„å‚æ•°æ˜¯å¿…é€‰å¤–ï¼Œè¯¥æ–¹æ³•è¿˜æ”¯æŒä¼ å…¥è¾“å‡ºæ¨¡å¼ï¼Œè¡Œåˆ†éš”ç¬¦ï¼Œå’Œå­—æ®µåˆ†éš”ç¬¦ä¸‰ä¸ªé¢å¤–çš„å‚æ•°ï¼Œå…¶æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š 1writeAsCsv(String path, WriteMode writeMode, String rowDelimiter, String fieldDelimiter) 1.3 print / printToErrprint / printToErr æ˜¯æµ‹è¯•å½“ä¸­æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œç”¨äºå°†è®¡ç®—ç»“æœä»¥æ ‡å‡†è¾“å‡ºæµæˆ–é”™è¯¯è¾“å‡ºæµçš„æ–¹å¼æ‰“å°åˆ°æ§åˆ¶å°ä¸Šã€‚ 1.4 writeUsingOutputFormaté‡‡ç”¨è‡ªå®šä¹‰çš„è¾“å‡ºæ ¼å¼å°†è®¡ç®—ç»“æœå†™å‡ºï¼Œä¸Šé¢ä»‹ç»çš„ writeAsText å’Œ writeAsCsv å…¶åº•å±‚è°ƒç”¨çš„éƒ½æ˜¯è¯¥æ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š 12345public DataStreamSink&lt;T&gt; writeAsText(String path, WriteMode writeMode) &#123; TextOutputFormat&lt;T&gt; tof = new TextOutputFormat&lt;&gt;(new Path(path)); tof.setWriteMode(writeMode); return writeUsingOutputFormat(tof);&#125; 1.5 writeToSocketwriteToSocket ç”¨äºå°†è®¡ç®—ç»“æœä»¥æŒ‡å®šçš„æ ¼å¼å†™å‡ºåˆ° Socket ä¸­ï¼Œä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 1streamSource.writeToSocket("192.168.0.226", 9999, new SimpleStringSchema()); äºŒã€Streaming Connectorsé™¤äº†ä¸Šè¿° API å¤–ï¼ŒFlink ä¸­è¿˜å†…ç½®äº†ç³»åˆ—çš„ Connectors è¿æ¥å™¨ï¼Œç”¨äºå°†è®¡ç®—ç»“æœè¾“å…¥åˆ°å¸¸ç”¨çš„å­˜å‚¨ç³»ç»Ÿæˆ–è€…æ¶ˆæ¯ä¸­é—´ä»¶ä¸­ï¼Œå…·ä½“å¦‚ä¸‹ï¼š Apache Kafka (æ”¯æŒ source å’Œ sink) Apache Cassandra (sink) Amazon Kinesis Streams (source/sink) Elasticsearch (sink) Hadoop FileSystem (sink) RabbitMQ (source/sink) Apache NiFi (source/sink) Google PubSub (source/sink) é™¤äº†å†…ç½®çš„è¿æ¥å™¨å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡ Apache Bahir çš„è¿æ¥å™¨æ‰©å±• Flinkã€‚Apache Bahir æ—¨åœ¨ä¸ºåˆ†å¸ƒå¼æ•°æ®åˆ†æç³»ç»Ÿ (å¦‚ Sparkï¼ŒFlink) ç­‰æä¾›åŠŸèƒ½ä¸Šçš„æ‰©å±•ï¼Œå½“å‰å…¶æ”¯æŒçš„ä¸ Flink Sink ç›¸å…³çš„è¿æ¥å™¨å¦‚ä¸‹ï¼š Apache ActiveMQ (source/sink) Apache Flume (sink) Redis (sink) Akka (sink) è¿™é‡Œæ¥ç€åœ¨ Data Sources ç« èŠ‚ä»‹ç»çš„æ•´åˆ Kafka Source çš„åŸºç¡€ä¸Šï¼Œå°† Kafka Sink ä¹Ÿä¸€å¹¶è¿›è¡Œæ•´åˆï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ã€‚ ä¸‰ã€æ•´åˆ Kafka Sink3.1 addSinkFlink æä¾›äº† addSink æ–¹æ³•ç”¨æ¥è°ƒç”¨è‡ªå®šä¹‰çš„ Sink æˆ–è€…ç¬¬ä¸‰æ–¹çš„è¿æ¥å™¨ï¼Œæƒ³è¦å°†è®¡ç®—ç»“æœå†™å‡ºåˆ° Kafkaï¼Œéœ€è¦ä½¿ç”¨è¯¥æ–¹æ³•æ¥è°ƒç”¨ Kafka çš„ç”Ÿäº§è€… FlinkKafkaProducerï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();// 1.æŒ‡å®šKafkaçš„ç›¸å…³é…ç½®å±æ€§Properties properties = new Properties();properties.setProperty("bootstrap.servers", "192.168.200.0:9092");// 2.æ¥æ”¶Kafkaä¸Šçš„æ•°æ®DataStream&lt;String&gt; stream = env .addSource(new FlinkKafkaConsumer&lt;&gt;("flink-stream-in-topic", new SimpleStringSchema(), properties));// 3.å®šä¹‰è®¡ç®—ç»“æœåˆ° Kafka ProducerRecord çš„è½¬æ¢KafkaSerializationSchema&lt;String&gt; kafkaSerializationSchema = new KafkaSerializationSchema&lt;String&gt;() &#123; @Override public ProducerRecord&lt;byte[], byte[]&gt; serialize(String element, @Nullable Long timestamp) &#123; return new ProducerRecord&lt;&gt;("flink-stream-out-topic", element.getBytes()); &#125;&#125;;// 4. å®šä¹‰Flink Kafkaç”Ÿäº§è€…FlinkKafkaProducer&lt;String&gt; kafkaProducer = new FlinkKafkaProducer&lt;&gt;("flink-stream-out-topic", kafkaSerializationSchema, properties, FlinkKafkaProducer.Semantic.AT_LEAST_ONCE, 5);// 5. å°†æ¥æ”¶åˆ°è¾“å…¥å…ƒç´ *2åå†™å‡ºåˆ°Kafkastream.map((MapFunction&lt;String, String&gt;) value -&gt; value + value).addSink(kafkaProducer);env.execute("Flink Streaming"); 3.2 åˆ›å»ºè¾“å‡ºä¸»é¢˜åˆ›å»ºç”¨äºè¾“å‡ºæµ‹è¯•çš„ä¸»é¢˜ï¼š 12345678bin/kafka-topics.sh --create \ --bootstrap-server hadoop001:9092 \ --replication-factor 1 \ --partitions 1 \ --topic flink-stream-out-topic# æŸ¥çœ‹æ‰€æœ‰ä¸»é¢˜ bin/kafka-topics.sh --list --bootstrap-server hadoop001:9092 3.3 å¯åŠ¨æ¶ˆè´¹è€…å¯åŠ¨ä¸€ä¸ª Kafka æ¶ˆè´¹è€…ï¼Œç”¨äºæŸ¥çœ‹ Flink ç¨‹åºçš„è¾“å‡ºæƒ…å†µï¼š 1bin/kafka-console-consumer.sh --bootstrap-server hadoop001:9092 --topic flink-stream-out-topic 3.4 æµ‹è¯•ç»“æœåœ¨ Kafka ç”Ÿäº§è€…ä¸Šå‘é€æ¶ˆæ¯åˆ° Flink ç¨‹åºï¼Œè§‚å¯Ÿ Flink ç¨‹åºè½¬æ¢åçš„è¾“å‡ºæƒ…å†µï¼Œå…·ä½“å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ° Kafka ç”Ÿæˆè€…å‘å‡ºçš„æ•°æ®å·²ç»è¢« Flink ç¨‹åºæ­£å¸¸æ¥æ”¶åˆ°ï¼Œå¹¶ç»è¿‡è½¬æ¢ååˆè¾“å‡ºåˆ° Kafka å¯¹åº”çš„ Topic ä¸Šã€‚ å››ã€è‡ªå®šä¹‰ Sinké™¤äº†ä½¿ç”¨å†…ç½®çš„ç¬¬ä¸‰æ–¹è¿æ¥å™¨å¤–ï¼ŒFlink è¿˜æ”¯æŒä½¿ç”¨è‡ªå®šä¹‰çš„ Sink æ¥æ»¡è¶³å¤šæ ·åŒ–çš„è¾“å‡ºéœ€æ±‚ã€‚æƒ³è¦å®ç°è‡ªå®šä¹‰çš„ Sink ï¼Œéœ€è¦ç›´æ¥æˆ–è€…é—´æ¥å®ç° SinkFunction æ¥å£ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯å®ç°å…¶æŠ½è±¡ç±» RichSinkFunctionï¼Œç›¸æ¯”äº SinkFunction ï¼Œå…¶æä¾›äº†æ›´å¤šçš„ä¸ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ–¹æ³•ã€‚ä¸¤è€…é—´çš„å…³ç³»å¦‚ä¸‹ï¼š è¿™é‡Œæˆ‘ä»¬ä»¥è‡ªå®šä¹‰ä¸€ä¸ª FlinkToMySQLSink ä¸ºä¾‹ï¼Œå°†è®¡ç®—ç»“æœå†™å‡ºåˆ° MySQL æ•°æ®åº“ä¸­ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š 4.1 å¯¼å…¥ä¾èµ–é¦–å…ˆéœ€è¦å¯¼å…¥ MySQL ç›¸å…³çš„ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.16&lt;/version&gt;&lt;/dependency&gt; 4.2 è‡ªå®šä¹‰ Sinkç»§æ‰¿è‡ª RichSinkFunctionï¼Œå®ç°è‡ªå®šä¹‰çš„ Sink ï¼š 123456789101112131415161718192021222324252627282930313233343536public class FlinkToMySQLSink extends RichSinkFunction&lt;Employee&gt; &#123; private PreparedStatement stmt; private Connection conn; @Override public void open(Configuration parameters) throws Exception &#123; Class.forName("com.mysql.cj.jdbc.Driver"); conn = DriverManager.getConnection("jdbc:mysql://192.168.0.229:3306/employees" + "?characterEncoding=UTF-8&amp;serverTimezone=UTC&amp;useSSL=false", "root", "123456"); String sql = "insert into emp(name, age, birthday) values(?, ?, ?)"; stmt = conn.prepareStatement(sql); &#125; @Override public void invoke(Employee value, Context context) throws Exception &#123; stmt.setString(1, value.getName()); stmt.setInt(2, value.getAge()); stmt.setDate(3, value.getBirthday()); stmt.executeUpdate(); &#125; @Override public void close() throws Exception &#123; super.close(); if (stmt != null) &#123; stmt.close(); &#125; if (conn != null) &#123; conn.close(); &#125; &#125;&#125; 4.3 ä½¿ç”¨è‡ªå®šä¹‰ Sinkæƒ³è¦ä½¿ç”¨è‡ªå®šä¹‰çš„ Sinkï¼ŒåŒæ ·æ˜¯éœ€è¦è°ƒç”¨ addSink æ–¹æ³•ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 12345678final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();Date date = new Date(System.currentTimeMillis());DataStreamSource&lt;Employee&gt; streamSource = env.fromElements( new Employee("hei", 10, date), new Employee("bai", 20, date), new Employee("ying", 30, date));streamSource.addSink(new FlinkToMySQLSink());env.execute(); 4.4 æµ‹è¯•ç»“æœå¯åŠ¨ç¨‹åºï¼Œè§‚å¯Ÿæ•°æ®åº“å†™å…¥æƒ…å†µï¼š æ•°æ®åº“æˆåŠŸå†™å…¥ï¼Œä»£è¡¨è‡ªå®šä¹‰ Sink æ•´åˆæˆåŠŸã€‚]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Flink</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>Flink</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Sparkä»‹ç»]]></title>
    <url>%2F2020%2F03%2F31%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FSpark%2F1.Spark%20%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[Sparkä»‹ç»ä»€ä¹ˆæ˜¯Spark Sparkæ˜¯ä¸€ç§å¿«é€Ÿã€é€šç”¨ã€å¯æ‰©å±•çš„å¤§æ•°æ®åˆ†æå¼•æ“ï¼Œ2009å¹´è¯ç”ŸäºåŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡AMPLabï¼Œ2010å¹´å¼€æºï¼Œ2013å¹´6æœˆæˆä¸ºApacheå­µåŒ–é¡¹ç›®ï¼Œ2014å¹´2æœˆæˆä¸ºApacheé¡¶çº§é¡¹ç›®ã€‚ SparkåŸºäºå†…å­˜è®¡ç®—ï¼Œæé«˜äº†åœ¨å¤§æ•°æ®ç¯å¢ƒä¸‹æ•°æ®å¤„ç†çš„å®æ—¶æ€§ï¼ŒåŒæ—¶ä¿è¯äº†é«˜å®¹é”™æ€§å’Œé«˜å¯ä¼¸ç¼©æ€§ï¼Œå…è®¸ç”¨æˆ·å°†Sparkéƒ¨ç½²åœ¨å¤§é‡å»‰ä»·ç¡¬ä»¶ä¹‹ä¸Šï¼Œå½¢æˆé›†ç¾¤ã€‚ Spark çš„ç‰¹ç‚¹ ä¸­é—´ç»“æœè¾“å‡ºï¼šåŸºäºMapReduceçš„è®¡ç®—å¼•æ“é€šå¸¸ä¼šå°†ä¸­é—´ç»“æœè¾“å‡ºåˆ°ç£ç›˜ä¸Šï¼Œè¿›è¡Œå­˜å‚¨å’Œå®¹é”™ã€‚å‡ºäºä»»åŠ¡ç®¡é“æ‰¿æ¥çš„è€ƒè™‘ï¼Œå½“ä¸€äº›æŸ¥è¯¢ç¿»è¯‘åˆ°MapReduceä»»åŠ¡æ—¶ï¼Œå¾€å¾€ä¼šäº§ç”Ÿå¤šä¸ªStageï¼Œè€Œè¿™äº›ä¸²è”çš„Stageåˆä¾èµ–äºåº•å±‚æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚HDFSï¼‰æ¥å­˜å‚¨æ¯ä¸€ä¸ªStageçš„è¾“å‡ºç»“æœ; Spark åˆ™å°†ä¸­é—´ç»“æœä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·å¤§å¤§æé«˜äº†æ•°æ®å¤„ç†çš„å®æ—¶æ€§å’Œé€Ÿåº¦ï¼› å…¼å®¹HDFSï¼ŒHIVE: Sparkæ˜¯MapReduceçš„æ›¿ä»£æ–¹æ¡ˆï¼Œè€Œä¸”å…¼å®¹HDFSã€Hiveï¼Œå¯èå…¥Hadoopçš„ç”Ÿæ€ç³»ç»Ÿï¼Œä»¥å¼¥è¡¥MapReduceçš„ä¸è¶³ã€‚ é€Ÿåº¦å¿«: ä¸Hadoopçš„MapReduceç›¸æ¯”ï¼ŒSparkåŸºäºå†…å­˜çš„è¿ç®—è¦å¿«100å€ä»¥ä¸Šï¼ŒåŸºäºç¡¬ç›˜çš„è¿ç®—ä¹Ÿè¦å¿«10å€ä»¥ä¸Šã€‚Sparkå®ç°äº†é«˜æ•ˆçš„DAGæ‰§è¡Œå¼•æ“ï¼Œå¯ä»¥é€šè¿‡åŸºäºå†…å­˜æ¥é«˜æ•ˆå¤„ç†æ•°æ®æµã€‚ æ¥å£ä¸°å¯Œ: Sparkæ”¯æŒJavaã€Pythonå’ŒScalaçš„APIï¼Œè¿˜æ”¯æŒè¶…è¿‡80ç§é«˜çº§ç®—æ³•ï¼Œä½¿ç”¨æˆ·å¯ä»¥å¿«é€Ÿæ„å»ºä¸åŒçš„åº”ç”¨ã€‚è€Œä¸”Sparkæ”¯æŒäº¤äº’å¼çš„Pythonå’ŒScalaçš„shellï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°åœ¨è¿™äº›shellä¸­ä½¿ç”¨Sparké›†ç¾¤æ¥éªŒè¯è§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚ é€šç”¨æ€§: Sparkæä¾›äº†ç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆã€‚Sparkå¯ä»¥ç”¨äºæ‰¹å¤„ç†ã€äº¤äº’å¼æŸ¥è¯¢ï¼ˆSpark SQLï¼‰ã€å®æ—¶æµå¤„ç†ï¼ˆSpark Streamingï¼‰ã€æœºå™¨å­¦ä¹ ï¼ˆSpark MLlibï¼‰å’Œå›¾è®¡ç®—ï¼ˆGraphXï¼‰ã€‚è¿™äº›ä¸åŒç±»å‹çš„å¤„ç†éƒ½å¯ä»¥åœ¨åŒä¸€ä¸ªåº”ç”¨ä¸­æ— ç¼ä½¿ç”¨ã€‚Sparkç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆéå¸¸å…·æœ‰å¸å¼•åŠ›ï¼Œæ¯•ç«Ÿä»»ä½•å…¬å¸éƒ½æƒ³ç”¨ç»Ÿä¸€çš„å¹³å°å»å¤„ç†é‡åˆ°çš„é—®é¢˜ï¼Œå‡å°‘å¼€å‘å’Œç»´æŠ¤çš„äººåŠ›æˆæœ¬å’Œéƒ¨ç½²å¹³å°çš„ç‰©åŠ›æˆæœ¬ã€‚ å…¼å®¹æ€§: Sparkå¯ä»¥éå¸¸æ–¹ä¾¿åœ°ä¸å…¶ä»–çš„å¼€æºäº§å“è¿›è¡Œèåˆã€‚æ¯”å¦‚ï¼ŒSparkå¯ä»¥ä½¿ç”¨Hadoopçš„YARNå’ŒApache Mesosä½œä¸ºå®ƒçš„èµ„æºç®¡ç†å’Œè°ƒåº¦å™¨ï¼Œå™¨ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†æ‰€æœ‰Hadoopæ”¯æŒçš„æ•°æ®ï¼ŒåŒ…æ‹¬HDFSã€HBaseå’ŒCassandraç­‰ã€‚è¿™å¯¹äºå·²ç»éƒ¨ç½²Hadoopé›†ç¾¤çš„ç”¨æˆ·ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºä¸éœ€è¦åšä»»ä½•æ•°æ®è¿ç§»å°±å¯ä»¥ä½¿ç”¨Sparkçš„å¼ºå¤§å¤„ç†èƒ½åŠ›ã€‚Sparkä¹Ÿå¯ä»¥ä¸ä¾èµ–äºç¬¬ä¸‰æ–¹çš„èµ„æºç®¡ç†å’Œè°ƒåº¦å™¨ï¼Œå®ƒå®ç°äº†Standaloneä½œä¸ºå…¶å†…ç½®çš„èµ„æºç®¡ç†å’Œè°ƒåº¦æ¡†æ¶ï¼Œè¿™æ ·è¿›ä¸€æ­¥é™ä½äº†Sparkçš„ä½¿ç”¨é—¨æ§›ï¼Œä½¿å¾—æ‰€æœ‰äººéƒ½å¯ä»¥éå¸¸å®¹æ˜“åœ°éƒ¨ç½²å’Œä½¿ç”¨Sparkã€‚ Sparké›†ç¾¤å®‰è£…å’Œè¿è¡ŒSpark é›†ç¾¤å®‰è£… ç¯å¢ƒå‡†å¤‡ å‡†å¤‡ä¸¤å°ä»¥ä¸Šçš„LinuxæœåŠ¡å™¨ï¼Œå¹¶å®‰è£…å¥½JDK(&gt;=1.7) ä¸‹è½½Sparkå®‰è£…åŒ… ä¸‹è½½åœ°å€: http://www.apache.org/dyn/closer.lua/spark è§£å‹å®‰è£…åŒ…: tar -zxvf spark-xxx.tgz -C /usr/local/ é…ç½®Spark(1.5.2ç‰ˆæœ¬ä¸ºä¾‹) è¿›å…¥åˆ°Sparkå®‰è£…ç›®å½•ï¼Œ è¿›å…¥confç›®å½•å¹¶é‡å‘½åå¹¶ä¿®æ”¹spark-env.sh.templateæ–‡ä»¶ 123cd /usr/local/spark-1.5.2-bin-hadoop2.6cd conf/mv spark-env.sh.template spark-env.sh åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½® 1234vi spark-env.shexport JAVA_HOME=/usr/java/jdk1.7.0_45export SPARK_MASTER_IP=node1.itcast.cnexport SPARK_MASTER_PORT=7077 ä¿å­˜é€€å‡º é‡å‘½åå¹¶ä¿®æ”¹slaves.templateæ–‡ä»¶ åœ¨è¯¥æ–‡ä»¶ä¸­æ·»åŠ å­èŠ‚ç‚¹æ‰€åœ¨çš„ä½ç½®ï¼ˆWorkerèŠ‚ç‚¹ï¼‰ 12345mv slaves.template slavesvi slavesnode2.itcast.cnnode3.itcast.cnnode4.itcast.cn ä¿å­˜é€€å‡º å°†é…ç½®å¥½çš„Sparkæ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Š 123scp -r spark-1.5.2-bin-hadoop2.6/ node2.itcast.cn:/usr/local/scp -r spark-1.5.2-bin-hadoop2.6/ node3.itcast.cn:/usr/local/scp -r spark-1.5.2-bin-hadoop2.6/ node4.itcast.cn:/usr/local/ Sparké›†ç¾¤é…ç½®å®Œæ¯•ï¼Œç›®å‰æ˜¯1ä¸ªMasterï¼Œ3ä¸ªWorkï¼Œåœ¨node1.itcast.cnä¸Šå¯åŠ¨Sparké›†ç¾¤ /usr/local/spark-1.5.2-bin-hadoop2.6/sbin/start-all.sh å¯åŠ¨åæ‰§è¡Œjpså‘½ä»¤ï¼Œä¸»èŠ‚ç‚¹ä¸Šæœ‰Masterè¿›ç¨‹ï¼Œå…¶ä»–å­èŠ‚ç‚¹ä¸Šæœ‰Workè¿›è¡Œï¼Œç™»å½•Sparkç®¡ç†ç•Œé¢æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼ˆä¸»èŠ‚ç‚¹ï¼‰ï¼šhttp://node1.itcast.cn:8080/ åˆ°æ­¤ä¸ºæ­¢ï¼ŒSparké›†ç¾¤å®‰è£…å®Œæ¯•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯MasterèŠ‚ç‚¹å­˜åœ¨å•ç‚¹æ•…éšœï¼Œè¦è§£å†³æ­¤é—®é¢˜ï¼Œå°±è¦å€ŸåŠ©zookeeperï¼Œå¹¶ä¸”å¯åŠ¨è‡³å°‘ä¸¤ä¸ªMasterèŠ‚ç‚¹æ¥å®ç°é«˜å¯é ï¼Œé…ç½®æ–¹å¼æ¯”è¾ƒç®€å•ï¼š Sparké›†ç¾¤è§„åˆ’ï¼šnode1ï¼Œnode2æ˜¯Masterï¼›node3ï¼Œnode4ï¼Œnode5æ˜¯Worker å®‰è£…é…ç½®zké›†ç¾¤ï¼Œå¹¶å¯åŠ¨zké›†ç¾¤ åœæ­¢sparkæ‰€æœ‰æœåŠ¡ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶spark-env.shï¼Œåœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­åˆ æ‰SPARK_MASTER_IPå¹¶æ·»åŠ å¦‚ä¸‹é…ç½® 1export SPARK_DAEMON_JAVA_OPTS="-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=zk1,zk2,zk3 -Dspark.deploy.zookeeper.dir=/spark" åœ¨node1èŠ‚ç‚¹ä¸Šä¿®æ”¹slavesé…ç½®æ–‡ä»¶å†…å®¹æŒ‡å®šworkerèŠ‚ç‚¹ åœ¨node1ä¸Šæ‰§è¡Œsbin/start-all.shè„šæœ¬ï¼Œç„¶ååœ¨node2ä¸Šæ‰§è¡Œsbin/start-master.shå¯åŠ¨ç¬¬äºŒä¸ªMaster æ‰§è¡ŒSparkåº”ç”¨Sparkä»»åŠ¡æäº¤å‘½ä»¤æ ¼å¼ 123456spark-submit \--class $class \--master spark://$spark_master_node \--executor-memory $memory_use \--total-executor-cores $core_use \$jar [args] å‘½ä»¤ç¤ºä¾‹ 1234567/usr/local/spark-1.5.2-bin-hadoop2.6/bin/spark-submit \--class org.apache.spark.examples.SparkPi \--master spark://node1.itcast.cn:7077 \--executor-memory 1G \--total-executor-cores 2 \/usr/local/spark-1.5.2-bin-hadoop2.6/lib/spark-examples-1.5.2-hadoop2.6.0.jar \100 Spark shellspark shellä½œç”¨ spark-shellæ˜¯Sparkè‡ªå¸¦çš„äº¤äº’å¼Shellç¨‹åºï¼Œæ–¹ä¾¿ç”¨æˆ·è¿›è¡Œäº¤äº’å¼ç¼–ç¨‹ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¯¥å‘½ä»¤è¡Œä¸‹ç”¨scalaç¼–å†™sparkç¨‹åºã€‚ spark shell å¯åŠ¨ 1234/usr/local/spark-1.5.2-bin-hadoop2.6/bin/spark-shell \--master spark://node1.itcast.cn:7077 \--executor-memory 2g \--total-executor-cores 2 å‚æ•°: â€“master spark://node1.itcast.cn:7077 æŒ‡å®šMasterçš„åœ°å€ â€“executor-memory 2g æŒ‡å®šæ¯ä¸ªworkerå¯ç”¨å†…å­˜ä¸º2G â€“total-executor-cores 2 æŒ‡å®šæ•´ä¸ªé›†ç¾¤ä½¿ç”¨çš„cupæ ¸æ•°ä¸º2ä¸ª å¦‚æœå¯åŠ¨spark shellæ—¶æ²¡æœ‰æŒ‡å®šmasteråœ°å€ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ­£å¸¸å¯åŠ¨spark shellå’Œæ‰§è¡Œspark shellä¸­çš„ç¨‹åºï¼Œå…¶å®æ˜¯å¯åŠ¨äº†sparkçš„localæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä»…åœ¨æœ¬æœºå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œæ²¡æœ‰ä¸é›†ç¾¤å»ºç«‹è”ç³»ã€‚ Spark Shellä¸­å·²ç»é»˜è®¤å°†SparkContextç±»åˆå§‹åŒ–ä¸ºå¯¹è±¡scã€‚ç”¨æˆ·ä»£ç å¦‚æœéœ€è¦ç”¨åˆ°ï¼Œåˆ™ç›´æ¥åº”ç”¨scå³å¯ ç¼–å†™Sparkç¨‹åºSpark Shellç¼–å†™ç¨‹åºç¤ºä¾‹ é¦–å…ˆå¯åŠ¨hdfs å‘hdfsä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åˆ°hdfs://node1.itcast.cn:9000/words.txt åœ¨spark shellä¸­ç”¨scalaè¯­è¨€ç¼–å†™sparkç¨‹åº(å…ˆå¯åŠ¨spark shell) 1sc.textFile("hdfs://node1.itcast.cn:9000/words.txt").flatMap(_.split(" ")).map((_,1)).reduceByKey(_+_).saveAsTextFile("hdfs://node1.itcast.cn:9000/out") ä½¿ç”¨hdfså‘½ä»¤æŸ¥çœ‹ç»“æœ â€‹ hdfs dfs -ls hdfs://node1.itcast.cn:9000/out/p* è¯´æ˜ï¼š â€‹ scæ˜¯SparkContextå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ—¶æäº¤sparkç¨‹åºçš„å…¥å£ â€‹ æ¯ä¸€ä¸ªæ–¹æ³•éƒ½æ˜¯sparkçš„ä¸€ä¸ªç®—å­ï¼Œå¯¹åº”sparkçš„ä¸€ä¸ªRDDæ•°æ®ç»“æ„ï¼Œå¯¹åº”ä¸€ç§æ•°æ®çš„æ“ä½œï¼Œåˆåˆ†ä¸ºActionå’ŒTransformï¼Œåé¢ä¼šä»‹ç» â€‹ textFile(hdfs://node1.itcast.cn:9000/words.txt)æ˜¯hdfsä¸­è¯»å–æ•°æ® â€‹ flatMap(_.split(â€œ â€œ))å…ˆmapåœ¨å‹å¹³ â€‹ map((_,1))å°†å•è¯å’Œ1æ„æˆå…ƒç»„ â€‹ reduceByKey(_+_)æŒ‰ç…§keyè¿›è¡Œreduceï¼Œå¹¶å°†valueç´¯åŠ  â€‹ saveAsTextFile(â€œhdfs://node1.itcast.cn:9000/outâ€)å°†ç»“æœå†™å…¥åˆ°hdfsä¸­ åˆ¶ä½œjob jaråŒ…ç¤ºä¾‹spark shellä»…åœ¨æµ‹è¯•å’ŒéªŒè¯æˆ‘ä»¬çš„ç¨‹åºæ—¶ä½¿ç”¨çš„è¾ƒå¤šï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¼šåœ¨IDEä¸­ç¼–åˆ¶ç¨‹åºï¼Œç„¶åæ‰“æˆjaråŒ…ï¼Œç„¶åæäº¤åˆ°é›†ç¾¤ï¼Œä¸‹é¢ä»¥mavené¡¹ç›®ä¸ºä¾‹ â€‹ é…ç½®pom.xmlæ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.itcast.spark&lt;/groupId&gt; &lt;artifactId&gt;spark-mvn&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;scala.version&gt;2.10.6&lt;/scala.version&gt; &lt;scala.compat.version&gt;2.10&lt;/scala.compat.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.scala-lang&lt;/groupId&gt; &lt;artifactId&gt;scala-library&lt;/artifactId&gt; &lt;version&gt;$&#123;scala.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.spark&lt;/groupId&gt; &lt;artifactId&gt;spark-core_2.10&lt;/artifactId&gt; &lt;version&gt;1.5.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.spark&lt;/groupId&gt; &lt;artifactId&gt;spark-streaming_2.10&lt;/artifactId&gt; &lt;version&gt;1.5.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt; &lt;version&gt;2.6.2&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;sourceDirectory&gt;src/main/scala&lt;/sourceDirectory&gt; &lt;testSourceDirectory&gt;src/test/scala&lt;/testSourceDirectory&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt; &lt;artifactId&gt;scala-maven-plugin&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;compile&lt;/goal&gt; &lt;goal&gt;testCompile&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;args&gt; &lt;arg&gt;-make:transitive&lt;/arg&gt; &lt;arg&gt;-dependencyfile&lt;/arg&gt; &lt;arg&gt;$&#123;project.build.directory&#125;/.scala_dependencies&lt;/arg&gt; &lt;/args&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;version&gt;2.18.1&lt;/version&gt; &lt;configuration&gt; &lt;useFile&gt;false&lt;/useFile&gt; &lt;disableXmlReport&gt;true&lt;/disableXmlReport&gt; &lt;includes&gt; &lt;include&gt;**/*Test.*&lt;/include&gt; &lt;include&gt;**/*Suite.*&lt;/include&gt; &lt;/includes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt; &lt;version&gt;2.3&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;shade&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;filters&gt; &lt;filter&gt; &lt;artifact&gt;*:*&lt;/artifact&gt; &lt;excludes&gt; &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt; &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt; &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt; &lt;/excludes&gt; &lt;/filter&gt; &lt;/filters&gt; &lt;transformers&gt; &lt;transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"&gt; &lt;mainClass&gt;cn.itcast.spark.WordCount&lt;/mainClass&gt; &lt;/transformer&gt; &lt;/transformers&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; ç¼–å†™ spark ç¨‹åº 12345678910111213141516package cn.itcast.sparkimport org.apache.spark.&#123;SparkContext, SparkConf&#125;object WordCount &#123; def main(args: Array[String]) &#123; //åˆ›å»ºSparkConf()å¹¶è®¾ç½®Appåç§° val conf = new SparkConf().setAppName("WC") //åˆ›å»ºSparkContextï¼Œè¯¥å¯¹è±¡æ˜¯æäº¤spark Appçš„å…¥å£ val sc = new SparkContext(conf) //ä½¿ç”¨scåˆ›å»ºRDDå¹¶æ‰§è¡Œç›¸åº”çš„transformationå’Œaction sc.textFile(args(0)).flatMap(_.split(" ")).map((_, 1)).reduceByKey(_+_, 1).sortBy(_._2, false).saveAsTextFile(args(1)) //åœæ­¢scï¼Œç»“æŸè¯¥ä»»åŠ¡ sc.stop() &#125;&#125; æ‰“åŒ…mavené¡¹ç›® ä¿®æ”¹pom.xml ä¸­çš„main class æ‰“åŒ… ç‚¹å‡»ideaå³ä¾§çš„Maven Projecté€‰é¡¹ å‡»Lifecycle,é€‰æ‹©cleanå’Œpackageï¼Œç„¶åç‚¹å‡»Run Maven Build ç¼–è¯‘æˆåŠŸåçš„jaråŒ…ï¼Œæ”¾åˆ°sparké›†ç¾¤ä¸­ ä½¿ç”¨spark-submitå‘½ä»¤æäº¤Sparkåº”ç”¨ 12345678/usr/local/spark-1.5.2-bin-hadoop2.6/bin/spark-submit \--class cn.itcast.spark.WordCount \--master spark://node1.itcast.cn:7077 \--executor-memory 2G \--total-executor-cores 4 \/root/spark-mvn-1.0-SNAPSHOT.jar \hdfs://node1.itcast.cn:9000/words.txt \hdfs://node1.itcast.cn:9000/out æŸ¥çœ‹æ‰§è¡Œç»“æœ 12345hdfs dfs -cat hdfs://node1.itcast.cn:9000/out/part-00000#(hello,6)#(tom,3)#(kitty,2)#(jerry,1)]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Spark</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spark RDD]]></title>
    <url>%2F2020%2F03%2F31%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FSpark%2F2.Spark%20RDD%2F</url>
    <content type="text"><![CDATA[RDD ä»‹ç»ä»€ä¹ˆæ˜¯RDDRDDï¼ˆResilient Distributed Datasetï¼‰å«åšå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ˜¯Sparkä¸­æœ€åŸºæœ¬çš„æ•°æ®æŠ½è±¡ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªä¸å¯å˜ã€å¯åˆ†åŒºã€é‡Œé¢çš„å…ƒç´ å¯å¹¶è¡Œè®¡ç®—çš„é›†åˆã€‚RDDå…·æœ‰æ•°æ®æµæ¨¡å‹çš„ç‰¹ç‚¹ï¼šè‡ªåŠ¨å®¹é”™ã€ä½ç½®æ„ŸçŸ¥æ€§è°ƒåº¦å’Œå¯ä¼¸ç¼©æ€§ã€‚RDDå…è®¸ç”¨æˆ·åœ¨æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢æ—¶æ˜¾å¼åœ°å°†å·¥ä½œé›†ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œåç»­çš„æŸ¥è¯¢èƒ½å¤Ÿé‡ç”¨å·¥ä½œé›†ï¼Œè¿™æå¤§åœ°æå‡äº†æŸ¥è¯¢é€Ÿåº¦ã€‚ RDDçš„å±æ€§1ï¼‰ä¸€ç»„åˆ†ç‰‡ï¼ˆPartitionï¼‰ï¼Œå³æ•°æ®é›†çš„åŸºæœ¬ç»„æˆå•ä½ã€‚å¯¹äºRDDæ¥è¯´ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½ä¼šè¢«ä¸€ä¸ªè®¡ç®—ä»»åŠ¡å¤„ç†ï¼Œå¹¶å†³å®šå¹¶è¡Œè®¡ç®—çš„ç²’åº¦ã€‚ç”¨æˆ·å¯ä»¥åœ¨åˆ›å»ºRDDæ—¶æŒ‡å®šRDDçš„åˆ†ç‰‡ä¸ªæ•°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé‚£ä¹ˆå°±ä¼šé‡‡ç”¨é»˜è®¤å€¼ã€‚é»˜è®¤å€¼å°±æ˜¯ç¨‹åºæ‰€åˆ†é…åˆ°çš„CPU Coreçš„æ•°ç›®ã€‚ 2ï¼‰ä¸€ä¸ªè®¡ç®—æ¯ä¸ªåˆ†åŒºçš„å‡½æ•°ã€‚Sparkä¸­RDDçš„è®¡ç®—æ˜¯ä»¥åˆ†ç‰‡ä¸ºå•ä½çš„ï¼Œæ¯ä¸ªRDDéƒ½ä¼šå®ç°computeå‡½æ•°ä»¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚computeå‡½æ•°ä¼šå¯¹è¿­ä»£å™¨è¿›è¡Œå¤åˆï¼Œä¸éœ€è¦ä¿å­˜æ¯æ¬¡è®¡ç®—çš„ç»“æœã€‚ 3ï¼‰RDDä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚RDDçš„æ¯æ¬¡è½¬æ¢éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„RDDï¼Œæ‰€ä»¥RDDä¹‹é—´å°±ä¼šå½¢æˆç±»ä¼¼äºæµæ°´çº¿ä¸€æ ·çš„å‰åä¾èµ–å…³ç³»ã€‚åœ¨éƒ¨åˆ†åˆ†åŒºæ•°æ®ä¸¢å¤±æ—¶ï¼ŒSparkå¯ä»¥é€šè¿‡è¿™ä¸ªä¾èµ–å…³ç³»é‡æ–°è®¡ç®—ä¸¢å¤±çš„åˆ†åŒºæ•°æ®ï¼Œè€Œä¸æ˜¯å¯¹RDDçš„æ‰€æœ‰åˆ†åŒºè¿›è¡Œé‡æ–°è®¡ç®—ã€‚ 4ï¼‰ä¸€ä¸ªPartitionerï¼Œå³RDDçš„åˆ†ç‰‡å‡½æ•°ã€‚å½“å‰Sparkä¸­å®ç°äº†ä¸¤ç§ç±»å‹çš„åˆ†ç‰‡å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯åŸºäºå“ˆå¸Œçš„HashPartitionerï¼Œå¦å¤–ä¸€ä¸ªæ˜¯åŸºäºèŒƒå›´çš„RangePartitionerã€‚åªæœ‰å¯¹äºäºkey-valueçš„RDDï¼Œæ‰ä¼šæœ‰Partitionerï¼Œékey-valueçš„RDDçš„Parititionerçš„å€¼æ˜¯Noneã€‚Partitionerå‡½æ•°ä¸ä½†å†³å®šäº†RDDæœ¬èº«çš„åˆ†ç‰‡æ•°é‡ï¼Œä¹Ÿå†³å®šäº†parent RDD Shuffleè¾“å‡ºæ—¶çš„åˆ†ç‰‡æ•°é‡ã€‚ 5ï¼‰ä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜å‚¨å­˜å–æ¯ä¸ªPartitionçš„ä¼˜å…ˆä½ç½®ï¼ˆpreferred locationï¼‰ã€‚å¯¹äºä¸€ä¸ªHDFSæ–‡ä»¶æ¥è¯´ï¼Œè¿™ä¸ªåˆ—è¡¨ä¿å­˜çš„å°±æ˜¯æ¯ä¸ªPartitionæ‰€åœ¨çš„å—çš„ä½ç½®ã€‚æŒ‰ç…§â€œç§»åŠ¨æ•°æ®ä¸å¦‚ç§»åŠ¨è®¡ç®—â€çš„ç†å¿µï¼ŒSparkåœ¨è¿›è¡Œä»»åŠ¡è°ƒåº¦çš„æ—¶å€™ï¼Œä¼šå°½å¯èƒ½åœ°å°†è®¡ç®—ä»»åŠ¡åˆ†é…åˆ°å…¶æ‰€è¦å¤„ç†æ•°æ®å—çš„å­˜å‚¨ä½ç½®ã€‚ åˆ›å»ºRDDçš„æ–¹å¼1ï¼‰ç”±ä¸€ä¸ªå·²ç»å­˜åœ¨çš„Scalaé›†åˆåˆ›å»ºã€‚ val rdd1 = sc.parallelize(Array(1,2,3,4,5,6,7,8)) 2ï¼‰ç”±å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿçš„æ•°æ®é›†åˆ›å»ºï¼ŒåŒ…æ‹¬æœ¬åœ°çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿˜æœ‰æ‰€æœ‰Hadoopæ”¯æŒçš„æ•°æ®é›†ï¼Œæ¯”å¦‚HDFSã€Cassandraã€HBaseç­‰ val rdd2 = sc.textFile(â€œhdfs://node1.itcast.cn:9000/words.txtâ€) RDD ç¼–ç¨‹ APIRDDä¸­çš„æ‰€æœ‰è½¬æ¢ï¼ˆTransformï¼‰éƒ½æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬å¹¶ä¸ä¼šç›´æ¥è®¡ç®—ç»“æœã€‚ç›¸åçš„ï¼Œå®ƒä»¬åªæ˜¯è®°ä½è¿™äº›åº”ç”¨åˆ°åŸºç¡€æ•°æ®é›†ï¼ˆä¾‹å¦‚ä¸€ä¸ªæ–‡ä»¶ï¼‰ä¸Šçš„è½¬æ¢åŠ¨ä½œã€‚åªæœ‰å½“å‘ç”Ÿä¸€ä¸ªè¦æ±‚è¿”å›ç»“æœçš„è®¡ç®—(Action)ç»™Driverçš„åŠ¨ä½œæ—¶ï¼Œè¿™äº›è½¬æ¢æ‰ä¼šçœŸæ­£è¿è¡Œã€‚è¿™ç§è®¾è®¡è®©Sparkæ›´åŠ æœ‰æ•ˆç‡åœ°è¿è¡Œã€‚ Transformationå¸¸ç”¨transformation è½¬æ¢ å«ä¹‰ ä½¿ç”¨ map(func) è¿”å›ä¸€ä¸ªæ–°çš„RDDï¼Œè¯¥RDDç”±æ¯ä¸€ä¸ªè¾“å…¥å…ƒç´ ç»è¿‡funcå‡½æ•°è½¬æ¢åç»„æˆ sc.parallelize(List(5,6,4,7,3,8,2,9,1,10)).map(_*2) filter(func) è¿”å›ä¸€ä¸ªæ–°çš„RDDï¼Œè¯¥RDDç”±ç»è¿‡funcå‡½æ•°è®¡ç®—åè¿”å›å€¼ä¸ºtrueçš„è¾“å…¥å…ƒç´ ç»„æˆ rdd2.filter(_&gt;10) flatMap(func) è¿”å›ä¸€ä¸ªæ–°çš„RDDï¼ŒRDDä¸­å…ƒç´ ç»è¿‡funcå‡½æ•°è®¡ç®—åï¼Œå¹¶å°†æ‰€è¿”å›çš„å†…å®¹æ‰“æ•£å¹³é“º sc.textFile(â€œ/root/words.txtâ€).flatMap(x=&gt;x.split(â€œ â€œ)) mapPartitions(func) ç±»ä¼¼äºmapï¼Œä½†ç‹¬ç«‹åœ°åœ¨RDDçš„æ¯ä¸€ä¸ªåˆ†ç‰‡ä¸Šè¿è¡Œï¼Œå› æ­¤åœ¨ç±»å‹ä¸ºTçš„RDDä¸Šè¿è¡Œæ—¶ï¼Œfuncçš„å‡½æ•°ç±»å‹å¿…é¡»æ˜¯Iterator[T] =&gt; Iterator[U] val rdd4 = rdd3.partitionBy(hostParitioner).mapPartitions(it =&gt; { it.toList.sortBy(_._2._2).reverse.take(2).iterator }) rdd4.saveAsTextFile(â€œc://out4â€) mapPartitions(func) ç±»ä¼¼äºmapï¼Œä½†ç‹¬ç«‹åœ°åœ¨RDDçš„æ¯ä¸€ä¸ªåˆ†ç‰‡ä¸Šè¿è¡Œï¼Œå› æ­¤åœ¨ç±»å‹ä¸ºTçš„RDDä¸Šè¿è¡Œæ—¶ï¼Œfuncçš„å‡½æ•°ç±»å‹å¿…é¡»æ˜¯Iterator[T] =&gt; Iterator[U] val rdd4 = rdd3.partitionBy(hostParitioner).mapPartitions(it =&gt; { it.toList.sortBy(_._2._2).reverse.take(2).iterator }) rdd4.saveAsTextFile(â€œc://out4â€) mapPartitionsWithIndex(func) ç±»ä¼¼äºmapPartitionsï¼Œä½†funcå¸¦æœ‰ä¸€ä¸ªæ•´æ•°å‚æ•°è¡¨ç¤ºåˆ†ç‰‡çš„ç´¢å¼•å€¼ï¼Œå› æ­¤åœ¨ç±»å‹ä¸ºTçš„RDDä¸Šè¿è¡Œæ—¶ï¼Œfuncçš„å‡½æ•°ç±»å‹å¿…é¡»æ˜¯(Int, Interator[T]) =&gt; Iterator[U] val func = (index: Int, iter: Iterator[(Int)]) =&gt; { iter.toList.map(x =&gt; â€œ[partID:â€ + index + â€œ, val: â€œ + x + â€œ]â€).iterator};val rdd1 = sc.parallelize(List(1,2,3,4,5,6,7,8,9), 2)rdd1.mapPartitionsWithIndex(func).collect sample(withReplacement, fraction, seed) æ ¹æ®fractionæŒ‡å®šçš„æ¯”ä¾‹å¯¹æ•°æ®è¿›è¡Œé‡‡æ ·ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦ä½¿ç”¨éšæœºæ•°è¿›è¡Œæ›¿æ¢ï¼Œseedç”¨äºæŒ‡å®šéšæœºæ•°ç”Ÿæˆå™¨ç§å­ union(otherDataset) å¯¹æºRDDå’Œå‚æ•°RDDæ±‚å¹¶é›†åè¿”å›ä¸€ä¸ªæ–°çš„RDDï¼Œè¦æ±‚åˆ—æ•°è¦ä¸€æ ·ï¼Œç±»å‹å¯ä»¥ä¸åŒ intersection(otherDataset) å¯¹æºRDDå’Œå‚æ•°RDDæ±‚äº¤é›†åè¿”å›ä¸€ä¸ªæ–°çš„RDD val rdd9 = rdd6.intersection(rdd7) distinct([numTasks])) å¯¹æºRDDè¿›è¡Œå»é‡åè¿”å›ä¸€ä¸ªæ–°çš„RDD val rdd6 = sc.parallelize(List(5,6,4,7))val rdd7 = sc.parallelize(List(1,2,3,4)); val rdd8 = rdd6.union(rdd7)ï¼› rdd8.distinct.sortBy(x=&gt;x).collect groupByKey([numTasks]) åœ¨ä¸€ä¸ª(K,V)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ª(K, Iterator[V])çš„RDD val rdd1 = sc.parallelize(List((â€œtomâ€, 1), (â€œjerryâ€, 2), (â€œkittyâ€, 3))) ;val rdd2 = sc.parallelize(List((â€œjerryâ€, 9), (â€œtomâ€, 8), (â€œshukeâ€, 7))); val rdd3 = rdd1 union rdd2; rdd3.groupByKey.map(x=&gt;(x._1,x._2.sum)) reduceByKey(func, [numTasks]) åœ¨ä¸€ä¸ª(K,V)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ª(K,V)çš„RDDï¼Œä½¿ç”¨æŒ‡å®šçš„reduceå‡½æ•°ï¼Œå°†ç›¸åŒkeyçš„å€¼èšåˆåˆ°ä¸€èµ·ï¼Œä¸groupByKeyç±»ä¼¼ï¼Œreduceä»»åŠ¡çš„ä¸ªæ•°å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå¯é€‰çš„å‚æ•°æ¥è®¾ç½® sc.textFile(â€œ/root/words.txtâ€).flatMap(x=&gt;x.split(â€œ â€œ)).map((_,1)).reduceByKey(_+_).sortBy(_._2,false).collect aggregateByKey(zeroValue)(seqOp, combOp, [numTasks]) aggregateæ¥æ”¶ä¸¤ä¸ªå‡½æ•°ï¼Œå’Œä¸€ä¸ªåˆå§‹åŒ–å€¼ã€‚seqOpå‡½æ•°ç”¨äºèšé›†æ¯ä¸€ä¸ªåˆ†åŒºï¼ŒcombOpç”¨äºèšé›†æ‰€æœ‰åˆ†åŒºèšé›†åçš„ç»“æœã€‚æ¯ä¸€ä¸ªåˆ†åŒºçš„èšé›†ï¼Œå’Œæœ€åæ‰€æœ‰åˆ†åŒºçš„èšé›†éƒ½éœ€è¦åˆå§‹åŒ–å€¼çš„å‚ä¸ã€‚ val rdd1 = sc.parallelize(List(1,2,3,4,5,6,7,8,9), 2); rdd1.aggregate(0)(math.max(_,_), _ + _) sortByKey([ascending], [numTasks]) åœ¨ä¸€ä¸ª(K,V)çš„RDDä¸Šè°ƒç”¨ï¼ŒKå¿…é¡»å®ç°Orderedæ¥å£ï¼Œè¿”å›ä¸€ä¸ªæŒ‰ç…§keyè¿›è¡Œæ’åºçš„(K,V)çš„RDD sortBy(func,[ascending], [numTasks]) ä¸sortByKeyç±»ä¼¼ï¼Œä½†æ˜¯æ›´çµæ´» rdd8.distinct.sortBy(x=&gt;x).collect sortBy(func,[ascending], [numTasks]) ä¸sortByKeyç±»ä¼¼ï¼Œä½†æ˜¯æ›´çµæ´» rdd8.distinct.sortBy(x=&gt;x).collect join(otherDataset, [numTasks]) åœ¨ç±»å‹ä¸º(K,V)å’Œ(K,W)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªç›¸åŒkeyå¯¹åº”çš„æ‰€æœ‰å…ƒç´ å¯¹åœ¨ä¸€èµ·çš„(K,(V,W))çš„RDD val rdd1 = sc.parallelize(List((â€œtomâ€, 1), (â€œjerryâ€, 2), (â€œkittyâ€, 3))); val rdd2 = sc.parallelize(List((â€œjerryâ€, 9), (â€œtomâ€, 8), (â€œshukeâ€, 7))); val rdd3 = rdd1.join(rdd2) cogroup(otherDataset, [numTasks]) åœ¨ç±»å‹ä¸º(K,V)å’Œ(K,W)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ª(K,(Iterable&lt;V&gt;,Iterable&lt;W&gt;))ç±»å‹çš„RDD val rdd1 = sc.parallelize(List((â€œtomâ€, 1), (â€œtomâ€, 2), (â€œjerryâ€, 3), (â€œkittyâ€, 2))); val rdd2 = sc.parallelize(List((â€œjerryâ€, 2), (â€œtomâ€, 1), (â€œshukeâ€, 2))); val rdd3 = rdd1.cogroup(rdd2) cartesian(otherDataset) ç¬›å¡å°”ç§¯ val rdd1 = sc.parallelize(List(â€œtomâ€, â€œjerryâ€)); val rdd2 = sc.parallelize(List(â€œtomâ€, â€œkittyâ€, â€œshukeâ€)); val rdd3 = rdd1.cartesian(rdd2) pipe(command, [envVars]) è°ƒç”¨å¤–éƒ¨å‘½ä»¤ coalesce(numPartitions) é‡æ–°åˆ†åŒº repartition(numPartitions) é‡æ–°åˆ†åŒº ### Action å¸¸ç”¨çš„Action åŠ¨ä½œ å«ä¹‰ reduce(func) é€šè¿‡funcå‡½æ•°èšé›†RDDä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œè¿™ä¸ªåŠŸèƒ½å¿…é¡»æ˜¯å¯äº¤æ¢ä¸”å¯å¹¶è”çš„ collect() åœ¨é©±åŠ¨ç¨‹åºä¸­ï¼Œä»¥æ•°ç»„çš„å½¢å¼è¿”å›æ•°æ®é›†çš„æ‰€æœ‰å…ƒç´  count() è¿”å›RDDçš„å…ƒç´ ä¸ªæ•° first() è¿”å›RDDçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆç±»ä¼¼äºtake(1)ï¼‰ take(n) è¿”å›ä¸€ä¸ªç”±æ•°æ®é›†çš„å‰nä¸ªå…ƒç´ ç»„æˆçš„æ•°ç»„ takeSample(withReplacement,num, [seed]) è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„ç”±ä»æ•°æ®é›†ä¸­éšæœºé‡‡æ ·çš„numä¸ªå…ƒç´ ç»„æˆï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦ç”¨éšæœºæ•°æ›¿æ¢ä¸è¶³çš„éƒ¨åˆ†ï¼Œseedç”¨äºæŒ‡å®šéšæœºæ•°ç”Ÿæˆå™¨ç§å­ takeOrdered(n, [ordering]) saveAsTextFile(path) å°†æ•°æ®é›†çš„å…ƒç´ ä»¥textfileçš„å½¢å¼ä¿å­˜åˆ°HDFSæ–‡ä»¶ç³»ç»Ÿæˆ–è€…å…¶ä»–æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ ï¼ŒSparkå°†ä¼šè°ƒç”¨toStringæ–¹æ³•ï¼Œå°†å®ƒè£…æ¢ä¸ºæ–‡ä»¶ä¸­çš„æ–‡æœ¬ saveAsSequenceFile(path) å°†æ•°æ®é›†ä¸­çš„å…ƒç´ ä»¥Hadoop sequencefileçš„æ ¼å¼ä¿å­˜åˆ°æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œå¯ä»¥ä½¿HDFSæˆ–è€…å…¶ä»–Hadoopæ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚ saveAsObjectFile(path) countByKey() é’ˆå¯¹(K,V)ç±»å‹çš„RDDï¼Œè¿”å›ä¸€ä¸ª(K,Int)çš„mapï¼Œè¡¨ç¤ºæ¯ä¸€ä¸ªkeyå¯¹åº”çš„å…ƒç´ ä¸ªæ•°ã€‚ foreach(func) åœ¨æ•°æ®é›†çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œè¿è¡Œå‡½æ•°funcè¿›è¡Œæ›´æ–°ã€‚ WordCount ä¸­çš„RDD åœºæ™¯è®­ç»ƒç»ƒä¹ 1ï¼šæ‰¹é‡æ“ä½œåè¿‡æ»¤ val rdd1 = sc.parallelize(List(5, 6, 4, 7, 3, 8, 2, 9, 1, 10)) //å¯¹rdd1é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ ä¹˜2ç„¶åæ’åº val rdd2 = rdd1.map(_ * 2).sortBy(x =&gt; x, true) //è¿‡æ»¤å‡ºå¤§äºç­‰äºåçš„å…ƒç´  val rdd3 = rdd2.filter(_ &gt;= 10) //å°†å…ƒç´ ä»¥æ•°ç»„çš„æ–¹å¼åœ¨å®¢æˆ·ç«¯æ˜¾ç¤º rdd3.collect ç»ƒä¹ 2ï¼šæ•°æ®æ‰“å¹³ val rdd1 = sc.parallelize(Array(â€œa b câ€, â€œd e fâ€, â€œh i jâ€)) //å°†rdd1é‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ å…ˆåˆ‡åˆ†åœ¨å‹å¹³ val rdd2 = rdd1.flatMap(_.split(â€˜ â€˜)) rdd2.collect ç»ƒä¹ 3ï¼šæ±‚ä¸¤ä¸ªRDDçš„äº¤é›†æˆ–å¹¶é›† val rdd1 = sc.parallelize(List(5, 6, 4, 3)) val rdd2 = sc.parallelize(List(1, 2, 3, 4)) //æ±‚å¹¶é›† val rdd3 = rdd1.union(rdd2) //æ±‚äº¤é›† val rdd4 = rdd1.intersection(rdd2) //å»é‡ rdd3.distinct.collect rdd4.collect ç»ƒä¹ 4ï¼šæ•°æ®åˆå¹¶åˆ†ç»„ val rdd1 = sc.parallelize(List((â€œtomâ€, 1), (â€œjerryâ€, 3), (â€œkittyâ€, 2))) val rdd2 = sc.parallelize(List((â€œjerryâ€, 2), (â€œtomâ€, 1), (â€œshukeâ€, 2))) //æ±‚jion val rdd3 = rdd1.join(rdd2) rdd3.collect //æ±‚å¹¶é›† val rdd4 = rdd1 union rdd2 //æŒ‰keyè¿›è¡Œåˆ†ç»„ rdd4.groupByKey rdd4.collect ç»ƒä¹ 5ï¼šæ•°æ®åˆå¹¶åˆ†ç»„ val rdd1 = sc.parallelize(List((â€œtomâ€, 1), (â€œtomâ€, 2), (â€œjerryâ€, 3), (â€œkittyâ€, 2))) val rdd2 = sc.parallelize(List((â€œjerryâ€, 2), (â€œtomâ€, 1), (â€œshukeâ€, 2))) //cogroup val rdd3 = rdd1.cogroup(rdd2) //æ³¨æ„cogroupä¸groupByKeyçš„åŒºåˆ« rdd3.collect ç»ƒä¹ 6ï¼šæ•°æ®èšåˆ val rdd1 = sc.parallelize(List(1, 2, 3, 4, 5)) //reduceèšåˆ val rdd2 = rdd1.reduce(_ + _) rdd2.collect ç»ƒä¹ 7ï¼šæ•°æ®åˆå¹¶èšåˆå¹¶æ’åº val rdd1 = sc.parallelize(List((â€œtomâ€, 1), (â€œjerryâ€, 3), (â€œkittyâ€, 2), (â€œshukeâ€, 1))) val rdd2 = sc.parallelize(List((â€œjerryâ€, 2), (â€œtomâ€, 3), (â€œshukeâ€, 2), (â€œkittyâ€, 5))) val rdd3 = rdd1.union(rdd2) //æŒ‰keyè¿›è¡Œèšåˆ val rdd4 = rdd3.reduceByKey(_ + _) rdd4.collect //æŒ‰valueçš„é™åºæ’åº val rdd5 = rdd4.map(t =&gt; (t._2, t._1)).sortByKey(false).map(t =&gt; (t._2, t._1)) rdd5.collect æƒ³è¦äº†è§£æ›´å¤šï¼Œè®¿é—®ä¸‹é¢çš„åœ°å€ http://homepage.cs.latrobe.edu.au/zhe/ZhenHeSparkRDDAPIExamples.html RDD çš„ä¾èµ–å…³ç³»RDDå’Œå®ƒä¾èµ–çš„çˆ¶RDDï¼ˆsï¼‰çš„å…³ç³»æœ‰ä¸¤ç§ä¸åŒçš„ç±»å‹ï¼Œå³çª„ä¾èµ–ï¼ˆnarrow dependencyï¼‰å’Œå®½ä¾èµ–ï¼ˆwide dependencyï¼‰ã€‚ çª„ä¾èµ–çª„ä¾èµ–æŒ‡çš„æ˜¯æ¯ä¸€ä¸ªçˆ¶RDDçš„Partitionæœ€å¤šè¢«å­RDDçš„ä¸€ä¸ªPartitionä½¿ç”¨ æ€»ç»“ï¼šçª„ä¾èµ–æˆ‘ä»¬å½¢è±¡çš„æ¯”å–»ä¸ºç‹¬ç”Ÿå­å¥³ å®½ä¾èµ–å®½ä¾èµ–æŒ‡çš„æ˜¯å¤šä¸ªå­RDDçš„Partitionä¼šä¾èµ–åŒä¸€ä¸ªçˆ¶RDDçš„Partition æ€»ç»“ï¼šçª„ä¾èµ–æˆ‘ä»¬å½¢è±¡çš„æ¯”å–»ä¸ºè¶…ç”Ÿ RDDçš„è¡€ç»ŸRDDåªæ”¯æŒç²—ç²’åº¦è½¬æ¢ï¼Œå³åœ¨å¤§é‡è®°å½•ä¸Šæ‰§è¡Œçš„å•ä¸ªæ“ä½œã€‚å°†åˆ›å»ºRDDçš„ä¸€ç³»åˆ—Lineageï¼ˆå³è¡€ç»Ÿï¼‰è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿æ¢å¤ä¸¢å¤±çš„åˆ†åŒºã€‚RDDçš„Lineageä¼šè®°å½•RDDçš„å…ƒæ•°æ®ä¿¡æ¯å’Œè½¬æ¢è¡Œä¸ºï¼Œå½“è¯¥RDDçš„éƒ¨åˆ†åˆ†åŒºæ•°æ®ä¸¢å¤±æ—¶ï¼Œå®ƒå¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯æ¥é‡æ–°è¿ç®—å’Œæ¢å¤ä¸¢å¤±çš„æ•°æ®åˆ†åŒº RDD çš„ç¼“å­˜RDDç¼“å­˜çš„ä½œç”¨Sparké€Ÿåº¦éå¸¸å¿«çš„åŸå› ä¹‹ä¸€ï¼Œå°±æ˜¯åœ¨ä¸åŒæ“ä½œä¸­å¯ä»¥åœ¨å†…å­˜ä¸­æŒä¹…åŒ–æˆ–ç¼“å­˜ä¸ªæ•°æ®é›†ã€‚å½“æŒä¹…åŒ–æŸä¸ªRDDåï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å°†æŠŠè®¡ç®—çš„åˆ†ç‰‡ç»“æœä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å¯¹æ­¤RDDæˆ–è¡ç”Ÿå‡ºçš„RDDè¿›è¡Œçš„å…¶ä»–åŠ¨ä½œä¸­é‡ç”¨ã€‚è¿™ä½¿å¾—åç»­çš„åŠ¨ä½œå˜å¾—æ›´åŠ è¿…é€Ÿã€‚RDDç›¸å…³çš„æŒä¹…åŒ–å’Œç¼“å­˜ï¼Œæ˜¯Sparkæœ€é‡è¦çš„ç‰¹å¾ä¹‹ä¸€ã€‚å¯ä»¥è¯´ï¼Œç¼“å­˜æ˜¯Sparkæ„å»ºè¿­ä»£å¼ç®—æ³•å’Œå¿«é€Ÿäº¤äº’å¼æŸ¥è¯¢çš„å…³é”®ã€‚ RDD ç¼“å­˜çš„æ–¹å¼RDDé€šè¿‡persistæ–¹æ³•æˆ–cacheæ–¹æ³•å¯ä»¥å°†å‰é¢çš„è®¡ç®—ç»“æœç¼“å­˜ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯è¿™ä¸¤ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ç«‹å³ç¼“å­˜ï¼Œè€Œæ˜¯è§¦å‘åé¢çš„actionæ—¶ï¼Œè¯¥RDDå°†ä¼šè¢«ç¼“å­˜åœ¨è®¡ç®—èŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œå¹¶ä¾›åé¢é‡ç”¨ã€‚ ç¼“å­˜æœ‰å¯èƒ½ä¸¢å¤±ï¼Œæˆ–è€…å­˜å‚¨å­˜å‚¨äºå†…å­˜çš„æ•°æ®ç”±äºå†…å­˜ä¸è¶³è€Œè¢«åˆ é™¤ï¼ŒRDDçš„ç¼“å­˜å®¹é”™æœºåˆ¶ä¿è¯äº†å³ä½¿ç¼“å­˜ä¸¢å¤±ä¹Ÿèƒ½ä¿è¯è®¡ç®—çš„æ­£ç¡®æ‰§è¡Œã€‚é€šè¿‡åŸºäºRDDçš„ä¸€ç³»åˆ—è½¬æ¢ï¼Œä¸¢å¤±çš„æ•°æ®ä¼šè¢«é‡ç®—ï¼Œç”±äºRDDçš„å„ä¸ªPartitionæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼Œå› æ­¤åªéœ€è¦è®¡ç®—ä¸¢å¤±çš„éƒ¨åˆ†å³å¯ï¼Œå¹¶ä¸éœ€è¦é‡ç®—å…¨éƒ¨Partitionã€‚ DAGçš„ç”ŸæˆDAG(Directed Acyclic Graph)å«åšæœ‰å‘æ— ç¯å›¾ï¼ŒåŸå§‹çš„RDDé€šè¿‡ä¸€ç³»åˆ—çš„è½¬æ¢å°±å°±å½¢æˆäº†DAGï¼Œæ ¹æ®RDDä¹‹é—´çš„ä¾èµ–å…³ç³»çš„ä¸åŒå°†DAGåˆ’åˆ†æˆä¸åŒçš„Stageï¼Œå¯¹äºçª„ä¾èµ–ï¼Œpartitionçš„è½¬æ¢å¤„ç†åœ¨Stageä¸­å®Œæˆè®¡ç®—ã€‚å¯¹äºå®½ä¾èµ–ï¼Œç”±äºæœ‰Shuffleçš„å­˜åœ¨ï¼Œåªèƒ½åœ¨parent RDDå¤„ç†å®Œæˆåï¼Œæ‰èƒ½å¼€å§‹æ¥ä¸‹æ¥çš„è®¡ç®—ï¼Œå› æ­¤å®½ä¾èµ–æ˜¯åˆ’åˆ†Stageçš„ä¾æ®ã€‚ Spark ä¸­çš„checkpointcheckpointåœ¨sparkä¸­ä¸»è¦æœ‰ä¸¤å—åº”ç”¨ï¼šä¸€å—æ˜¯åœ¨spark coreä¸­å¯¹RDDåšcheckpointï¼Œå¯ä»¥åˆ‡æ–­åšcheckpoint RDDçš„ä¾èµ–å…³ç³»ï¼Œå°†RDDæ•°æ®ä¿å­˜åˆ°å¯é å­˜å‚¨ï¼ˆå¦‚HDFSï¼‰ä»¥ä¾¿æ•°æ®æ¢å¤ï¼›å¦å¤–ä¸€å—æ˜¯åº”ç”¨åœ¨spark streamingä¸­ï¼Œä½¿ç”¨checkpointç”¨æ¥ä¿å­˜DStreamGraphä»¥åŠç›¸å…³é…ç½®ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨Driverå´©æºƒé‡å¯çš„æ—¶å€™èƒ½å¤Ÿæ¥ç€ä¹‹å‰è¿›åº¦ç»§ç»­è¿›è¡Œå¤„ç†ï¼ˆå¦‚ä¹‹å‰waiting batchçš„jobä¼šåœ¨é‡å¯åç»§ç»­å¤„ç†ï¼‰ã€‚ æœ¬æ–‡ä¸»è¦å°†è¯¦ç»†åˆ†æcheckpointåœ¨ä»¥ä¸Šä¸¤ç§åœºæ™¯çš„è¯»å†™è¿‡ç¨‹ã€‚ checkpointçš„ä½¿ç”¨æ–¹æ³•ä½¿ç”¨checkpointå¯¹RDDåšå¿«ç…§å¤§ä½“å¦‚ä¸‹ï¼š 1234&gt; sc.setCheckpointDir(checkpointDir.toString)&gt; val rdd = sc.makeRDD(1 to 20, numSlices = 1)&gt; rdd.checkpoint()&gt; é¦–å…ˆï¼Œè®¾ç½®checkpointçš„ç›®å½•ï¼ˆä¸€èˆ¬æ˜¯hdfsç›®å½•ï¼‰ï¼Œè¿™ä¸ªç›®å½•ç”¨æ¥å°†RDDç›¸å…³çš„æ•°æ®ï¼ˆåŒ…æ‹¬æ¯ä¸ªpartitionå®é™…æ•°æ®ï¼Œä»¥åŠpartitionerï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼‰ã€‚ç„¶ååœ¨RDDä¸Šè°ƒç”¨checkpointçš„æ–¹æ³•å³å¯ã€‚ checkpointå†™æµç¨‹å¯ä»¥çœ‹åˆ°checkpointä½¿ç”¨éå¸¸ç®€å•ï¼Œè®¾ç½®checkpointç›®å½•ï¼Œç„¶åè°ƒç”¨RDDçš„checkpointæ–¹æ³•ã€‚é’ˆå¯¹checkpointçš„å†™å…¥æµç¨‹ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å››ä¸ªé—®é¢˜ï¼š Q1ï¼šRDDä¸­çš„æ•°æ®æ˜¯ä»€ä¹ˆæ—¶å€™å†™å…¥çš„ï¼Ÿæ˜¯åœ¨rddè°ƒç”¨checkpointæ–¹æ³•æ—¶å€™å—ï¼Ÿ Q2ï¼šåœ¨åšcheckpointçš„æ—¶å€™ï¼Œå…·ä½“å†™å…¥äº†å“ªäº›æ•°æ®åˆ°HDFSäº†ï¼Ÿ Q3ï¼šåœ¨å¯¹RDDåšå®Œcheckpointä»¥åï¼Œå¯¹åšRDDçš„æœ¬çœåˆåšäº†å“ªäº›æ”¶å°¾å·¥ä½œï¼Ÿ Q4ï¼šå®é™…è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨RDDåšcheckpointçš„æ—¶å€™éœ€è¦æ³¨æ„ä»€ä¹ˆé—®é¢˜ï¼Ÿ å¼„æ¸…æ¥šäº†ä»¥ä¸Šå››ä¸ªé—®é¢˜ï¼Œæˆ‘æƒ³å¯¹checkpointçš„å†™è¿‡ç¨‹ä¹Ÿå°±åŸºæœ¬æ¸…æ¥šäº†ã€‚æ¥ä¸‹æ¥å°†ä¸€ä¸€å›ç­”ä¸Šé¢æå‡ºçš„é—®é¢˜ã€‚ A1ï¼šé¦–å…ˆçœ‹ä¸€ä¸‹RDDä¸­checkpointæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¯¥æ–¹æ³•ä¸­æ˜¯åªæ˜¯æ–°å»ºäº†ä¸€ä¸ªReliableRDDCheckpintDataçš„å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰åšå®é™…çš„å†™å…¥å·¥ä½œã€‚å®é™…è§¦å‘å†™å…¥çš„æ—¶æœºæ˜¯åœ¨runJobç”Ÿæˆæ”¹RDDåï¼Œè°ƒç”¨RDDçš„doCheckpointæ–¹æ³•æ¥åšçš„ã€‚ A2ï¼šåœ¨ç»å†è°ƒç”¨RDD.doCheckpoint â†’ RDDCheckpintData.checkpoint â†’ ReliableRDDCheckpintData.doCheckpoint â†’ ReliableRDDCheckpintData.writeRDDToCheckpointDirectoryåï¼Œåœ¨writeRDDToCheckpointDirectoryæ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ï¼šå°†ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡ï¼ˆRunJobï¼‰å°†RDDä¸­æ¯ä¸ªparitionçš„æ•°æ®ä¾æ¬¡å†™å…¥åˆ°checkpointç›®å½•ï¼ˆwritePartitionToCheckpointFileï¼‰ï¼Œæ­¤å¤–å¦‚æœè¯¥RDDä¸­çš„partitionerå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ä¹Ÿä¼šå°†è¯¥å¯¹è±¡åºåˆ—åŒ–åå­˜å‚¨åˆ°checkpointç›®å½•ã€‚æ‰€ä»¥ï¼Œåœ¨åšcheckpointçš„æ—¶å€™ï¼Œå†™å…¥çš„hdfsä¸­çš„æ•°æ®ä¸»è¦åŒ…æ‹¬ï¼šRDDä¸­æ¯ä¸ªparitionçš„å®é™…æ•°æ®ï¼Œä»¥åŠå¯èƒ½çš„partitionerå¯¹è±¡ï¼ˆwritePartitionerToCheckpointDirï¼‰ã€‚ A3ï¼šåœ¨å†™å®Œcheckpointæ•°æ®åˆ°hdfsä»¥åï¼Œå°†ä¼šè°ƒç”¨rddçš„markCheckpoinedæ–¹æ³•ï¼Œä¸»è¦æ–©æ–­è¯¥rddçš„å¯¹ä¸Šæ¸¸çš„ä¾èµ–ï¼Œä»¥åŠå°†paritionsç½®ç©ºç­‰æ“ä½œã€‚ A4ï¼šé€šè¿‡A1ï¼ŒA2å¯ä»¥çŸ¥é“ï¼Œåœ¨RDDè®¡ç®—å®Œæ¯•åï¼Œä¼šå†æ¬¡é€šè¿‡RunJobå°†æ¯ä¸ªpartitionæ•°æ®ä¿å­˜åˆ°HDFSã€‚è¿™æ ·RDDå°†ä¼šè®¡ç®—ä¸¤æ¬¡ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…æ­¤ç±»æƒ…å†µï¼Œæœ€å¥½å°†RDDè¿›è¡Œcacheã€‚å³1.1ä¸­rddçš„æ¨èä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š 12345&gt; sc.setCheckpointDir(checkpointDir.toString)&gt; val rdd = sc.makeRDD(1 to 20, numSlices = 1)&gt; rdd.cache()&gt; rdd.checkpoint()&gt; checkpoint è¯»æµç¨‹åœ¨åšå®Œcheckpointåï¼Œè·å–åŸæ¥RDDçš„ä¾èµ–ä»¥åŠpartitionsæ•°æ®éƒ½å°†ä»CheckpointRDDä¸­è·å–ã€‚ä¹Ÿå°±æ˜¯è¯´è·å–åŸæ¥rddä¸­æ¯ä¸ªpartitionæ•°æ®ä»¥åŠpartitionerç­‰å¯¹è±¡ï¼Œéƒ½å°†è½¬ç§»åˆ°CheckPointRDDä¸­ã€‚ åœ¨CheckPointRDDçš„ä¸€ä¸ªå…·ä½“å®ç°ReliableRDDCheckpintRDDä¸­çš„computeæ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå°†ä¼šä»hdfsçš„checkpointç›®å½•ä¸­æ¢å¤ä¹‹å‰å†™å…¥çš„partitionæ•°æ®ã€‚è€Œpartitionerå¯¹è±¡ï¼ˆå¦‚æœæœ‰ï¼‰ä¹Ÿä¼šä»ä¹‹å‰å†™å…¥hdfsçš„paritionerå¯¹è±¡æ¢å¤ã€‚ æ€»çš„æ¥è¯´ï¼Œcheckpointè¯»å–è¿‡ç¨‹æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Spark</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SparkåŸç†]]></title>
    <url>%2F2020%2F03%2F31%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FSpark%2F5.Spark%20%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[Spark ä»»åŠ¡æäº¤ä»»åŠ¡æäº¤çš„ä¸»è¦å››ä¸ªé˜¶æ®µDAGçš„ç”Ÿæˆ =&gt; stageåˆ‡åˆ† =&gt; taskçš„ç”Ÿæˆ =&gt; ä»»åŠ¡æäº¤ æ„å»ºDAGç”¨æˆ·æäº¤çš„jobå°†é¦–å…ˆè¢«è½¬æ¢æˆä¸€ç³»åˆ—RDDå¹¶é€šè¿‡RDDä¹‹é—´çš„ä¾èµ–å…³ç³»æ„å»ºDAG,ç„¶åå°†DAGæäº¤åˆ°è°ƒåº¦ç³»ç»Ÿï¼› DAGSchedulerå°†DAGåˆ‡åˆ†stageï¼ˆåˆ‡åˆ†ä¾æ®æ˜¯shuffleï¼‰,å°†stageä¸­ç”Ÿæˆçš„taskä»¥tasksetçš„å½¢å¼å‘é€ç»™TaskScheduler Scheduler è°ƒåº¦taskï¼ˆæ ¹æ®èµ„æºæƒ…å†µå°†taskè°ƒåº¦åˆ°Executorsï¼‰ Executorsæ¥æ”¶taskï¼Œç„¶åå°†taskäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œã€‚ ä»»åŠ¡æäº¤è¯¦ç»†æ­¥éª¤ sparké›†ç¾¤å¯åŠ¨åï¼ŒWorkerå‘Masteræ³¨å†Œä¿¡æ¯ spark-submitå‘½ä»¤æäº¤ç¨‹åºåï¼Œdriverå’Œapplicationä¹Ÿä¼šå‘Masteræ³¨å†Œä¿¡æ¯ åˆ›å»ºSparkContextå¯¹è±¡ï¼šä¸»è¦çš„å¯¹è±¡åŒ…å«DAGSchedulerå’ŒTaskScheduler DriveræŠŠApplicationä¿¡æ¯æ³¨å†Œç»™Masteråï¼ŒMasterä¼šæ ¹æ®Appä¿¡æ¯å»WorkerèŠ‚ç‚¹å¯åŠ¨Executor Executorå†…éƒ¨ä¼šåˆ›å»ºè¿è¡Œtaskçš„çº¿ç¨‹æ± ï¼Œç„¶åæŠŠå¯åŠ¨çš„Executoråå‘æ³¨å†Œç»™Dirver DAGSchedulerï¼šè´Ÿè´£æŠŠSparkä½œä¸šè½¬æ¢æˆStageçš„DAGï¼ˆDirected Acyclic Graphæœ‰å‘æ— ç¯å›¾ï¼‰ï¼Œæ ¹æ®å®½çª„ä¾èµ–åˆ‡åˆ†Stageï¼Œç„¶åæŠŠStageå°è£…æˆTaskSetçš„å½¢å¼å‘é€ä¸ªTaskSchedulerï¼›åŒæ—¶DAGSchedulerè¿˜ä¼šå¤„ç†ç”±äºShuffleæ•°æ®ä¸¢å¤±å¯¼è‡´çš„å¤±è´¥ï¼› TaskSchedulerï¼šç»´æŠ¤æ‰€æœ‰TaskSetï¼Œåˆ†å‘Taskç»™å„ä¸ªèŠ‚ç‚¹çš„Executorï¼ˆæ ¹æ®æ•°æ®æœ¬åœ°åŒ–ç­–ç•¥åˆ†å‘Taskï¼‰ï¼Œç›‘æ§taskçš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£é‡è¯•å¤±è´¥çš„taskï¼› æ‰€æœ‰taskè¿è¡Œå®Œæˆåï¼ŒSparkContextå‘Masteræ³¨é”€ï¼Œé‡Šæ”¾èµ„æºï¼› Spark stage åˆ‡åˆ†æµç¨‹ åˆ’åˆ†stage çš„æ€è·¯parkåˆ’åˆ†stageçš„æ•´ä½“æ€è·¯æ˜¯ï¼šä»åå¾€å‰æ¨ï¼Œé‡åˆ°å®½ä¾èµ–å°±æ–­å¼€ï¼Œåˆ’åˆ†ä¸ºä¸€ä¸ªstageï¼›é‡åˆ°çª„ä¾èµ–å°±å°†è¿™ä¸ªRDDåŠ å…¥è¯¥stageä¸­ã€‚ stage ä½œç”¨è¿™æ˜¯ä¸ªå¤æ‚æ˜¯ä¸šåŠ¡é€»è¾‘ï¼ˆå°†å¤šå°æœºå™¨ä¸Šå…·æœ‰ç›¸åŒå±æ€§çš„æ•°æ®èšåˆåˆ°ä¸€å°æœºå™¨ä¸Š:shuffleï¼‰å¦‚æœæœ‰shuffleï¼Œé‚£ä¹ˆå°±æ„å‘³ç€å‰é¢é˜¶æ®µäº§ç”Ÿç»“æœåï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œä¸‹ä¸€ä¸ªé˜¶æ®µçš„è®¡ç®—ä¾èµ–ä¸Šä¸€ä¸ªé˜¶æ®µçš„æ•°æ®åœ¨åŒä¸€ä¸ªstageä¸­ï¼Œä¼šæœ‰å¤šä¸ªç®—å­ï¼Œå¯ä»¥åˆå¹¶åˆ°ä¸€èµ·ï¼Œæˆ‘ä»¬å¾ˆéš¾â€˜â€™ç§°å…¶ä¸ºpipelineï¼ˆæµæ°´çº¿ï¼Œä¸¥æ ¼æŒ‰ç…§æµç¨‹ã€é¡ºåºæ‰§è¡Œï¼‰ Spark Driver ç»™Executor æäº¤task æ—¶åºå›¾ Spark Executor å¯åŠ¨å’Œä»»åŠ¡æ¥å—å’Œæ‰§è¡Œæ—¶åºå›¾ Spark Shuffleæ¦‚è¿°Shuffleå°±æ˜¯å¯¹æ•°æ®è¿›è¡Œé‡ç»„ï¼Œç”±äºåˆ†å¸ƒå¼è®¡ç®—çš„ç‰¹æ€§å’Œè¦æ±‚ï¼Œåœ¨å®ç°ç»†èŠ‚ä¸Šæ›´åŠ ç¹çå’Œå¤æ‚ åœ¨MapReduceæ¡†æ¶ï¼ŒShuffleæ˜¯è¿æ¥Mapå’ŒReduceä¹‹é—´çš„æ¡¥æ¢ï¼ŒMapé˜¶æ®µé€šè¿‡shuffleè¯»å–æ•°æ®å¹¶è¾“å‡ºåˆ°å¯¹åº”çš„Reduceï¼›è€ŒReduceé˜¶æ®µè´Ÿè´£ä»Mapç«¯æ‹‰å–æ•°æ®å¹¶è¿›è¡Œè®¡ç®—ã€‚åœ¨æ•´ä¸ªshuffleè¿‡ç¨‹ä¸­ï¼Œå¾€å¾€ä¼´éšç€å¤§é‡çš„ç£ç›˜å’Œç½‘ç»œI/Oã€‚æ‰€ä»¥shuffleæ€§èƒ½çš„é«˜ä½ä¹Ÿç›´æ¥å†³å®šäº†æ•´ä¸ªç¨‹åºçš„æ€§èƒ½é«˜ä½ã€‚Sparkä¹Ÿä¼šæœ‰è‡ªå·±çš„shuffleå®ç°è¿‡ç¨‹ åœ¨DAGè°ƒåº¦çš„è¿‡ç¨‹ä¸­ï¼ŒStageé˜¶æ®µçš„åˆ’åˆ†æ˜¯æ ¹æ®æ˜¯å¦æœ‰shuffleè¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨ShuffleDependencyå®½ä¾èµ–çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œshuffle,è¿™æ—¶å€™ä¼šå°†ä½œä¸šjobåˆ’åˆ†æˆå¤šä¸ªStageï¼›å¹¶ä¸”åœ¨åˆ’åˆ†Stageçš„æ—¶å€™ï¼Œæ„å»ºShuffleDependencyçš„æ—¶å€™è¿›è¡Œshuffleæ³¨å†Œï¼Œè·å–åç»­æ•°æ®è¯»å–æ‰€éœ€è¦çš„ShuffleHandle,æœ€ç»ˆæ¯ä¸€ä¸ªjobæäº¤åéƒ½ä¼šç”Ÿæˆä¸€ä¸ªResultStageå’Œè‹¥å¹²ä¸ªShuffleMapStageï¼Œå…¶ä¸­ResultStageè¡¨ç¤ºç”Ÿæˆä½œä¸šçš„æœ€ç»ˆç»“æœæ‰€åœ¨çš„Stage. ResultStageä¸ShuffleMapStageä¸­çš„taskåˆ†åˆ«å¯¹åº”ç€ResultTaskä¸ShuffleMapTaskã€‚ä¸€ä¸ªä½œä¸šï¼Œé™¤äº†æœ€ç»ˆçš„ResultStageå¤–ï¼Œå…¶ä»–è‹¥å¹²ShuffleMapStageä¸­å„ä¸ªShuffleMapTaskéƒ½éœ€è¦å°†æœ€ç»ˆçš„æ•°æ®æ ¹æ®ç›¸åº”çš„Partitionerå¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œç„¶åæŒä¹…åŒ–åˆ†åŒºçš„æ•°æ®ã€‚ HashShuffleæœºåˆ¶HashShuffleæ¦‚è¿°åœ¨spark-1.6ç‰ˆæœ¬ä¹‹å‰ï¼Œä¸€ç›´ä½¿ç”¨HashShuffleï¼Œåœ¨spark-1.6ç‰ˆæœ¬ä¹‹åä½¿ç”¨Sort-Base Shuffleï¼Œå› ä¸ºHashShuffleå­˜åœ¨çš„ä¸è¶³æ‰€ä»¥å°±æ›¿æ¢äº†HashShuffle. æˆ‘ä»¬çŸ¥é“ï¼ŒSparkçš„è¿è¡Œä¸»è¦åˆ†ä¸º2éƒ¨åˆ†ï¼šä¸€éƒ¨åˆ†æ˜¯é©±åŠ¨ç¨‹åºï¼Œå…¶æ ¸å¿ƒæ˜¯SparkContextï¼›å¦ä¸€éƒ¨åˆ†æ˜¯WorkerèŠ‚ç‚¹ä¸ŠTask,å®ƒæ˜¯è¿è¡Œå®é™…ä»»åŠ¡çš„ã€‚ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼ŒDriverå’ŒExecutorè¿›ç¨‹ç›¸äº’äº¤äº’ï¼šè¿è¡Œä»€ä¹ˆä»»åŠ¡ï¼Œå³Driverä¼šåˆ†é…Taskåˆ°Executorï¼ŒDriver è·Ÿ Executor è¿›è¡Œç½‘ç»œä¼ è¾“; ä»»åŠ¡æ•°æ®ä»å“ªå„¿è·å–ï¼Œå³Taskè¦ä» Driver æŠ“å–å…¶ä»–ä¸Šæ¸¸çš„ Task çš„æ•°æ®ç»“æœï¼Œæ‰€ä»¥æœ‰è¿™ä¸ªè¿‡ç¨‹ä¸­å°±ä¸æ–­çš„äº§ç”Ÿç½‘ç»œç»“æœã€‚å…¶ä¸­ï¼Œä¸‹ä¸€ä¸ª Stage å‘ä¸Šä¸€ä¸ª Stage è¦æ•°æ®è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸º Shuffleã€‚ æ²¡æœ‰ä¼˜åŒ–ä¹‹å‰çš„HashShuffleæœºåˆ¶ åœ¨HashShuffleæ²¡æœ‰ä¼˜åŒ–ä¹‹å‰ï¼Œæ¯ä¸€ä¸ªShufflleMapTaskä¼šä¸ºæ¯ä¸€ä¸ªReduceTaskåˆ›å»ºä¸€ä¸ªbucketç¼“å­˜ï¼Œå¹¶ä¸”ä¼šä¸ºæ¯ä¸€ä¸ªbucketåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªbucketå­˜æ”¾çš„æ•°æ®å°±æ˜¯ç»è¿‡Partitioneræ“ä½œ(é»˜è®¤æ˜¯HashPartitioner)ä¹‹åæ‰¾åˆ°å¯¹åº”çš„bucketç„¶åæ”¾è¿›å»ï¼Œæœ€åå°†æ•°æ®åˆ·æ–°bucketç¼“å­˜çš„æ•°æ®åˆ°ç£ç›˜ä¸Šï¼Œå³å¯¹åº”çš„block file. ç„¶åShuffleMapTaskå°†è¾“å‡ºä½œä¸ºMapStatuså‘é€åˆ°DAGSchedulerçš„MapOutputTrackerMasterï¼Œæ¯ä¸€ä¸ªMapStatusåŒ…å«äº†æ¯ä¸€ä¸ªResultTaskè¦æ‹‰å–çš„æ•°æ®çš„ä½ç½®å’Œå¤§å° ResultTaskç„¶åå»åˆ©ç”¨BlockStoreShuffleFetcherå‘MapOutputTrackerMasterè·å–MapStatusï¼Œçœ‹å“ªä¸€ä»½æ•°æ®æ˜¯å±äºè‡ªå·±çš„ï¼Œç„¶ååº•å±‚é€šè¿‡BlockManagerå°†æ•°æ®æ‹‰å–è¿‡æ¥ æ‹‰å–è¿‡æ¥çš„æ•°æ®ä¼šç»„æˆä¸€ä¸ªå†…éƒ¨çš„ShuffleRDDï¼Œä¼˜å…ˆæ”¾å…¥å†…å­˜ï¼Œå†…å­˜ä¸å¤Ÿç”¨åˆ™æ”¾å…¥ç£ç›˜ï¼Œç„¶åResulTaskå¼€å§‹è¿›è¡Œèšåˆï¼Œæœ€åç”Ÿæˆæˆ‘ä»¬å¸Œæœ›è·å–çš„é‚£ä¸ªMapPartitionRDD è¿™ç§æ–¹å¼çš„ç¼ºç‚¹ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šåœ¨è¿™é‡Œæœ‰1ä¸ªworkerï¼Œ2ä¸ªexecutorï¼Œæ¯ä¸€ä¸ªexecutorè¿è¡Œ2ä¸ªShuffleMapTaskï¼Œæœ‰ä¸‰ä¸ªReduceTaskï¼Œæ‰€ä»¥æ€»å…±å°±æœ‰4 * 3=12ä¸ªbucketå’Œ12ä¸ªblock fileã€‚ å¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œå°†ä¼šç”ŸæˆMRä¸ªå°æ–‡ä»¶ï¼Œæ¯”å¦‚ShuffleMapTaskæœ‰100ä¸ªï¼ŒResultTaskæœ‰100ä¸ªï¼Œè¿™å°±ä¼šäº§ç”Ÿ100100=10000ä¸ªå°æ–‡ä»¶ bucketç¼“å­˜å¾ˆé‡è¦ï¼Œéœ€è¦å°†ShuffleMapTaskæ‰€æœ‰æ•°æ®éƒ½å†™å…¥bucketï¼Œæ‰ä¼šåˆ·åˆ°ç£ç›˜ï¼Œé‚£ä¹ˆå¦‚æœMapç«¯æ•°æ®è¿‡å¤šï¼Œè¿™å°±å¾ˆå®¹æ˜“é€ æˆå†…å­˜æº¢å‡ºï¼Œå°½ç®¡åé¢æœ‰ä¼˜åŒ–ï¼Œbucketå†™å…¥çš„æ•°æ®è¾¾åˆ°åˆ·æ–°åˆ°ç£ç›˜çš„é˜€å€¼ä¹‹åï¼Œå°±ä¼šå°†æ•°æ®ä¸€ç‚¹ä¸€ç‚¹çš„åˆ·æ–°åˆ°ç£ç›˜ï¼Œä½†æ˜¯è¿™æ ·ç£ç›˜I/Oå°±å¤šäº† ä¼˜åŒ–åçš„HashShuffle æ¯ä¸€ä¸ªExecutorè¿›ç¨‹æ ¹æ®æ ¸æ•°ï¼Œå†³å®šTaskçš„å¹¶å‘æ•°é‡ï¼Œæ¯”å¦‚executoræ ¸æ•°æ˜¯2ï¼Œå°±æ˜¯å¯ä»¥å¹¶å‘è¿è¡Œä¸¤ä¸ªtaskï¼Œå¦‚æœæ˜¯ä¸€ä¸ªåˆ™åªèƒ½è¿è¡Œä¸€ä¸ªtask å‡è®¾executoræ ¸æ•°æ˜¯1ï¼ŒShuffleMapTaskæ•°é‡æ˜¯M,é‚£ä¹ˆå®ƒä¾ç„¶ä¼šæ ¹æ®ResultTaskçš„æ•°é‡Rï¼Œåˆ›å»ºRä¸ªbucketç¼“å­˜ï¼Œç„¶åå¯¹keyè¿›è¡Œhashï¼Œæ•°æ®è¿›å…¥ä¸åŒçš„bucketä¸­ï¼Œæ¯ä¸€ä¸ªbucketå¯¹åº”ç€ä¸€ä¸ªblock file,ç”¨äºåˆ·æ–°bucketç¼“å­˜é‡Œçš„æ•°æ® ç„¶åä¸‹ä¸€ä¸ªtaskè¿è¡Œçš„æ—¶å€™ï¼Œé‚£ä¹ˆä¸ä¼šå†åˆ›å»ºæ–°çš„bucketå’Œblock fileï¼Œè€Œæ˜¯å¤ç”¨ä¹‹å‰çš„taskå·²ç»åˆ›å»ºå¥½çš„bucketå’Œblock fileã€‚å³æ‰€è°“åŒä¸€ä¸ªExecutorè¿›ç¨‹é‡Œæ‰€æœ‰Taskéƒ½ä¼šæŠŠç›¸åŒçš„keyæ”¾å…¥ç›¸åŒçš„bucketç¼“å†²åŒºä¸­ è¿™æ ·çš„è¯ï¼Œç”Ÿæˆæ–‡ä»¶çš„æ•°é‡å°±æ˜¯(æœ¬åœ°workerçš„executoræ•°é‡*executorçš„cores*ResultTaskæ•°é‡)å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå³2 * 1* 3 = 6ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªExecutorçš„shuffleMapTaskæ•°é‡100,ReduceTaskæ•°é‡ä¸º100ï¼Œé‚£ä¹ˆ æœªä¼˜åŒ–çš„HashShuffleçš„æ–‡ä»¶æ•°æ˜¯2 *1* 100*100 =20000ï¼Œä¼˜åŒ–ä¹‹åçš„æ•°é‡æ˜¯2*1*100 = 200æ–‡ä»¶ï¼Œç›¸å½“äºå°‘äº†100å€ è¿™ç§æ–¹å¼çš„ç¼ºç‚¹ï¼š å¦‚æœ Reducer ç«¯çš„å¹¶è¡Œä»»åŠ¡æˆ–è€…æ˜¯æ•°æ®åˆ†ç‰‡è¿‡å¤šçš„è¯åˆ™ Core * Reducer Task ä¾æ—§è¿‡å¤§ï¼Œä¹Ÿä¼šäº§ç”Ÿå¾ˆå¤šå°æ–‡ä»¶ã€‚ Sort-Based ShuffleSort-Based Shuffleæ¦‚è¿°HashShuffleå›é¡¾ io\GC\å†…å­˜å ç”¨å¤§: HashShuffleå†™æ•°æ®çš„æ—¶å€™ï¼Œå†…å­˜æœ‰ä¸€ä¸ªbucketç¼“å†²åŒºï¼ŒåŒæ—¶åœ¨æœ¬åœ°ç£ç›˜æœ‰å¯¹åº”çš„æœ¬åœ°æ–‡ä»¶ï¼Œå¦‚æœæœ¬åœ°æœ‰æ–‡ä»¶ï¼Œé‚£ä¹ˆåœ¨å†…å­˜åº”è¯¥ä¹Ÿæœ‰æ–‡ä»¶å¥æŸ„ä¹Ÿæ˜¯éœ€è¦è€—è´¹å†…å­˜çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»å†…å­˜çš„è§’åº¦è€ƒè™‘ï¼Œå³æœ‰ä¸€éƒ¨åˆ†å­˜å‚¨æ•°æ®ï¼Œä¸€éƒ¨åˆ†ç®¡ç†æ–‡ä»¶å¥æŸ„ã€‚å¦‚æœMapperåˆ†ç‰‡æ•°é‡ä¸º1000,Reduceåˆ†ç‰‡æ•°é‡ä¸º1000,é‚£ä¹ˆæ€»å…±å°±éœ€è¦1000000ä¸ªå°æ–‡ä»¶ã€‚æ‰€ä»¥å°±ä¼šæœ‰å¾ˆå¤šå†…å­˜æ¶ˆè€—ï¼Œé¢‘ç¹IOä»¥åŠGCé¢‘ç¹æˆ–è€…å‡ºç°å†…å­˜æº¢å‡ºã€‚ å®¹æ˜“é€ æˆç½‘ç»œå¼‚å¸¸: è€Œä¸”Reducerç«¯è¯»å–Mapç«¯æ•°æ®æ—¶ï¼ŒMapperæœ‰è¿™ä¹ˆå¤šå°æ–‡ä»¶ï¼Œå°±éœ€è¦æ‰“å¼€å¾ˆå¤šç½‘ç»œé€šé“è¯»å–ï¼Œå¾ˆå®¹æ˜“é€ æˆReducerï¼ˆä¸‹ä¸€ä¸ªstageï¼‰é€šè¿‡driverå»æ‹‰å–ä¸Šä¸€ä¸ªstageæ•°æ®çš„æ—¶å€™ï¼Œè¯´æ–‡ä»¶æ‰¾ä¸åˆ°ï¼Œå…¶å®ä¸æ˜¯æ–‡ä»¶æ‰¾ä¸åˆ°è€Œæ˜¯ç¨‹åºä¸å“åº”ï¼Œå› ä¸ºæ­£åœ¨GC. Sorted-Based Shuffleä»‹ç»ä¸ºäº†ç¼“è§£Shuffleè¿‡ç¨‹äº§ç”Ÿæ–‡ä»¶æ•°è¿‡å¤šå’ŒWriterç¼“å­˜å¼€é”€è¿‡å¤§çš„é—®é¢˜ï¼Œsparkå¼•å…¥äº†ç±»ä¼¼äºhadoop Map-Reduceçš„shuffleæœºåˆ¶ã€‚è¯¥æœºåˆ¶æ¯ä¸€ä¸ªShuffleMapTaskä¸ä¼šä¸ºåç»­çš„ä»»åŠ¡åˆ›å»ºå•ç‹¬çš„æ–‡ä»¶ï¼Œè€Œæ˜¯ä¼šå°†æ‰€æœ‰çš„Taskç»“æœå†™å…¥åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”å¯¹åº”ç”Ÿæˆä¸€ä¸ªç´¢å¼•æ–‡ä»¶ã€‚ä»¥å‰çš„æ•°æ®æ˜¯æ”¾åœ¨å†…å­˜ç¼“å­˜ä¸­ï¼Œç­‰åˆ°æ•°æ®å®Œäº†å†åˆ·åˆ°ç£ç›˜ï¼Œç°åœ¨ä¸ºäº†å‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼Œåœ¨å†…å­˜ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå¯ä»¥å°†è¾“å‡ºæº¢å†™åˆ°ç£ç›˜ï¼Œç»“æŸçš„æ—¶å€™ï¼Œå†å°†è¿™äº›ä¸åŒçš„æ–‡ä»¶è”åˆå†…å­˜çš„æ•°æ®ä¸€èµ·è¿›è¡Œå½’å¹¶ï¼Œä»è€Œå‡å°‘å†…å­˜çš„ä½¿ç”¨é‡ã€‚ä¸€æ–¹é¢æ–‡ä»¶æ•°é‡æ˜¾è‘—å‡å°‘ï¼Œå¦ä¸€æ–¹é¢å‡å°‘Writerç¼“å­˜æ‰€å ç”¨çš„å†…å­˜å¤§å°ï¼Œè€Œä¸”åŒæ—¶é¿å…GCçš„é£é™©å’Œé¢‘ç‡ã€‚ Sort-Based Shuffleæœ‰å‡ ç§ä¸åŒçš„ç­–ç•¥ï¼šBypassMergeSortShuffleWriterã€SortShuffleWriterå’ŒUnasfeSortShuffleWriterã€‚ å¯¹äºBypassMergeSortShuffleWriter ä½¿ç”¨è¿™ä¸ªæ¨¡å¼ç‰¹ç‚¹ï¼š ä¸»è¦ç”¨äºå¤„ç†ä¸éœ€è¦æ’åºå’Œèšåˆçš„Shuffleæ“ä½œï¼Œæ‰€ä»¥æ•°æ®æ˜¯ç›´æ¥å†™å…¥æ–‡ä»¶ï¼Œæ•°æ®é‡è¾ƒå¤§çš„æ—¶å€™ï¼Œç½‘ç»œI/Oå’Œå†…å­˜è´Ÿæ‹…è¾ƒé‡ ä¸»è¦é€‚åˆå¤„ç†Reducerä»»åŠ¡æ•°é‡æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ å°†æ¯ä¸€ä¸ªåˆ†åŒºå†™å…¥ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Œæœ€åå°†è¿™äº›æ–‡ä»¶åˆå¹¶,å‡å°‘æ–‡ä»¶æ•°é‡ï¼›ä½†æ˜¯è¿™ç§æ–¹å¼éœ€è¦å¹¶å‘æ‰“å¼€å¤šä¸ªæ–‡ä»¶ï¼Œå¯¹å†…å­˜æ¶ˆè€—æ¯”è¾ƒå¤§ å› ä¸ºBypassMergeSortShuffleWriterè¿™ç§æ–¹å¼æ¯”SortShuffleWriteræ›´å¿«ï¼Œæ‰€ä»¥å¦‚æœåœ¨Reduceræ•°é‡ä¸å¤§ï¼Œåˆä¸éœ€è¦åœ¨mapç«¯èšåˆå’Œæ’åºï¼Œè€Œä¸”æœ€ç»ˆäº§ç”Ÿçš„æ–‡ä»¶æ•°é‡å°‘ï¼Œå°½é‡ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œshuffleã€‚ Reducerçš„æ•°ç›® &lt; spark.shuffle.sort.bypassMergeThrsholdæŒ‡å®šçš„é˜€å€¼ï¼Œå°±æ˜¯ç”¨çš„æ˜¯è¿™ç§æ–¹å¼ã€‚ å¯¹äºSortShuffleWriter ä½¿ç”¨è¿™ä¸ªæ¨¡å¼ç‰¹ç‚¹ï¼š æ¯”è¾ƒé€‚åˆæ•°æ®é‡å¾ˆå¤§çš„åœºæ™¯æˆ–è€…é›†ç¾¤è§„æ¨¡å¾ˆå¤§ å¼•å…¥äº†å¤–éƒ¨å¤–éƒ¨æ’åºå™¨ï¼Œå¯ä»¥æ”¯æŒåœ¨Mapç«¯è¿›è¡Œæœ¬åœ°èšåˆæˆ–è€…ä¸èšåˆ å¦‚æœå¤–éƒ¨æ’åºå™¨enableäº†spillåŠŸèƒ½ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿï¼Œå¯ä»¥å…ˆå°†è¾“å‡ºæº¢å†™åˆ°æœ¬åœ°ç£ç›˜ï¼Œæœ€åå°†å†…å­˜ç»“æœå’Œæœ¬åœ°ç£ç›˜çš„æº¢å†™æ–‡ä»¶è¿›è¡Œåˆå¹¶ å¦å¤–è¿™ä¸ªSort-Based Shuffleè·ŸExecutoræ ¸æ•°æ²¡æœ‰å…³ç³»ï¼Œå³è·Ÿå¹¶å‘åº¦æ²¡æœ‰å…³ç³»ï¼Œå®ƒæ˜¯æ¯ä¸€ä¸ªShuffleMapTaskéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªdataæ–‡ä»¶å’Œindexæ–‡ä»¶ï¼Œæ‰€è°“åˆå¹¶ä¹Ÿåªæ˜¯å°†è¯¥ShuffleMapTaskçš„å„ä¸ªpartitionå¯¹åº”çš„åˆ†åŒºæ–‡ä»¶åˆå¹¶åˆ°dataæ–‡ä»¶è€Œå·²ã€‚æ‰€ä»¥è¿™ä¸ªå°±éœ€è¦ä¸ªHash-BasedShuffleçš„consolidationæœºåˆ¶åŒºåˆ«å¼€æ¥ã€‚]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Spark</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spark SQL]]></title>
    <url>%2F2020%2F03%2F31%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FSpark%2F3.Spark%20SQL%2F</url>
    <content type="text"><![CDATA[Spark SQL ä»‹ç»ä»€ä¹ˆæ˜¯Spark SQLSpark SQLæ˜¯Sparkç”¨æ¥å¤„ç†ç»“æ„åŒ–æ•°æ®çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç¼–ç¨‹æŠ½è±¡å«åšDataFrameå¹¶ä¸”ä½œä¸ºåˆ†å¸ƒå¼SQLæŸ¥è¯¢å¼•æ“çš„ä½œç”¨ã€‚ Sparkçš„ä½œç”¨æˆ‘ä»¬å·²ç»å­¦ä¹ äº†Hiveï¼Œå®ƒæ˜¯å°†Hive SQLè½¬æ¢æˆMapReduceç„¶åæäº¤åˆ°é›†ç¾¤ä¸Šæ‰§è¡Œï¼Œå¤§å¤§ç®€åŒ–äº†ç¼–å†™MapReduceçš„ç¨‹åºçš„å¤æ‚æ€§ï¼Œç”±äºMapReduceè¿™ç§è®¡ç®—æ¨¡å‹æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒæ…¢ã€‚æ‰€æœ‰Spark SQLçš„åº”è¿è€Œç”Ÿï¼Œå®ƒæ˜¯å°†Spark SQLè½¬æ¢æˆRDDï¼Œç„¶åæäº¤åˆ°é›†ç¾¤æ‰§è¡Œï¼Œæ‰§è¡Œæ•ˆç‡éå¸¸å¿«ï¼ Spark SQL çš„ç‰¹ç‚¹ æ˜“æ•´åˆ ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ–¹å¼ å…¼å®¹Hive æ ‡å‡†çš„æ•°æ®è¿æ¥ Dataframeä»‹ç»ä»€ä¹ˆæ˜¯Dataframeä¸RDDç±»ä¼¼ï¼ŒDataFrameä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®å®¹å™¨ã€‚ç„¶è€ŒDataFrameæ›´åƒä¼ ç»Ÿæ•°æ®åº“çš„äºŒç»´è¡¨æ ¼ï¼Œé™¤äº†æ•°æ®ä»¥å¤–ï¼Œè¿˜è®°å½•æ•°æ®çš„ç»“æ„ä¿¡æ¯ï¼Œå³schemaã€‚åŒæ—¶ï¼Œä¸Hiveç±»ä¼¼ï¼ŒDataFrameä¹Ÿæ”¯æŒåµŒå¥—æ•°æ®ç±»å‹ï¼ˆstructã€arrayå’Œmapï¼‰ã€‚ä»APIæ˜“ç”¨æ€§çš„è§’åº¦ä¸Š çœ‹ï¼ŒDataFrame APIæä¾›çš„æ˜¯ä¸€å¥—é«˜å±‚çš„å…³ç³»æ“ä½œï¼Œæ¯”å‡½æ•°å¼çš„RDD APIè¦æ›´åŠ å‹å¥½ï¼Œé—¨æ§›æ›´ä½ã€‚ç”±äºä¸Rå’ŒPandasçš„DataFrameç±»ä¼¼ï¼ŒSpark DataFrameå¾ˆå¥½åœ°ç»§æ‰¿äº†ä¼ ç»Ÿå•æœºæ•°æ®åˆ†æçš„å¼€å‘ä½“éªŒã€‚ å¦‚ä½•åˆ›å»ºDataframe åœ¨Spark SQLä¸­SQLContextæ˜¯åˆ›å»ºDataFrameså’Œæ‰§è¡ŒSQLçš„å…¥å£ï¼Œåœ¨spark-1.5.2ä¸­å·²ç»å†…ç½®äº†ä¸€ä¸ªsqlContext ç¤ºä¾‹: åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæœ‰ä¸‰åˆ—ï¼Œåˆ†åˆ«æ˜¯idã€nameã€ageï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œç„¶åä¸Šä¼ åˆ°hdfsä¸Š hdfs dfs -put person.txt / åœ¨spark shellæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œè¯»å–æ•°æ®ï¼Œå°†æ¯ä¸€è¡Œçš„æ•°æ®ä½¿ç”¨åˆ—åˆ†éš”ç¬¦åˆ†å‰² val lineRDD = sc.textFile(â€œhdfs://node1.itcast.cn:9000/person.txtâ€).map(_.split(â€œ â€œ)) å®šä¹‰case classï¼ˆç›¸å½“äºè¡¨çš„schemaï¼‰ case class Person(id:Int, name:String, age:Int) å°†RDDå’Œcase classå…³è” val personRDD = lineRDD.map(x =&gt; Person(x(0).toInt, x(1), x(2).toInt)) å°†RDDè½¬æ¢æˆDataFrame val personDF = personRDD.toDF å¯¹DataFrameè¿›è¡Œå¤„ç† personDF.show Dataframeå¸¸ç”¨æ“ä½œæŸ¥çœ‹Dataframe ä¸­å†…å®¹ personDF.show æŸ¥çœ‹DataFrameéƒ¨åˆ†åˆ—ä¸­çš„å†…å®¹ personDF.select(personDF.col(â€œnameâ€)).show personDF.select(col(â€œnameâ€), col(â€œageâ€)).show personDF.select(â€œnameâ€).show æ‰“å°dataFrameçš„Schemaä¿¡æ¯ personDF.printSchema æŸ¥çœ‹å†…å®¹ï¼Œå¹¶å¯¹å­—æ®µè¿›è¡Œè®¡ç®— personDF.select(col(â€œidâ€), col(â€œnameâ€), col(â€œageâ€) + 1).show personDF.select(personDF(â€œidâ€), personDF(â€œnameâ€), personDF(â€œageâ€) + 1).show å­—æ®µæ¡ä»¶è¿‡æ»¤ personDF.filter(col(â€œageâ€) &gt;= 18).show åˆ†ç»„è®¡ç®— personDF.groupBy(â€œageâ€).count().show() SQL è¯­æ³•é£æ ¼å°†Dataframeæ³¨å†Œæˆè¡¨ personDF.registerTempTable(â€œt_personâ€) sqlæ’åºæŸ¥è¯¢ sqlContext.sql(â€œselect * from t_person order by age desc limit 2â€).show æŸ¥è¯¢schemaä¿¡æ¯ sqlContext.sql(â€œdesc t_personâ€).show ç¼–å†™ Spark SQLæŸ¥è¯¢ä»»åŠ¡ç¯å¢ƒå‡†å¤‡åˆ›å»ºscala mavené¡¹ç›®ï¼Œåœ¨mavené¡¹ç›®çš„pom.xmlä¸­æ·»åŠ Spark SQLçš„ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.spark&lt;/groupId&gt; &lt;artifactId&gt;spark-sql_2.10&lt;/artifactId&gt; &lt;version&gt;1.5.2&lt;/version&gt;&lt;/dependency&gt; ä¸¤ç§æ¨æ–­è¡¨Schemaçš„æ–¹å¼é€šè¿‡åå°„æ¥æ¨æ–­Schema åˆ›å»ºä¸»ç±» 12345678910111213141516171819202122232425262728293031323334353637package cn.itcast.spark.sqlimport org.apache.spark.&#123;SparkConf, SparkContext&#125;import org.apache.spark.sql.SQLContextobject InferringSchema &#123; def main(args: Array[String]) &#123; //åˆ›å»ºSparkConf()å¹¶è®¾ç½®Appåç§° val conf = new SparkConf().setAppName("SQL-1") //SQLContextè¦ä¾èµ–SparkContext val sc = new SparkContext(conf) //åˆ›å»ºSQLContext val sqlContext = new SQLContext(sc) //ä»æŒ‡å®šçš„åœ°å€åˆ›å»ºRDD val lineRDD = sc.textFile(args(0)).map(_.split(" ")) //åˆ›å»ºcase class //å°†RDDå’Œcase classå…³è” val personRDD = lineRDD.map(x =&gt; Person(x(0).toInt, x(1), x(2).toInt)) //å¯¼å…¥éšå¼è½¬æ¢ï¼Œå¦‚æœä¸åˆ°äººæ— æ³•å°†RDDè½¬æ¢æˆDataFrame //å°†RDDè½¬æ¢æˆDataFrame import sqlContext.implicits._ val personDF = personRDD.toDF //æ³¨å†Œè¡¨ personDF.registerTempTable("t_person") //ä¼ å…¥SQL val df = sqlContext.sql("select * from t_person order by age desc limit 2") //å°†ç»“æœä»¥JSONçš„æ–¹å¼å­˜å‚¨åˆ°æŒ‡å®šä½ç½® df.write.json(args(1)) //åœæ­¢Spark Context sc.stop() &#125;&#125;//case classä¸€å®šè¦æ”¾åˆ°å¤–é¢case class Person(id: Int, name: String, age: Int) å°†ç¨‹åºæ‰“æˆjaråŒ…ï¼Œä¸Šä¼ åˆ°sparké›†ç¾¤ï¼Œæäº¤Sparkä»»åŠ¡ 123456/usr/local/spark-1.5.2-bin-hadoop2.6/bin/spark-submit \--class cn.itcast.spark.sql.InferringSchema \--master spark://node1.itcast.cn:7077 \/root/spark-mvn-1.0-SNAPSHOT.jar \hdfs://node1.itcast.cn:9000/person.txt \hdfs://node1.itcast.cn:9000/out æŸ¥çœ‹è¿è¡Œç»“æœ hdfs dfs -cat hdfs://node1.itcast.cn:9000/out/part-r-* é€šè¿‡StructTypeç›´æ¥æŒ‡å®šSchema åˆ›å»ºä¸»ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041package cn.itcast.spark.sqlimport org.apache.spark.sql.&#123;Row, SQLContext&#125;import org.apache.spark.sql.types._import org.apache.spark.&#123;SparkContext, SparkConf&#125;/** * Created by ZX on 2015/12/11. */object SpecifyingSchema &#123; def main(args: Array[String]) &#123; //åˆ›å»ºSparkConf()å¹¶è®¾ç½®Appåç§° val conf = new SparkConf().setAppName("SQL-2") //SQLContextè¦ä¾èµ–SparkContext val sc = new SparkContext(conf) //åˆ›å»ºSQLContext val sqlContext = new SQLContext(sc) //ä»æŒ‡å®šçš„åœ°å€åˆ›å»ºRDD val personRDD = sc.textFile(args(0)).map(_.split(" ")) //é€šè¿‡StructTypeç›´æ¥æŒ‡å®šæ¯ä¸ªå­—æ®µçš„schema val schema = StructType( List( StructField("id", IntegerType, true), StructField("name", StringType, true), StructField("age", IntegerType, true) ) ) //å°†RDDæ˜ å°„åˆ°rowRDD val rowRDD = personRDD.map(p =&gt; Row(p(0).toInt, p(1).trim, p(2).toInt)) //å°†schemaä¿¡æ¯åº”ç”¨åˆ°rowRDDä¸Š val personDataFrame = sqlContext.createDataFrame(rowRDD, schema) //æ³¨å†Œè¡¨ personDataFrame.registerTempTable("t_person") //æ‰§è¡ŒSQL val df = sqlContext.sql("select * from t_person order by age desc limit 4") //å°†ç»“æœä»¥JSONçš„æ–¹å¼å­˜å‚¨åˆ°æŒ‡å®šä½ç½® df.write.json(args(1)) //åœæ­¢Spark Context sc.stop() &#125;&#125; å°†ç¨‹åºæ‰“æˆjaråŒ…ï¼Œä¸Šä¼ åˆ°sparké›†ç¾¤ï¼Œæäº¤Sparkä»»åŠ¡ 123456/usr/local/spark-1.5.2-bin-hadoop2.6/bin/spark-submit \--class cn.itcast.spark.sql.InferringSchema \--master spark://node1.itcast.cn:7077 \/root/spark-mvn-1.0-SNAPSHOT.jar \hdfs://node1.itcast.cn:9000/person.txt \hdfs://node1.itcast.cn:9000/out æŸ¥çœ‹è¿è¡Œç»“æœ hdfs dfs -cat hdfs://node1.itcast.cn:9000/out/part-r-* Spark SQL JDBC ç›´æ¥å¯¹æ¥æ•°æ®æºSpark JDBC ä½œç”¨Spark SQLå¯ä»¥é€šè¿‡JDBCä»å…³ç³»å‹æ•°æ®åº“ä¸­è¯»å–æ•°æ®çš„æ–¹å¼åˆ›å»ºDataFrameï¼Œé€šè¿‡å¯¹DataFrameä¸€ç³»åˆ—çš„è®¡ç®—åï¼Œè¿˜å¯ä»¥å°†æ•°æ®å†å†™å›å…³ç³»å‹æ•°æ®åº“ä¸­ã€‚ Spark JDBCä½¿ç”¨(spark shellç¤ºä¾‹) å¯åŠ¨Spark Shellï¼Œå¿…é¡»æŒ‡å®šmysqlè¿æ¥é©±åŠ¨jaråŒ… /usr/local/spark-1.5.2-bin-hadoop2.6/bin/spark-shell \ â€“master spark://node1.itcast.cn:7077 \ â€“jars /usr/local/spark-1.5.2-bin-hadoop2.6/mysql-connector-java-5.1.35-bin.jar \ â€“driver-class-path /usr/local/spark-1.5.2-bin-hadoop2.6/mysql-connector-java-5.1.35-bin.jar ä»mysqlä¸­åŠ è½½æ•°æ® val jdbcDF = sqlContext.read.format(â€œjdbcâ€).options(Map(â€œurlâ€ -&gt; â€œjdbc:mysql://192.168.10.1:3306/bigdataâ€, â€œdriverâ€ -&gt; â€œcom.mysql.jdbc.Driverâ€, â€œdbtableâ€ -&gt; â€œpersonâ€, â€œuserâ€ -&gt; â€œrootâ€, â€œpasswordâ€ -&gt; â€œ123456â€)).load() å¯¹æ•°æ®è¿›è¡ŒæŸ¥è¯¢ jdbcDF.show() Spark JDBSä½¿ç”¨(jaråŒ…æ–¹å¼) åˆ›å»ºä¸»ç±» Spark SQLç¨‹åº 12345678910111213141516171819202122232425262728293031import org.apache.spark.&#123;SparkConf, SparkContext&#125;object JdbcRDD &#123; def main(args: Array[String]) &#123; val conf = new SparkConf().setAppName("MySQL-Demo") val sc = new SparkContext(conf) val sqlContext = new SQLContext(sc) //é€šè¿‡å¹¶è¡ŒåŒ–åˆ›å»ºRDD val personRDD = sc.parallelize(Array("1 tom 5", "2 jerry 3", "3 kitty 6")).map(_.split(" ")) //é€šè¿‡StructTypeç›´æ¥æŒ‡å®šæ¯ä¸ªå­—æ®µçš„schema val schema = StructType( List( StructField("id", IntegerType, true), StructField("name", StringType, true), StructField("age", IntegerType, true) ) ) //å°†RDDæ˜ å°„åˆ°rowRDD val rowRDD = personRDD.map(p =&gt; Row(p(0).toInt, p(1).trim, p(2).toInt)) //å°†schemaä¿¡æ¯åº”ç”¨åˆ°rowRDDä¸Š val personDataFrame = sqlContext.createDataFrame(rowRDD, schema) //åˆ›å»ºPropertieså­˜å‚¨æ•°æ®åº“ç›¸å…³å±æ€§ val prop = new Properties() prop.put("user", "root") prop.put("password", "123456") //å°†æ•°æ®è¿½åŠ åˆ°æ•°æ®åº“ personDataFrame.write.mode("append").jdbc("jdbc:mysql://192.168.10.1:3306/bigdata", "bigdata.person", prop) //åœæ­¢SparkContext sc.stop() &#125;&#125; ç”¨mavenå°†ç¨‹åºæ‰“åŒ… å°†jaråŒ…æäº¤åˆ°é›†ç¾¤æ‰§è¡Œ 123456/usr/local/spark-1.5.2-bin-hadoop2.6/bin/spark-submit \--class cn.itcast.spark.sql.JdbcRDD \--master spark://node1.itcast.cn:7077 \--jars /usr/local/spark-1.5.2-bin-hadoop2.6/mysql-connector-java-5.1.35-bin.jar \--driver-class-path /usr/local/spark-1.5.2-bin-hadoop2.6/mysql-connector-java-5.1.35-bin.jar \/root/spark-mvn-1.0-SNAPSHOT.jar]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Spark</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spark Streaming]]></title>
    <url>%2F2020%2F03%2F31%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FSpark%2F4.Spark%20Streaming%2F</url>
    <content type="text"><![CDATA[Spark Streamingä»‹ç»ä»€ä¹ˆæ˜¯Spark StreamingSpark Streamingç±»ä¼¼äºApache Stormï¼Œç”¨äºæµå¼æ•°æ®çš„å¤„ç†ã€‚æ ¹æ®å…¶å®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼ŒSpark Streamingæœ‰é«˜ååé‡å’Œå®¹é”™èƒ½åŠ›å¼ºç­‰ç‰¹ç‚¹ã€‚Spark Streamingæ”¯æŒçš„æ•°æ®è¾“å…¥æºå¾ˆå¤šï¼Œä¾‹å¦‚ï¼šKafkaã€Flumeã€Twitterã€ZeroMQå’Œç®€å•çš„TCPå¥—æ¥å­—ç­‰ç­‰ã€‚æ•°æ®è¾“å…¥åå¯ä»¥ç”¨Sparkçš„é«˜åº¦æŠ½è±¡åŸè¯­å¦‚ï¼šmapã€reduceã€joinã€windowç­‰è¿›è¡Œè¿ç®—ã€‚è€Œç»“æœä¹Ÿèƒ½ä¿å­˜åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œå¦‚HDFSï¼Œæ•°æ®åº“ç­‰ã€‚å¦å¤–Spark Streamingä¹Ÿèƒ½å’ŒMLlibï¼ˆæœºå™¨å­¦ä¹ ï¼‰ä»¥åŠGraphxå®Œç¾èåˆã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨Spark Streaming æ˜“ç”¨ å®¹é”™ å®¹æ˜“æ•´åˆåˆ°Sparkä½“ç³» DStreamä»‹ç»ä»€ä¹ˆæ˜¯DStreamDiscretized Streamæ˜¯Spark Streamingçš„åŸºç¡€æŠ½è±¡ï¼Œä»£è¡¨æŒç»­æ€§çš„æ•°æ®æµå’Œç»è¿‡å„ç§SparkåŸè¯­æ“ä½œåçš„ç»“æœæ•°æ®æµã€‚åœ¨å†…éƒ¨å®ç°ä¸Šï¼ŒDStreamæ˜¯ä¸€ç³»åˆ—è¿ç»­çš„RDDæ¥è¡¨ç¤ºã€‚æ¯ä¸ªRDDå«æœ‰ä¸€æ®µæ—¶é—´é—´éš”å†…çš„æ•°æ®ï¼Œå¦‚ä¸‹å›¾ï¼š å¯¹æ•°æ®çš„æ“ä½œä¹Ÿæ˜¯æŒ‰ç…§RDDä¸ºå•ä½æ¥è¿›è¡Œçš„ è®¡ç®—è¿‡ç¨‹ç”±Spark engineæ¥å®Œæˆ DStream ç›¸å…³æ“ä½œDStreamä¸Šçš„åŸè¯­ä¸RDDçš„ç±»ä¼¼ï¼Œåˆ†ä¸ºTransformationsï¼ˆè½¬æ¢ï¼‰å’ŒOutput Operationsï¼ˆè¾“å‡ºï¼‰ä¸¤ç§ï¼Œæ­¤å¤–è½¬æ¢æ“ä½œä¸­è¿˜æœ‰ä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„åŸè¯­ï¼Œå¦‚ï¼šupdateStateByKey()ã€transform()ä»¥åŠå„ç§Windowç›¸å…³çš„åŸè¯­ã€‚ Transformations on DStreams Transformation Meaning map(func) Return a new DStream by passing each element of the source DStream through a function func. flatMap(func) Similar to map, but each input item can be mapped to 0 or more output items. filter(func) Return a new DStream by selecting only the records of the source DStream on which func returns true. repartition(numPartitions) Changes the level of parallelism in this DStream by creating more or fewer partitions. union(otherStream) Return a new DStream that contains the union of the elements in the source DStream and otherDStream. count() Return a new DStream of single-element RDDs by counting the number of elements in each RDD of the source DStream. reduce(func) Return a new DStream of single-element RDDs by aggregating the elements in each RDD of the source DStream using a function func (which takes two arguments and returns one). The function should be associative so that it can be computed in parallel. countByValue() When called on a DStream of elements of type K, return a new DStream of (K, Long) pairs where the value of each key is its frequency in each RDD of the source DStream. reduceByKey(func, [numTasks]) When called on a DStream of (K, V) pairs, return a new DStream of (K, V) pairs where the values for each key are aggregated using the given reduce function. Note: By default, this uses Sparkâ€™s default number of parallel tasks (2 for local mode, and in cluster mode the number is determined by the config property spark.default.parallelism) to do the grouping. You can pass an optional numTasks argument to set a different number of tasks. join(otherStream, [numTasks]) When called on two DStreams of (K, V) and (K, W) pairs, return a new DStream of (K, (V, W)) pairs with all pairs of elements for each key. cogroup(otherStream, [numTasks]) When called on a DStream of (K, V) and (K, W) pairs, return a new DStream of (K, Seq[V], Seq[W]) tuples. transform(func) Return a new DStream by applying a RDD-to-RDD function to every RDD of the source DStream. This can be used to do arbitrary RDD operations on the DStream. updateStateByKey(func) Return a new â€œstateâ€ DStream where the state for each key is updated by applying the given function on the previous state of the key and the new values for the key. This can be used to maintain arbitrary state data for each key. ç‰¹æ®Šçš„ Transformations UpdateStateByKey Operation UpdateStateByKeyåŸè¯­ç”¨äºè®°å½•å†å²è®°å½•ï¼Œä¸Šæ–‡ä¸­Word Countç¤ºä¾‹ä¸­å°±ç”¨åˆ°äº†è¯¥ç‰¹æ€§ã€‚è‹¥ä¸ç”¨UpdateStateByKeyæ¥æ›´æ–°çŠ¶æ€ï¼Œé‚£ä¹ˆæ¯æ¬¡æ•°æ®è¿›æ¥ååˆ†æå®Œæˆåï¼Œç»“æœè¾“å‡ºåå°†ä¸åœ¨ä¿å­˜ Transform Operation TransformåŸè¯­å…è®¸DStreamä¸Šæ‰§è¡Œä»»æ„çš„RDD-to-RDDå‡½æ•°ã€‚é€šè¿‡è¯¥å‡½æ•°å¯ä»¥æ–¹ä¾¿çš„æ‰©å±•Spark APIã€‚æ­¤å¤–ï¼ŒMLlibï¼ˆæœºå™¨å­¦ä¹ ï¼‰ä»¥åŠGraphxä¹Ÿæ˜¯é€šè¿‡æœ¬å‡½æ•°æ¥è¿›è¡Œç»“åˆçš„ã€‚ Window Operations Window Operationsæœ‰ç‚¹ç±»ä¼¼äºStormä¸­çš„Stateï¼Œå¯ä»¥è®¾ç½®çª—å£çš„å¤§å°å’Œæ»‘åŠ¨çª—å£çš„é—´éš”æ¥åŠ¨æ€çš„è·å–å½“å‰Steamingçš„å…è®¸çŠ¶æ€ Output Operations on DStreamsOutput Operationså¯ä»¥å°†DStreamçš„æ•°æ®è¾“å‡ºåˆ°å¤–éƒ¨çš„æ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿï¼Œå½“æŸä¸ªOutput OperationsåŸè¯­è¢«è°ƒç”¨æ—¶ï¼ˆä¸RDDçš„Actionç›¸åŒï¼‰ï¼Œstreamingç¨‹åºæ‰ä¼šå¼€å§‹çœŸæ­£çš„è®¡ç®—è¿‡ç¨‹ã€‚ Output Operation Meaning print() Prints the first ten elements of every batch of data in a DStream on the driver node running the streaming application. This is useful for development and debugging. saveAsTextFiles(prefix, [suffix]) Save this DStreamâ€™s contents as text files. The file name at each batch interval is generated based on prefix and suffix: â€œprefix-TIME_IN_MS[.suffix]â€. saveAsObjectFiles(prefix, [suffix]) Save this DStreamâ€™s contents as SequenceFiles of serialized Java objects. The file name at each batch interval is generated based on prefix and suffix: â€œprefix-TIME_IN_MS[.suffix]â€. saveAsHadoopFiles(prefix, [suffix]) Save this DStreamâ€™s contents as Hadoop files. The file name at each batch interval is generated based on prefix and suffix: â€œprefix-TIME_IN_MS[.suffix]â€. foreachRDD(func) The most generic output operator that applies a function, func, to each RDD generated from the stream. This function should push the data in each RDD to an external system, such as saving the RDD to files, or writing it over the network to a database. Note that the function func is executed in the driver process running the streaming application, and will usually have RDD actions in it that will force the computation of the streaming RDDs. Spark Streaming å®æˆ˜å®ç° word count å¯åŠ¨ç”Ÿäº§è€…æœåŠ¡(socket æœåŠ¡ä¸ºä¾‹) é¦–å…ˆåœ¨ä¸€å°Linuxï¼ˆipï¼š192.168.10.101ï¼‰ä¸Šç”¨YUMå®‰è£…ncå·¥å…· yum install -y nc å¯åŠ¨ä¸€ä¸ªæœåŠ¡ç«¯å¹¶ç›‘å¬9999ç«¯å£ nc -lk 9999 ç¼–å†™Spark Streamingç¨‹åº 12345678910111213141516171819202122232425262728293031package cn.itcast.spark.streamingimport cn.itcast.spark.util.LoggerLevelimport org.apache.spark.SparkConfimport org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;object NetworkWordCount &#123; def main(args: Array[String]) &#123; //è®¾ç½®æ—¥å¿—çº§åˆ« LoggerLevel.setStreamingLogLevels() //åˆ›å»ºSparkConfå¹¶è®¾ç½®ä¸ºæœ¬åœ°æ¨¡å¼è¿è¡Œ //æ³¨æ„local[2]ä»£è¡¨å¼€ä¸¤ä¸ªçº¿ç¨‹ val conf = new SparkConf().setMaster("local[2]").setAppName("NetworkWordCount") //è®¾ç½®DStreamæ‰¹æ¬¡æ—¶é—´é—´éš”ä¸º2ç§’ val ssc = new StreamingContext(conf, Seconds(2)) //é€šè¿‡ç½‘ç»œè¯»å–æ•°æ® val lines = ssc.socketTextStream("192.168.10.101", 9999) //å°†è¯»åˆ°çš„æ•°æ®ç”¨ç©ºæ ¼åˆ‡æˆå•è¯ val words = lines.flatMap(_.split(" ")) //å°†å•è¯å’Œ1ç»„æˆä¸€ä¸ªpair val pairs = words.map(word =&gt; (word, 1)) //æŒ‰å•è¯è¿›è¡Œåˆ†ç»„æ±‚ç›¸åŒå•è¯å‡ºç°çš„æ¬¡æ•° val wordCounts = pairs.reduceByKey(_ + _) //æ‰“å°ç»“æœåˆ°æ§åˆ¶å° wordCounts.print() //å¼€å§‹è®¡ç®— ssc.start() //ç­‰å¾…åœæ­¢ ssc.awaitTermination() &#125;&#125; å¯åŠ¨Spark Streaming ç”±äºä½¿ç”¨çš„æ˜¯æœ¬åœ°æ¨¡å¼â€œlocal[2]â€æ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨æœ¬åœ°è¿è¡Œè¯¥ç¨‹åº æ³¨æ„ï¼šè¦æŒ‡å®šå¹¶è¡Œåº¦ï¼Œå¦‚åœ¨æœ¬åœ°è¿è¡Œè®¾ç½®setMaster(â€œlocal[2]â€)ï¼Œç›¸å½“äºå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªç»™receiverï¼Œä¸€ä¸ªç»™computerã€‚å¦‚æœæ˜¯åœ¨é›†ç¾¤ä¸­è¿è¡Œï¼Œå¿…é¡»è¦æ±‚é›†ç¾¤ä¸­å¯ç”¨coreæ•°å¤§äº1 å¼€å§‹ç”Ÿäº§ åœ¨Linux ncç”Ÿäº§è€…ç«¯å‘½ä»¤è¡Œä¸­è¾“å…¥å•è¯ æŸ¥çœ‹åˆ°sparkçš„æµå¤„ç†è¾“å‡º é—®é¢˜ï¼šç»“æœæ¯æ¬¡åœ¨Linuxæ®µè¾“å…¥çš„å•è¯æ¬¡æ•°éƒ½è¢«æ­£ç¡®çš„ç»Ÿè®¡å‡ºæ¥ï¼Œä½†æ˜¯ç»“æœä¸èƒ½ç´¯åŠ ï¼å¦‚æœéœ€è¦ç´¯åŠ éœ€è¦ä½¿ç”¨updateStateByKey(func)æ¥æ›´æ–°çŠ¶æ€ï¼Œä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­ å®ç°Spark Streaming ç´¯åŠ 123456789101112131415161718192021222324252627282930313233package cn.itcast.spark.streamingimport cn.itcast.spark.util.LoggerLevelimport org.apache.spark.&#123;HashPartitioner, SparkConf&#125;import org.apache.spark.streaming.&#123;StreamingContext, Seconds&#125;object NetworkUpdateStateWordCount &#123; /** * String : å•è¯ hello * Seq[Int] ï¼šå•è¯åœ¨å½“å‰æ‰¹æ¬¡å‡ºç°çš„æ¬¡æ•° * Option[Int] ï¼š å†å²ç»“æœ */ val updateFunc = (iter: Iterator[(String, Seq[Int], Option[Int])]) =&gt; &#123; //iter.flatMap(it=&gt;Some(it._2.sum + it._3.getOrElse(0)).map(x=&gt;(it._1,x))) iter.flatMap&#123;case(x,y,z)=&gt;Some(y.sum + z.getOrElse(0)).map(m=&gt;(x, m))&#125; &#125; def main(args: Array[String]) &#123; LoggerLevel.setStreamingLogLevels() val conf = new SparkConf().setMaster("local[2]").setAppName("NetworkUpdateStateWordCount") val ssc = new StreamingContext(conf, Seconds(5)) //åšcheckpoint å†™å…¥å…±äº«å­˜å‚¨ä¸­ ssc.checkpoint("c://aaa") val lines = ssc.socketTextStream("192.168.10.100", 9999) //reduceByKey ç»“æœä¸ç´¯åŠ  //val result = lines.flatMap(_.split(" ")).map((_, 1)).reduceByKey(_+_) //updateStateByKeyç»“æœå¯ä»¥ç´¯åŠ ä½†æ˜¯éœ€è¦ä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„ç´¯åŠ å‡½æ•°ï¼šupdateFunc val results = lines.flatMap(_.split(" ")).map((_,1)).updateStateByKey(updateFunc, new HashPartitioner(ssc.sparkContext.defaultParallelism), true) results.print() ssc.start() ssc.awaitTermination() &#125;&#125; Spark Streaming ç»“åˆKafkaç¤ºä¾‹ å®‰è£…å¹¶é…ç½®zk å®‰è£…å¹¶é…ç½®Kafka å¯åŠ¨zk å¯åŠ¨Kafka åˆ›å»ºtopic 1bin/kafka-topics.sh --create --zookeeper node1.itcast.cn:2181,node2.itcast.cn:2181 --replication-factor 3 --partitions 3 --topic urlcount ç¼–å†™Spark Streaming ç¨‹åº 12345678910111213141516171819202122232425262728293031323334353637package cn.itcast.spark.streamingpackage cn.itcast.sparkimport org.apache.spark.&#123;HashPartitioner, SparkConf&#125;import org.apache.spark.storage.StorageLevelimport org.apache.spark.streaming.kafka.KafkaUtilsimport org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;object UrlCount &#123; val updateFunc = (iterator: Iterator[(String, Seq[Int], Option[Int])]) =&gt; &#123; iterator.flatMap&#123;case(x,y,z)=&gt; Some(y.sum + z.getOrElse(0)).map(n=&gt;(x, n))&#125; &#125; def main(args: Array[String]) &#123; //æ¥æ”¶å‘½ä»¤è¡Œä¸­çš„å‚æ•° val Array(zkQuorum, groupId, topics, numThreads, hdfs) = args //åˆ›å»ºSparkConfå¹¶è®¾ç½®AppName val conf = new SparkConf().setAppName("UrlCount") //åˆ›å»ºStreamingContext val ssc = new StreamingContext(conf, Seconds(2)) //è®¾ç½®æ£€æŸ¥ç‚¹ ssc.checkpoint(hdfs) //è®¾ç½®topicä¿¡æ¯ val topicMap = topics.split(",").map((_, numThreads.toInt)).toMap //é‡Kafkaä¸­æ‹‰å–æ•°æ®åˆ›å»ºDStream val lines = KafkaUtils.createStream(ssc, zkQuorum ,groupId, topicMap, StorageLevel.MEMORY_AND_DISK).map(_._2) //åˆ‡åˆ†æ•°æ®ï¼Œæˆªå–ç”¨æˆ·ç‚¹å‡»çš„url val urls = lines.map(x=&gt;(x.split(" ")(6), 1)) //ç»Ÿè®¡URLç‚¹å‡»é‡ val result = urls.updateStateByKey(updateFunc, new HashPartitioner(ssc.sparkContext.defaultParallelism), true) //å°†ç»“æœæ‰“å°åˆ°æ§åˆ¶å° result.print() ssc.start() ssc.awaitTermination() &#125;&#125; æäº¤ä»»åŠ¡å¹¶æ‰§è¡Œ]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Spark</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kafka æ‹“å±•]]></title>
    <url>%2F2020%2F03%2F15%2F10.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%2FKafka%2FKafka%20%E6%8B%93%E5%B1%95%2F</url>
    <content type="text"><![CDATA[Kafka ä»‹ç»ä»€ä¹ˆæ˜¯Kafkaåœ¨æµå¼è®¡ç®—ä¸­ï¼ŒKafkaä¸€èˆ¬ç”¨æ¥ç¼“å­˜æ•°æ®ï¼ŒStormé€šè¿‡æ¶ˆè´¹Kafkaçš„æ•°æ®è¿›è¡Œè®¡ç®—ã€‚ KAFKA + STORM +REDIS Apache Kafkaæ˜¯ä¸€ä¸ªå¼€æºæ¶ˆæ¯ç³»ç»Ÿï¼Œç”±Scalaå†™æˆã€‚æ˜¯ç”±Apacheè½¯ä»¶åŸºé‡‘ä¼šå¼€å‘çš„ä¸€ä¸ªå¼€æºæ¶ˆæ¯ç³»ç»Ÿé¡¹ç›®ã€‚ Kafkaæœ€åˆæ˜¯ç”±LinkedInå¼€å‘ï¼Œå¹¶äº2011å¹´åˆå¼€æºã€‚2012å¹´10æœˆä»Apache Incubatoræ¯•ä¸šã€‚è¯¥é¡¹ç›®çš„ç›®æ ‡æ˜¯ä¸ºå¤„ç†å®æ—¶æ•°æ®æä¾›ä¸€ä¸ªç»Ÿä¸€ã€é«˜é€šé‡ã€ä½ç­‰å¾…çš„å¹³å°ã€‚ Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼šç”Ÿäº§è€…ã€æ¶ˆè´¹è€…çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ç±»ä¼¼äºJMSçš„ç‰¹æ€§ï¼Œä½†æ˜¯åœ¨è®¾è®¡å®ç°ä¸Šå®Œå…¨ä¸åŒï¼Œæ­¤å¤–å®ƒå¹¶ä¸æ˜¯JMSè§„èŒƒçš„å®ç°ã€‚ Kafkaå¯¹æ¶ˆæ¯ä¿å­˜æ—¶æ ¹æ®Topicè¿›è¡Œå½’ç±»ï¼Œå‘é€æ¶ˆæ¯è€…ç§°ä¸ºProducer,æ¶ˆæ¯æ¥å—è€…ç§°ä¸ºConsumer,æ­¤å¤–kafkaé›†ç¾¤æœ‰å¤šä¸ªkafkaå®ä¾‹ç»„æˆï¼Œæ¯ä¸ªå®ä¾‹(server)æˆä¸ºbrokerã€‚ æ— è®ºæ˜¯kafkaé›†ç¾¤ï¼Œè¿˜æ˜¯producerå’Œconsumeréƒ½ä¾èµ–äºzookeeperé›†ç¾¤ä¿å­˜ä¸€äº›metaä¿¡æ¯ï¼Œæ¥ä¿è¯ç³»ç»Ÿå¯ç”¨æ€§ ä»€ä¹ˆæ˜¯JMSJMSæ˜¯ä»€ä¹ˆï¼šJMSæ˜¯Javaæä¾›çš„ä¸€å¥—æŠ€æœ¯è§„èŒƒ JMSå¹²ä»€ä¹ˆç”¨ï¼šç”¨æ¥å¼‚æ„ç³»ç»Ÿ é›†æˆé€šä¿¡ï¼Œç¼“è§£ç³»ç»Ÿç“¶é¢ˆï¼Œæé«˜ç³»ç»Ÿçš„ä¼¸ç¼©æ€§å¢å¼ºç³»ç»Ÿç”¨æˆ·ä½“éªŒï¼Œä½¿å¾—ç³»ç»Ÿæ¨¡å—åŒ–å’Œç»„ä»¶åŒ–å˜å¾—å¯è¡Œå¹¶æ›´åŠ çµæ´» é€šè¿‡ä»€ä¹ˆæ–¹å¼ï¼šç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å¼ï¼ˆç”Ÿäº§è€…ã€æœåŠ¡å™¨ã€æ¶ˆè´¹è€…ï¼‰ ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼ˆä¸€å¯¹ä¸€ï¼Œæ¶ˆè´¹è€…ä¸»åŠ¨æ‹‰å–æ•°æ®ï¼Œæ¶ˆæ¯æ”¶åˆ°åæ¶ˆæ¯æ¸…é™¤ï¼‰ ç‚¹å¯¹ç‚¹æ¨¡å‹é€šå¸¸æ˜¯ä¸€ä¸ªåŸºäºæ‹‰å–æˆ–è€…è½®è¯¢çš„æ¶ˆæ¯ä¼ é€æ¨¡å‹ï¼Œè¿™ç§æ¨¡å‹ä»é˜Ÿåˆ—ä¸­è¯·æ±‚ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å°†æ¶ˆæ¯æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚è¿™ä¸ªæ¨¡å‹çš„ç‰¹ç‚¹æ˜¯å‘é€åˆ°é˜Ÿåˆ—çš„æ¶ˆæ¯*ä¸€ä¸ªä¸”åªæœ‰ä¸€ä¸ªæ¥æ”¶è€…æ¥æ”¶å¤„ç†ï¼Œå³ä½¿æœ‰å¤šä¸ªæ¶ˆæ¯ç›‘å¬è€…ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼ˆä¸€å¯¹å¤šï¼Œæ•°æ®ç”Ÿäº§åï¼Œæ¨é€ç»™æ‰€æœ‰è®¢é˜…è€…ï¼‰ å‘å¸ƒè®¢é˜…æ¨¡å‹åˆ™æ˜¯ä¸€ä¸ªåŸºäºæ¨é€çš„æ¶ˆæ¯ä¼ é€æ¨¡å‹ã€‚å‘å¸ƒè®¢é˜…æ¨¡å‹å¯ä»¥æœ‰å¤šç§ä¸åŒçš„è®¢é˜…è€…ï¼Œä¸´æ—¶è®¢é˜…è€…åªåœ¨ä¸»åŠ¨ç›‘å¬ä¸»é¢˜æ—¶æ‰æ¥æ”¶æ¶ˆæ¯ï¼Œè€ŒæŒä¹…è®¢é˜…è€…åˆ™ç›‘å¬ä¸»é¢˜çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œå³æ—¶å½“å‰è®¢é˜…è€…ä¸å¯ç”¨ï¼Œå¤„äºç¦»çº¿çŠ¶æ€ã€‚ 12queue.putï¼ˆobjectï¼‰ æ•°æ®ç”Ÿäº§queue.take(object) æ•°æ®æ¶ˆè´¹ JMS æ ¸å¿ƒç»„ä»¶ Destinationï¼šæ¶ˆæ¯å‘é€çš„ç›®çš„åœ°ï¼Œä¹Ÿå°±æ˜¯å‰é¢è¯´çš„Queueå’ŒTopicã€‚ Message ï¼šä»å­—é¢ä¸Šå°±å¯ä»¥çœ‹å‡ºæ˜¯è¢«å‘é€çš„æ¶ˆæ¯ã€‚ Producerï¼š æ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼Œè¦å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¿…é¡»é€šè¿‡è¿™ä¸ªç”Ÿäº§è€…æ¥å‘é€ã€‚ MessageConsumerï¼š ä¸ç”Ÿäº§è€…ç›¸å¯¹åº”ï¼Œè¿™æ˜¯æ¶ˆæ¯çš„æ¶ˆè´¹è€…æˆ–æ¥æ”¶è€…ï¼Œé€šè¿‡å®ƒæ¥æ¥æ”¶ä¸€ä¸ªæ¶ˆæ¯ã€‚ ä¸ºä»€ä¹ˆéœ€è¦JMSç»„ä»¶ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰æ¶ˆæ¯ç³»ç»Ÿçš„æ ¸å¿ƒä½œç”¨å°±æ˜¯ä¸‰ç‚¹ï¼šè§£è€¦ï¼Œå¼‚æ­¥å’Œå¹¶è¡Œ ä»¥ç”¨æˆ·æ³¨å†Œçš„æ¡ˆåˆ—æ¥è¯´æ˜æ¶ˆæ¯ç³»ç»Ÿçš„ä½œç”¨ Kafka æ ¸å¿ƒç»„ä»¶ Topic ï¼šæ¶ˆæ¯æ ¹æ®Topicè¿›è¡Œå½’ç±» Producerï¼šå‘é€æ¶ˆæ¯è€… Consumerï¼šæ¶ˆæ¯æ¥å—è€… brokerï¼šæ¯ä¸ªkafkaå®ä¾‹(server) Zookeeperï¼šä¾èµ–é›†ç¾¤ä¿å­˜metaä¿¡æ¯ã€‚ Kafka éƒ¨ç½²æ­¥éª¤ ä¸‹è½½å®‰è£…åŒ… http://kafka.apache.org/downloads.html åœ¨linuxä¸­ä½¿ç”¨wgetå‘½ä»¤ä¸‹è½½å®‰è£…åŒ… wget http://mirrors.hust.edu.cn/apache/kafka/0.8.2.2/kafka_2.11-0.8.2.2.tgz è§£å‹å®‰è£…åŒ… tar -zxvf /export/software/kafka_2.11-0.8.2.2.tgz -C /export/servers/ cd /export/servers/ ln -s kafka_2.11-0.8.2.2 kafka ä¿®æ”¹é…ç½®æ–‡ä»¶ cp /export/servers/kafka/config/server.properties /export/servers/kafka/config/server.properties.bak vi /export/servers/kafka/config/server.properties è¾“å…¥ä»¥ä¸‹å†…å®¹ åˆ†å‘å®‰è£…åŒ… scp -r /export/servers/kafka_2.11-0.8.2.2 kafka02:/export/servers ç„¶ååˆ†åˆ«åœ¨å„æœºå™¨ä¸Šåˆ›å»ºè½¯è¿ cd /export/servers/ ln -s kafka_2.11-0.8.2.2 kafka å†æ¬¡ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆé‡è¦ï¼‰ ä¾æ¬¡ä¿®æ”¹å„æœåŠ¡å™¨ä¸Šé…ç½®æ–‡ä»¶çš„çš„broker.idï¼Œåˆ†åˆ«æ˜¯0,1,2ä¸å¾—é‡å¤ã€‚ å¯åŠ¨é›†ç¾¤ ä¾æ¬¡åœ¨å„èŠ‚ç‚¹ä¸Šå¯åŠ¨kafka bin/kafka-server-start.sh config/server.properties kafkaé›†ç¾¤å‘½ä»¤ æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰topic 1bin/kafka-topics.sh --list --zookeeper zk01:2181 åˆ›å»ºtopic 1./kafka-topics.sh --create --zookeeper mini1:2181 --replication-factor 1 --partitions 3 --topic first åˆ é™¤topic 1sh bin/kafka-topics.sh --delete --zookeeper zk01:2181 --topic test éœ€è¦server.propertiesä¸­è®¾ç½®delete.topic.enable=trueå¦åˆ™åªæ˜¯æ ‡è®°åˆ é™¤æˆ–è€…ç›´æ¥é‡å¯ã€‚ é€šè¿‡shellå‘½ä»¤å‘é€æ¶ˆæ¯ 1kafka-console-producer.sh --broker-list kafka01:9092 --topic itheima é€šè¿‡shellæ¶ˆè´¹æ¶ˆæ¯ 1sh bin/kafka-console-consumer.sh --zookeeper zk01:2181 --from-beginning --topic test1 æŸ¥çœ‹æ¶ˆè´¹ä½ç½® 1sh kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper zk01:2181 --group testGroup æŸ¥çœ‹æŸä¸ªTopicçš„è¯¦æƒ… 1sh kafka-topics.sh --topic test --describe --zookeeper zk01:2181 Kafka java api ç”Ÿäº§è€…ç›¸å…³api æ¶ˆè´¹è€…ç›¸å…³api Kafka æ¶æ„ä»‹ç»Kafka æ•´ä½“ç»“æ„ä»‹ç» Producer ï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå°±æ˜¯å‘kafka brokerå‘æ¶ˆæ¯çš„å®¢æˆ·ç«¯ã€‚ Consumer ï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå‘kafka brokerå–æ¶ˆæ¯çš„å®¢æˆ·ç«¯ Topic ï¼šå’‹ä»¬å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé˜Ÿåˆ—ã€‚ Consumer Group ï¼ˆCGï¼‰ï¼šè¿™æ˜¯kafkaç”¨æ¥å®ç°ä¸€ä¸ªtopicæ¶ˆæ¯çš„å¹¿æ’­ï¼ˆå‘ç»™æ‰€æœ‰çš„consumerï¼‰å’Œå•æ’­ï¼ˆå‘ç»™ä»»æ„ä¸€ä¸ªconsumerï¼‰çš„æ‰‹æ®µã€‚ä¸€ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªCGã€‚topicçš„æ¶ˆæ¯ä¼šå¤åˆ¶ï¼ˆä¸æ˜¯çœŸçš„å¤åˆ¶ï¼Œæ˜¯æ¦‚å¿µä¸Šçš„ï¼‰åˆ°æ‰€æœ‰çš„CGï¼Œä½†æ¯ä¸ªpartionåªä¼šæŠŠæ¶ˆæ¯å‘ç»™è¯¥CGä¸­çš„ä¸€ä¸ªconsumerã€‚å¦‚æœéœ€è¦å®ç°å¹¿æ’­ï¼Œåªè¦æ¯ä¸ªconsumeræœ‰ä¸€ä¸ªç‹¬ç«‹çš„CGå°±å¯ä»¥äº†ã€‚è¦å®ç°å•æ’­åªè¦æ‰€æœ‰çš„consumeråœ¨åŒä¸€ä¸ªCGã€‚ç”¨CGè¿˜å¯ä»¥å°†consumerè¿›è¡Œè‡ªç”±çš„åˆ†ç»„è€Œä¸éœ€è¦å¤šæ¬¡å‘é€æ¶ˆæ¯åˆ°ä¸åŒçš„topicã€‚ Broker ï¼šä¸€å°kafkaæœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ªbrokerã€‚ä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªbrokerç»„æˆã€‚ä¸€ä¸ªbrokerå¯ä»¥å®¹çº³å¤šä¸ªtopicã€‚ Partitionï¼šä¸ºäº†å®ç°æ‰©å±•æ€§ï¼Œä¸€ä¸ªéå¸¸å¤§çš„topicå¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ªbrokerï¼ˆå³æœåŠ¡å™¨ï¼‰ä¸Šï¼Œä¸€ä¸ªtopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªpartitionï¼Œæ¯ä¸ªpartitionæ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ã€‚partitionä¸­çš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„idï¼ˆoffsetï¼‰ã€‚kafkaåªä¿è¯æŒ‰ä¸€ä¸ªpartitionä¸­çš„é¡ºåºå°†æ¶ˆæ¯å‘ç»™consumerï¼Œä¸ä¿è¯ä¸€ä¸ªtopicçš„æ•´ä½“ï¼ˆå¤šä¸ªpartitioné—´ï¼‰çš„é¡ºåºã€‚ Offsetï¼škafkaçš„å­˜å‚¨æ–‡ä»¶éƒ½æ˜¯æŒ‰ç…§offset.kafkaæ¥å‘½åï¼Œç”¨offsetåšåå­—çš„å¥½å¤„æ˜¯æ–¹ä¾¿æŸ¥æ‰¾ã€‚ä¾‹å¦‚ä½ æƒ³æ‰¾ä½äº2049çš„ä½ç½®ï¼Œåªè¦æ‰¾åˆ°2048.kafkaçš„æ–‡ä»¶å³å¯ã€‚å½“ç„¶the first offsetå°±æ˜¯00000000000.kafka Consumer ä¸topic çš„å…³ç³»æœ¬è´¨ä¸Škafkaåªæ”¯æŒTopicï¼› æ¯ä¸ªgroupä¸­å¯ä»¥æœ‰å¤šä¸ªconsumerï¼Œæ¯ä¸ªconsumerå±äºä¸€ä¸ªconsumer groupï¼› é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªgroupä¸­ä¼šåŒ…å«å¤šä¸ªconsumerï¼Œè¿™æ ·ä¸ä»…å¯ä»¥æé«˜topicä¸­æ¶ˆæ¯çš„å¹¶å‘æ¶ˆè´¹èƒ½åŠ›ï¼Œè€Œä¸”è¿˜èƒ½æé«˜â€æ•…éšœå®¹é”™â€æ€§ï¼Œå¦‚æœgroupä¸­çš„æŸä¸ªconsumerå¤±æ•ˆé‚£ä¹ˆå…¶æ¶ˆè´¹çš„partitionså°†ä¼šæœ‰å…¶ä»–consumerè‡ªåŠ¨æ¥ç®¡ã€‚ å¯¹äºTopicä¸­çš„ä¸€æ¡ç‰¹å®šçš„æ¶ˆæ¯ï¼Œåªä¼šè¢«è®¢é˜…æ­¤Topicçš„æ¯ä¸ªgroupä¸­çš„å…¶ä¸­ä¸€ä¸ªconsumeræ¶ˆè´¹ï¼Œæ­¤æ¶ˆæ¯ä¸ä¼šå‘é€ç»™ä¸€ä¸ªgroupçš„å¤šä¸ªconsumerï¼› é‚£ä¹ˆä¸€ä¸ªgroupä¸­æ‰€æœ‰çš„consumerå°†ä¼šäº¤é”™çš„æ¶ˆè´¹æ•´ä¸ªTopicï¼Œæ¯ä¸ªgroupä¸­consumeræ¶ˆæ¯æ¶ˆè´¹äº’ç›¸ç‹¬ç«‹ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºä¸€ä¸ªgroupæ˜¯ä¸€ä¸ªâ€è®¢é˜…â€è€…ã€‚ åœ¨kafkaä¸­,ä¸€ä¸ªpartitionä¸­çš„æ¶ˆæ¯åªä¼šè¢«groupä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹(åŒä¸€æ—¶åˆ»)ï¼› ä¸€ä¸ªTopicä¸­çš„æ¯ä¸ªpartionsï¼Œåªä¼šè¢«ä¸€ä¸ªâ€è®¢é˜…è€…â€ä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹ï¼Œä¸è¿‡ä¸€ä¸ªconsumerå¯ä»¥åŒæ—¶æ¶ˆè´¹å¤šä¸ªpartitionsä¸­çš„æ¶ˆæ¯ã€‚ kafkaçš„è®¾è®¡åŸç†å†³å®š,å¯¹äºä¸€ä¸ªtopicï¼ŒåŒä¸€ä¸ªgroupä¸­ä¸èƒ½æœ‰å¤šäºpartitionsä¸ªæ•°çš„consumeråŒæ—¶æ¶ˆè´¹ï¼Œå¦åˆ™å°†æ„å‘³ç€æŸäº›consumerå°†æ— æ³•å¾—åˆ°æ¶ˆæ¯ã€‚ kafkaåªèƒ½ä¿è¯ä¸€ä¸ªpartitionä¸­çš„æ¶ˆæ¯è¢«æŸä¸ªconsumeræ¶ˆè´¹æ—¶æ˜¯é¡ºåºçš„ï¼›äº‹å®ä¸Šï¼Œä»Topicè§’åº¦æ¥è¯´,å½“æœ‰å¤šä¸ªpartitionsæ—¶,æ¶ˆæ¯ä»ä¸æ˜¯å…¨å±€æœ‰åºçš„ã€‚ Kafka æ¶ˆæ¯åˆ†å‘Producerå®¢æˆ·ç«¯è´Ÿè´£æ¶ˆæ¯çš„åˆ†å‘ kafkaé›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªbrokeréƒ½å¯ä»¥å‘produceræä¾›metadataä¿¡æ¯,è¿™äº›metadataä¸­åŒ…å«â€é›†ç¾¤ä¸­å­˜æ´»çš„serversåˆ—è¡¨â€/â€œpartitions leaderåˆ—è¡¨â€ç­‰ä¿¡æ¯ï¼› å½“producerè·å–åˆ°metadataä¿¡æ¯ä¹‹å, producerå°†ä¼šå’ŒTopicä¸‹æ‰€æœ‰partition leaderä¿æŒsocketè¿æ¥ï¼› æ¶ˆæ¯ç”±producerç›´æ¥é€šè¿‡socketå‘é€åˆ°brokerï¼Œä¸­é—´ä¸ä¼šç»è¿‡ä»»ä½•â€è·¯ç”±å±‚â€ï¼Œäº‹å®ä¸Šï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°å“ªä¸ªpartitionä¸Šç”±producerå®¢æˆ·ç«¯å†³å®šï¼› æ¯”å¦‚å¯ä»¥é‡‡ç”¨â€randomâ€â€key-hashâ€â€è½®è¯¢â€ç­‰,å¦‚æœä¸€ä¸ªtopicä¸­æœ‰å¤šä¸ªpartitions,é‚£ä¹ˆåœ¨producerç«¯å®ç°â€æ¶ˆæ¯å‡è¡¡åˆ†å‘â€æ˜¯å¿…è¦çš„ã€‚ åœ¨producerç«¯çš„é…ç½®æ–‡ä»¶ä¸­,å¼€å‘è€…å¯ä»¥æŒ‡å®špartitionè·¯ç”±çš„æ–¹å¼ã€‚ Produceræ¶ˆæ¯å‘é€çš„åº”ç­”æœºåˆ¶ è®¾ç½®å‘é€æ•°æ®æ˜¯å¦éœ€è¦æœåŠ¡ç«¯çš„åé¦ˆ,æœ‰ä¸‰ä¸ªå€¼0,1,-1 0: producerä¸ä¼šç­‰å¾…brokerå‘é€ack 1: å½“leaderæ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åå‘é€ack -1: å½“æ‰€æœ‰çš„followeréƒ½åŒæ­¥æ¶ˆæ¯æˆåŠŸåå‘é€ack 1request.required.acks=0 Kafka æ¶ˆè´¹è´Ÿè½½å‡è¡¡å½“ä¸€ä¸ªgroupä¸­,æœ‰consumeråŠ å…¥æˆ–è€…ç¦»å¼€æ—¶,ä¼šè§¦å‘partitionså‡è¡¡.å‡è¡¡çš„æœ€ç»ˆç›®çš„,æ˜¯æå‡topicçš„å¹¶å‘æ¶ˆè´¹èƒ½åŠ›ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š 1ã€ å‡å¦‚topic1,å…·æœ‰å¦‚ä¸‹partitions: P0,P1,P2,P3 2ã€ åŠ å…¥groupä¸­,æœ‰å¦‚ä¸‹consumer: C1,C2 3ã€ é¦–å…ˆæ ¹æ®partitionç´¢å¼•å·å¯¹partitionsæ’åº: P0,P1,P2,P3 4ã€ æ ¹æ®consumer.idæ’åº: C0,C1 5ã€ è®¡ç®—å€æ•°: M = [P0,P1,P2,P3].size / [C0,C1].size,æœ¬ä¾‹å€¼M=2(å‘ä¸Šå–æ•´) 6ã€ ç„¶åä¾æ¬¡åˆ†é…partitions: C0 = [P0,P1],C1=[P2,P3],å³Ci = [P(i * M),P((i + 1) * M -1)] Kafka æ–‡ä»¶å­˜å‚¨æœºåˆ¶Kafka æ–‡ä»¶å­˜å‚¨åŸºæœ¬ç»“æ„ åœ¨Kafkaæ–‡ä»¶å­˜å‚¨ä¸­ï¼ŒåŒä¸€ä¸ªtopicä¸‹æœ‰å¤šä¸ªä¸åŒpartitionï¼Œæ¯ä¸ªpartitionä¸ºä¸€ä¸ªç›®å½•ï¼Œpartitonå‘½åè§„åˆ™ä¸ºtopicåç§°+æœ‰åºåºå·ï¼Œç¬¬ä¸€ä¸ªpartitonåºå·ä»0å¼€å§‹ï¼Œåºå·æœ€å¤§å€¼ä¸ºpartitionsæ•°é‡å‡1ã€‚ æ¯ä¸ªpartion(ç›®å½•)ç›¸å½“äºä¸€ä¸ªå·¨å‹æ–‡ä»¶è¢«å¹³å‡åˆ†é…åˆ°å¤šä¸ªå¤§å°ç›¸ç­‰segment(æ®µ)æ•°æ®æ–‡ä»¶ä¸­ã€‚ä½†æ¯ä¸ªæ®µsegment fileæ¶ˆæ¯æ•°é‡ä¸ä¸€å®šç›¸ç­‰ï¼Œè¿™ç§ç‰¹æ€§æ–¹ä¾¿old segment fileå¿«é€Ÿè¢«åˆ é™¤ã€‚é»˜è®¤ä¿ç•™7å¤©çš„æ•°æ®ã€‚ æ¯ä¸ªpartitonåªéœ€è¦æ”¯æŒé¡ºåºè¯»å†™å°±è¡Œäº†ï¼Œsegmentæ–‡ä»¶ç”Ÿå‘½å‘¨æœŸç”±æœåŠ¡ç«¯é…ç½®å‚æ•°å†³å®šã€‚ï¼ˆä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤ï¼‰ æ•°æ®æœ‰åºçš„è®¨è®ºï¼Ÿ â€‹ ä¸€ä¸ªpartitionçš„æ•°æ®æ˜¯å¦æ˜¯æœ‰åºçš„ï¼Ÿ é—´éš”æ€§æœ‰åºï¼Œä¸è¿ç»­ â€‹ é’ˆå¯¹ä¸€ä¸ªtopicé‡Œé¢çš„æ•°æ®ï¼Œåªèƒ½åšåˆ°partitionå†…éƒ¨æœ‰åºï¼Œä¸èƒ½åšåˆ°å…¨å±€æœ‰åºã€‚ â€‹ ç‰¹åˆ«åŠ å…¥æ¶ˆè´¹è€…çš„åœºæ™¯åï¼Œå¦‚ä½•ä¿è¯æ¶ˆè´¹è€…æ¶ˆè´¹çš„æ•°æ®å…¨å±€æœ‰åºçš„ï¼Ÿä¼ªå‘½é¢˜ã€‚ â€‹ åªæœ‰ä¸€ç§æƒ…å†µä¸‹æ‰èƒ½ä¿è¯å…¨å±€æœ‰åºï¼Ÿå°±æ˜¯åªæœ‰ä¸€ä¸ªpartitionã€‚ Kafka Partition Segment Segment fileç»„æˆï¼šç”±2å¤§éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«ä¸ºindex fileå’Œdata fileï¼Œæ­¤2ä¸ªæ–‡ä»¶ä¸€ ä¸€å¯¹åº”ï¼Œæˆå¯¹å‡ºç°ï¼Œåç¼€â€.indexâ€å’Œâ€œ.logâ€åˆ†åˆ«è¡¨ç¤ºä¸ºsegmentç´¢å¼•æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶ã€‚ Segmentæ–‡ä»¶å‘½åè§„åˆ™ï¼špartionå…¨å±€çš„ç¬¬ä¸€ä¸ªsegmentä»0å¼€å§‹ï¼Œåç»­æ¯ä¸ªsegmentæ–‡ä»¶åä¸ºä¸Šä¸€ä¸ªsegmentæ–‡ä»¶æœ€åä¸€æ¡æ¶ˆæ¯çš„offsetå€¼ã€‚æ•°å€¼æœ€å¤§ä¸º64ä½longå¤§å°ï¼Œ19ä½æ•°å­—å­—ç¬¦é•¿åº¦ï¼Œæ²¡æœ‰æ•°å­—ç”¨0å¡«å……ã€‚ ç´¢å¼•æ–‡ä»¶å­˜å‚¨å¤§é‡å…ƒæ•°æ®ï¼Œæ•°æ®æ–‡ä»¶å­˜å‚¨å¤§é‡æ¶ˆæ¯ï¼Œç´¢å¼•æ–‡ä»¶ä¸­å…ƒæ•°æ®æŒ‡å‘å¯¹åº”æ•°æ®æ–‡ä»¶ä¸­messageçš„ç‰©ç†åç§»åœ°å€ã€‚ â€‹ 3ï¼Œ497ï¼šå½“å‰logæ–‡ä»¶ä¸­çš„ç¬¬å‡ æ¡ä¿¡æ¯ï¼Œå­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„é‚£ä¸ªåœ°æ–¹ ä¸Šè¿°å›¾ä¸­ç´¢å¼•æ–‡ä»¶å­˜å‚¨å¤§é‡å…ƒæ•°æ®ï¼Œæ•°æ®æ–‡ä»¶å­˜å‚¨å¤§é‡æ¶ˆæ¯ï¼Œç´¢å¼•æ–‡ä»¶ä¸­å…ƒæ•°æ®æŒ‡å‘å¯¹åº”æ•°æ®æ–‡ä»¶ä¸­messageçš„ç‰©ç†åç§»åœ°å€ã€‚ å…¶ä¸­ä»¥ç´¢å¼•æ–‡ä»¶ä¸­å…ƒæ•°æ®3,497ä¸ºä¾‹ï¼Œä¾æ¬¡åœ¨æ•°æ®æ–‡ä»¶ä¸­è¡¨ç¤ºç¬¬3ä¸ªmessage(åœ¨å…¨å±€partitonè¡¨ç¤ºç¬¬368772ä¸ªmessage)ã€ä»¥åŠè¯¥æ¶ˆæ¯çš„ç‰©ç†åç§»åœ°å€ä¸º497ã€‚ segment data fileç”±è®¸å¤šmessageç»„æˆï¼Œ ç‰©ç†ç»“æ„å¦‚ä¸‹ï¼š Kafka æŸ¥æ‰¾Messageè¯»å–offset=368776çš„messageï¼Œéœ€è¦é€šè¿‡ä¸‹é¢2ä¸ªæ­¥éª¤æŸ¥æ‰¾ã€‚ æŸ¥æ‰¾segment file00000000000000000000.indexè¡¨ç¤ºæœ€å¼€å§‹çš„æ–‡ä»¶ï¼Œèµ·å§‹åç§»é‡(offset)ä¸º0 00000000000000368769.indexçš„æ¶ˆæ¯é‡èµ·å§‹åç§»é‡ä¸º368770 = 368769 + 1 00000000000000737337.indexçš„èµ·å§‹åç§»é‡ä¸º737338=737337 + 1 å…¶ä»–åç»­æ–‡ä»¶ä¾æ¬¡ç±»æ¨ã€‚ ä»¥èµ·å§‹åç§»é‡å‘½åå¹¶æ’åºè¿™äº›æ–‡ä»¶ï¼Œåªè¦æ ¹æ®offset äºŒåˆ†æŸ¥æ‰¾æ–‡ä»¶åˆ—è¡¨ï¼Œå°±å¯ä»¥å¿«é€Ÿå®šä½åˆ°å…·ä½“æ–‡ä»¶ã€‚å½“offset=368776æ—¶å®šä½åˆ°00000000000000368769.indexå’Œå¯¹åº”logæ–‡ä»¶ã€‚ é€šè¿‡segment file æŸ¥æ‰¾ messageå½“offset=368776æ—¶ï¼Œä¾æ¬¡å®šä½åˆ°00000000000000368769.indexçš„å…ƒæ•°æ®ç‰©ç†ä½ç½®å’Œ00000000000000368769.logçš„ç‰©ç†åç§»åœ°å€ ç„¶åå†é€šè¿‡00000000000000368769.logé¡ºåºæŸ¥æ‰¾ç›´åˆ°offset=368776ä¸ºæ­¢ã€‚]]></content>
      <categories>
        <category>æ•°æ®å­˜å‚¨</category>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>Kafka</tag>
        <tag>æ•°æ®å­˜å‚¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[storm]]></title>
    <url>%2F2020%2F03%2F10%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FStorm%2FStorm%2F</url>
    <content type="text"><![CDATA[æµå¼è®¡ç®—å’Œstormä»‹ç»ä»€ä¹ˆæ˜¯ç¦»çº¿è®¡ç®—ç¦»çº¿è®¡ç®—ï¼šæ‰¹é‡è·å–æ•°æ®ã€æ‰¹é‡ä¼ è¾“æ•°æ®ã€å‘¨æœŸæ€§æ‰¹é‡è®¡ç®—æ•°æ®ã€æ•°æ®å±•ç¤º ä»£è¡¨æŠ€æœ¯ï¼šSqoopæ‰¹é‡å¯¼å…¥æ•°æ®ã€HDFSæ‰¹é‡å­˜å‚¨æ•°æ®ã€MapReduceæ‰¹é‡è®¡ç®—æ•°æ®ã€Hiveæ‰¹é‡è®¡ç®—æ•°æ®ã€ä»»åŠ¡è°ƒåº¦ ä»€ä¹ˆæ˜¯æµå¼è®¡ç®—æµå¼è®¡ç®—ï¼šæ•°æ®å®æ—¶äº§ç”Ÿã€æ•°æ®å®æ—¶ä¼ è¾“ã€æ•°æ®å®æ—¶è®¡ç®—ã€å®æ—¶å±•ç¤º ä»£è¡¨æŠ€æœ¯ï¼šFlumeå®æ—¶è·å–æ•°æ®ã€Kafka/metaqå®æ—¶æ•°æ®å­˜å‚¨ã€Storm/JStormå®æ—¶æ•°æ®è®¡ç®—ã€Rediså®æ—¶ç»“æœç¼“å­˜ã€æŒä¹…åŒ–å­˜å‚¨(mysql)ã€‚ ä¸€å¥è¯æ€»ç»“ï¼šå°†æºæºä¸æ–­äº§ç”Ÿçš„æ•°æ®å®æ—¶æ”¶é›†å¹¶å®æ—¶è®¡ç®—ï¼Œå°½å¯èƒ½å¿«çš„å¾—åˆ°è®¡ç®—ç»“æœ ç¦»çº¿è®¡ç®—å’Œå®æ—¶è®¡ç®—çš„åŒºåˆ«æœ€å¤§çš„åŒºåˆ«ï¼šå®æ—¶æ”¶é›†ã€å®æ—¶è®¡ç®—ã€å®æ—¶å±•ç¤º ä»€ä¹ˆæ˜¯stormStormç”¨æ¥å®æ—¶å¤„ç†æ•°æ®ï¼Œç‰¹ç‚¹ï¼šä½å»¶è¿Ÿã€é«˜å¯ç”¨ã€åˆ†å¸ƒå¼ã€å¯æ‰©å±•ã€æ•°æ®ä¸ä¸¢å¤±ã€‚æä¾›ç®€å•å®¹æ˜“ç†è§£çš„æ¥å£ï¼Œä¾¿äºå¼€å‘ã€‚ Storm ä¸ Hadoopçš„åŒºåˆ« Stormç”¨äºå®æ—¶è®¡ç®—ï¼ŒHadoopç”¨äºç¦»çº¿è®¡ç®—ã€‚ Stormå¤„ç†çš„æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæºæºä¸æ–­ï¼›Hadoopå¤„ç†çš„æ•°æ®ä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸€æ‰¹ä¸€æ‰¹ã€‚ Stormçš„æ•°æ®é€šè¿‡ç½‘ç»œä¼ è¾“è¿›æ¥ï¼›Hadoopçš„æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ã€‚ Stormä¸Hadoopçš„ç¼–ç¨‹æ¨¡å‹ç›¸ä¼¼(å¯¹æ¯”å›¾å¦‚ä¸‹) åº”ç”¨åœºæ™¯ æ—¥å¿—åˆ†æ ä»æµ·é‡æ—¥å¿—ä¸­åˆ†æå‡ºç‰¹å®šçš„æ•°æ®ï¼Œå¹¶å°†åˆ†æçš„ç»“æœå­˜å…¥å¤–éƒ¨å­˜å‚¨å™¨ç”¨æ¥è¾…ä½å†³ç­–ã€‚ ç®¡é“ç³»ç»Ÿ å°†ä¸€ä¸ªæ•°æ®ä»ä¸€ä¸ªç³»ç»Ÿä¼ è¾“åˆ°å¦å¤–ä¸€ä¸ªç³»ç»Ÿï¼Œæ¯”å¦‚å°†æ•°æ®åº“åŒæ­¥åˆ°Hadoop æ¶ˆæ¯è½¬åŒ–å™¨ å°†æ¥å—åˆ°çš„æ¶ˆæ¯æŒ‰ç…§æŸç§æ ¼å¼è¿›è¡Œè½¬åŒ–ï¼Œå­˜å‚¨åˆ°å¦å¤–ä¸€ä¸ªç³»ç»Ÿå¦‚æ¶ˆæ¯ä¸­é—´ä»¶ Storm æ¶æ„Stormæ ¸å¿ƒç»„ä»¶ Nimbusï¼šè´Ÿè´£èµ„æºåˆ†é…å’Œä»»åŠ¡è°ƒåº¦ã€‚ Supervisorï¼šè´Ÿè´£æ¥å—nimbusåˆ†é…çš„ä»»åŠ¡ï¼Œå¯åŠ¨å’Œåœæ­¢å±äºè‡ªå·±ç®¡ç†çš„workerè¿›ç¨‹ã€‚â€”é€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®å½“å‰supervisorä¸Šå¯åŠ¨å¤šå°‘ä¸ªworkerã€‚ Workerï¼šè¿è¡Œå…·ä½“å¤„ç†ç»„ä»¶é€»è¾‘çš„è¿›ç¨‹ã€‚Workerè¿è¡Œçš„ä»»åŠ¡ç±»å‹åªæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯Spoutä»»åŠ¡ï¼Œä¸€ç§æ˜¯Boltä»»åŠ¡ã€‚ Taskï¼šworkerä¸­æ¯ä¸€ä¸ªspout/boltçš„çº¿ç¨‹ç§°ä¸ºä¸€ä¸ªtask. åœ¨storm0.8ä¹‹åï¼Œtaskä¸å†ä¸ç‰©ç†çº¿ç¨‹å¯¹åº”ï¼Œä¸åŒspout/boltçš„taskå¯èƒ½ä¼šå…±äº«ä¸€ä¸ªç‰©ç†çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ç§°ä¸ºexecutorã€‚ Storm ç¼–ç¨‹æ¨¡å‹ Topologyï¼šStormä¸­è¿è¡Œçš„ä¸€ä¸ªå®æ—¶åº”ç”¨ç¨‹åºçš„åç§°ã€‚ï¼ˆæ‹“æ‰‘ï¼‰ Spoutï¼šåœ¨ä¸€ä¸ªtopologyä¸­è·å–æºæ•°æ®æµçš„ç»„ä»¶ã€‚ é€šå¸¸æƒ…å†µä¸‹spoutä¼šä»å¤–éƒ¨æ•°æ®æºä¸­è¯»å–æ•°æ®ï¼Œç„¶åè½¬æ¢ä¸ºtopologyå†…éƒ¨çš„æºæ•°æ®ã€‚ Boltï¼šæ¥å—æ•°æ®ç„¶åæ‰§è¡Œå¤„ç†çš„ç»„ä»¶,ç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­æ‰§è¡Œè‡ªå·±æƒ³è¦çš„æ“ä½œã€‚ Tupleï¼šä¸€æ¬¡æ¶ˆæ¯ä¼ é€’çš„åŸºæœ¬å•å…ƒï¼Œç†è§£ä¸ºä¸€ç»„æ¶ˆæ¯å°±æ˜¯ä¸€ä¸ªTupleã€‚ StreamGrouping:æ•°æ®åˆ†ç»„ç­–ç•¥ï¼Œ ä¸€å…±æœ‰7ç§ æµå¼è®¡ç®—çš„ä¸€èˆ¬æ¶æ„ å…¶ä¸­flumeç”¨æ¥è·å–æ•°æ®ã€‚ Kafkaç”¨æ¥ä¸´æ—¶ä¿å­˜æ•°æ®ã€‚ Stromç”¨æ¥è®¡ç®—æ•°æ®ã€‚ Redisæ˜¯ä¸ªå†…å­˜æ•°æ®åº“ï¼Œç”¨æ¥ä¿å­˜æ•°æ®ã€‚ Storm é›†ç¾¤éƒ¨ç½²ä¸æ“ä½œé›†ç¾¤éƒ¨ç½²æµç¨‹åŸºç¡€ç¯å¢ƒå‡†å¤‡ é…ç½®æ‰€æœ‰æœºå™¨hosts vi /etc/hosts 123xx.xx.xx.xx storm01 zk01 hadoop01xx.xx.xx.xx9 storm02 zk02 hadoop02xx.xx.xx.xx storm03 zk03 hadoop03 å…³é—­é˜²ç«å¢™ 1chkconfig iptables off &amp;&amp; setenforce 0 åˆ›å»ºstormç”¨æˆ· 1groupadd stormuser &amp;&amp; useradd stormuser &amp;&amp; usermod -a -G stormuser stormuser åˆ›å»ºå·¥ä½œç›®å½• 12345mkdir /exportmkdir /export/serverschmod 755 -R /export# åˆ‡æ¢åˆ°realtimeç”¨æˆ·ä¸‹su stormuser å®‰è£…åŒ…ä¸‹è½½ ä¸‹è½½å®‰è£…åŒ… 1wget http://124.202.164.6/files/1139000006794ECA/apache.fayea.com/storm/apache-storm-0.9.5/apache-storm-0.9.5.tar.gz è§£å‹å®‰è£…åŒ… 123tar -zxvf apache-storm-0.9.5.tar.gz -C /export/servers/cd /export/servers/ln -s apache-storm-0.9.5 storm é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸å®‰è£…åŒ…åŒæ­¥ ä¿®æ”¹é…ç½®æ–‡ä»¶ 12mv /export/servers/storm/conf/storm.yaml /export/servers/storm/conf/storm.yaml.bakvi /export/servers/storm/conf/storm.yaml è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š â€‹ æŒ‡å®šé›†ç¾¤ä¸­çš„æœºå™¨ï¼Œnimbus host æœºå™¨ï¼Œ JVMçš„å‚æ•°é…ç½®ï¼Œ ä»¥åŠsupervisorå¯åŠ¨workerå¯¹åº”çš„ç«¯å£å· åˆ†å‘å®‰è£…åŒ… 1234scp -r /export/servers/apache-storm-0.9.5 storm02:/export/servers# ç„¶ååˆ†åˆ«åœ¨å„æœºå™¨ä¸Šåˆ›å»ºè½¯è¿æ¥cd /export/servers/ln -s apache-storm-0.9.5 storm å¯åŠ¨é›†ç¾¤ åœ¨nimbus.hostæ‰€å±çš„æœºå™¨ä¸Šå¯åŠ¨ nimbusæœåŠ¡ 12cd /export/servers/storm/bin/nohup ./storm nimbus &amp; åœ¨nimbus.hostæ‰€å±çš„æœºå™¨ä¸Šå¯åŠ¨uiæœåŠ¡ 12cd /export/servers/storm/bin/nohup ./storm ui &amp; åœ¨å…¶å®ƒä¸ªç‚¹å‡»ä¸Šå¯åŠ¨supervisoræœåŠ¡(æ‹“å±•èŠ‚ç‚¹çš„æ—¶å€™ï¼Œé‡å¤åˆ†å‘å®‰è£…åŒ…ï¼Œå¹¶æ‰§è¡Œè¯¥å‘½ä»¤) 12cd /export/servers/storm/bin/nohup ./storm supervisor &amp; æŸ¥çœ‹é›†ç¾¤â€‹ è®¿é—®nimbus.host:/8080ï¼Œå³å¯çœ‹åˆ°stormçš„uiç•Œé¢ã€‚ â€‹ Storm çš„é›†ç¾¤å‘½ä»¤æœ‰è®¸å¤šç®€å•ä¸”æœ‰ç”¨çš„å‘½ä»¤å¯ä»¥ç”¨æ¥ç®¡ç†æ‹“æ‰‘ï¼Œå®ƒä»¬å¯ä»¥æäº¤ã€æ€æ­»ã€ç¦ç”¨ã€å†å¹³è¡¡æ‹“æ‰‘ã€‚ ä»»åŠ¡æäº¤å‘½ä»¤å‘½ä»¤æ ¼å¼ 1storm jar ã€jarè·¯å¾„ã€‘ ã€æ‹“æ‰‘åŒ…å.æ‹“æ‰‘ç±»åã€‘ ã€æ‹“æ‰‘åç§°ã€‘ å‘½ä»¤ç¤ºä¾‹ 1bin/storm jar examples/storm-starter/storm-starter-topologies-0.9.6.jar storm.starter.WordCountTopology wordcount æ€æ­»ä»»åŠ¡å‘½ä»¤å‘½ä»¤æ ¼å¼ 1storm kill ã€æ‹“æ‰‘åç§°ã€‘ -w 10ï¼ˆæ‰§è¡Œkillå‘½ä»¤æ—¶å¯ä»¥é€šè¿‡-w [ç­‰å¾…ç§’æ•°]æŒ‡å®šæ‹“æ‰‘åœç”¨ä»¥åçš„ç­‰å¾…æ—¶é—´ï¼‰ å‘½ä»¤ç¤ºä¾‹ 1storm kill topology-name -w 10 åœç”¨ä»»åŠ¡å‘½ä»¤å‘½ä»¤æ ¼å¼ 1storm deactivte ã€æ‹“æ‰‘åç§°ã€‘ å‘½ä»¤ç¤ºä¾‹ 1storm deactivte topology-name æˆ‘ä»¬èƒ½å¤ŸæŒ‚èµ·æˆ–åœç”¨è¿è¡Œä¸­çš„æ‹“æ‰‘ã€‚å½“åœç”¨æ‹“æ‰‘æ—¶ï¼Œæ‰€æœ‰å·²åˆ†å‘çš„å…ƒç»„éƒ½ä¼šå¾—åˆ°å¤„ç†ï¼Œä½†æ˜¯spoutsçš„nextTupleæ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ã€‚é”€æ¯ä¸€ä¸ªæ‹“æ‰‘ï¼Œå¯ä»¥ä½¿ç”¨killå‘½ä»¤ã€‚å®ƒä¼šä»¥ä¸€ç§å®‰å…¨çš„æ–¹å¼é”€æ¯ä¸€ä¸ªæ‹“æ‰‘ï¼Œé¦–å…ˆåœç”¨æ‹“æ‰‘ï¼Œåœ¨ç­‰å¾…æ‹“æ‰‘æ¶ˆæ¯çš„æ—¶é—´æ®µå†…å…è®¸æ‹“æ‰‘å®Œæˆå½“å‰çš„æ•°æ®æµã€‚ å¯ç”¨ä»»åŠ¡å‘½ä»¤å‘½ä»¤æ ¼å¼ 1storm activateã€æ‹“æ‰‘åç§°ã€‘ å‘½ä»¤ç¤ºä¾‹ 1storm activate topology-name é‡æ–°éƒ¨ç½²ä»»åŠ¡å‘½ä»¤å‘½ä»¤æ ¼å¼ 1storm rebalance ã€æ‹“æ‰‘åç§°ã€‘ å‘½ä»¤ç¤ºä¾‹ 1storm rebalance topology-name â€‹ å†å¹³è¡¡ä½¿ä½ é‡åˆ†é…é›†ç¾¤ä»»åŠ¡ã€‚è¿™æ˜¯ä¸ªå¾ˆå¼ºå¤§çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼Œä½ å‘ä¸€ä¸ªè¿è¡Œä¸­çš„é›†ç¾¤å¢åŠ äº†èŠ‚ç‚¹ã€‚å†å¹³è¡¡å‘½ä»¤å°†ä¼šåœç”¨æ‹“æ‰‘ï¼Œç„¶ååœ¨ç›¸åº”è¶…æ—¶æ—¶é—´ä¹‹åé‡åˆ†é…å·¥äººï¼Œå¹¶é‡å¯æ‹“æ‰‘ã€‚ Stormæ—¥å¿—nimbusçš„æ—¥å¿—ä¿¡æ¯åœ¨nimbusçš„æœåŠ¡å™¨ä¸Š 12cd /export/servers/storm/logstail -100f /export/servers/storm/logs/nimbus.log æŸ¥çœ‹uiè¿è¡Œæ—¥å¿—ä¿¡æ¯åœ¨uiçš„æœåŠ¡å™¨ä¸Šï¼Œä¸€èˆ¬å’Œnimbusä¸€ä¸ªæœåŠ¡å™¨ 12cd /export/servers/storm/logstail -100f /export/servers/storm/logs/ui.log æŸ¥çœ‹supervisorè¿è¡Œæ—¥å¿—ä¿¡æ¯åœ¨supervisoræœåŠ¡ä¸Š 12cd /export/servers/storm/logstail -100f /export/servers/storm/logs/supervisor.log æŸ¥çœ‹supervisorä¸Šworkerè¿è¡Œæ—¥å¿—ä¿¡æ¯åœ¨supervisoræœåŠ¡ä¸Š 12cd /export/servers/storm/logstail -100f /export/servers/storm/logs/worker-6702.log Stormæµå¼è®¡ç®—ç”Ÿå‘½å‘¨æœŸä»‹ç»storm æ‰§è¡Œæµå¼æ•°æ®å¤„ç†å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸä¸»è¦æ˜¯é€šè¿‡Spoutå’ŒBolt è¿™ä¸¤ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ Spoutç»„ä»¶æ¶‰åŠåˆ°çš„æ–¹æ³•æœ‰ï¼š declareOutputFields() (è°ƒç”¨ä¸€æ¬¡) open() (è°ƒç”¨ä¸€æ¬¡) activate() (è°ƒç”¨ä¸€æ¬¡) nextTuple() ï¼ˆå¾ªç¯è°ƒç”¨ ï¼‰ disactive() (æ‰‹åŠ¨è°ƒç”¨) Boltç»„ä»¶æ¶‰åŠåˆ°çš„æ–¹æ³•æœ‰ declareOutputFileds() (è°ƒç”¨ä¸€æ¬¡) prepare() (è°ƒç”¨ä¸€æ¬¡) execute() ï¼ˆå¾ªç¯æ‰§è¡Œï¼‰ æ‰§è¡Œé¡ºåºï¼Ÿ åœ¨å®¢æˆ·ç«¯å°†jaråŒ…æäº¤åˆ°é›†ç¾¤ä¸Šçš„æ—¶å€™ï¼Œæ‰§è¡Œ spout ã€bolt çš„æ„é€ æ–¹æ³•ä»¥åŠdeclareOutputFieldsï¼ˆï¼‰ spoutæ‰§è¡Œopenæ–¹æ³•ä¸€æ¬¡ï¼Œå¾—åˆ°confä¸€äº›é…ç½®ä¿¡æ¯ activateè®©å¤„ç†çš„ä¿¡æ¯å‘é€åˆ°boltä¸­ Bolt ä¸­ prepare æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ Spout ä¸­ nextTupleä¸æ–­çš„å¾ªç¯æ‰§è¡Œ Blot ä¸­ execute ä¸æ–­çš„å¾ªç¯æ‰§è¡Œ Stream GroupingStream Grouping çš„ä½œç”¨Storm çš„Tuple ä» Spout ä¸­ åˆ†å‘åˆ° Boltï¼Œ ä»¥åŠä»Bolt åˆ†å‘çš„Bolt çš„è¿‡ç¨‹ä¸­ï¼ŒStormå®šä¹‰äº†ä¸€äº›å†…ç½®çš„åˆ†å‘æ–¹æ³•å’Œè§„åˆ™ï¼Œ è¿™äº›è§„åˆ™é€šè¿‡ä¸€äº›æ¡ä»¶æˆ–è€…éšæœºå°†å…·æœ‰ç›¸åŒç‰¹å¾çš„tupleåˆ†å‘åˆ°åŒä¸€Boltä¸­è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·æœ‰åˆ©äºå¯¹ä¸åŒç‰¹å¾çš„æ•°æ®è¿›è¡Œé›†ä¸­ç»Ÿè®¡ ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„Grouping ç§ç±» Stream Grouping ç§ç±» Shuffle Grouping: éšæœºåˆ†ç»„ï¼Œ éšæœºæ´¾å‘streamé‡Œé¢çš„tupleï¼Œä¿è¯æ¯ä¸ªboltæ¥æ”¶åˆ°çš„tupleæ•°ç›®å¤§è‡´ç›¸åŒã€‚ Fields Groupingï¼šæŒ‰å­—æ®µåˆ†ç»„ï¼Œæ¯”å¦‚æŒ‰useridæ¥åˆ†ç»„ï¼Œå…·æœ‰åŒæ ·useridçš„tupleä¼šè¢«åˆ†åˆ°ç›¸åŒçš„Boltsé‡Œçš„ä¸€ä¸ªtaskï¼Œè€Œä¸åŒçš„useridåˆ™ä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„boltsé‡Œçš„taskã€‚ All Groupingï¼šå¹¿æ’­å‘é€ï¼Œå¯¹äºæ¯ä¸€ä¸ªtupleï¼Œæ‰€æœ‰çš„boltséƒ½ä¼šæ”¶åˆ°ã€‚ Global Groupingï¼šå…¨å±€åˆ†ç»„ï¼Œ è¿™ä¸ªtupleè¢«åˆ†é…åˆ°stormä¸­çš„ä¸€ä¸ªboltçš„å…¶ä¸­ä¸€ä¸ªtaskã€‚å†å…·ä½“ä¸€ç‚¹å°±æ˜¯åˆ†é…ç»™idå€¼æœ€ä½çš„é‚£ä¸ªtaskã€‚ Non Groupingï¼šä¸åˆ†ç»„ï¼Œè¿™stream groupingä¸ªåˆ†ç»„çš„æ„æ€æ˜¯è¯´streamä¸å…³å¿ƒåˆ°åº•è°ä¼šæ”¶åˆ°å®ƒçš„tupleã€‚ç›®å‰è¿™ç§åˆ†ç»„å’ŒShuffle groupingæ˜¯ä¸€æ ·çš„æ•ˆæœï¼Œæœ‰ä¸€ç‚¹ä¸åŒçš„æ˜¯stormä¼šæŠŠè¿™ä¸ªboltæ”¾åˆ°è¿™ä¸ªboltçš„è®¢é˜…è€…åŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢å»æ‰§è¡Œï¼Œ å³å‡å°‘è·¨ä¸»æœºsocketé€šè®¯ã€‚ Direct Groupingï¼š ç›´æ¥åˆ†ç»„ï¼Œ è¿™æ˜¯ä¸€ç§æ¯”è¾ƒç‰¹åˆ«çš„åˆ†ç»„æ–¹æ³•ï¼Œç”¨è¿™ç§åˆ†ç»„æ„å‘³ç€æ¶ˆæ¯çš„å‘é€è€…æŒ‡å®šç”±æ¶ˆæ¯æ¥æ”¶è€…çš„å“ªä¸ªtaskå¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚åªæœ‰è¢«å£°æ˜ä¸ºDirect Streamçš„æ¶ˆæ¯æµå¯ä»¥å£°æ˜è¿™ç§åˆ†ç»„æ–¹æ³•ã€‚è€Œä¸”è¿™ç§æ¶ˆæ¯tupleå¿…é¡»ä½¿ç”¨emitDirectæ–¹æ³•æ¥å‘å°„ã€‚æ¶ˆæ¯å¤„ç†è€…å¯ä»¥é€šè¿‡TopologyContextæ¥è·å–å¤„ç†å®ƒçš„æ¶ˆæ¯çš„taskçš„id ï¼ˆOutputCollector.emitæ–¹æ³•ä¹Ÿä¼šè¿”å›taskçš„idï¼‰ã€‚ Local or shuffle groupingï¼šå¦‚æœç›®æ ‡boltæœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªtaskåœ¨åŒä¸€ä¸ªå·¥ä½œè¿›ç¨‹ä¸­ï¼Œtupleå°†ä¼šè¢«éšæœºå‘ç”Ÿç»™è¿™äº›tasksã€‚å¦åˆ™ï¼Œå’Œæ™®é€šçš„Shuffle Groupingè¡Œä¸ºä¸€è‡´ã€‚ å•ä½“ç»Ÿè®¡æ¡ˆä¾‹åŠŸèƒ½è¯´æ˜è®¾è®¡ä¸€ä¸ªtopologyï¼Œæ¥å®ç°å¯¹æ–‡æ¡£é‡Œé¢çš„å•è¯å‡ºç°çš„é¢‘ç‡è¿›è¡Œç»Ÿè®¡ã€‚ æ•´ä¸ªtopologyåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š RandomSentenceSpoutï¼šæ•°æ®æºï¼Œåœ¨å·²çŸ¥çš„è‹±æ–‡å¥å­ä¸­ï¼Œéšæœºå‘é€ä¸€æ¡å¥å­å‡ºå»ã€‚ SplitSentenceBoltï¼šè´Ÿè´£å°†å•è¡Œæ–‡æœ¬è®°å½•ï¼ˆå¥å­ï¼‰åˆ‡åˆ†æˆå•è¯ WordCountBoltï¼šè´Ÿè´£å¯¹å•è¯çš„é¢‘ç‡è¿›è¡Œç´¯åŠ  é¡¹ç›®ç»“æ„è®¾è®¡ RandomSentenceSpoutçš„å®ç° SplitSentenceBoltçš„å®ç° WordCountBoltçš„å®ç° Storm ç¨‹åºçš„å¹¶å‘æœºåˆ¶æ¦‚å¿µ Workers (JVMs): åœ¨ä¸€ä¸ªç‰©ç†èŠ‚ç‚¹ä¸Šå¯ä»¥è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹çš„JVM è¿›ç¨‹ã€‚ä¸€ä¸ªTopologyå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªworker(å¹¶è¡Œçš„è·‘åœ¨ä¸åŒçš„ç‰©ç†æœºä¸Š), æ‰€ä»¥worker processå°±æ˜¯æ‰§è¡Œä¸€ä¸ªtopologyçš„å­é›†, å¹¶ä¸”workeråªèƒ½å¯¹åº”äºä¸€ä¸ªtopology Executors (threads): åœ¨ä¸€ä¸ªworker JVMè¿›ç¨‹ä¸­è¿è¡Œç€å¤šä¸ªJavaçº¿ç¨‹ã€‚ä¸€ä¸ªexecutorçº¿ç¨‹å¯ä»¥æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªtasksã€‚ä½†ä¸€èˆ¬é»˜è®¤æ¯ä¸ªexecutoråªæ‰§è¡Œä¸€ä¸ªtaskã€‚ä¸€ä¸ªworkerå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªexecutor, æ¯ä¸ªcomponent (spoutæˆ–bolt)è‡³å°‘å¯¹åº”äºä¸€ä¸ªexecutor, æ‰€ä»¥å¯ä»¥è¯´executoræ‰§è¡Œä¸€ä¸ªcompenentçš„å­é›†, åŒæ—¶ä¸€ä¸ªexecutoråªèƒ½å¯¹åº”äºä¸€ä¸ªcomponentã€‚ Tasks(bolt/spout instances)ï¼šTaskå°±æ˜¯å…·ä½“çš„å¤„ç†é€»è¾‘å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªSpoutå’ŒBoltä¼šè¢«å½“ä½œå¾ˆå¤štaskåœ¨æ•´ä¸ªé›†ç¾¤é‡Œé¢æ‰§è¡Œã€‚æ¯ä¸€ä¸ªtaskå¯¹åº”åˆ°ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œstream groupingåˆ™æ˜¯å®šä¹‰æ€ä¹ˆä»ä¸€å †taskå‘å°„tupleåˆ°å¦å¤–ä¸€å †taskã€‚ä½ å¯ä»¥è°ƒç”¨TopologyBuilder.setSpoutå’ŒTopBuilder.setBoltæ¥è®¾ç½®å¹¶è¡Œåº¦ â€” ä¹Ÿå°±æ˜¯æœ‰å¤šå°‘ä¸ªtaskã€‚ é…ç½®å¹¶è¡Œåº¦é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶å’Œä»£ç é…ç½®å†°å¿ƒé¢åº¦ å¯¹äºå¹¶å‘åº¦çš„é…ç½®, åœ¨stormé‡Œé¢å¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹è¿›è¡Œé…ç½®, ä¼˜å…ˆçº§ä¸ºï¼š defaults.yaml &lt; storm.yaml &lt; topology-specific configuration &lt; internal component-specific configuration &lt; external component-specific configuration worker processesçš„æ•°ç›®, å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å’Œä»£ç ä¸­é…ç½®, workerå°±æ˜¯æ‰§è¡Œè¿›ç¨‹, æ‰€ä»¥è€ƒè™‘å¹¶å‘çš„æ•ˆæœ, æ•°ç›®è‡³å°‘åº”è¯¥å¤§äºmachinesçš„æ•°ç›® executorçš„æ•°ç›®, componentçš„å¹¶å‘çº¿ç¨‹æ•°ï¼Œåªèƒ½åœ¨ä»£ç ä¸­é…ç½®(é€šè¿‡setBoltå’ŒsetSpoutçš„å‚æ•°), ä¾‹å¦‚, setBolt(â€œgreen-boltâ€, new GreenBolt(), 2) tasksçš„æ•°ç›®, å¯ä»¥ä¸é…ç½®, é»˜è®¤å’Œexecutor1:1, ä¹Ÿå¯ä»¥é€šè¿‡setNumTasks()é…ç½® Topologyçš„workeræ•°é€šè¿‡configè®¾ç½®ï¼Œå³æ‰§è¡Œè¯¥topologyçš„workerï¼ˆjavaï¼‰è¿›ç¨‹æ•°ã€‚å®ƒå¯ä»¥é€šè¿‡ storm rebalance å‘½ä»¤ä»»æ„è°ƒæ•´ã€‚ 123456Config conf = newConfig();conf.setNumWorkers(2); //ç”¨2ä¸ªworkertopologyBuilder.setSpout("blue-spout", newBlueSpout(), 2); //è®¾ç½®2ä¸ªå¹¶å‘åº¦topologyBuilder.setBolt("green-bolt", newGreenBolt(), 2).setNumTasks(4).shuffleGrouping("blue-spout"); //è®¾ç½®2ä¸ªå¹¶å‘åº¦ï¼Œ4ä¸ªä»»åŠ¡topologyBuilder.setBolt("yellow-bolt", newYellowBolt(), 6).shuffleGrouping("green-bolt"); //è®¾ç½®6ä¸ªå¹¶å‘åº¦StormSubmitter.submitTopology("mytopology", conf, topologyBuilder.createTopology()); åŠ¨æ€æ”¹å˜ä»»åŠ¡çš„å¹¶è¡Œåº¦Stormæ”¯æŒåœ¨ä¸ restart topology çš„æƒ…å†µä¸‹, åŠ¨æ€çš„æ”¹å˜(å¢å‡) worker processes çš„æ•°ç›®å’Œ executors çš„æ•°ç›®, ç§°ä¸ºrebalancing. é€šè¿‡Storm web UIï¼Œæˆ–è€…é€šè¿‡storm rebalanceå‘½ä»¤å®ç°ï¼š 1storm rebalance mytopology -n 5 -e a-spout=3 -e b-bolt=10 Storm çš„æŠ€æœ¯åˆ†æStormçš„é€šè®¯æŠ€æœ¯é€šè®¯æœºåˆ¶Workeré—´çš„é€šä¿¡ç»å¸¸éœ€è¦é€šè¿‡ç½‘ç»œè·¨èŠ‚ç‚¹è¿›è¡Œï¼ŒStormä½¿ç”¨ZeroMQæˆ–Netty(0.9ä»¥åé»˜è®¤ä½¿ç”¨)ä½œä¸ºè¿›ç¨‹é—´é€šä¿¡çš„æ¶ˆæ¯æ¡†æ¶ã€‚ Workerè¿›ç¨‹å†…éƒ¨é€šä¿¡ï¼šä¸åŒworkerçš„threadé€šä¿¡ä½¿ç”¨LMAX Disruptoræ¥å®Œæˆã€‚ ä¸åŒtopologeyä¹‹é—´çš„é€šä¿¡ï¼ŒStormä¸è´Ÿè´£ï¼Œéœ€è¦è‡ªå·±æƒ³åŠæ³•å®ç°ï¼Œä¾‹å¦‚ä½¿ç”¨kafkaç­‰ï¼› Worker è¿›ç¨‹é—´é€šè®¯æœºåˆ¶workerè¿›ç¨‹é—´æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼Œæ¶ˆæ¯çš„æ¥æ”¶å’Œå¤„ç†çš„å¤§æ¦‚æµç¨‹è§ä¸‹å›¾ å¯¹äºworkerè¿›ç¨‹æ¥è¯´ï¼Œä¸ºäº†ç®¡ç†æµå…¥å’Œä¼ å‡ºçš„æ¶ˆæ¯ï¼Œæ¯ä¸ªworkerè¿›ç¨‹æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ¥æ”¶çº¿ç¨‹(å¯¹é…ç½®çš„TCPç«¯å£supervisor.slots.portsè¿›è¡Œç›‘å¬); å¯¹åº”Workeræ¥æ”¶çº¿ç¨‹ï¼Œæ¯ä¸ªworkerå­˜åœ¨ä¸€ä¸ªç‹¬ç«‹çš„å‘é€çº¿ç¨‹ï¼Œå®ƒè´Ÿè´£ä»workerçš„transfer-queueä¸­è¯»å–æ¶ˆæ¯ï¼Œå¹¶é€šè¿‡ç½‘ç»œå‘é€ç»™å…¶ä»–worker æ¯ä¸ªexecutoræœ‰è‡ªå·±çš„incoming-queueå’Œoutgoing-queueã€‚ Workeræ¥æ”¶çº¿ç¨‹å°†æ”¶åˆ°çš„æ¶ˆæ¯é€šè¿‡taskç¼–å·ä¼ é€’ç»™å¯¹åº”çš„executor(ä¸€ä¸ªæˆ–å¤šä¸ª)çš„incoming-queues; æ¯ä¸ªexecutoræœ‰å•ç‹¬çš„çº¿ç¨‹åˆ†åˆ«æ¥å¤„ç†spout/boltçš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸šåŠ¡é€»è¾‘è¾“å‡ºçš„ä¸­é—´æ•°æ®ä¼šå­˜æ”¾åœ¨outgoing-queueä¸­ï¼Œå½“executorçš„outgoing-queueä¸­çš„tupleè¾¾åˆ°ä¸€å®šçš„é˜€å€¼ï¼Œexecutorçš„å‘é€çº¿ç¨‹å°†æ‰¹é‡è·å–outgoing-queueä¸­çš„tuple,å¹¶å‘é€åˆ°transfer-queueä¸­ã€‚ æ¯ä¸ªworkerè¿›ç¨‹æ§åˆ¶ä¸€ä¸ªæˆ–å¤šä¸ªexecutorçº¿ç¨‹ï¼Œç”¨æˆ·å¯åœ¨ä»£ç ä¸­è¿›è¡Œé…ç½®ã€‚å…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨ä»£ç ä¸­è®¾ç½®çš„å¹¶å‘åº¦ä¸ªæ•°ã€‚ Worker è¿›ç¨‹é—´é€šè®¯æœºåˆ¶åˆ†æ Workeræ¥å—çº¿ç¨‹é€šè¿‡ç½‘ç»œæ¥å—æ•°æ®ï¼Œå¹¶æ ¹æ®Tupleä¸­åŒ…å«çš„taskIdï¼ŒåŒ¹é…åˆ°å¯¹åº”çš„executorï¼›ç„¶åæ ¹æ®executoræ‰¾åˆ°å¯¹åº”çš„incoming-queueï¼Œå°†æ•°æ®å­˜å‘é€åˆ°incoming-queueé˜Ÿåˆ—ä¸­ã€‚ ä¸šåŠ¡é€»è¾‘æ‰§è¡Œç°æˆæ¶ˆè´¹incoming-queueçš„æ•°æ®ï¼Œé€šè¿‡è°ƒç”¨Boltçš„execute(xxxx)æ–¹æ³•ï¼Œå°†Tupleä½œä¸ºå‚æ•°ä¼ è¾“ç»™ç”¨æˆ·è‡ªå®šä¹‰çš„æ–¹æ³• ä¸šåŠ¡é€»è¾‘æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå°†è®¡ç®—çš„ä¸­é—´æ•°æ®å‘é€ç»™outgoing-queueé˜Ÿåˆ—ï¼Œå½“outgoing-queueä¸­çš„tupleè¾¾åˆ°ä¸€å®šçš„é˜€å€¼ï¼Œexecutorçš„å‘é€çº¿ç¨‹å°†æ‰¹é‡è·å–outgoing-queueä¸­çš„tuple,å¹¶å‘é€åˆ°Workerçš„transfer-queueä¸­ Workerå‘é€çº¿ç¨‹æ¶ˆè´¹transfer-queueä¸­æ•°æ®ï¼Œè®¡ç®—Tupleçš„ç›®çš„åœ°ï¼Œè¿æ¥ä¸åŒçš„node+portå°†æ•°æ®é€šè¿‡ç½‘ç»œä¼ è¾“çš„æ–¹å¼ä¼ é€ç»™å¦ä¸€ä¸ªçš„Workerã€‚ å¦ä¸€ä¸ªworkeræ‰§è¡Œä»¥ä¸Šæ­¥éª¤1çš„æ“ä½œã€‚ Disruptor é˜Ÿåˆ—disruptoræ˜¯ä»€ä¹ˆ 1ã€ ç®€å•ç†è§£ï¼šDisruptoræ˜¯ä¸€ä¸ªQueueã€‚Disruptoræ˜¯å®ç°äº†â€œé˜Ÿåˆ—â€çš„åŠŸèƒ½ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªæœ‰ç•Œé˜Ÿåˆ—ã€‚è€Œé˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯è‡ªç„¶å°±æ˜¯â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å‹ã€‚ 2ã€ åœ¨JDKä¸­Queueæœ‰å¾ˆå¤šå®ç°ç±»ï¼ŒåŒ…æ‹¬ä¸é™äºArrayBlockingQueueã€LinkBlockingQueueï¼Œè¿™ä¸¤ä¸ªåº•å±‚çš„æ•°æ®ç»“æ„åˆ†åˆ«æ˜¯æ•°ç»„å’Œé“¾è¡¨ã€‚æ•°ç»„æŸ¥è¯¢å¿«ï¼Œé“¾è¡¨å¢åˆ å¿«ï¼Œèƒ½å¤Ÿé€‚åº”å¤§å¤šæ•°åº”ç”¨åœºæ™¯ã€‚ 3ã€ ä½†æ˜¯ArrayBlockingQueueã€LinkBlockingQueueéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¶‰åŠåˆ°çº¿ç¨‹å®‰å…¨ï¼Œå°±ä¼šæœ‰synchronizedã€lockç­‰å…³é”®å­—ï¼Œè¿™å°±æ„å‘³ç€CPUä¼šæ‰“æ¶ã€‚ 4ã€ Disruptorä¸€ç§çº¿ç¨‹ä¹‹é—´ä¿¡æ¯æ— é”çš„äº¤æ¢æ–¹å¼ï¼ˆä½¿ç”¨CASï¼ˆCompare And Swap/Setï¼‰æ“ä½œï¼‰ã€‚ disruptorä¸»è¦ç‰¹ç‚¹ Disruptorå¯ä»¥çœ‹æˆä¸€ä¸ªäº‹ä»¶ç›‘å¬æˆ–æ¶ˆæ¯æœºåˆ¶ï¼Œåœ¨é˜Ÿåˆ—ä¸­ä¸€è¾¹ç”Ÿäº§è€…æ”¾å…¥æ¶ˆæ¯ï¼Œå¦å¤–ä¸€è¾¹æ¶ˆè´¹è€…å¹¶è¡Œå–å‡ºå¤„ç†. åº•å±‚æ˜¯å•ä¸ªæ•°æ®ç»“æ„ï¼šä¸€ä¸ªring bufferã€‚ æ¯ä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½æœ‰ä¸€ä¸ªæ¬¡åºè®¡ç®—å™¨ï¼Œä»¥æ˜¾ç¤ºå½“å‰ç¼“å†²å·¥ä½œæ–¹å¼ã€‚ æ¯ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…èƒ½å¤Ÿæ“ä½œè‡ªå·±çš„æ¬¡åºè®¡æ•°å™¨çš„èƒ½å¤Ÿè¯»å–å¯¹æ–¹çš„è®¡æ•°å™¨ï¼Œç”Ÿäº§è€…èƒ½å¤Ÿè¯»å–æ¶ˆè´¹è€…çš„è®¡ç®—å™¨ç¡®ä¿å…¶åœ¨æ²¡æœ‰é”çš„æƒ…å†µä¸‹æ˜¯å¯å†™çš„ã€‚ æ ¸å¿ƒç»„ä»¶ Ring Buffer ç¯å½¢çš„ç¼“å†²åŒºï¼Œè´Ÿè´£å¯¹é€šè¿‡ Disruptor è¿›è¡Œäº¤æ¢çš„æ•°æ®ï¼ˆäº‹ä»¶ï¼‰è¿›è¡Œå­˜å‚¨å’Œæ›´æ–°ã€‚ Sequence é€šè¿‡é¡ºåºé€’å¢çš„åºå·æ¥ç¼–å·ç®¡ç†é€šè¿‡å…¶è¿›è¡Œäº¤æ¢çš„æ•°æ®ï¼ˆäº‹ä»¶ï¼‰ï¼Œå¯¹æ•°æ®(äº‹ä»¶)çš„å¤„ç†è¿‡ç¨‹æ€»æ˜¯æ²¿ç€åºå·é€ä¸ªé€’å¢å¤„ç†ã€‚ RingBufferåº•å±‚æ˜¯ä¸ªæ•°ç»„ï¼Œæ¬¡åºè®¡ç®—å™¨æ˜¯ä¸€ä¸ª64bit long æ•´æ•°å‹ï¼Œå¹³æ»‘å¢é•¿ã€‚ â€‹ 1. æ¥å—æ•°æ®å¹¶å†™å…¥åˆ°è„šæ ‡31çš„ä½ç½®ï¼Œä¹‹åä¼šæ²¿ç€åºå·ä¸€ç›´å†™å…¥ï¼Œä½†æ˜¯ä¸ä¼šç»•è¿‡æ¶ˆè´¹è€…æ‰€åœ¨çš„è„šæ ‡ã€‚ â€‹ 2. Joumalerå’ŒreplicatoråŒæ—¶è¯»åˆ°24çš„ä½ç½®ï¼Œä»–ä»¬å¯ä»¥æ‰¹é‡è¯»å–æ•°æ®åˆ°30 â€‹ 3. æ¶ˆè´¹é€»è¾‘çº¿ç¨‹è¯»åˆ°äº†14çš„ä½ç½®ï¼Œä½†æ˜¯æ²¡æ³•ç»§ç»­è¯»ä¸‹å»ï¼Œå› ä¸ºä»–çš„sequenceæš‚åœåœ¨15çš„ä½ç½®ä¸Šï¼Œéœ€è¦ç­‰åˆ°ä»–çš„sequenceç»™ä»–åºå·ã€‚å¦‚æœsequenceèƒ½æ­£å¸¸å·¥ä½œï¼Œå°±èƒ½è¯»å–åˆ°30çš„æ•°æ®ã€‚ Workeré—´çš„ç½‘ç»œé€šè®¯Netty Nettyæ˜¯ä¸€ä¸ªNIO client-server(å®¢æˆ·ç«¯æœåŠ¡å™¨)æ¡†æ¶ï¼Œä½¿ç”¨Nettyå¯ä»¥å¿«é€Ÿå¼€å‘ç½‘ç»œåº”ç”¨ï¼Œä¾‹å¦‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åè®®ã€‚Nettyæä¾›äº†ä¸€ç§æ–°çš„æ–¹å¼æ¥ä½¿å¼€å‘ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œè¿™ç§æ–°çš„æ–¹å¼ä½¿å¾—å®ƒå¾ˆå®¹æ˜“ä½¿ç”¨å’Œæœ‰å¾ˆå¼ºçš„æ‰©å±•æ€§ã€‚Nettyçš„å†…éƒ¨å®ç°æ—¶å¾ˆå¤æ‚çš„ï¼Œä½†æ˜¯Nettyæä¾›äº†ç®€å•æ˜“ç”¨çš„apiä»ç½‘ç»œå¤„ç†ä»£ç ä¸­è§£è€¦ä¸šåŠ¡é€»è¾‘ã€‚Nettyæ˜¯å®Œå…¨åŸºäºNIOå®ç°çš„ï¼Œæ‰€ä»¥æ•´ä¸ªNettyéƒ½æ˜¯å¼‚æ­¥çš„ã€‚ ZeroMQ ZeroMQæ˜¯ä¸€ç§åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å¤šçº¿ç¨‹ç½‘ç»œåº“ï¼Œå…¶å¯¹å¥—æ¥å­—ç±»å‹ã€è¿æ¥å¤„ç†ã€å¸§ã€ç”šè‡³è·¯ç”±çš„åº•å±‚ç»†èŠ‚è¿›è¡ŒæŠ½è±¡ï¼Œæä¾›è·¨è¶Šå¤šç§ä¼ è¾“åè®®çš„å¥—æ¥å­—ã€‚ZeroMQæ˜¯ç½‘ç»œé€šä¿¡ä¸­æ–°çš„ä¸€å±‚ï¼Œä»‹äºåº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¹‹é—´ï¼ˆæŒ‰ç…§TCP/IPåˆ’åˆ†ï¼‰ï¼Œå…¶æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©å±‚ï¼Œå¯å¹¶è¡Œè¿è¡Œï¼Œåˆ†æ•£åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé—´ã€‚ ZeroMQå®šä½ä¸ºï¼šä¸€ä¸ªç®€å•å¥½ç”¨çš„ä¼ è¾“å±‚ï¼Œåƒæ¡†æ¶ä¸€æ ·çš„ä¸€ä¸ªsocket libraryï¼Œä»–ä½¿å¾—Socketç¼–ç¨‹æ›´åŠ ç®€å•ã€ç®€æ´å’Œæ€§èƒ½æ›´é«˜ã€‚æ˜¯ä¸€ä¸ªæ¶ˆæ¯å¤„ç†é˜Ÿåˆ—åº“ï¼Œå¯åœ¨å¤šä¸ªçº¿ç¨‹ã€å†…æ ¸å’Œä¸»æœºç›’ä¹‹é—´å¼¹æ€§ä¼¸ç¼©ã€‚ZMQçš„æ˜ç¡®ç›®æ ‡æ˜¯â€œæˆä¸ºæ ‡å‡†ç½‘ç»œåè®®æ ˆçš„ä¸€éƒ¨åˆ†ï¼Œä¹‹åè¿›å…¥Linuxå†…æ ¸â€ã€‚ Storm ç»„ä»¶æœ¬åœ°ç›®å½•ç»“æ„ Storm zookeeper ç›®å½•æ ‘ Storm ä»»åŠ¡æäº¤è¿‡ç¨‹è¿‡ç¨‹ç¤ºæ„å›¾ nimbus åˆ›å»ºçš„Topoå¯¹è±¡ç¤ºæ„å›¾ è¯¦ç»†ä»»åŠ¡æäº¤è¿‡ç¨‹ Storm çš„å®¹é”™æœºåˆ¶æ€»ä½“ä»‹ç» åœ¨stormä¸­ï¼Œå¯é çš„ä¿¡æ¯å¤„ç†æœºåˆ¶æ˜¯ä»spoutå¼€å§‹çš„ã€‚ ä¸€ä¸ªæä¾›äº†å¯é çš„å¤„ç†æœºåˆ¶çš„spoutéœ€è¦è®°å½•ä»–å‘å°„å‡ºå»çš„tupleï¼Œå½“ä¸‹æ¸¸boltå¤„ç†tupleæˆ–è€…å­tupleå¤±è´¥æ—¶spoutèƒ½å¤Ÿé‡æ–°å‘å°„ã€‚ Stormé€šè¿‡è°ƒç”¨Spoutçš„nextTuple()å‘é€ä¸€ä¸ªtupleã€‚ä¸ºå®ç°å¯é çš„æ¶ˆæ¯å¤„ç†ï¼Œé¦–å…ˆè¦ç»™æ¯ä¸ªå‘å‡ºçš„tupleå¸¦ä¸Šå”¯ä¸€çš„IDï¼Œå¹¶ä¸”å°†IDä½œä¸ºå‚æ•°ä¼ é€’ç»™SoputOutputCollectorçš„emit()æ–¹æ³•ï¼šcollector.emit(new Values(â€œvalue1â€,â€value2â€), msgId); messageidå°±æ˜¯ç”¨æ¥æ ‡ç¤ºå”¯ä¸€çš„tupleçš„ï¼Œè€Œrootidæ˜¯éšæœºç”Ÿæˆçš„ ç»™æ¯ä¸ªtupleæŒ‡å®šIDå‘Šè¯‰Stormç³»ç»Ÿï¼Œæ— è®ºå¤„ç†æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œspoutéƒ½è¦æ¥æ”¶tupleæ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹è¿”å›çš„é€šçŸ¥ã€‚å¦‚æœå¤„ç†æˆåŠŸï¼Œspoutçš„ack()æ–¹æ³•å°†ä¼šå¯¹ç¼–å·æ˜¯msgIdçš„æ¶ˆæ¯åº”ç­”ç¡®è®¤ï¼›å¦‚æœå¤„ç†å¤±è´¥æˆ–è€…è¶…æ—¶ï¼Œä¼šè°ƒç”¨fail()æ–¹æ³•ã€‚ åŸºæœ¬å®ç°Storm ç³»ç»Ÿä¸­æœ‰ä¸€ç»„å«åšâ€ackerâ€çš„ç‰¹æ®Šçš„ä»»åŠ¡ï¼Œå®ƒä»¬è´Ÿè´£è·Ÿè¸ªDAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰ä¸­çš„æ¯ä¸ªæ¶ˆæ¯ã€‚ ackerä»»åŠ¡ä¿å­˜äº†spout idåˆ°ä¸€å¯¹å€¼çš„æ˜ å°„ã€‚ç¬¬ä¸€ä¸ªå€¼å°±æ˜¯spoutçš„ä»»åŠ¡idï¼Œé€šè¿‡è¿™ä¸ªidï¼Œackerå°±çŸ¥é“æ¶ˆæ¯å¤„ç†å®Œæˆæ—¶è¯¥é€šçŸ¥å“ªä¸ªspoutä»»åŠ¡ã€‚ç¬¬äºŒä¸ªå€¼æ˜¯ä¸€ä¸ª64bitçš„æ•°å­—ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€ack valâ€ï¼Œ å®ƒæ˜¯æ ‘ä¸­æ‰€æœ‰æ¶ˆæ¯çš„éšæœºidçš„å¼‚æˆ–è®¡ç®—ç»“æœã€‚ ack valè¡¨ç¤ºäº†æ•´æ£µæ ‘çš„çš„çŠ¶æ€ï¼Œæ— è®ºè¿™æ£µæ ‘å¤šå¤§ï¼Œåªéœ€è¦è¿™ä¸ªå›ºå®šå¤§å°çš„æ•°å­—å°±å¯ä»¥è·Ÿè¸ªæ•´æ£µæ ‘ã€‚å½“æ¶ˆæ¯è¢«åˆ›å»ºå’Œè¢«åº”ç­”çš„æ—¶å€™éƒ½ä¼šæœ‰ç›¸åŒçš„æ¶ˆæ¯idå‘é€è¿‡æ¥åšå¼‚æˆ–ã€‚ æ¯å½“ackerå‘ç°ä¸€æ£µæ ‘çš„ack valå€¼ä¸º0çš„æ—¶å€™ï¼Œå®ƒå°±çŸ¥é“è¿™æ£µæ ‘å·²ç»è¢«å®Œå…¨å¤„ç†äº† å¯é æ€§é…ç½®æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥å»æ‰æ¶ˆæ¯çš„å¯é æ€§ï¼š å°†å‚æ•°Config.TOPOLOGY_ACKERSè®¾ç½®ä¸º0ï¼Œé€šè¿‡æ­¤æ–¹æ³•ï¼Œå½“Spoutå‘é€ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒçš„ackæ–¹æ³•å°†ä¸ä¼šè¢«è°ƒç”¨; Spoutå‘é€ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œä¸æŒ‡å®šæ­¤æ¶ˆæ¯çš„messageIDã€‚å½“éœ€è¦å…³é—­ç‰¹å®šæ¶ˆæ¯å¯é æ€§çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ï¼› æœ€åï¼Œå¦‚æœä½ ä¸åœ¨æ„æŸä¸ªæ¶ˆæ¯æ´¾ç”Ÿå‡ºæ¥çš„å­å­™æ¶ˆæ¯çš„å¯é æ€§ï¼Œåˆ™æ­¤æ¶ˆæ¯æ´¾ç”Ÿå‡ºæ¥çš„å­æ¶ˆæ¯åœ¨å‘é€æ—¶ä¸è¦åšé”šå®šï¼Œå³åœ¨emitæ–¹æ³•ä¸­ä¸æŒ‡å®šè¾“å…¥æ¶ˆæ¯ã€‚å› ä¸ºè¿™äº›å­å­™æ¶ˆæ¯æ²¡æœ‰è¢«é”šå®šåœ¨ä»»ä½•tuple treeä¸­ï¼Œå› æ­¤ä»–ä»¬çš„å¤±è´¥ä¸ä¼šå¼•èµ·ä»»ä½•spouté‡æ–°å‘é€æ¶ˆæ¯ã€‚]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Storm</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hbase]]></title>
    <url>%2F2020%2F02%2F23%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2F%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B7%A5%E5%85%B7%2Fhbase%2F</url>
    <content type="text"><![CDATA[hbaseç®€ä»‹hbaseä»‹ç»HBASEæ˜¯ä¸€ä¸ªé«˜å¯é æ€§ã€é«˜æ€§èƒ½ã€é¢å‘åˆ—ã€å¯ä¼¸ç¼©çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œåˆ©ç”¨HBASEæŠ€æœ¯å¯åœ¨å»‰ä»·PC Serverä¸Šæ­å»ºèµ·å¤§è§„æ¨¡ç»“æ„åŒ–å­˜å‚¨é›†ç¾¤ã€‚ HBASEçš„ç›®æ ‡æ˜¯å­˜å‚¨å¹¶å¤„ç†å¤§å‹çš„æ•°æ®ï¼Œæ›´å…·ä½“æ¥è¯´æ˜¯ä»…éœ€ä½¿ç”¨æ™®é€šçš„ç¡¬ä»¶é…ç½®ï¼Œå°±èƒ½å¤Ÿå¤„ç†ç”±æˆåƒä¸Šä¸‡çš„è¡Œå’Œåˆ—æ‰€ç»„æˆçš„å¤§å‹æ•°æ®ã€‚ HBASEæ˜¯Google Bigtableçš„å¼€æºå®ç°ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šä¸åŒä¹‹å¤„ã€‚æ¯”å¦‚ï¼šGoogle Bigtableåˆ©ç”¨GFSä½œä¸ºå…¶æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼ŒHBASEåˆ©ç”¨Hadoop HDFSä½œä¸ºå…¶æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼›Googleè¿è¡ŒMAPREDUCEæ¥å¤„ç†Bigtableä¸­çš„æµ·é‡æ•°æ®ï¼ŒHBASEåŒæ ·åˆ©ç”¨Hadoop MapReduceæ¥å¤„ç†HBASEä¸­çš„æµ·é‡æ•°æ®ï¼›Google Bigtableåˆ©ç”¨Chubbyä½œä¸ºååŒæœåŠ¡ï¼ŒHBASEåˆ©ç”¨Zookeeperä½œä¸ºå¯¹åº”ã€‚ ä¸ä¼ ç»Ÿæ•°æ®åº“å¯¹æ¯”ä¼ ç»Ÿæ•°æ®åº“çš„é—®é¢˜ 1ï¼‰æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™æ— æ³•å­˜å‚¨ 2ï¼‰æ²¡æœ‰å¾ˆå¥½çš„å¤‡ä»½æœºåˆ¶ 3ï¼‰æ•°æ®è¾¾åˆ°ä¸€å®šæ•°é‡å¼€å§‹ç¼“æ…¢ï¼Œå¾ˆå¤§çš„è¯åŸºæœ¬æ— æ³•æ”¯æ’‘ hbaseçš„ä¼˜åŠ¿ 1ï¼‰çº¿æ€§æ‰©å±•ï¼Œéšç€æ•°æ®é‡å¢å¤šå¯ä»¥é€šè¿‡èŠ‚ç‚¹æ‰©å±•è¿›è¡Œæ”¯æ’‘ 2ï¼‰æ•°æ®å­˜å‚¨åœ¨hdfsä¸Šï¼Œå¤‡ä»½æœºåˆ¶å¥å…¨ 3ï¼‰é€šè¿‡zookeeperåè°ƒæŸ¥æ‰¾æ•°æ®ï¼Œè®¿é—®é€Ÿåº¦å¿«ã€‚ hbase é›†ç¾¤ä¸­çš„è§’è‰² ä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸»èŠ‚ç‚¹ï¼ŒHmaster ç®¡ç†ç”¨æˆ·å¯¹Tableè¡¨çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œï¼› ç®¡ç†HRegionæœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œè°ƒæ•´HRegionåˆ†å¸ƒï¼› åœ¨HRegionåˆ†è£‚åï¼Œè´Ÿè´£æ–°HRegionçš„åˆ†é…ï¼› åœ¨HRegionæœåŠ¡å™¨åœæœºåï¼Œè´Ÿè´£å¤±æ•ˆHRegionæœåŠ¡å™¨ä¸Šçš„HRegionè¿ç§»ã€‚ 2ã€å¤šä¸ªä»èŠ‚ç‚¹ï¼ŒHregionServer è¡¨çš„å¢åˆ æ”¹æŸ¥æ•°æ®ã€‚ å’Œhdfsäº¤äº’ï¼Œå­˜å–æ•°æ®ã€‚ zookeeperåœ¨hbase ä¸­ä½œç”¨ ä¿å­˜Hmasterçš„åœ°å€å’Œbackup-masteråœ°å€ ä¿å­˜è¡¨-ROOT-çš„åœ°å€- hbaseé»˜è®¤çš„æ ¹è¡¨ï¼Œæ£€ç´¢è¡¨ã€‚ HRegionServeråˆ—è¡¨ hbaseçš„å®‰è£… ä¸Šä¼ hbaseå®‰è£…åŒ…åˆ°æœåŠ¡å™¨é›†ç¾¤ hbase-x.xx.x.tar.gz è§£å‹ç¼©å®‰è£…åŒ… tar -zxvf hbase-0.94.6.tar.gz é‡å‘½åè§£å‹åç›®å½• mv hbase-0.94.6.hbase ä¿®æ”¹ç¯å¢ƒå˜é‡ 1234567su - rootvi /etc/profile# æ·»åŠ å†…å®¹# export HBASE_HOME=/home/hadoop/hbase# export PATH=$PATH:$HBASE_HOME/binsource /etc/profilesu - hadoop ä¿®æ”¹é…ç½®æ–‡ä»¶ è¿›å…¥ é…ç½®æ–‡ä»¶ç›®å½• 1cd $HABASE_HOME/conf ä¿®æ”¹é…ç½®æ–‡ä»¶ hbase-env.sh (é…ç½®hbaseç¯å¢ƒå˜é‡) 1234export JAVA_HOME=/usr/jdk //jdkå®‰è£…ç›®å½•export JAVA_CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarexport HBASE_CLASSPATH=/home/hadoop/hadoop/conf //hadoopé…ç½®æ–‡ä»¶çš„ä½ç½®export HBASE_MANAGES_ZK=true #å¦‚æœä½¿ç”¨ç‹¬ç«‹å®‰è£…çš„zookeeperè¿™ä¸ªåœ°æ–¹å°±æ˜¯false ä¿®æ”¹é…ç½®æ–‡ä»¶ hbase-site.xml (é…ç½®hbaseé›†ç¾¤) 1234567891011121314151617181920212223242526&lt;configuration&gt; &lt;property&gt; &lt;name&gt;hbase.master&lt;/name&gt; #hbasemasterçš„ä¸»æœºå’Œç«¯å£ &lt;value&gt;master1:60000&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.master.maxclockskew&lt;/name&gt; #æ—¶é—´åŒæ­¥å…è®¸çš„æ—¶é—´å·® &lt;value&gt;180000&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.rootdir&lt;/name&gt; &lt;value&gt;hdfs:// hadoop-cluster1/hbase&lt;/value&gt;#hbaseå…±äº«ç›®å½•ï¼ŒæŒä¹…åŒ–hbaseæ•°æ® &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.cluster.distributed&lt;/name&gt; #æ˜¯å¦åˆ†å¸ƒå¼è¿è¡Œï¼Œfalseå³ä¸ºå•æœº &lt;value&gt;true&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;#zookeeperåœ°å€ &lt;value&gt;slave1, slave2,slave3&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;#zookeeperé…ç½®ä¿¡æ¯å¿«ç…§çš„ä½ç½® &lt;value&gt;/home/hadoop/hbase/tmp/zookeeper&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; ä¿®æ”¹é…ç½®æ–‡ä»¶ regionservers é›†ç¾¤ä»èŠ‚ç‚¹é…ç½® 123slave1slave2slave3 æŠŠhadoopçš„hdfs-site.xmlå’Œcore-site.xml æ”¾åˆ°hbase/confä¸‹ 12cp /home/hadoop/hadoop/etc/hadoop/hdfs-site.xml /home/hadoop/hbase/confcp /home/hadoop/hadoop/etc/hadoop/core-site.xml /home/hadoop/hbase/conf å°†hbaseåˆ†å‘åˆ°å„ä¸ªä¸»æœº 123scp -r /home/hadoop/hbase hadoop@slave1:/home/hadoop/scp -r /home/hadoop/hbase hadoop@slave2:/home/hadoop/scp -r /home/hadoop/hbase hadoop@slave3:/home/hadoop/ å¯åŠ¨hbase 1start-hbase.sh å¤‡æ³¨ï¼š åœ¨masterèŠ‚ç‚¹æ‰§è¡Œ æŸ¥çœ‹çŠ¶æ€ æŸ¥çœ‹hbaseè¿›è¡Œ: jps è¿›å…¥hbase shell : hbase shell é€€å‡ºhbase shell: quit æŸ¥çœ‹hbase web: http://master:60010/ å¯åŠ¨Hmaster ä¸»å¤‡ åœ¨ä»»æ„å®‰è£…äº†hbaseæœºå™¨ä¸Šå¯åŠ¨hmaster 1local-master-backup.sh start 1 æ·»åŠ hbaseèŠ‚ç‚¹ å¤åˆ¶hbaseå®‰è£…ç›®å½•åˆ°æ–°èŠ‚ç‚¹ä¸Š, æ‰§è¡Œå¯åŠ¨å‘½ä»¤ 1hbase-daemon.sh start regionserver hbase æ•°æ®æ¨¡å‹row keyä¸nosqlæ•°æ®åº“ä»¬ä¸€æ ·,row keyæ˜¯ç”¨æ¥æ£€ç´¢è®°å½•çš„ä¸»é”®ã€‚è®¿é—®HBASE tableä¸­çš„è¡Œï¼Œåªæœ‰ä¸‰ç§æ–¹å¼ï¼š 1.é€šè¿‡å•ä¸ªrow keyè®¿é—® 2.é€šè¿‡row keyçš„rangeï¼ˆæ­£åˆ™ï¼‰ 3.å…¨è¡¨æ‰«æ Row keyè¡Œé”® (Row key)å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²(æœ€å¤§é•¿åº¦ æ˜¯ 64KBï¼Œå®é™…åº”ç”¨ä¸­é•¿åº¦ä¸€èˆ¬ä¸º 10-100bytes)ï¼Œåœ¨HBASEå†…éƒ¨ï¼Œrow keyä¿å­˜ä¸ºå­—èŠ‚æ•°ç»„ã€‚å­˜å‚¨æ—¶ï¼Œæ•°æ®æŒ‰ç…§Row keyçš„å­—å…¸åº(byte order)æ’åºå­˜å‚¨ã€‚è®¾è®¡keyæ—¶ï¼Œè¦å……åˆ†æ’åºå­˜å‚¨è¿™ä¸ªç‰¹æ€§ï¼Œå°†ç»å¸¸ä¸€èµ·è¯»å–çš„è¡Œå­˜å‚¨æ”¾åˆ°ä¸€èµ·ã€‚(ä½ç½®ç›¸å…³æ€§) åˆ—ç°‡(Columns Family)åˆ—ç°‡ ï¼šHBASEè¡¨ä¸­çš„æ¯ä¸ªåˆ—ï¼Œéƒ½å½’å±äºæŸä¸ªåˆ—æ—ã€‚åˆ—æ—æ˜¯è¡¨çš„schemaçš„ä¸€éƒ¨ åˆ†(è€Œåˆ—ä¸æ˜¯)ï¼Œå¿…é¡»åœ¨ä½¿ç”¨è¡¨ä¹‹å‰å®šä¹‰ã€‚åˆ—åéƒ½ä»¥åˆ—æ—ä½œä¸ºå‰ç¼€ã€‚ä¾‹å¦‚ courses:historyï¼Œcourses:mathéƒ½å±äºcourses è¿™ä¸ªåˆ—æ—ã€‚ Cellç”±{row key, columnFamily, version} å”¯ä¸€ç¡®å®šçš„å•å…ƒã€‚cellä¸­ çš„æ•°æ®æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼Œå…¨éƒ¨æ˜¯å­—èŠ‚ç å½¢å¼å­˜è´®ã€‚ å…³é”®å­—ï¼šæ— ç±»å‹ã€å­—èŠ‚ç  æ—¶é—´æˆ³(Time Stamp)HBASE ä¸­é€šè¿‡rowkeyå’Œcolumnsç¡®å®šçš„ä¸ºä¸€ä¸ªå­˜è´®å•å…ƒç§°ä¸ºcellã€‚æ¯ä¸ª celléƒ½ä¿å­˜ ç€åŒä¸€ä»½æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ã€‚ç‰ˆæœ¬é€šè¿‡æ—¶é—´æˆ³æ¥ç´¢å¼•ã€‚æ—¶é—´æˆ³çš„ç±»å‹æ˜¯ 64ä½æ•´å‹ã€‚æ—¶é—´æˆ³å¯ä»¥ç”±HBASE(åœ¨æ•°æ®å†™å…¥æ—¶è‡ªåŠ¨ )èµ‹å€¼ï¼Œæ­¤æ—¶æ—¶é—´æˆ³æ˜¯ç²¾ç¡®åˆ°æ¯«ç§’ çš„å½“å‰ç³»ç»Ÿæ—¶é—´ã€‚æ—¶é—´æˆ³ä¹Ÿå¯ä»¥ç”±å®¢æˆ·æ˜¾å¼èµ‹å€¼ã€‚å¦‚æœåº”ç”¨ç¨‹åºè¦é¿å…æ•°æ®ç‰ˆ æœ¬å†²çªï¼Œå°±å¿…é¡»è‡ªå·±ç”Ÿæˆå…·æœ‰å”¯ä¸€æ€§çš„æ—¶é—´æˆ³ã€‚æ¯ä¸ª cellä¸­ï¼Œä¸åŒç‰ˆæœ¬çš„æ•°æ®æŒ‰ç…§æ—¶é—´å€’åºæ’åºï¼Œå³æœ€æ–°çš„æ•°æ®æ’åœ¨æœ€å‰é¢ã€‚ ä¸ºäº†é¿å…æ•°æ®å­˜åœ¨è¿‡å¤šç‰ˆæœ¬é€ æˆçš„çš„ç®¡ç† (åŒ…æ‹¬å­˜è´®å’Œç´¢å¼•)è´Ÿæ‹…ï¼ŒHBASEæä¾› äº†ä¸¤ç§æ•°æ®ç‰ˆæœ¬å›æ”¶æ–¹å¼ã€‚ä¸€æ˜¯ä¿å­˜æ•°æ®çš„æœ€ånä¸ªç‰ˆæœ¬ï¼ŒäºŒæ˜¯ä¿å­˜æœ€è¿‘ä¸€æ®µ æ—¶é—´å†…çš„ç‰ˆæœ¬ï¼ˆæ¯”å¦‚æœ€è¿‘ä¸ƒå¤©ï¼‰ã€‚ç”¨æˆ·å¯ä»¥é’ˆå¯¹æ¯ä¸ªåˆ—æ—è¿›è¡Œè®¾ç½®ã€‚ æ•°æ®æ¨¡å‹ç¤ºæ„å›¾ hbase å‘½ä»¤ åç§° å‘½ä»¤è¡¨è¾¾å¼ åˆ›å»ºè¡¨ create â€˜è¡¨åâ€™, â€˜åˆ—æ—å1â€™,â€™åˆ—æ—å2â€™,â€™åˆ—æ—åNâ€™ æŸ¥çœ‹æ‰€æœ‰è¡¨ list æè¿°è¡¨ describe â€˜è¡¨åâ€™ åˆ¤æ–­è¡¨å­˜åœ¨ exists â€˜è¡¨åâ€™ åˆ¤æ–­æ˜¯å¦ç¦ç”¨å¯ç”¨è¡¨ is_enabled â€˜è¡¨åâ€™ ; is_disabled â€˜è¡¨åâ€™ æ·»åŠ è®°å½• put â€˜è¡¨åâ€™, â€˜rowKeyâ€™, â€˜åˆ—æ— : åˆ—â€˜ , â€˜å€¼â€™ æŸ¥çœ‹è®°å½•rowkeyä¸‹çš„æ‰€æœ‰æ•°æ® get â€˜è¡¨åâ€™ , â€˜rowKeyâ€™ æŸ¥çœ‹è¡¨ä¸­çš„è®°å½•æ€»æ•° count â€˜è¡¨åâ€™ è·å–æŸä¸ªåˆ—æ— get â€˜è¡¨åâ€™,â€™rowkeyâ€™,â€™åˆ—æ—â€™ è·å–æŸä¸ªåˆ—æ—çš„æŸä¸ªåˆ— get â€˜è¡¨åâ€™,â€™rowkeyâ€™,â€™åˆ—æ—ï¼šåˆ—â€™ åˆ é™¤è®°å½• delete â€˜è¡¨åâ€™ ,â€˜è¡Œåâ€™ , â€˜åˆ—æ—ï¼šåˆ—â€™ åˆ é™¤æ•´è¡Œ deleteall â€˜è¡¨åâ€™,â€™rowkeyâ€™ åˆ é™¤ä¸€å¼ è¡¨ å…ˆè¦å±è”½è¯¥è¡¨ï¼Œæ‰èƒ½å¯¹è¯¥è¡¨è¿›è¡Œåˆ é™¤ç¬¬ä¸€æ­¥ disable â€˜è¡¨åâ€™ ï¼Œç¬¬äºŒæ­¥ drop â€˜è¡¨åâ€™ æ¸…ç©ºè¡¨ truncate â€˜è¡¨åâ€˜ æŸ¥çœ‹æ‰€æœ‰è®°å½• scan â€œè¡¨åâ€ æŸ¥çœ‹æŸä¸ªè¡¨æŸä¸ªåˆ—ä¸­æ‰€æœ‰æ•°æ® scan è¡¨åâ€ , {COLUMNS=&gt;â€™åˆ—æ—å:åˆ—åâ€™} æ›´æ–°è®°å½• å°±æ˜¯é‡å†™ä¸€éï¼Œè¿›è¡Œè¦†ç›–ï¼Œhbaseæ²¡æœ‰ä¿®æ”¹ï¼Œéƒ½æ˜¯è¿½åŠ  hbase javaApi æ“ä½œ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351import java.util.ArrayList;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.hbase.Cell;import org.apache.hadoop.hbase.CellUtil;import org.apache.hadoop.hbase.HBaseConfiguration;import org.apache.hadoop.hbase.HColumnDescriptor;import org.apache.hadoop.hbase.HTableDescriptor;import org.apache.hadoop.hbase.MasterNotRunningException;import org.apache.hadoop.hbase.TableName;import org.apache.hadoop.hbase.ZooKeeperConnectionException;import org.apache.hadoop.hbase.client.Connection;import org.apache.hadoop.hbase.client.ConnectionFactory;import org.apache.hadoop.hbase.client.Delete;import org.apache.hadoop.hbase.client.Get;import org.apache.hadoop.hbase.client.HBaseAdmin;import org.apache.hadoop.hbase.client.HConnection;import org.apache.hadoop.hbase.client.HConnectionManager;import org.apache.hadoop.hbase.client.Put;import org.apache.hadoop.hbase.client.Result;import org.apache.hadoop.hbase.client.ResultScanner;import org.apache.hadoop.hbase.client.Scan;import org.apache.hadoop.hbase.client.Table;import org.apache.hadoop.hbase.filter.ColumnPrefixFilter;import org.apache.hadoop.hbase.filter.CompareFilter;import org.apache.hadoop.hbase.filter.FilterList;import org.apache.hadoop.hbase.filter.FilterList.Operator;import org.apache.hadoop.hbase.filter.RegexStringComparator;import org.apache.hadoop.hbase.filter.RowFilter;import org.apache.hadoop.hbase.filter.SingleColumnValueFilter;import org.apache.hadoop.hbase.util.Bytes;import org.junit.After;import org.junit.Before;import org.junit.Test;public class HbaseTest &#123; /** * é…ç½®ss */ static Configuration config = null; private Connection connection = null; private Table table = null; @Before public void init() throws Exception &#123; config = HBaseConfiguration.create();// é…ç½® config.set("hbase.zookeeper.quorum", "master,work1,work2");// zookeeperåœ°å€ config.set("hbase.zookeeper.property.clientPort", "2181");// zookeeperç«¯å£ connection = ConnectionFactory.createConnection(config); table = connection.getTable(TableName.valueOf("user")); &#125; /** * åˆ›å»ºä¸€ä¸ªè¡¨ * * @throws Exception */ @Test public void createTable() throws Exception &#123; // åˆ›å»ºè¡¨ç®¡ç†ç±» HBaseAdmin admin = new HBaseAdmin(config); // hbaseè¡¨ç®¡ç† // åˆ›å»ºè¡¨æè¿°ç±» TableName tableName = TableName.valueOf("test3"); // è¡¨åç§° HTableDescriptor desc = new HTableDescriptor(tableName); // åˆ›å»ºåˆ—æ—çš„æè¿°ç±» HColumnDescriptor family = new HColumnDescriptor("info"); // åˆ—æ— // å°†åˆ—æ—æ·»åŠ åˆ°è¡¨ä¸­ desc.addFamily(family); HColumnDescriptor family2 = new HColumnDescriptor("info2"); // åˆ—æ— // å°†åˆ—æ—æ·»åŠ åˆ°è¡¨ä¸­ desc.addFamily(family2); // åˆ›å»ºè¡¨ admin.createTable(desc); // åˆ›å»ºè¡¨ &#125; @Test @SuppressWarnings("deprecation") public void deleteTable() throws MasterNotRunningException, ZooKeeperConnectionException, Exception &#123; HBaseAdmin admin = new HBaseAdmin(config); admin.disableTable("test3"); admin.deleteTable("test3"); admin.close(); &#125; /** * å‘hbaseä¸­å¢åŠ æ•°æ® * * @throws Exception */ @SuppressWarnings(&#123; "deprecation", "resource" &#125;) @Test public void insertData() throws Exception &#123; table.setAutoFlushTo(false); table.setWriteBufferSize(534534534); ArrayList&lt;Put&gt; arrayList = new ArrayList&lt;Put&gt;(); for (int i = 21; i &lt; 50; i++) &#123; Put put = new Put(Bytes.toBytes("1234"+i)); put.add(Bytes.toBytes("info"), Bytes.toBytes("name"), Bytes.toBytes("wangwu"+i)); put.add(Bytes.toBytes("info"), Bytes.toBytes("password"), Bytes.toBytes(1234+i)); arrayList.add(put); &#125; //æ’å…¥æ•°æ® table.put(arrayList); //æäº¤ table.flushCommits(); &#125; /** * ä¿®æ”¹æ•°æ® * * @throws Exception */ @Test public void uodateData() throws Exception &#123; Put put = new Put(Bytes.toBytes("1234")); put.add(Bytes.toBytes("info"), Bytes.toBytes("namessss"), Bytes.toBytes("lisi1234")); put.add(Bytes.toBytes("info"), Bytes.toBytes("password"), Bytes.toBytes(1234)); //æ’å…¥æ•°æ® table.put(put); //æäº¤ table.flushCommits(); &#125; /** * åˆ é™¤æ•°æ® * * @throws Exception */ @Test public void deleteDate() throws Exception &#123; Delete delete = new Delete(Bytes.toBytes("1234")); table.delete(delete); table.flushCommits(); &#125; /** * å•æ¡æŸ¥è¯¢ * * @throws Exception */ @Test public void queryData() throws Exception &#123; Get get = new Get(Bytes.toBytes("1234")); Result result = table.get(get); System.out.println(Bytes.toInt(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("password")))); System.out.println(Bytes.toString(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("namessss")))); System.out.println(Bytes.toString(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("sex")))); &#125; /** * å…¨è¡¨æ‰«æ * * @throws Exception */ @Test public void scanData() throws Exception &#123; Scan scan = new Scan(); //scan.addFamily(Bytes.toBytes("info")); //scan.addColumn(Bytes.toBytes("info"), Bytes.toBytes("password")); scan.setStartRow(Bytes.toBytes("wangsf_0")); scan.setStopRow(Bytes.toBytes("wangwu")); ResultScanner scanner = table.getScanner(scan); for (Result result : scanner) &#123; System.out.println(Bytes.toInt(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("password")))); System.out.println(Bytes.toString(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("name")))); //System.out.println(Bytes.toInt(result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("password")))); //System.out.println(Bytes.toString(result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("name")))); &#125; &#125; /** * å…¨è¡¨æ‰«æçš„è¿‡æ»¤å™¨ * åˆ—å€¼è¿‡æ»¤å™¨ * * @throws Exception */ @Test public void scanDataByFilter1() throws Exception &#123; // åˆ›å»ºå…¨è¡¨æ‰«æçš„scan Scan scan = new Scan(); //è¿‡æ»¤å™¨ï¼šåˆ—å€¼è¿‡æ»¤å™¨ SingleColumnValueFilter filter = new SingleColumnValueFilter(Bytes.toBytes("info"), Bytes.toBytes("name"), CompareFilter.CompareOp.EQUAL, Bytes.toBytes("zhangsan2")); // è®¾ç½®è¿‡æ»¤å™¨ scan.setFilter(filter); // æ‰“å°ç»“æœé›† ResultScanner scanner = table.getScanner(scan); for (Result result : scanner) &#123; System.out.println(Bytes.toInt(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("password")))); System.out.println(Bytes.toString(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("name")))); //System.out.println(Bytes.toInt(result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("password")))); //System.out.println(Bytes.toString(result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("name")))); &#125; &#125; /** * rowkeyè¿‡æ»¤å™¨ * @throws Exception */ @Test public void scanDataByFilter2() throws Exception &#123; // åˆ›å»ºå…¨è¡¨æ‰«æçš„scan Scan scan = new Scan(); //åŒ¹é…rowkeyä»¥wangsenfengå¼€å¤´çš„ RowFilter filter = new RowFilter(CompareFilter.CompareOp.EQUAL, new RegexStringComparator("^12341")); // è®¾ç½®è¿‡æ»¤å™¨ scan.setFilter(filter); // æ‰“å°ç»“æœé›† ResultScanner scanner = table.getScanner(scan); for (Result result : scanner) &#123; System.out.println(Bytes.toInt(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("password")))); System.out.println(Bytes.toString(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("name")))); //System.out.println(Bytes.toInt(result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("password")))); //System.out.println(Bytes.toString(result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("name")))); &#125; &#125; /** * åŒ¹é…åˆ—åå‰ç¼€ * @throws Exception */ @Test public void scanDataByFilter3() throws Exception &#123; // åˆ›å»ºå…¨è¡¨æ‰«æçš„scan Scan scan = new Scan(); //åŒ¹é…rowkeyä»¥wangsenfengå¼€å¤´çš„ ColumnPrefixFilter filter = new ColumnPrefixFilter(Bytes.toBytes("na")); // è®¾ç½®è¿‡æ»¤å™¨ scan.setFilter(filter); // æ‰“å°ç»“æœé›† ResultScanner scanner = table.getScanner(scan); for (Result result : scanner) &#123; System.out.println("rowkeyï¼š" + Bytes.toString(result.getRow())); System.out.println("info:nameï¼š" + Bytes.toString(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("name")))); // åˆ¤æ–­å–å‡ºæ¥çš„å€¼æ˜¯å¦ä¸ºç©º if (result.getValue(Bytes.toBytes("info"), Bytes.toBytes("age")) != null) &#123; System.out.println("info:ageï¼š" + Bytes.toInt(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("age")))); &#125; // åˆ¤æ–­å–å‡ºæ¥çš„å€¼æ˜¯å¦ä¸ºç©º if (result.getValue(Bytes.toBytes("info"), Bytes.toBytes("sex")) != null) &#123; System.out.println("infi:sexï¼š" + Bytes.toInt(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("sex")))); &#125; // åˆ¤æ–­å–å‡ºæ¥çš„å€¼æ˜¯å¦ä¸ºç©º if (result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("name")) != null) &#123; System.out .println("info2:nameï¼š" + Bytes.toString(result.getValue( Bytes.toBytes("info2"), Bytes.toBytes("name")))); &#125; // åˆ¤æ–­å–å‡ºæ¥çš„å€¼æ˜¯å¦ä¸ºç©º if (result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("age")) != null) &#123; System.out.println("info2:ageï¼š" + Bytes.toInt(result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("age")))); &#125; // åˆ¤æ–­å–å‡ºæ¥çš„å€¼æ˜¯å¦ä¸ºç©º if (result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("sex")) != null) &#123; System.out.println("info2:sexï¼š" + Bytes.toInt(result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("sex")))); &#125; &#125; &#125; /** * è¿‡æ»¤å™¨é›†åˆ * @throws Exception */ @Test public void scanDataByFilter4() throws Exception &#123; // åˆ›å»ºå…¨è¡¨æ‰«æçš„scan Scan scan = new Scan(); //è¿‡æ»¤å™¨é›†åˆï¼šMUST_PASS_ALLï¼ˆandï¼‰,MUST_PASS_ONE(or) FilterList filterList = new FilterList(Operator.MUST_PASS_ONE); //åŒ¹é…rowkeyä»¥wangsenfengå¼€å¤´çš„ RowFilter filter = new RowFilter(CompareFilter.CompareOp.EQUAL, new RegexStringComparator("^wangsenfeng")); //åŒ¹é…nameçš„å€¼ç­‰äºwangsenfeng SingleColumnValueFilter filter2 = new SingleColumnValueFilter(Bytes.toBytes("info"), Bytes.toBytes("name"), CompareFilter.CompareOp.EQUAL, Bytes.toBytes("zhangsan")); filterList.addFilter(filter); filterList.addFilter(filter2); // è®¾ç½®è¿‡æ»¤å™¨ scan.setFilter(filterList); // æ‰“å°ç»“æœé›† ResultScanner scanner = table.getScanner(scan); for (Result result : scanner) &#123; System.out.println("rowkeyï¼š" + Bytes.toString(result.getRow())); System.out.println("info:nameï¼š" + Bytes.toString(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("name")))); // åˆ¤æ–­å–å‡ºæ¥çš„å€¼æ˜¯å¦ä¸ºç©º if (result.getValue(Bytes.toBytes("info"), Bytes.toBytes("age")) != null) &#123; System.out.println("info:ageï¼š" + Bytes.toInt(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("age")))); &#125; // åˆ¤æ–­å–å‡ºæ¥çš„å€¼æ˜¯å¦ä¸ºç©º if (result.getValue(Bytes.toBytes("info"), Bytes.toBytes("sex")) != null) &#123; System.out.println("infi:sexï¼š" + Bytes.toInt(result.getValue(Bytes.toBytes("info"), Bytes.toBytes("sex")))); &#125; // åˆ¤æ–­å–å‡ºæ¥çš„å€¼æ˜¯å¦ä¸ºç©º if (result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("name")) != null) &#123; System.out .println("info2:nameï¼š" + Bytes.toString(result.getValue( Bytes.toBytes("info2"), Bytes.toBytes("name")))); &#125; // åˆ¤æ–­å–å‡ºæ¥çš„å€¼æ˜¯å¦ä¸ºç©º if (result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("age")) != null) &#123; System.out.println("info2:ageï¼š" + Bytes.toInt(result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("age")))); &#125; // åˆ¤æ–­å–å‡ºæ¥çš„å€¼æ˜¯å¦ä¸ºç©º if (result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("sex")) != null) &#123; System.out.println("info2:sexï¼š" + Bytes.toInt(result.getValue(Bytes.toBytes("info2"), Bytes.toBytes("sex")))); &#125; &#125; &#125; @After public void close() throws Exception &#123; table.close(); connection.close(); &#125;&#125; MapReduceæ“ä½œHbaseä»‹ç»hbase å¯¹Mapreduceæä¾›äº†æ”¯æŒï¼Œ å®ƒå®ç°äº†TableMapperç±»å’ŒTableReducerç±»ï¼Œæˆ‘ä»¬åªéœ€è¦ç»§æ‰¿è¿™ä¸¤ä¸ªç±»å³å¯ã€‚ TableMapper: å®ç°äº†ä»hbaseè¯»å–æ•°æ®ï¼Œå¹¶å¯ä»¥å®ç°æŒ‰è¡Œå¤„ç†çš„åŠŸèƒ½ TableReducer: æ¥å—TableMapperçš„å¤„ç†ç»“æœï¼Œå¹¶å¯ä»¥å°†æ•°æ®è¾“å‡ºåˆ°hbaseæ–°çš„è¡¨ä¸Š å®ç°æ–¹æ³• å†™ä¸ªmapperç»§æ‰¿TableMapper&lt;Text, IntWritable&gt; â€‹ å‚æ•°ï¼šTextï¼šmapperçš„è¾“å‡ºkeyç±»å‹ï¼› IntWritableï¼šmapperçš„è¾“å‡ºvalueç±»å‹ã€‚ â€‹ å…¶ä¸­çš„mapæ–¹æ³•å¦‚ä¸‹ï¼š â€‹ map(ImmutableBytesWritable key, Result value,Context context) â€‹ å‚æ•°ï¼škeyï¼šrowKeyï¼›valueï¼š Result ï¼Œä¸€è¡Œæ•°æ®ï¼› contextä¸Šä¸‹æ–‡ å†™ä¸ªreduceç»§æ‰¿TableReducer&lt;Text, IntWritable, ImmutableBytesWritable&gt; â€‹ å‚æ•°ï¼šText:reducerçš„è¾“å…¥keyï¼› IntWritableï¼šreduceçš„è¾“å…¥valueï¼› â€‹ ImmutableBytesWritableï¼šreduceè¾“å‡ºåˆ°hbaseä¸­çš„rowKeyç±»å‹ã€‚ â€‹ å…¶ä¸­çš„reduceæ–¹æ³•å¦‚ä¸‹ï¼š â€‹ reduce(Text key, Iterable values,Context context) â€‹ å‚æ•°ï¼š keyï¼šreduceçš„è¾“å…¥keyï¼›valuesï¼šreduceçš„è¾“å…¥valueï¼› å®ç°ç¤ºä¾‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172import java.io.IOException;import java.util.ArrayList;import java.util.List;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.hbase.HBaseConfiguration;import org.apache.hadoop.hbase.HColumnDescriptor;import org.apache.hadoop.hbase.HTableDescriptor;import org.apache.hadoop.hbase.client.HBaseAdmin;import org.apache.hadoop.hbase.client.HTable;import org.apache.hadoop.hbase.client.Put;import org.apache.hadoop.hbase.client.Result;import org.apache.hadoop.hbase.client.Scan;import org.apache.hadoop.hbase.io.ImmutableBytesWritable;import org.apache.hadoop.hbase.mapreduce.TableMapReduceUtil;import org.apache.hadoop.hbase.mapreduce.TableMapper;import org.apache.hadoop.hbase.mapreduce.TableReducer;import org.apache.hadoop.hbase.util.Bytes;import org.apache.hadoop.io.IntWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;/** * mapreduceæ“ä½œhbase * @author wilson * */public class HBaseMr &#123; /** * åˆ›å»ºhbaseé…ç½® */ static Configuration config = null; static &#123; config = HBaseConfiguration.create(); config.set("hbase.zookeeper.quorum", "slave1,slave2,slave3"); config.set("hbase.zookeeper.property.clientPort", "2181"); &#125; /** * è¡¨ä¿¡æ¯ */ public static final String tableName = "word";//è¡¨å1 public static final String colf = "content";//åˆ—æ— public static final String col = "info";//åˆ— public static final String tableName2 = "stat";//è¡¨å2 /** * åˆå§‹åŒ–è¡¨ç»“æ„ï¼ŒåŠå…¶æ•°æ® */ public static void initTB() &#123; HTable table=null; HBaseAdmin admin=null; try &#123; admin = new HBaseAdmin(config);//åˆ›å»ºè¡¨ç®¡ç† /*åˆ é™¤è¡¨*/ if (admin.tableExists(tableName)||admin.tableExists(tableName2)) &#123; System.out.println("table is already exists!"); admin.disableTable(tableName); admin.deleteTable(tableName); admin.disableTable(tableName2); admin.deleteTable(tableName2); &#125; /*åˆ›å»ºè¡¨*/ HTableDescriptor desc = new HTableDescriptor(tableName); HColumnDescriptor family = new HColumnDescriptor(colf); desc.addFamily(family); admin.createTable(desc); HTableDescriptor desc2 = new HTableDescriptor(tableName2); HColumnDescriptor family2 = new HColumnDescriptor(colf); desc2.addFamily(family2); admin.createTable(desc2); /*æ’å…¥æ•°æ®*/ table = new HTable(config,tableName); table.setAutoFlush(false); table.setWriteBufferSize(500); List&lt;Put&gt; lp = new ArrayList&lt;Put&gt;(); Put p1 = new Put(Bytes.toBytes("1")); p1.add(colf.getBytes(), col.getBytes(), ("The Apache Hadoop software library is a framework").getBytes()); lp.add(p1); Put p2 = new Put(Bytes.toBytes("2"));p2.add(colf.getBytes(),col.getBytes(),("The common utilities that support the other Hadoop modules").getBytes()); lp.add(p2); Put p3 = new Put(Bytes.toBytes("3")); p3.add(colf.getBytes(), col.getBytes(),("Hadoop by reading the documentation").getBytes()); lp.add(p3); Put p4 = new Put(Bytes.toBytes("4")); p4.add(colf.getBytes(), col.getBytes(),("Hadoop from the release page").getBytes()); lp.add(p4); Put p5 = new Put(Bytes.toBytes("5")); p5.add(colf.getBytes(), col.getBytes(),("Hadoop on the mailing list").getBytes()); lp.add(p5); table.put(lp); table.flushCommits(); lp.clear(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; if(table!=null)&#123; table.close(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; /** * MyMapper ç»§æ‰¿ TableMapper * TableMapper&lt;Text,IntWritable&gt; * Text:è¾“å‡ºçš„keyç±»å‹ï¼Œ * IntWritableï¼šè¾“å‡ºçš„valueç±»å‹ */ public static class MyMapper extends TableMapper&lt;Text, IntWritable&gt; &#123; private static IntWritable one = new IntWritable(1); private static Text word = new Text(); @Override //è¾“å…¥çš„ç±»å‹ä¸ºï¼škeyï¼šrowKeyï¼› valueï¼šä¸€è¡Œæ•°æ®çš„ç»“æœé›†Result protected void map(ImmutableBytesWritable key, Result value, Context context) throws IOException, InterruptedException &#123; //è·å–ä¸€è¡Œæ•°æ®ä¸­çš„colfï¼šcol String words = Bytes.toString(value.getValue(Bytes.toBytes(colf), Bytes.toBytes(col)));// è¡¨é‡Œé¢åªæœ‰ä¸€ä¸ªåˆ—æ—ï¼Œæ‰€ä»¥æˆ‘å°±ç›´æ¥è·å–æ¯ä¸€è¡Œçš„å€¼ //æŒ‰ç©ºæ ¼åˆ†å‰² String itr[] = words.toString().split(" "); //å¾ªç¯è¾“å‡ºwordå’Œ1 for (int i = 0; i &lt; itr.length; i++) &#123; word.set(itr[i]); context.write(word, one); &#125; &#125; &#125; /** * MyReducer ç»§æ‰¿ TableReducer * TableReducer&lt;Text,IntWritable&gt; * Text:è¾“å…¥çš„keyç±»å‹ï¼Œ * IntWritableï¼šè¾“å…¥çš„valueç±»å‹ï¼Œ * ImmutableBytesWritableï¼šè¾“å‡ºç±»å‹ï¼Œè¡¨ç¤ºrowkeyçš„ç±»å‹ */ public static class MyReducer extends TableReducer&lt;Text, IntWritable, ImmutableBytesWritable&gt; &#123; @Override protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException &#123; //å¯¹mapperçš„æ•°æ®æ±‚å’Œ int sum = 0; for (IntWritable val : values) &#123;//å åŠ  sum += val.get(); &#125; // åˆ›å»ºputï¼Œè®¾ç½®rowkeyä¸ºå•è¯ Put put = new Put(Bytes.toBytes(key.toString())); // å°è£…æ•°æ® put.add(Bytes.toBytes(colf), Bytes.toBytes(col),Bytes.toBytes(String.valueOf(sum))); //å†™åˆ°hbase,éœ€è¦æŒ‡å®šrowkeyã€put context.write(new ImmutableBytesWritable(Bytes.toBytes(key.toString())),put); &#125; &#125; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; config.set("df.default.name", "hdfs://master:9000/");//è®¾ç½®hdfsçš„é»˜è®¤è·¯å¾„ config.set("hadoop.job.ugi", "hadoop,hadoop");//ç”¨æˆ·åï¼Œç»„ config.set("mapred.job.tracker", "master:9001");//è®¾ç½®jobtrackeråœ¨å“ª //åˆå§‹åŒ–è¡¨ initTB();//åˆå§‹åŒ–è¡¨ //åˆ›å»ºjob Job job = new Job(config, "HBaseMr");//job job.setJarByClass(HBaseMr.class);//ä¸»ç±» //åˆ›å»ºscan Scan scan = new Scan(); //å¯ä»¥æŒ‡å®šæŸ¥è¯¢æŸä¸€åˆ— scan.addColumn(Bytes.toBytes(colf), Bytes.toBytes(col)); //åˆ›å»ºæŸ¥è¯¢hbaseçš„mapperï¼Œè®¾ç½®è¡¨åã€scanã€mapperç±»ã€mapperçš„è¾“å‡ºkeyã€mapperçš„è¾“å‡ºvalue TableMapReduceUtil.initTableMapperJob(tableName, scan, MyMapper.class,Text.class, IntWritable.class, job); //åˆ›å»ºå†™å…¥hbaseçš„reducerï¼ŒæŒ‡å®šè¡¨åã€reducerç±»ã€job TableMapReduceUtil.initTableReducerJob(tableName2, MyReducer.class, job); System.exit(job.waitForCompletion(true) ? 0 : 1); &#125;&#125; hbase åŸç†ç¤ºæ„å›¾ å†™æµç¨‹1ã€ clientå‘hregionserverå‘é€å†™è¯·æ±‚ã€‚ 2ã€ hregionserverå°†æ•°æ®å†™åˆ°hlogï¼ˆwrite ahead logï¼‰ã€‚ä¸ºäº†æ•°æ®çš„æŒä¹…åŒ–å’Œæ¢å¤ã€‚ 3ã€ hregionserverå°†æ•°æ®å†™åˆ°å†…å­˜ï¼ˆmemstoreï¼‰ 4ã€ åé¦ˆclientå†™æˆåŠŸã€‚ æ•°æ®flushè¿‡ç¨‹1ã€ å½“memstoreæ•°æ®è¾¾åˆ°é˜ˆå€¼ï¼ˆé»˜è®¤æ˜¯64Mï¼‰ï¼Œå°†æ•°æ®åˆ·åˆ°ç¡¬ç›˜ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®åˆ é™¤ï¼ŒåŒæ—¶åˆ é™¤Hlogä¸­çš„å†å²æ•°æ®ã€‚ 2ã€ å¹¶å°†æ•°æ®å­˜å‚¨åˆ°hdfsä¸­ã€‚ 3ã€ åœ¨hlogä¸­åšæ ‡è®°ç‚¹ã€‚ æ•°æ®åˆå¹¶è¿‡ç¨‹1ã€ å½“æ•°æ®å—è¾¾åˆ°4å—ï¼Œhmasterå°†æ•°æ®å—åŠ è½½åˆ°æœ¬åœ°ï¼Œè¿›è¡Œåˆå¹¶ 2ã€ å½“åˆå¹¶çš„æ•°æ®è¶…è¿‡256Mï¼Œè¿›è¡Œæ‹†åˆ†ï¼Œå°†æ‹†åˆ†åçš„regionåˆ†é…ç»™ä¸åŒçš„hregionserverç®¡ç† 3ã€ å½“hregionserå®•æœºåï¼Œå°†hregionserverä¸Šçš„hlogæ‹†åˆ†ï¼Œç„¶ååˆ†é…ç»™ä¸åŒçš„hregionserveråŠ è½½ï¼Œä¿®æ”¹.META. 4ã€ æ³¨æ„ï¼šhlogä¼šåŒæ­¥åˆ°hdfs hbase è¯»æµç¨‹1ã€ é€šè¿‡zookeeperå’Œ-ROOT- .META.è¡¨å®šä½hregionserverã€‚ 2ã€ æ•°æ®ä»å†…å­˜å’Œç¡¬ç›˜åˆå¹¶åè¿”å›ç»™client 3ã€ æ•°æ®å—ä¼šç¼“å­˜ hmasterçš„èŒè´£1ã€ç®¡ç†ç”¨æˆ·å¯¹Tableçš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œï¼› 2ã€è®°å½•regionåœ¨å“ªå°Hregion serverä¸Š 3ã€åœ¨Region Splitåï¼Œè´Ÿè´£æ–°Regionçš„åˆ†é…ï¼› 4ã€æ–°æœºå™¨åŠ å…¥æ—¶ï¼Œç®¡ç†HRegion Serverçš„è´Ÿè½½å‡è¡¡ï¼Œè°ƒæ•´Regionåˆ†å¸ƒ 5ã€åœ¨HRegion Serverå®•æœºåï¼Œè´Ÿè´£å¤±æ•ˆHRegion Server ä¸Šçš„Regionsè¿ç§»ã€‚ hregionserver çš„èŒè´£HRegion Serverä¸»è¦è´Ÿè´£å“åº”ç”¨æˆ·I/Oè¯·æ±‚ï¼Œå‘HDFSæ–‡ä»¶ç³»ç»Ÿä¸­è¯»å†™æ•°æ®ï¼Œæ˜¯HBASEä¸­æœ€æ ¸å¿ƒçš„æ¨¡å—ã€‚ HRegion Serverç®¡ç†äº†å¾ˆå¤štableçš„åˆ†åŒºï¼Œä¹Ÿå°±æ˜¯regionã€‚ client èŒè´£Client HBASE Clientä½¿ç”¨HBASEçš„RPCæœºåˆ¶ä¸HMasterå’ŒRegionServerè¿›è¡Œé€šä¿¡ ç®¡ç†ç±»æ“ä½œï¼šClientä¸HMasterè¿›è¡ŒRPCï¼› æ•°æ®è¯»å†™ç±»æ“ä½œï¼šClientä¸HRegionServerè¿›è¡ŒRPCã€‚]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>å¤§æ•°æ®å·¥å…·</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sqoop]]></title>
    <url>%2F2020%2F02%2F14%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2F%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B7%A5%E5%85%B7%2Fsqoop%2F</url>
    <content type="text"><![CDATA[Sqoop çš„ä»‹ç»Sqoopæ¦‚è¿°sqoopæ˜¯apacheæ——ä¸‹ä¸€æ¬¾â€œHadoopå’Œå…³ç³»æ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´ä¼ é€æ•°æ®â€çš„å·¥å…·ã€‚ Apache Sqoopæ˜¯ç”¨æ¥å®ç°ç»“æ„å‹æ•°æ®ï¼ˆå¦‚å…³ç³»æ•°æ®åº“ï¼‰å’ŒHadoopä¹‹é—´è¿›è¡Œæ•°æ®è¿ç§»çš„å·¥å…·ã€‚å®ƒå……åˆ†åˆ©ç”¨äº†MapReduceçš„å¹¶è¡Œç‰¹ç‚¹ä»¥æ‰¹å¤„ç†çš„æ–¹å¼åŠ å¿«æ•°æ®çš„ä¼ è¾“ï¼ŒåŒæ—¶ä¹Ÿå€ŸåŠ©MapReduceå®ç°äº†å®¹é”™ã€‚ å¯¼å…¥æ•°æ®ï¼šMySQLï¼ŒOracleå¯¼å…¥æ•°æ®åˆ°Hadoopçš„HDFSã€HIVEã€HBASEç­‰æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼› å¯¼å‡ºæ•°æ®ï¼šä»Hadoopçš„æ–‡ä»¶ç³»ç»Ÿä¸­å¯¼å‡ºæ•°æ®åˆ°å…³ç³»æ•°æ®åº“ Sqoop æ”¯æŒçš„æ•°æ®åº“ Database version â€“direct support? connect string matches HSQLDB 1.8.0+ No jdbc:hsqldb:*// MySQL 5.0+ Yes jdbc:mysql:// Oracle 10.2.0+ No jdbc:oracle:*// PostgreSQL 8.3+ Yes (import only) jdbc:postgresql:/ å·¥ä½œæœºåˆ¶å°†å¯¼å…¥æˆ–å¯¼å‡ºå‘½ä»¤ç¿»è¯‘æˆmapreduceç¨‹åºæ¥å®ç° åœ¨ç¿»è¯‘å‡ºçš„mapreduceä¸­ä¸»è¦æ˜¯å¯¹inputformatå’Œoutputformatè¿›è¡Œå®šåˆ¶ Sqoopå®‰è£… å®‰è£…sqoopçš„å‰ææ˜¯å·²ç»å…·å¤‡javaå’Œhadoopçš„ç¯å¢ƒ ä¸‹è½½å¹¶è§£å‹: ä¸‹è½½åœ°å€http://ftp.wayne.edu/apache/sqoop/1.4.6/ ä¿®æ”¹é…ç½®æ–‡ä»¶ 1234567cd $SQOOP_HOME/confmv sqoop-env-template.sh sqoop-env.sh# æ‰“å¼€sqoop-env.shå¹¶ç¼–è¾‘ä¸‹é¢å‡ è¡Œï¼šexport HADOOP_COMMON_HOME=/home/hadoop/apps/hadoop-2.6.1/ export HADOOP_MAPRED_HOME=/home/hadoop/apps/hadoop-2.6.1/export HIVE_HOME=/home/hadoop/apps/hive-1.2.1 åŠ å¦‚mysqlçš„jdbcé©±åŠ¨åŒ… 1cp ~/app/hive/lib/mysql-connector-java-5.1.28.jar $SQOOP_HOME/lib/ éªŒè¯å¯åŠ¨ 12cd $SQOOP_HOME/binsqoop-version é¢„æœŸçš„è¾“å‡º: 1234515/12/17 14:52:32 INFO sqoop.Sqoop: Running Sqoop version: 1.4.6Sqoop 1.4.6 git commit id 5b34accaca7de251fc91161733f906af2eddbe83Compiled by abe on Fri Aug 1 11:19:26 PDT 2015 Sqoopå‘½ä»¤ä»‹ç»å‘½ä»¤è¯¦æƒ…1sqoop help 123456789101112131415usage: sqoop COMMAND [ARGS]Available commands:codegen Generate code to interact with database recordscreate-hive-table Import a table definition into Hiveeval Evaluate a SQL statement and display the resultsexport Export an HDFS directory to a database tablehelp List available commandsimport Import a table from a database to HDFSimport-all-tables Import tables from a database to HDFSjob Work with saved jobslist-databases List available databases on a serverlist-tables List available tables in a databasemerge Merge results of incremental importsmetastore Run a standalone Sqoop metastoreversion Display version information æ•°æ®å¯¼å…¥å…³ç³»å‹æ•°æ®åˆ°å¯¼å…¥åˆ°HDFSå‘½ä»¤æ ¼å¼ 1sqoop import (generic-args) (import-args) å‘½ä»¤ç¤ºä¾‹ 1sqoop import --connectjdbc:mysql://192.168.81.176/hivemeta2db --username root -password passwd --table sds é»˜è®¤ç›®å½•æ˜¯/user/${user.name}/${tablename}ï¼Œå¯ä»¥é€šè¿‡â€“target-dirè®¾ç½®hdfsä¸Šçš„ç›®æ ‡ç›®å½•ã€‚ å¯ä»¥é€šè¿‡â€“mè®¾ç½®å¹¶è¡Œæ•°æ®ï¼Œå³mapçš„æ•°æ®ï¼Œå†³å®šæ–‡ä»¶çš„ä¸ªæ•°ã€‚ å¦‚æœæƒ³è¦å°†æ•´ä¸ªæ•°æ®åº“ä¸­çš„è¡¨å…¨éƒ¨å¯¼å…¥åˆ°hdfsä¸Šï¼Œå¯ä»¥ä½¿ç”¨import-all-tableså‘½ä»¤ å¦‚æœæƒ³è¦æŒ‡å®šæ‰€éœ€çš„åˆ—, ä½¿ç”¨â€“columns å‚æ•°, å¤šä¸ªå­—æ®µæœ‰,éš”å¼€ å¦‚æœæƒ³å¯¼å‡ºä¸ºSequenceFiles, ä½¿ç”¨â€“as-sequencefileå‚æ•°ï¼Œä¸ºç±»æ–‡ä»¶å‘½åä½¿ç”¨â€“class-nameå‚æ•° å¯¼å‡ºæ–‡æœ¬å¯ä»¥æŒ‡å®šåˆ†éš”ç¬¦, â€“fields-terminated-by,â€“lines-terminated-by, â€“optionally-enclosed-by æŒ‡å®šè¿‡æ»¤æ¡ä»¶, ç¤ºä¾‹ï¼š â€“where â€œsd_id &gt; 100â€ HDFSå¯¼å‡ºåˆ°å…³ç³»å‹æ•°æ®åº“å‘½ä»¤æ ¼å¼ 1sqoop export (generic-args) (export-args) å‘½ä»¤ç¤ºä¾‹ 1sqoop export --connect jdbc:mysql://192.168.81.176/sqoop --username root -password passwd --table sds --export-dir /user/guojian/sds sqoopäº‹åŠ¡ ä¸Šä¾‹ä¸­sqoopæ•°æ®ä¸­çš„sdsè¡¨éœ€è¦å…ˆæŠŠè¡¨ç»“æ„åˆ›å»ºå‡ºæ¥ï¼Œå¦åˆ™exportæ“ä½œä¼šç›´æ¥å¤±è´¥ã€‚ ç”±äºsqoopæ˜¯é€šè¿‡mapå®Œæˆæ•°æ®çš„å¯¼å…¥ï¼Œå„ä¸ªmapè¿‡ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰äº‹ç‰©çš„æ¦‚å¿µï¼Œå¯èƒ½ä¼šæœ‰éƒ¨åˆ†mapæ•°æ®å¯¼å…¥å¤±è´¥çš„æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œsqoopä¸­æœ‰ä¸€ä¸ªæŠ˜ä¸­çš„åŠæ³•ï¼Œå³æ˜¯æŒ‡å®šä¸­é—´ staging è¡¨ï¼ŒæˆåŠŸåå†ç”±ä¸­é—´è¡¨å¯¼å…¥åˆ°ç»“æœè¡¨ã€‚ è¿™ä¸€åŠŸèƒ½æ˜¯é€šè¿‡ â€“staging-table staging-table-name æŒ‡å®šï¼ŒåŒæ—¶stagingè¡¨ç»“æ„ä¹Ÿæ˜¯éœ€è¦æå‰åˆ›å»ºå‡ºæ¥çš„: éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ â€“direct ï¼Œ â€“update-key æˆ–è€…â€“callå­˜å‚¨è¿‡ç¨‹çš„é€‰é¡¹æ—¶ï¼Œstagingä¸­é—´è¡¨æ˜¯ä¸å¯ç”¨çš„ã€‚ ç»“æœéªŒè¯: æ•°æ®ä¼šé¦–å…ˆå†™åˆ°sds_tmpè¡¨ï¼Œå¯¼å…¥æ“ä½œæˆåŠŸåï¼Œå†ç”±sds_tmpè¡¨å¯¼å…¥åˆ°sdsç»“æœè¡¨ä¸­ï¼ŒåŒæ—¶ä¼šæ¸…é™¤sds_tmpè¡¨ã€‚ å¦‚æœæœ‰mapå¤±è´¥ï¼Œåˆ™æˆåŠŸçš„mapä¼šå°†æ•°æ®å†™å…¥tmpè¡¨ï¼Œexportä»»åŠ¡å¤±è´¥ï¼ŒåŒæ—¶tmpè¡¨çš„æ•°æ®ä¼šè¢«ä¿ç•™ã€‚ å¦‚æœtmpä¸­å·²æœ‰æ•°æ®ï¼Œåˆ™æ­¤exportæ“ä½œä¼šç›´æ¥å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨ â€“clear-staging-table æŒ‡å®šåœ¨æ‰§è¡Œå‰æ¸…é™¤ä¸­é—´è¡¨ã€‚ export é€‰é¡¹ å‚æ•° è¯´æ˜ â€“direct ç›´æ¥ä½¿ç”¨ mysqlimport å·¥å…·å¯¼å…¥mysql â€“export-dir éœ€è¦exportçš„hdfsæ•°æ®è·¯å¾„ -m,â€“num-mappers å¹¶è¡Œexportçš„mapä¸ªæ•°n â€“table å¯¼å‡ºåˆ°çš„ç›®æ ‡è¡¨ â€“call è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ â€“update-key æŒ‡å®šéœ€è¦æ›´æ–°çš„åˆ—åï¼Œå¯ä»¥å°†æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨çš„æ•°æ®è¿›è¡Œæ›´æ–° â€“update-mode æ›´æ–°æ¨¡å¼ï¼ŒåŒ…æ‹¬ updateonly (é»˜è®¤ï¼‰å’Œallowinsert å‰è€…åªå…è®¸æ›´æ–°ï¼Œåè€…å…è®¸æ–°çš„åˆ—æ•°æ®å†™å…¥ â€“input-null-string The string to be interpreted as null for string columns â€“input-null-non-string The string to be interpreted as null for non-string columns â€“staging-table æŒ‡å®šä¸­é—´stagingè¡¨ â€“clear-staging-table æ‰§è¡Œexportå‰å°†ä¸­é—´stagingè¡¨æ•°æ®æ¸…é™¤ â€“batch Use batch mode for underlying statement execution. å…³ç³»å‹æ•°æ®åº“å¯¼å…¥åˆ°HIVEä¸­å‘½ä»¤æ ¼å¼ 1sqoop import (generic-args) (create-args) è¦æŒ‡å®šâ€“hive-import å‚æ•° å‘½ä»¤ç¤ºä¾‹ 1bin/sqoop import --connect jdbc:mysql://hdp-node-01:3306/test --username root --password root --table emp --hive-import --m 1 åœ¨å¯¼å…¥è¡¨æ•°æ®åˆ°HDFSä½¿ç”¨Sqoopå¯¼å…¥å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šç›®æ ‡ç›®å½•ã€‚ç”¨â€“target-dir å‚æ•°ï¼Œæ¥åˆ›å»ºå¤–éƒ¨è¡¨ å…¶ä»–å‘½ä»¤åˆ—å‡ºæ•°æ®åº“ä¸­æ‰€æœ‰åº“å‘½ä»¤ç¤ºä¾‹ 1sqoop list-databases --connect jdbc:mysql://192.168.81.176/ --username root -password passwd åˆ—å‡ºæ•°æ®åº“ä¸­æ‰€æœ‰è¡¨å‘½ä»¤ç¤ºä¾‹ 1sqoop list-tables --connect jdbc:mysql://192.168.81.176/sqoop --username root -password passwd sqoop jobjob ç›¸å…³å‚æ•° å‚æ•° è¯´æ˜ â€“create åˆ›ä¸šä¸€ä¸ªæ–°çš„sqoopä½œä¸š. â€“delete åˆ é™¤ä¸€ä¸ªsqoop job â€“exec æ‰§è¡Œä¸€ä¸ª â€“create ä¿å­˜çš„ä½œä¸š â€“show æ˜¾ç¤ºä¸€ä¸ªä½œä¸šçš„å‚æ•° â€“list æ˜¾ç¤ºæ‰€æœ‰åˆ›å»ºçš„sqoopä½œä¸š åˆ›å»ºjob 1sqoop job --create myimportjob -- import --connectjdbc:mysql://192.168.81.176/hivemeta2db --username root -password passwd --table TBLS æŸ¥çœ‹job 12 æ£€æŸ¥job 1sqoop job --show myjob æ‰§è¡Œjob 1sqoop job --exec myjob]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>å¤§æ•°æ®å·¥å…·</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[azkaban]]></title>
    <url>%2F2020%2F02%2F14%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2F%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B7%A5%E5%85%B7%2Fazkaban%2F</url>
    <content type="text"><![CDATA[azkaban ä»‹ç»ä¸ºç”šä¹ˆä½¿ç”¨azkabanå·¥ä½œæµè°ƒåº¦ ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åˆ†æç³»ç»Ÿé€šå¸¸éƒ½æ˜¯ç”±å¤§é‡ä»»åŠ¡å•å…ƒç»„æˆï¼š shellè„šæœ¬ç¨‹åºï¼Œjavaç¨‹åºï¼Œmapreduceç¨‹åºã€hiveè„šæœ¬ç­‰ å„ä»»åŠ¡å•å…ƒä¹‹é—´å­˜åœ¨æ—¶é—´å…ˆååŠå‰åä¾èµ–å…³ç³» ä¸ºäº†å¾ˆå¥½åœ°ç»„ç»‡èµ·è¿™æ ·çš„å¤æ‚æ‰§è¡Œè®¡åˆ’ï¼Œéœ€è¦ä¸€ä¸ªå·¥ä½œæµè°ƒåº¦ç³»ç»Ÿæ¥è°ƒåº¦æ‰§è¡Œï¼› ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼ŒæŸä¸ªä¸šåŠ¡ç³»ç»Ÿæ¯å¤©äº§ç”Ÿ20GåŸå§‹æ•°æ®ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½è¦å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå¤„ç†æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š é€šè¿‡Hadoopå…ˆå°†åŸå§‹æ•°æ®åŒæ­¥åˆ°HDFSä¸Šï¼› å€ŸåŠ©MapReduceè®¡ç®—æ¡†æ¶å¯¹åŸå§‹æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œç”Ÿæˆçš„æ•°æ®ä»¥åˆ†åŒºè¡¨çš„å½¢å¼å­˜å‚¨åˆ°å¤šå¼ Hiveè¡¨ä¸­ï¼› éœ€è¦å¯¹Hiveä¸­å¤šä¸ªè¡¨çš„æ•°æ®è¿›è¡ŒJOINå¤„ç†ï¼Œå¾—åˆ°ä¸€ä¸ªæ˜ç»†æ•°æ®Hiveå¤§è¡¨ï¼› å°†æ˜ç»†æ•°æ®è¿›è¡Œå¤æ‚çš„ç»Ÿè®¡åˆ†æï¼Œå¾—åˆ°ç»“æœæŠ¥è¡¨ä¿¡æ¯ï¼› éœ€è¦å°†ç»Ÿè®¡åˆ†æå¾—åˆ°çš„ç»“æœæ•°æ®åŒæ­¥åˆ°ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œä¾›ä¸šåŠ¡è°ƒç”¨ä½¿ç”¨ã€‚ å·¥ä½œæµè°ƒåº¦å®ç°æ–¹å¼ ç®€å•çš„ä»»åŠ¡è°ƒåº¦ï¼š ç›´æ¥ä½¿ç”¨linuxçš„crontabæ¥å®šä¹‰ è´Ÿè½½çš„ä»»åŠ¡è°ƒåº¦: 1. å¼€å‘è°ƒåº¦å¹³å°; 2. ä½¿ç”¨è´¤è‡£çš„å¼€æºè°ƒåº¦ç³»ç»Ÿ, æ¯”å¦‚ooizeã€azkabanç­‰ï¼› Azkabanç®€ä»‹Azkabanæ˜¯ç”±Linkedinå¼€æºçš„ä¸€æ­Œæ‰¹é‡å·¥ä½œæµä»»åŠ¡è°ƒåº¦å™¨ã€‚ç”¨äºåœ¨ä¸€ä¸ªå·¥ä½œæµå†…ä»¥ä¸€ä¸ªç‰¹å®šçš„é¡ºåºè¿è¡Œä¸€ç»„å·¥ä½œå’Œæµç¨‹ã€‚Azkabanå®šä¹‰äº†ä¸€ç§KVæ–‡ä»¶æ ¼å¼æ¥å»ºç«‹ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œ å¹¶æä¾›ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„webç”¨æˆ·ç•Œé¢ç»´æŠ¤å’Œè·Ÿè¸ªä½ çš„å·¥ä½œæµï¼› å…¶æœ‰å¦‚ä¸‹åŠŸèƒ½ç‰¹ç‚¹ï¼š Webç”¨æˆ·ç•Œé¢ æ–¹ä¾¿ä¸Šä¼ å·¥ä½œæµ æ–¹ä¾¿è®¾ç½®ä»»åŠ¡ä¹‹é—´çš„å…³ç³» è°ƒåº¦å·¥ä½œæµ è®¤è¯/æˆæƒ(æƒé™çš„å·¥ä½œ) èƒ½å¤Ÿæ€æ­»å¹¶é‡æ–°å¯åŠ¨å·¥ä½œæµ æ¨¡å—åŒ–å’Œå¯æ’æ‹”çš„æ’ä»¶æœºåˆ¶ é¡¹ç›®å·¥ä½œåŒº å·¥ä½œæµå’Œä»»åŠ¡çš„æ—¥å¿—è®°å½•å’Œå®¡è®¡ Azkabanå®‰è£…å°†å®‰è£…æ–‡ä»¶ä¸Šä¼ åˆ°é›†ç¾¤ï¼Œæœ€å¥½ä¸Šä¼ åˆ°å®‰è£…äº†hiveã€sqoopçš„æœºå™¨ä¸Šï¼Œæ–¹ä¾¿å‘½ä»¤çš„æ‰§è¡Œ åœ¨å½“å‰ç”¨æˆ·ç›®å½•ä¸‹æ–°å»ºazkabantoolsç›®å½•ï¼Œç”¨äºå­˜æ”¾æºå®‰è£…æ–‡ä»¶ï¼Œæ–°å»ºazkabanç›®å½•ï¼Œç”¨äºå­˜æ”¾azkabanè¿è¡Œç¨‹åºï¼› azkaban web æœåŠ¡å™¨å®‰è£… ä¸‹è½½å®‰è£…åŒ…: azkaban-web-server-2.5.0.tar.gz è§£å‹å®‰è£…åŒ…: tar -zxvf azkaban-web-server-2.5.0.tar.gz å°†å‹ç¼©åçš„ azkaban-web-server-2.5.0 ç§»åŠ¨åˆ° azkabanç›®å½•ä¸­, å¹¶é‡æ–°å‘½åä¸ºwebserver mv azkaban-web-server-2.5.0 ../azkaban/server azkaban æ‰§è¡ŒæœåŠ¡å™¨å®‰è£… ä¸‹è½½å®‰è£…åŒ…: azkaban-executor-server-2.5.0.tar.gz è§£å‹å®‰è£…åŒ…: tar -zxvf azkaban-executor-server-2.5.0.tar.gz å°†è§£å‹åçš„azkaban-executor-server-2.5.0 ç§»åŠ¨åˆ° azkabanç›®å½•ä¸­,å¹¶é‡æ–°å‘½å executor mv azkaban-executor-server-2.5.0 ../azkaban/executor azkaban è„šæœ¬å¯¼å…¥azkaban æ‰§è¡Œè®¡åˆ’æ˜¯é€šè¿‡é…ç½®åœ¨æ•°æ®åº“ä¸­çš„ä»»åŠ¡æ¥è¿›è¡Œè°ƒåº¦çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆå§‹åŒ–æ•°æ®åº“çš„ä»»åŠ¡ç›¸å…³çš„è¡¨ç»“æ„ ä¸‹è½½è„šæœ¬: azkaban-sql-script-2.5.0.tar.gz è§£å‹æ•°æ®åº“è„šæœ¬: tar â€“zxvf azkaban-sql-script-2.5.0.tar.gz å°†è§£å‹åçš„mysqlè„šæœ¬ï¼Œå¯¼å…¥åˆ°mysqlä¸­: 1234mysql&gt; create database azkaban;mysql&gt; use azkaban;Database changedmysql&gt; source /home/hadoop/azkaban-2.5.0/create-all-sql-2.5.0.sql; åˆ›å»ºSSLé…ç½®å‚è€ƒåœ°å€: http://docs.codehaus.org/display/JETTY/How+to+configure+SSL å‘½ä»¤ï¼š keytool -keystore keystore -alias jetty -genkey -keyalg RSA è¿è¡Œæ­¤å‘½ä»¤å,ä¼šæç¤ºè¾“å…¥å½“å‰ç”Ÿæˆ keystorçš„å¯†ç åŠç›¸åº”ä¿¡æ¯,è¾“å…¥çš„å¯†ç è¯·åŠ³è®°,ä¿¡æ¯å¦‚ä¸‹: è¾“å…¥keystoreå¯†ç ï¼š å†æ¬¡è¾“å…¥æ–°å¯†ç : æ‚¨çš„åå­—ä¸å§“æ°æ˜¯ä»€ä¹ˆï¼Ÿ [Unknown]ï¼š æ‚¨çš„ç»„ç»‡å•ä½åç§°æ˜¯ä»€ä¹ˆï¼Ÿ [Unknown]ï¼š æ‚¨çš„ç»„ç»‡åç§°æ˜¯ä»€ä¹ˆï¼Ÿ [Unknown]ï¼š æ‚¨æ‰€åœ¨çš„åŸå¸‚æˆ–åŒºåŸŸåç§°æ˜¯ä»€ä¹ˆï¼Ÿ [Unknown]ï¼š æ‚¨æ‰€åœ¨çš„å·æˆ–çœä»½åç§°æ˜¯ä»€ä¹ˆï¼Ÿ [Unknown]ï¼š è¯¥å•ä½çš„ä¸¤å­—æ¯å›½å®¶ä»£ç æ˜¯ä»€ä¹ˆ [Unknown]ï¼š CN CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=CN æ­£ç¡®å—ï¼Ÿ [å¦]ï¼š y è¾“å…¥&lt;jetty&gt;çš„ä¸»å¯†ç  â€‹ ï¼ˆå¦‚æœå’Œ keystore å¯†ç ç›¸åŒï¼ŒæŒ‰å›è½¦ï¼‰ï¼š å†æ¬¡è¾“å…¥æ–°å¯†ç : å®Œæˆä¸Šè¿°å·¥ä½œå,å°†åœ¨å½“å‰ç›®å½•ç”Ÿæˆ keystore è¯ä¹¦æ–‡ä»¶,å°†keystore è€ƒè´åˆ° azkaban webæœåŠ¡å™¨æ ¹ç›®å½•ä¸­.å¦‚:cp keystore azkaban/webserver é…ç½®æ—¶åŒºå…ˆé…ç½®å¥½æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šçš„æ—¶åŒº å…ˆç”Ÿæˆæ—¶åŒºé…ç½®æ–‡ä»¶Asia/Shanghai, ç”¨äº¤äº’å¼å‘½ä»¤tzselectå³å¯ æ‹·è´æ”¹æ—¶é—´æ–‡ä»¶ï¼Œè¦†ç›–ç³»ç»Ÿæœ¬åœ°çš„æ—¶åŒºé…ç½® cp xxx /usr/share/zoneinfo/Aisa/Shanghai/etc/localtime é…ç½®æ–‡ä»¶ azkaban webæœåŠ¡å™¨é…ç½® è¿›å…¥azkaban webæœåŠ¡å™¨å®‰è£…ç›®å½• confç›®å½• ä¿®æ”¹azkaban.propertiesæ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#Azkaban Personalization Settingsazkaban.name=Test #æœåŠ¡å™¨UIåç§°,ç”¨äºæœåŠ¡å™¨ä¸Šæ–¹æ˜¾ç¤ºçš„åå­—azkaban.label=My Local Azkaban #æè¿°azkaban.color=#FF3601 #UIé¢œè‰²azkaban.default.servlet.path=/index #web.resource.dir=web/ #é»˜è®¤æ ¹webç›®å½•default.timezone.id=Asia/Shanghai #é»˜è®¤æ—¶åŒº,å·²æ”¹ä¸ºäºšæ´²/ä¸Šæµ· é»˜è®¤ä¸ºç¾å›½ #Azkaban UserManager classuser.manager.class=azkaban.user.XmlUserManager #ç”¨æˆ·æƒé™ç®¡ç†é»˜è®¤ç±»user.manager.xml.file=conf/azkaban-users.xml #ç”¨æˆ·é…ç½®,å…·ä½“é…ç½®å‚åŠ ä¸‹æ–‡ #Loader for projectsexecutor.global.properties=conf/global.properties # globalé…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®azkaban.project.dir=projects # database.type=mysql #æ•°æ®åº“ç±»å‹mysql.port=3306 #ç«¯å£å·mysql.host=hadoop03 #æ•°æ®åº“è¿æ¥IPmysql.database=azkaban #æ•°æ®åº“å®ä¾‹åmysql.user=root #æ•°æ®åº“ç”¨æˆ·åmysql.password=root #æ•°æ®åº“å¯†ç mysql.numconnections=100 #æœ€å¤§è¿æ¥æ•° # Velocity dev modevelocity.dev.mode=false# JettyæœåŠ¡å™¨å±æ€§.jetty.maxThreads=25 #æœ€å¤§çº¿ç¨‹æ•°jetty.ssl.port=8443 #Jetty SSLç«¯å£jetty.port=8081 #Jettyç«¯å£jetty.keystore=keystore #SSLæ–‡ä»¶åjetty.password=123456 #SSLæ–‡ä»¶å¯†ç jetty.keypassword=123456 #Jettyä¸»å¯†ç  ä¸ keystoreæ–‡ä»¶ç›¸åŒjetty.truststore=keystore #SSLæ–‡ä»¶åjetty.trustpassword=123456 # SSLæ–‡ä»¶å¯†ç  # æ‰§è¡ŒæœåŠ¡å™¨å±æ€§executor.port=12321 #æ‰§è¡ŒæœåŠ¡å™¨ç«¯å£ # é‚®ä»¶è®¾ç½®mail.sender=xxxxxxxx@163.com #å‘é€é‚®ç®±mail.host=smtp.163.com #å‘é€é‚®ç®±smtpåœ°å€mail.user=xxxxxxxx #å‘é€é‚®ä»¶æ—¶æ˜¾ç¤ºçš„åç§°mail.password=********** #é‚®ç®±å¯†ç job.failure.email=xxxxxxxx@163.com #ä»»åŠ¡å¤±è´¥æ—¶å‘é€é‚®ä»¶çš„åœ°å€job.success.email=xxxxxxxx@163.com #ä»»åŠ¡æˆåŠŸæ—¶å‘é€é‚®ä»¶çš„åœ°å€lockdown.create.projects=false #cache.directory=cache #ç¼“å­˜ç›®å½• azkaban æ‰§è¡ŒæœåŠ¡å™¨é…ç½® è¿›å…¥æ‰§è¡ŒæœåŠ¡å™¨å®‰è£…ç›®å½•conf,ä¿®æ”¹azkaban.properties azkaban.properties æ–‡ä»¶ 1234567891011121314151617181920212223#Azkabandefault.timezone.id=Asia/Shanghai #æ—¶åŒº # Azkaban JobTypes æ’ä»¶é…ç½®azkaban.jobtype.plugin.dir=plugins/jobtypes #jobtype æ’ä»¶æ‰€åœ¨ä½ç½® #Loader for projectsexecutor.global.properties=conf/global.propertiesazkaban.project.dir=projects #æ•°æ®åº“è®¾ç½®database.type=mysql #æ•°æ®åº“ç±»å‹(ç›®å‰åªæ”¯æŒmysql)mysql.port=3306 #æ•°æ®åº“ç«¯å£å·mysql.host=192.168.20.200 #æ•°æ®åº“IPåœ°å€mysql.database=azkaban #æ•°æ®åº“å®ä¾‹åmysql.user=azkaban #æ•°æ®åº“ç”¨æˆ·åmysql.password=oracle #æ•°æ®åº“å¯†ç mysql.numconnections=100 #æœ€å¤§è¿æ¥æ•° # æ‰§è¡ŒæœåŠ¡å™¨é…ç½®executor.maxThreads=50 #æœ€å¤§çº¿ç¨‹æ•°executor.port=12321 #ç«¯å£å·(å¦‚ä¿®æ”¹,è¯·ä¸webæœåŠ¡ä¸­ä¸€è‡´)executor.flow.threads=30 #çº¿ç¨‹æ•° ç”¨æˆ·é…ç½® è¿›å…¥azkaban webæœåŠ¡å™¨confç›®å½•,ä¿®æ”¹azkaban-users.xmlï¼Œ å¢åŠ ç®¡ç†å‘˜ç”¨æˆ· azkaban-users.xml æ–‡ä»¶ 1234567&lt;azkaban-users&gt; &lt;user username="azkaban" password="azkaban" roles="admin" groups="azkaban" /&gt; &lt;user username="metrics" password="metrics" roles="metrics"/&gt; &lt;user username="admin" password="admin" roles="admin,metrics" /&gt; &lt;role name="admin" permissions="ADMIN" /&gt; &lt;role name="metrics" permissions="METRICS"/&gt;&lt;/azkaban-users&gt; Azkabanå¯åŠ¨ å¯åŠ¨webæœåŠ¡å™¨ åœ¨azkaban web æ ¹ç›®å½•è¿è¡Œï¼ŒæœåŠ¡å™¨ç›®å½•ä¸‹æ‰§è¡Œå¯åŠ¨å‘½ä»¤ bin/azkaban-web-start.sh å¯åŠ¨æ‰§è¡ŒæœåŠ¡å™¨ åœ¨æ‰§è¡ŒæœåŠ¡å™¨ç›®å½•ä¸‹æ‰§è¡Œå¯åŠ¨å‘½ä»¤, åœ¨æ‰§è¡ŒæœåŠ¡å™¨æ ¹ç›®å½•è¿è¡Œ bin/azkaban-executor-start.sh æµè§ˆå™¨è®¿é—®web æœåŠ¡ åœ¨æµè§ˆå™¨(å»ºè®®ä½¿ç”¨è°·æ­Œæµè§ˆå™¨)ä¸­è¾“å…¥https://æœåŠ¡å™¨IPåœ°å€:8443 ,å³å¯è®¿é—®azkabanæœåŠ¡äº†.åœ¨ç™»å½•ä¸­è¾“å…¥åˆšæ‰æ–°çš„æˆ·ç”¨ååŠå¯†ç ,ç‚¹å‡» login. Azkabanå®æˆ˜Azkabaå†…ç½®çš„ä»»åŠ¡ç±»å‹æ”¯æŒcommandã€java Commandç±»å‹â€“å•ä¸€jobç¤ºä¾‹ åˆ›å»ºjobæè¿°æ–‡ä»¶ vi command.job 123#command.jobtype=command command=echo 'hello' å°†jobèµ„æºæ–‡ä»¶æ‰“åŒ…æˆzipæ–‡ä»¶ zip command.job é€šè¿‡azkabançš„webç®¡ç†å¹³å°åˆ›å»ºprojectå¹¶ä¸Šä¼ jobå‹ç¼©åŒ… é¦–å…ˆåˆ›å»ºproject ä¸Šä¼ zipåŒ… å¯åŠ¨æ‰§è¡Œè¯¥job Command ç±»å‹â€“å¤šjobå·¥ä½œæµflow åˆ›å»ºæœ‰ä¾èµ–å…³ç³»çš„å¤šjobæè¿° ç¬¬ä¸€ä¸ªjob: foo.job 123# foo.jobtype=commandcommand=echo foo ç¬¬äºŒä¸ªjob: bar.job ä¾èµ–foo.job 1234# bar.jobtype=commanddependencies=foocommand=echo bar å°†æ‰€æœ‰jobèµ„æºæ–‡ä»¶æ‰“åˆ°ä¸€ä¸ªzipåŒ…ä¸­ åœ¨azkabançš„webç®¡ç†ç•Œé¢åˆ›å»ºå·¥ç¨‹ï¼Œå¹¶ä¸Šä¼ zipåŒ… å¯åŠ¨å·¥ä½œæµflow HDFSæ“ä½œäººç‰© åˆ›å»ºjobæè¿°æ–‡ä»¶ 1234# bar.jobtype=commanddependencies=foocommand=echo bar å°†jobèµ„æºæ–‡ä»¶æ‰“åŒ…æˆzipæ–‡ä»¶ é€šè¿‡azkabançš„webç®¡ç†å¹³å°åˆ›å»ºprojectå¹¶ä¸Šä¼ jobå‹ç¼©åŒ… å¯åŠ¨æ‰§è¡Œè¯¥job MAPREDUCE ä»»åŠ¡Mrä»»åŠ¡ä¾ç„¶å¯ä»¥ä½¿ç”¨commandçš„jobç±»å‹æ¥æ‰§è¡Œ åˆ›å»º1ã€jobæè¿°æ–‡ä»¶ï¼ŒåŠmrç¨‹åºjaråŒ…ï¼ˆç¤ºä¾‹ä¸­ç›´æ¥ä½¿ç”¨hadoopè‡ªå¸¦çš„example jarï¼‰ 123# mrwc.jobtype=commandcommand=/home/hadoop/apps/hadoop-2.6.1/bin/hadoop jar hadoop-mapreduce-examples-2.6.1.jar wordcount /wordcount/input /wordcount/azout å°†æ‰€æœ‰jobèµ„æºæ–‡ä»¶æ‰“åˆ°ä¸€ä¸ªzipåŒ…ä¸­ åœ¨azkabançš„webç®¡ç†ç•Œé¢åˆ›å»ºå·¥ç¨‹å¹¶ä¸Šä¼ zipåŒ… å¯åŠ¨job HIVEè„šæœ¬ä»»åŠ¡ åˆ›å»ºhiveè„šæœ¬ test.sql 123456use default;drop table aztest;create table aztest(id int,name string) row format delimited fields terminated by ',';load data inpath '/aztest/hiveinput' into table aztest;create table azres as select * from aztest;insert overwrite directory '/aztest/hiveoutput' select count(1) from aztest; åˆ›å»ºjobæè¿°æ–‡ä»¶: hievf.job 123# hivef.jobtype=commandcommand=/home/hadoop/apps/hive/bin/hive -f 'test.sql' å°†æ‰€æœ‰jobèµ„æºæ–‡ä»¶æ‰“åˆ°ä¸€ä¸ªzipåŒ…ä¸­ åœ¨azkabançš„webç®¡ç†ç•Œé¢åˆ›å»ºå·¥ç¨‹å¹¶ä¸Šä¼ zipåŒ… å¯åŠ¨job]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>å¤§æ•°æ®å·¥å…·</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[flume]]></title>
    <url>%2F2020%2F02%2F13%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2F%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B7%A5%E5%85%B7%2Fflume%2F</url>
    <content type="text"><![CDATA[Flumeä»‹ç»æ¦‚è¿° Flumeæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€å¯é ã€å’Œé«˜å¯ç”¨çš„æµ·é‡æ—¥å¿—é‡‡é›†ã€èšåˆå’Œä¼ è¾“çš„ç³»ç»Ÿã€‚ Flumeå¯ä»¥é‡‡é›†æ–‡ä»¶ï¼Œsocketæ•°æ®åŒ…ç­‰å„ç§å½¢å¼æºæ•°æ®ï¼Œåˆå¯ä»¥å°†é‡‡é›†åˆ°çš„æ•°æ®è¾“å‡ºåˆ°HDFSã€hbaseã€hiveã€kafkaç­‰ä¼—å¤šå¤–éƒ¨å­˜å‚¨ç³»ç»Ÿä¸­ ä¸€èˆ¬çš„é‡‡é›†éœ€æ±‚ï¼Œé€šè¿‡å¯¹flumeçš„ç®€å•é…ç½®å³å¯å®ç° Flumeé’ˆå¯¹ç‰¹æ®Šåœºæ™¯ä¹Ÿå…·å¤‡è‰¯å¥½çš„è‡ªå®šä¹‰æ‰©å±•èƒ½åŠ›ï¼Œå› æ­¤ï¼Œflumeå¯ä»¥é€‚ç”¨äºå¤§éƒ¨åˆ†çš„æ—¥å¸¸æ•°æ®é‡‡é›†åœºæ™¯ è¿è¡Œæœºåˆ¶ Flumeåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ€æ ¸å¿ƒçš„è§’è‰²æ˜¯agentï¼Œflumeé‡‡é›†ç³»ç»Ÿå°±æ˜¯ç”±ä¸€ä¸ªä¸ªagentæ‰€è¿æ¥èµ·æ¥å½¢æˆ æ¯ä¸€ä¸ªagentç›¸å½“äºä¸€ä¸ªæ•°æ®ä¼ é€’å‘˜ï¼Œå†…éƒ¨æœ‰ä¸‰ä¸ªç»„ä»¶ï¼š Sourceï¼šé‡‡é›†æºï¼Œç”¨äºè·Ÿæ•°æ®æºå¯¹æ¥ï¼Œä»¥è·å–æ•°æ® Sinkï¼šä¸‹æ²‰åœ°ï¼Œé‡‡é›†æ•°æ®çš„ä¼ é€ç›®çš„ï¼Œç”¨äºå¾€ä¸‹ä¸€çº§agentä¼ é€’æ•°æ®æˆ–è€…å¾€æœ€ç»ˆå­˜å‚¨ç³»ç»Ÿä¼ é€’æ•°æ® Channelï¼šangentå†…éƒ¨çš„æ•°æ®ä¼ è¾“é€šé“ï¼Œç”¨äºä»sourceå°†æ•°æ®ä¼ é€’åˆ°sink ä¸€ä¸ªå®Œæ•´çš„å·¥ä½œæµç¨‹ï¼šsourceä¸æ–­çš„æ¥æ”¶æ•°æ®ï¼Œå°†æ•°æ®å°è£…æˆä¸€ä¸ªä¸€ä¸ªçš„eventï¼Œç„¶åå°†eventå‘é€ç»™channelï¼Œchanelä½œä¸ºä¸€ä¸ªç¼“å†²åŒºä¼šä¸´æ—¶å­˜æ”¾è¿™äº›eventæ•°æ®ï¼Œéšåsinkä¼šå°†channelä¸­çš„eventæ•°æ®å‘é€åˆ°æŒ‡å®šçš„åœ°æ–¹â€”-ä¾‹å¦‚HDFSç­‰ã€‚ Flumeé‡‡é›†ç³»ç»Ÿç»“æ„å›¾ç®€å•çš„ç»“æ„å•ä¸ªagenté‡‡é›†æ•°æ® å¤æ‚ç»“æ„å¤šçº§agentä¹‹é—´ä¸²è” Flumeå®‰è£…å®‰è£…ä»¥åŠå¯åŠ¨æ­¥éª¤ ä¸‹è½½äºŒè¿›åˆ¶åŒ… apache-flume-1.6.0-bin.tar.gz ä¸Šä¼ åˆ°æ•°æ®æºæ‰€åœ¨èŠ‚ç‚¹ è§£å‹äºŒè¿›åˆ¶åŒ… tar -zxvf apache-flume-1.6.0-bin.tar.gz ä¿®æ”¹é…ç½®æ–‡ä»¶ è¿›å…¥åˆ°flumeç›®å½•ï¼Œ ä¿®æ”¹confä¸‹çš„flume-env.sh, åœ¨é‡Œé¢é…ç½®JAVA_HOME é…ç½®é‡‡é›†æ–¹æ¡ˆ æ ¹æ®æ•°æ®é‡‡é›†çš„éœ€æ±‚é…ç½®é‡‡é›†æ–¹æ¡ˆï¼Œæè¿°åœ¨é…ç½®æ–‡ä»¶ä¸­(æ–‡ä»¶åå¯ä»¥ä»»æ„è‡ªå®šä¹‰) å¯åŠ¨flume agent æŒ‡å®šé‡‡é›†æ–¹æ¡ˆé…ç½®æ–‡ä»¶, åœ¨ç›¸åº”çš„èŠ‚ç‚¹ä¸Šå¯åŠ¨flume agent é‡‡é›†æ–¹æ¡ˆé…ç½®ç¤ºä¾‹ åˆ›å»ºé‡‡é›†æ–¹æ¡ˆ ç°åœ¨flumeçš„confç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œ ä»¥netcat-logger.conf ä¸ºä¾‹(netcat ä¸ºä¸€ç§socketæ•°æ®æº) 123456789101112131415161718192021# å®šä¹‰è¿™ä¸ªagentä¸­å„ç»„ä»¶çš„åå­—a1.sources = r1a1.sinks = k1a1.channels = c1# æè¿°å’Œé…ç½®sourceç»„ä»¶ï¼šr1a1.sources.r1.type = netcata1.sources.r1.bind = localhosta1.sources.r1.port = 44444# æè¿°å’Œé…ç½®sinkç»„ä»¶ï¼šk1a1.sinks.k1.type = logger# æè¿°å’Œé…ç½®channelç»„ä»¶ï¼Œæ­¤å¤„ä½¿ç”¨æ˜¯å†…å­˜ç¼“å­˜çš„æ–¹å¼a1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# æè¿°å’Œé…ç½®source channel sinkä¹‹é—´çš„è¿æ¥å…³ç³»a1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨agentå»é‡‡é›†æ•°æ® 1bin/flume-ng agent -c conf -f conf/netcat-logger.conf -n a1 -Dflume.root.logger=INFO,console å¤‡æ³¨: â€‹ -c conf æŒ‡å®šflumeè‡ªèº«çš„é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½• â€‹ -f conf/netcat-logger.con æŒ‡å®šæˆ‘ä»¬æ‰€æè¿°çš„é‡‡é›†æ–¹æ¡ˆ â€‹ -n a1 æŒ‡å®šæˆ‘ä»¬è¿™ä¸ªagentçš„åå­— æµ‹è¯•æ•°æ®é‡‡é›†æ•ˆæœ å…ˆè¦å¾€agenté‡‡é›†ç›‘å¬çš„ç«¯å£ä¸Šå‘é€æ•°æ®ï¼Œ è®©agentæœ‰æ•°æ®å¯ä»¥é‡‡é›† 1telnet localhost 44444 è¿æ¥åï¼Œå‘é€æ•°æ®ï¼ŒæŸ¥çœ‹flumeçš„loggerç•Œé¢æ˜¾ç¤ºå†…å®¹ Flumeé‡‡é›†æ¡ˆä¾‹ç›®å½•åˆ°HDFSé‡‡é›†éœ€æ±‚ æŸæœåŠ¡å™¨çš„æŸç‰¹å®šç›®å½•ä¸‹ï¼Œä¼šä¸æ–­äº§ç”Ÿæ–°çš„æ–‡ä»¶ï¼Œæ¯å½“æœ‰æ–°æ–‡ä»¶å‡ºç°ï¼Œå°±éœ€è¦æŠŠæ–‡ä»¶é‡‡é›†åˆ°HDFSä¸­å» æ ¹æ®éœ€æ±‚ï¼Œé¦–å…ˆå®šä¹‰ä»¥ä¸‹3å¤§è¦ç´ ï¼š é‡‡é›†æºï¼Œå³sourceâ€”â€”ç›‘æ§æ–‡ä»¶ç›®å½• : spooldir ä¸‹æ²‰ç›®æ ‡ï¼Œå³sinkâ€”â€”HDFSæ–‡ä»¶ç³»ç»Ÿ : hdfs sink sourceå’Œsinkä¹‹é—´çš„ä¼ é€’é€šé“â€”â€”channelï¼Œå¯ç”¨file channel ä¹Ÿå¯ä»¥ç”¨å†…å­˜channel é‡‡é›†æ–¹æ¡ˆç¼–å†™ 123456789101112131415161718192021222324252627282930313233343536373839#å®šä¹‰ä¸‰å¤§ç»„ä»¶çš„åç§°agent1.sources = source1agent1.sinks = sink1agent1.channels = channel1# é…ç½®sourceç»„ä»¶agent1.sources.source1.type = spooldiragent1.sources.source1.spoolDir = /home/hadoop/logs/agent1.sources.source1.fileHeader = false#é…ç½®æ‹¦æˆªå™¨agent1.sources.source1.interceptors = i1agent1.sources.source1.interceptors.i1.type = hostagent1.sources.source1.interceptors.i1.hostHeader = hostname# é…ç½®sinkç»„ä»¶agent1.sinks.sink1.type = hdfsagent1.sinks.sink1.hdfs.path =hdfs://hdp-node-01:9000/weblog/flume-collection/%y-%m-%d/%H-%Magent1.sinks.sink1.hdfs.filePrefix = access_logagent1.sinks.sink1.hdfs.maxOpenFiles = 5000agent1.sinks.sink1.hdfs.batchSize= 100agent1.sinks.sink1.hdfs.fileType = DataStreamagent1.sinks.sink1.hdfs.writeFormat =Textagent1.sinks.sink1.hdfs.rollSize = 102400agent1.sinks.sink1.hdfs.rollCount = 1000000agent1.sinks.sink1.hdfs.rollInterval = 60#agent1.sinks.sink1.hdfs.round = true#agent1.sinks.sink1.hdfs.roundValue = 10#agent1.sinks.sink1.hdfs.roundUnit = minuteagent1.sinks.sink1.hdfs.useLocalTimeStamp = true# Use a channel which buffers events in memoryagent1.channels.channel1.type = memoryagent1.channels.channel1.keep-alive = 120agent1.channels.channel1.capacity = 500000agent1.channels.channel1.transactionCapacity = 600# Bind the source and sink to the channelagent1.sources.source1.channels = channel1agent1.sinks.sink1.channel = channel1 Channelå‚æ•°è§£é‡Šï¼š capacityï¼šé»˜è®¤è¯¥é€šé“ä¸­æœ€å¤§çš„å¯ä»¥å­˜å‚¨çš„eventæ•°é‡ trasactionCapacityï¼šæ¯æ¬¡æœ€å¤§å¯ä»¥ä»sourceä¸­æ‹¿åˆ°æˆ–è€…é€åˆ°sinkä¸­çš„eventæ•°é‡ keep-aliveï¼ševentæ·»åŠ åˆ°é€šé“ä¸­æˆ–è€…ç§»å‡ºçš„å…è®¸æ—¶é—´ HDFS SINKå‚æ•°è§£é‡Š: pathï¼šhdfsçš„è·¯å¾„ï¼Œéœ€è¦åŒ…å«æ–‡ä»¶ç³»ç»Ÿæ ‡è¯†ï¼Œæ¯”å¦‚ï¼šhdfs://namenode/flume/webdata/ filePrefixï¼šé»˜è®¤å€¼ï¼šFlumeDataï¼Œå†™å…¥hdfsçš„æ–‡ä»¶åå‰ç¼€ fileSuffixï¼šå†™å…¥ hdfs çš„æ–‡ä»¶ååç¼€ï¼Œæ¯”å¦‚ï¼š.lzo .logç­‰ã€‚ inUsePrefixï¼šä¸´æ—¶æ–‡ä»¶çš„æ–‡ä»¶åå‰ç¼€ï¼Œhdfs sink ä¼šå…ˆå¾€ç›®æ ‡ç›®å½•ä¸­å†™ä¸´æ—¶æ–‡ä»¶ï¼Œå†æ ¹æ®ç›¸å…³è§„åˆ™é‡å‘½åæˆæœ€ç»ˆç›®æ ‡æ–‡ä»¶ï¼› inUseSuffixï¼šé»˜è®¤å€¼ï¼š.tmpï¼Œä¸´æ—¶æ–‡ä»¶çš„æ–‡ä»¶ååç¼€ã€‚ rollIntervalï¼šé»˜è®¤å€¼ï¼š30ï¼šhdfs sink é—´éš”å¤šé•¿å°†ä¸´æ—¶æ–‡ä»¶æ»šåŠ¨æˆæœ€ç»ˆç›®æ ‡æ–‡ä»¶ï¼Œå•ä½ï¼šç§’; å¦‚æœè®¾ç½®æˆ0ï¼Œåˆ™è¡¨ç¤ºä¸æ ¹æ®æ—¶é—´æ¥æ»šåŠ¨æ–‡ä»¶ï¼› æ³¨ï¼šæ»šåŠ¨ï¼ˆrollï¼‰æŒ‡çš„æ˜¯ï¼Œhdfs sink å°†ä¸´æ—¶æ–‡ä»¶é‡å‘½åæˆæœ€ç»ˆç›®æ ‡æ–‡ä»¶ï¼Œå¹¶æ–°æ‰“å¼€ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶æ¥å†™å…¥æ•°æ®ï¼› rollSizeï¼šé»˜è®¤å€¼ï¼š1024ï¼šå½“ä¸´æ—¶æ–‡ä»¶è¾¾åˆ°å¤šå°‘ï¼ˆå•ä½ï¼šbytesï¼‰æ—¶ï¼Œæ»šåŠ¨æˆç›®æ ‡æ–‡ä»¶ï¼›å¦‚æœè®¾ç½®æˆ0ï¼Œåˆ™è¡¨ç¤ºä¸æ ¹æ®ä¸´æ—¶æ–‡ä»¶å¤§å°æ¥æ»šåŠ¨æ–‡ä»¶ï¼› rollCountï¼šé»˜è®¤å€¼ï¼š10ï¼šå½“ events æ•°æ®è¾¾åˆ°è¯¥æ•°é‡æ—¶å€™ï¼Œå°†ä¸´æ—¶æ–‡ä»¶æ»šåŠ¨æˆç›®æ ‡æ–‡ä»¶ï¼›å¦‚æœè®¾ç½®æˆ0ï¼Œåˆ™è¡¨ç¤ºä¸æ ¹æ®eventsæ•°æ®æ¥æ»šåŠ¨æ–‡ä»¶ï¼› idleTimeoutï¼šé»˜è®¤å€¼ï¼š0ï¼šå½“ç›®å‰è¢«æ‰“å¼€çš„ä¸´æ—¶æ–‡ä»¶åœ¨è¯¥å‚æ•°æŒ‡å®šçš„æ—¶é—´ï¼ˆç§’ï¼‰å†…ï¼Œæ²¡æœ‰ä»»ä½•æ•°æ®å†™å…¥ï¼Œåˆ™å°†è¯¥ä¸´æ—¶æ–‡ä»¶å…³é—­å¹¶é‡å‘½åæˆç›®æ ‡æ–‡ä»¶ï¼› batchSizeï¼šé»˜è®¤å€¼ï¼š100ï¼šæ¯ä¸ªæ‰¹æ¬¡åˆ·æ–°åˆ° HDFS ä¸Šçš„ events æ•°é‡ï¼› codeCï¼šæ–‡ä»¶å‹ç¼©æ ¼å¼ï¼ŒåŒ…æ‹¬ï¼šgzip, bzip2, lzo, lzop, snappy fileTypeï¼šé»˜è®¤å€¼ï¼šSequenceFileï¼Œæ–‡ä»¶æ ¼å¼ï¼ŒåŒ…æ‹¬ï¼šSequenceFile, DataStream,CompressedStream â€‹ å½“ä½¿ç”¨DataStreamæ—¶å€™ï¼Œæ–‡ä»¶ä¸ä¼šè¢«å‹ç¼©ï¼Œä¸éœ€è¦è®¾ç½®hdfs.codeC; â€‹ å½“ä½¿ç”¨CompressedStreamæ—¶å€™ï¼Œå¿…é¡»è®¾ç½®ä¸€ä¸ªæ­£ç¡®çš„hdfs.codeCå€¼ï¼› maxOpenFilesï¼šé»˜è®¤å€¼ï¼š5000ï¼šæœ€å¤§å…è®¸æ‰“å¼€çš„HDFSæ–‡ä»¶æ•°ï¼Œå½“æ‰“å¼€çš„æ–‡ä»¶æ•°è¾¾åˆ°è¯¥å€¼ï¼Œæœ€æ—©æ‰“å¼€çš„æ–‡ä»¶å°†ä¼šè¢«å…³é—­ï¼› minBlockReplicasï¼šé»˜è®¤å€¼ï¼šHDFSå‰¯æœ¬æ•°ï¼Œå†™å…¥ HDFS æ–‡ä»¶å—çš„æœ€å°å‰¯æœ¬æ•°ã€‚ â€‹ è¯¥å‚æ•°ä¼šå½±å“æ–‡ä»¶çš„æ»šåŠ¨é…ç½®ï¼Œä¸€èˆ¬å°†è¯¥å‚æ•°é…ç½®æˆ1ï¼Œæ‰å¯ä»¥æŒ‰ç…§é…ç½®æ­£ç¡®æ»šåŠ¨æ–‡ä»¶ã€‚ writeFormatï¼šå†™ sequence æ–‡ä»¶çš„æ ¼å¼ã€‚åŒ…å«ï¼šText, Writableï¼ˆé»˜è®¤ï¼‰ callTimeoutï¼šé»˜è®¤å€¼ï¼š10000ï¼Œæ‰§è¡ŒHDFSæ“ä½œçš„è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ï¼› threadsPoolSizeï¼šé»˜è®¤å€¼ï¼š10ï¼Œhdfs sink å¯åŠ¨çš„æ“ä½œHDFSçš„çº¿ç¨‹æ•°ã€‚ rollTimerPoolSizeï¼šé»˜è®¤å€¼ï¼š1ï¼Œhdfs sink å¯åŠ¨çš„æ ¹æ®æ—¶é—´æ»šåŠ¨æ–‡ä»¶çš„çº¿ç¨‹æ•°ã€‚ kerberosPrincipalï¼šHDFSå®‰å…¨è®¤è¯kerberosé…ç½®ï¼› kerberosKeytabï¼šHDFSå®‰å…¨è®¤è¯kerberosé…ç½®ï¼› proxyUserï¼šä»£ç†ç”¨æˆ· roundï¼šé»˜è®¤å€¼ï¼šfalseï¼Œæ˜¯å¦å¯ç”¨æ—¶é—´ä¸Šçš„â€èˆå¼ƒâ€ï¼› roundValueï¼šé»˜è®¤å€¼ï¼š1ï¼Œæ—¶é—´ä¸Šè¿›è¡Œâ€œèˆå¼ƒâ€çš„å€¼ï¼› roundUnitï¼šé»˜è®¤å€¼ï¼šsecondsï¼Œæ—¶é—´ä¸Šè¿›è¡Œâ€èˆå¼ƒâ€çš„å•ä½ï¼ŒåŒ…å«ï¼šsecond,minute,hour æ–‡ä»¶åˆ°HDFSé‡‡é›†éœ€æ±‚ æ¯”å¦‚ä¸šåŠ¡ç³»ç»Ÿä½¿ç”¨log4jç”Ÿæˆçš„æ—¥å¿—ï¼Œæ—¥å¿—å†…å®¹ä¸æ–­å¢åŠ ï¼Œéœ€è¦æŠŠè¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶ä¸­çš„æ•°æ®å®æ—¶é‡‡é›†åˆ°hdfs æ ¹æ®éœ€æ±‚ï¼Œé¦–å…ˆå®šä¹‰ä»¥ä¸‹3å¤§è¦ç´ ï¼š é‡‡é›†æºï¼Œå³sourceâ€”â€”ç›‘æ§æ–‡ä»¶å†…å®¹æ›´æ–° : exec â€˜tail -F fileâ€™ ä¸‹æ²‰ç›®æ ‡ï¼Œå³sinkâ€”â€”HDFSæ–‡ä»¶ç³»ç»Ÿ : hdfs sink Sourceå’Œsinkä¹‹é—´çš„ä¼ é€’é€šé“â€”â€”channelï¼Œå¯ç”¨file channel ä¹Ÿå¯ä»¥ç”¨ å†…å­˜channel é‡‡é›†æ–¹æ¡ˆç¼–å†™ 12345678910111213141516171819202122232425262728293031323334353637383940agent1.sources = source1agent1.sinks = sink1agent1.channels = channel1# Describe/configure tail -F source1agent1.sources.source1.type = execagent1.sources.source1.command = tail -F /home/hadoop/logs/access_logagent1.sources.source1.channels = channel1#configure host for sourceagent1.sources.source1.interceptors = i1agent1.sources.source1.interceptors.i1.type = hostagent1.sources.source1.interceptors.i1.hostHeader = hostname# Describe sink1agent1.sinks.sink1.type = hdfs#a1.sinks.k1.channel = c1agent1.sinks.sink1.hdfs.path =hdfs://hdp-node-01:9000/weblog/flume-collection/%y-%m-%d/%H-%Magent1.sinks.sink1.hdfs.filePrefix = access_logagent1.sinks.sink1.hdfs.maxOpenFiles = 5000agent1.sinks.sink1.hdfs.batchSize= 100agent1.sinks.sink1.hdfs.fileType = DataStreamagent1.sinks.sink1.hdfs.writeFormat =Textagent1.sinks.sink1.hdfs.rollSize = 102400agent1.sinks.sink1.hdfs.rollCount = 1000000agent1.sinks.sink1.hdfs.rollInterval = 60agent1.sinks.sink1.hdfs.round = trueagent1.sinks.sink1.hdfs.roundValue = 10agent1.sinks.sink1.hdfs.roundUnit = minuteagent1.sinks.sink1.hdfs.useLocalTimeStamp = true# Use a channel which buffers events in memoryagent1.channels.channel1.type = memoryagent1.channels.channel1.keep-alive = 120agent1.channels.channel1.capacity = 500000agent1.channels.channel1.transactionCapacity = 600# Bind the source and sink to the channelagent1.sources.source1.channels = channel1agent1.sinks.sink1.channel = channel1 è·Ÿè¿‡sourceå’Œsinkç»„ä»¶Flumeæ”¯æŒä¼—å¤šçš„sourceå’Œsinkç±»å‹ï¼Œè¯¦ç»†æ‰‹å†Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ http://flume.apache.org/FlumeUserGuide.html]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>å¤§æ•°æ®å·¥å…·</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hive]]></title>
    <url>%2F2020%2F02%2F11%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FHive%2Fhive%2F</url>
    <content type="text"><![CDATA[HiveåŸºæœ¬æ¦‚å¿µä»€ä¹ˆæ˜¯HiveHiveæ˜¯åŸºäºHadoopçš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ æ•°æ®åº“è¡¨ï¼Œå¹¶æä¾›ç±»ä¼¼SQLæŸ¥è¯¢çš„åŠŸèƒ½ï¼› ä¸ºä»€ä¹ˆä½¿ç”¨Hive ç›´æ¥ä½¿ç”¨hadoopéœ€è¦æŒæ¡å¤§é‡çš„çŸ¥è¯†ï¼Œä¸Šæ‰‹éš¾åº¦è¾ƒå¤§ï¼ŒmapReduceå¼€å‘éš¾åº¦å¤ªå¤§ä¸”å¤æ‚ï¼› Hiveæ¥å£é‡‡ç”¨ç±»ä¼¼SQLçš„è¯­æ³•ï¼ŒåŠ å¿«äº†å¼€å‘çš„é€Ÿåº¦ï¼› é¿å…é‡å¤çš„å»å†™MapReduceï¼Œå‡å°‘äº†å¼€å‘å­¦ä¹ æˆæœ¬ï¼› æ‰©å±•åŠŸèƒ½æ¯”è¾ƒæ–¹ä¾¿ï¼› Hiveçš„ç‰¹ç‚¹ å¯æ‰©å±• Hiveå¯ä»¥è‡ªç”±çš„æ‹“å±•é›†ç¾¤çš„è§„æ¨¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦é‡å¯æœåŠ¡ï¼› å»¶å±•æ€§ Hiveæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥å®ç°è‡ªå·±çš„å‡½æ•°ï¼› å®¹é”™ è‰¯å¥½çš„å®¹é”™æ€§ï¼ŒèŠ‚ç‚¹å‡ºç°é—®é¢˜SQLä»å¯å®Œæˆæ‰§è¡Œï¼› Hiveä¸Hadoopçš„å…³ç³»Hiveåˆ©ç”¨HDFSå­˜å‚¨æ•°æ®ï¼Œåˆ©ç”¨MapReduceæŸ¥è¯¢æ•°æ® Hiveä¸ä¼ ç»Ÿæ•°æ®åº“çš„å¯¹æ¯” hiveå…·æœ‰sqlæ•°æ®åº“çš„å¤–è¡¨ï¼Œä½†åº”ç”¨åœºæ™¯å®Œå…¨ä¸åŒï¼Œhiveåªé€‚åˆç”¨æ¥åšæ‰¹é‡æ•°æ®ç»Ÿè®¡åˆ†æ Hiveçš„æ•°æ®å­˜å‚¨ Hiveä¸­æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ HDFS ä¸­ï¼Œæ²¡æœ‰ä¸“é—¨çš„æ•°æ®å­˜å‚¨æ ¼å¼ï¼ˆå¯æ”¯æŒTextï¼ŒSequenceFileï¼ŒParquetFileï¼ŒRCFILEç­‰ï¼‰ åªéœ€è¦åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™å‘Šè¯‰ Hive æ•°æ®ä¸­çš„åˆ—åˆ†éš”ç¬¦å’Œè¡Œåˆ†éš”ç¬¦ï¼ŒHive å°±å¯ä»¥è§£ææ•°æ®ã€‚ Hive ä¸­åŒ…å«ä»¥ä¸‹æ•°æ®æ¨¡å‹ï¼šDBã€Tableï¼ŒExternal Tableï¼ŒPartitionï¼ŒBucketã€‚ dbï¼šåœ¨hdfsä¸­è¡¨ç°ä¸º${hive.metastore.warehouse.dir}ç›®å½•ä¸‹ä¸€ä¸ªæ–‡ä»¶å¤¹ tableï¼šåœ¨hdfsä¸­è¡¨ç°æ‰€å±dbç›®å½•ä¸‹ä¸€ä¸ªæ–‡ä»¶å¤¹ external tableï¼šå¤–éƒ¨è¡¨, ä¸tableç±»ä¼¼ï¼Œä¸è¿‡å…¶æ•°æ®å­˜æ”¾ä½ç½®å¯ä»¥åœ¨ä»»æ„æŒ‡å®šè·¯å¾„ æ™®é€šè¡¨: åˆ é™¤è¡¨å, hdfsä¸Šçš„æ–‡ä»¶éƒ½åˆ äº† Externalå¤–éƒ¨è¡¨: åˆ é™¤å, hdfsä¸Šçš„æ–‡ä»¶æ²¡æœ‰åˆ é™¤, åªæ˜¯æŠŠæ–‡ä»¶åˆ é™¤äº† partitionï¼šåœ¨hdfsä¸­è¡¨ç°ä¸ºtableç›®å½•ä¸‹çš„å­ç›®å½• bucketï¼šæ¡¶, åœ¨hdfsä¸­è¡¨ç°ä¸ºåŒä¸€ä¸ªè¡¨ç›®å½•ä¸‹æ ¹æ®hashæ•£åˆ—ä¹‹åçš„å¤šä¸ªæ–‡ä»¶, ä¼šæ ¹æ®ä¸åŒçš„æ–‡ä»¶æŠŠæ•°æ®æ”¾åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ Hiveæ¶æ„Hiveæ¶æ„å›¾ Jobtrackerï¼š æ˜¯hadoop1.xä¸­çš„ç»„ä»¶ï¼Œå®ƒçš„åŠŸèƒ½ç›¸å½“äºï¼š Resourcemanager+AppMaster TaskTrackerï¼š ç›¸å½“äº Nodemanager + yarnchild åŸºæœ¬ç»„æˆ ç”¨æˆ·æ¥å£: CLIã€JDBC/ODBCã€WebGUI CLIä¸ºshellå‘½ä»¤è¡Œï¼›JDBC/ODBCæ˜¯Hiveçš„JAVAå®ç°ï¼Œä¸ä¼ ç»Ÿæ•°æ®åº“JDBCç±»ä¼¼ï¼›WebGUIæ˜¯é€šè¿‡æµè§ˆå™¨è®¿é—®Hiveã€‚ å…ƒæ•°æ®å­˜å‚¨ï¼šä¸€èˆ¬å­˜å‚¨åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­å¦‚ mysqlï¼› Hive å°†å…ƒæ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚Hive ä¸­çš„å…ƒæ•°æ®åŒ…æ‹¬è¡¨çš„åå­—ï¼Œè¡¨çš„åˆ—å’Œåˆ†åŒºåŠå…¶å±æ€§ï¼Œè¡¨çš„å±æ€§ï¼ˆæ˜¯å¦ä¸ºå¤–éƒ¨è¡¨ç­‰ï¼‰ï¼Œè¡¨çš„æ•°æ®æ‰€åœ¨ç›®å½•ç­‰ã€‚ è§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ è§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨å®Œæˆ HQL æŸ¥è¯¢è¯­å¥ä»è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ç¼–è¯‘ã€ä¼˜åŒ–ä»¥åŠæŸ¥è¯¢è®¡åˆ’çš„ç”Ÿæˆã€‚ç”Ÿæˆçš„æŸ¥è¯¢è®¡åˆ’å­˜å‚¨åœ¨ HDFS ä¸­ï¼Œå¹¶åœ¨éšåæœ‰ MapReduce è°ƒç”¨æ‰§è¡Œã€‚ Hive å®‰è£…éƒ¨ç½²Hiveä¸‰ç§æ¨¡å¼ å†…åµŒæ¨¡å¼ï¼šå…ƒæ•°æ®ä¿æŒåœ¨å†…åµŒçš„derbyæ¨¡å¼ï¼Œåªå…è®¸ä¸€ä¸ªä¼šè¯è¿æ¥ æœ¬åœ°ç‹¬ç«‹æ¨¡å¼ï¼šåœ¨æœ¬åœ°å®‰è£…Mysqlï¼ŒæŠŠå…ƒæ•°æ®æ”¾åˆ°mySqlå†… è¿œç¨‹æ¨¡å¼ï¼šå…ƒæ•°æ®æ”¾ç½®åœ¨è¿œç¨‹çš„Mysqlæ•°æ®åº“ å®‰è£…æ­¥éª¤ ä¸‹è½½Hiveå®‰è£…åŒ… åœ°å€: http://hive.apache.org/downloads.html å°†hiveå®‰è£…åŒ…ä¸Šä¼ åˆ°hadoopé›†ç¾¤ï¼Œå¹¶è§£å‹ 123tar -zxvf apache-hive-1.2.1-bin.tar.gz -C /export/servers/cd /export/servers/ln -s apache-hive-1.2.1-bin hive é…ç½®ç¯å¢ƒå˜é‡ï¼Œç¼–è¾‘/etc/profile 1234567vi /etc/profile# æ–°å¢è¡Œ# export HIVE_HOME=/export/servers/hive# export PATH=$&#123;HIVE_HOME&#125;/bin:$PATH# ä¿å­˜é€€å‡ºsource /etc/profile ä¿®æ”¹hiveé…ç½®æ–‡ä»¶ 12345678910cd /export/servers/hive/conf# ä¿®æ”¹hive-env.shæ–‡ä»¶ï¼Œ å°†å¦‚ä¸‹å†…å®¹å†™åˆ°hive-env.shæ–‡ä»¶ä¸­cp hive-env.sh template hive-env.sh# export JAVA_HOME=/export/servers/jdk# export HADOOP_HOME=/export/servers/hadoop# export HIVE_HOME=/export/servers/hive# å°†å¦‚ä¸‹ä¿¡æ¯å†™åˆ°hive-site.xmlæ–‡ä»¶ä¸­touch hive-site.xml 123456789101112131415161718&lt;configuration&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt; &lt;value&gt;jdbc:mysql://hadoop02:3306/hivedb?createDatabaseIfNotExist=true&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt; &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt; &lt;value&gt;root&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt; &lt;value&gt;root&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; å®‰è£…mysqlå¹¶é…ç½®hiveæ•°æ®åº“åŠæƒé™ å®‰è£…mysqlå®¢æˆ·ç«¯ 123yum install mysql-serveryum install mysqlservice mysqld start é…ç½®hiveå…ƒæ•°æ®åº“ 1create database hivedb å¯¹hiveæºæ•°æ®åº“åŠé€†è¡Œèµ‹æƒï¼Œå¼€æ”¾è¿œç¨‹è¿æ¥ 12GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'root' WITH GRANT OPTION;FLUSH PRIVILEGES; å¯åŠ¨hive 1hive å¤‡æ³¨: å¦‚æœæŠ¥é”™ Terminal initialization failed; falling back to unsupported, å°†/export/servers/hive/lib é‡Œé¢çš„jline2.12æ›¿æ¢äº†hadoop ä¸­hadoop-2.6.1/share/hadoop/yarn/lib/jline-0.09*.jar å¦‚æœæŠ¥é”™ Hive metastore database is not initialized. æ‰§è¡Œ: schematool -dbType mysql -initSchema ä½¿ç”¨æ–¹å¼ äº¤äº’å¼Shell ç›´æ¥è¾“å…¥å‘½ä»¤ï¼Œå¯åŠ¨hiveå®¢æˆ·ç«¯ 1bin/hive Hive thriftæœåŠ¡ å¯åŠ¨æœåŠ¡ å¯åŠ¨æ–¹å¼ï¼ˆå‡å¦‚æ˜¯åœ¨hadoop01ä¸Šï¼‰: å¯åŠ¨ä¸ºå‰å°: bin/hiveserver2 å¯åŠ¨ä¸ºåå°: nohup bin/hiveserver2 1&gt;/var/log/hiveserver.log 2&gt;/var/log/hiveserver.err &amp; å¯åŠ¨æˆåŠŸå, å¯ä»¥åœ¨åˆ«çš„èŠ‚ç‚¹ä¸Šç”¨beelineå»è¿æ¥ å®¢æˆ·ç«¯è¿æ¥ æ–¹å¼ä¸€: hive/bin/beeline beeline&gt; !connet jdbc:hive2//mini1:10000 æ–¹å¼äºŒ: bin/beeline -u jdbc:hive2://mini1:10000 -n hadoop ç›´æ¥æ‰§è¡ŒSQL ç›´æ¥é€šè¿‡hive -e æ‰§è¡Œå‘½ä»¤ 1hive -e 'sql' HiveåŸºæœ¬æ“ä½œåˆ›å»ºè¡¨å»ºè¡¨è¯­æ³• 123456789CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name [(col_name data_type [COMMENT col_comment], ...)] [COMMENT table_comment] [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)] [CLUSTERED BY (col_name, col_name, ...) [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS] [ROW FORMAT row_format] [STORED AS file_format] [LOCATION hdfs_path] CREATE TABLE åˆ›å»ºä¸€ä¸ªæŒ‡å®šåå­—çš„è¡¨ã€‚å¦‚æœç›¸åŒåå­—çš„è¡¨å·²ç»å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼›ç”¨æˆ·å¯ä»¥ç”¨ IF NOT EXISTS é€‰é¡¹æ¥å¿½ç•¥è¿™ä¸ªå¼‚å¸¸ã€‚ EXTERNALå…³é”®å­—å¯ä»¥è®©ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è¡¨ï¼Œåœ¨å»ºè¡¨çš„åŒæ—¶æŒ‡å®šä¸€ä¸ªæŒ‡å‘å®é™…æ•°æ®çš„è·¯å¾„ï¼ˆLOCATIONï¼‰ï¼ŒHive åˆ›å»ºå†…éƒ¨è¡¨æ—¶ï¼Œä¼šå°†æ•°æ®ç§»åŠ¨åˆ°æ•°æ®ä»“åº“æŒ‡å‘çš„è·¯å¾„ï¼›è‹¥åˆ›å»ºå¤–éƒ¨è¡¨ï¼Œä»…è®°å½•æ•°æ®æ‰€åœ¨çš„è·¯å¾„ï¼Œä¸å¯¹æ•°æ®çš„ä½ç½®åšä»»ä½•æ”¹å˜ã€‚åœ¨åˆ é™¤è¡¨çš„æ—¶å€™ï¼Œå†…éƒ¨è¡¨çš„å…ƒæ•°æ®å’Œæ•°æ®ä¼šè¢«ä¸€èµ·åˆ é™¤ï¼Œè€Œå¤–éƒ¨è¡¨åªåˆ é™¤å…ƒæ•°æ®ï¼Œä¸åˆ é™¤æ•°æ®ã€‚ LIKE å…è®¸ç”¨æˆ·å¤åˆ¶ç°æœ‰çš„è¡¨ç»“æ„ï¼Œä½†æ˜¯ä¸å¤åˆ¶æ•°æ®ã€‚ ROW FORMAT DELIMITED [FIELDS TERMINATED BY char][COLLECTION ITEMS TERMINATED BY char] [MAP KEYS TERMINATED BY char][LINES TERMINATED BY char] | SERDE serde_name [WITH SERDEPROPERTIES (property_name=property_value, property_name=property_value, â€¦)] ç”¨æˆ·åœ¨å»ºè¡¨çš„æ—¶å€™å¯ä»¥è‡ªå®šä¹‰ SerDe æˆ–è€…ä½¿ç”¨è‡ªå¸¦çš„ SerDeã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š ROW FORMAT æˆ–è€… ROW FORMAT DELIMITEDï¼Œå°†ä¼šä½¿ç”¨è‡ªå¸¦çš„ SerDeã€‚åœ¨å»ºè¡¨çš„æ—¶å€™ï¼Œç”¨æˆ·è¿˜éœ€è¦ä¸ºè¡¨æŒ‡å®šåˆ—ï¼Œç”¨æˆ·åœ¨æŒ‡å®šè¡¨çš„åˆ—çš„åŒæ—¶ä¹Ÿä¼šæŒ‡å®šè‡ªå®šä¹‰çš„ SerDeï¼ŒHiveé€šè¿‡ SerDe ç¡®å®šè¡¨çš„å…·ä½“çš„åˆ—çš„æ•°æ®ã€‚ STORED AS SEQUENCEFILE|TEXTFILE|RCFILE å¦‚æœæ–‡ä»¶æ•°æ®æ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨ STORED AS TEXTFILE(é»˜è®¤)ã€‚å¦‚æœæ•°æ®éœ€è¦å‹ç¼©ï¼Œä½¿ç”¨ STORED AS SEQUENCEFILEã€‚ CLUSTERED BY å¯¹äºæ¯ä¸€ä¸ªè¡¨ï¼ˆtableï¼‰æˆ–è€…åˆ†åŒºï¼Œ Hiveå¯ä»¥è¿›ä¸€æ­¥ç»„ç»‡æˆæ¡¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ¡¶æ˜¯æ›´ä¸ºç»†ç²’åº¦çš„æ•°æ®èŒƒå›´åˆ’åˆ†ã€‚Hiveä¹Ÿæ˜¯ é’ˆå¯¹æŸä¸€åˆ—è¿›è¡Œæ¡¶çš„ç»„ç»‡ã€‚Hiveé‡‡ç”¨å¯¹åˆ—å€¼å“ˆå¸Œï¼Œç„¶åé™¤ä»¥æ¡¶çš„ä¸ªæ•°æ±‚ä½™çš„æ–¹å¼å†³å®šè¯¥æ¡è®°å½•å­˜æ”¾åœ¨å“ªä¸ªæ¡¶å½“ä¸­ã€‚ æŠŠè¡¨ï¼ˆæˆ–è€…åˆ†åŒºï¼‰ç»„ç»‡æˆæ¡¶ï¼ˆBucketï¼‰æœ‰ä¸¤ä¸ªç†ç”±ï¼š ï¼ˆ1ï¼‰è·å¾—æ›´é«˜çš„æŸ¥è¯¢å¤„ç†æ•ˆç‡ã€‚æ¡¶ä¸ºè¡¨åŠ ä¸Šäº†é¢å¤–çš„ç»“æ„ï¼ŒHive åœ¨å¤„ç†æœ‰äº›æŸ¥è¯¢æ—¶èƒ½åˆ©ç”¨è¿™ä¸ªç»“æ„ã€‚å…·ä½“è€Œè¨€ï¼Œè¿æ¥ä¸¤ä¸ªåœ¨ï¼ˆåŒ…å«è¿æ¥åˆ—çš„ï¼‰ç›¸åŒåˆ—ä¸Šåˆ’åˆ†äº†æ¡¶çš„è¡¨ï¼Œå¯ä»¥ä½¿ç”¨ Map ç«¯è¿æ¥ ï¼ˆMap-side joinï¼‰é«˜æ•ˆçš„å®ç°ã€‚æ¯”å¦‚JOINæ“ä½œã€‚å¯¹äºJOINæ“ä½œä¸¤ä¸ªè¡¨æœ‰ä¸€ä¸ªç›¸åŒçš„åˆ—ï¼Œå¦‚æœå¯¹è¿™ä¸¤ä¸ªè¡¨éƒ½è¿›è¡Œäº†æ¡¶æ“ä½œã€‚é‚£ä¹ˆå°†ä¿å­˜ç›¸åŒåˆ—å€¼çš„æ¡¶è¿›è¡ŒJOINæ“ä½œå°±å¯ä»¥ï¼Œå¯ä»¥å¤§å¤§è¾ƒå°‘JOINçš„æ•°æ®é‡ã€‚ ï¼ˆ2ï¼‰ä½¿å–æ ·ï¼ˆsamplingï¼‰æ›´é«˜æ•ˆã€‚åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†æ—¶ï¼Œåœ¨å¼€å‘å’Œä¿®æ”¹æŸ¥è¯¢çš„é˜¶æ®µï¼Œå¦‚æœèƒ½åœ¨æ•°æ®é›†çš„ä¸€å°éƒ¨åˆ†æ•°æ®ä¸Šè¯•è¿è¡ŒæŸ¥è¯¢ï¼Œä¼šå¸¦æ¥å¾ˆå¤šæ–¹ä¾¿ã€‚ å»ºè¡¨å®ä¾‹ åˆ›å»ºå†…éƒ¨è¡¨mytable 1create table if not exists mytable(sid int, sname string) row format delimited fields terminated by ',' stored as textfile; åˆ›å»ºå¤–éƒ¨è¡¨pageview 1create external table if not exists pageview(pageid int, page_url string comment 'The page URL') row format delimited fields terminated by ',' location 'hdfs://192.168.11.191.9000/user/hibe/warehouse/'; åˆ›å»ºåˆ†åŒºè¡¨invites 1create table student_p(Sno int,Sname string,Sex string,Sage int,Sdept string) partitioned by(part string) row format delimited fields terminated by ','stored as textfile; åˆ›å»ºå¸¦æ¡¶çš„è¡¨student 1create table student(id int, age int, name string) partitioned by(stat_date string) clustered by(id) sorted by(age) into 2 buckets row format delimited fields terminated by','; ä¿®æ”¹è¡¨å¢åŠ /åˆ é™¤åˆ†åŒºè¯­æ³•ç»“æ„ 12345# å¢åŠ åˆ†åŒºALTER TABLE table_name ADD [IF NOT EXISTS] partition_spec [ LOCATION 'location1' ] partition_spec [ LOCATION 'location2' ] ...# åˆ é™¤åˆ†åŒºALTER TABLE table_name DROP partition_spec, partition_spec,... å®ä¾‹ æ·»åŠ åˆ†åŒº 1alter table student_p add partition(part='a') partition(part='b'); åˆ é™¤åˆ†åŒº 1alter table student drop partition(stat_date='20140101'), partition(stat_date=20140102); é‡å‘½åè¡¨è¯­æ³•ç»“æ„ 1alter table table_name RENAME TO new_table_name å®ä¾‹ 1alter table student rename to student1; å¢åŠ /æ›´æ–°åˆ—è¯­æ³•ç»“æ„ 1ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...) 1ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name column_type [COMMENT col_comment] [FIRST|AFTER column_name] å®ä¾‹ 1alter table student replace columns (id int, age int, name string); æ˜¾ç¤ºå‘½ä»¤show tables: æŸ¥çœ‹æ‰€æœ‰æŠ¤å…·åº“è¡¨ show databases: æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ show partitions t_name: æŸ¥çœ‹æ‰€æœ‰åˆ†åŒº show functions: æŸ¥çœ‹æ‰€æœ‰function desc extended t_name: æŸ¥çœ‹è¡¨çš„è¯¦ç»†ä¿¡æ¯ desc formatted t_name: æ ¼å¼åŒ–æ˜¾ç¤ºè¡¨çš„è¯¦ç»†ä¿¡æ¯ æ•°æ®æŸ¥è¯¢è¯­æ³•ç»“æ„ 123456SELECT [ALL | DISTINCT] select_expr, select_expr, ... FROM table_reference[WHERE where_condition] [GROUP BY col_list [HAVING condition]] [ [CLUSTER BY col_list] | [DISTRIBUTE BY col_list] [SORT BY| ORDER BY col_list] ] [LIMIT number] å¤‡æ³¨: order by ä¼šå¯¹è¾“å…¥åšå…¨å±€æ’åºï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªreducerï¼Œä¼šå¯¼è‡´å½“è¾“å…¥è§„æ¨¡è¾ƒå¤§æ—¶ï¼Œéœ€è¦è¾ƒé•¿çš„è®¡ç®—æ—¶é—´ã€‚ sort byä¸æ˜¯å…¨å±€æ’åºï¼Œå…¶åœ¨æ•°æ®è¿›å…¥reducerå‰å®Œæˆæ’åºã€‚å› æ­¤ï¼Œå¦‚æœç”¨sort byè¿›è¡Œæ’åºï¼Œå¹¶ä¸”è®¾ç½®mapred.reduce.tasks&gt;1ï¼Œåˆ™sort byåªä¿è¯æ¯ä¸ªreducerçš„è¾“å‡ºæœ‰åºï¼Œä¸ä¿è¯å…¨å±€æœ‰åºã€‚ æ ¹æ®distribute byæŒ‡å®šçš„å­—æ®µå†…å®¹å°†æ•°æ®åˆ†åˆ°åŒä¸€ä¸ªreducerã€‚ Cluster by é™¤äº†å…·æœ‰Distribute byçš„åŠŸèƒ½å¤–ï¼Œè¿˜ä¼šå¯¹è¯¥å­—æ®µè¿›è¡Œæ’åºã€‚å› æ­¤ï¼Œå¸¸å¸¸è®¤ä¸ºcluster by = distribute by + sort by å®ä¾‹ è·å–ä¸‰ä¸ªæœ€å¤§çš„å­¦ç”Ÿæ•°æ® 1select id, age, name from stuent where stat_date='20140101' order by age desc limit 3; æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯ï¼ŒæŒ‰ç…§å¹´é¾„é™åºæ’åº 12set mapred.reduce.tasks=4;select id, age, name from stuent distribute by age sort by age desc; æŒ‰ç…§å­¦ç”Ÿåç§°æ±‡æ€»å­¦ç”Ÿå¹´é¾„ 1select name, sum(age) from student group by name; æ•°æ®å¯¼å…¥å¯¼å‡ºLoadè¯­æ³•ç»“æ„ 12LOAD DATA [LOCAL] INPATH 'filepath' [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)] å¤‡æ³¨: Load æ“ä½œåªæ˜¯å•çº¯çš„å¤åˆ¶/ç§»åŠ¨æ“ä½œï¼Œå°†æ•°æ®æ–‡ä»¶ç§»åŠ¨åˆ° Hive è¡¨å¯¹åº”çš„ä½ç½®ã€‚ LOCALå…³é”®å­— å¦‚æœæŒ‡å®šäº† LOCALï¼Œ load å‘½ä»¤ä¼šå»æŸ¥æ‰¾æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„ filepathã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®š LOCAL å…³é”®å­—ï¼Œåˆ™æ ¹æ®inpathä¸­çš„uriæŸ¥æ‰¾æ–‡ä»¶ OVERWRITEå…³é”®å­— å¦‚æœä½¿ç”¨äº† OVERWRITE å…³é”®å­—ï¼Œåˆ™ç›®æ ‡è¡¨ï¼ˆæˆ–è€…åˆ†åŒºï¼‰ä¸­çš„å†…å®¹ä¼šè¢«åˆ é™¤ï¼Œç„¶åå†å°† filepath æŒ‡å‘çš„æ–‡ä»¶/ç›®å½•ä¸­çš„å†…å®¹æ·»åŠ åˆ°è¡¨/åˆ†åŒºä¸­ã€‚ å¦‚æœç›®æ ‡è¡¨ï¼ˆåˆ†åŒºï¼‰å·²ç»æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ–‡ä»¶åå’Œ filepath ä¸­çš„æ–‡ä»¶åå†²çªï¼Œé‚£ä¹ˆç°æœ‰çš„æ–‡ä»¶ä¼šè¢«æ–°æ–‡ä»¶æ‰€æ›¿ä»£ã€‚ å®ä¾‹ åŠ è½½ç›¸å¯¹è·¯å¾„çš„æ•°æ® 1load data local inpath 'buckets.txt' into table student partition(stat_date='20131231'); åŠ è½½ç»å¯¹è·¯å¾„æ•°æ® 1load data local inpath '/root/app/datafile/buckets.txt' into table student partition(stat_date='20131230'); åŠ è½½åŒ…å«æ¨¡å¼æ•°æ® 1load data local inpath 'hdfs://192.168.11.11:9000/user/hibe/warehouse/student/stat_date=20131230/buckets.txt' into table student partition(stat_date='20131229'); overwrite å…³é”®å­—ä½¿ç”¨ 1load data local inpath 'buckets.txt' overwrite into table student partition(stat_date='20131229'); Insertè¯­æ³•ç»“æ„ 12345678910111213141516171819202122232425# åŸºæœ¬æ¨¡å¼æ’å…¥INSERT OVERWRITE/INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement FROM from_statement# å¤šæ’å…¥æ¨¡å¼FROM from_statement INSERT OVERWRITE/INTO TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement1 [INSERT OVERWRITE/INTO TABLE tablename2 [PARTITION ...] select_statement2] ...# è‡ªåŠ¨åˆ†åŒºæ¨¡å¼(æŸ¥è¯¢ç»“æœæœ‰åˆ†åŒºå­—æ®µ)INSERT OVERWRITE/INTO TABLE tablename PARTITION (partcol1[=val1], partcol2[=val2] ...) select_statement FROM from_statement# åˆ†æ¡¶æ•°æ®å¯¼å…¥set mapreduce.job.reduces=4;insert OVERWRITE/INTO TABLE tablenameselect_statement FROM tablename distribute by(var1) sort by(var2 asc);insert OVERWRITE/INTO table tablenameselect_statement cluster by(var1);# åŸºæœ¬æ•°æ®å¯¼å‡ºINSERT OVERWRITE/INTO [LOCAL] DIRECTORY directory1 SELECT ... FROM ...# å¤šå¯¼å‡ºæ¨¡å¼FROM from_statementINSERT OVERWRITE/INTO [LOCAL] DIRECTORY directory1 select_statement1[INSERT OVERWRITE/INTO [LOCAL] DIRECTORY directory2 select_statement2] ... å¤‡æ³¨: insert into ä¸ insert overwrite éƒ½å¯ä»¥å‘hiveè¡¨ä¸­æ’å…¥æ•°æ®ï¼Œä½†æ˜¯insert intoç›´æ¥è¿½åŠ åˆ°è¡¨ä¸­æ•°æ®çš„å°¾éƒ¨ï¼Œè€Œinsert overwriteä¼šé‡å†™æ•°æ®ï¼Œæ—¢å…ˆè¿›è¡Œåˆ é™¤ï¼Œå†å†™å…¥ã€‚å¦‚æœå­˜åœ¨åˆ†åŒºçš„æƒ…å†µï¼Œinsert overwriteä¼šåªé‡å†™å½“å‰åˆ†åŒºæ•°æ®ã€‚ LOCAL: LOCALå…³é”®å­—æ˜¯å°†æ•°æ®å¯¼å…¥åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚æœä¸åŠ LOCALå…³é”®å­—æ˜¯å°†æ•°æ®å¯¼å‡ºåˆ°HDFSæ–‡ä»¶ç³»ç»Ÿ å®ä¾‹ åŸºæœ¬æ¨¡å¼æ’å…¥ 12insert overwrite table student partition(stat_date='20140101')select id, age, name from student where stat_date='20131229'; å¤šæ’å…¥æ¨¡å¼ 12345from student insert overwrite table student partition(stat_date='20140102')select id, age, name where stat_date='20131229'insert overwrite table student partition(stat_date='20140103')select id, age, name where stat_date='20131229'; è‡ªåŠ¨åˆ†åŒºæ¨¡å¼ 12insert overwrite table student1 partition(stat_date)select id, age, stat_date from student where stat_date='20140101'; åˆ†é€šè¡¨æ•°æ®å¯¼å…¥ 123456789set mapreduce.job.reduces=4;insert into table stu_buckselect Sno,Sname,Sex,Sage,Sdept from student distribute by(Sno) sort by(Sno asc);insert overwrite table stu_buckselect * from student distribute by(Sno) sort by(Sno asc);insert overwrite table stu_buckselect * from student cluster by(Sno); å¯¼å‡ºæ–‡ä»¶åˆ°æœ¬åœ° 12insert overwrite local directory '/root/app/datafile/student1'select * from student1 æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿæ—¶è¿›è¡Œæ–‡æœ¬åºåˆ—åŒ–ï¼Œä¸”æ¯åˆ—ç”¨^Aæ¥åŒºåˆ†ï¼Œ\nä¸ºæ¢è¡Œç¬¦ã€‚ç”¨moreå‘½ä»¤æŸ¥çœ‹æ—¶ä¸å®¹æ˜“çœ‹å‡ºåˆ†å‰²ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨: sed -e â€˜s/\x01/|/gâ€™ filenameæ¥æŸ¥çœ‹ã€‚ å¯¼å‡ºæ•°æ®åˆ°HDFS 12insert overwrite directory 'hdfs://192.168.11.191:9000/user/hive/warehouse/mystudent'select * from student1; Joinæ“ä½œè¯­æ³•ç»“æ„ 123table1 JOIN table2 [join_condition] | table1 &#123;LEFT|RIGHT|FULL&#125; [OUTER] JOIN table2 join_condition | table1 LEFT SEMI JOIN table2 join_condition å¤‡æ³¨: â€‹ Hive æ”¯æŒç­‰å€¼è¿æ¥ï¼ˆequality joinsï¼‰ã€å¤–è¿æ¥ï¼ˆouter joinsï¼‰å’Œï¼ˆleft/right joinsï¼‰ã€‚Hive ä¸æ”¯æŒéç­‰å€¼çš„è¿æ¥ï¼Œå› ä¸ºéç­‰å€¼è¿æ¥éå¸¸éš¾è½¬åŒ–åˆ° map/reduce ä»»åŠ¡ã€‚å¦å¤–ï¼ŒHive æ”¯æŒå¤šäº 2 ä¸ªè¡¨çš„è¿æ¥ã€‚ Joinæ“ä½œçš„è¯´æ˜ ç­‰å€¼join 12345SELECT a.* FROM a JOIN b ON (a.id = b.id)ï¼›SELECT a.* FROM a JOIN b ON (a.id = b.id AND a.department = b.department)ï¼›# æ˜¯æ­£ç¡®çš„ï¼Œç„¶è€Œ:SELECT a.* FROM a JOIN b ON (a.id&gt;b.id)# æ˜¯é”™è¯¯çš„ã€‚ å¯ä»¥å¤šäºä¸¤å¼ è¡¨ 123456789SELECT a.val, b.val, c.val FROM a JOIN b ON (a.key = b.key1) JOIN c ON (c.key = b.key2);# å¦‚æœjoinä¸­å¤šä¸ªè¡¨çš„ join key æ˜¯åŒä¸€ä¸ªï¼Œåˆ™ join ä¼šè¢«è½¬åŒ–ä¸ºå•ä¸ª map/reduce ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼šSELECT a.val, b.val, c.val FROM a JOIN bON (a.key = b.key1) JOIN cON (c.key = b.key1)# è¢«è½¬åŒ–ä¸ºå•ä¸ª map/reduce ä»»åŠ¡ï¼Œå› ä¸º join ä¸­åªä½¿ç”¨äº† b.key1 ä½œä¸º join keyã€‚SELECT a.val, b.val, c.val FROM a JOIN b ON (a.key = b.key1)JOIN c ON (c.key = b.key2)# è€Œè¿™ä¸€ join è¢«è½¬åŒ–ä¸º 2 ä¸ª map/reduce ä»»åŠ¡ã€‚å› ä¸º b.key1 ç”¨äºç¬¬ä¸€æ¬¡ join æ¡ä»¶ï¼Œè€Œ b.key2 ç”¨äºç¬¬äºŒæ¬¡ joinã€‚ joinæ—¶ï¼Œæ¯æ¬¡map/reduceä»»åŠ¡çš„é€»è¾‘ â€‹ reducer ä¼šç¼“å­˜ join åºåˆ—ä¸­é™¤äº†æœ€åä¸€ä¸ªè¡¨çš„æ‰€æœ‰è¡¨çš„è®°å½•ï¼Œå†é€šè¿‡æœ€åä¸€ä¸ªè¡¨å°†ç»“æœåºåˆ—åŒ–åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ä¸€å®ç°æœ‰åŠ©äºåœ¨ reduce ç«¯å‡å°‘å†…å­˜çš„ä½¿ç”¨é‡ã€‚å®è·µä¸­ï¼Œåº”è¯¥æŠŠæœ€å¤§çš„é‚£ä¸ªè¡¨å†™åœ¨æœ€åï¼ˆå¦åˆ™ä¼šå› ä¸ºç¼“å­˜æµªè´¹å¤§é‡å†…å­˜ï¼‰ã€‚ä¾‹å¦‚ï¼š 123SELECT a.val, b.val, c.val FROM aJOIN b ON (a.key = b.key1) JOIN c ON (c.key = b.key1) æ‰€æœ‰è¡¨éƒ½ä½¿ç”¨åŒä¸€ä¸ª join keyï¼ˆä½¿ç”¨ 1 æ¬¡ map/reduce ä»»åŠ¡è®¡ç®—ï¼‰ã€‚Reduce ç«¯ä¼šç¼“å­˜ a è¡¨å’Œ b è¡¨çš„è®°å½•ï¼Œç„¶åæ¯æ¬¡å–å¾—ä¸€ä¸ª c è¡¨çš„è®°å½•å°±è®¡ç®—ä¸€æ¬¡ join ç»“æœï¼Œç±»ä¼¼çš„è¿˜æœ‰ï¼š 123SELECT a.val, b.val, c.val FROM aJOIN b ON (a.key = b.key1) JOIN c ON (c.key = b.key2) è¿™é‡Œç”¨äº† 2 æ¬¡ map/reduce ä»»åŠ¡ã€‚ç¬¬ä¸€æ¬¡ç¼“å­˜ a è¡¨ï¼Œç”¨ b è¡¨åºåˆ—åŒ–ï¼›ç¬¬äºŒæ¬¡ç¼“å­˜ç¬¬ä¸€æ¬¡ map/reduce ä»»åŠ¡çš„ç»“æœï¼Œç„¶åç”¨ c è¡¨åºåˆ—åŒ–ã€‚ LEFTï¼ŒRIGHT å’Œ FULL OUTER å…³é”®å­—ç”¨äºå¤„ç† join ä¸­ç©ºè®°å½•çš„æƒ…å†µ 12SELECT a.val, b.val FROM a LEFT OUTER JOIN b ON (a.key=b.key) å¯¹åº”æ‰€æœ‰ a è¡¨ä¸­çš„è®°å½•éƒ½æœ‰ä¸€æ¡è®°å½•è¾“å‡ºã€‚è¾“å‡ºçš„ç»“æœåº”è¯¥æ˜¯ a.val, b.valï¼Œå½“ a.key=b.key æ—¶ï¼Œè€Œå½“ b.key ä¸­æ‰¾ä¸åˆ°ç­‰å€¼çš„ a.key è®°å½•æ—¶ä¹Ÿä¼šè¾“å‡º:a.val, NULL æ‰€ä»¥ a è¡¨ä¸­çš„æ‰€æœ‰è®°å½•éƒ½è¢«ä¿ç•™äº†ï¼Œa RIGHT OUTER JOIN bâ€ä¼šä¿ç•™æ‰€æœ‰ b è¡¨çš„è®°å½•ã€‚ Join å‘ç”Ÿåœ¨ WHERE å­å¥ä¹‹å‰ã€‚å¦‚æœä½ æƒ³é™åˆ¶ join çš„è¾“å‡ºï¼Œåº”è¯¥åœ¨ WHERE å­å¥ä¸­å†™è¿‡æ»¤æ¡ä»¶â€”â€”æˆ–æ˜¯åœ¨ join å­å¥ä¸­å†™ã€‚è¿™é‡Œé¢ä¸€ä¸ªå®¹æ˜“æ··æ·†çš„é—®é¢˜æ˜¯è¡¨åˆ†åŒºçš„æƒ…å†µï¼š 123SELECT a.val, b.val FROM aLEFT OUTER JOIN b ON (a.key=b.key)WHERE a.ds='2009-07-07' AND b.ds='2009-07-07' ä¼š join a è¡¨åˆ° b è¡¨ï¼ˆOUTER JOINï¼‰ï¼Œåˆ—å‡º a.val å’Œ b.val çš„è®°å½•ã€‚WHERE ä»å¥ä¸­å¯ä»¥ä½¿ç”¨å…¶ä»–åˆ—ä½œä¸ºè¿‡æ»¤æ¡ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚å‰æ‰€è¿°ï¼Œå¦‚æœ b è¡¨ä¸­æ‰¾ä¸åˆ°å¯¹åº” a è¡¨çš„è®°å½•ï¼Œb è¡¨çš„æ‰€æœ‰åˆ—éƒ½ä¼šåˆ—å‡º NULLï¼ŒåŒ…æ‹¬ ds åˆ—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œjoin ä¼šè¿‡æ»¤ b è¡¨ä¸­ä¸èƒ½æ‰¾åˆ°åŒ¹é… a è¡¨ join key çš„æ‰€æœ‰è®°å½•ã€‚è¿™æ ·çš„è¯ï¼ŒLEFT OUTER å°±ä½¿å¾—æŸ¥è¯¢ç»“æœä¸ WHERE å­å¥æ— å…³äº†ã€‚è§£å†³çš„åŠæ³•æ˜¯åœ¨ OUTER JOIN æ—¶ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š 1234SELECT a.val, b.val FROM a LEFT OUTER JOIN bON (a.key=b.key AND b.ds='2009-07-07' AND a.ds='2009-07-07') è¿™ä¸€æŸ¥è¯¢çš„ç»“æœæ˜¯é¢„å…ˆåœ¨ join é˜¶æ®µè¿‡æ»¤è¿‡çš„ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨ä¸Šè¿°é—®é¢˜ã€‚è¿™ä¸€é€»è¾‘ä¹Ÿå¯ä»¥åº”ç”¨äº RIGHT å’Œ FULL ç±»å‹çš„ join ä¸­ã€‚ Join æ˜¯ä¸èƒ½äº¤æ¢ä½ç½®çš„ã€‚ æ— è®ºæ˜¯ LEFT è¿˜æ˜¯ RIGHT joinï¼Œéƒ½æ˜¯å·¦è¿æ¥çš„ã€‚ 123SELECT a.val1, a.val2, b.val, c.valFROM aJOIN b ON (a.key = b.key)LEFT OUTER JOIN c ON (a.key = c.key) å…ˆ join a è¡¨åˆ° b è¡¨ï¼Œä¸¢å¼ƒæ‰æ‰€æœ‰ join key ä¸­ä¸åŒ¹é…çš„è®°å½•ï¼Œç„¶åç”¨è¿™ä¸€ä¸­é—´ç»“æœå’Œ c è¡¨åš joinã€‚è¿™ä¸€è¡¨è¿°æœ‰ä¸€ä¸ªä¸å¤ªæ˜æ˜¾çš„é—®é¢˜ï¼Œå°±æ˜¯å½“ä¸€ä¸ª key åœ¨ a è¡¨å’Œ c è¡¨éƒ½å­˜åœ¨ï¼Œä½†æ˜¯ b è¡¨ä¸­ä¸å­˜åœ¨çš„æ—¶å€™ï¼šæ•´ä¸ªè®°å½•åœ¨ç¬¬ä¸€æ¬¡ joinï¼Œå³ a JOIN b çš„æ—¶å€™éƒ½è¢«ä¸¢æ‰äº†ï¼ˆåŒ…æ‹¬a.val1ï¼Œa.val2å’Œa.keyï¼‰ï¼Œç„¶åæˆ‘ä»¬å†å’Œ c è¡¨ join çš„æ—¶å€™ï¼Œå¦‚æœ c.key ä¸ a.key æˆ– b.key ç›¸ç­‰ï¼Œå°±ä¼šå¾—åˆ°è¿™æ ·çš„ç»“æœï¼šNULL, NULL, NULL, c.val Joinå®ä¾‹è·å–å·²ç»åˆ†é…ç­çº§çš„å­¦ç”Ÿå§“å 1select name, classname from student a join class b on (a.name = b.std_name); è·å–å°šæœªåˆ†é…ç­çº§å­¦ç”Ÿçš„å§“å 1select name, classname from student a left join class b on (a.name = b.std_name) where b.std_name = null; left semi join æ˜¯ IN/EXISTS çš„é«˜æ•ˆå®ç° åªä¼šæ‰“å°å·¦è¡¨çš„å­—æ®µ 1select id, name from stuent a left semi join class b on (a.name = b.std_name) Hive ShellHiveå‘½ä»¤è¡Œè¯­æ³•ç»“æ„ 1hive [-hiveconf x=y]* [&lt;-i filename&gt;]* [&lt;-f filename&gt;|&lt;-e query-string&gt;] [-S] è¯´æ˜: -i ä»æ–‡ä»¶åˆå§‹åŒ–HQLã€‚ -eä»å‘½ä»¤è¡Œæ‰§è¡ŒæŒ‡å®šçš„HQL -f æ‰§è¡ŒHQLè„šæœ¬ -v è¾“å‡ºæ‰§è¡Œçš„HQLè¯­å¥åˆ°æ§åˆ¶å° -p connect to Hive Server on port number -hiveconf x=y Use this to set hive/hadoop configuration variables. ,å®ä¾‹ 1ã€æ‰§è¡Œä¸€æ¬¡æŸ¥è¯¢ 1hive -e 'select count(*) from student'; 2ã€è¿è¡Œä¸€ä¸ªæ–‡ä»¶ 1hive -f query.hql 3ã€è¿è¡Œå‚æ•°æ–‡ä»¶ 123hive -i initHQl.conf# æ–‡ä»¶å†…å®¹# set mapred.reduce.tasks = 4 Hive é…ç½®å‚æ•°Hiveå‚æ•°æ–‡æ¡£åœ°å€: https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties å¼€å‘Hiveåº”ç”¨æ—¶ï¼Œä¸å¯é¿å…åœ°éœ€è¦è®¾å®šHiveçš„å‚æ•°ã€‚è®¾å®šHiveçš„å‚æ•°å¯ä»¥è°ƒä¼˜HQLä»£ç çš„æ‰§è¡Œæ•ˆç‡ï¼Œæˆ–å¸®åŠ©å®šä½é—®é¢˜ã€‚ç„¶è€Œå®è·µä¸­ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸ºä»€ä¹ˆè®¾å®šçš„å‚æ•°æ²¡æœ‰èµ·ä½œç”¨ï¼Ÿè¿™é€šå¸¸æ˜¯é”™è¯¯çš„è®¾å®šæ–¹å¼å¯¼è‡´çš„ã€‚ å¯¹äºä¸€èˆ¬å‚æ•°ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§è®¾å®šæ–¹å¼ï¼š é…ç½®æ–‡ä»¶ å‘½ä»¤è¡Œå‚æ•° å‚æ•°å£°æ˜ é…ç½®æ–‡ä»¶Hiveçš„é…ç½®æ–‡ä»¶åŒ…æ‹¬ ç”¨æˆ·è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼š$HIVE_CONF_DIR/hive-site.xml é»˜è®¤é…ç½®æ–‡ä»¶ï¼š$HIVE_CONF_DIR/hive-default.xml ç”¨æˆ·è‡ªå®šä¹‰é…ç½®ä¼šè¦†ç›–é»˜è®¤é…ç½®ã€‚ å¦å¤–ï¼ŒHiveä¹Ÿä¼šè¯»å…¥Hadoopçš„é…ç½®ï¼Œå› ä¸ºHiveæ˜¯ä½œä¸ºHadoopçš„å®¢æˆ·ç«¯å¯åŠ¨çš„ï¼ŒHiveçš„é…ç½®ä¼šè¦†ç›–Hadoopçš„é…ç½®ã€‚ é…ç½®æ–‡ä»¶çš„è®¾å®šå¯¹æœ¬æœºå¯åŠ¨çš„æ‰€æœ‰Hiveè¿›ç¨‹éƒ½æœ‰æ•ˆã€‚ å‘½ä»¤è¡Œå‚æ•°å¯åŠ¨Hiveï¼ˆå®¢æˆ·ç«¯æˆ–Serveræ–¹å¼ï¼‰æ—¶ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œæ·»åŠ -hiveconf param=valueæ¥è®¾å®šå‚æ•°ï¼Œä¾‹å¦‚ï¼š 1bin/hive -hiveconf hive.root.logger=INFO,console è¿™ä¸€è®¾å®šå¯¹æœ¬æ¬¡å¯åŠ¨çš„Sessionï¼ˆå¯¹äºServeræ–¹å¼å¯åŠ¨ï¼Œåˆ™æ˜¯æ‰€æœ‰è¯·æ±‚çš„Sessionsï¼‰æœ‰æ•ˆ å‚æ•°å£°æ˜å¯ä»¥åœ¨HQLä¸­ä½¿ç”¨SETå…³é”®å­—è®¾å®šå‚æ•°ï¼Œä¾‹å¦‚ï¼š 1set mapred.reduce.tasks=100; è¿™ä¸€è®¾å®šçš„ä½œç”¨åŸŸä¹Ÿæ˜¯sessionçº§çš„ã€‚ ä¸Šè¿°ä¸‰ç§è®¾å®šæ–¹å¼çš„ä¼˜å…ˆçº§ä¾æ¬¡é€’å¢ã€‚å³å‚æ•°å£°æ˜è¦†ç›–å‘½ä»¤è¡Œå‚æ•°ï¼Œå‘½ä»¤è¡Œå‚æ•°è¦†ç›–é…ç½®æ–‡ä»¶è®¾å®šã€‚æ³¨æ„æŸäº›ç³»ç»Ÿçº§çš„å‚æ•°ï¼Œä¾‹å¦‚log4jç›¸å…³çš„è®¾å®šï¼Œå¿…é¡»ç”¨å‰ä¸¤ç§æ–¹å¼è®¾å®šï¼Œå› ä¸ºé‚£äº›å‚æ•°çš„è¯»å–åœ¨Sessionå»ºç«‹ä»¥å‰å·²ç»å®Œæˆäº†ã€‚ Hive è‡ªå®šä¹‰å‡½æ•°ã€Transformå½“Hiveæä¾›çš„å†…ç½®å‡½æ•°æ— æ³•æ»¡è¶³ä½ çš„ä¸šåŠ¡å¤„ç†éœ€è¦æ—¶ï¼Œæ­¤æ—¶å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼šuser-defined functionï¼‰ã€‚ è‡ªå®šä¹‰å‡½æ•°åˆ†ç±» UDF ä½œç”¨äºå•ä¸ªæ•°æ®è¡Œï¼Œäº§ç”Ÿä¸€ä¸ªæ•°æ®è¡Œä½œä¸ºè¾“å‡ºã€‚ï¼ˆæ•°å­¦å‡½æ•°ï¼Œå­—ç¬¦ä¸²å‡½æ•°ï¼‰ UDAFï¼ˆç”¨æˆ·å®šä¹‰èšé›†å‡½æ•°ï¼‰ï¼šæ¥æ”¶å¤šä¸ªè¾“å…¥æ•°æ®è¡Œï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªè¾“å‡ºæ•°æ®è¡Œã€‚ï¼ˆcountï¼Œmaxï¼‰ UDFå¼€å‘æ­¥éª¤ å…ˆå¼€å‘ä¸€ä¸ªjavaç±»ï¼Œç»§æ‰¿UDFï¼Œ å¹¶é‡è½½evaluateæ–¹æ³• 12345678910package cn.itcast.bigdata.udfimport org.apache.hadoop.hive.ql.exec.UDF;import org.apache.hadoop.io.Text;public final class Lower extends UDF&#123; public Text evaluate(final Text s)&#123; if(s==null)&#123;return null;&#125; return new Text(s.toString().toLowerCase()); &#125;&#125; æ‰“æˆjaråŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ å°†jaråŒ…æ·»åŠ åˆ°hiveçš„classpath 1hive&gt;add JAR /home/hadoop/udf.jar; åˆ›å»ºä¸´æ—¶å‡½æ•°ä¸å¼€å‘å¥½çš„java classå…³è” 1Hive&gt;create temporary function toprovince as 'cn.itcast.bigdata.udf.ToProvince'; å³å¯åœ¨hqlä¸­ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°strip 1Select strip(name),age from t_test; Transformå®ç°æ­¥éª¤Hiveçš„ TRANSFORM å…³é”®å­—æä¾›äº†åœ¨SQLä¸­è°ƒç”¨è‡ªå†™è„šæœ¬çš„åŠŸèƒ½ é€‚åˆå®ç°Hiveä¸­æ²¡æœ‰çš„åŠŸèƒ½åˆä¸æƒ³å†™UDFçš„æƒ…å†µ ç¼–è¾‘weekday_mapper.pyå†…å®¹ 123456789#!/bin/pythonimport sysimport datetimefor line in sys.stdin: line = line.strip() movieid, rating, unixtime,userid = line.split('\t') weekday = datetime.datetime.fromtimestamp(float(unixtime)).isoweekday() print '\t'.join([movieid, rating, str(weekday),userid]) æ·»åŠ transformæ–¹æ³• 1hive&gt;add FILE weekday_mapper.py; ä½¿ç”¨transformè¿›è¡ŒæŸ¥è¯¢ 123456INSERT OVERWRITE TABLE u_data_newSELECT TRANSFORM (movieid, rating, unixtime,userid) USING &apos;python weekday_mapper.py&apos; AS (movieid, rating, weekday,userid)FROM u_data; Hiveå®æˆ˜ä¾‹å­éœ€æ±‚æœ‰å¦‚ä¸‹è®¿å®¢è®¿é—®æ¬¡æ•°ç»Ÿè®¡è¡¨ t_access_times è®¿å®¢ æœˆä»½ è®¿é—®æ¬¡æ•° A 2015-01 5 A 2015-01 15 B 2015-01 5 A 2015-01 8 B 2015-01 25 A 2015-01 5 A 2015-02 4 A 2015-02 6 B 2015-02 10 B 2015-02 5 â€¦â€¦ â€¦â€¦ â€¦â€¦ éœ€è¦è¾“å‡ºæŠ¥è¡¨ï¼št_access_times_accumulate è®¿å®¢ æœˆä»½ æœˆè®¿é—®æ€»è®¡ ç´¯è®¡è®¿é—®æ€»è®¡ A 2015-01 33 33 A 2015-02 10 43 â€¦â€¦. â€¦â€¦. â€¦â€¦. â€¦â€¦. B 2015-01 30 30 B 2015-02 15 45 â€¦â€¦. â€¦â€¦. â€¦â€¦. â€¦â€¦. å®ç°12345678910select A.username,A.month,max(A.salary) as salary,sum(B.salary) as accumulatefrom (select username,month,sum(salary) as salary from t_access_times group by username,month) A inner join (select username,month,sum(salary) as salary from t_access_times group by username,month) BonA.username=B.usernamewhere B.month &lt;= A.monthgroup by A.username,A.monthorder by A.username,A.month; HQLç¤ºä¾‹è¡¨ä¿¡æ¯æŸ¥è¯¢123show databases;show tables;desc test; è¡¨åˆ†æ¡¶ç¤ºä¾‹123456789101112131415161718192021222324set mapreduce.job.reduces=4;drop table stu_buck;create table stu_buck(Sno int,Sname string,Sex string,Sage int,Sdept string)clustered by(Sno) sorted by(Sno DESC)into 4 bucketsrow format delimitedfields terminated by ',';insert overwrite table student_buckselect * from student cluster by(Sno) sort by(Sage); æŠ¥é”™,cluster å’Œ sort ä¸èƒ½å…±å­˜insert into table stu_buckselect Sno,Sname,Sex,Sage,Sdept from student distribute by(Sno) sort by(Sno asc);insert overwrite table stu_buckselect * from student distribute by(Sno) sort by(Sno asc);insert overwrite table stu_buckselect * from student cluster by(Sno); å¤šé‡æ’å…¥12345from studentinsert into table student_p partition(part='a')select * where Sno&lt;95011;insert into table student_p partition(part='a')select * where Sno&lt;95011; å¯¼å‡ºæ•°æ®åˆ°æœ¬åœ°12insert overwrite local directory '/home/hadoop/student.txt'select * from student;]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>Hive</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hadoop HAé«˜å¯ç”¨]]></title>
    <url>%2F2020%2F01%2F17%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FHADOOP%2Fhadoop%20HA%E9%AB%98%E5%8F%AF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[HADOOPçš„HAæœºåˆ¶æ­£å¼å¼•å…¥HAæœºåˆ¶æ˜¯ä»hadoop2.0å¼€å§‹ï¼Œä¹‹å‰çš„ç‰ˆæœ¬ä¸­æ²¡æœ‰HAæœºåˆ¶ HAçš„è¿ä½œæœºåˆ¶ä»‹ç»æ‰€è°“HAï¼Œå³é«˜å¯ç”¨ï¼ˆ7*24å°æ—¶ä¸ä¸­æ–­æœåŠ¡ï¼‰ å®ç°é«˜å¯ç”¨æœ€å…³é”®çš„æ˜¯æ¶ˆé™¤å•ç‚¹æ•…éšœ hadoop-haä¸¥æ ¼æ¥è¯´åº”è¯¥åˆ†æˆå„ä¸ªç»„ä»¶çš„HAæœºåˆ¶â€”â€”HDFSçš„HAã€YARNçš„HA HDFSçš„HAæœºåˆ¶è¯¦è§£HDFSæ€ä¹ˆå®ç°HAæœºåˆ¶ é€šè¿‡åŒnamenodeæ¶ˆé™¤å•ç‚¹æ•…éšœ åŒnamenodeçš„å·¥ä½œæ–¹å¼ å…ƒæ•°æ®ç®¡ç† å…ƒæ•°æ®ç®¡ç†æ–¹å¼ä¸ä¼ ç»Ÿæ–¹å¼ä¸åŒï¼Œåœ¨æ¯ä¸ªnamenodeå†…å­˜ä¸­å„è‡ªä¿å­˜ä¸€ä»½å…ƒæ•°æ® Editsæ—¥å¿—åªèƒ½æœ‰ä¸€ä»½ï¼Œåªæœ‰ActiveçŠ¶æ€çš„namenodeèŠ‚ç‚¹å¯ä»¥åšå†™æ“ä½œï¼Œ ä¸¤ä¸ªnamenodeéƒ½å¯ä»¥è¯»å–edits å…±äº«çš„editsæ”¾åœ¨ä¸€ä¸ªå…±äº«å­˜å‚¨ä¸­ç®¡ç†ï¼ˆqjournalå’ŒNFSä¸¤ä¸ªä¸»æµå®ç°ï¼‰ çŠ¶æ€ç®¡ç†åŠŸèƒ½æ¨¡å— å®ç°äº†ä¸€ä¸ªzkfailoverï¼Œå¸¸é©»åœ¨æ¯ä¸€ä¸ªnamenodeæ‰€åœ¨çš„èŠ‚ç‚¹ æ¯ä¸€ä¸ªzkfailoverè´Ÿè´£ç›‘æ§è‡ªå·±æ‰€åœ¨namenodeèŠ‚ç‚¹ï¼Œåˆ©ç”¨zkè¿›è¡ŒçŠ¶æ€æ ‡è¯† å½“éœ€è¦è¿›è¡ŒçŠ¶æ€åˆ‡æ¢æ—¶ï¼Œç”±zkfailoveræ¥è´Ÿè´£åˆ‡æ¢ åˆ‡æ¢æ—¶éœ€è¦é˜²æ­¢brain splitç°è±¡çš„å‘ç”Ÿï¼Œå³ç¨‹åºå‡æ­»ç°è±¡ï¼Œä¼šå¯¼è‡´è„‘è£‚å‘ç”Ÿï¼Œæ‰€ä»¥éœ€è¦åœ¨åˆ‡æ¢ç¨‹åºçš„æ—¶å€™ï¼Œå¼ºåˆ¶åœæ­¢å¼‚å¸¸ç¨‹åº æœåŠ¡åç§° åŒnamenode å¯¹å¤–æä¾›æœåŠ¡ä¼šç”¨ä¸€ä¸ªé€»è¾‘åç§°æ¥è¡¨ç¤ºï¼Œæ‰€ä»¥clientåªéœ€è¦è¯·æ±‚namenodeçš„é€»è¾‘åç§°å³å¯ï¼Œä¸ç”¨å…³æ³¨å“ªä¸ªnamenodeæ­£åœ¨å¯¹å¤–æä¾›æœåŠ¡ HDFSçš„HAå›¾è§£ YARN çš„HAæœºåˆ¶YARNæ€ä¹ˆå®ç°HAæœºåˆ¶ YARN-resource manager ä¹Ÿæ˜¯é€šè¿‡åŒèŠ‚ç‚¹çš„æ–¹å¼ï¼Œæ¥å®ç°HAçš„ åŒresource managerçš„å·¥ä½œæ–¹å¼ çŠ¶æ€ç®¡ç† Yarnçš„é«˜å¯ç”¨çŠ¶æ€ç®¡ç†ç›¸å¯¹äºHDFSéå¸¸ç®€å•ï¼ŒåŒresourceé€šè¿‡zookeeperæ¥åŒæ­¥æ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæ ¹æ®å¯¹æ–¹çš„çŠ¶æ€æ¥æ›´æ”¹è‡ªå·±çš„æœåŠ¡çŠ¶æ€ å¦‚æœå®¢æˆ·ç«¯æ­£åœ¨è¿è¡Œç¨‹åºï¼Œè¿™æ˜¯resourceå‘ç”Ÿäº†å´©æºƒï¼Œè¿™æ—¶resourceä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å¦å¤–ä¸€å°æœºå™¨ä¸Šï¼ŒMAPREDUCEä¼šè‡ªåŠ¨é‡è¯• æœåŠ¡åç§° åŒresource å¯¹å¤–æä¾›æœåŠ¡ä¼šç”¨ä¸€ä¸ªé€»è¾‘åç§°æ¥è¡¨ç¤ºï¼Œclientä¸ç”¨å…³æ³¨å“ªä¸ªnamenodeæ­£åœ¨å¯¹å¤–æä¾›æœåŠ¡ YARNé«˜å¯ç”¨å›¾è§£ HDFSè”é‚¦æœºåˆ¶(namenodeæ°´å¹³æ‰©å±•)HDFS HA è¿˜å­˜åœ¨çš„é—®é¢˜ ç³»ç»Ÿæ‰©å±•æ€§æ–¹é¢ï¼Œå…ƒæ•°æ®å­˜å‚¨åœ¨NNå†…å­˜ä¸­ï¼Œä¼šå—åˆ°NNå†…å­˜ä¸Šé™çš„åˆ¶çº¦ã€‚ æ•´ä½“æ€§èƒ½æ–¹é¢ï¼Œååé‡å—å•ä¸ªNNçš„å½±å“ã€‚ éš”ç¦»æ€§æ–¹é¢ï¼Œä¸€ä¸ªç¨‹åºå¯èƒ½ä¼šå½±å“å…¶ä»–è¿è¡Œçš„ç¨‹åºï¼Œå¦‚ä¸€ä¸ªç¨‹åºæ¶ˆè€—è¿‡å¤šèµ„æºå¯¼è‡´å…¶ä»–ç¨‹åºæ— æ³•é¡ºåˆ©è¿è¡Œã€‚HDFS HAæœ¬è´¨ä¸Šè¿˜æ˜¯å•åç§°èŠ‚ç‚¹ã€‚ HDFSè”é‚¦çš„ä½œç”¨ åœ¨HDFSè”é‚¦ä¸­ï¼Œè®¾è®¡äº†å¤šä¸ªç›¸äº’ç‹¬ç«‹çš„NNï¼Œä½¿å¾—HDFSçš„å‘½åæœåŠ¡èƒ½å¤Ÿæ°´å¹³æ‰©å±•ï¼Œè¿™äº›NNåˆ†åˆ«è¿›è¡Œå„è‡ªå‘½åç©ºé—´å’Œå—çš„ç®¡ç†ï¼Œä¸éœ€è¦å½¼æ­¤åè°ƒã€‚æ¯ä¸ªDNè¦å‘é›†ç¾¤ä¸­æ‰€æœ‰çš„NNæ³¨å†Œï¼Œå¹¶å‘¨æœŸæ€§çš„å‘é€å¿ƒè·³ä¿¡æ¯å’Œå—ä¿¡æ¯ï¼ŒæŠ¥å‘Šè‡ªå·±çš„çŠ¶æ€ã€‚ HDFSè”é‚¦æ‹¥æœ‰å¤šä¸ªç‹¬ç«‹çš„å‘½åç©ºé—´ï¼Œå…¶ä¸­ï¼Œæ¯ä¸€ä¸ªå‘½åç©ºé—´ç®¡ç†å±äºè‡ªå·±çš„ä¸€ç»„å—ï¼Œè¿™äº›å±äºåŒä¸€ä¸ªå‘½åç©ºé—´çš„å—ç»„æˆä¸€ä¸ªâ€œå—æ± â€ã€‚æ¯ä¸ªDNä¼šä¸ºå¤šä¸ªå—æ± æä¾›å—çš„å­˜å‚¨ï¼Œå—æ± ä¸­çš„å„ä¸ªå—å®é™…ä¸Šæ˜¯å­˜å‚¨åœ¨ä¸åŒDNä¸­çš„ã€‚ HDFSè”é‚¦å›¾è§£ NameNodeçš„å®‰å…¨æ¨¡å¼ä»€ä¹ˆæ˜¯namenodeçš„å®‰å…¨æ¨¡å¼ åœ¨nameåˆšå¯åŠ¨çš„æ—¶å€™ï¼Œå†…å­˜ä¸­åªæœ‰æ–‡ä»¶å’Œæ–‡ä»¶çš„å—idä»¥åŠå‰¯æœ¬æ•°é‡ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“æ‰€æœ‰å—åœ¨å“ªä¸ªdatanodeä¸Š namenodeè¿™ä¸ªæ—¶å€™éœ€è¦ç­‰å¾…æ‰€æœ‰çš„datanodeå‘ä»–æ±‡æŠ¥è‡ªèº«æŒæœ‰çš„å—ä¿¡æ¯ï¼Œnamenodeæ‰èƒ½å†å…ƒæ•°æ®ä¸­è¡¥å…¨æ–‡ä»¶å—ä¿¡æ¯ä¸­çš„ä½ç½®ä¿¡æ¯ åªæœ‰å½“namenodeæ‰¾åˆ°99.8%çš„å—ä½ç½®ä¿¡æ¯ï¼Œæ‰ä¼šé€€å‡ºå®‰å…¨æ¨¡å¼ï¼Œæ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ namenode å®‰å…¨æ¨¡å¼å›¾è§£ HAé›†ç¾¤å®‰è£…éƒ¨ç½²å‰æœŸå‡†å¤‡ å‡†å¤‡7å°ä¸»æœº(ä»¥7å°æ¥ä¸¾ä¾‹ mini1, mini2, mini3, mini4, mini5, mini6, mini7) ä¿®æ”¹linuxä¸»æœºå ä¿®æ”¹/etc/hosts åŸŸåæ˜ å°„ å…³é—­é˜²ç«å¢™ é…ç½®sshå…å¯†ç™»å½• å®‰è£…JDKï¼Œé…ç½®JAVAç¯å¢ƒå˜é‡ ç¼–è¯‘HADOOPå®‰è£…åŒ…hadoop-2.6.4 é›†ç¾¤è§„åˆ’1234567mini1 192.168.1.200 jdkã€hadoop NameNodeã€DFSZKFailoverController(zkfc)mini2 192.168.1.201 jdkã€hadoop NameNodeã€DFSZKFailoverController(zkfc)mini3 192.168.1.202 jdkã€hadoop ResourceManager mini4 192.168.1.203 jdkã€hadoop ResourceManagermini5 192.168.1.205 jdkã€hadoopã€zookeeper DataNodeã€NodeManagerã€JournalNodeã€QuorumPeerMainmini6 192.168.1.206 jdkã€hadoopã€zookeeper DataNodeã€NodeManagerã€JournalNodeã€QuorumPeerMainmini7 192.168.1.207 jdkã€hadoopã€zookeeper DataNodeã€NodeManagerã€JournalNodeã€QuorumPeerMain è¯´æ˜: åœ¨hadoop2.0ä¸­é€šå¸¸ç”±ä¸¤ä¸ªNameNodeç»„æˆï¼Œä¸€ä¸ªå¤„äºactiveçŠ¶æ€ï¼Œå¦ä¸€ä¸ªå¤„äºstandbyçŠ¶æ€ã€‚Active NameNodeå¯¹å¤–æä¾›æœåŠ¡ï¼Œè€ŒStandby NameNodeåˆ™ä¸å¯¹å¤–æä¾›æœåŠ¡ï¼Œä»…åŒæ­¥active namenodeçš„çŠ¶æ€ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨å®ƒå¤±è´¥æ—¶å¿«é€Ÿè¿›è¡Œåˆ‡æ¢ã€‚hadoop2.0å®˜æ–¹æä¾›äº†ä¸¤ç§HDFS HAçš„è§£å†³æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯NFSï¼Œå¦ä¸€ç§æ˜¯QJMã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç®€å•çš„QJMã€‚åœ¨è¯¥æ–¹æ¡ˆä¸­ï¼Œä¸»å¤‡NameNodeä¹‹é—´é€šè¿‡ä¸€ç»„JournalNodeåŒæ­¥å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¸€æ¡æ•°æ®åªè¦æˆåŠŸå†™å…¥å¤šæ•°JournalNodeå³è®¤ä¸ºå†™å…¥æˆåŠŸã€‚é€šå¸¸é…ç½®å¥‡æ•°ä¸ªJournalNodeè¿™é‡Œè¿˜é…ç½®äº†ä¸€ä¸ªzookeeperé›†ç¾¤ï¼Œç”¨äºZKFCï¼ˆDFSZKFailoverControllerï¼‰æ•…éšœè½¬ç§»ï¼Œå½“Active NameNodeæŒ‚æ‰äº†ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢Standby NameNodeä¸ºstandbyçŠ¶æ€ hadoop-2.2.0ä¸­ä¾ç„¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ResourceManageråªæœ‰ä¸€ä¸ªï¼Œå­˜åœ¨å•ç‚¹æ•…éšœï¼Œhadoop-2.6.4è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ä¸ªResourceManagerï¼Œä¸€ä¸ªæ˜¯Activeï¼Œä¸€ä¸ªæ˜¯Standbyï¼ŒçŠ¶æ€ç”±zookeeperè¿›è¡Œåè°ƒ å®‰è£…æ­¥éª¤ä¸€. é…ç½®zookeeperé›†ç¾¤ è§£å‹zookeeper 1tar -zxvf zookeeper-3.4.5.tar.gz -C /home/hadoop/app/ ä¿®æ”¹é…ç½® 1234567891011cd /home/hadoop/app/zookeeper-3.4.5/conf/cp zoo_sample.cfg zoo.cfgvim zoo.cfg# ä¿®æ”¹ dataDir=/home/hadoop/app/zookeeper-3.4.5/tmp# æ·»åŠ server.1=mini5:2888:3888server.2=mini6:2888:3888server.3=mini7:2888:3888# åˆ›å»ºtmpæ–‡ä»¶å¤¹mkdir /home/hadoop/app/zookeeper-3.4.5/tmpecho 1 &gt; /home/hadoop/app/zookeeper-3.4.5/tmp/myid æ‹·è´zkåˆ°é›†ç¾¤å…¶ä»–èŠ‚ç‚¹ 12scp -r /home/hadoop/app/zookeeper-3.4.5/ mini6:/home/hadoop/app/scp -r /home/hadoop/app/zookeeper-3.4.5/ mini7:/home/hadoop/app/ æ³¨æ„è¦ä¿®æ”¹å…¶ä»–èŠ‚ç‚¹çš„myidå†…å®¹hadoop06ï¼š echo 2 &gt; /home/hadoop/app/zookeeper-3.4.5/tmp/myidhadoop07ï¼š echo 3 &gt; /home/hadoop/app/zookeeper-3.4.5/tmp/myid äºŒ. é…ç½®hadoopé›†ç¾¤ è§£å‹hadoop 1tar -zxvf hadoop-2.6.4.tar.gz -C /home/hadoop/app/ é…ç½®HDFS æ·»åŠ ç¯å¢ƒå˜é‡ 12345678#å°†hadoopæ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­vim /etc/profileexport JAVA_HOME=/usr/java/jdk1.7.0_55export HADOOP_HOME=/hadoop/hadoop-2.6.4export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin#hadoop2.0çš„é…ç½®æ–‡ä»¶å…¨éƒ¨åœ¨$HADOOP_HOME/etc/hadoopä¸‹cd /home/hadoop/app/hadoop-2.6.4/etc/hadoop ä¿®æ”¹hadoop-env.sh 12vi hadoop-env.sh# ä¿®æ”¹ export JAVA_HOME=/home/hadoop/app/jdk1.7.0_55 ä¿®æ”¹é…ç½®æ–‡ä»¶ core-site.xml 123456789101112131415161718&lt;configuration&gt;&lt;!-- æŒ‡å®šhdfsçš„nameserviceä¸ºns1 --&gt;&lt;property&gt;&lt;name&gt;fs.defaultFS&lt;/name&gt;&lt;value&gt;hdfs://bi/&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®šhadoopä¸´æ—¶ç›®å½• --&gt;&lt;property&gt;&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;&lt;value&gt;/home/hadoop/app/hdpdata/&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®šzookeeperåœ°å€ --&gt;&lt;property&gt;&lt;name&gt;ha.zookeeper.quorum&lt;/name&gt;&lt;value&gt;mini5:2181,mini6:2181,mini7:2181&lt;/value&gt;&lt;/property&gt;&lt;/configuration&gt; hdfs-site.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970&lt;configuration&gt;&lt;!--æŒ‡å®šhdfsçš„nameserviceä¸ºbiï¼Œéœ€è¦å’Œcore-site.xmlä¸­çš„ä¿æŒä¸€è‡´ --&gt;&lt;property&gt;&lt;name&gt;dfs.nameservices&lt;/name&gt;&lt;value&gt;bi&lt;/value&gt;&lt;/property&gt;&lt;!-- biä¸‹é¢æœ‰ä¸¤ä¸ªNameNodeï¼Œåˆ†åˆ«æ˜¯nn1ï¼Œnn2 --&gt;&lt;property&gt;&lt;name&gt;dfs.ha.namenodes.bi&lt;/name&gt;&lt;value&gt;nn1,nn2&lt;/value&gt;&lt;/property&gt;&lt;!-- nn1çš„RPCé€šä¿¡åœ°å€ --&gt;&lt;property&gt;&lt;name&gt;dfs.namenode.rpc-address.bi.nn1&lt;/name&gt;&lt;value&gt;mini1:9000&lt;/value&gt;&lt;/property&gt;&lt;!-- nn1çš„httpé€šä¿¡åœ°å€ --&gt;&lt;property&gt;&lt;name&gt;dfs.namenode.http-address.bi.nn1&lt;/name&gt;&lt;value&gt;mini1:50070&lt;/value&gt;&lt;/property&gt;&lt;!-- nn2çš„RPCé€šä¿¡åœ°å€ --&gt;&lt;property&gt;&lt;name&gt;dfs.namenode.rpc-address.bi.nn2&lt;/name&gt;&lt;value&gt;mini2:9000&lt;/value&gt;&lt;/property&gt;&lt;!-- nn2çš„httpé€šä¿¡åœ°å€ --&gt;&lt;property&gt;&lt;name&gt;dfs.namenode.http-address.bi.nn2&lt;/name&gt;&lt;value&gt;mini2:50070&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®šNameNodeçš„editså…ƒæ•°æ®åœ¨JournalNodeä¸Šçš„å­˜æ”¾ä½ç½® --&gt;&lt;property&gt;&lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt;&lt;value&gt;qjournal://mini5:8485;mini6:8485;mini7:8485/bi&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®šJournalNodeåœ¨æœ¬åœ°ç£ç›˜å­˜æ”¾æ•°æ®çš„ä½ç½® --&gt;&lt;property&gt;&lt;name&gt;dfs.journalnode.edits.dir&lt;/name&gt;&lt;value&gt;/home/hadoop/journaldata&lt;/value&gt;&lt;/property&gt;&lt;!-- å¼€å¯NameNodeå¤±è´¥è‡ªåŠ¨åˆ‡æ¢ --&gt;&lt;property&gt;&lt;name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt;&lt;value&gt;true&lt;/value&gt;&lt;/property&gt;&lt;!-- é…ç½®å¤±è´¥è‡ªåŠ¨åˆ‡æ¢å®ç°æ–¹å¼ --&gt;&lt;property&gt;&lt;name&gt;dfs.client.failover.proxy.provider.bi&lt;/name&gt;&lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;&lt;/property&gt;&lt;!-- é…ç½®éš”ç¦»æœºåˆ¶æ–¹æ³•ï¼Œå¤šä¸ªæœºåˆ¶ç”¨æ¢è¡Œåˆ†å‰²ï¼Œå³æ¯ä¸ªæœºåˆ¶æš‚ç”¨ä¸€è¡Œ--&gt;&lt;property&gt;&lt;name&gt;dfs.ha.fencing.methods&lt;/name&gt;&lt;value&gt;sshfenceshell(/bin/true)&lt;/value&gt;&lt;/property&gt;&lt;!-- ä½¿ç”¨sshfenceéš”ç¦»æœºåˆ¶æ—¶éœ€è¦sshå…ç™»é™† --&gt;&lt;property&gt;&lt;name&gt;dfs.ha.fencing.ssh.private-key-files&lt;/name&gt;&lt;value&gt;/home/hadoop/.ssh/id_rsa&lt;/value&gt;&lt;/property&gt;&lt;!-- é…ç½®sshfenceéš”ç¦»æœºåˆ¶è¶…æ—¶æ—¶é—´ --&gt;&lt;property&gt;&lt;name&gt;dfs.ha.fencing.ssh.connect-timeout&lt;/name&gt;&lt;value&gt;30000&lt;/value&gt;&lt;/property&gt;&lt;/configuration&gt; mapred-site.xml 1234567&lt;configuration&gt;&lt;!-- æŒ‡å®šmræ¡†æ¶ä¸ºyarnæ–¹å¼ --&gt;&lt;property&gt;&lt;name&gt;mapreduce.framework.name&lt;/name&gt;&lt;value&gt;yarn&lt;/value&gt;&lt;/property&gt;&lt;/configuration&gt; yarn-site.xml 1234567891011121314151617181920212223242526272829303132333435&lt;configuration&gt;&lt;!-- å¼€å¯RMé«˜å¯ç”¨ --&gt;&lt;property&gt;&lt;name&gt;yarn.resourcemanager.ha.enabled&lt;/name&gt;&lt;value&gt;true&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®šRMçš„cluster id --&gt;&lt;property&gt;&lt;name&gt;yarn.resourcemanager.cluster-id&lt;/name&gt;&lt;value&gt;yrc&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®šRMçš„åå­— --&gt;&lt;property&gt;&lt;name&gt;yarn.resourcemanager.ha.rm-ids&lt;/name&gt;&lt;value&gt;rm1,rm2&lt;/value&gt;&lt;/property&gt;&lt;!-- åˆ†åˆ«æŒ‡å®šRMçš„åœ°å€ --&gt;&lt;property&gt;&lt;name&gt;yarn.resourcemanager.hostname.rm1&lt;/name&gt;&lt;value&gt;mini3&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;yarn.resourcemanager.hostname.rm2&lt;/name&gt;&lt;value&gt;mini4&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®šzké›†ç¾¤åœ°å€ --&gt;&lt;property&gt;&lt;name&gt;yarn.resourcemanager.zk-address&lt;/name&gt;&lt;value&gt;mini5:2181,mini6:2181,mini7:2181&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;&lt;value&gt;mapreduce_shuffle&lt;/value&gt;&lt;/property&gt;&lt;/configuration&gt; slaveæ–‡ä»¶ 12345# slavesæ˜¯æŒ‡å®šå­èŠ‚ç‚¹çš„ä½ç½®ï¼Œå› ä¸ºè¦åœ¨hadoop01ä¸Šå¯åŠ¨HDFSã€åœ¨hadoop03å¯åŠ¨yarnï¼Œæ‰€ä»¥hadoop01ä¸Šçš„slavesæ–‡ä»¶æŒ‡å®šçš„æ˜¯datanodeçš„ä½ç½®ï¼Œhadoop03ä¸Šçš„slavesæ–‡ä»¶æŒ‡å®šçš„æ˜¯nodemanagerçš„ä½ç½®mini5mini6mini7 æ‹·è´é¡¹ç›®åˆ°å…¶ä»–èŠ‚ç‚¹ é…ç½®å…å¯†ç™»å½• 123456789101112131415161718192021222324#é¦–å…ˆè¦é…ç½®mini1åˆ°mini2ã€mini3ã€mini4ã€mini5ã€mini6ã€mini7çš„å…å¯†ç ç™»é™†#åœ¨mini1ä¸Šç”Ÿäº§ä¸€å¯¹é’¥åŒ™ssh-keygen -t rsa#å°†å…¬é’¥æ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬è‡ªå·±ssh-coyp-id mini1ssh-coyp-id mini2ssh-coyp-id mini3ssh-coyp-id mini4ssh-coyp-id mini5ssh-coyp-id mini6ssh-coyp-id mini7#é…ç½®mini3åˆ°mini4ã€mini5ã€mini6ã€mini7çš„å…å¯†ç ç™»é™†#åœ¨mini3ä¸Šç”Ÿäº§ä¸€å¯¹é’¥åŒ™ssh-keygen -t rsa#å°†å…¬é’¥æ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹ssh-coyp-id mini3 ssh-coyp-id mini4ssh-coyp-id mini5ssh-coyp-id mini6ssh-coyp-id mini7#æ³¨æ„ï¼šä¸¤ä¸ªnamenodeä¹‹é—´è¦é…ç½®sshå…å¯†ç ç™»é™†ï¼Œåˆ«å¿˜äº†é…ç½®hadoop02åˆ°hadoop01çš„å…ç™»é™†åœ¨mini2ä¸Šç”Ÿäº§ä¸€å¯¹é’¥åŒ™ssh-keygen -t rsassh-coyp-id -i mini1 å°†é…ç½®å¥½çš„hadoopæ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹ 123456scp -r /home/hadoop/app/hadoop-2.6.4 mini2:/home/hadoop/app/hadoop-2.6.4scp -r /home/hadoop/app/hadoop-2.6.4 mini3:/home/hadoop/app/hadoop-2.6.4scp -r /home/hadoop/app/hadoop-2.6.4 mini4:/home/hadoop/app/hadoop-2.6.4scp -r /home/hadoop/app/hadoop-2.6.4 mini5:/home/hadoop/app/hadoop-2.6.4scp -r /home/hadoop/app/hadoop-2.6.4 mini6:/home/hadoop/app/hadoop-2.6.4scp -r /home/hadoop/app/hadoop-2.6.4 mini7:/home/hadoop/app/hadoop-2.6.4 ä¸‰.å¯åŠ¨Hadoop HA å¯åŠ¨zookeeperé›†ç¾¤ï¼ˆåˆ†åˆ«åœ¨mini5ã€mini6ã€mini7ä¸Šå¯åŠ¨zkï¼‰ 1234cd /hadoop/zookeeper-3.4.5/bin/./zkServer.sh start# æŸ¥çœ‹çŠ¶æ€ï¼šä¸€ä¸ªleaderï¼Œä¸¤ä¸ªfollower./zkServer.sh status å¯åŠ¨journalnodeï¼ˆåˆ†åˆ«åœ¨åœ¨mini5ã€mini6ã€mini7ä¸Šæ‰§è¡Œ) 123cd /hadoop/hadoop-2.6.4sbin/hadoop-daemon.sh start journalnode# è¿è¡Œjpså‘½ä»¤æ£€éªŒï¼Œhadoop05ã€hadoop06ã€hadoop07ä¸Šå¤šäº†JournalNodeè¿›ç¨‹ æ ¼å¼åŒ–HDFS 12345# åœ¨mini1ä¸Šæ‰§è¡Œå‘½ä»¤:hdfs namenode -format# æ ¼å¼åŒ–åä¼šåœ¨æ ¹æ®core-site.xmlä¸­çš„hadoop.tmp.diré…ç½®ç”Ÿæˆä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘é…ç½®çš„æ˜¯/hadoop/hadoop-2.6.4/tmpï¼Œç„¶åå°†/hadoop/hadoop-2.6.4/tmpæ‹·è´åˆ°hadoop02çš„/hadoop/hadoop-2.6.4/ä¸‹ã€‚scp -r tmp/ hadoop02:/home/hadoop/app/hadoop-2.6.4/# ä¹Ÿå¯ä»¥è¿™æ ·ï¼Œå»ºè®®hdfs namenode -bootstrapStandby æ ¼å¼åŒ–ZKFC(åœ¨mini1ä¸Šæ‰§è¡Œä¸€æ¬¡å³å¯) 1hdfs zkfc -formatZK å¯åŠ¨HDFS(åœ¨mini1ä¸Šæ‰§è¡Œ) 1sbin/start-dfs.sh å¯åŠ¨YARN 12# å¯åŠ¨YARNï¼Œæ˜¯åœ¨hadoop02ä¸Šæ‰§è¡Œstart-yarn.shï¼ŒæŠŠnamenodeå’Œresourcemanageråˆ†å¼€æ˜¯å› ä¸ºæ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºä»–ä»¬éƒ½è¦å ç”¨å¤§é‡èµ„æºï¼Œæ‰€ä»¥æŠŠä»–ä»¬åˆ†å¼€äº†ï¼Œä»–ä»¬åˆ†å¼€äº†å°±è¦åˆ†åˆ«åœ¨ä¸åŒçš„æœºå™¨ä¸Šå¯åŠ¨)sbin/start-yarn.sh éªŒè¯é›†ç¾¤ åˆ°æ­¤ï¼Œhadoop-2.6.4é…ç½®å¹¶å®‰è£…å®Œæ¯• æµè§ˆå™¨è®¿é—®éªŒè¯ 1234http://hadoop00:50070NameNode 'hadoop01:9000' (active)http://hadoop01:50070NameNode 'hadoop02:9000' (standby) éªŒè¯HDFS HA 12345678910111213141516# é¦–å…ˆå‘hdfsä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶hadoop fs -put /etc/profile /profilehadoop fs -ls /# ç„¶åå†killæ‰activeçš„NameNodekill -9 &lt;pid of NN&gt;# é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼šhttp://192.168.1.202:50070# NameNode 'hadoop02:9000' (active)# è¿™ä¸ªæ—¶å€™hadoop02ä¸Šçš„NameNodeå˜æˆäº†active# åœ¨æ‰§è¡Œå‘½ä»¤ï¼šhadoop fs -ls /# -rw-r--r-- 3 root supergroup 1926 2014-02-06 15:36 /profile# åˆšæ‰ä¸Šä¼ çš„æ–‡ä»¶ä¾ç„¶å­˜åœ¨ï¼ï¼ï¼# æ‰‹åŠ¨å¯åŠ¨é‚£ä¸ªæŒ‚æ‰çš„NameNodesbin/hadoop-daemon.sh start namenode# é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼šhttp://192.168.1.201:50070# NameNode 'hadoop01:9000' (standby) é›†ç¾¤å·¥ä½œçŠ¶æ€æŸ¥è¯¢æŸ¥çœ‹hdfsçš„å„èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ 1bin/hdfs dfsadmin -report è·å–ä¸€ä¸ªnamenodeèŠ‚ç‚¹çš„HAçŠ¶æ€ 1bin/hdfs haadmin -getServiceState nn1 å•ç‹¬å¯åŠ¨ä¸€ä¸ªnamenodeè¿›ç¨‹ 12 å•ç‹¬å¯åŠ¨ä¸€ä¸ªzkfcè¿›ç¨‹ 1./hadoop-daemon.sh start zkfc é›†ç¾¤è¿ç»´æµ‹è¯•Datanode åŠ¨æ€ä¸Šä¸‹çº¿DatanodeåŠ¨æ€ä¸Šä¸‹çº¿å¾ˆç®€å•ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š å‡†å¤‡ä¸€å°æœåŠ¡å™¨ï¼Œè®¾ç½®å¥½ç¯å¢ƒ éƒ¨ç½²hadoopçš„å®‰è£…åŒ…ï¼Œå¹¶åŒæ­¥é›†ç¾¤é…ç½® è”ç½‘ä¸Šçº¿ï¼Œæ–°datanodeä¼šè‡ªåŠ¨åŠ å…¥é›†ç¾¤ å¦‚æœæ˜¯ä¸€æ¬¡å¢åŠ å¤§æ‰¹datanodeï¼Œè¿˜åº”è¯¥åšé›†ç¾¤è´Ÿè½½é‡å‡è¡¡ Namenode çŠ¶æ€åˆ‡æ¢ç®¡ç†ä½¿ç”¨çš„å‘½ä»¤ 1hdfs haadmin æŸ¥çœ‹namenodeå·¥ä½œçŠ¶æ€ 1hdfs haadmin -getServiceState nn1 å°†standbyçŠ¶æ€namenodeåˆ‡æ¢åˆ°active 1hdfs haadmin â€“transitionToActive nn1 å°†activeçŠ¶æ€namenodeåˆ‡æ¢åˆ°standby 1hdfs haadmin â€“transitionToStandby nn2 æ•°æ®å—çš„balanceå¯åŠ¨balancerçš„å‘½ä»¤ï¼š 1start-balancer.sh -threshold 8 è¿è¡Œä¹‹åï¼Œä¼šæœ‰Balancerè¿›ç¨‹å‡ºç°ï¼š ä¸Šè¿°å‘½ä»¤è®¾ç½®äº†Thresholdä¸º8%ï¼Œé‚£ä¹ˆæ‰§è¡Œbalancerå‘½ä»¤çš„æ—¶å€™ï¼Œé¦–å…ˆç»Ÿè®¡æ‰€æœ‰DataNodeçš„ç£ç›˜åˆ©ç”¨ç‡çš„å‡å€¼ï¼Œç„¶ååˆ¤æ–­å¦‚æœæŸä¸€ä¸ªDataNodeçš„ç£ç›˜åˆ©ç”¨ç‡è¶…è¿‡è¿™ä¸ªå‡å€¼Thresholdï¼Œé‚£ä¹ˆå°†ä¼šæŠŠè¿™ä¸ªDataNodeçš„blockè½¬ç§»åˆ°ç£ç›˜åˆ©ç”¨ç‡ä½çš„DataNodeï¼Œè¿™å¯¹äºæ–°èŠ‚ç‚¹çš„åŠ å…¥æ¥è¯´ååˆ†æœ‰ç”¨ã€‚Thresholdçš„å€¼ä¸º1åˆ°100ä¹‹é—´ï¼Œä¸æ˜¾ç¤ºçš„è¿›è¡Œå‚æ•°è®¾ç½®çš„è¯ï¼Œé»˜è®¤æ˜¯10ã€‚ HA ä¸‹çš„hdfs-apiå˜åŒ–å®¢æˆ·ç«¯éœ€è¦nameserviceçš„é…ç½®ä¿¡æ¯ï¼Œå…¶ä»–ä¸å˜ 12345678910111213141516171819202122/** * å¦‚æœè®¿é—®çš„æ˜¯ä¸€ä¸ªhaæœºåˆ¶çš„é›†ç¾¤ * åˆ™ä¸€å®šè¦æŠŠcore-site.xmlå’Œhdfs-site.xmlé…ç½®æ–‡ä»¶æ”¾åœ¨å®¢æˆ·ç«¯ç¨‹åºçš„classpathä¸‹ * ä»¥è®©å®¢æˆ·ç«¯èƒ½å¤Ÿç†è§£hdfs://ns1/ä¸­ â€œns1â€æ˜¯ä¸€ä¸ªhaæœºåˆ¶ä¸­çš„namenodeå¯¹â€”â€”nameservice * ä»¥åŠçŸ¥é“ns1ä¸‹å…·ä½“çš„namenodeé€šä¿¡åœ°å€ * @author * */public class UploadFile &#123; public static void main(String[] args) throws Exception &#123; Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://ns1/"); FileSystem fs = FileSystem.get(new URI("hdfs://ns1/"),conf,"hadoop"); fs.copyFromLocalFile(new Path("g:/eclipse-jee-luna-SR1-linux-gtk.tar.gz"), new Path("hdfs://ns1/")); fs.close(); &#125;&#125;]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>HADOOP</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>HADOOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MAPREDUCE]]></title>
    <url>%2F2020%2F01%2F10%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FHADOOP%2FMAPREDUCE%2F</url>
    <content type="text"><![CDATA[MAPREDUCE ä»‹ç»MAPREDUCEç®€ä»‹Mapreduceæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ï¼Œæ˜¯ç”¨æˆ·å¼€å‘â€œåŸºäºhadoopçš„æ•°æ®åˆ†æåº”ç”¨â€çš„æ ¸å¿ƒæ¡†æ¶ï¼› Mapreduceæ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ªhadoopé›†ç¾¤ä¸Šï¼› ä¸ºä»€ä¹ˆä½¿ç”¨MAPREDUCE æµ·é‡æ•°æ®åœ¨å•æœºä¸Šåœ¨å•æœºä¸Šå¤„ç†ç¡¬ä»¶èµ„æºé™åˆ¶ï¼Œæ— æ³•èƒœä»» è€Œä¸€æ—¦å°†å•æœºç‰ˆç¨‹åºæ‰©å±•åˆ°é›†ç¾¤æ¥åˆ†å¸ƒå¼è¿è¡Œï¼Œå°†æå¤§å¢åŠ ç¨‹åºçš„å¤æ‚åº¦å’Œå¼€å‘éš¾åº¦ å¼•å…¥mapreduceæ¡†æ¶åï¼Œå¼€å‘äººå‘˜å¯ä»¥å°†ç»å¤§éƒ¨åˆ†å·¥ä½œé›†ä¸­åœ¨ä¸šåŠ¡é€»è¾‘çš„å¼€å‘ä¸Šï¼Œè€Œå°†åˆ†å¸ƒå¼è®¡ç®—ä¸­çš„å¤æ‚æ€§äº¤ç”±æ¡†æ¶æ¥å¤„ç† å¯è§åœ¨ç¨‹åºç”±å•æœºç‰ˆæ‰©æˆåˆ†å¸ƒå¼æ—¶ï¼Œä¼šå¼•å…¥å¤§é‡çš„å¤æ‚å·¥ä½œã€‚ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œå¯ä»¥å°†åˆ†å¸ƒå¼ç¨‹åºä¸­çš„å…¬å…±åŠŸèƒ½å°è£…æˆæ¡†æ¶ï¼Œè®©å¼€å‘äººå‘˜å¯ä»¥å°†ç²¾åŠ›é›†ä¸­äºä¸šåŠ¡é€»è¾‘ã€‚ MAPREDUCEæ¡†æ¶è®¾è®¡æ€æƒ³ MAPREDUCEç»“æ„ä¸è¿è¡Œæµç¨‹MAPREDUCEè®¾è®¡ç»“æ„ä¸€ä¸ªå®Œæˆçš„MAPREDUCEç¨‹åºåœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶æœ‰ä¸‰ç±»å®ä¾‹è¿›ç¨‹: MRAppMaster: è´Ÿè´£æ•´ä¸ªç¨‹åºçš„è¿‡ç¨‹è°ƒåº¦åŠçŠ¶æ€åè°ƒ mapTask: è´Ÿè´£mapé˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ ReduceTask: è´Ÿè´£ reduce é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ MAPREDUCEè¿è¡Œæµç¨‹ç¤ºæ„å›¾ æµç¨‹è§£æ ä¸€ä¸ªmrç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œæœ€å…ˆå¯åŠ¨çš„æ˜¯MRAppMasterï¼ŒMRAppMasterå¯åŠ¨åæ ¹æ®æœ¬æ¬¡jobçš„æè¿°ä¿¡æ¯ï¼Œè®¡ç®—å‡ºéœ€è¦çš„maptaskå®ä¾‹æ•°é‡ï¼Œç„¶åå‘é›†ç¾¤ç”³è¯·æœºå™¨å¯åŠ¨ç›¸åº”æ•°é‡çš„maptaskè¿›ç¨‹ maptaskè¿›ç¨‹å¯åŠ¨ä¹‹åï¼Œæ ¹æ®ç»™å®šçš„æ•°æ®åˆ‡ç‰‡èŒƒå›´è¿›è¡Œæ•°æ®å¤„ç†ï¼Œä¸»ä½“æµç¨‹ä¸ºï¼š a. åˆ©ç”¨å®¢æˆ·æŒ‡å®šçš„inputformatæ¥è·å–RecordReaderè¯»å–æ•°æ®ï¼Œå½¢æˆè¾“å…¥KVå¯¹ b. å°†è¾“å…¥KVå¯¹ä¼ é€’ç»™å®¢æˆ·å®šä¹‰çš„map()æ–¹æ³•ï¼Œåšé€»è¾‘è¿ç®—ï¼Œå¹¶å°†map()æ–¹æ³•è¾“å‡ºçš„KVå¯¹æ”¶é›†åˆ°ç¼“å­˜ c. å°†ç¼“å­˜ä¸­çš„KVå¯¹æŒ‰ç…§Kåˆ†åŒºæ’åºåä¸æ–­æº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ MRAppMasterç›‘æ§åˆ°æ‰€æœ‰maptaskè¿›ç¨‹ä»»åŠ¡å®Œæˆä¹‹åï¼Œä¼šæ ¹æ®å®¢æˆ·æŒ‡å®šçš„å‚æ•°å¯åŠ¨ç›¸åº”æ•°é‡çš„reducetaskè¿›ç¨‹ï¼Œå¹¶å‘ŠçŸ¥reducetaskè¿›ç¨‹è¦å¤„ç†çš„æ•°æ®èŒƒå›´ï¼ˆæ•°æ®åˆ†åŒºï¼‰ Reducetaskè¿›ç¨‹å¯åŠ¨ä¹‹åï¼Œæ ¹æ®MRAppMasterå‘ŠçŸ¥çš„å¾…å¤„ç†æ•°æ®æ‰€åœ¨ä½ç½®ï¼Œä»è‹¥å¹²å°maptaskè¿è¡Œæ‰€åœ¨æœºå™¨ä¸Šè·å–åˆ°è‹¥å¹²ä¸ªmaptaskè¾“å‡ºç»“æœæ–‡ä»¶ï¼Œå¹¶åœ¨æœ¬åœ°è¿›è¡Œé‡æ–°å½’å¹¶æ’åºï¼Œç„¶åæŒ‰ç…§ç›¸åŒkeyçš„KVä¸ºä¸€ä¸ªç»„ï¼Œè°ƒç”¨å®¢æˆ·å®šä¹‰çš„reduce()æ–¹æ³•è¿›è¡Œé€»è¾‘è¿ç®—ï¼Œå¹¶æ”¶é›†è¿ç®—è¾“å‡ºçš„ç»“æœKVï¼Œç„¶åè°ƒç”¨å®¢æˆ·æŒ‡å®šçš„outputformatå°†ç»“æœæ•°æ®è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ MRclientæäº¤MRç¨‹åºç»™MRæ¡†æ¶çš„æµç¨‹ MAPREDUCEå¹¶è¡Œåº¦æœºåˆ¶maptaskçš„å¹¶è¡Œåº¦å†³å®šmapé˜¶æ®µçš„ä»»åŠ¡å¤„ç†å¹¶å‘åº¦ï¼Œè¿›è€Œå½±å“åˆ°æ•´ä¸ªjobçš„å¤„ç†é€Ÿåº¦ é‚£ä¹ˆï¼ŒmapTaskå¹¶è¡Œå®ä¾‹æ˜¯å¦è¶Šå¤šè¶Šå¥½å‘¢ï¼Ÿå…¶å¹¶è¡Œåº¦åˆæ˜¯å¦‚ä½•å†³å®šå‘¢ï¼Ÿ mapTask å¹¶è¡Œåº¦çš„å†³å®šæœºåˆ¶mapTaskå¹¶è¡Œåº¦è§„åˆ™ä¸€ä¸ªjobçš„mapé˜¶æ®µå¹¶è¡Œåº¦ç”±å®¢æˆ·ç«¯åœ¨æäº¤jobæ—¶å†³å®š è€Œå®¢æˆ·ç«¯å¯¹mapé˜¶æ®µå¹¶è¡Œåº¦çš„è§„åˆ’çš„åŸºæœ¬é€»è¾‘ä¸ºï¼š å°†å¾…å¤„ç†æ•°æ®æ‰§è¡Œé€»è¾‘åˆ‡ç‰‡ï¼ˆå³æŒ‰ç…§ä¸€ä¸ªç‰¹å®šåˆ‡ç‰‡å¤§å°ï¼Œå°†å¾…å¤„ç†æ•°æ®åˆ’åˆ†æˆé€»è¾‘ä¸Šçš„å¤šä¸ªsplitï¼‰ï¼Œç„¶åæ¯ä¸€ä¸ªsplitåˆ†é…ä¸€ä¸ªmapTaskå¹¶è¡Œå®ä¾‹å¤„ç† è¿™æ®µé€»è¾‘åŠå½¢æˆçš„åˆ‡ç‰‡è§„åˆ’æè¿°æ–‡ä»¶ï¼Œç”±FileInputFormatå®ç°ç±»çš„getSplits()æ–¹æ³•å®Œæˆï¼Œå…¶è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š FileInputFormat åˆ‡ç‰‡æœºåˆ¶åˆ‡ç‰‡æœºåˆ¶ (TextInputFormatç¤ºä¾‹) FileInputFormat ç”¨æ¥è¯»å–æ•°æ®ï¼Œå…¶æœ¬èº«ä¸ºä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç»§æ‰¿è‡ª InputFormat æŠ½è±¡ç±»ï¼Œé’ˆå¯¹ä¸åŒçš„ç±»å‹çš„æ•°æ®æœ‰ä¸åŒçš„å­ç±»æ¥å¤„ç†ï¼› FileInputFormat å¸¸è§çš„æ¥å£å®ç°ç±»åŒ…æ‹¬ï¼šTextInputFormatã€KeyValueTextInputFormatã€NLinelnputFormatã€CombineTextInputFormat å’Œè‡ªå®šä¹‰ ImputFormat ç­‰ã€‚ åˆ‡ç‰‡å®šä¹‰åœ¨MRclientçš„FileInputFormatç±»ä¸­çš„getSplit()æ–¹æ³•ä¸­ FileInputFormatä¸­é»˜è®¤çš„åˆ‡ç‰‡æœºåˆ¶: a. ç®€å•åœ°æŒ‰ç…§æ–‡ä»¶çš„å†…å®¹é•¿åº¦è¿›è¡Œåˆ‡ç‰‡ b. åˆ‡ç‰‡å¤§å°ï¼Œé»˜è®¤ç­‰äºblockå¤§å° c. åˆ‡ç‰‡æ—¶ä¸è€ƒè™‘æ•°æ®é›†æ•´ä½“ï¼Œè€Œæ˜¯é€ä¸ªé’ˆå¯¹æ¯ä¸€ä¸ªæ–‡ä»¶å•ç‹¬åˆ‡ç‰‡ æ¯”å¦‚å¾…å¤„ç†æ•°æ®æœ‰ä¸¤ä¸ªæ–‡ä»¶: 12file1.txt 320Mfile2.txt 10M ç»è¿‡FileInputFormatçš„åˆ‡ç‰‡æœºåˆ¶è¿ç®—åï¼Œè¡Œç¨‹çš„åˆ‡ç‰‡ä¿¡æ¯å¦‚ä¸‹: 1234file1.txt.split1-- 0~128file1.txt.split2-- 128~256file1.txt.split3-- 256~320file2.txt.split1-- 0~10M FileInputFormat ä¸­åˆ‡ç‰‡çš„å¤§å°å‚æ•°é…ç½® é€šè¿‡åˆ†ææºç ï¼Œåœ¨FileInputFormatä¸­ï¼Œè®¡ç®—åˆ‡ç‰‡å¤§å°çš„é€»è¾‘ï¼š 1Math.max(minSize, Math.min(maxSize, blockSize)); åˆ‡ç‰‡ä¸»è¦ç”±è¿™å‡ ä¸ªå€¼æ¥è¿ç®—å†³å®šï¼š minsize: é»˜è®¤å€¼ï¼š1, é…ç½®å‚æ•°ï¼š mapreduce.input.fileinputformat.split.minsize maxsizeï¼šé»˜è®¤å€¼ï¼šLong.MAXValue, é…ç½®å‚æ•°ï¼šmapreduce.input.fileinputformat.split.maxsize å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ‡ç‰‡å¤§å°=blocksize maxsizeï¼ˆåˆ‡ç‰‡æœ€å¤§å€¼ï¼‰ï¼š å‚æ•°å¦‚æœè°ƒå¾—æ¯”blocksizeå°ï¼Œåˆ™ä¼šè®©åˆ‡ç‰‡å˜å°ï¼Œè€Œä¸”å°±ç­‰äºé…ç½®çš„è¿™ä¸ªå‚æ•°çš„å€¼ minsize ï¼ˆåˆ‡ç‰‡æœ€å°å€¼ï¼‰ï¼š å‚æ•°è°ƒçš„æ¯”blockSizeå¤§ï¼Œåˆ™å¯ä»¥è®©åˆ‡ç‰‡å˜å¾—æ¯”blocksizeè¿˜å¤§ é…ç½®å¹¶å‘æ•°çš„å½±å“å› ç´ : è¿ç®—èŠ‚ç‚¹çš„ç¡¬ä»¶é…ç½® è¿ç®—ä»»åŠ¡çš„ç±»å‹: CPUå¯†é›†å‹è¿˜æ˜¯IOå¯†é›†å‹ è¿ç®—ä»»åŠ¡çš„æ•°é‡ å°æ–‡ä»¶åˆ‡ç‰‡ä¼˜åŒ– å¦‚æœæ˜¯å°æ–‡ä»¶ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„å°åˆ‡ç‰‡ï¼Œé€ æˆå¤§é‡çš„maptaskè¿è¡Œ è§£å†³åŠæ³•: 1. ä»æºå¤´ä¸Šè§£å†³é—®é¢˜ï¼Œæ–‡ä»¶åˆå¹¶åå†ä¸Šä¼ å¤„ç† å¯ä»¥ç”¨å¦å¤–ä¸€ç§InputFormat: CombineInputFormatï¼ˆå¯ä»¥å°†å¤šä¸ªæ–‡ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªåˆ‡ç‰‡ä¸­ï¼‰, å¯ä»¥è®¾ç½®æ¯ä¸ªæŠ€å·§ç¯‡çš„æœ€å°å®¹é‡å’Œæœ€å¤§å®¹é‡; MAPTASK å¹¶è¡Œåº¦å»ºè®®è®¾ç½® å¦‚æœç¡¬ä»¶é…ç½®ä¸º212core + 64Gï¼Œæ°å½“çš„mapå¹¶è¡Œåº¦æ˜¯å¤§çº¦æ¯ä¸ªèŠ‚ç‚¹20-100ä¸ªmapï¼Œ*æœ€å¥½æ¯ä¸ªmapçš„æ‰§è¡Œæ—¶é—´è‡³å°‘ä¸€åˆ†é’Ÿã€‚** å¦‚æœjobçš„æ¯ä¸ªmapæˆ–è€… reduce taskçš„è¿è¡Œæ—¶é—´éƒ½åªæœ‰30-40ç§’é’Ÿï¼Œé‚£ä¹ˆå°±å‡å°‘è¯¥jobçš„mapæˆ–è€…reduceæ•°ï¼Œæ¯ä¸€ä¸ªtask(map|reduce)çš„setupå’ŒåŠ å…¥åˆ°è°ƒåº¦å™¨ä¸­è¿›è¡Œè°ƒåº¦ï¼Œè¿™ä¸ªä¸­é—´çš„è¿‡ç¨‹å¯èƒ½éƒ½è¦èŠ±è´¹å‡ ç§’é’Ÿï¼Œæ‰€ä»¥å¦‚æœæ¯ä¸ªtaskéƒ½éå¸¸å¿«å°±è·‘å®Œäº†ï¼Œå°±ä¼šåœ¨taskçš„å¼€å§‹å’Œç»“æŸçš„æ—¶å€™æµªè´¹å¤ªå¤šçš„æ—¶é—´ã€‚ é…ç½®taskçš„JVMé‡ç”¨å¯ä»¥æ”¹å–„è¯¥é—®é¢˜ï¼šï¼ˆmapred.job.reuse.jvm.num.tasksï¼Œé»˜è®¤æ˜¯1ï¼Œè¡¨ç¤ºä¸€ä¸ªJVMä¸Šæœ€å¤šå¯ä»¥é¡ºåºæ‰§è¡Œçš„taskæ•°ç›®ï¼ˆå±äºåŒä¸€ä¸ªJobï¼‰æ˜¯1ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªtaskå¯ä¸€ä¸ªJVMï¼‰ å¦‚æœinputçš„æ–‡ä»¶éå¸¸çš„å¤§ï¼Œæ¯”å¦‚1TBï¼Œå¯ä»¥è€ƒè™‘å°†hdfsä¸Šçš„æ¯ä¸ªblock sizeè®¾å¤§ï¼Œæ¯”å¦‚è®¾æˆ256MBæˆ–è€…512MB ReduceTaskå¹¶è¡Œåº¦çš„å†³å®šReduceTask è®¾ç½®æ–¹å¼reducetaskçš„å¹¶è¡Œåº¦åŒæ ·å½±å“æ•´ä¸ªjobçš„æ‰§è¡Œå¹¶å‘åº¦å’Œæ‰§è¡Œæ•ˆç‡ï¼Œä½†ä¸maptaskçš„å¹¶å‘æ•°ç”±åˆ‡ç‰‡æ•°å†³å®šä¸åŒï¼ŒReducetaskæ•°é‡çš„å†³å®šæ˜¯å¯ä»¥ç›´æ¥æ‰‹åŠ¨è®¾ç½®ï¼š 12//é»˜è®¤å€¼æ˜¯1ï¼Œæ‰‹åŠ¨è®¾ç½®ä¸º4job.setNumReduceTasks(4); å¦‚æœæ•°æ®åˆ†å¸ƒä¸å‡åŒ€ï¼Œå°±æœ‰å¯èƒ½åœ¨reduceé˜¶æ®µäº§ç”Ÿæ•°æ®å€¾æ–œ æ³¨æ„ï¼š reducetaskæ•°é‡å¹¶ä¸æ˜¯ä»»æ„è®¾ç½®ï¼Œè¿˜è¦è€ƒè™‘ä¸šåŠ¡é€»è¾‘éœ€æ±‚ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œéœ€è¦è®¡ç®—å…¨å±€æ±‡æ€»ç»“æœï¼Œå°±åªèƒ½æœ‰1ä¸ªreducetaskï¼Œå°½é‡ä¸è¦è¿è¡Œå¤ªå¤šçš„reduce taskã€‚ å½“è®¾ç½®reduceTaskæ•°é‡ä¸º0çš„æ—¶å€™ï¼Œmapreduce ä¸ä¼šæ‰§è¡Œshuffleä»¥åŠåé¢çš„æ“ä½œï¼Œä¼šç›´æ¥å°†mapçš„ç»“æœè¾“å‡ºåˆ°outputPathç›®å½•ï¼Œæ­¤æ—¶æœ‰å¤šå°‘ä¸ªmapTaskå°±æœ‰å¤šå°‘ä¸ªæ–‡ä»¶ã€‚ å¦‚æœä¸è®¾ç½®reduceTaskæ•°é‡ï¼Œmapreduceå°†ä¼šé»˜è®¤å¯åŠ¨ä¸€ä¸ªreduceTaskï¼Œ ç”¨æ¥å°†æ‰€æœ‰mapçš„ç»“æœè¿›è¡Œæ•´ç†ï¼Œå¹¶è¾“å‡ºåˆ°ç»Ÿä¸€æ–‡ä»¶åˆ°è¾“å‡ºç›®å½•ã€‚ MAPREDUCE ç¼–ç¨‹è§„èŒƒç¼–å†™è§„èŒƒ ç”¨æˆ·ç¼–å†™çš„ç¨‹åºåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šMapperï¼ŒReducerï¼ŒDriver(æäº¤è¿è¡Œmrç¨‹åºçš„å®¢æˆ·ç«¯) Mapperçš„è¾“å…¥æ•°æ®æ˜¯KVå¯¹çš„å½¢å¼ï¼ˆKVçš„ç±»å‹å¯è‡ªå®šä¹‰ï¼‰ Mapperçš„è¾“å‡ºæ•°æ®æ˜¯KVå¯¹çš„å½¢å¼ï¼ˆKVçš„ç±»å‹å¯è‡ªå®šä¹‰ï¼‰ Mapperä¸­çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨map()æ–¹æ³•ä¸­ map()æ–¹æ³•ï¼ˆmaptaskè¿›ç¨‹ï¼‰å¯¹æ¯ä¸€ä¸ª&lt;K,V&gt;è°ƒç”¨ä¸€æ¬¡ Reducerçš„è¾“å…¥æ•°æ®ç±»å‹å¯¹åº”Mapperçš„è¾“å‡ºæ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯KV Reducerçš„ä¸šåŠ¡é€»è¾‘å†™åœ¨reduce()æ–¹æ³•ä¸­ Reducetaskè¿›ç¨‹å¯¹æ¯ä¸€ç»„ç›¸åŒkçš„&lt;k,v&gt;ç»„è°ƒç”¨ä¸€æ¬¡reduce()æ–¹æ³• ç”¨æˆ·è‡ªå®šä¹‰çš„Mapperå’ŒReduceréƒ½è¦ç»§æ‰¿å„è‡ªçš„çˆ¶ç±» æ•´ä¸ªç¨‹åºéœ€è¦ä¸€ä¸ªDrvieræ¥è¿›è¡Œæäº¤ï¼Œæäº¤çš„æ˜¯ä¸€ä¸ªæè¿°äº†å„ç§å¿…è¦ä¿¡æ¯çš„jobå¯¹è±¡ MAPREDUCEç¤ºä¾‹ éœ€æ±‚: åœ¨ä¸€å †ç»™å®šçš„æ–‡æœ¬æ–‡ä»¶ä¸­ç»Ÿè®¡è¾“å‡ºæ¯ä¸€ä¸ªå•è¯å‡ºç°çš„æ€»æ¬¡æ•° å®šä¹‰mapperç±» 1234567891011121314151617181920//é¦–å…ˆè¦å®šä¹‰å››ä¸ªæ³›å‹çš„ç±»å‹//keyin: LongWritable valuein: Text//keyout: Text valueout:IntWritablepublic class WordCountMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt;&#123; //mapæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸï¼š æ¡†æ¶æ¯ä¼ ä¸€è¡Œæ•°æ®å°±è¢«è°ƒç”¨ä¸€æ¬¡ //key : è¿™ä¸€è¡Œçš„èµ·å§‹ç‚¹åœ¨æ–‡ä»¶ä¸­çš„åç§»é‡ //value: è¿™ä¸€è¡Œçš„å†…å®¹ @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; //æ‹¿åˆ°ä¸€è¡Œæ•°æ®è½¬æ¢ä¸ºstring String line = value.toString(); //å°†è¿™ä¸€è¡Œåˆ‡åˆ†å‡ºå„ä¸ªå•è¯ String[] words = line.split(" "); //éå†æ•°ç»„ï¼Œè¾“å‡º&lt;å•è¯ï¼Œ1&gt; for(String word:words)&#123; context.write(new Text(word), new IntWritable(1)); &#125; &#125;&#125; å®šä¹‰reduceç±» 123456789101112//ç”Ÿå‘½å‘¨æœŸï¼šæ¡†æ¶æ¯ä¼ é€’è¿›æ¥ä¸€ä¸ªkv ç»„ï¼Œreduceæ–¹æ³•è¢«è°ƒç”¨ä¸€æ¬¡ @Override protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException &#123; //å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ int count = 0; //éå†è¿™ä¸€ç»„kvçš„æ‰€æœ‰vï¼Œç´¯åŠ åˆ°countä¸­ for(IntWritable value:values)&#123; count += value.get(); &#125; context.write(key, new IntWritable(count)); &#125;&#125; å®šä¹‰ä¸»ç±»ï¼Œæè¿°å¹¶æäº¤job 123456789101112131415161718192021222324252627public class WordCountRunner &#123; //æŠŠä¸šåŠ¡é€»è¾‘ç›¸å…³çš„ä¿¡æ¯ï¼ˆå“ªä¸ªæ˜¯mapperï¼Œå“ªä¸ªæ˜¯reducerï¼Œè¦å¤„ç†çš„æ•°æ®åœ¨å“ªé‡Œï¼Œè¾“å‡ºçš„ç»“æœæ”¾å“ªé‡Œâ€¦â€¦ï¼‰æè¿°æˆä¸€ä¸ªjobå¯¹è±¡ //æŠŠè¿™ä¸ªæè¿°å¥½çš„jobæäº¤ç»™é›†ç¾¤å»è¿è¡Œ public static void main(String[] args) throws Exception &#123; Configuration conf = new Configuration(); Job wcjob = Job.getInstance(conf); //æŒ‡å®šæˆ‘è¿™ä¸ªjobæ‰€åœ¨çš„jaråŒ…// wcjob.setJar("/home/hadoop/wordcount.jar"); wcjob.setJarByClass(WordCountRunner.class); wcjob.setMapperClass(WordCountMapper.class); wcjob.setReducerClass(WordCountReducer.class); //è®¾ç½®æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘Mapperç±»çš„è¾“å‡ºkeyå’Œvalueçš„æ•°æ®ç±»å‹ wcjob.setMapOutputKeyClass(Text.class); wcjob.setMapOutputValueClass(IntWritable.class); //è®¾ç½®æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘Reducerç±»çš„è¾“å‡ºkeyå’Œvalueçš„æ•°æ®ç±»å‹ wcjob.setOutputKeyClass(Text.class); wcjob.setOutputValueClass(IntWritable.class); //æŒ‡å®šè¦å¤„ç†çš„æ•°æ®æ‰€åœ¨çš„ä½ç½® FileInputFormat.setInputPaths(wcjob, "hdfs://hdp-server01:9000/wordcount/data/big.txt"); //æŒ‡å®šå¤„ç†å®Œæˆä¹‹åçš„ç»“æœæ‰€ä¿å­˜çš„ä½ç½® FileOutputFormat.setOutputPath(wcjob, new Path("hdfs://hdp-server01:9000/wordcount/output/")); //å‘yarné›†ç¾¤æäº¤è¿™ä¸ªjob boolean res = wcjob.waitForCompletion(true); System.exit(res?0:1); &#125; MAPREDUCE ä¹‹YARNæ¦‚è¿°Yarnæ˜¯ä¸€ä¸ªèµ„æºè°ƒåº¦å¹³å°ï¼Œè´Ÿè´£ä¸ºè¿ç®—ç¨‹åºæä¾›æœåŠ¡å™¨è¿ç®—èµ„æºï¼Œç›¸å½“äºä¸€ä¸ªåˆ†å¸ƒå¼çš„æ“ä½œç³»ç»Ÿå¹³å°ï¼Œè€Œmapreduceç­‰è¿ç®—ç¨‹åºåˆ™ç›¸å½“äºè¿è¡Œäºæ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„åº”ç”¨ç¨‹åº YARNçš„é‡è¦æ¦‚å¿µ yarnå¹¶ä¸æ¸…æ¥šç”¨æˆ·æäº¤çš„ç¨‹åºçš„è¿è¡Œæœºåˆ¶ yarnåªæä¾›è¿ç®—èµ„æºçš„è°ƒåº¦ï¼ˆç”¨æˆ·ç¨‹åºå‘yarnç”³è¯·èµ„æºï¼Œyarnå°±è´Ÿè´£åˆ†é…èµ„æºï¼‰ yarnä¸­çš„ä¸»ç®¡è§’è‰²å«ResourceManager yarnä¸­å…·ä½“æä¾›è¿ç®—èµ„æºçš„è§’è‰²å«NodeManager è¿™æ ·ä¸€æ¥ï¼Œyarnå…¶å®å°±ä¸è¿è¡Œçš„ç”¨æˆ·ç¨‹åºå®Œå…¨è§£è€¦ï¼Œå°±æ„å‘³ç€yarnä¸Šå¯ä»¥è¿è¡Œå„ç§ç±»å‹çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼ˆmapreduceåªæ˜¯å…¶ä¸­çš„ä¸€ç§ï¼‰ï¼Œæ¯”å¦‚mapreduceã€stormç¨‹åºï¼Œsparkç¨‹åºï¼Œtez â€¦â€¦ æ‰€ä»¥ï¼Œsparkã€stormç­‰è¿ç®—æ¡†æ¶éƒ½å¯ä»¥æ•´åˆåœ¨yarnä¸Šè¿è¡Œï¼Œåªè¦ä»–ä»¬å„è‡ªçš„æ¡†æ¶ä¸­æœ‰ç¬¦åˆyarnè§„èŒƒçš„èµ„æºè¯·æ±‚æœºåˆ¶å³å¯ Yarnå°±æˆä¸ºä¸€ä¸ªé€šç”¨çš„èµ„æºè°ƒåº¦å¹³å°ï¼Œä»æ­¤ï¼Œä¼ä¸šä¸­ä»¥å‰å­˜åœ¨çš„å„ç§è¿ç®—é›†ç¾¤éƒ½å¯ä»¥æ•´åˆåœ¨ä¸€ä¸ªç‰©ç†é›†ç¾¤ä¸Šï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ï¼Œæ–¹ä¾¿æ•°æ®å…±äº« MR YARNé›†ç¾¤è¿è¡Œæœºåˆ¶ MAPREDUCEç¨‹åºè¿è¡Œæœºåˆ¶æœ¬åœ°è¿è¡Œæ¨¡å¼ mapreduceç¨‹åºæ˜¯è¢«æäº¤ç»™LocalJobRunneråœ¨æœ¬åœ°ä»¥å•è¿›ç¨‹çš„å½¢å¼è¿è¡Œ è€Œå¤„ç†çš„æ•°æ®åŠè¾“å‡ºç»“æœå¯ä»¥åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥åœ¨hdfsä¸Š æ€æ ·å®ç°æœ¬åœ°è¿è¡Œï¼Ÿå†™ä¸€ä¸ªç¨‹åºï¼Œä¸è¦å¸¦é›†ç¾¤çš„é…ç½®æ–‡ä»¶ï¼ˆæœ¬è´¨æ˜¯ä½ çš„mrç¨‹åºçš„confä¸­æ˜¯å¦æœ‰mapreduce.framework.name=localä»¥åŠyarn.resourcemanager.hostnameå‚æ•°ï¼‰ æœ¬åœ°æ¨¡å¼éå¸¸ä¾¿äºè¿›è¡Œä¸šåŠ¡é€»è¾‘çš„debugï¼Œåªè¦åœ¨eclipseä¸­æ‰“æ–­ç‚¹å³å¯ å¦‚æœåœ¨windowsä¸‹æƒ³è¿è¡Œæœ¬åœ°æ¨¡å¼æ¥æµ‹è¯•ç¨‹åºé€»è¾‘ï¼Œéœ€è¦åœ¨windowsä¸­é…ç½®ç¯å¢ƒå˜é‡ï¼š ï¼…HADOOP_HOMEï¼… = d:/hadoop-2.6.1 %PATH% = ï¼…HADOOP_HOMEï¼…\bin å¹¶ä¸”è¦å°†d:/hadoop-2.6.1çš„libå’Œbinç›®å½•æ›¿æ¢æˆwindowså¹³å°ç¼–è¯‘çš„ç‰ˆæœ¬ é›†ç¾¤è¿è¡Œæ¨¡å¼ä»€ä¹ˆæ˜¯é›†ç¾¤æ¨¡å¼ å°†mapreduceç¨‹åºæäº¤ç»™yarné›†ç¾¤resourcemanagerï¼Œåˆ†å‘åˆ°å¾ˆå¤šçš„èŠ‚ç‚¹ä¸Šå¹¶å‘æ‰§è¡Œ å¤„ç†çš„æ•°æ®å’Œè¾“å‡ºç»“æœåº”è¯¥ä½äºhdfsæ–‡ä»¶ç³»ç»Ÿ æäº¤é›†ç¾¤çš„å®ç°æ­¥éª¤ å°†ç¨‹åºæ‰“æˆJARåŒ…ï¼Œç„¶ååœ¨é›†ç¾¤çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šç”¨hadoopå‘½ä»¤å¯åŠ¨ 1hadoop jar wordcount.jar cn.itcast.bigdata.mrsimple.WordCountDriver inputpath outputpath ç›´æ¥åœ¨linuxçš„eclipseä¸­è¿è¡Œmainæ–¹æ³• ï¼ˆé¡¹ç›®ä¸­è¦å¸¦å‚æ•°ï¼šmapreduce.framework.name=yarnä»¥åŠyarnçš„ä¸¤ä¸ªåŸºæœ¬é…ç½®ï¼‰ å¦‚æœè¦åœ¨windowsçš„eclipseä¸­æäº¤jobç»™é›†ç¾¤ï¼Œåˆ™è¦ä¿®æ”¹YarnRunnerç±» åœ¨windowså¹³å°ä¸Šè®¿é—®hadoopæ—¶, åº”è¯¥å¸¦ä¸Šå‚æ•° -DHADOOP_USER_NAME=hadoop MAPREDUCEè¿è¡ŒåŸç†MAPREDUCEè¿è¡ŒåŸç†å›¾ MAPREDUCEçš„shuffleæœºåˆ¶shuffleæœºåˆ¶æ¦‚è¿° mapreduceä¸­ï¼Œmapé˜¶æ®µå¤„ç†çš„æ•°æ®å¦‚ä½•ä¼ é€’ç»™reduceé˜¶æ®µï¼Œæ˜¯mapreduceæ¡†æ¶ä¸­æœ€å…³é”®çš„ä¸€ä¸ªæµç¨‹ï¼Œè¿™ä¸ªæµç¨‹å°±å«shuffle(å¦‚ä¸Šå›¾ç»¿è‰²æ¡†éƒ¨åˆ†)ï¼› shuffle: æ´—ç‰Œã€å‘ç‰Œ â€”â€”ï¼ˆæ ¸å¿ƒæœºåˆ¶ï¼šæ•°æ®åˆ†åŒºï¼Œæ’åºï¼Œç¼“å­˜ï¼‰ï¼› å…·ä½“æ¥è¯´ï¼šå°±æ˜¯å°†maptaskè¾“å‡ºçš„å¤„ç†ç»“æœæ•°æ®ï¼Œåˆ†å‘ç»™reducetaskï¼Œå¹¶åœ¨åˆ†å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®æŒ‰keyè¿›è¡Œäº†åˆ†åŒºã€åˆå¹¶å’Œæ’åºï¼› shuffleä¸»è¦æµç¨‹ shuffleæ˜¯MRå¤„ç†æµç¨‹ä¸­çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒçš„æ¯ä¸€ä¸ªå¤„ç†æ­¥éª¤æ˜¯åˆ†æ•£åœ¨å„ä¸ªmapTaskå’ŒreduceTaskå‡ ç‚¹ä¸Šå®Œæˆçš„ï¼Œä¸»è¦æœ‰3ä¸ªåŠ¨ä½œ: å°†ç»“æœåˆ†åŒº æ ¹æ®keyè¿›è¡Œæ’åº ä½¿ç”¨Combinerè¿›è¡Œå±€éƒ¨æ’åº åœ¨æ•´ä¸ªæµç¨‹ä¸­æœ‰å‡ ä¸ªå…³é”®çš„æ­¥éª¤: å¯¹ç¼“å†²åŒºè¾“å‡ºçš„ç»“æœè¿›è¡Œåˆ†åŒºå’Œæ’åºï¼Œ æ•°æ®çš„åˆ†åŒºå’Œæ’åºæœ€å¼€å§‹è¡Œç¨‹çš„ä½ç½® å¯¹ç¢ç‰‡æ•°æ®çš„åˆå¹¶ï¼ŒåŒ…å«ç¬¬ä¸€æ¬¡ä»ç¼“å†²åŒºç»è¿‡æ’åºåˆ†åŒºçš„ç»“æœï¼Œä»¥åŠæ¯ä¸ªtaskMapè¾“å‡ºçš„ç»“æœï¼Œå¹¶ä¸”éƒ½ä¼šç»è¿‡combineæ•´åˆ å¯¹ä¸åŒmapTaskçš„åˆ†åŒºç»“æœè¿›è¡Œæ•´åˆ shuffleçš„è¯¦ç»†æµç¨‹ maptaskæ”¶é›†æˆ‘ä»¬çš„map()æ–¹æ³•è¾“å‡ºçš„kvå¯¹ï¼Œæ”¾åˆ°å†…å­˜ç¼“å†²åŒºä¸­ ä»å†…å­˜ç¼“å†²åŒºä¸æ–­æº¢å‡ºæœ¬åœ°ç£ç›˜æ–‡ä»¶ï¼Œå¯èƒ½ä¼šæº¢å‡ºå¤šä¸ªæ–‡ä»¶ å¤šä¸ªæº¢å‡ºæ–‡ä»¶ä¼šè¢«åˆå¹¶æˆå¤§çš„æº¢å‡ºæ–‡ä»¶ åœ¨æº¢å‡ºè¿‡ç¨‹ä¸­ï¼ŒåŠåˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½è¦è°ƒç”¨partitonerè¿›è¡Œåˆ†ç»„å’Œé’ˆå¯¹keyè¿›è¡Œæ’åº reducetaskæ ¹æ®è‡ªå·±çš„åˆ†åŒºå·ï¼Œå»å„ä¸ªmaptaskæœºå™¨ä¸Šå–ç›¸åº”çš„ç»“æœåˆ†åŒºæ•°æ® reducetaskä¼šå–åˆ°åŒä¸€ä¸ªåˆ†åŒºçš„æ¥è‡ªä¸åŒmaptaskçš„ç»“æœæ–‡ä»¶ï¼Œreducetaskä¼šå°†è¿™äº›æ–‡ä»¶å†è¿›è¡Œåˆå¹¶ï¼ˆå½’å¹¶æ’åºï¼‰ åˆå¹¶æˆå¤§æ–‡ä»¶åï¼Œshuffleçš„è¿‡ç¨‹ä¹Ÿå°±ç»“æŸäº†ï¼Œåé¢è¿›å…¥reducetaskçš„é€»è¾‘è¿ç®—è¿‡ç¨‹ï¼ˆä»æ–‡ä»¶ä¸­å–å‡ºä¸€ä¸ªä¸€ä¸ªçš„é”®å€¼å¯¹groupï¼Œè°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„reduce()æ–¹æ³•ï¼‰ Shuffleä¸­çš„ç¼“å†²åŒºå¤§å°ä¼šå½±å“åˆ°mapreduceç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼ŒåŸåˆ™ä¸Šè¯´ï¼Œç¼“å†²åŒºè¶Šå¤§ï¼Œç£ç›˜ioçš„æ¬¡æ•°è¶Šå°‘ï¼Œæ‰§è¡Œé€Ÿåº¦å°±è¶Šå¿« ç¼“å†²åŒºçš„å¤§å°å¯ä»¥é€šè¿‡å‚æ•°è°ƒæ•´, å‚æ•°ï¼šio.sort.mb é»˜è®¤100M MAPREDUCE å„ç§ç±»Mapç±»å’ŒReduceç±»ä½œç”¨ MRä¸»è¦çš„å·¥ä½œæœºåˆ¶å°±æ˜¯é€šè¿‡mapå¯¹æ•°æ®è¡Œè¿›è¡Œé€’å½’çš„æ“ä½œï¼Œ é€šè¿‡reduceå¯¹å¤„ç†çš„ç»“æœè¿›è¡Œæ±‡æ€»æ“ä½œ å…·ä½“å®ç°æ­¥éª¤ï¼š è‡ªå®šä¹‰Map å’Œ Reduceç±» å¹¶å®ç°mapå’Œreduceæ–¹æ³•ï¼› åœ¨jobå®ä¾‹ä¸­ï¼Œå¼•ç”¨Mapå’ŒReduceçš„ç±»: job.setJarByClass(FlowCount.class);job.setMapperClass(FlowCountMapper.class);job.setReducerClass(FlowCountReducer.class); Mapç±»ç¤ºä¾‹ 12345678910111213141516171819202122232425262728public class WordcountMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt;&#123; HashMap&lt;String,String&gt; cache = new HashMap&lt;String, String&gt;(); // æ˜¯åœ¨mapä»»åŠ¡åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ï¼Œç„¶åå†å¯¹æ–‡æœ¬çš„æ¯ä¸€è¡Œè¿›è¡Œmapæ“ä½œ @Override protected void setup(Context context) &#123; cache.put("some_key", "some_value") &#125; /** * mapé˜¶æ®µçš„ä¸šåŠ¡é€»è¾‘å°±å†™åœ¨è‡ªå®šä¹‰çš„map()æ–¹æ³•ä¸­ * maptaskä¼šå¯¹æ¯ä¸€è¡Œè¾“å…¥æ•°æ®è°ƒç”¨ä¸€æ¬¡æˆ‘ä»¬è‡ªå®šä¹‰çš„map()æ–¹æ³• */ @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; //å°†maptaskä¼ ç»™æˆ‘ä»¬çš„æ–‡æœ¬å†…å®¹å…ˆè½¬æ¢æˆString String line = value.toString(); //æ ¹æ®ç©ºæ ¼å°†è¿™ä¸€è¡Œåˆ‡åˆ†æˆå•è¯ String[] words = line.split(" "); //å°†å•è¯è¾“å‡ºä¸º&lt;å•è¯ï¼Œ1&gt; for(String word:words)&#123; //å°†å•è¯ä½œä¸ºkeyï¼Œå°†æ¬¡æ•°1ä½œä¸ºvalueï¼Œä»¥ä¾¿äºåç»­çš„æ•°æ®åˆ†å‘ï¼Œå¯ä»¥æ ¹æ®å•è¯åˆ†å‘ï¼Œä»¥ä¾¿äºç›¸åŒå•è¯ä¼šåˆ°ç›¸åŒçš„reduce task context.write(new Text(word), new IntWritable(1)); &#125; &#125;&#125; Reduceç±»ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930public class WordcountReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt;&#123; HashMap&lt;String,String&gt; cache = new HashMap&lt;String, String&gt;(); // æ˜¯åœ¨mapä»»åŠ¡åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ï¼Œç„¶åå†å¯¹æ–‡æœ¬çš„æ¯ä¸€è¡Œè¿›è¡Œmapæ“ä½œ @Override protected void setup(Context context) &#123; cache.put("some_key", "some_value") &#125; /** * &lt;angelababy,1&gt;&lt;angelababy,1&gt;&lt;angelababy,1&gt;&lt;angelababy,1&gt;&lt;angelababy,1&gt; * &lt;hello,1&gt;&lt;hello,1&gt;&lt;hello,1&gt;&lt;hello,1&gt;&lt;hello,1&gt;&lt;hello,1&gt; * &lt;banana,1&gt;&lt;banana,1&gt;&lt;banana,1&gt;&lt;banana,1&gt;&lt;banana,1&gt;&lt;banana,1&gt; * å…¥å‚keyï¼Œæ˜¯ä¸€ç»„ç›¸åŒå•è¯kvå¯¹çš„key */ @Override protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException &#123; int count=0; /*Iterator&lt;IntWritable&gt; iterator = values.iterator(); while(iterator.hasNext())&#123; count += iterator.next().get(); &#125;*/ for(IntWritable value:values)&#123; count += value.get(); &#125; context.write(key, new IntWritable(count)); &#125;&#125; Beanç±»ä½œç”¨ Javaçš„åºåˆ—åŒ–æ˜¯ä¸€ä¸ªé‡é‡çº§åºåˆ—åŒ–æ¡†æ¶ï¼ˆSerializableï¼‰ï¼Œä¸€ä¸ªå¯¹è±¡è¢«åºåˆ—åŒ–åï¼Œä¼šé™„å¸¦å¾ˆå¤šé¢å¤–çš„ä¿¡æ¯ï¼ˆå„ç§æ ¡éªŒä¿¡æ¯ï¼Œheaderï¼Œç»§æ‰¿ä½“ç³»ã€‚ã€‚ã€‚ã€‚ï¼‰ï¼Œä¸ä¾¿äºåœ¨ç½‘ç»œä¸­é«˜æ•ˆä¼ è¾“ï¼› hadoopè‡ªå·±å¼€å‘äº†ä¸€å¥—åºåˆ—åŒ–æœºåˆ¶ï¼ˆWritableï¼‰ï¼Œç²¾ç®€ï¼Œé«˜æ•ˆï¼Œç”¨æ¥è¿›è¡Œé«˜æ•ˆæ–¹ä¾¿çš„ä¼ è¾“ MAPREDUCEå°±å¯ä»¥å€ŸåŠ©hadoopå†…ç½®çš„æˆ–è€…è‡ªå®šä¹‰çš„Beanå¯¹è±¡(ç»§æ‰¿Writable)ï¼Œ æ¥ä½œä¸ºmapTaskå’ŒreduceTaskçš„è¾“å…¥è¾“å‡ºå¯¹è±¡ å¦‚æœéœ€è¦å°†è‡ªå®šä¹‰çš„beanæ”¾åœ¨keyä¸­ä¼ è¾“(å½“éœ€è¦å¯¹keyè¿›è¡Œæ’åºçš„æ—¶å€™)ï¼Œåˆ™è¿˜éœ€è¦å®ç°comparableæ¥å£ï¼Œå› ä¸ºmapreduceæ¡†ä¸­çš„shuffleè¿‡ç¨‹ä¸€å®šä¼šå¯¹keyè¿›è¡Œæ’åºï¼› å…·ä½“å®ç°æ­¥éª¤ï¼š è‡ªå®šä¹‰Writableæ¥å£ï¼Œå¹¶é‡å†™readFieldsã€writeã€toStringç­‰æ–¹æ³• åœ¨map å’Œ reduceæ–¹æ³•ä¸­ï¼Œè¾“å‡ºå’Œæ¥å—è‡ªå®šä¹‰çš„Beanï¼› åœ¨jobå®ä¾‹ä¸­ï¼ŒæŒ‡å®škeyclasså’Œvalueclass: job.setMapOutputKeyClass(Text.class);job.setMapOutputValueClass(FlowBean.class);job.setOutputKeyClass(Text.class);job.setOutputValueClass(FlowBean.class); Writableæ¥å£æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637/*** ååºåˆ—åŒ–çš„æ–¹æ³•ï¼Œååºåˆ—åŒ–æ—¶ï¼Œä»æµä¸­è¯»å–åˆ°çš„å„ä¸ªå­—æ®µçš„é¡ºåºåº”è¯¥ä¸åºåˆ—åŒ–æ—¶å†™å‡ºå»çš„é¡ºåºä¿æŒä¸€è‡´*/@Overridepublic void readFields(DataInput in) throws IOException &#123; upflow = in.readLong(); dflow = in.readLong(); sumflow = in.readLong();&#125;/*** ä¼ è¾“è¿‡ç¨‹ä¸­çš„åºåˆ—åŒ–çš„æ–¹æ³•*/@Overridepublic void write(DataOutput out) throws IOException &#123; out.writeLong(upflow); out.writeLong(dflow); //å¯ä»¥è€ƒè™‘ä¸åºåˆ—åŒ–æ€»æµé‡ï¼Œå› ä¸ºæ€»æµé‡æ˜¯å¯ä»¥é€šè¿‡ä¸Šè¡Œæµé‡å’Œä¸‹è¡Œæµé‡è®¡ç®—å‡ºæ¥çš„ out.writeLong(sumflow);&#125;/*** shuffleè¿‡ç¨‹ä¸­å¯¹keyè¿›è¡Œæ’åºçš„è§„åˆ™*/@Overridepublic int compareTo(FlowBean o) &#123; //å®ç°æŒ‰ç…§sumflowçš„å¤§å°å€’åºæ’åº return sumflow&gt;o.getSumflow()?-1:1;&#125;/*** æœ€ç»ˆreduceå°†beanè¾“å‡ºåˆ°æ–‡æœ¬çš„æ—¶å€™ï¼Œæ˜¾ç¤ºçš„å†…å®¹*/@Overridepublic String toString() &#123; return upFlow + "\t" + dFlow + "\t" + sumFlow;&#125; Partitionerç±»ä½œç”¨ Mapreduceä¸­ä¼šå°†mapè¾“å‡ºçš„kvå¯¹ï¼ŒæŒ‰ç…§ç›¸åŒkeyåˆ†ç»„ï¼Œå°†æ•°æ®åˆ†ä¸ºä¸åŒçš„åˆ†åŒº, ç„¶ååˆ†å‘ç»™ä¸åŒçš„reducetask é»˜è®¤çš„åˆ†å‘è§„åˆ™ä¸ºï¼šæ ¹æ®keyçš„ hashcode%reducetask æ•°æ¥åˆ†å‘ æ‰€ä»¥, å¦‚æœè¦æŒ‰ç…§æˆ‘ä»¬è‡ªå·±çš„éœ€æ±‚è¿›è¡Œåˆ†ç»„ï¼Œåˆ™éœ€è¦æ”¹å†™æ•°æ®åˆ†å‘ï¼ˆåˆ†ç»„ï¼‰ç»„ä»¶Partitioner å…·ä½“å®ç°æ­¥éª¤ï¼š è‡ªå®šä¹‰ä¸€ä¸ªCustomPartitionerç»§æ‰¿æŠ½è±¡ç±»ï¼šPartitioner ç„¶ååœ¨jobå¯¹è±¡ä¸­ï¼Œè®¾ç½®è‡ªå®šä¹‰partitionerï¼š job.setPartitionerClass(CustomPartitioner.class) ç¤ºä¾‹ 1234567891011121314151617181920212223242526/** * å®šä¹‰è‡ªå·±çš„ä»mapåˆ°reduceä¹‹é—´çš„æ•°æ®ï¼ˆåˆ†ç»„ï¼‰åˆ†å‘è§„åˆ™ æŒ‰ç…§æ‰‹æœºå·æ‰€å±çš„çœä»½æ¥åˆ†å‘ï¼ˆåˆ†ç»„ï¼‰ProvincePartitioner * é»˜è®¤çš„åˆ†ç»„ç»„ä»¶æ˜¯HashPartitioner * * @author * */public class ProvincePartitioner extends Partitioner&lt;Text, FlowBean&gt; &#123; static HashMap&lt;String, Integer&gt; provinceMap = new HashMap&lt;String, Integer&gt;(); static &#123; provinceMap.put("135", 0); provinceMap.put("136", 1); provinceMap.put("137", 2); provinceMap.put("138", 3); provinceMap.put("139", 4); &#125; @Override public int getPartition(Text key, FlowBean value, int numPartitions) &#123; Integer code = provinceMap.get(key.toString().substring(0, 3)); return code == null ? 5 : code; &#125;&#125; Combineç±»ä½œç”¨ combineræ˜¯MRç¨‹åºä¸­Mapperå’ŒReducerä¹‹å¤–çš„ä¸€ç§ç»„ä»¶, combinerç»„ä»¶çš„çˆ¶ç±»å°±æ˜¯Reducer combinerå’Œreducerçš„åŒºåˆ«åœ¨äºè¿è¡Œçš„ä½ç½®ï¼šCombineræ˜¯åœ¨æ¯ä¸€ä¸ªmaptaskæ‰€åœ¨çš„èŠ‚ç‚¹è¿è¡Œ, Reduceræ˜¯æ¥æ”¶å…¨å±€æ‰€æœ‰Mapperçš„ è¾“å‡ºç»“æœï¼› combinerçš„æ„ä¹‰å°±æ˜¯å¯¹æ¯ä¸€ä¸ªmaptaskçš„è¾“å‡ºè¿›è¡Œå±€éƒ¨æ±‡æ€»ï¼Œä»¥å‡å°ç½‘ç»œä¼ è¾“é‡ å…·ä½“å®ç°æ­¥éª¤ï¼š è‡ªå®šä¹‰ä¸€ä¸ªcombinerç»§æ‰¿Reducerï¼Œé‡å†™reduceæ–¹æ³• åœ¨jobä¸­è®¾ç½®ï¼š job.setCombinerClass(CustomCombiner.class) combinerèƒ½å¤Ÿåº”ç”¨çš„å‰ææ˜¯ä¸èƒ½å½±å“æœ€ç»ˆçš„ä¸šåŠ¡é€»è¾‘ã€‚ è€Œä¸”ï¼Œcombinerçš„è¾“å‡ºkvåº”è¯¥è·Ÿreducerçš„è¾“å…¥kvç±»å‹è¦å¯¹åº”èµ·æ¥ ç¤ºä¾‹ 1234567891011121314/** * å¯¹è±¡åŒkeyçš„valueè¿›è¡Œç´¯åŠ åˆå¹¶ */public class WordcountCombiner extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt;&#123; @Override protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException &#123; int count=0; for(IntWritable v: values)&#123; count += v.get(); &#125; context.write(key, new IntWritable(count)); &#125;&#125; ä¸»ç±»(jobå¯¹è±¡)ä½œç”¨ æ˜¯ä¸YARNé›†ç¾¤é€šè®¯çš„å®¢æˆ·ç«¯ï¼› ç”¨æ¥æŒ‡å®šMRçš„Mapï¼ŒReduceç±»ç­‰ä¿¡æ¯(å¦‚Mapã€Reduceã€Partitionerã€Combiner)ï¼Œå¹¶è®¾ç½®å¯åŠ¨å‚æ•°ç­‰ï¼› å¹¶å¯åŠ¨å®¢æˆ·ç«¯æ¥ä¸YARNé€šè®¯ï¼Œå¹¶æäº¤jaråŒ…ç­‰æ–‡ä»¶ï¼Œè¯·æ±‚å¯åŠ¨taskç­‰ï¼› ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class FlowCount &#123; public static void main(String[] args) throws Exception &#123; Configuration conf = new Configuration(); /*conf.set("mapreduce.framework.name", "yarn"); conf.set("yarn.resoucemanager.hostname", "mini1");*/ Job job = Job.getInstance(conf); /*job.setJar("/home/hadoop/wc.jar");*/ //æŒ‡å®šæœ¬ç¨‹åºçš„jaråŒ…æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„ job.setJarByClass(FlowCount.class); //æŒ‡å®šæœ¬ä¸šåŠ¡jobè¦ä½¿ç”¨çš„mapper/Reducerä¸šåŠ¡ç±» job.setMapperClass(FlowCountMapper.class); job.setReducerClass(FlowCountReducer.class); //æŒ‡å®šæˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®åˆ†åŒºå™¨ job.setPartitionerClass(ProvincePartitioner.class); //åŒæ—¶æŒ‡å®šç›¸åº”â€œåˆ†åŒºâ€æ•°é‡çš„reducetask job.setNumReduceTasks(5); //æŒ‡å®šmapperè¾“å‡ºæ•°æ®çš„kvç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(FlowBean.class); //æŒ‡å®šæœ€ç»ˆè¾“å‡ºçš„æ•°æ®çš„kvç±»å‹ job.setOutputKeyClass(Text.class); job.setOutputValueClass(FlowBean.class); //æŒ‡å®šjobçš„è¾“å…¥åŸå§‹æ–‡ä»¶æ‰€åœ¨ç›®å½• FileInputFormat.setInputPaths(job, new Path(args[0])); //æŒ‡å®šjobçš„è¾“å‡ºç»“æœæ‰€åœ¨ç›®å½• FileOutputFormat.setOutputPath(job, new Path(args[1])); // æŒ‡å®šéœ€è¦ç¼“å­˜ä¸€ä¸ªæ–‡ä»¶åˆ°æ‰€æœ‰çš„maptaskè¿è¡ŒèŠ‚ç‚¹å·¥ä½œç›®å½• /* job.addArchiveToClassPath(archive); */// ç¼“å­˜jaråŒ…åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„classpathä¸­ /* job.addFileToClassPath(file); */// ç¼“å­˜æ™®é€šæ–‡ä»¶åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„classpathä¸­ /* job.addCacheArchive(uri); */// ç¼“å­˜å‹ç¼©åŒ…æ–‡ä»¶åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„å·¥ä½œç›®å½• /* job.addCacheFile(uri) */// ç¼“å­˜æ™®é€šæ–‡ä»¶åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„å·¥ä½œç›®å½• // å°†äº§å“è¡¨æ–‡ä»¶ç¼“å­˜åˆ°taskå·¥ä½œèŠ‚ç‚¹çš„å·¥ä½œç›®å½•ä¸­å», åœ¨mapå’Œreduceè¿è¡Œé˜¶æ®µå¯ä»¥ç›´æ¥ä»å·¥ä½œç›®å½•é‡Œè¯»å–è¯¥æ–‡ä»¶ // åœ¨Mapperæˆ–è€…Reducerä¸­å¯ä»¥ä½¿ç”¨context.getLocalCacheFiles() è·å–ç¼“å­˜æ–‡ä»¶,æˆ–è€…ç›´æ¥ä»å·¥ä½œç›®å½•è·å– job.addCacheFile(new URI("file:/D:/srcdata/mapjoincache/pdts.txt")); //å°†jobä¸­é…ç½®çš„ç›¸å…³å‚æ•°ï¼Œä»¥åŠjobæ‰€ç”¨çš„javaç±»æ‰€åœ¨çš„jaråŒ…ï¼Œæäº¤ç»™yarnå»è¿è¡Œ /*job.submit();*/ boolean res = job.waitForCompletion(true); System.exit(res?0:1); &#125;&#125; GroupingComparator ç±»ä½œç”¨ map è¾“å‡ºçš„K, V å¦‚æœKæ˜¯è‡ªå®šä¹‰Beanå¯¹è±¡ï¼Œé‚£ä¹ˆMAPREDUCEä¸èƒ½è¯†åˆ«ç›¸åŒçš„Kçš„K,V ä¸ºä¸€ç»„ è¿™æ—¶ï¼Œå¦‚æœæƒ³è¦è®©ç›¸åŒçš„è‡ªå®šä¹‰Kä½œä¸ºä¸€ç»„è¾“å…¥åˆ°reduceæ–¹æ³•ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªGroupingComparatorç±»ï¼Œæ¥æŒ‡å®šå¯¹è‡ªå®šä¹‰å¯¹è±¡åˆ†ç»„çš„ä¾æ® åŸç†æ˜¯K,Vå¯¹åœ¨ä¼ é€’ç»™REDUCEæ–¹æ³•çš„æ—¶å€™ï¼Œreduceä¼šå…ˆåˆ¤æ–­ä¸‹ä¸€ä¸ªKæ˜¯å¦ä¸å½“å‰Kç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œç»§ç»­å‘ä¸‹åˆ¤æ–­ï¼Œç›´åˆ°è·å¾— ä½¿ç”¨ç¤ºä¾‹ 1234567891011121314151617181920/* * åˆ©ç”¨reduceç«¯çš„GroupingComparatoræ¥å®ç°å°†ä¸€ç»„beançœ‹æˆç›¸åŒçš„key*/public class ItemidGroupingComparator extends WritableComparator &#123; //ä¼ å…¥ä½œä¸ºkeyçš„beançš„classç±»å‹ï¼Œä»¥åŠåˆ¶å®šéœ€è¦è®©æ¡†æ¶åšåå°„è·å–å®ä¾‹å¯¹è±¡ protected ItemidGroupingComparator() &#123; super(OrderBean.class, true); &#125; // é€šè¿‡compareæ–¹æ³•æ¥åˆ¤æ–­keyæ˜¯å¦å±äºä¸€ç»„ @Override public int compare(WritableComparable a, WritableComparable b) &#123; OrderBean abean = (OrderBean) a; OrderBean bbean = (OrderBean) b; //æ¯”è¾ƒä¸¤ä¸ªbeanæ—¶ï¼ŒæŒ‡å®šåªæ¯”è¾ƒbeanä¸­çš„orderid return abean.getItemid().compareTo(bbean.getItemid()); &#125;&#125;// åœ¨ä¸»ç±»ä¸­è®¾ç½®GroupingComparatorClass//job.setGroupingComparatorClass(ItemidGroupingComparator.class); OutputFormatç±»ä½œç”¨MapReduce åªä¸€å…±äº†ä¸€äº›æ ‡å‡†çš„OutputFormatï¼Œè¿™æ ·å½“æˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰Reduceç»“æœçš„ä¿å­˜æ–¹å¼ï¼Œå’Œä¿å­˜ä½ç½®æ—¶ï¼Œæ ‡å‡†çš„OutputFormatå°±ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼› æ¯”å¦‚æˆ‘ä»¬æƒ³è¦åœ¨è¿è¥å•†çš„æµé‡æ—¥å¿—ä¸­ï¼Œå¢åŠ ä¸€åˆ—æ ‡è®°ä¸ºè®¿é—®ç›®æ ‡ç½‘ç«™çš„ç±»å‹ï¼ˆä¾èµ–å·²ç»å­˜åœ¨çš„ç½‘ç«™åˆ†ç±»æ•°æ®åº“è¡¨ï¼‰, å¹¶ä¸”æŠŠåˆ†ç±»æˆåŠŸç»Ÿè®¡åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ†ç±»å¤±è´¥çš„ç»Ÿè®¡åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼› è¿™æ—¶å€™åŸå§‹çš„OutputFormatå°±ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œå› ä¸ºå®ƒåªèƒ½æ ¹æ®åˆ†åŒºç»“æœå»ç”Ÿæˆæ–‡ä»¶ï¼Œ å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨è‡ªå®šä¹‰OutputFormatè§£å†³ï¼› ç¤ºä¾‹éœ€æ±‚ 1ã€ ä»åŸå§‹æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–æ•°æ® 2ã€ æ ¹æ®æ—¥å¿—ä¸­çš„ä¸€ä¸ªURLå­—æ®µåˆ°å¤–éƒ¨çŸ¥è¯†åº“ä¸­è·å–ä¿¡æ¯å¢å¼ºåˆ°åŸå§‹æ—¥å¿— 3ã€ å¦‚æœæˆåŠŸå¢å¼ºï¼Œåˆ™è¾“å‡ºåˆ°å¢å¼ºç»“æœç›®å½•ï¼›å¦‚æœå¢å¼ºå¤±è´¥ï¼Œåˆ™æŠ½å–åŸå§‹æ•°æ®ä¸­URLå­—æ®µè¾“å‡ºåˆ°å¾…çˆ¬æ¸…å•ç›®å½• åˆ†æ ç¨‹åºçš„å…³é”®ç‚¹æ˜¯è¦åœ¨ä¸€ä¸ªmapreduceç¨‹åºä¸­æ ¹æ®æ•°æ®çš„ä¸åŒè¾“å‡ºä¸¤ç±»ç»“æœåˆ°ä¸åŒç›®å½•ï¼Œè¿™ç±»çµæ´»çš„è¾“å‡ºéœ€æ±‚å¯ä»¥é€šè¿‡è‡ªå®šä¹‰outputformatæ¥å®ç° å®ç° åœ¨mapreduceä¸­è®¿é—®å¤–éƒ¨èµ„æº è‡ªå®šä¹‰outputformatï¼Œæ”¹å†™å…¶ä¸­çš„recordwriterï¼Œæ”¹å†™å…·ä½“è¾“å‡ºæ•°æ®çš„æ–¹æ³•write() OutputFormatç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657public class LogEnhancerOutputFormat extends FileOutputFormat&lt;Text, NullWritable&gt;&#123; @Override public RecordWriter&lt;Text, NullWritable&gt; getRecordWriter(TaskAttemptContext context) throws IOException, InterruptedException &#123; FileSystem fs = FileSystem.get(context.getConfiguration()); Path enhancePath = new Path("hdfs://hdp-node01:9000/flow/enhancelog/enhanced.log"); Path toCrawlPath = new Path("hdfs://hdp-node01:9000/flow/tocrawl/tocrawl.log"); FSDataOutputStream enhanceOut = fs.create(enhancePath); FSDataOutputStream toCrawlOut = fs.create(toCrawlPath); return new MyRecordWriter(enhanceOut,toCrawlOut); &#125; static class MyRecordWriter extends RecordWriter&lt;Text, NullWritable&gt;&#123; FSDataOutputStream enhanceOut = null; FSDataOutputStream toCrawlOut = null; public MyRecordWriter(FSDataOutputStream enhanceOut, FSDataOutputStream toCrawlOut) &#123; super(); this.enhanceOut = enhanceOut; this.toCrawlOut = toCrawlOut; &#125; @Override public void write(Text key, NullWritable value) throws IOException, InterruptedException &#123; //æœ‰äº†æ•°æ®ï¼Œä½ æ¥è´Ÿè´£å†™åˆ°ç›®çš„åœ° â€”â€” hdfs //åˆ¤æ–­ï¼Œè¿›æ¥å†…å®¹å¦‚æœæ˜¯å¸¦tocrawlçš„ï¼Œå°±å¾€å¾…çˆ¬æ¸…å•è¾“å‡ºæµä¸­å†™ toCrawlOut if(key.toString().contains("tocrawl"))&#123; toCrawlOut.write(key.toString().getBytes()); &#125;else&#123; enhanceOut.write(key.toString().getBytes()); &#125; &#125; @Override public void close(TaskAttemptContext context) throws IOException, InterruptedException &#123; if(toCrawlOut!=null)&#123; toCrawlOut.close(); &#125; if(enhanceOut!=null)&#123; enhanceOut.close(); &#125; &#125; &#125;&#125;// è¦å°†è‡ªå®šä¹‰çš„è¾“å‡ºæ ¼å¼ç»„ä»¶è®¾ç½®åˆ°jobä¸­//job.setOutputFormatClass(LogEnhancerOutputFormat.class); IutputFormatç±»ä½œç”¨æ›´æ”¹æ–‡ä»¶çš„è¯»å–æ–¹å¼ï¼Œæˆ–è€…å¯¹è¯»å–çš„å†…å®¹æå‰åšä¸€äº›å¤„ç†ç­‰ ç¤ºä¾‹éœ€æ±‚ æ— è®ºhdfsè¿˜æ˜¯mapreduceï¼Œå¯¹äºå°æ–‡ä»¶éƒ½æœ‰æŸæ•ˆç‡ï¼Œå®è·µä¸­ï¼Œåˆéš¾å…é¢ä¸´å¤„ç†å¤§é‡å°æ–‡ä»¶çš„åœºæ™¯ï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦æœ‰ç›¸åº”è§£å†³æ–¹æ¡ˆ åˆ†æ 1ã€ åœ¨æ•°æ®é‡‡é›†çš„æ—¶å€™ï¼Œå°±å°†å°æ–‡ä»¶æˆ–å°æ‰¹æ•°æ®åˆæˆå¤§æ–‡ä»¶å†ä¸Šä¼ HDFS 2ã€ åœ¨ä¸šåŠ¡å¤„ç†ä¹‹å‰ï¼Œåœ¨HDFSä¸Šä½¿ç”¨mapreduceç¨‹åºå¯¹å°æ–‡ä»¶è¿›è¡Œåˆå¹¶ 3ã€ åœ¨mapreduceå¤„ç†æ—¶ï¼Œå¯é‡‡ç”¨combineInputFormatæé«˜æ•ˆç‡ å®ç° å®ç°çš„æ˜¯ä¸Šè¿°ç¬¬äºŒç§æ–¹å¼ ç¨‹åºçš„æ ¸å¿ƒæœºåˆ¶ï¼š è‡ªå®šä¹‰ä¸€ä¸ªInputFormat æ”¹å†™RecordReaderï¼Œå®ç°ä¸€æ¬¡è¯»å–ä¸€ä¸ªå®Œæ•´æ–‡ä»¶å°è£…ä¸ºKV å†è¾“å‡ºæ—¶ä½¿ç”¨SequenceFileOutPutFormatè¾“å‡ºåˆå¹¶æ–‡ä»¶ IutputFormatç±» 1234567891011121314151617public class WholeFileInputFormat extends FileInputFormat&lt;NullWritable, BytesWritable&gt; &#123; //è®¾ç½®æ¯ä¸ªå°æ–‡ä»¶ä¸å¯åˆ†ç‰‡,ä¿è¯ä¸€ä¸ªå°æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªkey-valueé”®å€¼å¯¹ @Override protected boolean isSplitable(JobContext context, Path file) &#123; return false; &#125; @Override public RecordReader&lt;NullWritable, BytesWritable&gt; createRecordReader( InputSplit split, TaskAttemptContext context) throws IOException, InterruptedException &#123; WholeFileRecordReader reader = new WholeFileRecordReader(); reader.initialize(split, context); return reader; &#125;&#125; RecordReaderç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354class WholeFileRecordReader extends RecordReader&lt;NullWritable, BytesWritable&gt; &#123; private FileSplit fileSplit; private Configuration conf; private BytesWritable value = new BytesWritable(); private boolean processed = false; @Override public void initialize(InputSplit split, TaskAttemptContext context) throws IOException, InterruptedException &#123; this.fileSplit = (FileSplit) split; this.conf = context.getConfiguration(); &#125; @Override public boolean nextKeyValue() throws IOException, InterruptedException &#123; if (!processed) &#123; byte[] contents = new byte[(int) fileSplit.getLength()]; Path file = fileSplit.getPath(); FileSystem fs = file.getFileSystem(conf); FSDataInputStream in = null; try &#123; in = fs.open(file); IOUtils.readFully(in, contents, 0, contents.length); value.set(contents, 0, contents.length); &#125; finally &#123; IOUtils.closeStream(in); &#125; processed = true; return true; &#125; return false; &#125; @Override public NullWritable getCurrentKey() throws IOException, InterruptedException &#123; return NullWritable.get(); &#125; @Override public BytesWritable getCurrentValue() throws IOException, InterruptedException &#123; return value; &#125; @Override public float getProgress() throws IOException &#123; return processed ? 1.0f : 0.0f; &#125; @Override public void close() throws IOException &#123; // do nothing &#125;&#125; mapreduceå¤„ç†æµç¨‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public class SmallFilesToSequenceFileConverter extends Configured implements Tool &#123; static class SequenceFileMapper extends Mapper&lt;NullWritable, BytesWritable, Text, BytesWritable&gt; &#123; private Text filenameKey; @Override protected void setup(Context context) throws IOException, InterruptedException &#123; InputSplit split = context.getInputSplit(); Path path = ((FileSplit) split).getPath(); filenameKey = new Text(path.toString()); &#125; @Override protected void map(NullWritable key, BytesWritable value, Context context) throws IOException, InterruptedException &#123; context.write(filenameKey, value); &#125; &#125; @Override public int run(String[] args) throws Exception &#123; Configuration conf = new Configuration(); /*System.setProperty("HADOOP_USER_NAME", "hadoop");*/ String[] otherArgs = new GenericOptionsParser(conf, args) .getRemainingArgs(); if (otherArgs.length != 2) &#123; System.err.println("Usage: combinefiles &lt;in&gt; &lt;out&gt;"); System.exit(2); &#125; Job job = Job.getInstance(conf,"combine small files to sequencefile"); job.setJarByClass(SmallFilesToSequenceFileConverter.class); job.setInputFormatClass(WholeFileInputFormat.class); job.setOutputFormatClass(SequenceFileOutputFormat.class); job.setOutputKeyClass(Text.class); job.setOutputValueClass(BytesWritable.class); job.setMapperClass(SequenceFileMapper.class); FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); return job.waitForCompletion(true) ? 0 : 1; &#125; public static void main(String[] args) throws Exception &#123; args=new String[]&#123;"c:/wordcount/smallinput","c:/wordcount/smallout"&#125;; int exitCode = ToolRunner.run(new SmallFilesToSequenceFileConverter(), args); System.exit(exitCode); &#125;&#125; è®¡æ•°å™¨ä½œç”¨ åœ¨å®é™…ç”Ÿäº§ä»£ç ä¸­ï¼Œå¸¸å¸¸éœ€è¦å°†æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸åˆè§„æ•°æ®è¡Œè¿›è¡Œå…¨å±€è®¡æ•°ï¼Œç±»ä¼¼è¿™ç§éœ€æ±‚å¯ä»¥å€ŸåŠ©mapreduceæ¡†æ¶ä¸­æä¾›çš„å…¨å±€è®¡æ•°å™¨æ¥å®ç° ç¤ºä¾‹ 12345678910111213141516171819public class MultiOutputs &#123; //é€šè¿‡æšä¸¾å½¢å¼å®šä¹‰è‡ªå®šä¹‰è®¡æ•°å™¨ enum MyCounter&#123;MALFORORMED,NORMAL&#125; static class CommaMapper extends Mapper&lt;LongWritable, Text, Text, LongWritable&gt; &#123; @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; String[] words = value.toString().split(","); for (String word : words) &#123; context.write(new Text(word), new LongWritable(1)); &#125; //å¯¹æšä¸¾å®šä¹‰çš„è‡ªå®šä¹‰è®¡æ•°å™¨åŠ 1 context.getCounter(MyCounter.MALFORORMED).increment(1); //é€šè¿‡åŠ¨æ€è®¾ç½®è‡ªå®šä¹‰è®¡æ•°å™¨åŠ 1 context.getCounter("counterGroupa", "countera").increment(1); &#125; &#125; MAPREDUCE æ•°æ®å‹ç¼©æ•°æ®å‹ç¼©é…ç½®åœ¨é…ç½®å‚æ•°æˆ–åœ¨ä»£ç ä¸­éƒ½å¯ä»¥è®¾ç½®reduceçš„è¾“å‡ºå‹ç¼© Reduceè¾“å‡ºæ•°æ®å‹ç¼© åœ¨é…ç½®å‚æ•°ä¸­è®¾ç½® 123mapreduce.output.fileoutputformat.compress=falsemapreduce.output.fileoutputformat.compress.codec=org.apache.hadoop.io.compress.DefaultCodecmapreduce.output.fileoutputformat.compress.type=RECORD åœ¨ä»£ç ä¸­é…ç½® 123Job job = Job.getInstance(conf);FileOutputFormat.setCompressOutput(job, true);FileOutputFormat.setOutputCompressorClass(job, (Class&lt;? extends CompressionCodec&gt;) Class.forName("")); Mapperæ•°æ®å‹ç¼© åœ¨é…ç½®å‚æ•°ä¸­è®¾ç½® 12mapreduce.map.output.compress=falsemapreduce.map.output.compress.codec=org.apache.hadoop.io.compress.DefaultCodec åœ¨ä»£ç ä¸­è®¾ç½® 12conf.setBoolean(Job.MAP_OUTPUT_COMPRESS, true);conf.setClass(Job.MAP_OUTPUT_COMPRESS_CODEC, GzipCodec.class, CompressionCodec.class); å‹ç¼©æ–‡ä»¶çš„è¯»å–Hadoopè‡ªå¸¦çš„InputFormatç±»å†…ç½®æ”¯æŒå‹ç¼©æ–‡ä»¶çš„è¯»å–ï¼Œæ¯”å¦‚TextInputformatç±»ï¼Œåœ¨å…¶initializeæ–¹æ³•ä¸­ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041public void initialize(InputSplit genericSplit, TaskAttemptContext context) throws IOException &#123; FileSplit split = (FileSplit) genericSplit; Configuration job = context.getConfiguration(); this.maxLineLength = job.getInt(MAX_LINE_LENGTH, Integer.MAX_VALUE); start = split.getStart(); end = start + split.getLength(); final Path file = split.getPath(); // open the file and seek to the start of the split final FileSystem fs = file.getFileSystem(job); fileIn = fs.open(file); //æ ¹æ®æ–‡ä»¶åç¼€ååˆ›å»ºç›¸åº”å‹ç¼©ç¼–ç çš„codec CompressionCodec codec = new CompressionCodecFactory(job).getCodec(file); if (null!=codec) &#123; isCompressedInput = true; decompressor = CodecPool.getDecompressor(codec); //åˆ¤æ–­æ˜¯å¦å±äºå¯åˆ‡ç‰‡å‹ç¼©ç¼–ç ç±»å‹ if (codec instanceof SplittableCompressionCodec) &#123; final SplitCompressionInputStream cIn = ((SplittableCompressionCodec)codec).createInputStream( fileIn, decompressor, start, end, SplittableCompressionCodec.READ_MODE.BYBLOCK); //å¦‚æœæ˜¯å¯åˆ‡ç‰‡å‹ç¼©ç¼–ç ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªCompressedSplitLineReaderè¯»å–å‹ç¼©æ•°æ® in = new CompressedSplitLineReader(cIn, job, this.recordDelimiterBytes); start = cIn.getAdjustedStart(); end = cIn.getAdjustedEnd(); filePosition = cIn; &#125; else &#123; //å¦‚æœæ˜¯ä¸å¯åˆ‡ç‰‡å‹ç¼©ç¼–ç ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªSplitLineReaderè¯»å–å‹ç¼©æ•°æ®ï¼Œå¹¶å°†æ–‡ä»¶è¾“å…¥æµè½¬æ¢æˆè§£å‹æ•°æ®æµä¼ é€’ç»™æ™®é€šSplitLineReaderè¯»å– in = new SplitLineReader(codec.createInputStream(fileIn, decompressor), job, this.recordDelimiterBytes); filePosition = fileIn; &#125; &#125; else &#123; fileIn.seek(start); //å¦‚æœä¸æ˜¯å‹ç¼©æ–‡ä»¶ï¼Œåˆ™åˆ›å»ºæ™®é€šSplitLineReaderè¯»å–æ•°æ® in = new SplitLineReader(fileIn, job, this.recordDelimiterBytes); filePosition = fileIn; &#125; MAPREDUCE å‚æ•°ä¼˜åŒ–èµ„æºç›¸å…³å‚æ•° ä»¥ä¸‹å‚æ•°æ˜¯åœ¨ç”¨æˆ·è‡ªå·±çš„mråº”ç”¨ç¨‹åºä¸­é…ç½®å°±å¯ä»¥ç”Ÿæ•ˆ mapreduce.map.memory.mb: ä¸€ä¸ªMap Taskå¯ä½¿ç”¨çš„èµ„æºä¸Šé™ï¼ˆå•ä½:MBï¼‰ï¼Œé»˜è®¤ä¸º1024ã€‚å¦‚æœMap Taskå®é™…ä½¿ç”¨çš„èµ„æºé‡è¶…è¿‡è¯¥å€¼ï¼Œåˆ™ä¼šè¢«å¼ºåˆ¶æ€æ­»ã€‚ mapreduce.reduce.memory.mb: ä¸€ä¸ªReduce Taskå¯ä½¿ç”¨çš„èµ„æºä¸Šé™ï¼ˆå•ä½:MBï¼‰ï¼Œé»˜è®¤ä¸º1024ã€‚å¦‚æœReduce Taskå®é™…ä½¿ç”¨çš„èµ„æºé‡è¶…è¿‡è¯¥å€¼ï¼Œåˆ™ä¼šè¢«å¼ºåˆ¶æ€æ­»ã€‚ mapreduce.map.java.opts: Map Taskçš„JVMå‚æ•°ï¼Œä½ å¯ä»¥åœ¨æ­¤é…ç½®é»˜è®¤çš„java heap sizeç­‰å‚æ•°, e.gï¼š-Xmx1024m -verbose:gc -Xloggc:/tmp/@taskid@.gc ï¼ˆ@taskid@ä¼šè¢«Hadoopæ¡†æ¶è‡ªåŠ¨æ¢ä¸ºç›¸åº”çš„taskidï¼‰, é»˜è®¤å€¼: â€œâ€ mapreduce.reduce.java.opts: Reduce Taskçš„JVMå‚æ•°ï¼Œä½ å¯ä»¥åœ¨æ­¤é…ç½®é»˜è®¤çš„java heap sizeç­‰å‚æ•°, e.g: -Xmx1024m -verbose:gc -Xloggc:/tmp/@taskid@.gc, é»˜è®¤å€¼: â€œâ€ mapreduce.map.cpu.vcores: æ¯ä¸ªMap taskå¯ä½¿ç”¨çš„æœ€å¤šcpu coreæ•°ç›®, é»˜è®¤å€¼: 1 mapreduce.reduce.cpu.vcores: æ¯ä¸ªReduce taskå¯ä½¿ç”¨çš„æœ€å¤šcpu coreæ•°ç›®, é»˜è®¤å€¼: 1 ä»¥ä¸‹å‚æ•°åº”è¯¥åœ¨yarnå¯åŠ¨ä¹‹å‰å°±é…ç½®åœ¨æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ä¸­æ‰èƒ½ç”Ÿæ•ˆ yarn.scheduler.minimum-allocation-mb 1024 ç»™åº”ç”¨ç¨‹åºcontaineråˆ†é…çš„æœ€å°å†…å­˜ yarn.scheduler.maximum-allocation-mb 8192 ç»™åº”ç”¨ç¨‹åºcontaineråˆ†é…çš„æœ€å¤§å†…å­˜ yarn.scheduler.minimum-allocation-vcores 1 æœ€å°cpu yarn.scheduler.maximum-allocation-vcores 32 æœ€å¤§cpu yarn.nodemanager.resource.memory-mb 8192 ä¸€å°nodemanager å¯ç”¨çš„æ€»å†…å­˜ shuffleæ€§èƒ½ä¼˜åŒ–çš„å…³é”®å‚æ•°ï¼Œåº”åœ¨yarnå¯åŠ¨ä¹‹å‰å°±é…ç½®å¥½ mapreduce.task.io.sort.mb 100 //shuffleçš„ç¯å½¢ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤100m mapreduce.map.sort.spill.percent 0.8 //ç¯å½¢ç¼“å†²åŒºæº¢å‡ºçš„é˜ˆå€¼ï¼Œé»˜è®¤80% å®¹é”™ç›¸å…³å‚æ•° mapreduce.map.maxattempts: æ¯ä¸ªMap Taskæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä¸€æ—¦é‡è¯•å‚æ•°è¶…è¿‡è¯¥å€¼ï¼Œåˆ™è®¤ä¸ºMap Taskè¿è¡Œå¤±è´¥ï¼Œé»˜è®¤å€¼ï¼š4ã€‚ mapreduce.reduce.maxattempts: æ¯ä¸ªReduce Taskæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä¸€æ—¦é‡è¯•å‚æ•°è¶…è¿‡è¯¥å€¼ï¼Œåˆ™è®¤ä¸ºMap Taskè¿è¡Œå¤±è´¥ï¼Œé»˜è®¤å€¼ï¼š4ã€‚ mapreduce.map.failures.maxpercent: å½“å¤±è´¥çš„Map Taskå¤±è´¥æ¯”ä¾‹è¶…è¿‡è¯¥å€¼ä¸ºï¼Œæ•´ä¸ªä½œä¸šåˆ™å¤±è´¥ï¼Œé»˜è®¤å€¼ä¸º0. å¦‚æœä½ çš„åº”ç”¨ç¨‹åºå…è®¸ä¸¢å¼ƒéƒ¨åˆ†è¾“å…¥æ•°æ®ï¼Œåˆ™è¯¥è¯¥å€¼è®¾ä¸ºä¸€ä¸ªå¤§äº0çš„å€¼ï¼Œæ¯”å¦‚5ï¼Œè¡¨ç¤ºå¦‚æœæœ‰ä½äº5%çš„Map Taskå¤±è´¥ï¼ˆå¦‚æœä¸€ä¸ªMap Taské‡è¯•æ¬¡æ•°è¶…è¿‡mapreduce.map.maxattemptsï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªMap Taskå¤±è´¥ï¼Œå…¶å¯¹åº”çš„è¾“å…¥æ•°æ®å°†ä¸ä¼šäº§ç”Ÿä»»ä½•ç»“æœï¼‰ï¼Œæ•´ä¸ªä½œä¸šæ‰”è®¤ä¸ºæˆåŠŸã€‚ mapreduce.reduce.failures.maxpercent: å½“å¤±è´¥çš„Reduce Taskå¤±è´¥æ¯”ä¾‹è¶…è¿‡è¯¥å€¼ä¸ºï¼Œæ•´ä¸ªä½œä¸šåˆ™å¤±è´¥ï¼Œé»˜è®¤å€¼ä¸º0. mapreduce.task.timeout: Taskè¶…æ—¶æ—¶é—´ï¼Œç»å¸¸éœ€è¦è®¾ç½®çš„ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°è¡¨è¾¾çš„æ„æ€ä¸ºï¼šå¦‚æœä¸€ä¸ªtaskåœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰ä»»ä½•è¿›å…¥ï¼Œå³ä¸ä¼šè¯»å–æ–°çš„æ•°æ®ï¼Œä¹Ÿæ²¡æœ‰è¾“å‡ºæ•°æ®ï¼Œåˆ™è®¤ä¸ºè¯¥taskå¤„äºblockçŠ¶æ€ï¼Œå¯èƒ½æ˜¯å¡ä½äº†ï¼Œä¹Ÿè®¸æ°¸è¿œä¼šå¡ä¸»ï¼Œä¸ºäº†é˜²æ­¢å› ä¸ºç”¨æˆ·ç¨‹åºæ°¸è¿œblockä½ä¸é€€å‡ºï¼Œåˆ™å¼ºåˆ¶è®¾ç½®äº†ä¸€ä¸ªè¯¥è¶…æ—¶æ—¶é—´ï¼ˆå•ä½æ¯«ç§’ï¼‰ï¼Œé»˜è®¤æ˜¯300000ã€‚å¦‚æœä½ çš„ç¨‹åºå¯¹æ¯æ¡è¾“å…¥æ•°æ®çš„å¤„ç†æ—¶é—´è¿‡é•¿ï¼ˆæ¯”å¦‚ä¼šè®¿é—®æ•°æ®åº“ï¼Œé€šè¿‡ç½‘ç»œæ‹‰å–æ•°æ®ç­‰ï¼‰ï¼Œå»ºè®®å°†è¯¥å‚æ•°è°ƒå¤§ï¼Œè¯¥å‚æ•°è¿‡å°å¸¸å‡ºç°çš„é”™è¯¯æç¤ºæ˜¯â€œAttemptID:attempt_14267829456721_123456_m_000224_0 Timed out after 300 secsContainer killed by the ApplicationMaster.â€ã€‚ æœ¬åœ°è¿è¡Œmapreduce ä½œä¸šè®¾ç½®ä»¥ä¸‹å‡ ä¸ªå‚æ•°: mapreduce.framework.name=local mapreduce.jobtracker.address=local fs.defaultFS=local æ•ˆç‡å’Œç¨³å®šæ€§ç›¸å…³å‚æ•° mapreduce.map.speculative: æ˜¯å¦ä¸ºMap Taskæ‰“å¼€æ¨æµ‹æ‰§è¡Œæœºåˆ¶ï¼Œé»˜è®¤ä¸ºfalse mapreduce.reduce.speculative: æ˜¯å¦ä¸ºReduce Taskæ‰“å¼€æ¨æµ‹æ‰§è¡Œæœºåˆ¶ï¼Œé»˜è®¤ä¸ºfalse mapreduce.job.user.classpath.first &amp; mapreduce.task.classpath.user.precedenceï¼šå½“åŒä¸€ä¸ªclassåŒæ—¶å‡ºç°åœ¨ç”¨æˆ·jaråŒ…å’Œhadoop jarä¸­æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨å“ªä¸ªjaråŒ…ä¸­çš„classï¼Œé»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºä¼˜å…ˆä½¿ç”¨hadoop jarä¸­çš„classã€‚ mapreduce.input.fileinputformat.split.minsize: FileInputFormatåšåˆ‡ç‰‡æ—¶çš„æœ€å°åˆ‡ç‰‡å¤§å°ï¼Œ(5)mapreduce.input.fileinputformat.split.maxsize: FileInputFormatåšåˆ‡ç‰‡æ—¶çš„æœ€å¤§åˆ‡ç‰‡å¤§å° (åˆ‡ç‰‡çš„é»˜è®¤å¤§å°å°±ç­‰äºblocksizeï¼Œå³ 134217728)]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>HADOOP</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>HADOOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HDFS]]></title>
    <url>%2F2019%2F12%2F30%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FHADOOP%2FHDFS%2F</url>
    <content type="text"><![CDATA[HDFS åŸºæœ¬æ¦‚å¿µHDFS æ€æƒ³è®¾è®¡æ€æƒ³åˆ†è€Œæ²»ä¹‹: å°†å¤§æ–‡ä»¶ã€å¤§æ‰¹é‡æ–‡ä»¶ï¼Œ åˆ†å¸ƒå¼å­˜æ”¾åœ¨å¤§é‡æœåŠ¡å™¨ä¸Šï¼Œä»¥ä¾¿äºé‡‡å–åˆ†è€Œæ²»ä¹‹çš„æ–¹å¼å¯¹æµ·é‡æ•°æ®è¿›è¡Œè¿ç®—åˆ†æï¼› åœ¨å¤§æ•°æ®ç³»ç»Ÿä¸­çš„åº”ç”¨ä¸ºå„ç±»åˆ†å¸ƒå¼è¿ç®—æ¡†æ¶(å¦‚: mapreduce, spark, tez, â€¦) æä¾›æ•°æ®å­˜å‚¨æœåŠ¡ é‡ç‚¹æ¦‚å¿µæ–‡ä»¶åˆ‡å—ï¼Œ å‰¯æœ¬å­˜æ”¾ï¼Œ åŸæ•°æ®ç®¡ç† HDFSçš„æ¦‚å¿µå’Œç‰¹æ€§æ¦‚å¿µé¦–å…ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶ï¼Œé€šè¿‡ç»Ÿä¸€çš„å‘½åç©ºé—´â€”â€”ç›®å½•æ ‘æ¥å®šä½æ–‡ä»¶ å…¶æ¬¡ï¼Œå®ƒæ˜¯åˆ†å¸ƒå¼çš„ï¼Œç”±å¾ˆå¤šæœåŠ¡å™¨è”åˆèµ·æ¥å®ç°å…¶åŠŸèƒ½ï¼Œé›†ç¾¤ä¸­çš„æœåŠ¡å™¨æœ‰å„è‡ªçš„è§’è‰²ï¼› é‡è¦ç‰¹å¾ DFSä¸­çš„æ–‡ä»¶åœ¨ç‰©ç†ä¸Šæ˜¯åˆ†å—å­˜å‚¨ï¼ˆblockï¼‰ï¼Œå—çš„å¤§å°å¯ä»¥é€šè¿‡é…ç½®å‚æ•°( dfs.blocksize)æ¥è§„å®šï¼Œé»˜è®¤å¤§å°åœ¨hadoop2.xç‰ˆæœ¬ä¸­æ˜¯128Mï¼Œè€ç‰ˆæœ¬ä¸­æ˜¯64M HDFSæ–‡ä»¶ç³»ç»Ÿä¼šç»™å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æŠ½è±¡ç›®å½•æ ‘ï¼Œå®¢æˆ·ç«¯é€šè¿‡è·¯å¾„æ¥è®¿é—®æ–‡ä»¶ï¼Œå½¢å¦‚ï¼šhdfs://namenode:port/dir-a/dir-b/dir-c/file.data ç›®å½•ç»“æ„åŠæ–‡ä»¶åˆ†å—ä¿¡æ¯(å…ƒæ•°æ®)çš„ç®¡ç†ç”±namenodeèŠ‚ç‚¹æ‰¿æ‹…ï¼Œ namenodeæ˜¯HDFSé›†ç¾¤ä¸»èŠ‚ç‚¹ï¼Œè´Ÿè´£ç»´æŠ¤æ•´ä¸ªhdfsæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•æ ‘ï¼Œä»¥åŠæ¯ä¸€ä¸ªè·¯å¾„ï¼ˆæ–‡ä»¶ï¼‰æ‰€å¯¹åº”çš„blockå—ä¿¡æ¯ï¼ˆblockçš„idï¼ŒåŠæ‰€åœ¨çš„datanodeæœåŠ¡å™¨ï¼‰ æ–‡ä»¶çš„å„ä¸ªblockçš„å­˜å‚¨ç®¡ç†ç”±datanodeèŠ‚ç‚¹æ‰¿æ‹…ï¼Œ datanodeæ˜¯HDFSé›†ç¾¤ä»èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªblockéƒ½å¯ä»¥åœ¨å¤šä¸ªdatanodeä¸Šå­˜å‚¨å¤šä¸ªå‰¯æœ¬ï¼ˆå‰¯æœ¬æ•°é‡ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°è®¾ç½®dfs.replicationï¼‰ HDFSæ˜¯è®¾è®¡æˆé€‚åº”ä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»å‡ºçš„åœºæ™¯ï¼Œä¸”ä¸æ”¯æŒæ–‡ä»¶çš„ä¿®æ”¹ï¼Œ é€‚åˆç”¨æ¥åšæ•°æ®åˆ†æï¼Œå¹¶ä¸é€‚åˆç”¨æ¥åšç½‘ç›˜åº”ç”¨ï¼Œå› ä¸ºï¼Œä¸ä¾¿ä¿®æ”¹ï¼Œå»¶è¿Ÿå¤§ï¼Œç½‘ç»œå¼€é”€å¤§ï¼Œæˆæœ¬å¤ªé«˜ HDFSçš„å·¥ä½œæœºåˆ¶HDFS å·¥ä½œæœºåˆ¶ä»‹ç» HDFSé›†ç¾¤åˆ†ä¸ºä¸¤å¤§è§’è‰²ï¼šNameNodeã€DataNode (Secondary Namenode) NameNodeè´Ÿè´£ç®¡ç†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ® DataNode è´Ÿè´£ç®¡ç†ç”¨æˆ·çš„æ–‡ä»¶æ•°æ®å— æ–‡ä»¶ä¼šæŒ‰ç…§å›ºå®šçš„å¤§å°ï¼ˆblocksizeï¼‰åˆ‡æˆè‹¥å¹²å—ååˆ†å¸ƒå¼å­˜å‚¨åœ¨è‹¥å¹²å°datanodeä¸Š æ¯ä¸€ä¸ªæ–‡ä»¶å—å¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå¹¶å­˜æ”¾åœ¨ä¸åŒçš„datanodeä¸Š Datanodeä¼šå®šæœŸå‘Namenodeæ±‡æŠ¥è‡ªèº«æ‰€ä¿å­˜çš„æ–‡ä»¶blockä¿¡æ¯ï¼Œè€Œnamenodeåˆ™ä¼šè´Ÿè´£ä¿æŒæ–‡ä»¶çš„å‰¯æœ¬æ•°é‡ HDFSçš„å†…éƒ¨å·¥ä½œæœºåˆ¶å¯¹å®¢æˆ·ç«¯ä¿æŒé€æ˜ï¼Œå®¢æˆ·ç«¯è¯·æ±‚è®¿é—®HDFSéƒ½æ˜¯é€šè¿‡å‘namenodeç”³è¯·æ¥è¿›è¡Œ HDFS å†™æ•°æ®çš„æµç¨‹ å®¢æˆ·ç«¯ä¸namenodeé€šä¿¡è¯·æ±‚ä¸Šä¼ æ–‡ä»¶ï¼Œnamenodeæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨ï¼Œçˆ¶ç›®å½•æ˜¯å¦å­˜åœ¨ namenodeè¿”å›æ˜¯å¦å¯ä»¥ä¸Šä¼  clientè¯·æ±‚ç¬¬ä¸€ä¸ª blockè¯¥ä¼ è¾“åˆ°å“ªäº›datanodeæœåŠ¡å™¨ä¸Š namenodeè¿”å›å¯ä»¥ä¸Šä¼ çš„èŠ‚ç‚¹, ç¤ºä¾‹3ä¸ªdatanodeæœåŠ¡å™¨ABC clientè¯·æ±‚3å°dnä¸­çš„ä¸€å°Aä¸Šä¼ æ•°æ®ï¼ˆæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªRPCè°ƒç”¨ï¼Œå»ºç«‹pipelineï¼‰ï¼ŒAæ”¶åˆ°è¯·æ±‚ä¼šç»§ç»­è°ƒç”¨Bï¼Œç„¶åBè°ƒç”¨Cï¼Œå°†çœŸä¸ªpipelineå»ºç«‹å®Œæˆï¼Œé€çº§è¿”å›å®¢æˆ·ç«¯ clientå¼€å§‹å¾€Aä¸Šä¼ ç¬¬ä¸€ä¸ªblockï¼ˆå…ˆä»ç£ç›˜è¯»å–æ•°æ®æ”¾åˆ°ä¸€ä¸ªæœ¬åœ°å†…å­˜ç¼“å­˜ï¼‰ï¼Œä»¥packetä¸ºå•ä½(chunkä¸ºæ ¡éªŒå•ä½)ï¼ŒAæ”¶åˆ°ä¸€ä¸ªpacketå°±ä¼šä¼ ç»™Bï¼ŒBä¼ ç»™Cï¼›Aæ¯ä¼ ä¸€ä¸ªpacketä¼šæ”¾å…¥ä¸€ä¸ªåº”ç­”é˜Ÿåˆ—ç­‰å¾…åº”ç­” å½“ä¸€ä¸ªblockä¼ è¾“å®Œæˆä¹‹åï¼Œclientå†æ¬¡è¯·æ±‚namenodeä¸Šä¼ ç¬¬äºŒä¸ªblockçš„æœåŠ¡å™¨ã€‚ HDFSè¯»æ•°æ®æµç¨‹ clientè·Ÿnamenodeé€šä¿¡æŸ¥è¯¢å…ƒæ•°æ®ï¼Œæ‰¾åˆ°æ–‡ä»¶å—æ‰€åœ¨çš„datanodeæœåŠ¡å™¨ cilentæŒ‘é€‰ä¸€å°datanodeï¼ˆå°±è¿‘åŸåˆ™ï¼Œç„¶åéšæœºï¼‰æœåŠ¡å™¨ï¼Œè¯·æ±‚å»ºç«‹socketæµ datanodeå¼€å§‹å‘é€æ•°æ®ï¼ˆä»ç£ç›˜é‡Œé¢è¯»å–æ•°æ®æ”¾å…¥æµï¼Œä»¥packetä¸ºä¼ è¾“å•ä½ï¼Œchunkä¸ºæ ¡éªŒå•ä½ï¼‰ å®¢æˆ·ç«¯ä»¥packetä¸ºå•ä½æ¥æ”¶ï¼Œå…ˆåœ¨æœ¬åœ°ç¼“å­˜ï¼Œç„¶åå†™å…¥ç›®æ ‡æ–‡ä»¶ blockã€packetä¸chunkåœ¨DFSClientå†™HDFSçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸‰ä¸ªéœ€è¦ææ¸…æ¥šçš„å•ä½ï¼šblockã€packetä¸chunkï¼› blockæ˜¯æœ€å¤§çš„ä¸€ä¸ªå•ä½ï¼Œå®ƒæ˜¯æœ€ç»ˆå­˜å‚¨äºDataNodeä¸Šçš„æ•°æ®ç²’åº¦ï¼Œç”±dfs.block.sizeå‚æ•°å†³å®šï¼Œé»˜è®¤æ˜¯64Mï¼›æ³¨ï¼šè¿™ä¸ªå‚æ•°ç”±å®¢æˆ·ç«¯é…ç½®å†³å®šï¼› packetæ˜¯ä¸­ç­‰çš„ä¸€ä¸ªå•ä½ï¼Œå®ƒæ˜¯æ•°æ®ç”±DFSClientæµå‘DataNodeçš„ç²’åº¦ï¼Œä»¥dfs.write.packet.sizeå‚æ•°ä¸ºå‚è€ƒå€¼ï¼Œé»˜è®¤æ˜¯64Kï¼›æ³¨ï¼šè¿™ä¸ªå‚æ•°ä¸ºå‚è€ƒå€¼ï¼Œæ˜¯æŒ‡çœŸæ­£åœ¨è¿›è¡Œæ•°æ®ä¼ è¾“æ—¶ï¼Œä¼šä»¥å®ƒä¸ºåŸºå‡†è¿›è¡Œè°ƒæ•´ï¼Œè°ƒæ•´çš„åŸå› æ˜¯ä¸€ä¸ªpacketæœ‰ç‰¹å®šçš„ç»“æ„ï¼Œè°ƒæ•´çš„ç›®æ ‡æ˜¯è¿™ä¸ªpacketçš„å¤§å°åˆšå¥½åŒ…å«ç»“æ„ä¸­çš„æ‰€æœ‰æˆå‘˜ï¼ŒåŒæ—¶ä¹Ÿä¿è¯å†™åˆ°DataNodeåå½“å‰blockçš„å¤§å°ä¸è¶…è¿‡è®¾å®šå€¼ï¼› chunkæ˜¯æœ€å°çš„ä¸€ä¸ªå•ä½ï¼Œå®ƒæ˜¯DFSClientåˆ°DataNodeæ•°æ®ä¼ è¾“ä¸­è¿›è¡Œæ•°æ®æ ¡éªŒçš„ç²’åº¦ï¼Œç”±io.bytes.per.checksumå‚æ•°å†³å®šï¼Œé»˜è®¤æ˜¯512Bï¼›æ³¨ï¼šäº‹å®ä¸Šä¸€ä¸ªchunkè¿˜åŒ…å«4Bçš„æ ¡éªŒå€¼ï¼Œå› è€Œchunkå†™å…¥packetæ—¶æ˜¯516Bï¼›æ•°æ®ä¸æ£€éªŒå€¼çš„æ¯”å€¼ä¸º128:1ï¼Œæ‰€ä»¥å¯¹äºä¸€ä¸ª128Mçš„blockä¼šæœ‰ä¸€ä¸ª1Mçš„æ ¡éªŒæ–‡ä»¶ä¸ä¹‹å¯¹åº”ï¼› NAMENODE å·¥ä½œæœºåˆ¶NAMENODE çš„èŒè´£ è´Ÿè´£å®¢æˆ·ç«¯è¯·æ±‚çš„å“åº” å…ƒæ•°æ®çš„ç®¡ç†ï¼ˆæŸ¥è¯¢ï¼Œä¿®æ”¹ï¼‰ åŸæ•°æ®ç®¡ç†å½¢å¼ å†…å­˜å…ƒæ•°æ®(NameSystem) ç£ç›˜å…ƒæ•°æ®é•œåƒæ–‡ä»¶(fsimage) æ•°æ®æ“ä½œæ—¥å¿—æ–‡ä»¶ï¼ˆeditsæ–‡ä»¶ï¼Œ å¯é€šè¿‡æ—¥å¿—è¿ç®—å‡ºå…ƒæ•°æ®ï¼‰ åŸæ•°æ®çš„å­˜å‚¨æœºåˆ¶ å†…å­˜ä¸­æœ‰ä¸€ä»½å®Œæ•´çš„åŸæ•°æ®(å†…å­˜metadate) ç£ç›˜ä¸­æœ‰ä¸€ä¸ªâ€å‡†å®Œæ•´â€çš„åŸæ•°æ®é•œåƒ(fsimage)æ–‡ä»¶(åœ¨namenodeçš„å·¥ä½œç›®å½•ä¸­) ç”¨äºè¡”æ¥metadataå’ŒæŒä¹…åŒ–å…ƒæ•°æ®é•œåƒçš„fsimageä¹‹é—´çš„æ“ä½œæ—¥å¿—(editsæ–‡ä»¶), å½“å®¢æˆ·ç«¯å¯¹hdfsä¸­çš„æ–‡ä»¶è¿›è¡Œæ–°å¢æˆ–è€…ä¿®æ”¹æ“ä½œï¼Œæ“ä½œè®°å½•ä¼šé¦–å…ˆè¢«è®°å½•åˆ°editsæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå½“å®¢æˆ·ç«¯æ“ä½œæˆåŠŸåï¼Œç›¸åº”çš„åŸæ•°æ®ä¼šæ›´æ–°åˆ°å†…å­˜meta.dataä¸­ï¼Œ å¹¶ä¸”æ¯éš”ä¸€å®šçš„é—´éš”hdfsä¼šå°†å½“å‰çš„metadataåŒæ­¥åˆ°fsimageé•œåƒæ–‡ä»¶ä¸­ åŸæ•°æ®æ‰‹åŠ¨æŸ¥çœ‹hdfså‘½ä»¤ 12hdfs oev -i edits -o edits.xmlhdfs oiv -i fsimage_0000000000000000087 -p XML -o fsimage.xml å…ƒæ•°æ®çš„checkpointç”±äºåœ¨æ•°æ®å¤‡ä»½çš„æ—¶å€™ä¼šå ç”¨è®¡ç®—èµ„æºï¼Œæ‰€ä»¥ä¸ºäº†å‡è½»namenodeçš„è´Ÿè½½ï¼Œé€šå¸¸å¯ä»¥å°†æ•°æ®å¤‡ä»½çš„å·¥ä½œäº¤ç»™å¦å¤–ä¸€ä¸ªä¸“é—¨ç”¨æ¥åšæ•°æ®å¤‡ä»½çš„namenodeâ€“&gt; sencondary namenode æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œä¼šç”±secondary namenode å°†namenodeä¸Šç§¯ç´¯çš„æ‰€æœ‰editså’Œä¸€ä¸ªæœ€æ–°çš„fsimageä¸‹è½½åˆ°æœ¬åœ°(åªæœ‰ç¬¬ä¸€æ¬¡mergeæ‰ä¼šä¸‹è½½fsimage)ï¼Œå¹¶åŠ è½½åˆ°å†…å­˜è¿›è¡Œmerge(è¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºcheckpoint) namenodeçš„ä¸€äº›æƒ…å†µnamenodeå¦‚æœå®•æœºï¼Œhdfsæ˜¯å¦è¿˜èƒ½æ­£å¸¸æä¾›æœåŠ¡ ä¸èƒ½ï¼Œsecondarynamenodeè™½ç„¶æœ‰å…ƒæ•°æ®ä¿¡æ¯ï¼Œä½†æ˜¯ä¸èƒ½æ›´æ–°å…ƒæ•°æ®ï¼Œ ä¸èƒ½å……å½“namenodeä½¿ç”¨ å¦‚æœnamenodeçš„ç¡¬ç›˜æŸåï¼Œå…ƒæ•°æ®æ˜¯å¦èƒ½å›å¤ï¼Œèƒ½æ¢å¤å¤šå°‘? å¯ä»¥æ¢å¤æœ€åä¸€æ¬¡mergeä¹‹å‰çš„æ•°æ®ï¼Œ åªéœ€è¦å°†secondarynamenodeçš„æ•°æ®ç›®å½•æ›¿æ¢æˆnamenodeçš„æ•°æ®ç›®å½• é…ç½®namenodeçš„å·¥ä½œç›®å½•æ—¶ï¼Œæœ‰å“ªäº›å¯ä»¥æ³¨æ„çš„äº‹é¡¹ å¯ä»¥å°†namenodeçš„å…ƒæ•°æ®ä¿å­˜åˆ°å¤šå—ç‰©ç†ç£ç›˜ä¸Šä¾‹å¦‚å¦‚ä¸‹çš„namenodeé…ç½® 1234&lt;property&gt;&lt;name&gt;dfs.name.dir&lt;/name&gt;&lt;value&gt;/home/hadoop/name1,/home/hadoop/name2&lt;/value&gt;&lt;/property&gt; checkpoint çš„è§¦å‘æ¡ä»¶ç›¸å…³é…ç½®12345678dfs.namenode.checkpoint.check.period=60 #æ£€æŸ¥è§¦å‘æ¡ä»¶æ˜¯å¦æ»¡è¶³çš„é¢‘ç‡ï¼Œ60ç§’dfs.namenode.checkpoint.dir=file://$&#123;hadoop.tmp.dir&#125;/dfs/namesecondary#ä»¥ä¸Šä¸¤ä¸ªå‚æ•°åšcheckpointæ“ä½œæ—¶ï¼Œsecondary namenodeçš„æœ¬åœ°å·¥ä½œç›®å½•dfs.namenode.checkpoint.edits.dir=$&#123;dfs.namenode.checkpoint.dir&#125;dfs.namenode.checkpoint.max-retries=3 #æœ€å¤§é‡è¯•æ¬¡æ•°dfs.namenode.checkpoint.period=3600 #ä¸¤æ¬¡checkpointä¹‹é—´çš„æ—¶é—´é—´éš”3600ç§’dfs.namenode.checkpoint.txns=1000000 #ä¸¤æ¬¡checkpointä¹‹é—´æœ€å¤§çš„æ“ä½œè®°å½• å…ƒæ•°æ®ç›®å½•è¯´æ˜åœ¨ç¬¬ä¸€æ¬¡éƒ¨ç½²å¥½Hadoopé›†ç¾¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨NameNodeï¼ˆNNï¼‰èŠ‚ç‚¹ä¸Šæ ¼å¼åŒ–ç£ç›˜ï¼š 1hadoop namenode -format å…ƒæ•°æ®ç›®å½•ä»‹ç»æ ¼å¼åŒ–å®Œæˆä¹‹åï¼Œå°†ä¼šåœ¨$dfs.namenode.name.dir/currentç›®å½•ä¸‹å¦‚ä¸‹çš„æ–‡ä»¶ç»“æ„ 123456current/|-- VERSION|-- edits_*|-- fsimage_0000000000008547077|-- fsimage_0000000000008547077.md5|-- seen_txid å…¶ä¸­çš„dfs.name.diræ˜¯åœ¨hdfs-site.xmlæ–‡ä»¶ä¸­é…ç½®çš„ï¼Œé»˜è®¤å€¼å¦‚ä¸‹ï¼š 1234567891011&lt;property&gt; &lt;name&gt;dfs.name.dir&lt;/name&gt; &lt;value&gt;file://$&#123;hadoop.tmp.dir&#125;/dfs/name&lt;/value&gt;&lt;/property&gt;# hadoop.tmp.diræ˜¯åœ¨core-site.xmlä¸­é…ç½®çš„ï¼Œé»˜è®¤å€¼å¦‚ä¸‹&lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/tmp/hadoop-$&#123;user.name&#125;&lt;/value&gt; &lt;description&gt;A base for other temporary directories.&lt;/description&gt;&lt;/property&gt; dfs.namenode.name.dirå±æ€§å¯ä»¥é…ç½®å¤šä¸ªï¼Œå¦‚/data1/dfs/name,/data2/dfs/name,/data3/dfs/name,â€¦.ã€‚ å„ä¸ªç›®å½•å­˜å‚¨çš„æ–‡ä»¶ç»“æ„å’Œå†…å®¹éƒ½å®Œå…¨ä¸€æ ·ï¼Œç›¸å½“äºå¤‡ä»½ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å½“å…¶ä¸­ä¸€ä¸ªç›®å½•æŸåäº†ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°Hadoopçš„å…ƒæ•°æ®ï¼Œç‰¹åˆ«æ˜¯å½“å…¶ä¸­ä¸€ä¸ªç›®å½•æ˜¯NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»ŸNetwork File Systemï¼ŒNFSï¼‰ä¹‹ä¸Šï¼Œå³ä½¿ä½ è¿™å°æœºå™¨æŸåäº†ï¼Œå…ƒæ•°æ®ä¹Ÿå¾—åˆ°ä¿å­˜ã€‚ å…ƒæ•°æ®ç›®å½•æ–‡ä»¶ä»‹ç»VERSIONæ–‡ä»¶ VERSIONæ–‡ä»¶æ˜¯Javaå±æ€§æ–‡ä»¶ï¼Œå†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š 1234567#Fri Nov 15 19:47:46 CST 2013namespaceID=934548976clusterID=CID-cdff7d73-93cd-4783-9399-0a22e6dce196cTime=0storageType=NAME_NODEblockpoolID=BP-893790215-192.168.24.72-1383809616115layoutVersion=-47 namespaceIDæ˜¯æ–‡ä»¶ç³»ç»Ÿçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿé¦–æ¬¡æ ¼å¼åŒ–ä¹‹åç”Ÿæˆçš„ï¼› storageTypeè¯´æ˜è¿™ä¸ªæ–‡ä»¶å­˜å‚¨çš„æ˜¯ä»€ä¹ˆè¿›ç¨‹çš„æ•°æ®ç»“æ„ä¿¡æ¯ï¼ˆå¦‚æœæ˜¯DataNodeï¼ŒstorageType=DATA_NODEï¼‰ï¼› cTimeè¡¨ç¤ºNameNodeå­˜å‚¨æ—¶é—´çš„åˆ›å»ºæ—¶é—´ï¼Œç”±äºæˆ‘çš„NameNodeæ²¡æœ‰æ›´æ–°è¿‡ï¼Œæ‰€ä»¥è¿™é‡Œçš„è®°å½•å€¼ä¸º0ï¼Œä»¥åå¯¹NameNodeå‡çº§ä¹‹åï¼ŒcTimeå°†ä¼šè®°å½•æ›´æ–°æ—¶é—´æˆ³ï¼› layoutVersionè¡¨ç¤ºHDFSæ°¸ä¹…æ€§æ•°æ®ç»“æ„çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œ åªè¦æ•°æ®ç»“æ„å˜æ›´ï¼Œç‰ˆæœ¬å·ä¹Ÿè¦é€’å‡ï¼Œæ­¤æ—¶çš„HDFSä¹Ÿéœ€è¦å‡çº§ï¼Œå¦åˆ™ç£ç›˜ä»æ—§æ˜¯ä½¿ç”¨æ—§ç‰ˆæœ¬çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¼šå¯¼è‡´æ–°ç‰ˆæœ¬çš„NameNodeæ— æ³•ä½¿ç”¨ clusterIDæ˜¯ç³»ç»Ÿç”Ÿæˆæˆ–æ‰‹åŠ¨æŒ‡å®šçš„é›†ç¾¤IDï¼Œåœ¨-clusteridé€‰é¡¹ä¸­å¯ä»¥ä½¿ç”¨å®ƒï¼›å¦‚ä¸‹è¯´æ˜ 12345# ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ ¼å¼åŒ–ä¸€ä¸ªNamenodeï¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„cluster_idï¼Œå¹¶ä¸”è¿™ä¸ªcluster_idä¸èƒ½ä¸ç¯å¢ƒä¸­å…¶ä»–é›†ç¾¤æœ‰å†²çªã€‚å¦‚æœæ²¡æœ‰æä¾›cluster_idï¼Œåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ClusterIDã€‚hadoop namenode -format -clusterId &lt;cluster_id&gt;# å‡çº§é›†ç¾¤è‡³æœ€æ–°ç‰ˆæœ¬ã€‚åœ¨å‡çº§è¿‡ç¨‹ä¸­éœ€è¦æä¾›ä¸€ä¸ªClusterIDï¼Œå¦‚æœæ²¡æœ‰æä¾›ClusterIDï¼Œåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªClusterIDã€‚hadoop start namenode --config $HADOOP_CONF_DIR -upgrade -clusterId &lt;cluster_ID&gt; blockpoolIDæ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªNamespaceæ‰€å¯¹åº”çš„blockpoolçš„IDï¼Œä¸Šé¢çš„è¿™ä¸ªBP-893790215-192.168.24.72-1383809616115å°±æ˜¯åœ¨æˆ‘çš„ns1çš„namespaceä¸‹çš„å­˜å‚¨å—æ± çš„IDï¼Œè¿™ä¸ªIDåŒ…æ‹¬äº†å…¶å¯¹åº”çš„NameNodeèŠ‚ç‚¹çš„ipåœ°å€ã€‚ seen_txidæ–‡ä»¶ æ˜¯å­˜æ”¾transactionIdçš„æ–‡ä»¶ï¼Œformatä¹‹åæ˜¯0ï¼Œå®ƒä»£è¡¨çš„æ˜¯namenodeé‡Œé¢çš„edits_*æ–‡ä»¶çš„å°¾æ•°ï¼Œnamenodeé‡å¯çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§seen_txidçš„æ•°å­—ï¼Œå¾ªåºä»å¤´è·‘edits_0000001~åˆ°seen_txidçš„æ•°å­—ã€‚æ‰€ä»¥å½“ä½ çš„hdfså‘ç”Ÿå¼‚å¸¸é‡å¯çš„æ—¶å€™ï¼Œä¸€å®šè¦æ¯”å¯¹seen_txidå†…çš„æ•°å­—æ˜¯ä¸æ˜¯ä½ editsæœ€åçš„å°¾æ•°ï¼Œä¸ç„¶ä¼šå‘ç”Ÿå»ºç½®namenodeæ—¶metaDataçš„èµ„æ–™æœ‰ç¼ºå°‘ï¼Œå¯¼è‡´è¯¯åˆ Datanodeä¸Šå¤šä½™Blockçš„èµ„è®¯ã€‚ æ–‡ä»¶ä¸­è®°å½•çš„æ˜¯editsæ»šåŠ¨çš„åºå·ï¼Œæ¯æ¬¡é‡å¯namenodeæ—¶ï¼Œnamenodeå°±çŸ¥é“è¦å°†å“ªäº›editsè¿›è¡ŒåŠ è½½edits fsimageæ–‡ä»¶å’Œeditsæ–‡ä»¶ fsimage: å…ƒæ•°æ®çš„é•œåƒæ–‡ä»¶ edits: å…ƒæ•°æ®çš„æ»šåŠ¨æ—¥å¿—æ–‡ä»¶ï¼Œæ¯æ¬¡mergeä¹‹åä¼šå¯¹ä¹‹å‰çš„æ—¥å¿—æ–‡ä»¶è¿›è¡Œæ¸…é™¤ DATANODEå·¥ä½œæœºåˆ¶DATANODE å·¥ä½œèŒè´£ å­˜å‚¨ç®¡ç†ç”¨æˆ·çš„æ–‡ä»¶å—æ•°æ® å®šæœŸå‘namenodeæ±‡æŠ¥è‡ªèº«æ‰€æŒæœ‰çš„blockä¿¡æ¯(é€šè¿‡å¿ƒè·³ä¸ŠæŠ¥)ï¼Œ å½“é›†ç¾¤ä¸­çš„èŠ‚ç‚¹å¤±æ•ˆï¼Œæˆ–è€…blockå­˜åœ¨ä¸¢å¤±çš„æ—¶å€™ï¼Œé›†ç¾¤å¯ä»¥æ ¹æ®æ±‡æŠ¥ä¿¡æ¯å›å¤blockåˆå§‹å‰¯æœ¬æ•°é‡çš„é—®é¢˜ DATANODE æ±‡æŠ¥é—´éš”è®¾ç½®å‚æ•°12345&lt;property&gt; &lt;name&gt;dfs.blockreport.intervalMsec&lt;/name&gt; &lt;value&gt;3600000&lt;/value&gt; &lt;description&gt;Determines block reporting interval in milliseconds.&lt;/description&gt;&lt;/property&gt; DATANODEæ‰çº¿åˆ¤æ–­æ—¶é™å‚æ•°datanodeè¿›ç¨‹æ­»äº¡æˆ–è€…ç½‘ç»œæ•…éšœé€ æˆdatanodeæ— æ³•ä¸namenodeé€šä¿¡ï¼Œnamenodeä¸ä¼šç«‹å³æŠŠè¯¥èŠ‚ç‚¹åˆ¤å®šä¸ºæ­»äº¡ï¼Œè¦ç»è¿‡ä¸€æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´æš‚ç§°ä½œè¶…æ—¶æ—¶é•¿ã€‚HDFSé»˜è®¤çš„è¶…æ—¶æ—¶é•¿ä¸º10åˆ†é’Ÿ+30ç§’ã€‚å¦‚æœå®šä¹‰è¶…æ—¶æ—¶é—´ä¸ºtimeoutï¼Œåˆ™è¶…æ—¶æ—¶é•¿çš„è®¡ç®—å…¬å¼ä¸ºï¼š â€‹ timeout = 2 * heartbeat.recheck.interval + 10 * dfs.heartbeat.intervalã€‚ .é»˜è®¤çš„heartbeat.recheck.interval å¤§å°ä¸º5åˆ†é’Ÿï¼Œdfs.heartbeat.intervalé»˜è®¤ä¸º3ç§’ã€‚ heartbeat.recheck.intervalçš„å•ä½ä¸ºæ¯«ç§’ï¼Œdfs.heartbeat.intervalçš„å•ä½ä¸ºç§’ dfsé…ç½®å‚æ•° 12345678&lt;property&gt; &lt;name&gt;heartbeat.recheck.interval&lt;/name&gt; &lt;value&gt;2000&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.heartbeat.interval&lt;/name&gt; &lt;value&gt;1&lt;/value&gt;&lt;/property&gt; HDFSå®¢æˆ·ç«¯æ“ä½œå‘½ä»¤è¡Œå®¢æˆ·ç«¯å‘½ä»¤æ ¼å¼ 1hadoop fs -ls / å‘½ä»¤è¡Œå‚æ•° 123456789101112131415161718192021222324252627282930313233343536[-appendToFile &lt;localsrc&gt; ... &lt;dst&gt;][-cat [-ignoreCrc] &lt;src&gt; ...][-checksum &lt;src&gt; ...][-chgrp [-R] GROUP PATH...][-chmod [-R] &lt;MODE[,MODE]... | OCTALMODE&gt; PATH...][-chown [-R] [OWNER][:[GROUP]] PATH...][-copyFromLocal [-f] [-p] &lt;localsrc&gt; ... &lt;dst&gt;][-copyToLocal [-p] [-ignoreCrc] [-crc] &lt;src&gt; ... &lt;localdst&gt;][-count [-q] &lt;path&gt; ...][-cp [-f] [-p] &lt;src&gt; ... &lt;dst&gt;][-createSnapshot &lt;snapshotDir&gt; [&lt;snapshotName&gt;]][-deleteSnapshot &lt;snapshotDir&gt; &lt;snapshotName&gt;][-df [-h] [&lt;path&gt; ...]][-du [-s] [-h] &lt;path&gt; ...][-expunge][-get [-p] [-ignoreCrc] [-crc] &lt;src&gt; ... &lt;localdst&gt;][-getfacl [-R] &lt;path&gt;][-getmerge [-nl] &lt;src&gt; &lt;localdst&gt;][-help [cmd ...]][-ls [-d] [-h] [-R] [&lt;path&gt; ...]][-mkdir [-p] &lt;path&gt; ...][-moveFromLocal &lt;localsrc&gt; ... &lt;dst&gt;][-moveToLocal &lt;src&gt; &lt;localdst&gt;][-mv &lt;src&gt; ... &lt;dst&gt;][-put [-f] [-p] &lt;localsrc&gt; ... &lt;dst&gt;][-renameSnapshot &lt;snapshotDir&gt; &lt;oldName&gt; &lt;newName&gt;][-rm [-f] [-r|-R] [-skipTrash] &lt;src&gt; ...][-rmdir [--ignore-fail-on-non-empty] &lt;dir&gt; ...][-setfacl [-R] [&#123;-b|-k&#125; &#123;-m|-x &lt;acl_spec&gt;&#125; &lt;path&gt;]|[--set &lt;acl_spec&gt; &lt;path&gt;]][-setrep [-R] [-w] &lt;rep&gt; &lt;path&gt; ...][-stat [format] &lt;path&gt; ...][-tail [-f] &lt;file&gt;][-test -[defsz] &lt;path&gt;][-text [-ignoreCrc] &lt;src&gt; ...][-touchz &lt;path&gt; ...][-usage [cmd ...]] å¸¸ç”¨å‘½ä»¤ä»‹ç» -help åŠŸèƒ½ï¼šè¾“å‡ºè¿™ä¸ªå‘½ä»¤å‚æ•°æ‰‹å†Œ â€“ls åŠŸèƒ½ï¼šæ˜¾ç¤ºç›®å½•ä¿¡æ¯ ç¤ºä¾‹ï¼šhadoop fs -ls hdfs://hadoop-server01:9000/ å¤‡æ³¨ï¼šè¿™äº›å‚æ•°ä¸­ï¼Œæ‰€æœ‰çš„hdfsè·¯å¾„éƒ½å¯ä»¥ç®€å†™, hadoop fs -ls / ç­‰åŒäºä¸Šä¸€æ¡å‘½ä»¤çš„æ•ˆæœ -mkdir åŠŸèƒ½ï¼šåœ¨hdfsä¸Šåˆ›å»ºç›®å½• ç¤ºä¾‹ï¼šhadoop fs -mkdir -p /aaa/bbb/cc/dd -moveFromLocal åŠŸèƒ½ï¼šä»æœ¬åœ°å‰ªåˆ‡ç²˜è´´åˆ°hdfs ç¤ºä¾‹ï¼šhadoop fs - moveFromLocal /home/hadoop/a.txt /aaa/bbb/cc/dd -moveToLocal åŠŸèƒ½ï¼šä»hdfså‰ªåˆ‡ç²˜è´´åˆ°æœ¬åœ° ç¤ºä¾‹ï¼šhadoop fs - moveToLocal /aaa/bbb/cc/dd /home/hadoop/a.txt* â€“appendToFile åŠŸèƒ½ï¼šè¿½åŠ ä¸€ä¸ªæ–‡ä»¶åˆ°å·²ç»å­˜åœ¨çš„æ–‡ä»¶æœ«å°¾ ç¤ºä¾‹ï¼šhadoop fs -appendToFile ./hello.txt hdfs://hadoop-server01:9000/hello.txt å¯ä»¥ç®€å†™ä¸ºï¼š hadoop fs -appendToFile ./hello.txt /hello.txt -cat åŠŸèƒ½ï¼šæ˜¾ç¤ºæ–‡ä»¶å†…å®¹ ç¤ºä¾‹ï¼šhadoop fs -cat /hello.txt -tail åŠŸèƒ½ï¼šæ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„æœ«å°¾ ç¤ºä¾‹ï¼šhadoop fs -tail /weblog/access_log.1 -text åŠŸèƒ½ï¼šä»¥å­—ç¬¦å½¢å¼æ‰“å°ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ ç¤ºä¾‹ï¼šhadoop fs -text /weblog/access_log.1 -chgrp , -chmod, -chown åŠŸèƒ½ï¼šlinuxæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç”¨æ³•ä¸€æ ·ï¼Œå¯¹æ–‡ä»¶æ‰€å±æƒé™ ç¤ºä¾‹ï¼š hadoop fs -chmod 666 /hello.txt hadoop fs -chown someuser:somegrp /hello.txt -copyFromLocal åŠŸèƒ½ï¼šä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­æ‹·è´æ–‡ä»¶åˆ°hdfsè·¯å¾„å» ç¤ºä¾‹ï¼šhadoop fs -copyFromLocal ./jdk.tar.gz /aaa/ -copyToLocal åŠŸèƒ½ï¼šä»hdfsæ‹·è´åˆ°æœ¬åœ° ç¤ºä¾‹ï¼šhadoop fs -copyToLocal /aaa/jdk.tar.gz -cp åŠŸèƒ½ï¼šä»hdfsçš„ä¸€ä¸ªè·¯å¾„æ‹·è´hdfsçš„å¦ä¸€ä¸ªè·¯å¾„ ç¤ºä¾‹ï¼šhadoop fs -cp /aaa/jdk.tar.gz /bbb/jdk.tar.gz.2 -mv åŠŸèƒ½ï¼šåœ¨hdfsç›®å½•ä¸­ç§»åŠ¨æ–‡ä»¶ ç¤ºä¾‹ï¼šhadoop fs -mv /aaa/jdk.tar.gz / -get åŠŸèƒ½ï¼šç­‰åŒäºcopyToLocalï¼Œå°±æ˜¯ä»hdfsä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ° ç¤ºä¾‹ï¼šhadoop fs -get /aaa/jdk.tar.gz -getmerge åŠŸèƒ½ï¼šåˆå¹¶ä¸‹è½½å¤šä¸ªæ–‡ä»¶ ç¤ºä¾‹ï¼šæ¯”å¦‚hdfsçš„ç›®å½• /aaa/ä¸‹æœ‰å¤šä¸ªæ–‡ä»¶:log.1, log.2,log.3,â€¦ hadoop fs -getmerge /aaa/log.* ./log.sum -put åŠŸèƒ½ï¼šç­‰åŒäºcopyFromLocal ç¤ºä¾‹ï¼šhadoop fs -put /aaa/jdk.tar.gz /bbb/jdk.tar.gz.2 -rm åŠŸèƒ½ï¼šåˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ ç¤ºä¾‹ï¼šhadoop fs -rm -r /aaa/bbb/ -rmdir åŠŸèƒ½ï¼šåˆ é™¤ç©ºç›®å½• ç¤ºä¾‹ï¼šhadoop fs -rmdir /aaa/bbb/ccc -df åŠŸèƒ½ï¼šç»Ÿè®¡æ–‡ä»¶ç³»ç»Ÿçš„å¯ç”¨ç©ºé—´ä¿¡æ¯* ç¤ºä¾‹ï¼šhadoop fs -df -h / -du åŠŸèƒ½ï¼šç»Ÿè®¡æ–‡ä»¶å¤¹çš„å¤§å°ä¿¡æ¯ ç¤ºä¾‹ï¼šhadoop fs -du -s -h /aaa/* -count åŠŸèƒ½ï¼šç»Ÿè®¡ä¸€ä¸ªæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶èŠ‚ç‚¹æ•°é‡ ç¤ºä¾‹ï¼šhadoop fs -count /aaa/ -setrep åŠŸèƒ½ï¼šè®¾ç½®hdfsä¸­æ–‡ä»¶çš„å‰¯æœ¬æ•°é‡ ç¤ºä¾‹ï¼šhadoop fs -setrep 3 /aaa/jdk.tar.gz java api ä½¿ç”¨å¼•å…¥ä¾èµ–(maven)12345&lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt; &lt;version&gt;2.6.1&lt;/version&gt;&lt;/dependency&gt; window ä¸‹å¼€å‘éœ€è¦æ³¨æ„å»ºè®®åœ¨linuxä¸‹è¿›è¡Œhadoopåº”ç”¨çš„å¼€å‘ï¼Œä¸ä¼šå­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚å¦‚åœ¨windowä¸Šåšå®¢æˆ·ç«¯åº”ç”¨å¼€å‘ï¼Œéœ€è¦è®¾ç½®ä»¥ä¸‹ç¯å¢ƒï¼š Aã€åœ¨windowsçš„æŸä¸ªç›®å½•ä¸‹è§£å‹ä¸€ä¸ªhadoopçš„å®‰è£…åŒ… Bã€å°†å®‰è£…åŒ…ä¸‹çš„libå’Œbinç›®å½•ç”¨å¯¹åº”windowsç‰ˆæœ¬å¹³å°ç¼–è¯‘çš„æœ¬åœ°åº“æ›¿æ¢(ä¸‹è½½åœ°å€: https://github.com/steveloughran/winutils,ä¸‹è½½ä¹‹åç›´æ¥è§£å‹,å°†binç›®å½•é‡Œçš„å†…å®¹ç›´æ¥è¦†ç›–åˆ°hadoopçš„bin ) Cã€åœ¨windowç³»ç»Ÿä¸­é…ç½®HADOOP_HOMEæŒ‡å‘ä½ è§£å‹çš„å®‰è£…åŒ… Dã€åœ¨windowsç³»ç»Ÿçš„pathå˜é‡ä¸­åŠ å…¥hadoopçš„binç›®å½• java å®¢æˆ·ç«¯çš„é…ç½®åœ¨javaä¸­æ“ä½œhdfsï¼Œé¦–å…ˆè¦è·å¾—ä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹ 12Configuration conf = new Configuration() fs = FileSystem.get(new URI("hdfs://master:9000"),conf,"hadoop"); è€Œæˆ‘ä»¬çš„æ“ä½œç›®æ ‡æ˜¯HDFSï¼Œæ‰€ä»¥è·å–åˆ°çš„fså¯¹è±¡åº”è¯¥æ˜¯DistributedFileSystemçš„å®ä¾‹ï¼› getæ–¹æ³•æ˜¯ä»ä½•å¤„åˆ¤æ–­å…·ä½“å®ä¾‹åŒ–é‚£ç§å®¢æˆ·ç«¯ç±»å‘¢ï¼Ÿ â€”ä»confä¸­çš„ä¸€ä¸ªå‚æ•° fs.defaultFSçš„é…ç½®å€¼åˆ¤æ–­ï¼› å¦‚æœæˆ‘ä»¬çš„ä»£ç ä¸­æ²¡æœ‰æŒ‡å®šfs.defaultFSï¼Œå¹¶ä¸”å·¥ç¨‹classpathä¸‹ä¹Ÿæ²¡æœ‰ç»™å®šç›¸åº”çš„é…ç½®ï¼Œconfä¸­çš„é»˜è®¤å€¼å°±æ¥è‡ªäºhadoopçš„jaråŒ…ä¸­çš„core-default.xmlï¼Œé»˜è®¤å€¼ä¸ºï¼š file:///ï¼Œåˆ™è·å–çš„å°†ä¸æ˜¯ä¸€ä¸ªDistributedFileSystemçš„å®ä¾‹ï¼Œè€Œæ˜¯ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„å®¢æˆ·ç«¯å¯¹è±¡ é…ç½®æ–¹æ³• 123conf = new Configuration();conf.set("fs.defaultFS", "hdfs://master:9000"); // æˆ–è€…conf.addResource, ç›´æ¥æ·»åŠ é…ç½®æ–‡ä»¶fs = FileSystem.get(new URI("hdfs://master:9000"),conf,"hadoop"); java å®¢æˆ·ç«¯ HDFSå¢åˆ æ”¹æŸ¥ç¤ºä¾‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148package com.bigdata.utils.hdfs;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.*;import org.junit.Before;import org.junit.Test;import java.net.URI;import java.util.Iterator;import java.util.Map.Entry;/** * * å®¢æˆ·ç«¯å»æ“ä½œhdfsæ—¶ï¼Œæ˜¯æœ‰ä¸€ä¸ªç”¨æˆ·èº«ä»½çš„ * é»˜è®¤æƒ…å†µä¸‹ï¼Œhdfså®¢æˆ·ç«¯apiä¼šä»jvmä¸­è·å–ä¸€ä¸ªå‚æ•°æ¥ä½œä¸ºè‡ªå·±çš„ç”¨æˆ·èº«ä»½ï¼š-DHADOOP_USER_NAME=hadoop * * ä¹Ÿå¯ä»¥åœ¨æ„é€ å®¢æˆ·ç«¯fså¯¹è±¡æ—¶ï¼Œé€šè¿‡å‚æ•°ä¼ é€’è¿›å» * @author * */public class HdfsClientDemo &#123; FileSystem fs = null; Configuration conf = null; @Before public void init() throws Exception&#123; conf = new Configuration();// conf.set("fs.defaultFS", "hdfs://mini1:9000"); conf.set("dfs.replication", "5"); //æ‹¿åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„å®¢æˆ·ç«¯å®ä¾‹å¯¹è±¡ fs = FileSystem.get(conf); //å¯ä»¥ç›´æ¥ä¼ å…¥ uriå’Œç”¨æˆ·èº«ä»½ fs = FileSystem.get(new URI("hdfs://mini1:9000"),conf,"hadoop"); &#125; /** * ä¸Šä¼ æ–‡ä»¶ * @throws Exception */ @Test public void testUpload() throws Exception &#123; fs.copyFromLocalFile(new Path("c:/access.log"), new Path("/access.log.copy")); fs.close(); &#125; /** * ä¸‹è½½æ–‡ä»¶ * @throws Exception */ @Test public void testDownload() throws Exception &#123; fs.copyToLocalFile(new Path("/access.log.copy"), new Path("d:/")); &#125; /** * æ‰“å°å‚æ•° */ @Test public void testConf()&#123; Iterator&lt;Entry&lt;String, String&gt;&gt; it = conf.iterator(); while(it.hasNext())&#123; Entry&lt;String, String&gt; ent = it.next(); System.out.println(ent.getKey() + " : " + ent.getValue()); &#125; &#125; @Test public void testMkdir() throws Exception &#123; boolean mkdirs = fs.mkdirs(new Path("/testmkdir/aaa/bbb")); System.out.println(mkdirs); &#125; @Test public void testDelete() throws Exception &#123; boolean flag = fs.delete(new Path("/testmkdir/aaa"), true); System.out.println(flag); &#125; /** * é€’å½’åˆ—å‡ºæŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰å­æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ * @throws Exception */ @Test public void testLs() throws Exception &#123; RemoteIterator&lt;LocatedFileStatus&gt; listFiles = fs.listFiles(new Path("/"), true); while(listFiles.hasNext())&#123; LocatedFileStatus fileStatus = listFiles.next(); System.out.println("blocksize: " +fileStatus.getBlockSize()); System.out.println("owner: " +fileStatus.getOwner()); System.out.println("Replication: " +fileStatus.getReplication()); System.out.println("Permission: " +fileStatus.getPermission()); System.out.println("Name: " +fileStatus.getPath().getName()); System.out.println("------------------"); BlockLocation[] blockLocations = fileStatus.getBlockLocations(); for(BlockLocation b:blockLocations)&#123; System.out.println("å—èµ·å§‹åç§»é‡: " +b.getOffset()); System.out.println("å—é•¿åº¦:" + b.getLength()); //å—æ‰€åœ¨çš„datanodeèŠ‚ç‚¹ String[] datanodes = b.getHosts(); for(String dn:datanodes)&#123; System.out.println("datanode:" + dn); &#125; &#125; &#125; &#125; @Test public void testLs2() throws Exception &#123; FileStatus[] listStatus = fs.listStatus(new Path("/")); for(FileStatus file :listStatus)&#123; System.out.println("name: " + file.getPath().getName()); System.out.println((file.isFile()?"file":"directory")); &#125; &#125; public static void main(String[] args) throws Exception &#123; Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://mini1:9000"); //æ‹¿åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„å®¢æˆ·ç«¯å®ä¾‹å¯¹è±¡ FileSystem fs = FileSystem.get(conf); fs.copyFromLocalFile(new Path("c:/access.log"), new Path("/access.log.copy")); fs.close(); &#125;&#125; java å®¢æˆ·ç«¯ HDFSé€šè¿‡æµçš„æ–¹å¼ä¸Šä¼ ä¸‹è½½æ–‡ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091package com.bigdata.utils.hdfs;import org.apache.commons.io.IOUtils;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FSDataInputStream;import org.apache.hadoop.fs.FSDataOutputStream;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.junit.Before;import org.junit.Test;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.IOException;import java.net.URI;/** * ç”¨æµçš„æ–¹å¼æ¥æ“ä½œhdfsä¸Šçš„æ–‡ä»¶ * å¯ä»¥å®ç°è¯»å–æŒ‡å®šåç§»é‡èŒƒå›´çš„æ•°æ® * @author * */public class HdfsStreamAccess &#123; FileSystem fs = null; Configuration conf = null; @Before public void init() throws Exception&#123; conf = new Configuration(); //æ‹¿åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„å®¢æˆ·ç«¯å®ä¾‹å¯¹è±¡// fs = FileSystem.get(conf); //å¯ä»¥ç›´æ¥ä¼ å…¥ uriå’Œç”¨æˆ·èº«ä»½ fs = FileSystem.get(new URI("hdfs://mini1:9000"),conf,"hadoop"); &#125; /** * é€šè¿‡æµçš„æ–¹å¼ä¸Šä¼ æ–‡ä»¶åˆ°hdfs * @throws Exception */ @Test public void testUpload() throws Exception &#123; FSDataOutputStream outputStream = fs.create(new Path("/angelababy.love"), true); FileInputStream inputStream = new FileInputStream("c:/angelababy.love"); IOUtils.copy(inputStream, outputStream); &#125; @Test public void testDownLoad() throws Exception &#123; FSDataInputStream inputStream = fs.open(new Path("/angelababy.love")); FileOutputStream outputStream = new FileOutputStream("d:/angelababy.love"); IOUtils.copy(inputStream, outputStream); &#125; @Test public void testRandomAccess() throws Exception&#123; FSDataInputStream inputStream = fs.open(new Path("/angelababy.love")); inputStream.seek(12); FileOutputStream outputStream = new FileOutputStream("d:/angelababy.love.part2"); IOUtils.copy(inputStream, outputStream); &#125; /** * æ˜¾ç¤ºhdfsä¸Šæ–‡ä»¶çš„å†…å®¹ * @throws IOException * @throws IllegalArgumentException */ @Test public void testCat() throws IllegalArgumentException, IOException&#123; FSDataInputStream in = fs.open(new Path("/angelababy.love")); IOUtils.copy(in, System.out); &#125;&#125; Javaå®¢æˆ·ç«¯è·å–æ–‡ä»¶blockä¿¡æ¯å¹¶è¯»å–æŒ‡å®šblockå†…å®¹1234567891011121314151617181920212223242526272829@Test public void testCat() throws IllegalArgumentException, IOException&#123; FSDataInputStream in = fs.open(new Path("/weblog/input/access.log.10")); //æ‹¿åˆ°æ–‡ä»¶ä¿¡æ¯ FileStatus[] listStatus = fs.listStatus(new Path("/weblog/input/access.log.10")); //è·å–è¿™ä¸ªæ–‡ä»¶çš„æ‰€æœ‰blockçš„ä¿¡æ¯ BlockLocation[] fileBlockLocations = fs.getFileBlockLocations(listStatus[0], 0L, listStatus[0].getLen()); //ç¬¬ä¸€ä¸ªblockçš„é•¿åº¦ long length = fileBlockLocations[0].getLength(); //ç¬¬ä¸€ä¸ªblockçš„èµ·å§‹åç§»é‡ long offset = fileBlockLocations[0].getOffset(); System.out.println(length); System.out.println(offset); //è·å–ç¬¬ä¸€ä¸ªblockå†™å…¥è¾“å‡ºæµ// IOUtils.copyBytes(in, System.out, (int)length); byte[] b = new byte[4096]; FileOutputStream os = new FileOutputStream(new File("d:/block0")); while(in.read(offset, b, 0, 4096)!=-1)&#123; os.write(b); offset += 4096; if(offset&gt;=length) return; &#125;; os.flush(); os.close(); in.close(); &#125;]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>HADOOP</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>HADOOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hadoop ç¼–è¯‘]]></title>
    <url>%2F2019%2F12%2F29%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FHADOOP%2Fhadoop%E7%BC%96%E8%AF%91%2F</url>
    <content type="text"><![CDATA[ç¼–è¯‘hadoopæ­¥éª¤ä¸‹è½½ä¾èµ– ä¸‹è½½ç¼–è¯‘éœ€è¦çš„è½¯ä»¶åŒ… apache-ant-1.9.4-bin.tar.gz findbugs-3.0.0.tar.gz protobuf-2.5.0.tar.gz apache-maven-3.0.5-bin.tar.gz ä¸‹è½½å¹¶è§£å‹ç¼©hadoopæºç åŒ… 1 tar -zxvf hadoop-2.4.0-src.tar.gz å®‰è£…å„ä¾èµ–è½¯ä»¶ å®‰è£…maven 1234tar -zxvf apache-maven-3.0.5-bin.tar.gz -C /opt/vi /etc/profile# å¢åŠ mavençš„binç›®å½•åˆ°pathsource /etc/profile å®‰è£…ant 1234tar -zxvf apache-ant-1.9.4-bin.tar.gz -C /opt/vi /etc/profile# å¢åŠ ant çš„binç›®å½•åˆ°pathsource /etc/profile å®‰è£…findbugs 1234tar -zxvf findbugs-3.0.0.tar.gz -C /opt/vi /etc/profile# å¢åŠ findbugs çš„binç›®å½•åˆ°pathsource /etc/profile å®‰è£…protubuf 123456tar -zxvf protobuf-2.5.0.tar.gzcd protobuf-2.5.0./configuremakemake checkmake install å®‰è£…linuxä¾èµ– 1yum install -y cmake openssl-devel ncurses-devel ç¼–è¯‘hadoop 123cd hadoop-2.4.0-srcmvn clean install -DskipTestsmvn package -Pdist,native -DskipTests -Dtar # ç­‰å¾…ç¼–è¯‘å®Œæˆ ç¼–è¯‘æˆåŠŸçš„æ–‡ä»¶åœ¨ï¼š /hadoop-2.4.0-src/hadoop-dist/target/]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>HADOOP</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>HADOOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hadoop ä»‹ç»ã€å®‰è£…]]></title>
    <url>%2F2019%2F12%2F29%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2FHADOOP%2Fhadoop%E4%BB%8B%E7%BB%8D%E3%80%81%E5%AE%89%E8%A3%85%2F</url>
    <content type="text"><![CDATA[hadoop ä»‹ç»ä»€ä¹ˆæ˜¯hadoop HADOOPæ˜¯apacheæ——ä¸‹çš„ä¸€å¥—å¼€æºè½¯ä»¶å¹³å° HADOOPæä¾›çš„åŠŸèƒ½ï¼šåˆ©ç”¨æœåŠ¡å™¨é›†ç¾¤ï¼Œæ ¹æ®ç”¨æˆ·çš„è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œå¯¹æµ·é‡æ•°æ®è¿›è¡Œåˆ†å¸ƒå¼å¤„ç† hadoop çš„æ ¸å¿ƒç»„ä»¶ HDFSï¼ˆåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼‰ YARNï¼ˆè¿ç®—èµ„æºè°ƒåº¦ç³»ç»Ÿï¼‰ MAPREDUCEï¼ˆåˆ†å¸ƒå¼è¿ç®—ç¼–ç¨‹æ¡†æ¶ï¼‰ å¹¿ä¹‰ä¸Šæ¥è¯´ï¼ŒHADOOPé€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªæ›´å¹¿æ³›çš„æ¦‚å¿µâ€”â€”HADOOPç”Ÿæ€åœˆ hadoop çš„äº§ç”ŸèƒŒæ™¯ HADOOPæœ€æ—©èµ·æºäºNutchã€‚Nutchçš„è®¾è®¡ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªå¤§å‹çš„å…¨ç½‘æœç´¢å¼•æ“ï¼ŒåŒ…æ‹¬ç½‘é¡µæŠ“å–ã€ç´¢å¼•ã€æŸ¥è¯¢ç­‰åŠŸèƒ½ï¼Œä½†éšç€æŠ“å–ç½‘é¡µæ•°é‡çš„å¢åŠ ï¼Œé‡åˆ°äº†ä¸¥é‡çš„å¯æ‰©å±•æ€§é—®é¢˜â€”â€”å¦‚ä½•è§£å†³æ•°åäº¿ç½‘é¡µçš„å­˜å‚¨å’Œç´¢å¼•é—®é¢˜ã€‚ 2003å¹´ã€2004å¹´è°·æ­Œå‘è¡¨çš„ä¸¤ç¯‡è®ºæ–‡ä¸ºè¯¥é—®é¢˜æä¾›äº†å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆGFSï¼‰ï¼Œå¯ç”¨äºå¤„ç†æµ·é‡ç½‘é¡µçš„å­˜å‚¨ åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶MAPREDUCE(YARN+MAPREDUCE)ï¼Œå¯ç”¨äºå¤„ç†æµ·é‡ç½‘é¡µçš„ç´¢å¼•è®¡ç®—é—®é¢˜ã€‚ Nutchçš„å¼€å‘äººå‘˜å®Œæˆäº†ç›¸åº”çš„å¼€æºå®ç°HDFSå’ŒMAPREDUCEï¼Œå¹¶ä»Nutchä¸­å‰¥ç¦»æˆä¸ºç‹¬ç«‹é¡¹ç›®HADOOPï¼Œåˆ°2008å¹´1æœˆï¼ŒHADOOPæˆä¸ºApacheé¡¶çº§é¡¹ç›®ï¼Œè¿æ¥äº†å®ƒçš„å¿«é€Ÿå‘å±•æœŸã€‚ hadoopç”Ÿæ€åœˆç»„ä»¶ HDFS: åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ MAPREDUCE: åˆ†å¸ƒå¼è¿ç®—ç¨‹åºå¼€å‘æ¡†æ¶ HIVEï¼š åŸºäºå¤§æ•°æ®æŠ€æœ¯(æ–‡ä»¶ç³»ç»Ÿ/è¿ç®—æ¡†æ¶)çš„SQLæ•°æ®ä»“åº“å·¥å…· HBASEï¼š åŸºäºHADOOPçš„åˆ†å¸ƒå¼æµ·é‡æ•°æ®åº“ ZOOKEEPER: åˆ†å¸ƒå¼åè°ƒæœåŠ¡åŸºç¡€ç»„ä»¶ Mahout: åŸºäºmapreduce/spark/flink ç­‰åˆ†å¸ƒå¼è¿ç®—æ¡†æ¶çš„æœºå™¨å­¦ä¹ ç®—æ³•åº“ Oozie: å·¥ä½œæµè°ƒåº¦æ¡†æ¶ Sqoopï¼šæ•°æ®å¯¼å…¥å¯¼å‡ºå·¥å…· Flumeï¼š æ—¥å¿—æ•°æ®é‡‡é›†æ¡†æ¶ ç¦»çº¿å¤§æ•°æ®åˆ†ææµç¨‹ä»‹ç»æµç¨‹å›¾åˆ†æ 1) æ•°æ®é‡‡é›†ï¼šå®šåˆ¶å¼€å‘é‡‡é›†ç¨‹åºï¼Œæˆ–ä½¿ç”¨å¼€æºæ¡†æ¶FLUME 2) æ•°æ®é¢„å¤„ç†ï¼šå®šåˆ¶å¼€å‘mapreduceç¨‹åºè¿è¡Œäºhadoopé›†ç¾¤ 3) æ•°æ®ä»“åº“æŠ€æœ¯ï¼šåŸºäºhadoopä¹‹ä¸Šçš„Hive 4) æ•°æ®å¯¼å‡ºï¼šåŸºäºhadoopçš„sqoopæ•°æ®å¯¼å…¥å¯¼å‡ºå·¥å…· 5) æ•°æ®å¯è§†åŒ–ï¼šå®šåˆ¶å¼€å‘webç¨‹åºæˆ–ä½¿ç”¨kettleç­‰äº§å“ 6) æ•´ä¸ªè¿‡ç¨‹çš„æµç¨‹è°ƒåº¦ï¼šhadoopç”Ÿæ€åœˆä¸­çš„oozieå·¥å…·æˆ–å…¶ä»–ç±»ä¼¼å¼€æºäº§å“ é¡¹ç›®æŠ€æœ¯æ¶æ„å›¾ æ¨èç³»ç»Ÿæ¶æ„ç¤ºä¾‹ hadoopé›†ç¾¤æ­å»ºé›†ç¾¤ç®€ä»‹HADOOPé›†ç¾¤å…·ä½“æ¥è¯´åŒ…å«ä¸¤ä¸ªé›†ç¾¤ï¼šHDFSé›†ç¾¤å’ŒYARNé›†ç¾¤ï¼Œä¸¤è€…é€»è¾‘ä¸Šåˆ†ç¦»ï¼Œä½†ç‰©ç†ä¸Šå¸¸åœ¨ä¸€èµ·ï¼Œå› ä¸ºYARNéœ€è¦åˆ†é…èµ„æºå¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥æœ€å¥½çš„æ–¹å¼ä¹Ÿæ˜¯å°†YARNå’ŒHDFSä¿æŒç‰©ç†åœ°å€ç»Ÿä¸€ HDFSé›†ç¾¤ï¼š è´Ÿè´£æµ·é‡æ•°æ®çš„å­˜å‚¨ï¼Œé›†ç¾¤ä¸­çš„è§’è‰²ä¸»è¦æœ‰ NameNode / DataNode YARNé›†ç¾¤ï¼š è´Ÿè´£æµ·é‡æ•°æ®è¿ç®—æ—¶çš„èµ„æºè°ƒåº¦ï¼Œé›†ç¾¤ä¸­çš„è§’è‰²ä¸»è¦æœ‰ ResourceManager /NodeManager maprediceï¼š å®ƒå…¶å®æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºå¼€å‘åŒ…) æ¥ä¸‹æ¥çš„é›†ç¾¤ç¤ºä¾‹ï¼Œä»¥3èŠ‚ç‚¹ä¸ºä¾‹è¿›è¡Œæ­å»º: hosts æ–‡ä»¶ç¤ºä¾‹ 123hdp-node-01 NameNode SecondaryNameNodehdp-node-02 ResourceManager hdp-node-03 DataNode NodeManager ç¯å¢ƒå‡†å¤‡æœåŠ¡å™¨ Centos 6.5 64bit ç½‘ç»œ ç½‘ç»œç¯å¢ƒéœ€è¦äº’é€š åŒæ­¥æ—¶é—´ è®¾ç½®æ—¶é—´åŒæ­¥æœåŠ¡å™¨ntp æˆ–è€…æœºå™¨ä¹‹é—´åŒæ­¥æ‰§è¡Œ date -s â€œ2019-06-06 00:00:00â€ æœåŠ¡å™¨ç³»ç»Ÿè®¾ç½® æ·»åŠ hadoopç”¨æˆ·, å¹¶ç»™sudoæƒé™ 1234useradd hadooppasswd hadoopvi /etc/sudoers # æ·»åŠ  hadoop ALL=(ALL) ALL è®¾ç½®ä¸»æœºå 123hdp-node-01hdp-node-02hdp-node-03 é…ç½®åŸŸåæ˜ å°„, ä¿®æ”¹hostæ–‡ä»¶ 123192.168.33.101 hdp-node-01192.168.33.102 hdp-node-02192.168.33.103 hdp-node-03 é…ç½®sshå…å¯†ç™»å½• 1234ssh-keygenssh-copy-id hdp-node-01ssh-copy-id hdp-node-02ssh-copy-id hdp-node-03 å…³é—­é˜²ç«å¢™ 12systemctl stop firewalldsystemctl disable firewalld jdkå®‰è£… ä¸Šä¼ jdkå®‰è£…åŒ… è§„åˆ’å®‰è£…ç›®å½• /home/hadoop/apps/jdk_1.7.65 è§£å‹å®‰è£…åŒ… é…ç½®ç¯å¢ƒå˜é‡ /etc/profileï¼Œ æ·»åŠ  1234export JAVA_HOME=/usr/local/java/jdk1.8.0_141export JRE_HOME=$&#123;JAVA_HOME&#125;/jre export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH hadoopé›†ç¾¤å®‰è£… ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹ ä¸Šä¼ hadoopå®‰è£…åŒ…, å¹¶è§£å‹åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ç›®å½•ï¼ˆè¯¥å®‰è£…åŒ…é€šè¿‡ç¼–è¯‘ç”Ÿæˆï¼Œç¼–è¯‘æ–¹æ³•å‚è€ƒhadoopç¼–è¯‘ï¼‰ 1tar -xzvf hadoop-2.6.1.tar.gz -C /home/hadoop/apps ä¿®æ”¹é…ç½®æ–‡ä»¶ etc/hadoop/hadoop-env.sh hadoop ç¯å¢ƒå˜é‡é…ç½® ä¿®æ”¹JAVA_HOME çš„ä½ç½®, å¦‚æœä¸é€šè¿‡sshè¿æ¥æ‰§è¡Œhadoopå‘½ä»¤å¯ä»¥ä¸æ”¹ 12# The java implementation to use.export JAVA_HOME=/home/hadoop/apps/jdk1.7.0_51 core-site.xml hadoopåŸºç¡€é…ç½® é…ç½®ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿï¼Œå’ŒnameNodeçš„åœ°å€ï¼Œè¿˜æœ‰hadoopçš„ç³»ç»Ÿæ•°æ®ç›®å½• 12345678910&lt;configuration&gt;&lt;property&gt;&lt;name&gt;fs.defaultFS&lt;/name&gt;&lt;value&gt;hdfs://hdp-node-01:9000&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;&lt;value&gt;/home/HADOOP/apps/hadoop-2.6.1/tmp&lt;/value&gt;&lt;/property&gt;&lt;/configuration&gt; hdfs-site.xml hdfsç›¸å…³é…ç½® é…ç½®hdfsçš„æ•°æ®ç›®å½•, å‰¯æœ¬æ•°é‡, secondaryNameNode çš„httpåœ°å€ç­‰ 1234567891011121314151617181920&lt;configuration&gt;&lt;property&gt;&lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;&lt;value&gt;/home/hadoop/data/name&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;&lt;value&gt;/home/hadoop/data/data&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;dfs.replication&lt;/name&gt;&lt;value&gt;3&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;dfs.secondary.http.address&lt;/name&gt;&lt;value&gt;hdp-node-01:50090&lt;/value&gt;&lt;/property&gt;&lt;/configuration&gt; mapreduce.framework.name mapreduceè®¡ç®—æ¡†æ¶ç›¸å…³é…ç½® é…ç½®ä½¿ç”¨çš„èµ„æºè°ƒåº¦å·¥å…·é…ç½®ç­‰ 123456&lt;configuration&gt;&lt;property&gt;&lt;name&gt;mapreduce.framework.name&lt;/name&gt;&lt;value&gt;yarn&lt;/value&gt;&lt;/property&gt;&lt;/configuration&gt; yarn-site.xml yarnèµ„æºè°ƒåº¦å™¨ç›¸å…³é…ç½® é…ç½®yarnçš„resource Managerå’ŒnodeManager 1234567891011&lt;configuration&gt;&lt;property&gt;&lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;&lt;value&gt;hadoop01&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;&lt;value&gt;mapreduce_shuffle&lt;/value&gt;&lt;/property&gt;&lt;/configuration&gt; slaves é›†ç¾¤é…ç½®æ–‡ä»¶ 123hdp-node-01hdp-node-02hdp-node-03 å¯åŠ¨é›†ç¾¤ æ ¼å¼åŒ–hdfs æ ¼å¼åŒ–çš„ä½œç”¨æ˜¯åˆå§‹åŒ–namenode çš„å·¥ä½œç›®å½• 1bin/hadoop namenode -format â€‹ å¯åŠ¨HDFSå’ŒYARN â€‹ ç¬¬ä¸€ç§æ–¹æ³•: hadoop-daemon å¯åŠ¨ â€‹ æ¯æ¬¡åªä¼šå¯åŠ¨ä¸€ä¸ªç»„ä»¶ï¼Œä¸è‡ªåŠ¨åŒ–ï¼Œæ¯”è¾ƒéº»çƒ¦ 12345sbin/hadoop-daemon.sh start namenode # åœ¨namenodeæ‰§è¡Œsbin/hadoop-daemon.sh start datanode # åœ¨datanodeæ‰§è¡Œsbin/hadoop-daemon.sh start secondarynamenode # å¯åŠ¨secondarynamenodesbin/yarn-daemon.sh start resourcemanager # åœ¨resourcemanagerèŠ‚ç‚¹å¯åŠ¨sbin/yarn-daemon.sh start nodemanager # åœ¨nodemanagerèŠ‚ç‚¹å¯åŠ¨ â€‹ ç¬¬äºŒç§æ–¹æ³•: start-dfs / start-yarn å¯åŠ¨ 12sbin/start-dfs.sh # ä¼šæŠŠdfsé›†ç¾¤éƒ½å¯åŠ¨èµ·æ¥sbin/start-yarn.sh # ç›´æ¥æŠŠyarné›†ç¾¤éƒ½å¯åŠ¨èµ·æ¥ â€‹ ç¬¬ä¸‰ç§æ–¹æ³•: start-all å¯åŠ¨ 1sbin/start-all.sh # ç›´æ¥æŠŠdfs å’Œyarn é›†ç¾¤éƒ½å¯åŠ¨èµ·æ¥ HDFS é›†ç¾¤çŠ¶æ€æŸ¥è¯¢ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ å‘½ä»¤ 1hdfs dfsadmin â€“report ç¤ºä¾‹ â€‹ å¯ä»¥çœ‹å‡ºï¼Œé›†ç¾¤å…±æœ‰3ä¸ªdatanodeå¯ç”¨ ä¹Ÿå¯æ‰“å¼€webæ§åˆ¶å°æŸ¥çœ‹HDFSé›†ç¾¤ä¿¡æ¯ åœ¨æµè§ˆå™¨æ‰“å¼€http://hdp-node-01:50070/ ç¤ºä¾‹]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>HADOOP</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>HADOOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[java rpc å¼€å‘]]></title>
    <url>%2F2019%2F12%2F25%2F14.Java%2FJava%E5%9F%BA%E7%A1%80%2Fjava%20rpc%20%E5%BC%80%E5%8F%91%2F</url>
    <content type="text"><![CDATA[RPCåŸç†å­¦ä¹ ä»€ä¹ˆæ˜¯RPCRPCï¼ˆRemote Procedure Call Protocolï¼‰â€”â€”è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®ï¼Œå®ƒæ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„åè®®ã€‚RPCåè®®å‡å®šæŸäº›ä¼ è¾“åè®®çš„å­˜åœ¨ï¼Œå¦‚TCPæˆ–UDPï¼Œä¸ºé€šä¿¡ç¨‹åºä¹‹é—´æºå¸¦ä¿¡æ¯æ•°æ®ã€‚åœ¨OSIç½‘ç»œé€šä¿¡æ¨¡å‹ä¸­ï¼ŒRPCè·¨è¶Šäº†ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ã€‚RPCä½¿å¾—å¼€å‘åŒ…æ‹¬ç½‘ç»œåˆ†å¸ƒå¼å¤šç¨‹åºåœ¨å†…çš„åº”ç”¨ç¨‹åºæ›´åŠ å®¹æ˜“ã€‚ RPCé‡‡ç”¨å®¢æˆ·æœº/æœåŠ¡å™¨æ¨¡å¼ã€‚è¯·æ±‚ç¨‹åºå°±æ˜¯ä¸€ä¸ªå®¢æˆ·æœºï¼Œè€ŒæœåŠ¡æä¾›ç¨‹åºå°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ã€‚é¦–å…ˆï¼Œå®¢æˆ·æœºè°ƒç”¨è¿›ç¨‹å‘é€ä¸€ä¸ªæœ‰è¿›ç¨‹å‚æ•°çš„è°ƒç”¨ä¿¡æ¯åˆ°æœåŠ¡è¿›ç¨‹ï¼Œç„¶åç­‰å¾…åº”ç­”ä¿¡æ¯ã€‚åœ¨æœåŠ¡å™¨ç«¯ï¼Œè¿›ç¨‹ä¿æŒç¡çœ çŠ¶æ€ç›´åˆ°è°ƒç”¨ä¿¡æ¯åˆ°è¾¾ä¸ºæ­¢ã€‚å½“ä¸€ä¸ªè°ƒç”¨ä¿¡æ¯åˆ°è¾¾ï¼ŒæœåŠ¡å™¨è·å¾—è¿›ç¨‹å‚æ•°ï¼Œè®¡ç®—ç»“æœï¼Œå‘é€ç­”å¤ä¿¡æ¯ï¼Œç„¶åç­‰å¾…ä¸‹ä¸€ä¸ªè°ƒç”¨ä¿¡æ¯ï¼Œæœ€åï¼Œå®¢æˆ·ç«¯è°ƒç”¨è¿›ç¨‹æ¥æ”¶ç­”å¤ä¿¡æ¯ï¼Œè·å¾—è¿›ç¨‹ç»“æœï¼Œç„¶åè°ƒç”¨æ‰§è¡Œç»§ç»­è¿›è¡Œã€‚ RPCåŸç† è¿è¡Œæ—¶,ä¸€æ¬¡å®¢æˆ·æœºå¯¹æœåŠ¡å™¨çš„RPCè°ƒç”¨,å…¶å†…éƒ¨æ“ä½œå¤§è‡´æœ‰å¦‚ä¸‹åæ­¥ï¼š è°ƒç”¨å®¢æˆ·ç«¯å¥æŸ„ï¼›æ‰§è¡Œä¼ é€å‚æ•° è°ƒç”¨æœ¬åœ°ç³»ç»Ÿå†…æ ¸å‘é€ç½‘ç»œæ¶ˆæ¯ æ¶ˆæ¯ä¼ é€åˆ°è¿œç¨‹ä¸»æœº æœåŠ¡å™¨å¥æŸ„å¾—åˆ°æ¶ˆæ¯å¹¶å–å¾—å‚æ•° æ‰§è¡Œè¿œç¨‹è¿‡ç¨‹ æ‰§è¡Œçš„è¿‡ç¨‹å°†ç»“æœè¿”å›æœåŠ¡å™¨å¥æŸ„ æœåŠ¡å™¨å¥æŸ„è¿”å›ç»“æœï¼Œè°ƒç”¨è¿œç¨‹ç³»ç»Ÿå†…æ ¸ æ¶ˆæ¯ä¼ å›æœ¬åœ°ä¸»æœº å®¢æˆ·å¥æŸ„ç”±å†…æ ¸æ¥æ”¶æ¶ˆæ¯ å®¢æˆ·æ¥æ”¶å¥æŸ„è¿”å›çš„æ•°æ® NIO ä»‹ç»ç®€ä»‹nio æ˜¯New IO çš„ç®€ç§°(åŒæ­¥éé˜»å¡io)ï¼Œåœ¨jdk1.4 é‡Œæä¾›çš„æ–°api ã€‚ Sun å®˜æ–¹æ ‡æ¦œçš„ç‰¹æ€§å¦‚ä¸‹ï¼š ä¸ºæ‰€æœ‰çš„åŸå§‹ç±»å‹æä¾›(Buffer)ç¼“å­˜æ”¯æŒã€‚ å­—ç¬¦é›†ç¼–ç è§£ç è§£å†³æ–¹æ¡ˆã€‚ Channel ï¼šä¸€ä¸ªæ–°çš„åŸå§‹I/O æŠ½è±¡ã€‚ æ”¯æŒé”å’Œå†…å­˜æ˜ å°„æ–‡ä»¶çš„æ–‡ä»¶è®¿é—®æ¥å£ã€‚ æä¾›å¤šè·¯(non-bloking) éé˜»å¡å¼çš„é«˜ä¼¸ç¼©æ€§ç½‘ç»œI/O ä¼ ç»ŸioåŸç† ä¼ ç»Ÿçš„I/O ä½¿ç”¨å®ä¾‹ ä½¿ç”¨ä¼ ç»Ÿçš„I/Oç¨‹åºè¯»å–æ–‡ä»¶å†…å®¹, å¹¶å†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶(æˆ–Socket), å¦‚ä¸‹ç¨‹åº: 123File.read(fileDesc, buf, len);Socket.send(socket, buf, len); ä¼šæœ‰è¾ƒå¤§çš„æ€§èƒ½å¼€é”€, ä¸»è¦è¡¨ç°åœ¨ä¸€ä¸‹ä¸¤æ–¹é¢: ä¸Šä¸‹æ–‡åˆ‡æ¢(context switch), æ­¤å¤„æœ‰4æ¬¡ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ Bufferå†…å­˜å¼€é”€, ä¸€ä¸ªæ˜¯åº”ç”¨ç¨‹åºbuffer, å¦ä¸€ä¸ªæ˜¯ç³»ç»Ÿè¯»å–bufferä»¥åŠsocket buffer å…¶è¿è¡Œç¤ºæ„å›¾å¦‚ä¸‹ ä¼ ç»Ÿio bufferæ“ä½œæ­¥éª¤ 1) å…ˆå°†æ–‡ä»¶å†…å®¹ä»ç£ç›˜ä¸­æ‹·è´åˆ°æ“ä½œç³»ç»Ÿbuffer 2) å†ä»æ“ä½œç³»ç»Ÿbufferæ‹·è´åˆ°ç¨‹åºåº”ç”¨buffer 3) ä»ç¨‹åºbufferæ‹·è´åˆ°socket buffer 4) ä»socket bufferæ‹·è´åˆ°åè®®å¼•æ“. NIO åŸç†nio æœºåˆ¶ä»‹ç» NIOæŠ€æœ¯çœå»äº†å°†æ“ä½œç³»ç»Ÿçš„read bufferæ‹·è´åˆ°ç¨‹åºçš„buffer, ä»¥åŠä»ç¨‹åºbufferæ‹·è´åˆ°socket bufferçš„æ­¥éª¤, ç›´æ¥å°† read buffer æ‹·è´åˆ° socket buffer. java çš„ FileChannel.transferTo() æ–¹æ³•å°±æ˜¯è¿™æ ·çš„å®ç°, è¿™ä¸ªå®ç°æ˜¯ä¾èµ–äºæ“ä½œç³»ç»Ÿåº•å±‚çš„sendFile()å®ç°çš„. publicvoid transferTo(long position, long count, WritableByteChannel target); ä»–çš„åº•å±‚è°ƒç”¨çš„æ˜¯ç³»ç»Ÿè°ƒç”¨sendFile()æ–¹æ³• sendfile(int out_fd, int in_fd, off_t *offset, size_t count); è¿è¡Œç¤ºæ„å›¾ nettyå¸¸ç”¨APIå­¦ä¹ nettyç®€ä»‹â€‹ Nettyæ˜¯åŸºäºJava NIOçš„ç½‘ç»œåº”ç”¨æ¡†æ¶. â€‹ Nettyæ˜¯ä¸€ä¸ªNIO client-server(å®¢æˆ·ç«¯æœåŠ¡å™¨)æ¡†æ¶ï¼Œä½¿ç”¨Nettyå¯ä»¥å¿«é€Ÿå¼€å‘ç½‘ç»œåº”ç”¨ï¼Œä¾‹å¦‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åè®®ã€‚Nettyæä¾›äº†ä¸€ç§æ–°çš„æ–¹å¼æ¥ä½¿å¼€å‘ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œè¿™ç§æ–°çš„æ–¹å¼ä½¿å¾—å®ƒå¾ˆå®¹æ˜“ä½¿ç”¨å’Œæœ‰å¾ˆå¼ºçš„æ‰©å±•æ€§ã€‚Nettyçš„å†…éƒ¨å®ç°æ—¶å¾ˆå¤æ‚çš„ï¼Œä½†æ˜¯Nettyæä¾›äº†ç®€å•æ˜“ç”¨çš„apiä»ç½‘ç»œå¤„ç†ä»£ç ä¸­è§£è€¦ä¸šåŠ¡é€»è¾‘ã€‚Nettyæ˜¯å®Œå…¨åŸºäºNIOå®ç°çš„ï¼Œæ‰€ä»¥æ•´ä¸ªNettyéƒ½æ˜¯å¼‚æ­¥çš„ã€‚ â€‹ ç½‘ç»œåº”ç”¨ç¨‹åºé€šå¸¸éœ€è¦æœ‰è¾ƒé«˜çš„å¯æ‰©å±•æ€§ï¼Œæ— è®ºæ˜¯Nettyè¿˜æ˜¯å…¶ä»–çš„åŸºäºJava NIOçš„æ¡†æ¶ï¼Œéƒ½ä¼šæä¾›å¯æ‰©å±•æ€§çš„è§£å†³æ–¹æ¡ˆã€‚Nettyä¸­ä¸€ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†æ˜¯å®ƒçš„å¼‚æ­¥ç‰¹æ€§. nettyä½¿ç”¨ ä¸‹è½½nettyåŒ… ä¸‹è½½nettyåŒ…ï¼Œä¸‹è½½åœ°å€http://netty.io/ æœåŠ¡ç«¯å¯åŠ¨ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.Channel;import io.netty.channel.ChannelFuture;import io.netty.channel.ChannelInitializer;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.nio.NioServerSocketChannel;/** * â€¢ é…ç½®æœåŠ¡å™¨åŠŸèƒ½ï¼Œå¦‚çº¿ç¨‹ã€ç«¯å£ â€¢ å®ç°æœåŠ¡å™¨å¤„ç†ç¨‹åºï¼Œå®ƒåŒ…å«ä¸šåŠ¡é€»è¾‘ï¼Œå†³å®šå½“æœ‰ä¸€ä¸ªè¯·æ±‚è¿æ¥æˆ–æ¥æ”¶æ•°æ®æ—¶è¯¥åšä»€ä¹ˆ * * @author wilson * */public class EchoServer &#123; private final int port; public EchoServer(int port) &#123; this.port = port; &#125; public void start() throws Exception &#123; EventLoopGroup eventLoopGroup = null; try &#123; //åˆ›å»ºServerBootstrapå®ä¾‹æ¥å¼•å¯¼ç»‘å®šå’Œå¯åŠ¨æœåŠ¡å™¨ ServerBootstrap serverBootstrap = new ServerBootstrap(); //åˆ›å»ºNioEventLoopGroupå¯¹è±¡æ¥å¤„ç†äº‹ä»¶ï¼Œå¦‚æ¥å—æ–°è¿æ¥ã€æ¥æ”¶æ•°æ®ã€å†™æ•°æ®ç­‰ç­‰ eventLoopGroup = new NioEventLoopGroup(); //æŒ‡å®šé€šé“ç±»å‹ä¸ºNioServerSocketChannelï¼Œè®¾ç½®InetSocketAddressè®©æœåŠ¡å™¨ç›‘å¬æŸä¸ªç«¯å£å·²ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚ serverBootstrap.group(eventLoopGroup).channel(NioServerSocketChannel.class).localAddress("localhost",port).childHandler(new ChannelInitializer&lt;Channel&gt;() &#123; //è®¾ç½®childHandleræ‰§è¡Œæ‰€æœ‰çš„è¿æ¥è¯·æ±‚ @Override protected void initChannel(Channel ch) throws Exception &#123; ch.pipeline().addLast(new EchoServerHandler()); &#125; &#125;); // æœ€åç»‘å®šæœåŠ¡å™¨ç­‰å¾…ç›´åˆ°ç»‘å®šå®Œæˆï¼Œè°ƒç”¨sync()æ–¹æ³•ä¼šé˜»å¡ç›´åˆ°æœåŠ¡å™¨å®Œæˆç»‘å®š,ç„¶åæœåŠ¡å™¨ç­‰å¾…é€šé“å…³é—­ï¼Œå› ä¸ºä½¿ç”¨sync()ï¼Œæ‰€ä»¥å…³é—­æ“ä½œä¹Ÿä¼šè¢«é˜»å¡ã€‚ ChannelFuture channelFuture = serverBootstrap.bind().sync(); System.out.println("å¼€å§‹ç›‘å¬ï¼Œç«¯å£ä¸ºï¼š" + channelFuture.channel().localAddress()); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; eventLoopGroup.shutdownGracefully().sync(); &#125; &#125; public static void main(String[] args) throws Exception &#123; new EchoServer(20000).start(); &#125;&#125; æœåŠ¡ç«¯å›è°ƒæ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelFutureListener;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.ChannelInboundHandlerAdapter;import java.util.Date;public class EchoServerHandler extends ChannelInboundHandlerAdapter &#123; @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123; System.out.println("server è¯»å–æ•°æ®â€¦â€¦"); //è¯»å–æ•°æ® ByteBuf buf = (ByteBuf) msg; byte[] req = new byte[buf.readableBytes()]; buf.readBytes(req); String body = new String(req, "UTF-8"); System.out.println("æ¥æ”¶å®¢æˆ·ç«¯æ•°æ®:" + body); //å‘å®¢æˆ·ç«¯å†™æ•°æ® System.out.println("serverå‘clientå‘é€æ•°æ®"); String currentTime = new Date(System.currentTimeMillis()).toString(); ByteBuf resp = Unpooled.copiedBuffer(currentTime.getBytes()); ctx.write(resp); &#125; @Override public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123; System.out.println("server è¯»å–æ•°æ®å®Œæ¯•.."); ctx.flush();//åˆ·æ–°åæ‰å°†æ•°æ®å‘å‡ºåˆ°SocketChannel &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; å®¢æˆ·ç«¯å¯åŠ¨ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556import io.netty.bootstrap.Bootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.ChannelInitializer;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioSocketChannel;import java.net.InetSocketAddress;/** * â€¢ è¿æ¥æœåŠ¡å™¨ â€¢ å†™æ•°æ®åˆ°æœåŠ¡å™¨ â€¢ ç­‰å¾…æ¥å—æœåŠ¡å™¨è¿”å›ç›¸åŒçš„æ•°æ® â€¢ å…³é—­è¿æ¥ * * @author wilson * */public class EchoClient &#123; private final String host; private final int port; public EchoClient(String host, int port) &#123; this.host = host; this.port = port; &#125; public void start() throws Exception &#123; EventLoopGroup nioEventLoopGroup = null; try &#123; //åˆ›å»ºBootstrapå¯¹è±¡ç”¨æ¥å¼•å¯¼å¯åŠ¨å®¢æˆ·ç«¯ Bootstrap bootstrap = new Bootstrap(); //åˆ›å»ºEventLoopGroupå¯¹è±¡å¹¶è®¾ç½®åˆ°Bootstrapä¸­ï¼ŒEventLoopGroupå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè¿™ä¸ªçº¿ç¨‹æ± ç”¨æ¥å¤„ç†è¿æ¥ã€æ¥å—æ•°æ®ã€å‘é€æ•°æ® nioEventLoopGroup = new NioEventLoopGroup(); //åˆ›å»ºInetSocketAddresså¹¶è®¾ç½®åˆ°Bootstrapä¸­ï¼ŒInetSocketAddressæ˜¯æŒ‡å®šè¿æ¥çš„æœåŠ¡å™¨åœ°å€ bootstrap.group(nioEventLoopGroup).channel(NioSocketChannel.class).remoteAddress(new InetSocketAddress(host, port)) .handler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; //æ·»åŠ ä¸€ä¸ªChannelHandlerï¼Œå®¢æˆ·ç«¯æˆåŠŸè¿æ¥æœåŠ¡å™¨åå°±ä¼šè¢«æ‰§è¡Œ @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ch.pipeline().addLast(new EchoClientHandler()); &#125; &#125;); // â€¢ è°ƒç”¨Bootstrap.connect()æ¥è¿æ¥æœåŠ¡å™¨ ChannelFuture f = bootstrap.connect().sync(); // â€¢ æœ€åå…³é—­EventLoopGroupæ¥é‡Šæ”¾èµ„æº f.channel().closeFuture().sync(); &#125; finally &#123; nioEventLoopGroup.shutdownGracefully().sync(); &#125; &#125; public static void main(String[] args) throws Exception &#123; new EchoClient("localhost", 20000).start(); &#125;&#125; å®¢æˆ·ç«¯å›è°ƒæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435import io.netty.buffer.ByteBuf;import io.netty.buffer.ByteBufUtil;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler; public class EchoClientHandler extends SimpleChannelInboundHandler&lt;ByteBuf&gt; &#123; //å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨åè¢«è°ƒç”¨ @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; System.out.println("å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œå¼€å§‹å‘é€æ•°æ®â€¦â€¦"); byte[] req = "QUERY TIME ORDER".getBytes(); ByteBuf firstMessage = Unpooled.buffer(req.length); firstMessage.writeBytes(req); ctx.writeAndFlush(firstMessage); &#125; //â€¢ ä»æœåŠ¡å™¨æ¥æ”¶åˆ°æ•°æ®åè°ƒç”¨ @Override protected void channelRead0(ChannelHandlerContext ctx, ByteBuf msg) throws Exception &#123; System.out.println("client è¯»å–serveræ•°æ®.."); //æœåŠ¡ç«¯è¿”å›æ¶ˆæ¯å ByteBuf buf = (ByteBuf) msg; byte[] req = new byte[buf.readableBytes()]; buf.readBytes(req); String body = new String(req, "UTF-8"); System.out.println("æœåŠ¡ç«¯æ•°æ®ä¸º :" + body);&#125; //â€¢ å‘ç”Ÿå¼‚å¸¸æ—¶è¢«è°ƒç”¨ @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; System.out.println("client exceptionCaught.."); // é‡Šæ”¾èµ„æº ctx.close(); &#125; &#125; nettyä¸­handlerçš„æ‰§è¡Œé¡ºåºç®€ä»‹Handleråœ¨nettyä¸­ï¼Œæ— ç–‘å æ®ç€éå¸¸é‡è¦çš„åœ°ä½ã€‚Handlerä¸Servletä¸­çš„filterå¾ˆåƒï¼Œé€šè¿‡Handlerå¯ä»¥å®Œæˆé€šè®¯æŠ¥æ–‡çš„è§£ç ç¼–ç ã€æ‹¦æˆªæŒ‡å®šçš„æŠ¥æ–‡ã€ç»Ÿä¸€å¯¹æ—¥å¿—é”™è¯¯è¿›è¡Œå¤„ç†ã€ç»Ÿä¸€å¯¹è¯·æ±‚è¿›è¡Œè®¡æ•°ã€æ§åˆ¶Handleræ‰§è¡Œä¸å¦ã€‚ä¸€å¥è¯ï¼Œæ²¡æœ‰å®ƒåšä¸åˆ°çš„åªæœ‰ä½ æƒ³ä¸åˆ°çš„ã€‚ Nettyä¸­çš„æ‰€æœ‰handleréƒ½å®ç°è‡ªChannelHandleræ¥å£ã€‚æŒ‰ç…§è¾“å‡ºè¾“å‡ºæ¥åˆ†ï¼Œåˆ†ä¸ºChannelInboundHandlerã€ChannelOutboundHandlerä¸¤å¤§ç±»ã€‚ChannelInboundHandlerå¯¹ä»å®¢æˆ·ç«¯å‘å¾€æœåŠ¡å™¨çš„æŠ¥æ–‡è¿›è¡Œå¤„ç†ï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡Œè§£ç ã€è¯»å–å®¢æˆ·ç«¯æ•°æ®ã€è¿›è¡Œä¸šåŠ¡å¤„ç†ç­‰ï¼›ChannelOutboundHandlerå¯¹ä»æœåŠ¡å™¨å‘å¾€å®¢æˆ·ç«¯çš„æŠ¥æ–‡è¿›è¡Œå¤„ç†ï¼Œä¸€èˆ¬ç”¨æ¥è¿›è¡Œç¼–ç ã€å‘é€æŠ¥æ–‡åˆ°å®¢æˆ·ç«¯ã€‚ Nettyä¸­ï¼Œå¯ä»¥æ³¨å†Œå¤šä¸ªhandlerã€‚ChannelInboundHandleræŒ‰ç…§æ³¨å†Œçš„å…ˆåé¡ºåºæ‰§è¡Œï¼›ChannelOutboundHandleræŒ‰ç…§æ³¨å†Œçš„å…ˆåé¡ºåºé€†åºæ‰§è¡Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæŒ‰ç…§æ³¨å†Œçš„å…ˆåé¡ºåºå¯¹Handlerè¿›è¡Œæ’åºï¼Œrequestè¿›å…¥Nettyåçš„æ‰§è¡Œé¡ºåºä¸ºï¼š æ€»ç»“åœ¨ä½¿ç”¨Handlerçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„ï¼š ChannelInboundHandlerä¹‹é—´çš„ä¼ é€’ï¼Œé€šè¿‡è°ƒç”¨ ctx.fireChannelRead(msg) å®ç°ï¼›è°ƒç”¨ctx.write(msg) å°†ä¼ é€’åˆ°ChannelOutboundHandlerã€‚ ctx.write()æ–¹æ³•æ‰§è¡Œåï¼Œéœ€è¦è°ƒç”¨flush()æ–¹æ³•æ‰èƒ½ä»¤å®ƒç«‹å³æ‰§è¡Œã€‚ æµæ°´çº¿pipelineä¸­outhandlerä¸èƒ½æ”¾åœ¨æœ€åï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ Handlerçš„æ¶ˆè´¹å¤„ç†æ”¾åœ¨æœ€åä¸€ä¸ªå¤„ç†ã€‚ å¦‚ä½•é€šè¿‡nettyå‘é€å¯¹è±¡nettyå‘é€å¯¹è±¡Nettyä¸­ï¼Œé€šè®¯çš„åŒæ–¹å»ºç«‹è¿æ¥åï¼Œä¼šæŠŠæ•°æ®æŒ‰ç…§ByteBufçš„æ–¹å¼è¿›è¡Œä¼ è¾“ï¼Œä¾‹å¦‚httpåè®®ä¸­ï¼Œå°±æ˜¯é€šè¿‡HttpRequestDecoderå¯¹ByteBufæ•°æ®æµè¿›è¡Œå¤„ç†ï¼Œè½¬æ¢æˆhttpçš„å¯¹è±¡ã€‚åŸºäºè¿™ä¸ªæ€è·¯ï¼Œæˆ‘è‡ªå®šä¹‰ä¸€ç§é€šè®¯åè®®ï¼šServerå’Œå®¢æˆ·ç«¯ç›´æ¥ä¼ è¾“javaå¯¹è±¡ã€‚ å®ç°çš„åŸç†æ˜¯é€šè¿‡EncoderæŠŠjavaå¯¹è±¡è½¬æ¢æˆByteBufæµè¿›è¡Œä¼ è¾“ï¼Œé€šè¿‡DecoderæŠŠByteBufè½¬æ¢æˆjavaå¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œå¤„ç†é€»è¾‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Spring(IOC/AOP) æ³¨è§£springçš„åˆå§‹åŒ–é¡ºåºåœ¨springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®beanï¼Œå¦‚ä¸‹ åœ¨Oneç±»å’ŒTwoç±»ä¸­ï¼Œåˆ†åˆ«å®ç°ä¸€ä¸ªå‚æ•°çš„æ„é€ å¦‚ä¸‹ åŠ è½½springé…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–beanå¦‚ä¸‹ é‚£ä¹ˆã€‚ç»“æœå¦‚ä½•å‘¢ï¼Ÿ ç»“è®ºï¼šspringä¼šæŒ‰ç…§beançš„é¡ºåºä¾æ¬¡åˆå§‹åŒ–xmlä¸­é…ç½®çš„æ‰€æœ‰bean é€šè¿‡ApplicationContextAwareåŠ è½½Springä¸Šä¸‹æ–‡ç¯å¢ƒåœ¨Oneä¸­å®ç°ApplicationContextAwareæ¥å£ä¼šå‡ºç°å¦‚ä½•çš„å˜æ¢å‘¢ï¼Ÿ ç»“æœ InitializingBeançš„ä½œç”¨åœ¨Oneä¸­å®ç°InitializingBeanæ¥å£å‘¢? ç»“æœ: å¦‚æœä½¿ç”¨æ³¨è§£@Componentä½¿ç”¨@Componentæ³¨å…¥ç±»ï¼Œé‚£ä¹ˆå®ƒçš„é¡ºåºæ˜¯å¦‚ä½•å‘¢ï¼Ÿ 1ã€ springå…ˆæ£€æŸ¥æ³¨è§£æ³¨å…¥çš„beanï¼Œå¹¶å°†å®ƒä»¬å®ä¾‹åŒ– 2ã€ ç„¶åspringåˆå§‹åŒ–beançš„é¡ºåºæ˜¯æŒ‰ç…§xmlä¸­é…ç½®çš„é¡ºåºä¾æ¬¡æ‰§è¡Œæ„é€  3ã€ å¦‚æœæŸä¸ªç±»å®ç°äº†ApplicationContextAwareæ¥å£ï¼Œä¼šåœ¨ç±»åˆå§‹åŒ–å®Œæˆåè°ƒç”¨setApplicationContextï¼ˆï¼‰æ–¹æ³•è¿›è¡Œæ“ä½œ 4ã€ å¦‚æœæŸä¸ªç±»å®ç°äº†InitializingBeanæ¥å£ï¼Œä¼šåœ¨ç±»åˆå§‹åŒ–å®Œæˆåï¼Œå¹¶åœ¨setApplicationContextï¼ˆï¼‰æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œè°ƒç”¨afterPropertiesSetï¼ˆï¼‰æ–¹æ³•è¿›è¡Œæ“ä½œ æ³¨è§£ä½¿ç”¨å›é¡¾â€‹ 1ã€åœ¨springä¸­ï¼Œç”¨æ³¨è§£æ¥å‘Springå®¹å™¨æ³¨å†ŒBeanã€‚éœ€è¦åœ¨applicationContext.xmlä¸­æ³¨å†Œ&lt;context:component-scan base-package=â€pagkage1[,pagkage2,â€¦,pagkageN]â€/&gt;ã€‚ â€‹ 2ã€å¦‚æœæŸä¸ªç±»çš„å¤´ä¸Šå¸¦æœ‰ç‰¹å®šçš„æ³¨è§£@Component/@Repository/@Service/@Controllerï¼Œå°±ä¼šå°†è¿™ä¸ªå¯¹è±¡ä½œä¸ºBeanæ³¨å†Œè¿›Springå®¹å™¨ â€‹ 3ã€åœ¨ä½¿ç”¨springç®¡ç†çš„beanæ—¶ï¼Œæ— éœ€åœ¨å¯¹è°ƒç”¨çš„å¯¹è±¡è¿›è¡Œnewçš„è¿‡ç¨‹ï¼Œåªéœ€ä½¿ç”¨@Autowiredå°†éœ€è¦çš„beanæ³¨å…¥æœ¬ç±»å³å¯ è‡ªå®šä¹‰æ³¨è§£è§£é‡Š è‡ªå®šä¹‰æ³¨è§£çš„ä½œç”¨ï¼šåœ¨åå°„ä¸­è·å–æ³¨è§£ï¼Œä»¥å–å¾—æ³¨è§£ä¿®é¥°çš„â€œç±»ã€æ–¹æ³•ã€å±æ€§â€çš„ç›¸å…³è§£é‡Šã€‚ javaå†…ç½®æ³¨è§£ â€‹ @Target è¡¨ç¤ºè¯¥æ³¨è§£ç”¨äºä»€ä¹ˆåœ°æ–¹ï¼Œå¯èƒ½çš„ ElemenetType å‚æ•°åŒ…æ‹¬ï¼š â€‹ ElemenetType.CONSTRUCTOR æ„é€ å™¨å£°æ˜ â€‹ ElemenetType.FIELD åŸŸå£°æ˜ï¼ˆåŒ…æ‹¬ enum å®ä¾‹ï¼‰ â€‹ ElemenetType.LOCAL_VARIABLE å±€éƒ¨å˜é‡å£°æ˜ â€‹ ElemenetType.METHOD æ–¹æ³•å£°æ˜ â€‹ ElemenetType.PACKAGE åŒ…å£°æ˜ â€‹ ElemenetType.PARAMETER å‚æ•°å£°æ˜ â€‹ ElemenetType.TYPE ç±»ï¼Œæ¥å£ï¼ˆåŒ…æ‹¬æ³¨è§£ç±»å‹ï¼‰æˆ–enumå£°æ˜ â€‹ @Retention è¡¨ç¤ºåœ¨ä»€ä¹ˆçº§åˆ«ä¿å­˜è¯¥æ³¨è§£ä¿¡æ¯ã€‚å¯é€‰çš„ RetentionPolicy å‚æ•°åŒ…æ‹¬ï¼š â€‹ RetentionPolicy.SOURCE æ³¨è§£å°†è¢«ç¼–è¯‘å™¨ä¸¢å¼ƒ â€‹ RetentionPolicy.CLASS æ³¨è§£åœ¨classæ–‡ä»¶ä¸­å¯ç”¨ï¼Œä½†ä¼šè¢«VMä¸¢å¼ƒ â€‹ RetentionPolicy.RUNTIME JVMå°†åœ¨è¿è¡ŒæœŸä¹Ÿä¿ç•™æ³¨é‡Šï¼Œå› æ­¤å¯ä»¥é€šè¿‡åå°„æœºåˆ¶è¯»å–æ³¨è§£çš„ä¿¡æ¯ã€‚ å®ç° å®šä¹‰è‡ªå®šä¹‰æ³¨è§£ 123456@Target(&#123; ElementType.TYPE &#125;)//æ³¨è§£ç”¨åœ¨æ¥å£ä¸Š@Retention(RetentionPolicy.RUNTIME)//VMå°†åœ¨è¿è¡ŒæœŸä¹Ÿä¿ç•™æ³¨é‡Šï¼Œå› æ­¤å¯ä»¥é€šè¿‡åå°„æœºåˆ¶è¯»å–æ³¨è§£çš„ä¿¡æ¯@Componentpublic @interface RpcService &#123; String value();&#125; å°†ç›´æ¥ç±»åŠ åˆ°éœ€è¦ä½¿ç”¨çš„ç±»ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è·å–æ³¨è§£ï¼Œæ¥å¾—åˆ°è¿™ä¸ªç±» 123456@RpcService("HelloService")public class HelloServiceImpl implements HelloService &#123; public String hello(String name) &#123; return "Hello! " + name; &#125;&#125; ç±»å®ç°çš„æ¥å£ 123public interface HelloService &#123; String hello(String name);&#125; é€šè¿‡ApplicationContextè·å–æ‰€æœ‰æ ‡è®°è¿™ä¸ªæ³¨è§£çš„ç±» 123456789101112131415161718192021@Componentpublic class MyServer implements ApplicationContextAware &#123; @SuppressWarnings("resource") public static void main(String[] args) &#123; new ClassPathXmlApplicationContext("spring2.xml"); &#125; public void setApplicationContext(ApplicationContext ctx) throws BeansException &#123; Map&lt;String, Object&gt; serviceBeanMap = ctx .getBeansWithAnnotation(HelloService.class); for (Object serviceBean : serviceBeanMap.values()) &#123; try &#123; Method method = serviceBean.getClass().getMethod("hello", new Class[]&#123;String.class&#125;); Object invoke = method.invoke(serviceBean, "bbb"); System.out.println(invoke); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; ç»“åˆspringå®ç°junitæµ‹è¯• 123456789101112131415161718192021222324@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations = "classpath:spring2.xml")public class MyServer implements ApplicationContextAware &#123; @Test public void helloTest1() &#123; &#125; public void setApplicationContext(ApplicationContext ctx) throws BeansException &#123; Map&lt;String, Object&gt; serviceBeanMap = ctx .getBeansWithAnnotation(HelloService.class); for (Object serviceBean : serviceBeanMap.values()) &#123; try &#123; Method method = serviceBean.getClass().getMethod("hello", new Class[] &#123; String.class &#125;); Object invoke = method.invoke(serviceBean, "bbb"); System.out.println(invoke); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; è½»é‡çº§RPCæ¡†æ¶å¼€å‘nettyå®ç°çš„RPCçš„ç¼ºç‚¹åœ¨æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„RPCä¸­ï¼Œä¾‹å¦‚webserviceï¼Œä½¿ç”¨çš„ä¹ æƒ¯ç±»ä¼¼äºä¸‹å›¾ ä½†æ˜¯nettyçš„å®ç°è¿‡äºåº•å±‚ï¼Œæˆ‘ä»¬ä¸èƒ½å¤Ÿåƒä»¥å‰ä¸€æ ·åªå…³å¿ƒæ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œæ˜¯è¦å…³å¿ƒæ•°æ®çš„ä¼ è¾“ï¼Œå¯¹äºä¸ç†Ÿæ‚‰nettyçš„å¼€å‘è€…ï¼Œéœ€è¦äº†è§£å¾ˆå¤šnettyçš„æ¦‚å¿µå’Œé€»è¾‘ï¼Œæ‰èƒ½å®ç°RPCçš„è°ƒç”¨ã€‚ åº”ä¸Šé¢çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦åŸºäºnettyå®ç°ä¸€ä¸ªæˆ‘ä»¬ç†Ÿæ‚‰çš„RPCæ¡†æ¶ã€‚é€»è¾‘å¦‚ä¸‹ï¼š zkåœ¨æ¡†æ¶ä¸­çš„å®ç°åœ¨ä¸Šé¢çš„æ¡†æ¶ä¸­ï¼Œserverç«¯å­˜åœ¨ç€ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å•ç‚¹é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æœåŠ¡ç«¯â€œæŒ‚äº†â€ä¹‹åï¼Œæ¡†æ¶çš„ä½¿ç”¨å°±é€ æˆäº†å•ç‚¹å±éšœã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡zookeeperæ¥å®ç°æœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡]]></content>
      <categories>
        <category>Java</category>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVMå†…å­˜æ¨¡å‹]]></title>
    <url>%2F2019%2F12%2F25%2F14.Java%2FJava%E5%9F%BA%E7%A1%80%2FJVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[JVMå†…å­˜æ¨¡å‹å†…å­˜æ¨¡å‹å›¾è§£Javaè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæŠŠå®ƒæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºã€‚è¿™äº›åŒºåŸŸæœ‰å„è‡ªçš„ç”¨é€”ï¼Œä»¥åŠåˆ›å»ºå’Œé”€æ¯çš„æ—¶é—´ï¼Œæœ‰çš„åŒºåŸŸéšç€è™šæ‹Ÿæœºè¿›ç¨‹çš„å¯åŠ¨è€Œå­˜åœ¨ï¼Œæœ‰çš„åŒºåŸŸåˆ™ä¾èµ–ç”¨æˆ·çº¿ç¨‹çš„å¯åŠ¨å’Œç»“æŸè€Œå»ºç«‹å’Œé”€æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›åŒºåŸŸç»Ÿç§°ä¸ºJavaè¿è¡Œæ—¶æ•°æ®åŒºåŸŸã€‚ â€‹ å¦‚ä¸‹å›¾æ˜¯ä¸€ä¸ªå†…å­˜æ¨¡å‹çš„å…³ç³»å›¾ â€‹ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒJavaè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸè¢«åˆ†ä¸ºäº”ä¸ªåŒºåŸŸï¼šå †(Heap)ã€æ ˆ(Stack)ã€æœ¬åœ°æ–¹æ³•æ ˆ(Native Stack)ã€æ–¹æ³•åŒº(Method Area)ã€ç¨‹åºè®¡æ•°å™¨(Program Count Register) å †(Heap)å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼ŒJava Heapæ˜¯Javaè™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜çš„æœ€å¤§ä¸€å—ï¼Œè¿™å—åŒºåŸŸéšç€è™šæ‹Ÿæœºçš„å¯åŠ¨è€Œåˆ›å»ºã€‚åœ¨å®é™…çš„è¿ç”¨ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„å°±æ˜¯å­˜æ”¾åœ¨å †é‡Œé¢ã€‚å¦‚æœä½ å¬è¯´çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œå°±ä¼šå¾ˆæ˜ç¡®çš„çŸ¥é“Java Heapæ˜¯ä¸€å—å…±äº«çš„åŒºåŸŸï¼Œæ“ä½œå…±äº«åŒºåŸŸçš„æˆå‘˜å°±æœ‰äº†é”å’ŒåŒæ­¥ã€‚ â€‹ ä¸Java Heapç›¸å…³çš„è¿˜æœ‰Javaçš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰,Java Heapæ˜¯åƒåœ¾å›æ”¶å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚ç¨‹åºçŒ¿æ‰€ç†Ÿæ‚‰çš„æ–°ç”Ÿä»£ã€è€ç”Ÿä»£ã€æ°¸ä¹…ä»£çš„æ¦‚å¿µå°±æ˜¯åœ¨å †é‡Œé¢ï¼Œç°åœ¨å¤§å¤šæ•°çš„GCåŸºæœ¬éƒ½é‡‡ç”¨äº†åˆ†ä»£æ”¶é›†ç®—æ³•ã€‚å¦‚æœå†ç»†è‡´ä¸€ç‚¹ï¼ŒJava Heapè¿˜æœ‰Edenç©ºé—´ï¼ŒFrom Survivorç©ºé—´,To Survivorç©ºé—´ç­‰ã€‚ â€‹ Java Heapå¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯ã€‚ æ ˆï¼ˆStackï¼‰ç›¸å¯¹äºJava Heapæ¥è®²ï¼ŒJava Stackæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå¥¹çš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚Java Stackæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œæ—¶çš„å†…å­˜æ¨¡å‹ï¼Œæ¯ä¸ªæ–¹æ³•æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚ä»ä¸‹å›¾ä»å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œéƒ½æ„å‘³ç€æœ‰ä¸€ä¸ªæ ˆå¸§åœ¨å½“å‰çº¿ç¨‹å¯¹åº”çš„æ ˆå¸§ä¸­å…¥æ ˆå’Œå‡ºæ ˆã€‚ å›¾ä¸­å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªæ ˆå¸§ä¸­éƒ½æœ‰å±€éƒ¨å˜é‡è¡¨ã€‚å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸé—´çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¯¹è±¡å¼•ç”¨ç­‰ä¿¡æ¯ã€‚ æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Stackï¼‰â€‹ æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Stackï¼‰ä¸Javaè™šæ‹Ÿæœºç«™ï¼ˆJava Stackï¼‰æ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«åœ¨äºè™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œjavaæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºä½¿ç”¨åˆ°Nativeæ–¹æ³•æœåŠ¡ã€‚ æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰â€‹ æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¸å †ï¼ˆJava Heapï¼‰ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡ï¼Œå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚è™½ç„¶Javaè™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å¥¹å´æœ‰ä¸€ä¸ªåˆ«åå«åšéå †ï¼ˆNon-Heapï¼‰ã€‚åˆ†æä¸‹Javaè™šæ‹Ÿæœºè§„èŒƒï¼Œä¹‹æ‰€ä»¥æŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œåº”è¯¥è§‰å¾—å¥¹ä»¬éƒ½æ˜¯å­˜å‚¨æ•°æ®çš„è§’åº¦å‡ºå‘çš„ã€‚ä¸€ä¸ªå­˜å‚¨å¯¹è±¡æ•°æ®ï¼ˆå †ï¼‰ï¼Œä¸€ä¸ªå­˜å‚¨é™æ€ä¿¡æ¯(æ–¹æ³•åŒº)ã€‚ â€‹ åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å †ä¸­æœ‰æ–°ç”Ÿä»£ã€è€ç”Ÿä»£ã€æ°¸ä¹…ä»£çš„æè¿°ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬å°†æ–°ç”Ÿä»£ã€è€ç”Ÿä»£ã€æ°¸ä¹…ä»£ä¸‰ä¸ªæ¦‚å¿µä¸€èµ·è¯´ï¼Œé‚£æ˜¯å› ä¸ºHotSpotè™šæ‹Ÿæœºçš„è®¾è®¡å›¢é˜Ÿé€‰æ‹©æŠŠGCåˆ†ä»£æ”¶é›†æ‰©å±•è‡³æ–¹æ³•åŒºï¼Œæˆ–è€…è¯´ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºè€Œå·²ã€‚è¿™æ ·HotSpotçš„åƒåœ¾æ”¶é›†å™¨å°±èƒ½æƒ³ç®¡ç†Javaå †ä¸€æ ·ç®¡ç†è¿™éƒ¨åˆ†å†…å­˜ã€‚ç®€å•ç‚¹è¯´å°±æ˜¯HotSpotè™šæ‹Ÿæœºä¸­å†…å­˜æ¨¡å‹çš„åˆ†ä»£ï¼Œå…¶ä¸­æ–°ç”Ÿä»£å’Œè€ç”Ÿä»£åœ¨å †ä¸­ï¼Œæ°¸ä¹…ä»£ä½¿ç”¨æ–¹æ³•åŒºå®ç°ã€‚æ ¹æ®å®˜æ–¹å‘å¸ƒçš„è·¯çº¿å›¾ä¿¡æ¯ï¼Œç°åœ¨ä¹Ÿæœ‰æ”¾å¼ƒæ°¸ä¹…ä»£å¹¶é€æ­¥é‡‡ç”¨Native Memoryæ¥å®ç°æ–¹æ³•åŒºçš„è§„åˆ’ï¼Œåœ¨JDK1.7çš„HotSpotä¸­ï¼Œå·²ç»æŠŠåŸæœ¬æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ç§»å‡ºã€‚ æ•°æ®åŒºåŸŸåˆ’åˆ† çº¿ç¨‹ç§æœ‰åŒºåŸŸ Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Stackï¼‰ æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Stackï¼‰ çº¿ç¨‹å…±æœ‰çš„æ•°æ®åŒºåŸŸ å †ï¼ˆJava Heapï¼‰ æ–¹æ³•åŒº (Method Area) JVM GCï¼ˆåƒåœ¾å›æ”¶æœºåˆ¶ï¼‰ä»€ä¹ˆæ˜¯GCæœºåˆ¶åœ¨Javaç¨‹åºä¸­ä¸èƒ½æ˜¾å¼çš„åˆ†é…å’Œæ³¨é”€ç¼“å­˜ï¼Œå› ä¸ºè¿™äº›äº‹æƒ…JVMéƒ½å¸®æˆ‘ä»¬åšäº†ï¼Œé‚£å°±æ˜¯GCã€‚ JVM GCå›æ”¶å“ªçš„åƒåœ¾ï¼Ÿéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJVM GCåªå›æ”¶å †åŒºå’Œæ–¹æ³•åŒºå†…çš„å¯¹è±¡ã€‚è€Œæ ˆåŒºçš„æ•°æ®ï¼Œåœ¨è¶…å‡ºä½œç”¨åŸŸåä¼šè¢«JVMè‡ªåŠ¨é‡Šæ”¾æ‰ï¼Œæ‰€ä»¥å…¶ä¸åœ¨JVM GCçš„ç®¡ç†èŒƒå›´å†…ã€‚ JVM GCæ€ä¹ˆåˆ¤æ–­å¯¹è±¡å¯ä»¥è¢«å›æ”¶äº†ï¼Ÿ å¯¹è±¡æ²¡æœ‰å¼•ç”¨ ä½œç”¨åŸŸå‘ç”Ÿæœªæ•è·å¼‚å¸¸ ç¨‹åºåœ¨ä½œç”¨åŸŸæ­£å¸¸æ‰§è¡Œå®Œæ¯• ç¨‹åºæ‰§è¡Œäº†System.exit() ç¨‹åºå‘ç”Ÿæ„å¤–ç»ˆæ­¢ï¼ˆè¢«æ€çº¿ç¨‹ç­‰ï¼‰ æŒ‰ä»£çš„åƒåœ¾å›æ”¶æœºåˆ¶ æ–°ç”Ÿä»£ï¼ˆYoung generationï¼‰ï¼šç»å¤§å¤šæ•°æœ€æ–°è¢«åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åˆ°è¿™é‡Œï¼Œç”±äºå¤§éƒ¨åˆ†åœ¨åˆ›å»ºåå¾ˆå¿«å˜å¾—ä¸å¯è¾¾ï¼Œå¾ˆå¤šå¯¹è±¡è¢«åˆ›å»ºåœ¨æ–°ç”Ÿä»£ï¼Œç„¶åâ€œæ¶ˆå¤±â€ã€‚å¯¹è±¡ä»è¿™ä¸ªåŒºåŸŸâ€œæ¶ˆå¤±â€çš„è¿‡ç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šMinor GC ã€‚ è€å¹´ä»£ï¼ˆOld generationï¼‰ï¼šå¯¹è±¡æ²¡æœ‰å˜å¾—ä¸å¯è¾¾ï¼Œå¹¶ä¸”ä»æ–°ç”Ÿä»£å‘¨æœŸä¸­å­˜æ´»äº†ä¸‹æ¥ï¼Œä¼šè¢«æ‹·è´åˆ°è¿™é‡Œã€‚å…¶åŒºåŸŸåˆ†é…çš„ç©ºé—´è¦æ¯”æ–°ç”Ÿä»£å¤šã€‚ä¹Ÿæ­£ç”±äºå…¶ç›¸å¯¹å¤§çš„ç©ºé—´ï¼Œå‘ç”Ÿåœ¨è€å¹´ä»£çš„GCæ¬¡æ•°è¦æ¯”æ–°ç”Ÿä»£å°‘å¾—å¤šã€‚å¯¹è±¡ä»è€å¹´ä»£ä¸­æ¶ˆå¤±çš„è¿‡ç¨‹ï¼Œç§°ä¹‹ä¸ºï¼šMajor GC æˆ–è€… Full GCã€‚ æŒä¹…ä»£ï¼ˆPermanent generationï¼‰ä¹Ÿç§°ä¹‹ä¸º æ–¹æ³•åŒºï¼ˆMethod areaï¼‰ï¼šç”¨äºä¿å­˜ç±»å¸¸é‡ä»¥åŠå­—ç¬¦ä¸²å¸¸é‡ã€‚æ³¨æ„ï¼Œè¿™ä¸ªåŒºåŸŸä¸æ˜¯ç”¨äºå­˜å‚¨é‚£äº›ä»è€å¹´ä»£å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ï¼Œè¿™ä¸ªåŒºåŸŸä¹Ÿå¯èƒ½å‘ç”ŸGCã€‚å‘ç”Ÿåœ¨è¿™ä¸ªåŒºåŸŸçš„GCäº‹ä»¶ä¹Ÿè¢«ç®—ä¸º Major GC ã€‚åªä¸è¿‡åœ¨è¿™ä¸ªåŒºåŸŸå‘ç”ŸGCçš„æ¡ä»¶éå¸¸ä¸¥è‹›ï¼Œå¿…é¡»ç¬¦åˆä»¥ä¸‹ä¸‰ç§æ¡ä»¶æ‰ä¼šè¢«å›æ”¶ï¼š1ã€æ‰€æœ‰å®ä¾‹è¢«å›æ”¶ï¼› 2ã€åŠ è½½è¯¥ç±»çš„ClassLoader è¢«å›æ”¶ï¼› 3ã€Class å¯¹è±¡æ— æ³•é€šè¿‡ä»»ä½•é€”å¾„è®¿é—®ï¼ˆåŒ…æ‹¬åå°„ï¼‰ å¯èƒ½æˆ‘ä»¬ä¼šæœ‰ç–‘é—®ï¼š å¦‚æœè€å¹´ä»£çš„å¯¹è±¡éœ€è¦å¼•ç”¨æ–°ç”Ÿä»£çš„å¯¹è±¡ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè€å¹´ä»£ä¸­å­˜åœ¨ä¸€ä¸ª card table ï¼Œå®ƒæ˜¯ä¸€ä¸ª512byteå¤§å°çš„å—ã€‚æ‰€æœ‰è€å¹´ä»£çš„å¯¹è±¡æŒ‡å‘æ–°ç”Ÿä»£å¯¹è±¡çš„å¼•ç”¨éƒ½ä¼šè¢«è®°å½•åœ¨è¿™ä¸ªè¡¨ä¸­ã€‚å½“é’ˆå¯¹æ–°ç”Ÿä»£æ‰§è¡ŒGCçš„æ—¶å€™ï¼Œåªéœ€è¦æŸ¥è¯¢ card table æ¥å†³å®šæ˜¯å¦å¯ä»¥è¢«å›æ”¶ï¼Œè€Œä¸ç”¨æŸ¥è¯¢æ•´ä¸ªè€å¹´ä»£ã€‚è¿™ä¸ª card table ç”±ä¸€ä¸ªwrite barrier æ¥ç®¡ç†ã€‚write barrierç»™GCå¸¦æ¥äº†å¾ˆå¤§çš„æ€§èƒ½æå‡ï¼Œè™½ç„¶ç”±æ­¤å¯èƒ½å¸¦æ¥ä¸€äº›å¼€é”€ï¼Œä½†å®Œå…¨æ˜¯å€¼å¾—çš„ã€‚ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ é»˜è®¤çš„æ–°ç”Ÿä»£ï¼ˆYoung generationï¼‰ã€è€å¹´ä»£ï¼ˆOld generationï¼‰æ‰€å ç©ºé—´æ¯”ä¾‹ä¸º 1 : 2 ã€‚ æ–°ç”Ÿä»£è€å¹´ä»£æ„æˆé€»è¾‘æ–°ç”Ÿä»£æ„æˆé€»è¾‘ä¸ºäº†æ›´å¥½çš„ç†è§£GCï¼Œæˆ‘ä»¬æ¥å­¦ä¹ æ–°ç”Ÿä»£çš„æ„æˆï¼Œå®ƒç”¨æ¥ä¿å­˜é‚£äº›ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºçš„å¯¹è±¡ï¼Œå®ƒè¢«åˆ†æˆä¸‰ä¸ªç©ºé—´ï¼š ä¸€ä¸ªä¼Šç”¸å›­ç©ºé—´ï¼ˆEdenï¼‰ ä¸¤ä¸ªå¹¸å­˜è€…ç©ºé—´ï¼ˆFron Survivorã€To Survivorï¼‰ é»˜è®¤æ–°ç”Ÿä»£ç©ºé—´çš„åˆ†é…ï¼šEden : Fron : To = 8 : 1 : 1 æ¯ä¸ªç©ºé—´çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š 1ã€ç»å¤§å¤šæ•°åˆšåˆšè¢«åˆ›å»ºçš„å¯¹è±¡ä¼šå­˜æ”¾åœ¨ä¼Šç”¸å›­ç©ºé—´ï¼ˆEdenï¼‰ã€‚ 2ã€åœ¨ä¼Šç”¸å›­ç©ºé—´æ‰§è¡Œç¬¬ä¸€æ¬¡GCï¼ˆMinor GCï¼‰ä¹‹åï¼Œå­˜æ´»çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°å…¶ä¸­ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´ï¼ˆSurvivorï¼‰ã€‚ 3ã€æ­¤åï¼Œæ¯æ¬¡ä¼Šç”¸å›­ç©ºé—´æ‰§è¡ŒGCåï¼Œå­˜æ´»çš„å¯¹è±¡ä¼šè¢«å †ç§¯åœ¨åŒä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´ã€‚ 4ã€å½“ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´é¥±å’Œï¼Œè¿˜åœ¨å­˜æ´»çš„å¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´ã€‚ç„¶åä¼šæ¸…ç©ºå·²ç»é¥±å’Œçš„å“ªä¸ªå¹¸å­˜è€…ç©ºé—´ã€‚ 5ã€åœ¨ä»¥ä¸Šæ­¥éª¤ä¸­é‡å¤Næ¬¡ï¼ˆN = MaxTenuringThresholdï¼ˆå¹´é¾„é˜€å€¼è®¾å®šï¼Œé»˜è®¤15ï¼‰ï¼‰ä¾ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œå°±ä¼šè¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚ ä»ä¸Šé¢çš„æ­¥éª¤å¯ä»¥å‘ç°ï¼Œä¸¤ä¸ªå¹¸å­˜è€…ç©ºé—´ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªæ˜¯ä¿æŒç©ºçš„ã€‚å¦‚æœä¸¤ä¸ªä¸¤ä¸ªå¹¸å­˜è€…ç©ºé—´éƒ½æœ‰æ•°æ®ï¼Œæˆ–ä¸¤ä¸ªç©ºé—´éƒ½æ˜¯ç©ºçš„ï¼Œé‚£ä¸€å®šæ˜¯ä½ çš„ç³»ç»Ÿå‡ºç°äº†æŸç§é”™è¯¯ã€‚ æˆ‘ä»¬éœ€è¦é‡ç‚¹è®°ä½çš„æ˜¯ï¼Œå¯¹è±¡åœ¨åˆšåˆšè¢«åˆ›å»ºä¹‹åï¼Œæ˜¯ä¿å­˜åœ¨ä¼Šç”¸å›­ç©ºé—´çš„ï¼ˆEdenï¼‰ã€‚é‚£äº›é•¿æœŸå­˜æ´»çš„å¯¹è±¡ä¼šç»ç”±å¹¸å­˜è€…ç©ºé—´ï¼ˆSurvivorï¼‰è½¬å­˜åˆ°è€å¹´ä»£ç©ºé—´ï¼ˆOld generationï¼‰ã€‚ ä¹Ÿæœ‰ä¾‹å¤–å‡ºç°ï¼Œå¯¹äºä¸€äº›æ¯”è¾ƒå¤§çš„å¯¹è±¡ï¼ˆéœ€è¦åˆ†é…ä¸€å—æ¯”è¾ƒå¤§çš„è¿ç»­å†…å­˜ç©ºé—´ï¼‰åˆ™ç›´æ¥è¿›å…¥åˆ°è€å¹´ä»£ã€‚ä¸€èˆ¬åœ¨Survivor ç©ºé—´ä¸è¶³çš„æƒ…å†µä¸‹å‘ç”Ÿã€‚ è€å¹´ä»£æ„æˆé€»è¾‘è€å¹´ä»£ç©ºé—´çš„æ„æˆå…¶å®å¾ˆç®€å•ï¼Œå®ƒä¸åƒæ–°ç”Ÿä»£ç©ºé—´é‚£æ ·åˆ’åˆ†ä¸ºå‡ ä¸ªåŒºåŸŸï¼Œå®ƒåªæœ‰ä¸€ä¸ªåŒºåŸŸï¼Œé‡Œé¢å­˜å‚¨çš„å¯¹è±¡å¹¶ä¸åƒæ–°ç”Ÿä»£ç©ºé—´ç»å¤§éƒ¨åˆ†éƒ½æ˜¯æœé—»é“ï¼Œå¤•æ­»çŸ£ã€‚è¿™é‡Œçš„å¯¹è±¡å‡ ä¹éƒ½æ˜¯ä»Survivor ç©ºé—´ä¸­ç†¬è¿‡æ¥çš„ï¼Œå®ƒä»¬ç»ä¸ä¼šè½»æ˜“çš„ç‹—å¸¦ã€‚å› æ­¤ï¼ŒFull GCï¼ˆMajor GCï¼‰å‘ç”Ÿçš„æ¬¡æ•°ä¸ä¼šæœ‰Minor GC é‚£ä¹ˆé¢‘ç¹ï¼Œå¹¶ä¸”åšä¸€æ¬¡Major GC çš„æ—¶é—´æ¯”Minor GC è¦æ›´é•¿ï¼ˆçº¦10å€ï¼‰ã€‚ JVM GCä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼ŸedenåŒºç©ºé—´ä¸å¤Ÿå­˜æ”¾æ–°å¯¹è±¡çš„æ—¶å€™ï¼Œæ‰§è¡ŒMinro GCã€‚å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§äºè€å¹´ä»£å‰©ä½™ç©ºé—´çš„æ—¶å€™æ‰§è¡ŒFull GCï¼Œæˆ–è€…å°äºçš„æ—¶å€™è¢«HandlePromotionFailure å‚æ•°å¼ºåˆ¶Full GC ã€‚è°ƒä¼˜ä¸»è¦æ˜¯å‡å°‘ Full GC çš„è§¦å‘æ¬¡æ•°ï¼Œå¯ä»¥é€šè¿‡ NewRatio æ§åˆ¶æ–°ç”Ÿä»£è½¬è€å¹´ä»£çš„æ¯”ä¾‹ï¼Œé€šè¿‡MaxTenuringThreshold è®¾ç½®å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„é˜€å€¼ï¼ˆåé¢ä¼šä»‹ç»åˆ°ï¼‰ã€‚ JVM GC ç®—æ³•è®²è§£1ã€æ ¹æœç´¢ç®—æ³•æ ¹æœç´¢ç®—æ³•æ˜¯ä»ç¦»æ•£æ•°å­¦ä¸­çš„å›¾è®ºå¼•å…¥çš„ï¼Œç¨‹åºæŠŠæ‰€æœ‰å¼•ç”¨å…³ç³»çœ‹ä½œä¸€å¼ å›¾ï¼Œä»ä¸€ä¸ªèŠ‚ç‚¹GC ROOT å¼€å§‹ï¼Œå¯»æ‰¾å¯¹åº”çš„å¼•ç”¨èŠ‚ç‚¹ï¼Œæ‰¾åˆ°è¿™ä¸ªèŠ‚ç‚¹åï¼Œç»§ç»­å¯»æ‰¾è¿™ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨èŠ‚ç‚¹ã€‚å½“æ‰€æœ‰çš„å¼•ç”¨èŠ‚ç‚¹å¯»æ‰¾å®Œæ¯•åï¼Œå‰©ä½™çš„èŠ‚ç‚¹åˆ™è¢«è®¤ä¸ºæ˜¯æ²¡æœ‰è¢«å¼•ç”¨åˆ°çš„èŠ‚ç‚¹ï¼Œå³æ— ç”¨çš„èŠ‚ç‚¹ã€‚ ä¸Šå›¾çº¢è‰²ä¸ºæ— ç”¨çš„èŠ‚ç‚¹ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚ ç›®å‰Javaä¸­å¯ä»¥ä½œä¸ºGC ROOTçš„å¯¹è±¡æœ‰ï¼š 1ã€è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆæœ¬åœ°å˜é‡è¡¨ï¼‰ 2ã€æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ 3ã€æ–¹æ³•åŒºä¸­å¸¸äº®å¼•ç”¨çš„å¯¹è±¡ 4ã€æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆNativeå¯¹è±¡ï¼‰ åŸºæœ¬æ‰€æœ‰GCç®—æ³•éƒ½å¼•ç”¨æ ¹æœç´¢ç®—æ³•è¿™ç§æ¦‚å¿µã€‚ 2ã€æ ‡è®° - æ¸…é™¤ç®—æ³• æ ‡è®°-æ¸…é™¤ç®—æ³•é‡‡ç”¨ä»æ ¹é›†åˆè¿›è¡Œæ‰«æï¼Œå¯¹å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œæ ‡è®°å®Œæ¯•åï¼Œå†æ‰«ææ•´ä¸ªç©ºé—´ä¸­æœªè¢«æ ‡è®°çš„å¯¹è±¡è¿›è¡Œç›´æ¥å›æ”¶ï¼Œå¦‚ä¸Šå›¾ã€‚ æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸éœ€è¦è¿›è¡Œå¯¹è±¡çš„ç§»åŠ¨ï¼Œå¹¶ä¸”ä»…å¯¹ä¸å­˜æ´»çš„å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œåœ¨å­˜æ´»çš„å¯¹è±¡æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹æä¸ºé«˜æ•ˆï¼Œä½†ç”±äºæ ‡è®°-æ¸…é™¤ç®—æ³•ç›´æ¥å›æ”¶ä¸å­˜æ´»çš„å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰å¯¹è¿˜å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ•´ç†ï¼Œå› æ­¤ä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡ã€‚ 3ã€å¤åˆ¶ç®—æ³• å¤åˆ¶ç®—æ³•å°†å†…å­˜åˆ†ä¸ºä¸¤ä¸ªåŒºé—´ï¼Œä½¿ç”¨æ­¤ç®—æ³•æ—¶ï¼Œæ‰€æœ‰åŠ¨æ€åˆ†é…çš„å¯¹è±¡éƒ½åªèƒ½åˆ†é…åœ¨å…¶ä¸­ä¸€ä¸ªåŒºé—´ï¼ˆæ´»åŠ¨åŒºé—´ï¼‰ï¼Œè€Œå¦å¤–ä¸€ä¸ªåŒºé—´ï¼ˆç©ºé—´åŒºé—´ï¼‰åˆ™æ˜¯ç©ºé—²çš„ã€‚ å¤åˆ¶ç®—æ³•é‡‡ç”¨ä»æ ¹é›†åˆæ‰«æï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°ç©ºé—²åŒºé—´ï¼Œå½“æ‰«æå®Œæ¯•æ´»åŠ¨åŒºé—´åï¼Œä¼šçš„å°†æ´»åŠ¨åŒºé—´ä¸€æ¬¡æ€§å…¨éƒ¨å›æ”¶ã€‚æ­¤æ—¶åŸæœ¬çš„ç©ºé—²åŒºé—´å˜æˆäº†æ´»åŠ¨åŒºé—´ã€‚ä¸‹æ¬¡GCæ—¶å€™åˆä¼šé‡å¤åˆšæ‰çš„æ“ä½œï¼Œä»¥æ­¤å¾ªç¯ã€‚ å¤åˆ¶ç®—æ³•åœ¨å­˜æ´»å¯¹è±¡æ¯”è¾ƒå°‘çš„æ—¶å€™ï¼Œæä¸ºé«˜æ•ˆï¼Œä½†æ˜¯å¸¦æ¥çš„æˆæœ¬æ˜¯ç‰ºç‰²ä¸€åŠçš„å†…å­˜ç©ºé—´ç”¨äºè¿›è¡Œå¯¹è±¡çš„ç§»åŠ¨ã€‚æ‰€ä»¥å¤åˆ¶ç®—æ³•çš„ä½¿ç”¨åœºæ™¯ï¼Œå¿…é¡»æ˜¯å¯¹è±¡çš„å­˜æ´»ç‡éå¸¸ä½æ‰è¡Œï¼Œè€Œä¸”æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å…‹æœ50%å†…å­˜çš„æµªè´¹ã€‚ 4ã€æ ‡è®° - æ•´ç†ç®—æ³• æ ‡è®°-æ•´ç†ç®—æ³•é‡‡ç”¨ æ ‡è®°-æ¸…é™¤ ç®—æ³•ä¸€æ ·çš„æ–¹å¼è¿›è¡Œå¯¹è±¡çš„æ ‡è®°ã€æ¸…é™¤ï¼Œä½†åœ¨å›æ”¶ä¸å­˜æ´»çš„å¯¹è±¡å ç”¨çš„ç©ºé—´åï¼Œä¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å¾€å·¦ç«¯ç©ºé—²ç©ºé—´ç§»åŠ¨ï¼Œå¹¶æ›´æ–°å¯¹åº”çš„æŒ‡é’ˆã€‚æ ‡è®°-æ•´ç† ç®—æ³•æ˜¯åœ¨æ ‡è®°-æ¸…é™¤ ç®—æ³•ä¹‹ä¸Šï¼Œåˆè¿›è¡Œäº†å¯¹è±¡çš„ç§»åŠ¨æ’åºæ•´ç†ï¼Œå› æ­¤æˆæœ¬æ›´é«˜ï¼Œä½†å´è§£å†³äº†å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚ JVMä¸ºäº†ä¼˜åŒ–å†…å­˜çš„å›æ”¶ï¼Œä½¿ç”¨äº†åˆ†ä»£å›æ”¶çš„æ–¹å¼ï¼Œå¯¹äºæ–°ç”Ÿä»£å†…å­˜çš„å›æ”¶ï¼ˆMinor GCï¼‰ä¸»è¦é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€‚è€Œå¯¹äºè€å¹´ä»£çš„å›æ”¶ï¼ˆMajor GCï¼‰ï¼Œå¤§å¤šé‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚ åƒåœ¾å›æ”¶å™¨ç®€ä»‹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªå›æ”¶å™¨éƒ½å­˜åœ¨Stop The World çš„é—®é¢˜ï¼Œåªä¸è¿‡å„ä¸ªå›æ”¶å™¨åœ¨Stop The World æ—¶é—´ä¼˜åŒ–ç¨‹åº¦ã€ç®—æ³•çš„ä¸åŒï¼Œå¯æ ¹æ®è‡ªèº«éœ€æ±‚é€‰æ‹©é€‚åˆçš„å›æ”¶å™¨ã€‚ 1ã€Serialï¼ˆ-XX:+UseSerialGCï¼‰ä»åå­—æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªä¸²è¡Œæ”¶é›†å™¨ã€‚ Serialæ”¶é›†å™¨æ˜¯Javaè™šæ‹Ÿæœºä¸­æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨ã€‚åœ¨JDK1.3ä¹‹å‰æ˜¯Javaè™šæ‹Ÿæœºæ–°ç”Ÿä»£æ”¶é›†å™¨çš„å”¯ä¸€é€‰æ‹©ã€‚ç›®å‰ä¹Ÿæ˜¯ClientVMä¸‹ServerVM 4æ ¸4GBä»¥ä¸‹æœºå™¨é»˜è®¤åƒåœ¾å›æ”¶å™¨ã€‚Serialæ”¶é›†å™¨å¹¶ä¸æ˜¯åªèƒ½ä½¿ç”¨ä¸€ä¸ªCPUè¿›è¡Œæ”¶é›†ï¼Œè€Œæ˜¯å½“JVMéœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œéœ€æš‚åœæ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹ï¼Œç›´åˆ°å›æ”¶ç»“æŸã€‚ ä½¿ç”¨ç®—æ³•ï¼šå¤åˆ¶ç®—æ³• JVMä¸­æ–‡åç§°ä¸ºJavaè™šæ‹Ÿæœºï¼Œå› æ­¤å®ƒåƒä¸€å°è™šæ‹Ÿçš„ç”µè„‘åœ¨å·¥ä½œï¼Œè€Œå…¶ä¸­çš„æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½è¢«è®¤ä¸ºæ˜¯JVMçš„ä¸€ä¸ªå¤„ç†å™¨ï¼Œå› æ­¤å›¾ä¸­çš„CPU0ã€CPU1å®é™…ä¸Šä¸ºç”¨æˆ·çš„çº¿ç¨‹ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„æœºå™¨CPUï¼Œä¸è¦è¯¯è§£å“¦ã€‚ Serialæ”¶é›†å™¨è™½ç„¶æ˜¯æœ€è€çš„ï¼Œä½†æ˜¯å®ƒå¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼Œç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†ï¼Œæ‰€ä»¥å®ƒåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯ç›¸å¯¹äºå…¶ä»–æ”¶é›†å™¨ä¸­æœ€é«˜æ•ˆçš„ã€‚ 2ã€SerialOldï¼ˆ-XX:+UseSerialGCï¼‰SerialOldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£æ”¶é›†å™¨ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œè¿™ä¸ªæ”¶é›†å™¨ç›®å‰ä¸»è¦ç”¨äºClientæ¨¡å¼ä¸‹ä½¿ç”¨ã€‚å¦‚æœåœ¨Serveræ¨¡å¼ä¸‹ï¼Œå®ƒä¸»è¦è¿˜æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ä¸ªæ˜¯åœ¨JDK1.5åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œå¦‚æœCMSå‡ºç°Concurrent Mode Failureï¼Œåˆ™SerialOldå°†ä½œä¸ºåå¤‡æ”¶é›†å™¨ã€‚ ä½¿ç”¨ç®—æ³•ï¼šæ ‡è®° - æ•´ç†ç®—æ³• è¿è¡Œç¤ºæ„å›¾ä¸ä¸Šå›¾ä¸€è‡´ã€‚ 3ã€ParNewï¼ˆ-XX:+UseParNewGCï¼‰ParNewå…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚é™¤äº†Serialæ”¶é›†å™¨å¤–ï¼Œåªæœ‰å®ƒèƒ½ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œã€‚ ä½¿ç”¨ç®—æ³•ï¼šå¤åˆ¶ç®—æ³• ParNewæ˜¯è®¸å¤šè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹çš„JVMé¦–é€‰çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚ä½†æ˜¯åœ¨å•CPUçš„æƒ…å†µä¸‹ï¼Œå®ƒçš„æ•ˆç‡è¿œè¿œä½äºSerialæ”¶é›†å™¨ï¼Œæ‰€ä»¥ä¸€å®šè¦æ³¨æ„ä½¿ç”¨åœºæ™¯ã€‚ 4ã€ParallelScavengeï¼ˆ-XX:+UseParallelGCï¼‰ParallelScavengeåˆè¢«ç§°ä¸ºååé‡ä¼˜å…ˆæ”¶é›†å™¨ï¼Œå’ŒParNew æ”¶é›†å™¨ç±»ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚ ä½¿ç”¨ç®—æ³•ï¼šå¤åˆ¶ç®—æ³• ParallelScavengeæ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§ä»¶çš„ååé‡ï¼Œæ‰€è°“ååé‡å°±æ˜¯CPUç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œå³ååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ã€‚å¦‚æœè™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº†100åˆ†é’Ÿï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†èŠ±äº†1åˆ†é’Ÿï¼Œé‚£ä¹ˆååé‡å°±æ˜¯99% ã€‚ 5ã€ParallelOldï¼ˆ-XX:+UseParallelOldGCï¼‰ParallelOldæ˜¯å¹¶è¡Œæ”¶é›†å™¨ï¼Œå’ŒSerialOldä¸€æ ·ï¼ŒParallelOldæ˜¯ä¸€ä¸ªè€å¹´ä»£æ”¶é›†å™¨ï¼Œæ˜¯è€å¹´ä»£ååé‡ä¼˜å…ˆçš„ä¸€ä¸ªæ”¶é›†å™¨ã€‚è¿™ä¸ªæ”¶é›†å™¨åœ¨JDK1.6ä¹‹åæ‰å¼€å§‹æä¾›çš„ï¼Œåœ¨æ­¤ä¹‹å‰ï¼ŒParallelScavengeåªèƒ½é€‰æ‹©SerialOldæ¥ä½œä¸ºå…¶è€å¹´ä»£çš„æ”¶é›†å™¨ï¼Œè¿™ä¸¥é‡æ‹–ç´¯äº†ParallelScavengeæ•´ä½“çš„é€Ÿåº¦ã€‚è€ŒParallelOldçš„å‡ºç°åï¼Œâ€œååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨æ‰åå‰¯å…¶å®ï¼ ä½¿ç”¨ç®—æ³•ï¼šæ ‡è®° - æ•´ç†ç®—æ³• åœ¨æ³¨é‡ååé‡ä¸CPUæ•°é‡å¤§äº1çš„æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ParallelScavenge + ParalleloOldæ”¶é›†å™¨ã€‚ 6ã€CMS ï¼ˆ-XX:+UseConcMarkSweepGCï¼‰CMSæ˜¯ä¸€ä¸ªè€å¹´ä»£æ”¶é›†å™¨ï¼Œå…¨ç§° Concurrent Low Pause Collectorï¼Œæ˜¯JDK1.4åæœŸå¼€å§‹å¼•ç”¨çš„æ–°GCæ”¶é›†å™¨ï¼Œåœ¨JDK1.5ã€1.6ä¸­å¾—åˆ°äº†è¿›ä¸€æ­¥çš„æ”¹è¿›ã€‚å®ƒæ˜¯å¯¹äºå“åº”æ—¶é—´çš„é‡è¦æ€§éœ€æ±‚å¤§äºååé‡è¦æ±‚çš„æ”¶é›†å™¨ã€‚å¯¹äºè¦æ±‚æœåŠ¡å™¨å“åº”é€Ÿåº¦é«˜çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨CMSéå¸¸åˆé€‚ã€‚ CMSçš„ä¸€å¤§ç‰¹ç‚¹ï¼Œå°±æ˜¯ç”¨ä¸¤æ¬¡çŸ­æš‚çš„æš‚åœæ¥ä»£æ›¿ä¸²è¡Œæˆ–å¹¶è¡Œæ ‡è®°æ•´ç†ç®—æ³•æ—¶å€™çš„é•¿æš‚åœã€‚ ä½¿ç”¨ç®—æ³•ï¼šæ ‡è®° - æ¸…ç† CMSçš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š åˆå§‹æ ‡è®°ï¼ˆSTW initial markï¼‰ åœ¨è¿™ä¸ªé˜¶æ®µï¼Œéœ€è¦è™šæ‹Ÿæœºåœé¡¿æ­£åœ¨æ‰§è¡Œçš„åº”ç”¨çº¿ç¨‹ï¼Œå®˜æ–¹çš„å«æ³•STWï¼ˆStop Tow Worldï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ä»æ ¹å¯¹è±¡æ‰«æç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œå¹¶ä½œæ ‡è®°ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šå¾ˆå¿«çš„å®Œæˆã€‚ å¹¶å‘æ ‡è®°ï¼ˆConcurrent markingï¼‰ è¿™ä¸ªé˜¶æ®µç´§éšåˆå§‹æ ‡è®°é˜¶æ®µï¼Œåœ¨â€œåˆå§‹æ ‡è®°â€çš„åŸºç¡€ä¸Šç»§ç»­å‘ä¸‹è¿½æº¯æ ‡è®°ã€‚æ³¨æ„è¿™é‡Œæ˜¯å¹¶å‘æ ‡è®°ï¼Œè¡¨ç¤ºç”¨æˆ·çº¿ç¨‹å¯ä»¥å’ŒGCçº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œè¿™ä¸ªé˜¶æ®µä¸ä¼šæš‚åœç”¨æˆ·çš„çº¿ç¨‹å“¦ã€‚ å¹¶å‘é¢„æ¸…ç†ï¼ˆConcurrent precleaningï¼‰ è¿™ä¸ªé˜¶æ®µä»»ç„¶æ˜¯å¹¶å‘çš„ï¼ŒJVMæŸ¥æ‰¾æ­£åœ¨æ‰§è¡Œâ€œå¹¶å‘æ ‡è®°â€é˜¶æ®µæ—¶å€™è¿›å…¥è€å¹´ä»£çš„å¯¹è±¡ï¼ˆå¯èƒ½è¿™æ—¶ä¼šæœ‰å¯¹è±¡ä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ï¼Œæˆ–è¢«åˆ†é…åˆ°è€å¹´ä»£ï¼‰ã€‚é€šè¿‡é‡æ–°æ‰«æï¼Œå‡å°‘åœ¨ä¸€ä¸ªé˜¶æ®µâ€œé‡æ–°æ ‡è®°â€çš„å·¥ä½œï¼Œå› ä¸ºä¸‹ä¸€é˜¶æ®µä¼šSTWã€‚ é‡æ–°æ ‡è®°ï¼ˆSTW remarkï¼‰ è¿™ä¸ªé˜¶æ®µä¼šå†æ¬¡æš‚åœæ­£åœ¨æ‰§è¡Œçš„åº”ç”¨çº¿ç¨‹ï¼Œé‡æ–°é‡æ ¹å¯¹è±¡å¼€å§‹æŸ¥æ‰¾å¹¶æ ‡è®°å¹¶å‘é˜¶æ®µé—æ¼çš„å¯¹è±¡ï¼ˆåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸåå¯¹è±¡çŠ¶æ€çš„æ›´æ–°å¯¼è‡´ï¼‰ï¼Œå¹¶å¤„ç†å¯¹è±¡å…³è”ã€‚è¿™ä¸€æ¬¡è€—æ—¶ä¼šæ¯”â€œåˆå§‹æ ‡è®°â€æ›´é•¿ï¼Œå¹¶ä¸”è¿™ä¸ªé˜¶æ®µå¯ä»¥å¹¶è¡Œæ ‡è®°ã€‚ å¹¶å‘æ¸…ç†ï¼ˆConcurrent sweepingï¼‰ è¿™ä¸ªé˜¶æ®µæ˜¯å¹¶å‘çš„ï¼Œåº”ç”¨çº¿ç¨‹å’ŒGCæ¸…é™¤çº¿ç¨‹å¯ä»¥ä¸€èµ·å¹¶å‘æ‰§è¡Œã€‚ å¹¶å‘é‡ç½®ï¼ˆConcurrent resetï¼‰ è¿™ä¸ªé˜¶æ®µä»»ç„¶æ˜¯å¹¶å‘çš„ï¼Œé‡ç½®CMSæ”¶é›†å™¨çš„æ•°æ®ç»“æ„ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚ CMSçš„ç¼ºç‚¹ï¼š å†…å­˜ç¢ç‰‡ã€‚ç”±äºä½¿ç”¨äº† æ ‡è®°-æ¸…ç† ç®—æ³•ï¼Œå¯¼è‡´å†…å­˜ç©ºé—´ä¸­ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚ä¸è¿‡CMSæ”¶é›†å™¨åšäº†ä¸€äº›å°çš„ä¼˜åŒ–ï¼Œå°±æ˜¯æŠŠæœªåˆ†é…çš„ç©ºé—´æ±‡æ€»æˆä¸€ä¸ªåˆ—è¡¨ï¼Œå½“æœ‰JVMéœ€è¦åˆ†é…å†…å­˜ç©ºé—´çš„æ—¶å€™ï¼Œä¼šæœç´¢è¿™ä¸ªåˆ—è¡¨æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç©ºé—´æ¥å­˜å‚¨è¿™ä¸ªå¯¹è±¡ã€‚ä½†æ˜¯å†…å­˜ç¢ç‰‡çš„é—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡éœ€è¦3å—è¿ç»­çš„ç©ºé—´æ¥å­˜å‚¨ï¼Œå› ä¸ºå†…å­˜ç¢ç‰‡çš„åŸå› ï¼Œå¯»æ‰¾ä¸åˆ°è¿™æ ·çš„ç©ºé—´ï¼Œå°±ä¼šå¯¼è‡´Full GCã€‚ éœ€è¦æ›´å¤šçš„CPUèµ„æºã€‚ç”±äºä½¿ç”¨äº†å¹¶å‘å¤„ç†ï¼Œå¾ˆå¤šæƒ…å†µä¸‹éƒ½æ˜¯GCçº¿ç¨‹å’Œåº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„ï¼Œè¿™æ ·å°±éœ€è¦å ç”¨æ›´å¤šçš„CPUèµ„æºï¼Œä¹Ÿæ˜¯ç‰ºç‰²äº†ä¸€å®šååé‡çš„åŸå› ã€‚ éœ€è¦æ›´å¤§çš„å †ç©ºé—´ã€‚å› ä¸ºCMSæ ‡è®°é˜¶æ®µåº”ç”¨ç¨‹åºçš„çº¿ç¨‹è¿˜æ˜¯æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å †ç©ºé—´ç»§ç»­åˆ†é…çš„é—®é¢˜ï¼Œä¸ºäº†ä¿éšœCMSåœ¨å›æ”¶å †ç©ºé—´ä¹‹å‰è¿˜æœ‰ç©ºé—´åˆ†é…ç»™æ–°åŠ å…¥çš„å¯¹è±¡ï¼Œå¿…é¡»é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ã€‚CMSé»˜è®¤åœ¨è€å¹´ä»£ç©ºé—´ä½¿ç”¨68%æ—¶å€™å¯åŠ¨åƒåœ¾å›æ”¶ã€‚å¯ä»¥é€šè¿‡-XX:CMSinitiatingOccupancyFraction=næ¥è®¾ç½®è¿™ä¸ªé˜€å€¼ã€‚ 7ã€GarbageFirstï¼ˆG1ï¼‰è¿™æ˜¯ä¸€ä¸ªæ–°çš„åƒåœ¾å›æ”¶å™¨ï¼Œæ—¢å¯ä»¥å›æ”¶æ–°ç”Ÿä»£ä¹Ÿå¯ä»¥å›æ”¶è€å¹´ä»£ï¼ŒSunHotSpot1.6u14ä»¥ä¸ŠEarlyAccessç‰ˆæœ¬åŠ å…¥äº†è¿™ä¸ªå›æ”¶å™¨ï¼ŒSunå…¬å¸é¢„æœŸSunHotSpot1.7å‘å¸ƒæ­£å¼ç‰ˆæœ¬ã€‚é€šè¿‡é‡æ–°åˆ’åˆ†å†…å­˜åŒºåŸŸï¼Œæ•´åˆä¼˜åŒ–CMSï¼ŒåŒæ—¶æ³¨é‡ååé‡å’Œå“åº”æ—¶é—´ã€‚æ¯å…·çš„æ˜¯Oracleæ”¶è´­è¿™ä¸ªæ”¶é›†å™¨ä¹‹åå°†å…¶ç”¨äºå•†ç”¨æ”¶è´¹ç‰ˆæ”¶é›†å™¨ã€‚å› æ­¤ç›®å‰æš‚æ—¶æ²¡æœ‰å‘ç°å“ªä¸ªå…¬å¸ä½¿ç”¨å®ƒï¼Œè¿™ä¸ªæ”¾åœ¨ä¹‹åå†å»ç ”ç©¶å§ã€‚ æ”¶é›†å™¨æ•´ç†æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼š Serial ï¼ˆ-XX:+UseSerialGCï¼‰ ParNewï¼ˆ-XX:+UseParNewGCï¼‰ ParallelScavengeï¼ˆ-XX:+UseParallelGCï¼‰ G1 æ”¶é›†å™¨ è€å¹´ä»£æ”¶é›†å™¨ï¼š SerialOldï¼ˆ-XX:+UseSerialOldGCï¼‰ ParallelOldï¼ˆ-XX:+UseParallelOldGCï¼‰ CMSï¼ˆ-XX:+UseConcMarkSweepGCï¼‰ G1 æ”¶é›†å™¨ å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²çš„åŒºåˆ«1ã€å†…å­˜æº¢å‡º å†…å­˜æº¢å‡ºæŒ‡çš„æ˜¯ç¨‹åºåœ¨ç”³è¯·å†…å­˜çš„æ—¶å€™ï¼Œæ²¡æœ‰è¶³å¤Ÿå¤§çš„ç©ºé—´å¯ä»¥åˆ†é…äº†ã€‚ 2ã€å†…å­˜æ³„éœ² å†…å­˜æ³„éœ²æŒ‡çš„æ˜¯ç¨‹åºåœ¨ç”³è¯·å†…å­˜ä¹‹åï¼Œæ²¡æœ‰åŠæ³•é‡Šæ”¾æ‰å·²ç»ç”³è¯·åˆ°å†…å­˜ï¼Œå®ƒå§‹ç»ˆå ç”¨ç€å†…å­˜ï¼Œå³è¢«åˆ†é…çš„å¯¹è±¡å¯è¾¾ä½†æ— ç”¨ã€‚å†…å­˜æ³„éœ²ä¸€èˆ¬éƒ½æ˜¯å› ä¸ºå†…å­˜ä¸­æœ‰ä¸€å—å¾ˆå¤§çš„å¯¹è±¡ï¼Œä½†æ˜¯æ— æ³•é‡Šæ”¾ã€‚ ä»å®šä¹‰ä¸Šå¯ä»¥çœ‹å‡ºï¼Œå†…å­˜æ³„éœ²ç»ˆå°†å¯¼è‡´å†…å­˜æº¢å‡ºã€‚ æ³¨æ„ï¼Œå®šä½è™šæ‹Ÿæœºé—®é¢˜å†…å­˜é—®é¢˜çš„æ—¶å€™ç¬¬ä¸€æ­¥å°±æ˜¯è¦åˆ¤æ–­åˆ°åº•æ˜¯å†…å­˜æº¢å‡ºè¿˜æ˜¯å†…å­˜æ³„éœ²ï¼Œå‰è€…å¥½åˆ¤æ–­ï¼Œè·Ÿè¸ªå †æ ˆä¿¡æ¯å°±å¯ä»¥äº†ï¼›åè€…æ¯”è¾ƒå¤æ‚ä¸€ç‚¹ï¼Œä¸€èˆ¬éƒ½æ˜¯è€å¹´ä»£ä¸­çš„å¤§å¯¹è±¡æ²¡é‡Šæ”¾æ‰ï¼Œè¦é€šè¿‡å„ç§åŠæ³•æ‰¾å‡ºè€å¹´ä»£ä¸­çš„å¤§å¯¹è±¡æ²¡æœ‰è¢«é‡Šæ”¾çš„åŸå› ã€‚ å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«è¿™ä¸¤ä¸ªåè¯éƒ½æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­çš„æ¦‚å¿µï¼Œåœ¨è°ˆè®ºåƒåœ¾æ”¶é›†å™¨çš„ä¸Šä¸‹æ–‡è¯­å¢ƒä¸­ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£è¿™ä¸¤ä¸ªåè¯ï¼š 1ã€å¹¶è¡ŒParallel å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ 2ã€å¹¶å‘Concurrent æŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆä½†å¹¶ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºè¿è¡Œäºå¦ä¸€ä¸ªCPUä¸Š Minor GCå’ŒFull GCçš„åŒºåˆ«1ã€æ–°ç”Ÿä»£GCï¼ˆMinor GCï¼‰ æŒ‡å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼Œå› ä¸ºå¤§å¤šæ•°Javaå¯¹è±¡å­˜æ´»ç‡éƒ½ä¸é«˜ï¼Œæ‰€ä»¥Minor GCéå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿« 2ã€è€å¹´ä»£GCï¼ˆMajor GC/Full GCï¼‰ æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼Œå‡ºç°äº†Major GCï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„Minor GCï¼ˆä½†å¹¶ä¸æ˜¯ç»å¯¹çš„ï¼‰ã€‚Major GCçš„é€Ÿåº¦ä¸€èˆ¬è¦æ¯”Minor GCæ…¢ä¸Š10å€ä»¥ä¸Š JVM å‚æ•°åˆ—è¡¨å‘½ä»¤æ ¼å¼1java -Xmx3550m -Xms3550m -Xmn2g -Xss128k -XX:NewRatio=4 -XX:SurvivorRatio=4 -XX:MaxPermSize=16m -XX:MaxTenuringThreshold=0 jvmå‚æ•°åˆ—è¡¨å†…å­˜ç›¸å…³å‚æ•° 12345678910111213141516171819202122232425-Xmx3550mï¼šæœ€å¤§å †å†…å­˜ä¸º3550Mã€‚-Xms3550mï¼šåˆå§‹å †å†…å­˜ä¸º3550mã€‚æ­¤å€¼å¯ä»¥è®¾ç½®ä¸-Xmxç›¸åŒï¼Œä»¥é¿å…æ¯æ¬¡åƒåœ¾å›æ”¶å®ŒæˆåJVMé‡æ–°åˆ†é…å†…å­˜ã€‚-Xmn2gï¼šè®¾ç½®å¹´è½»ä»£å¤§å°ä¸º2Gã€‚æ•´ä¸ªå †å¤§å°=å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å° + æŒä¹…ä»£å¤§å°ã€‚æŒä¹…ä»£ä¸€èˆ¬å›ºå®šå¤§å°ä¸º64mï¼Œæ‰€ä»¥å¢å¤§å¹´è½»ä»£åï¼Œå°†ä¼šå‡å°å¹´è€ä»£å¤§å°ã€‚æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§ï¼ŒSunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8ã€‚-Xss128kï¼šè®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ã€‚JDK5.0ä»¥åæ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º1Mï¼Œåœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹ï¼Œå‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹ã€‚ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸èƒ½æ— é™ç”Ÿæˆï¼Œç»éªŒå€¼åœ¨ 3000~5000å·¦å³ã€‚ -XX:NewRatio=4:è®¾ç½®å¹´è½»ä»£ï¼ˆåŒ…æ‹¬Edenå’Œä¸¤ä¸ªSurvivoråŒºï¼‰ä¸å¹´è€ä»£çš„æ¯”å€¼ï¼ˆé™¤å»æŒä¹…ä»£ï¼‰ã€‚è®¾ç½®ä¸º4ï¼Œåˆ™å¹´è½»ä»£ä¸å¹´è€ä»£æ‰€å æ¯”å€¼ä¸º1ï¼š4ï¼Œå¹´è½»ä»£å æ•´ä¸ªå †æ ˆçš„1/5-XX:SurvivorRatio=4ï¼šè®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ã€‚è®¾ç½®ä¸º4ï¼Œåˆ™ä¸¤ä¸ªSurvivoråŒºä¸ä¸€ä¸ªEdenåŒºçš„æ¯”å€¼ä¸º2:4ï¼Œä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªå¹´è½»ä»£çš„1/6-XX:MaxPermSize=16m:è®¾ç½®æŒä¹…ä»£å¤§å°ä¸º16mã€‚-XX:MaxTenuringThreshold=0ï¼šè®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„ã€‚å¦‚æœè®¾ç½®ä¸º0çš„è¯ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒºï¼Œç›´ æ¥è¿›å…¥å¹´è€ä»£ã€‚å¯¹äºå¹´è€ä»£æ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œå¯ä»¥æé«˜æ•ˆç‡ã€‚å¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§å€¼ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¼šåœ¨SurvivoråŒºè¿›è¡Œå¤šæ¬¡å¤åˆ¶ï¼Œè¿™æ ·å¯ä»¥å¢åŠ å¯¹è±¡ å†å¹´è½»ä»£çš„å­˜æ´»æ—¶é—´ï¼Œå¢åŠ åœ¨å¹´è½»ä»£å³è¢«å›æ”¶çš„æ¦‚è®ºã€‚ gcç›¸å…³å‚æ•° 12345678910111213141516171819202122232425-Xmx3550mï¼šæœ€å¤§å †å†…å­˜ä¸º3550Mã€‚-Xms3550mï¼šåˆå§‹å †å†…å­˜ä¸º3550mã€‚æ­¤å€¼å¯ä»¥è®¾ç½®ä¸-Xmxç›¸åŒï¼Œä»¥é¿å…æ¯æ¬¡åƒåœ¾å›æ”¶å®ŒæˆåJVMé‡æ–°åˆ†é…å†…å­˜ã€‚-Xmn2gï¼šè®¾ç½®å¹´è½»ä»£å¤§å°ä¸º2Gã€‚æ•´ä¸ªå †å¤§å°=å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å° + æŒä¹…ä»£å¤§å°ã€‚æŒä¹…ä»£ä¸€èˆ¬å›ºå®šå¤§å°ä¸º64mï¼Œæ‰€ä»¥å¢å¤§å¹´è½»ä»£åï¼Œå°†ä¼šå‡å°å¹´è€ä»£å¤§å°ã€‚æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§ï¼ŒSunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8ã€‚-Xss128kï¼šè®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ã€‚JDK5.0ä»¥åæ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º1Mï¼Œåœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹ï¼Œå‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹ã€‚ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸èƒ½æ— é™ç”Ÿæˆï¼Œç»éªŒå€¼åœ¨ 3000~5000å·¦å³ã€‚ -XX:NewRatio=4:è®¾ç½®å¹´è½»ä»£ï¼ˆåŒ…æ‹¬Edenå’Œä¸¤ä¸ªSurvivoråŒºï¼‰ä¸å¹´è€ä»£çš„æ¯”å€¼ï¼ˆé™¤å»æŒä¹…ä»£ï¼‰ã€‚è®¾ç½®ä¸º4ï¼Œåˆ™å¹´è½»ä»£ä¸å¹´è€ä»£æ‰€å æ¯”å€¼ä¸º1ï¼š4ï¼Œå¹´è½»ä»£å æ•´ä¸ªå †æ ˆçš„1/5-XX:SurvivorRatio=4ï¼šè®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ã€‚è®¾ç½®ä¸º4ï¼Œåˆ™ä¸¤ä¸ªSurvivoråŒºä¸ä¸€ä¸ªEdenåŒºçš„æ¯”å€¼ä¸º2:4ï¼Œä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªå¹´è½»ä»£çš„1/6-XX:MaxPermSize=16m:è®¾ç½®æŒä¹…ä»£å¤§å°ä¸º16mã€‚-XX:MaxTenuringThreshold=0ï¼šè®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„ã€‚å¦‚æœè®¾ç½®ä¸º0çš„è¯ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒºï¼Œç›´ æ¥è¿›å…¥å¹´è€ä»£ã€‚å¯¹äºå¹´è€ä»£æ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œå¯ä»¥æé«˜æ•ˆç‡ã€‚å¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§å€¼ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¼šåœ¨SurvivoråŒºè¿›è¡Œå¤šæ¬¡å¤åˆ¶ï¼Œè¿™æ ·å¯ä»¥å¢åŠ å¯¹è±¡ å†å¹´è½»ä»£çš„å­˜æ´»æ—¶é—´ï¼Œå¢åŠ åœ¨å¹´è½»ä»£å³è¢«å›æ”¶çš„æ¦‚è®ºã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[java ä»£ç†ã€åå°„]]></title>
    <url>%2F2019%2F12%2F24%2F14.Java%2FJava%E5%9F%BA%E7%A1%80%2Fjava%20%E4%BB%A3%E7%90%86%E3%80%81%E5%8F%8D%E5%B0%84%2F</url>
    <content type="text"><![CDATA[åå°„ä»€ä¹ˆæ˜¯åå°„ åœ¨Javaé‡Œé¢ä¸€ä¸ªç±»æœ‰ä¸¤ç§çŠ¶æ€â€“ç¼–è¯‘å’Œè¿è¡ŒçŠ¶æ€ï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦è·å–è¿™ä¸ªç±»çš„ä¿¡æ¯éƒ½æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µè·å¾—çš„ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥ç‚¹å‡ºæ¥æˆ–è€…newå‡ºæ¥ï¼Œå¯æ˜¯å¦‚æœéœ€è¦åœ¨ç±»è¿è¡Œçš„é˜¶æ®µè·å¾—Javaçš„ç±»çš„ä¿¡æ¯çš„è¯ï¼Œ å°±éœ€è¦ç”¨åˆ°Javaçš„åå°„ã€‚ åå°„çš„ä½œç”¨åå°„è¢«å¹¿æ³›åœ°ç”¨äºé‚£äº›éœ€è¦åœ¨è¿è¡Œæ—¶æ£€æµ‹æˆ–ä¿®æ”¹ç¨‹åºè¡Œä¸ºçš„ç¨‹åºä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹é«˜çº§çš„ç‰¹æ€§ï¼Œåªæœ‰é‚£äº›è¯­è¨€åŸºç¡€éå¸¸æ‰å®çš„å¼€å‘è€…æ‰åº”è¯¥ä½¿ç”¨å®ƒã€‚å¦‚æœèƒ½æŠŠè¿™å¥è­¦ç¤ºæ—¶åˆ»æ”¾åœ¨å¿ƒé‡Œï¼Œé‚£ä¹ˆåå°„æœºåˆ¶å°±ä¼šæˆä¸ºä¸€é¡¹å¼ºå¤§çš„æŠ€æœ¯ï¼Œå¯ä»¥è®©åº”ç”¨ç¨‹åºåšä¸€äº›å‡ ä¹ä¸å¯èƒ½åšåˆ°çš„äº‹æƒ…ã€‚ åå°„çš„ä½¿ç”¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.util.ArrayList;import java.util.List;import org.junit.Before;import org.junit.Test;public class MyReflect &#123; public String className = null; @SuppressWarnings("rawtypes") public Class personClass = null; /** * åå°„Personç±» * @throws Exception */ @Before public void init() throws Exception &#123; className = "cn.java.reflect.Person"; personClass = Class.forName(className); &#125; /** *è·å–æŸä¸ªclassæ–‡ä»¶å¯¹è±¡ */ @Test public void getClassName() throws Exception &#123; System.out.println(personClass); &#125; /** *è·å–æŸä¸ªclassæ–‡ä»¶å¯¹è±¡çš„å¦ä¸€ç§æ–¹å¼ */ @Test public void getClassName2() throws Exception &#123; System.out.println(Person.class); &#125; /** *åˆ›å»ºä¸€ä¸ªclassæ–‡ä»¶è¡¨ç¤ºçš„çœŸå®å¯¹è±¡ï¼Œåº•å±‚ä¼šè°ƒç”¨ç©ºå‚æ•°çš„æ„é€ æ–¹æ³• */ @Test public void getNewInstance() throws Exception &#123; System.out.println(personClass.newInstance()); &#125; /** *è·å–éç§æœ‰çš„æ„é€ å‡½æ•° */ @SuppressWarnings(&#123; "rawtypes", "unchecked" &#125;) @Test public void getPublicConstructor() throws Exception &#123; Constructor constructor = personClass.getConstructor(Long.class,String.class); Person person = (Person)constructor.newInstance(100L,"zhangsan"); System.out.println(person.getId()); System.out.println(person.getName()); &#125; /** *è·å¾—ç§æœ‰çš„æ„é€ å‡½æ•° */ @SuppressWarnings(&#123; "rawtypes", "unchecked" &#125;) @Test public void getPrivateConstructor() throws Exception &#123; Constructor con = personClass.getDeclaredConstructor(String.class); con.setAccessible(true);//å¼ºåˆ¶å–æ¶ˆJavaçš„æƒé™æ£€æµ‹ Person person2 = (Person)con.newInstance("zhangsan"); System.out.println(person2.getName()); &#125; /** *è·å–éç§æœ‰çš„æˆå‘˜å˜é‡ */ @SuppressWarnings(&#123; "rawtypes", "unchecked" &#125;) @Test public void getNotPrivateField() throws Exception &#123; Constructor constructor = personClass.getConstructor(Long.class,String.class); Object obj = constructor.newInstance(100L,"zhangsan"); Field field = personClass.getField("name"); field.set(obj, "lisi"); System.out.println(field.get(obj)); &#125; /** *è·å–ç§æœ‰çš„æˆå‘˜å˜é‡ */ @SuppressWarnings(&#123; "rawtypes", "unchecked" &#125;) @Test public void getPrivateField() throws Exception &#123; Constructor constructor = personClass.getConstructor(Long.class); Object obj = constructor.newInstance(100L); Field field2 = personClass.getDeclaredField("id"); field2.setAccessible(true);//å¼ºåˆ¶å–æ¶ˆJavaçš„æƒé™æ£€æµ‹ field2.set(obj,10000L); System.out.println(field2.get(obj)); &#125; /** *è·å–éç§æœ‰çš„æˆå‘˜å‡½æ•° */ @SuppressWarnings(&#123; "unchecked" &#125;) @Test public void getNotPrivateMethod() throws Exception &#123; System.out.println(personClass.getMethod("toString")); Object obj = personClass.newInstance();//è·å–ç©ºå‚çš„æ„é€ å‡½æ•° Object object = personClass.getMethod("toString").invoke(obj); System.out.println(object); &#125; /** *è·å–ç§æœ‰çš„æˆå‘˜å‡½æ•° */ @SuppressWarnings("unchecked") @Test public void getPrivateMethod() throws Exception &#123; Object obj = personClass.newInstance();//è·å–ç©ºå‚çš„æ„é€ å‡½æ•° Method method = personClass.getDeclaredMethod("getSomeThing"); method.setAccessible(true); Object value = method.invoke(obj); System.out.println(value); &#125; /** * */ @Test public void otherMethod() throws Exception &#123; //å½“å‰åŠ è½½è¿™ä¸ªclassæ–‡ä»¶çš„é‚£ä¸ªç±»åŠ è½½å™¨å¯¹è±¡ System.out.println(personClass.getClassLoader()); //è·å–æŸä¸ªç±»å®ç°çš„æ‰€æœ‰æ¥å£ Class[] interfaces = personClass.getInterfaces(); for (Class class1 : interfaces) &#123; System.out.println(class1); &#125; //åå°„å½“å‰è¿™ä¸ªç±»çš„ç›´æ¥çˆ¶ç±» System.out.println(personClass.getGenericSuperclass()); /** * getResourceAsStreamè¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–åˆ°ä¸€ä¸ªè¾“å…¥æµï¼Œè¿™ä¸ªè¾“å…¥æµä¼šå…³è”åˆ°nameæ‰€è¡¨ç¤ºçš„é‚£ä¸ªæ–‡ä»¶ä¸Šã€‚ */ //path ä¸ä»¥â€™/'å¼€å¤´æ—¶é»˜è®¤æ˜¯ä»æ­¤ç±»æ‰€åœ¨çš„åŒ…ä¸‹å–èµ„æºï¼Œä»¥â€™/'å¼€å¤´åˆ™æ˜¯ä»ClassPathæ ¹ä¸‹è·å–ã€‚å…¶åªæ˜¯é€šè¿‡pathæ„é€ ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œæœ€ç»ˆè¿˜æ˜¯ç”±ClassLoaderè·å–èµ„æºã€‚ System.out.println(personClass.getResourceAsStream("/log4j.properties")); //é»˜è®¤åˆ™æ˜¯ä»ClassPathæ ¹ä¸‹è·å–ï¼Œpathä¸èƒ½ä»¥â€™/'å¼€å¤´ï¼Œæœ€ç»ˆæ˜¯ç”±ClassLoaderè·å–èµ„æºã€‚ System.out.println(personClass.getResourceAsStream("/log4j.properties")); //åˆ¤æ–­å½“å‰çš„Classå¯¹è±¡è¡¨ç¤ºæ˜¯å¦æ˜¯æ•°ç»„ System.out.println(personClass.isArray()); System.out.println(new String[3].getClass().isArray()); //åˆ¤æ–­å½“å‰çš„Classå¯¹è±¡è¡¨ç¤ºæ˜¯å¦æ˜¯æšä¸¾ç±» System.out.println(personClass.isEnum()); System.out.println(Class.forName("cn.java.reflect.City").isEnum()); //åˆ¤æ–­å½“å‰çš„Classå¯¹è±¡è¡¨ç¤ºæ˜¯å¦æ˜¯æ¥å£ System.out.println(personClass.isInterface()); System.out.println(Class.forName("cn.java.reflect.TestInterface").isInterface()); &#125;&#125; åŠ¨æ€ä»£ç†java åŠ¨æ€ä»£ç†çš„è®¾è®¡æ¨¡å¼JavaåŠ¨æ€ä»£ç†çš„ä¼˜åŠ¿æ˜¯å®ç°æ— ä¾µå…¥å¼çš„ä»£ç æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•çš„å¢å¼ºï¼›è®©ä½ å¯ä»¥åœ¨ä¸ç”¨ä¿®æ”¹æºç çš„æƒ…å†µä¸‹ï¼Œå¢å¼ºä¸€äº›æ–¹æ³•ï¼›åœ¨æ–¹æ³•çš„å‰åä½ å¯ä»¥åšä½ ä»»ä½•æƒ³åšçš„äº‹æƒ…ï¼ˆç”šè‡³ä¸å»æ‰§è¡Œè¿™ä¸ªæ–¹æ³•å°±å¯ä»¥ï¼‰ã€‚ åŠ¨æ€ä»£ç†ä¸ºå…¶å®ƒå¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®æ§åˆ¶ï¼›åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®¢æˆ·ä¸æƒ³æˆ–è€…ä¸èƒ½ç›´æ¥å¼•ç”¨å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶å€™ä»£ç†å¯¹è±¡å¯ä»¥åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹çš„ä½œç”¨ã€‚ é™æ€ä»£ç† é™æ€ä»£ç†ç±»ï¼šç”±ç¨‹åºå‘˜åˆ›å»ºæˆ–è€…ç”±ç¬¬ä¸‰æ–¹å·¥å…·ç”Ÿæˆï¼Œå†è¿›è¡Œç¼–è¯‘ï¼›åœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œä»£ç†ç±»çš„.classæ–‡ä»¶å·²ç»å­˜åœ¨äº†ã€‚ é™æ€ä»£ç†ç±»é€šå¸¸åªä»£ç†ä¸€ä¸ªç±»ã€‚ é™æ€ä»£ç†äº‹å…ˆçŸ¥é“è¦ä»£ç†çš„æ˜¯ä»€ä¹ˆã€‚ åŠ¨æ€ä»£ç† åŠ¨æ€ä»£ç†ç±»ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡åå°„æœºåˆ¶åŠ¨æ€ç”Ÿæˆã€‚ åŠ¨æ€ä»£ç†ç±»é€šå¸¸ä»£ç†æ¥å£ä¸‹çš„æ‰€æœ‰ç±»ã€‚ åŠ¨æ€ä»£ç†äº‹å…ˆä¸çŸ¥é“è¦ä»£ç†çš„æ˜¯ä»€ä¹ˆï¼Œåªæœ‰åœ¨è¿è¡Œçš„æ—¶å€™æ‰èƒ½ç¡®å®šã€‚ åŠ¨æ€ä»£ç†çš„è°ƒç”¨å¤„ç†ç¨‹åºå¿…é¡»å®ç°InvocationHandleræ¥å£ï¼ŒåŠä½¿ç”¨Proxyç±»ä¸­çš„newProxyInstanceæ–¹æ³•åŠ¨æ€çš„åˆ›å»ºä»£ç†ç±»ã€‚ JavaåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ¥å£ï¼Œè¦ä»£ç†ç±»éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„CLIGBç­‰ç±»åº“ã€‚ åŠ¨æ€ä»£ç†å®ç°æµç¨‹ ä¹¦å†™ä»£ç†ç±»å’Œä»£ç†æ–¹æ³•ï¼Œåœ¨ä»£ç†æ–¹æ³•ä¸­å®ç°ä»£ç†Proxy.newProxyInstance ä»£ç†ä¸­éœ€è¦çš„å‚æ•°åˆ†åˆ«ä¸ºï¼šè¢«ä»£ç†çš„ç±»çš„ç±»åŠ è½½å™¨soneObjectclass.getClassLoader()ï¼Œè¢«ä»£ç†ç±»çš„æ‰€æœ‰å®ç°æ¥å£ new Class[] { Interface.class }ï¼Œå¥æŸ„æ–¹æ³•new InvocationHandler() åœ¨å¥æŸ„æ–¹æ³•ä¸­å¤å†™invokeæ–¹æ³•ï¼Œinvokeæ–¹æ³•çš„è¾“å…¥æœ‰3ä¸ªå‚æ•°Object proxyï¼ˆä»£ç†ç±»å¯¹è±¡ï¼‰, Method methodï¼ˆè¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼‰,Object[] argsï¼ˆè¢«ä»£ç†ç±»æ–¹æ³•çš„ä¼ å…¥å‚æ•°ï¼‰ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶åŒ–çš„å¼€å‘æ–°çš„ä¸šåŠ¡ã€‚ è·å–ä»£ç†ç±»ï¼Œå¼ºè½¬æˆè¢«ä»£ç†çš„æ¥å£ æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åƒæ²¡è¢«ä»£ç†ä¸€æ ·ï¼Œè°ƒç”¨æ¥å£çš„è®¤å¯æ–¹æ³•ï¼Œæ–¹æ³•è¢«è°ƒç”¨åï¼Œæ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨å°†è¢«ä¼ å…¥ä»£ç†ç±»çš„invokeæ–¹æ³•ä¸­ï¼Œè¿›è¡Œæ–°ä¸šåŠ¡çš„é€»è¾‘æµç¨‹ã€‚ åŠ¨æ€ä»£ç†ä»£ç ç¤ºä¾‹æ¥å£ç±» 123public interface IBoss &#123;//æ¥å£ int yifu(String size);&#125; ä¸šåŠ¡ä»£ç  1234567public class Boss implements IBoss&#123; public int yifu(String size)&#123; System.err.println("å¤©çŒ«å°å¼ºæ——èˆ°åº—ï¼Œè€æ¿ç»™å®¢æˆ·å‘å¿«é€’----è¡£æœå‹å·ï¼š"+size); //è¿™ä»¶è¡£æœçš„ä»·é’±ï¼Œä»æ•°æ®åº“è¯»å– return 50; &#125;&#125; åŸè°ƒç”¨æ–¹æ³•è°ƒç”¨ä»£ç  123456789public class SaleAction &#123; @Test public void saleByBossSelf() throws Exception &#123; IBoss boss = new Boss(); System.out.println("è€æ¿è‡ªè¥ï¼"); int money = boss.yifu("xxl"); System.out.println("è¡£æœæˆäº¤ä»·ï¼š" + money); &#125;&#125; ä½¿ç”¨ä»£ç†ç±»è¿›è¡Œè°ƒç”¨ä»£ç†ç±» 12345678910111213public static IBoss getProxyBoss(final int discountCoupon) throws Exception &#123; Object proxedObj = Proxy.newProxyInstance(Boss.class.getClassLoader(), new Class[] &#123; IBoss.class &#125;, new InvocationHandler() &#123; public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; Integer returnValue = (Integer) method.invoke(new Boss(), args);// è°ƒç”¨åŸå§‹å¯¹è±¡ä»¥åè¿”å›çš„å€¼ return returnValue - discountCoupon; &#125; &#125;); return (IBoss)proxedObj;&#125;&#125; é€šè¿‡ä»£ç†è°ƒç”¨ä»£ç  123456789public class ProxySaleAction &#123; @Test public void saleByProxy() throws Exception &#123; IBoss boss = ProxyBoss.getProxyBoss(20);// å°†ä»£ç†çš„æ–¹æ³•å®ä¾‹åŒ–æˆæ¥å£ System.out.println("ä»£ç†ç»è¥ï¼"); int money = boss.yifu("xxl");// è°ƒç”¨æ¥å£çš„æ–¹æ³•ï¼Œå®é™…ä¸Šè°ƒç”¨æ–¹å¼æ²¡æœ‰å˜ System.out.println("è¡£æœæˆäº¤ä»·ï¼š" + money); &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[java JMSåŸºç¡€]]></title>
    <url>%2F2019%2F12%2F23%2F14.Java%2FJava%E5%9F%BA%E7%A1%80%2FJMS%E5%9F%BA%E7%A1%80%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯JMSâ€‹ JMSå³Javaæ¶ˆæ¯æœåŠ¡ï¼ˆJava Message Serviceï¼‰åº”ç”¨ç¨‹åºæ¥å£æ˜¯ä¸€ä¸ªJavaå¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMOMï¼‰çš„APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚Javaæ¶ˆæ¯æœåŠ¡æ˜¯ä¸€ä¸ªä¸å…·ä½“å¹³å°æ— å…³çš„APIï¼Œç»å¤§å¤šæ•°MOMæä¾›å•†éƒ½å¯¹JMSæä¾›æ”¯æŒã€‚â€‹ JMSæ˜¯ä¸€ç§ä¸å‚å•†æ— å…³çš„ APIï¼Œç”¨æ¥è®¿é—®æ¶ˆæ¯æ”¶å‘ç³»ç»Ÿæ¶ˆæ¯ã€‚å®ƒç±»ä¼¼äºJDBC(Java Database Connectivity)ï¼šè¿™é‡Œï¼ŒJDBC æ˜¯å¯ä»¥ç”¨æ¥è®¿é—®è®¸å¤šä¸åŒå…³ç³»æ•°æ®åº“çš„ APIï¼Œè€Œ JMS åˆ™æä¾›åŒæ ·ä¸å‚å•†æ— å…³çš„è®¿é—®æ–¹æ³•ï¼Œä»¥è®¿é—®æ¶ˆæ¯æ”¶å‘æœåŠ¡ã€‚è®¸å¤šå‚å•†éƒ½æ”¯æŒ JMSï¼ŒåŒ…æ‹¬ IBM çš„ MQSeriesã€BEAçš„ Weblogic JMS serviceå’Œ Progress çš„ SonicMQï¼Œè¿™åªæ˜¯å‡ ä¸ªä¾‹å­ã€‚ JMS ä½¿æ‚¨èƒ½å¤Ÿé€šè¿‡æ¶ˆæ¯æ”¶å‘æœåŠ¡ï¼ˆæœ‰æ—¶ç§°ä¸ºæ¶ˆæ¯ä¸­ä»‹ç¨‹åºæˆ–è·¯ç”±å™¨ï¼‰ä»ä¸€ä¸ª JMS å®¢æˆ·æœºå‘å¦ä¸€ä¸ª JMSå®¢æˆ·æœºå‘é€æ¶ˆæ¯ã€‚æ¶ˆæ¯æ˜¯ JMS ä¸­çš„ä¸€ç§ç±»å‹å¯¹è±¡ï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæŠ¥å¤´å’Œæ¶ˆæ¯ä¸»ä½“ã€‚æŠ¥å¤´ç”±è·¯ç”±ä¿¡æ¯ä»¥åŠæœ‰å…³è¯¥æ¶ˆæ¯çš„å…ƒæ•°æ®ç»„æˆã€‚æ¶ˆæ¯ä¸»ä½“åˆ™æºå¸¦ç€åº”ç”¨ç¨‹åºçš„æ•°æ®æˆ–æœ‰æ•ˆè´Ÿè½½ã€‚æ ¹æ®æœ‰æ•ˆè´Ÿè½½çš„ç±»å‹æ¥åˆ’åˆ†ï¼Œå¯ä»¥å°†æ¶ˆæ¯åˆ†ä¸ºå‡ ç§ç±»å‹ï¼Œå®ƒä»¬åˆ†åˆ«æºå¸¦ï¼šç®€å•æ–‡æœ¬(TextMessage)ã€å¯åºåˆ—åŒ–çš„å¯¹è±¡ (ObjectMessage)ã€å±æ€§é›†åˆ (MapMessage)ã€å­—èŠ‚æµ (BytesMessage)ã€åŸå§‹å€¼æµ (StreamMessage)ï¼Œè¿˜æœ‰æ— æœ‰æ•ˆè´Ÿè½½çš„æ¶ˆæ¯ (Message)ã€‚ JMSè§„èŒƒ ä¸“ä¸šæŠ€æœ¯è§„èŒƒJMSï¼ˆJava Messaging Serviceï¼‰æ˜¯Javaå¹³å°ä¸Šæœ‰å…³é¢å‘æ¶ˆæ¯ä¸­é—´ä»¶(MOM)çš„æŠ€æœ¯è§„èŒƒï¼Œå®ƒä¾¿äºæ¶ˆæ¯ç³»ç»Ÿä¸­çš„Javaåº”ç”¨ç¨‹åºè¿›è¡Œæ¶ˆæ¯äº¤æ¢,å¹¶ä¸”é€šè¿‡æä¾›æ ‡å‡†çš„äº§ç”Ÿã€å‘é€ã€æ¥æ”¶æ¶ˆæ¯çš„æ¥å£ç®€åŒ–ä¼ä¸šåº”ç”¨çš„å¼€å‘ï¼Œç¿»è¯‘ä¸ºJavaæ¶ˆæ¯æœåŠ¡ã€‚ ä½“ç³»æ¶æ„JMSç”±ä»¥ä¸‹å…ƒç´ ç»„æˆã€‚JMSæä¾›è€…providerï¼šè¿æ¥é¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„ï¼ŒJMSæ¥å£çš„ä¸€ä¸ªå®ç°ã€‚æä¾›è€…å¯ä»¥æ˜¯Javaå¹³å°çš„JMSå®ç°ï¼Œä¹Ÿå¯ä»¥æ˜¯éJavaå¹³å°çš„é¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„é€‚é…å™¨ã€‚JMSå®¢æˆ·ï¼šç”Ÿäº§æˆ–æ¶ˆè´¹åŸºäºæ¶ˆæ¯çš„Javaçš„åº”ç”¨ç¨‹åºæˆ–å¯¹è±¡ã€‚JMSç”Ÿäº§è€…ï¼šåˆ›å»ºå¹¶å‘é€æ¶ˆæ¯çš„JMSå®¢æˆ·ã€‚JMSæ¶ˆè´¹è€…ï¼šæ¥æ”¶æ¶ˆæ¯çš„JMSå®¢æˆ·ã€‚JMSæ¶ˆæ¯ï¼šåŒ…æ‹¬å¯ä»¥åœ¨JMSå®¢æˆ·ä¹‹é—´ä¼ é€’çš„æ•°æ®çš„å¯¹è±¡JMSé˜Ÿåˆ—ï¼šä¸€ä¸ªå®¹çº³é‚£äº›è¢«å‘é€çš„ç­‰å¾…é˜…è¯»çš„æ¶ˆæ¯çš„åŒºåŸŸã€‚ä¸é˜Ÿåˆ—åå­—æ‰€æš—ç¤ºçš„æ„æ€ä¸åŒï¼Œæ¶ˆæ¯çš„æ¥å—é¡ºåºå¹¶ä¸ä¸€å®šè¦ä¸æ¶ˆæ¯çš„å‘é€é¡ºåºç›¸åŒã€‚ä¸€æ—¦ä¸€ä¸ªæ¶ˆæ¯è¢«é˜…è¯»ï¼Œè¯¥æ¶ˆæ¯å°†è¢«ä»é˜Ÿåˆ—ä¸­ç§»èµ°ã€‚JMSä¸»é¢˜ï¼šä¸€ç§æ”¯æŒå‘é€æ¶ˆæ¯ç»™å¤šä¸ªè®¢é˜…è€…çš„æœºåˆ¶ã€‚ Javaæ¶ˆæ¯æœåŠ¡åº”ç”¨ç¨‹åºç»“æ„æ”¯æŒä¸¤ç§æ¨¡å‹1ã€ç‚¹å¯¹ç‚¹æˆ–é˜Ÿåˆ—æ¨¡å‹åœ¨ç‚¹å¯¹ç‚¹æˆ–é˜Ÿåˆ—æ¨¡å‹ä¸‹ï¼Œä¸€ä¸ªç”Ÿäº§è€…å‘ä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—å‘å¸ƒæ¶ˆæ¯ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ä»è¯¥é˜Ÿåˆ—ä¸­è¯»å–æ¶ˆæ¯ã€‚è¿™é‡Œï¼Œç”Ÿäº§è€…çŸ¥é“æ¶ˆè´¹è€…çš„é˜Ÿåˆ—ï¼Œå¹¶ç›´æ¥å°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆè´¹è€…çš„é˜Ÿåˆ—ã€‚ è¿™ç§æ¨¡å¼è¢«æ¦‚æ‹¬ä¸ºï¼šåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å°†è·å¾—æ¶ˆæ¯ç”Ÿäº§è€…ä¸éœ€è¦åœ¨æ¥æ”¶è€…æ¶ˆè´¹è¯¥æ¶ˆæ¯æœŸé—´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæ¥æ”¶è€…ä¹ŸåŒæ ·ä¸éœ€è¦åœ¨æ¶ˆæ¯å‘é€æ—¶å¤„äºè¿è¡ŒçŠ¶æ€ã€‚æ¯ä¸€ä¸ªæˆåŠŸå¤„ç†çš„æ¶ˆæ¯éƒ½ç”±æ¥æ”¶è€…ç­¾æ”¶ 2ã€å‘å¸ƒè€…/è®¢é˜…è€…æ¨¡å‹å‘å¸ƒè€…/è®¢é˜…è€…æ¨¡å‹æ”¯æŒå‘ä¸€ä¸ªç‰¹å®šçš„æ¶ˆæ¯ä¸»é¢˜å‘å¸ƒæ¶ˆæ¯ã€‚0æˆ–å¤šä¸ªè®¢é˜…è€…å¯èƒ½å¯¹æ¥æ”¶æ¥è‡ªç‰¹å®šæ¶ˆæ¯ä¸»é¢˜çš„æ¶ˆæ¯æ„Ÿå…´è¶£ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸‹ï¼Œå‘å¸ƒè€…å’Œè®¢é˜…è€…å½¼æ­¤ä¸çŸ¥é“å¯¹æ–¹ã€‚è¿™ç§æ¨¡å¼å¥½æ¯”æ˜¯åŒ¿åå…¬å‘Šæ¿ã€‚ è¿™ç§æ¨¡å¼è¢«æ¦‚æ‹¬ä¸ºï¼šå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥è·å¾—æ¶ˆæ¯åœ¨å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´å­˜åœ¨æ—¶é—´ä¾èµ–æ€§ã€‚å‘å¸ƒè€…éœ€è¦å»ºç«‹ä¸€ä¸ªè®¢é˜…ï¼ˆsubscriptionï¼‰ï¼Œä»¥ä¾¿å®¢æˆ·èƒ½å¤Ÿè®¢é˜…ã€‚è®¢é˜…è€…å¿…é¡»ä¿æŒæŒç»­çš„æ´»åŠ¨çŠ¶æ€ä»¥æ¥æ”¶æ¶ˆæ¯ï¼Œé™¤éè®¢é˜…è€…å»ºç«‹äº†æŒä¹…çš„è®¢é˜…ã€‚åœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œåœ¨è®¢é˜…è€…æœªè¿æ¥æ—¶å‘å¸ƒçš„æ¶ˆæ¯å°†åœ¨è®¢é˜…è€…é‡æ–°è¿æ¥æ—¶é‡æ–°å‘å¸ƒã€‚ acitveMQéƒ¨ç½²1.ä¸‹è½½ActiveMQå»å®˜æ–¹ç½‘ç«™ä¸‹è½½ï¼šhttp://activemq.apache.org/ 2.è¿è¡ŒActiveMQè§£å‹ç¼©apache-activemq-5.5.1-bin.zipï¼Œ ä¿®æ”¹é…ç½®æ–‡ä»¶activeMQ.xmlï¼Œå°†0.0.0.0ä¿®æ”¹ä¸ºlocalhost 123456&lt;transportConnectors&gt; &lt;transportConnector name="openwire" uri="tcp://localhost:61616"/&gt; &lt;transportConnector name="ssl" uri="ssl://localhost:61617"/&gt; &lt;transportConnector name="stomp" uri="stomp://localhost:61613"/&gt; &lt;transportConnector uri="http://localhost:8081"/&gt; &lt;transportConnector uri="udp://localhost:61618"/&gt; ç„¶ååŒå‡»apache-activemq-5.5.1\bin\activemq.batè¿è¡ŒActiveMQç¨‹åºã€‚ å¯åŠ¨ActiveMQä»¥åï¼Œç™»é™†ï¼šhttp://localhost:8161/admin/ï¼Œåˆ›å»ºä¸€ä¸ªQueueï¼Œå‘½åä¸ºFirstQueueã€‚ activeMQä½¿ç”¨ä»£ç ç¤ºä¾‹æ¶ˆè´¹è€…ä½¿ç”¨æ–¹æ³•consumerTool 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374import javax.jms.Connection; import javax.jms.Destination; import javax.jms.ExceptionListener;import javax.jms.JMSException; import javax.jms.MessageConsumer; import javax.jms.Session; import javax.jms.MessageListener; import javax.jms.Message; import javax.jms.TextMessage; import org.apache.activemq.ActiveMQConnection; import org.apache.activemq.ActiveMQConnectionFactory; public class ConsumerTool implements MessageListener,ExceptionListener &#123; private String user = ActiveMQConnection.DEFAULT_USER; private String password = ActiveMQConnection.DEFAULT_PASSWORD; private String url =ActiveMQConnection.DEFAULT_BROKER_URL; private String subject = "mytopic"; private Destination destination = null; private Connection connection = null; private Session session = null; private MessageConsumer consumer = null; public static Boolean isconnection=false; // åˆå§‹åŒ– private void initialize() throws JMSException, Exception &#123; ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory( user, password, url); connection = connectionFactory.createConnection(); session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); destination = session.createTopic(subject); consumer = session.createConsumer(destination); &#125; // æ¶ˆè´¹æ¶ˆæ¯ public void consumeMessage() throws JMSException, Exception &#123; initialize(); connection.start(); consumer.setMessageListener(this); connection.setExceptionListener(this); isconnection=true; System.out.println("Consumer:-&gt;Begin listening..."); // å¼€å§‹ç›‘å¬ // Message message = consumer.receive(); &#125; // å…³é—­è¿æ¥ public void close() throws JMSException &#123; System.out.println("Consumer:-&gt;Closing connection"); if (consumer != null) consumer.close(); if (session != null) session.close(); if (connection != null) connection.close(); &#125; // æ¶ˆæ¯å¤„ç†å‡½æ•° public void onMessage(Message message) &#123; try &#123; if (message instanceof TextMessage) &#123; TextMessage txtMsg = (TextMessage) message; String msg = txtMsg.getText(); System.out.println("Consumer:-&gt;Received: " + msg); &#125; else &#123; System.out.println("Consumer:-&gt;Received: " + message); &#125; &#125; catch (JMSException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; public void onException(JMSException arg0) &#123; isconnection=false; &#125; &#125; consumerRun 123456789101112131415161718192021222324252627282930313233343536373839404142434445import javax.jms.JMSException;public class ConsumerTest implements Runnable &#123; static Thread t1 = null; /** * @param args * @throws InterruptedException * @throws InterruptedException * @throws JMSException * @throws InterruptedException */ public static void main(String[] args) throws InterruptedException &#123; t1 = new Thread(new ConsumerTest()); t1.setDaemon(false); t1.start(); /** * å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™é‡å¯consumer */ /*while (true) &#123; System.out.println(t1.isAlive()); if (!t1.isAlive()) &#123; t1 = new Thread(new ConsumerTest()); t1.start(); System.out.println("é‡æ–°å¯åŠ¨"); &#125; Thread.sleep(5000); &#125;*/ // å»¶æ—¶500æ¯«ç§’ä¹‹ååœæ­¢æ¥å—æ¶ˆæ¯ // Thread.sleep(500); // consumer.close(); &#125; public void run() &#123; try &#123; ConsumerTool consumer = new ConsumerTool(); consumer.consumeMessage(); while (ConsumerTool.isconnection) &#123; &#125; &#125; catch (Exception e) &#123; &#125; &#125;&#125; å‘å¸ƒè€…ä½¿ç”¨producerTool 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import javax.jms.Connection; import javax.jms.DeliveryMode; import javax.jms.Destination; import javax.jms.JMSException; import javax.jms.MessageProducer; import javax.jms.Session; import javax.jms.TextMessage; import org.apache.activemq.ActiveMQConnection; import org.apache.activemq.ActiveMQConnectionFactory; public class ProducerTool &#123; private String user = ActiveMQConnection.DEFAULT_USER; private String password = ActiveMQConnection.DEFAULT_PASSWORD; private String url = ActiveMQConnection.DEFAULT_BROKER_URL; private String subject = "mytopic"; private Destination destination = null; private Connection connection = null; private Session session = null; private MessageProducer producer = null; // åˆå§‹åŒ– private void initialize() throws JMSException, Exception &#123; ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory( user, password, url); connection = connectionFactory.createConnection(); session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); destination = session.createTopic(subject); producer = session.createProducer(destination); producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT); &#125; // å‘é€æ¶ˆæ¯ public void produceMessage(String message) throws JMSException, Exception &#123; initialize(); TextMessage msg = session.createTextMessage(message); connection.start(); System.out.println("Producer:-&gt;Sending message: " + message); producer.send(msg); System.out.println("Producer:-&gt;Message sent complete!"); &#125; // å…³é—­è¿æ¥ public void close() throws JMSException &#123; System.out.println("Producer:-&gt;Closing connection"); if (producer != null) producer.close(); if (session != null) session.close(); if (connection != null) connection.close(); &#125; &#125; producerRun 12345678910111213141516171819202122import java.util.Random;import javax.jms.JMSException; public class ProducerTest &#123; /** * @param args */ public static void main(String[] args) throws JMSException, Exception &#123; ProducerTool producer = new ProducerTool(); Random random = new Random(); for(int i=0;i&lt;20;i++)&#123; Thread.sleep(random.nextInt(10)*1000); producer.produceMessage("Hello, world!--"+i); producer.close(); &#125; &#125; &#125; JMS å®ç°è¦ ä½¿ç”¨Javaæ¶ˆæ¯æœåŠ¡ï¼Œä½ å¿…é¡»è¦æœ‰ä¸€ä¸ªJMSæä¾›è€…ï¼Œç®¡ç†ä¼šè¯å’Œé˜Ÿåˆ—ã€‚æ—¢æœ‰å¼€æºçš„æä¾›è€…ä¹Ÿæœ‰ä¸“æœ‰çš„æä¾›è€…ã€‚ å¼€æºçš„æä¾›è€…åŒ…æ‹¬ï¼š Apache ActiveMQ JBoss ç¤¾åŒºæ‰€ç ”å‘çš„ HornetQ Joram Coridançš„MantaRay The OpenJMS Groupçš„OpenJMS ä¸“æœ‰çš„æä¾›è€…åŒ…æ‹¬ï¼š BEAçš„BEA WebLogic Server JMS TIBCO Softwareçš„EMS GigaSpaces Technologiesçš„GigaSpaces Softwired 2006çš„iBus IONA Technologiesçš„IONA JMS SeeBeyondçš„IQManagerï¼ˆ2005å¹´8æœˆè¢«Sun Microsystemså¹¶è´­ï¼‰ webMethodsçš„JMS+ - my-channelsçš„Nirvana Sonic Softwareçš„SonicMQ SwiftMQçš„SwiftMQ IBMçš„WebSphere MQ kafkaä¸æ»¡è¶³æœ‰åºçš„é˜Ÿåˆ—ï¼Œæ‰€ä»¥åªå¯ä½œä¸ºç¼“å­˜ä¸­é—´ä»¶]]></content>
      <categories>
        <category>Java</category>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[java å¤šçº¿ç¨‹]]></title>
    <url>%2F2019%2F12%2F23%2F14.Java%2FJava%E5%9F%BA%E7%A1%80%2F%E5%A4%9A%E7%BA%BF%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[è¿›ç¨‹å’Œçº¿ç¨‹ä»‹ç»ä»€ä¹ˆæ˜¯è¿›ç¨‹â€‹ ä¸ç®¡æ˜¯æˆ‘ä»¬å¼€å‘çš„åº”ç”¨ç¨‹åºï¼Œè¿˜æ˜¯æˆ‘ä»¬è¿è¡Œçš„å…¶ä»–çš„åº”ç”¨ç¨‹åºï¼Œéƒ½éœ€è¦å…ˆæŠŠç¨‹åºå®‰è£…åœ¨æœ¬åœ°çš„ç¡¬ç›˜ä¸Šã€‚ç„¶åæ‰¾åˆ°è¿™ä¸ªç¨‹åºçš„å¯åŠ¨æ–‡ä»¶ï¼Œå¯åŠ¨ç¨‹åºçš„æ—¶å€™ï¼Œå…¶å®æ˜¯ç”µè„‘æŠŠå½“å‰çš„è¿™ä¸ªç¨‹åºåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåœ¨å†…å­˜ä¸­éœ€è¦ç»™å½“å‰çš„ç¨‹åºåˆ†é…ä¸€æ®µç‹¬ç«‹çš„è¿è¡Œç©ºé—´ã€‚è¿™ç‰‡ç©ºé—´å°±ä¸“é—¨è´Ÿè´£å½“å‰è¿™ä¸ªç¨‹åºçš„è¿è¡Œã€‚ â€‹ ä¸åŒçš„åº”ç”¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­éƒ½éœ€è¦åœ¨å†…å­˜ä¸­åˆ†é…è‡ªå·±ç‹¬ç«‹çš„è¿è¡Œç©ºé—´ï¼Œå½¼æ­¤ä¹‹é—´ä¸ä¼šç›¸äº’çš„å½±å“ã€‚æˆ‘ä»¬æŠŠæ¯ä¸ªç‹¬ç«‹åº”ç”¨ç¨‹åºåœ¨å†…å­˜çš„ç‹¬ç«‹ç©ºé—´ç§°ä¸ºå½“å‰åº”ç”¨ç¨‹åºè¿è¡Œçš„ä¸€ä¸ªè¿›ç¨‹ã€‚ è¿›ç¨‹ï¼šå®ƒæ˜¯å†…å­˜ä¸­çš„ä¸€æ®µç‹¬ç«‹çš„ç©ºé—´ï¼Œå¯ä»¥è´Ÿè´£å½“å‰åº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚å½“å‰è¿™ä¸ªè¿›ç¨‹è´Ÿè´£è°ƒåº¦å½“å‰ç¨‹åºä¸­çš„æ‰€æœ‰è¿è¡Œç»†èŠ‚ã€‚ ä»€ä¹ˆæ˜¯çº¿ç¨‹â€‹ å¯åŠ¨çš„QQèŠå¤©è½¯ä»¶ï¼Œéœ€è¦å’Œå¤šä¸ªäººè¿›è¡ŒèŠå¤©ã€‚è¿™æ—¶å¤šä¸ªäººä¹‹é—´æ˜¯ä¸èƒ½ç›¸äº’å½±å“ï¼Œä½†æ˜¯å®ƒä»¬éƒ½ä½äºå½“å‰QQè¿™ä¸ªè½¯ä»¶è¿è¡Œæ—¶æ‰€åˆ†é…çš„å†…å­˜çš„ç‹¬ç«‹ç©ºé—´ä¸­ã€‚ â€‹ åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ¯ä¸ªç‹¬ç«‹çš„åŠŸèƒ½éƒ½éœ€è¦ç‹¬ç«‹çš„å»è¿è¡Œï¼Œè¿™æ—¶åˆéœ€è¦æŠŠå½“å‰è¿™ä¸ªè¿›ç¨‹åˆ’åˆ†æˆå¤šä¸ªè¿è¡ŒåŒºåŸŸï¼Œæ¯ä¸ªç‹¬ç«‹çš„å°åŒºåŸŸï¼ˆå°å•å…ƒï¼‰ç§°ä¸ºä¸€ä¸ªçº¿ç¨‹ã€‚ çº¿ç¨‹ï¼šå®ƒæ˜¯ä½äºè¿›ç¨‹ä¸­ï¼Œè´Ÿè´£å½“å‰è¿›ç¨‹ä¸­çš„æŸä¸ªå…·å¤‡ç‹¬ç«‹è¿è¡Œèµ„æ ¼çš„ç©ºé—´ã€‚ è¿›ç¨‹æ˜¯è´Ÿè´£æ•´ä¸ªç¨‹åºçš„è¿è¡Œï¼Œè€Œçº¿ç¨‹æ˜¯ç¨‹åºä¸­å…·ä½“çš„æŸä¸ªç‹¬ç«‹åŠŸèƒ½çš„è¿è¡Œã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘åº”è¯¥æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ å¤šçº¿ç¨‹ä»‹ç»â€‹ ç°åœ¨çš„æ“ä½œç³»ç»ŸåŸºæœ¬éƒ½æ˜¯å¤šç”¨æˆ·ï¼Œå¤šä»»åŠ¡çš„æ“ä½œç³»ç»Ÿã€‚æ¯ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚è€Œåœ¨è¿™ä¸ªè¿›ç¨‹ä¸­å°±ä¼šæœ‰çº¿ç¨‹ã€‚ â€‹ çœŸæ­£å¯ä»¥å®Œæˆç¨‹åºè¿è¡Œå’ŒåŠŸèƒ½çš„å®ç°é çš„æ˜¯è¿›ç¨‹ä¸­çš„çº¿ç¨‹ã€‚ å¤šçº¿ç¨‹ï¼šåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæˆ‘ä»¬åŒæ—¶å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œè®©å¤šä¸ªçº¿ç¨‹åŒæ—¶å»å®ŒæˆæŸäº›ä»»åŠ¡ï¼ˆåŠŸèƒ½ï¼‰ã€‚ (æ¯”å¦‚åå°æœåŠ¡ç³»ç»Ÿï¼Œå°±å¯ä»¥ç”¨å¤šä¸ªçº¿ç¨‹åŒæ—¶å“åº”å¤šä¸ªå®¢æˆ·çš„è¯·æ±‚) å¤šçº¿ç¨‹çš„ç›®çš„ï¼šæé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚ å¤šçº¿ç¨‹è¿è¡ŒåŸç†â€‹ cpuåœ¨çº¿ç¨‹ä¸­åšæ—¶é—´ç‰‡çš„åˆ‡æ¢ã€‚ â€‹ å…¶å®çœŸæ­£ç”µè„‘ä¸­çš„ç¨‹åºçš„è¿è¡Œä¸æ˜¯åŒæ—¶åœ¨è¿è¡Œçš„ã€‚CPUè´Ÿè´£ç¨‹åºçš„è¿è¡Œï¼Œè€ŒCPUåœ¨è¿è¡Œç¨‹åºçš„è¿‡ç¨‹ä¸­æŸä¸ªæ—¶åˆ»ç‚¹ä¸Šï¼Œå®ƒå…¶å®åªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºã€‚è€Œä¸æ˜¯å¤šä¸ªç¨‹åºã€‚è€ŒCPUå®ƒå¯ä»¥åœ¨å¤šä¸ªç¨‹åºä¹‹é—´è¿›è¡Œé«˜é€Ÿçš„åˆ‡æ¢ã€‚è€Œåˆ‡æ¢é¢‘ç‡å’Œé€Ÿåº¦å¤ªå¿«ï¼Œå¯¼è‡´äººçš„è‚‰çœ¼çœ‹ä¸åˆ°ã€‚æ¯ä¸ªç¨‹åºå°±æ˜¯è¿›ç¨‹ï¼Œ è€Œæ¯ä¸ªè¿›ç¨‹ä¸­ä¼šæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œè€ŒCPUæ˜¯åœ¨è¿™äº›çº¿ç¨‹ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚äº†è§£äº†CPUå¯¹ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±å¿…é¡»çŸ¥é“ï¼Œå¤šçº¿ç¨‹å¯ä»¥æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œä½†ä¸èƒ½æ— é™åˆ¶çš„å¼€çº¿ç¨‹ã€‚ javaå®ç°çº¿ç¨‹çš„ä¸¤ç§æ–¹å¼ç»§æ‰¿Thread çš„æ–¹å¼ï¼Œå¹¶å®ç°runæ–¹æ³•ä»£ç ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536import java.util.Random;public class MyThreadWithExtends extends Thread &#123; String flag; public MyThreadWithExtends(String flag)&#123; this.flag = flag; &#125; @Override public void run() &#123; String tname = Thread.currentThread().getName(); System.out.println(tname+"çº¿ç¨‹çš„runæ–¹æ³•è¢«è°ƒç”¨â€¦â€¦"); Random random = new Random(); for(int i=0;i&lt;20;i++)&#123; try &#123; Thread.sleep(random.nextInt(10)*100); System.out.println(tname+ "...."+ flag); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static void main(String[] args) &#123; Thread thread1 = new MyThreadWithExtends("a"); Thread thread2 = new MyThreadWithExtends("b"); thread1.start(); thread2.start(); /** * å¦‚æœæ˜¯è°ƒç”¨threadçš„runæ–¹æ³•ï¼Œåˆ™åªæ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•è°ƒç”¨ï¼Œä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹ */// thread1.run();// thread2.run(); &#125;&#125; å£°æ˜å®ç°Runnableæ¥å£çš„æ–¹å¼ä»£ç ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132public class MyThreadWithImpliment implements Runnable &#123; int x; public MyThreadWithImpliment(int x) &#123; this.x = x; &#125; @Override public void run() &#123; String name = Thread.currentThread().getName(); System.out.println("çº¿ç¨‹" + name + "çš„runæ–¹æ³•è¢«è°ƒç”¨â€¦â€¦"); for (int i = 0; i &lt; 10; i++) &#123; System.out.println(x); try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static void main(String[] args) &#123; Thread thread1 = new Thread(new MyThreadWithImpliment(1), "thread-1"); Thread thread2 = new Thread(new MyThreadWithImpliment(2), "thread-2"); thread1.start(); thread2.start(); // æ³¨æ„è°ƒç”¨runå’Œè°ƒç”¨startçš„åŒºåˆ«,ç›´æ¥è°ƒç”¨runï¼Œåˆ™éƒ½è¿è¡Œåœ¨mainçº¿ç¨‹ä¸­// thread1.run();// thread2.run(); &#125;&#125; javaæ•°æ®åŒæ­¥åœ¨å¤šçº¿ç¨‹å¼€å‘ä¸­ï¼Œä¸åŒçš„çº¿ç¨‹ç»å¸¸ä¼šæ‰§è¡Œç›¸åŒçš„ä»£ç é€»è¾‘ï¼Œåœ¨çº¿ç¨‹ä¸­å¦‚æœå¯¹åŒä¸€ä¸ªå˜é‡æˆ–è€…æ•°æ®è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸åŒçº¿ç¨‹ä¹‹é—´äº§ç”Ÿæ•°æ®å†²çªï¼Œjavaä¸­ç»å¸¸é‡‡ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹æ³•æ¥è§£å†³æ•°æ®å†²çªçš„é—®é¢˜ ä¸€ã€synchronized å…³é”®å­—java å…³é”®å­— ä½¿ç”¨æ ¼å¼ 1234// å½“synchronized ä¿®é¥°å¯¹è±¡çš„æ—¶å€™æ˜¯ä¿®é¥°è¯¥å¯¹è±¡ï¼Œä¿®é¥°ç±»æ–¹æ³•çš„æ—¶å€™ï¼Œä¿®é¥°çš„æ˜¯è¯¥å¯¹è±¡å®ä¾‹ synchronized( éœ€è¦ä¸€ä¸ªä»»æ„çš„å¯¹è±¡ï¼ˆé”ï¼‰ )&#123; ä»£ç å—ä¸­æ”¾æ“ä½œå…±äº«æ•°æ®çš„ä»£ç ã€‚&#125; å…³é”®å­—ä½œç”¨ å¦‚æœä¸€ä¸ªä»£ç å—è¢«synchronizedä¿®é¥°äº†ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†å¯¹åº”çš„é”ï¼Œå¹¶æ‰§è¡Œè¯¥ä»£ç å—æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¾¿åªèƒ½ä¸€ç›´ç­‰å¾…ï¼Œç­‰å¾…è·å–é”çš„çº¿ç¨‹é‡Šæ”¾é” å³ä¿è¯è¿›ç¨‹ä¸­åŒæ—¶åªæœ‰ä¸€å¤„å¯ä»¥è¿è¡Œsyncheonicedä¿®é¥°çš„ä»£ç å—ï¼Œå…¶ä»–è°ƒç”¨é˜»å¡æ‰§è¡Œ é‡Šæ”¾é”çš„æƒ…å†µ è·å–é”çš„çº¿ç¨‹æ‰§è¡Œå®Œäº†è¯¥ä»£ç å—ï¼Œç„¶åçº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å æœ‰ï¼› çº¿ç¨‹æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸ï¼Œæ­¤æ—¶JVMä¼šè®©çº¿ç¨‹è‡ªåŠ¨é‡Šæ”¾é”ã€‚ synchronized å…³é”®å­—çš„ç¼ºç‚¹ ä¸èƒ½çŸ¥é“æ˜¯å¦æˆåŠŸè·å–åˆ°äº†é” ä¸å¯ä»¥ä¸­æ–­å¯¹é”çš„ç­‰å¾… ä½¿ç”¨synchronizedå…³é”®å­—ä»£ç ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829public class MySynchronized &#123; public static void main(String[] args) &#123; final MySynchronized mySynchronized = new MySynchronized(); new Thread("thread1") &#123; public void run() &#123; synchronized (mySynchronized) &#123; try &#123; System.out.println(this.getName()+" start"); // int i =1/0; //å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œjvmä¼šå°†é”é‡Šæ”¾ Thread.sleep(5000); System.out.println(this.getName()+"é†’äº†"); System.out.println(this.getName()+" end"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;.start(); new Thread("thread2") &#123; public void run() &#123; synchronized (mySynchronized) &#123; //äº‰æŠ¢åŒä¸€æŠŠé”æ—¶ï¼Œçº¿ç¨‹1æ²¡é‡Šæ”¾ä¹‹å‰ï¼Œçº¿ç¨‹2åªèƒ½ç­‰å¾… System.out.println(this.getName()+" start"); System.out.println(this.getName()+" end"); &#125; &#125; &#125;.start(); &#125;&#125; äºŒã€lock åŒæ­¥é”Lock æ¥å£lock åŒæ­¥é”æ˜¯ å®ç°äº† Lock æ¥å£çš„ java.util.concurrent.locksåŒ…ä¸‹å¸¸ç”¨çš„ç±»é›†åˆ Lockæ¥å£ 12345678910public interface Lock &#123; void lock(); void lockInterruptibly() throws InterruptedException; boolean tryLock(); boolean tryLock(long time, TimeUnit unit) throws InterruptedException; void unlock();&#125;// lock()ã€tryLock()ã€tryLock(long time, TimeUnit unit)ã€lockInterruptibly()æ˜¯ç”¨æ¥è·å–é”çš„ã€‚// unLock()æ–¹æ³•æ˜¯ç”¨æ¥é‡Šæ”¾é”çš„ã€‚ å‡ ç§è·å–é”çš„æ–¹æ³•å¯¹æ¯” lock()ï¼š æ–¹æ³•æ˜¯å¹³å¸¸ä½¿ç”¨å¾—æœ€å¤šçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ç”¨æ¥è·å–é”ã€‚å¦‚æœé”å·²è¢«ä¸€ä¸ªçº¿ç¨‹è·å–ï¼Œåˆ™å…¶ä»–çº¿ç¨‹è¿›è¡Œç­‰å¾…ã€‚ä½¿ç”¨lockçš„æ—¶å€™å¿…é¡»ä¸»åŠ¨å»é‡Šæ”¾é”ï¼Œå¹¶ä¸”åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚ tryLock(): æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå®ƒè¡¨ç¤ºç”¨æ¥å°è¯•è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å›trueï¼Œå¦‚æœè·å–å¤±è´¥ï¼ˆå³é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰ï¼Œåˆ™è¿”å›falseï¼Œä¹Ÿå°±è¯´è¿™ä¸ªæ–¹æ³•æ— è®ºå¦‚ä½•éƒ½ä¼šç«‹å³è¿”å›ã€‚åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¸ä¼šä¸€ç›´åœ¨é‚£ç­‰å¾…ã€‚ tryLock(long time, TimeUnit unit): æ–¹æ³•å’ŒtryLock()æ–¹æ³•æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡åŒºåˆ«åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜æ‹¿ä¸åˆ°é”ï¼Œå°±è¿”å›falseã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å›trueã€‚ lockInterruptibly(): å½“é€šè¿‡è¿™ä¸ªæ–¹æ³•å»è·å–é”æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–é”ï¼Œåˆ™è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼Œå³ä¸­æ–­çº¿ç¨‹çš„ç­‰å¾…çŠ¶æ€ã€‚ä¹Ÿå°±ä½¿è¯´ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡lock.lockInterruptibly()æƒ³è·å–æŸä¸ªé”æ—¶ï¼Œå‡è‹¥æ­¤æ—¶çº¿ç¨‹Aè·å–åˆ°äº†é”ï¼Œè€Œçº¿ç¨‹Båªæœ‰ç­‰å¾…ï¼Œé‚£ä¹ˆå¯¹çº¿ç¨‹Bè°ƒç”¨threadB.interrupt()æ–¹æ³•èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹Bçš„ç­‰å¾…è¿‡ç¨‹ã€‚æ³¨æ„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”ä¹‹åï¼Œæ˜¯ä¸ä¼šè¢«interrupt()æ–¹æ³•ä¸­æ–­çš„.å› æ­¤å½“é€šè¿‡lockInterruptibly()æ–¹æ³•è·å–æŸä¸ªé”æ—¶ï¼Œå¦‚æœä¸èƒ½è·å–åˆ°ï¼Œåªæœ‰è¿›è¡Œç­‰å¾…çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¯ä»¥å“åº”ä¸­æ–­çš„ã€‚ ReentrantLockï¼š â€‹ ç›´æ¥ä½¿ç”¨lockæ¥å£çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦å®ç°å¾ˆå¤šæ–¹æ³•ï¼Œä¸å¤ªæ–¹ä¾¿ï¼ŒReentrantLockæ˜¯å”¯ä¸€å®ç°äº†Lockæ¥å£çš„ç±»ï¼Œå¹¶ä¸”ReentrantLockæä¾›äº†æ›´å¤šçš„æ–¹æ³•ï¼ŒReentrantLockï¼Œæ„æ€æ˜¯â€œå¯é‡å…¥é”â€ã€‚ä½¿ç”¨æ–¹æ³•å’Œä¸Šé¢ ä»£ç ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859import java.util.ArrayList;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;/** * è§‚å¯Ÿç°è±¡ï¼šä¸€ä¸ªçº¿ç¨‹è·å¾—é”åï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å–ä¸åˆ°é”ï¼Œä¸ä¼šä¸€ç›´ç­‰å¾… * @author * */public class MyTryLock &#123; private static ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;Integer&gt;(); static Lock lock = new ReentrantLock(); // æ³¨æ„è¿™ä¸ªåœ°æ–¹ public static void main(String[] args) &#123; new Thread() &#123; public void run() &#123; Thread thread = Thread.currentThread(); boolean tryLock = lock.tryLock(); System.out.println(thread.getName()+" "+tryLock); if (tryLock) &#123; try &#123; System.out.println(thread.getName() + "å¾—åˆ°äº†é”"); for (int i = 0; i &lt; 5; i++) &#123; arrayList.add(i); &#125; &#125; catch (Exception e) &#123; // TODO: handle exception &#125; finally &#123; System.out.println(thread.getName() + "é‡Šæ”¾äº†é”"); lock.unlock(); &#125; &#125; &#125;; &#125;.start(); new Thread() &#123; public void run() &#123; Thread thread = Thread.currentThread(); boolean tryLock = lock.tryLock(); System.out.println(thread.getName()+" "+tryLock); if (tryLock) &#123; try &#123; System.out.println(thread.getName() + "å¾—åˆ°äº†é”"); for (int i = 0; i &lt; 5; i++) &#123; arrayList.add(i); &#125; &#125; catch (Exception e) &#123; // TODO: handle exception &#125; finally &#123; System.out.println(thread.getName() + "é‡Šæ”¾äº†é”"); lock.unlock(); &#125; &#125; &#125;; &#125;.start(); &#125;&#125; ReadWriteLockæ¥å£ReadWriteLockæ¥å£ 123456789101112131415public interface ReadWriteLock &#123; /** * Returns the lock used for reading. * * @return the lock used for reading. */ Lock readLock(); /** * Returns the lock used for writing. * * @return the lock used for writing. */ Lock writeLock();&#125; ReadWriteLockæ¥å£æ–¹æ³• readLock: è·å–è¯»é”ï¼Œ åŒä¸€æ—¶é—´å…è®¸æ‰€æœ‰çº¿ç¨‹è¯»å–æ–‡ä»¶ï¼Œä½†æ˜¯ä¸å¯ä»¥è¿›è¡Œå†™å…¥ writeLock: è·å–å†™é”ï¼Œ åŒä¸€æ—¶é—´ä¸äºˆè®¸å…¶ä»–çº¿ç¨‹å¯¹æ–‡ä»¶è¿›è¡Œä»»ä½•æ“ä½œ ReentrantReadWriteLock ReentrantReadWriteLockå®ç°äº†ReadWriteLockæ¥å£ã€‚ReentrantReadWriteLocké‡Œé¢æä¾›äº†å¾ˆå¤šä¸°å¯Œçš„æ–¹æ³•ï¼Œä¸è¿‡æœ€ä¸»è¦çš„æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šreadLock()å’ŒwriteLock()ç”¨æ¥è·å–è¯»é”å’Œå†™é”ã€‚ ä»£ç ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768import java.util.concurrent.locks.ReentrantReadWriteLock;/** * ä½¿ç”¨è¯»å†™é”ï¼Œå¯ä»¥å®ç°è¯»å†™åˆ†ç¦»é”å®šï¼Œè¯»æ“ä½œå¹¶å‘è¿›è¡Œï¼Œå†™æ“ä½œé”å®šå•ä¸ªçº¿ç¨‹ * * å¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹å·²ç»å ç”¨äº†è¯»é”ï¼Œåˆ™æ­¤æ—¶å…¶ä»–çº¿ç¨‹å¦‚æœè¦ç”³è¯·å†™é”ï¼Œåˆ™ç”³è¯·å†™é”çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…é‡Šæ”¾è¯»é”ã€‚ * å¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹å·²ç»å ç”¨äº†å†™é”ï¼Œåˆ™æ­¤æ—¶å…¶ä»–çº¿ç¨‹å¦‚æœç”³è¯·å†™é”æˆ–è€…è¯»é”ï¼Œåˆ™ç”³è¯·çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…é‡Šæ”¾å†™é”ã€‚ * @author * */public class MyReentrantReadWriteLock &#123; private ReentrantReadWriteLock rwl = new ReentrantReadWriteLock(); public static void main(String[] args) &#123; final MyReentrantReadWriteLock test = new MyReentrantReadWriteLock(); new Thread()&#123; public void run() &#123; test.get(Thread.currentThread()); test.write(Thread.currentThread()); &#125;; &#125;.start(); new Thread()&#123; public void run() &#123; test.get(Thread.currentThread()); test.write(Thread.currentThread()); &#125;; &#125;.start(); &#125; /** * è¯»æ“ä½œ,ç”¨è¯»é”æ¥é”å®š * @param thread */ public void get(Thread thread) &#123; rwl.readLock().lock(); try &#123; long start = System.currentTimeMillis(); while(System.currentTimeMillis() - start &lt;= 1) &#123; System.out.println(thread.getName()+"æ­£åœ¨è¿›è¡Œè¯»æ“ä½œ"); &#125; System.out.println(thread.getName()+"è¯»æ“ä½œå®Œæ¯•"); &#125; finally &#123; rwl.readLock().unlock(); &#125; &#125; /** * å†™æ“ä½œï¼Œç”¨å†™é”æ¥é”å®š * @param thread */ public void write(Thread thread) &#123; rwl.writeLock().lock();; try &#123; long start = System.currentTimeMillis(); while(System.currentTimeMillis() - start &lt;= 1) &#123; System.out.println(thread.getName()+"æ­£åœ¨è¿›è¡Œå†™æ“ä½œ"); &#125; System.out.println(thread.getName()+"å†™æ“ä½œå®Œæ¯•"); &#125; finally &#123; rwl.writeLock().unlock(); &#125; &#125;&#125; ä¸‰ã€ syncchronizedå’Œlockçš„åŒºåˆ« 1. Lockä¸æ˜¯Javaè¯­è¨€å†…ç½®çš„ï¼Œsynchronizedæ˜¯Javaè¯­è¨€çš„å…³é”®å­—ï¼Œå› æ­¤æ˜¯å†…ç½®ç‰¹æ€§ã€‚Lockæ˜¯ä¸€ä¸ªç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å¯ä»¥å®ç°åŒæ­¥è®¿é—® 2. Lockå’Œsynchronizedæœ‰ä¸€ç‚¹éå¸¸å¤§çš„ä¸åŒï¼Œé‡‡ç”¨synchronizedä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå½“synchronizedæ–¹æ³•æˆ–è€…synchronizedä»£ç å—æ‰§è¡Œå®Œä¹‹åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å ç”¨ï¼›è€ŒLockåˆ™å¿…é¡»è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°æ­»é”ç°è±¡ã€‚ 3. Lockå¯ä»¥è®©ç­‰å¾…é”çš„çº¿ç¨‹å“åº”ä¸­æ–­ï¼Œè€Œsynchronizedå´ä¸è¡Œï¼Œä½¿ç”¨synchronizedæ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œä¸èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼› 4. é€šè¿‡Lockå¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸè·å–é”ï¼Œè€Œsynchronizedå´æ— æ³•åŠåˆ°ã€‚ 5. Lockå¯ä»¥æé«˜å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»æ“ä½œçš„æ•ˆç‡ã€‚ 6. åœ¨æ€§èƒ½ä¸Šæ¥è¯´ï¼Œå¦‚æœç«äº‰èµ„æºä¸æ¿€çƒˆï¼Œä¸¤è€…çš„æ€§èƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œè€Œå½“ç«äº‰èµ„æºéå¸¸æ¿€çƒˆæ—¶ï¼ˆå³æœ‰å¤§é‡çº¿ç¨‹åŒæ—¶ç«äº‰ï¼‰ï¼Œæ­¤æ—¶Lockçš„æ€§èƒ½è¦è¿œè¿œä¼˜äºsynchronizedã€‚æ‰€ä»¥è¯´ï¼Œåœ¨å…·ä½“ä½¿ç”¨æ—¶è¦æ ¹æ®é€‚å½“æƒ…å†µé€‰æ‹©ã€‚ Java å¹¶å‘åŒ…JDK5.0 ä»¥åçš„ç‰ˆæœ¬éƒ½å¼•å…¥äº†é«˜çº§å¹¶å‘ç‰¹æ€§ï¼Œå¤§å¤šæ•°çš„ç‰¹æ€§åœ¨java.util.concurrent åŒ…ä¸­ï¼Œæ˜¯ä¸“é—¨ç”¨äºå¤šçº¿ç¨‹å‘ç¼–ç¨‹çš„ï¼Œå……åˆ†åˆ©ç”¨äº†ç°ä»£å¤šå¤„ç†å™¨å’Œå¤šæ ¸å¿ƒç³»ç»Ÿçš„åŠŸèƒ½ä»¥ç¼–å†™å¤§è§„æ¨¡å¹¶å‘åº”ç”¨ç¨‹åºã€‚ä¸»è¦åŒ…å«åŸå­é‡ã€å¹¶å‘é›†åˆã€åŒæ­¥å™¨ã€å¯é‡å…¥é”ï¼Œå¹¶å¯¹çº¿ç¨‹æ± çš„æ„é€ æä¾›äº†å¼ºåŠ›çš„æ”¯æŒã€‚ çº¿ç¨‹æ± çº¿ç¨‹æ± çš„ä½œç”¨åœ¨å¹¶å‘å˜æˆä¸­ï¼Œç»å¸¸ä¼šç”¨çº¿ç¨‹å¤„ç†ä¸å‘ä»»åŠ¡ï¼Œä½†æ˜¯æ§åˆ¶å¹¶å‘æ•°é‡å’Œæ§åˆ¶çº¿ç¨‹ä¹‹é—´çš„æ¶ˆæ¯åè°ƒæ˜¯ä¸€ä¸ªéš¾ç‚¹ï¼Œçº¿ç¨‹æ± è§£å†³äº†è¿™éƒ¨åˆ†é—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒçº¿ç¨‹æ± çš„å®¹é‡å’Œæ•°æ®è¿”å›æ–¹å¼ï¼Œå¹¶ä¸éœ€è¦å…³å¿ƒåˆ›å»ºçº¿ç¨‹ï¼Œè°ƒç”¨çº¿ç¨‹ç­‰æ­¥éª¤ äº”ç§çº¿ç¨‹æ±  Single Thread Executor : åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå› æ­¤æ‰€æœ‰æäº¤çš„ä»»åŠ¡æ˜¯é¡ºåºæ‰§è¡Œ åˆ›å»ºæ–¹å¼ Executors.newSingleThreadExecutor() Cached Thread Pool : çº¿ç¨‹æ± é‡Œæœ‰å¾ˆå¤šçº¿ç¨‹éœ€è¦åŒæ—¶æ‰§è¡Œï¼Œè€çš„å¯ç”¨çº¿ç¨‹å°†è¢«æ–°çš„ä»»åŠ¡è§¦å‘é‡æ–°æ‰§è¡Œï¼Œå¦‚æœçº¿ç¨‹è¶…è¿‡60ç§’å†…æ²¡æ‰§è¡Œï¼Œé‚£ä¹ˆå°†è¢«ç»ˆæ­¢å¹¶ä»æ± ä¸­åˆ é™¤ï¼Œ åˆ›å»ºæ–¹å¼ Executors.newCachedThreadPool() Fixed Thread Pool : æ‹¥æœ‰å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼Œå¦‚æœæ²¡æœ‰ä»»åŠ¡æ‰§è¡Œï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾… åˆ›å»ºæ–¹å¼ Executors.newFixedThreadPool(4) Scheduled Thread Pool : ç”¨æ¥è°ƒåº¦å³å°†æ‰§è¡Œçš„ä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œå¯èƒ½æ˜¯ä¸æ˜¯ç›´æ¥æ‰§è¡Œ, æ¯éš”å¤šä¹…æ‰§è¡Œä¸€æ¬¡â€¦ ç­–ç•¥å‹çš„ åˆ›å»ºæ–¹å¼ Executors.newScheduledThreadPool() å…¶å®ï¼Œè¿™äº›ä¸åŒç±»å‹çš„çº¿ç¨‹æ± éƒ½æ˜¯é€šè¿‡æ„å»ºä¸€ä¸ªThreadPoolExecutoræ¥å®Œæˆçš„ï¼Œæ‰€ä¸åŒçš„æ˜¯corePoolSize,maximumPoolSize,keepAliveTime,unit,workQueue,threadFactoryè¿™ä¹ˆå‡ ä¸ªå‚æ•°ã€‚å…·ä½“å¯ä»¥å‚è§JDK DOCã€‚ çº¿ç¨‹æ± ä½¿ç”¨æ–¹æ³•1. ç¬¬ä¸€ç§æ–¹å¼ â€‹ ä½¿ç”¨æ–¹æ³• â€‹ æäº¤ Runnable ï¼Œä»»åŠ¡å®Œæˆå Future å¯¹è±¡è¿”å› null â€‹ è°ƒç”¨excute,æäº¤ä»»åŠ¡, åŒ¿åRunableé‡å†™runæ–¹æ³•, runæ–¹æ³•é‡Œæ˜¯ä¸šåŠ¡é€»è¾‘ â€‹ ä»£ç ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;public class ThreadPoolWithRunable &#123; /** * é€šè¿‡çº¿ç¨‹æ± æ‰§è¡Œçº¿ç¨‹ * @param args */ public static void main(String[] args) &#123; //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ±  ExecutorService pool = Executors.newCachedThreadPool(); for(int i = 1; i &lt; 5; i++)&#123; pool.execute(new Runnable() &#123; @Override public void run() &#123; System.out.println("thread name: " + Thread.currentThread().getName()); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;); &#125; pool.shutdown(); &#125;&#125; 2. ç¬¬äºŒç§æ–¹å¼ â€‹ ä½¿ç”¨æ–¹æ³• â€‹ æäº¤ Callableï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª Future å®ä¾‹è¡¨ç¤ºä»»åŠ¡çš„çŠ¶æ€ â€‹ è°ƒç”¨submitæäº¤ä»»åŠ¡, åŒ¿åCallable,é‡å†™callæ–¹æ³•, æœ‰è¿”å›å€¼, è·å–è¿”å›å€¼ä¼šé˜»å¡,ä¸€ç›´è¦ç­‰åˆ°çº¿ç¨‹ä»»åŠ¡è¿”å›ç»“æœ â€‹ ä»£ç ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536import java.util.ArrayList;import java.util.List;import java.util.concurrent.Callable;import java.util.concurrent.ExecutionException;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.Future;/** * callable è·Ÿrunnableçš„åŒºåˆ«ï¼š * runnableçš„runæ–¹æ³•ä¸ä¼šæœ‰ä»»ä½•è¿”å›ç»“æœï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹æ— æ³•è·å¾—ä»»åŠ¡çº¿ç¨‹çš„è¿”å›å€¼ * * callableçš„callæ–¹æ³•å¯ä»¥è¿”å›ç»“æœï¼Œä½†æ˜¯ä¸»çº¿ç¨‹åœ¨è·å–æ—¶æ˜¯è¢«é˜»å¡ï¼Œéœ€è¦ç­‰å¾…ä»»åŠ¡çº¿ç¨‹è¿”å›æ‰èƒ½æ‹¿åˆ°ç»“æœ * @author * */public class ThreadPoolWithcallable &#123; public static void main(String[] args) throws InterruptedException, ExecutionException &#123; ExecutorService pool = Executors.newFixedThreadPool(4); for(int i = 0; i &lt; 10; i++)&#123; Future&lt;String&gt; submit = pool.submit(new Callable&lt;String&gt;()&#123; @Override public String call() throws Exception &#123; //System.out.println("a"); Thread.sleep(5000); return "b--"+Thread.currentThread().getName(); &#125; &#125;); //ä»Futureä¸­getç»“æœï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¼šè¢«é˜»å¡çš„ï¼Œä¸€ç›´è¦ç­‰åˆ°çº¿ç¨‹ä»»åŠ¡è¿”å›ç»“æœ System.out.println(submit.get()); &#125; pool.shutdown(); &#125;&#125; ä¸ç”¨çº¿ç¨‹æ± çš„ç¼ºç‚¹ æ–°å»ºçº¿ç¨‹çš„å¼€é”€ã€‚çº¿ç¨‹è™½ç„¶æ¯”è¿›ç¨‹è¦è½»é‡è®¸å¤šï¼Œä½†å¯¹äºJVMæ¥è¯´ï¼Œæ–°å»ºä¸€ä¸ªçº¿ç¨‹çš„ä»£ä»·è¿˜æ˜¯æŒºå¤§çš„ï¼Œå†³ä¸åŒäºæ–°å»ºä¸€ä¸ªå¯¹è±¡ èµ„æºæ¶ˆè€—é‡ã€‚æ²¡æœ‰ä¸€ä¸ªæ± æ¥é™åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼Œä¼šå¯¼è‡´çº¿ç¨‹çš„æ•°é‡ç›´æ¥å–å†³äºåº”ç”¨çš„å¹¶å‘é‡ï¼Œè¿™æ ·æœ‰æ½œåœ¨çš„çº¿ç¨‹æ•°æ®å·¨å¤§çš„å¯èƒ½ï¼Œé‚£ä¹ˆèµ„æºæ¶ˆè€—é‡å°†æ˜¯å·¨å¤§çš„ ç¨³å®šæ€§ã€‚å½“çº¿ç¨‹æ•°é‡è¶…è¿‡ç³»ç»Ÿèµ„æºæ‰€èƒ½æ‰¿å—çš„ç¨‹åº¦ï¼Œç¨³å®šæ€§å°±ä¼šæˆé—®é¢˜ çº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥ä»¥ä¸Šçº¿ç¨‹æ± ç±»å‹å¯çŸ¥ï¼Œé™¤äº†CachedThreadPoolå…¶ä»–çº¿ç¨‹æ± éƒ½æœ‰é¥±å’Œçš„å¯èƒ½ï¼Œå½“é¥±å’Œä»¥åå°±éœ€è¦ç›¸åº”çš„ç­–ç•¥å¤„ç†è¯·æ±‚çº¿ç¨‹çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼Œè¾¾åˆ°ä¸Šé™æ—¶é€šè¿‡ThreadPoolExecutor.setRejectedExecutionHandleræ–¹æ³•è®¾ç½®ä¸€ä¸ªæ‹’ç»ä»»åŠ¡çš„ç­–ç•¥ï¼ŒJDKæä¾›äº†AbortPolicyã€CallerRunsPolicyã€DiscardPolicyã€DiscardOldestPolicyå‡ ç§ç­–ç•¥ï¼Œå…·ä½“å·®å¼‚å¯è§JDK DOC æ¶ˆæ¯é˜Ÿåˆ—java.util.concurrentä¸‹çš„ä¸»è¦ç”¨æ¥æ§åˆ¶çº¿ç¨‹åŒæ­¥çš„å·¥å…· æ¶ˆæ¯é˜Ÿåˆ—ä½œç”¨ç”¨æ¥ä¸»çº¿ç¨‹å’Œçº¿ç¨‹ä¹‹é—´ï¼Œå’Œå„çº¿ç¨‹ä¹‹é—´çš„æ¶ˆæ¯é€šè®¯ï¼› ä¸¤ç§æ¶ˆæ¯é˜Ÿåˆ— ArrayBlockingQueue: ä¸€ä¸ªç”±æ•°ç»„æ”¯æŒçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œè§„å®šå¤§å°çš„BlockingQueue,å…¶æ„é€ å‡½æ•°å¿…é¡»å¸¦ä¸€ä¸ªintå‚æ•°æ¥æŒ‡æ˜å…¶å¤§å°.å…¶æ‰€å«çš„å¯¹è±¡æ˜¯ä»¥FIFO(å…ˆå…¥å…ˆå‡º)é¡ºåºæ’åºçš„ã€‚ LinkedBlockingQueueï¼šå¤§å°ä¸å®šçš„BlockingQueue,è‹¥å…¶æ„é€ å‡½æ•°å¸¦ä¸€ä¸ªè§„å®šå¤§å°çš„å‚æ•°,ç”Ÿæˆçš„BlockingQueueæœ‰å¤§å°é™åˆ¶,è‹¥ä¸å¸¦å¤§å°å‚æ•°,æ‰€ç”Ÿæˆçš„BlockingQueueçš„å¤§å°ç”±Integer.MAX_VALUEæ¥å†³å®š.å…¶æ‰€å«çš„å¯¹è±¡æ˜¯ä»¥FIFO(å…ˆå…¥å…ˆå‡º)é¡ºåºæ’åºçš„ã€‚ ä¸¤ç§æ¶ˆæ¯é˜Ÿåˆ—åŒºåˆ«ï¼š â€‹ LinkedBlockingQueueå’ŒArrayBlockingQueueæ¯”è¾ƒèµ·æ¥,å®ƒä»¬èƒŒåæ‰€ç”¨çš„æ•°æ®ç»“æ„ä¸ä¸€æ ·,å¯¼è‡´LinkedBlockingQueueçš„æ•°æ®ååé‡è¦å¤§äºArrayBlockingQueue,ä½†åœ¨çº¿ç¨‹æ•°é‡å¾ˆå¤§æ—¶å…¶æ€§èƒ½çš„å¯é¢„è§æ€§ä½äºArrayBlockingQueue. æ¶ˆæ¯é˜Ÿåˆ—å¯¹è±¡çš„æ–¹æ³•æ’å…¥ add(anObject): æŠŠanObjectåŠ åˆ°BlockingQueueé‡Œ,å³å¦‚æœBlockingQueueå¯ä»¥å®¹çº³,åˆ™è¿”å›true,å¦åˆ™æŠ›å‡ºå¼‚å¸¸ offer(anObject): è¡¨ç¤ºå¦‚æœå¯èƒ½çš„è¯,å°†anObjectåŠ åˆ°BlockingQueueé‡Œ,å³å¦‚æœBlockingQueueå¯ä»¥å®¹çº³,åˆ™è¿”å›true,å¦åˆ™è¿”å›false. put(anObject): æŠŠanObjectåŠ åˆ°BlockingQueueé‡Œ,å¦‚æœBlockQueueæ²¡æœ‰ç©ºé—´,åˆ™è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹è¢«é˜»æ–­ç›´åˆ°BlockingQueueé‡Œé¢æœ‰ç©ºé—´å†ç»§ç»­, æœ‰é˜»å¡, æ”¾ä¸è¿›å»å°±ç­‰å¾… è¯»å– 1. **poll(time)**: å–èµ°BlockingQueueé‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥ä¸èƒ½ç«‹å³å–å‡º,åˆ™å¯ä»¥ç­‰timeå‚æ•°è§„å®šçš„æ—¶é—´,å–ä¸åˆ°æ—¶è¿”å›null; å–ä¸åˆ°è¿”å›null 2. **take()**: å–èµ°BlockingQueueé‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥BlockingQueueä¸ºç©º,é˜»æ–­è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°Blockingæœ‰æ–°çš„å¯¹è±¡è¢«åŠ å…¥ä¸ºæ­¢; é˜»å¡, å–ä¸åˆ°å°±ä¸€ç›´ç­‰å…¶ä»– int remainingCapacity(): è¿”å›é˜Ÿåˆ—å‰©ä½™çš„å®¹é‡ï¼Œåœ¨é˜Ÿåˆ—æ’å…¥å’Œè·å–çš„æ—¶å€™ï¼Œä¸è¦çæï¼Œæ•°æ®å¯èƒ½ä¸å‡†, ä¸èƒ½ä¿è¯æ•°æ®çš„å‡†ç¡®æ€§ boolean remove(Object o): ä»é˜Ÿåˆ—ç§»é™¤å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ï¼Œå³ç§»é™¤ä¸€ä¸ªæˆ–è€…æ›´å¤šï¼Œé˜Ÿåˆ—æ”¹ å˜äº†è¿”å›true public boolean contains(Object o): æŸ¥çœ‹é˜Ÿåˆ—æ˜¯å¦å­˜åœ¨è¿™ä¸ªå…ƒç´ ï¼Œå­˜åœ¨è¿”å›true int drainTo(Collection&lt;? super E&gt; c): ç§»é™¤æ­¤é˜Ÿåˆ—ä¸­æ‰€æœ‰å¯ç”¨çš„å…ƒç´ ,å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°ç»™å®š collection ä¸­ã€‚å–å‡ºæ”¾åˆ°é›†åˆä¸­ int drainTo(Collection&lt;? super E&gt; c, int maxElements): å’Œä¸Šé¢æ–¹æ³•çš„åŒºåˆ«åœ¨äºï¼ŒæŒ‡å®šäº†ç§»åŠ¨çš„æ•°é‡; å–å‡ºæŒ‡å®šä¸ªæ•°æ”¾åˆ°é›†åˆ ä»£ç ç¤ºä¾‹consumer 12345678910111213141516171819import java.util.concurrent.BlockingQueue;public class Consumer implements Runnable&#123; BlockingQueue&lt;String&gt; queue; public Consumer(BlockingQueue&lt;String&gt; queue)&#123; this.queue = queue; &#125; @Override public void run() &#123; try &#123; String consumer = Thread.currentThread().getName(); System.out.println(consumer); String temp = queue.take();//å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œä¼šé˜»å¡å½“å‰çº¿ç¨‹ System.out.println(consumer+"get a product:"+temp); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; producer 123456789101112131415161718192021import java.util.concurrent.BlockingQueue;public class Producer implements Runnable &#123; BlockingQueue&lt;String&gt; queue; public Producer(BlockingQueue&lt;String&gt; queue) &#123; this.queue = queue; &#125; @Override public void run() &#123; try &#123; System.out.println("I have made a product:" + Thread.currentThread().getName()); String temp = "A Product, ç”Ÿäº§çº¿ç¨‹ï¼š" + Thread.currentThread().getName(); queue.put(temp);//å¦‚æœé˜Ÿåˆ—æ˜¯æ»¡çš„è¯ï¼Œä¼šé˜»å¡å½“å‰çº¿ç¨‹ &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; volatileå…³é”®å­—åœ¨å¤šçº¿ç¨‹ä¸­çš„ä½œç”¨è§£å†³å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡å¯è§æ€§é—®é¢˜ å¯è§æ€§é—®é¢˜ä¸»è¦æŒ‡ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡å€¼ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹å´çœ‹ä¸åˆ°ã€‚å¼•èµ·å¯è§æ€§é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„ä¸€ä¸ªé«˜é€Ÿç¼“å­˜åŒºâ€”â€”çº¿ç¨‹å·¥ä½œå†…å­˜ã€‚ volatileå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜, çœ‹ä¸‹é¢ä»£ç å°±å¯ä»¥çŸ¥é“å…¶ä½œç”¨: 1234567891011121314151617181920212223242526272829303132333435363738394041public class VolatileTest &#123; int a = 1; int b = 2; public void change()&#123; a = 3; b = a; &#125; public void print()&#123; System.out.println("b="+b+";a="+a); &#125; public static void main(String[] args) &#123; while (true)&#123; final VolatileTest test = new VolatileTest(); new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; Thread.sleep(10); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; test.change(); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; Thread.sleep(10); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; test.print(); &#125; &#125;).start(); &#125; &#125;&#125; ç›´è§‚ä¸Šè¯´ï¼Œè¿™æ®µä»£ç çš„ç»“æœåªå¯èƒ½æœ‰ä¸¤ç§ï¼šb=3;a=3 æˆ– b=2;a=1ã€‚ä¸è¿‡è¿è¡Œä¸Šé¢çš„ä»£ç ï¼ˆå¯èƒ½æ—¶é—´ä¸Šè¦é•¿ä¸€ç‚¹ï¼‰ï¼Œä½ ä¼šå‘ç°é™¤äº†ä¸Šä¸¤ç§ç»“æœä¹‹å¤–ï¼Œè¿˜å‡ºç°äº†ç¬¬ä¸‰ç§ç»“æœï¼š 1234567891011...... b=2;a=1b=2;a=1b=3;a=3b=3;a=3b=3;a=1b=3;a=3b=2;a=1b=3;a=3b=3;a=3...... ä¸ºä»€ä¹ˆä¼šå‡ºç°b=3;a=1è¿™ç§ç»“æœå‘¢ï¼Ÿæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœå…ˆæ‰§è¡Œchangeæ–¹æ³•ï¼Œå†æ‰§è¡Œprintæ–¹æ³•ï¼Œè¾“å‡ºç»“æœåº”è¯¥ä¸ºb=3;a=3ã€‚ç›¸åï¼Œå¦‚æœå…ˆæ‰§è¡Œçš„printæ–¹æ³•ï¼Œå†æ‰§è¡Œchangeæ–¹æ³•ï¼Œç»“æœåº”è¯¥æ˜¯ b=2;a=1ã€‚é‚£b=3;a=1çš„ç»“æœæ˜¯æ€ä¹ˆå‡ºæ¥çš„ï¼ŸåŸå› å°±æ˜¯ç¬¬ä¸€ä¸ªçº¿ç¨‹å°†å€¼a=3ä¿®æ”¹åï¼Œä½†æ˜¯å¯¹ç¬¬äºŒä¸ªçº¿ç¨‹æ˜¯ä¸å¯è§çš„ï¼Œæ‰€ä»¥æ‰å‡ºç°è¿™ä¸€ç»“æœã€‚å¦‚æœå°†aå’Œbéƒ½æ”¹æˆvolatileç±»å‹çš„å˜é‡å†æ‰§è¡Œï¼Œåˆ™å†ä¹Ÿä¸ä¼šå‡ºç°b=3;a=1çš„ç»“æœäº† volatile å’Œ é”çš„åŒºåˆ«å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚é”çš„æ—¶å€™ï¼Œä¸€äº›çº¿ç¨‹å°†è¢«æŒ‚èµ·å¹¶ä¸”ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œå®ƒä»¬çš„æ—¶é—´ç‰‡åæ‰èƒ½è¢«è°ƒåº¦æ‰§è¡Œã€‚é¢‘ç¹çš„çº¿ç¨‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢åŠçº¿ç¨‹è°ƒåº¦æ˜¯ååˆ†è€—èµ„æºçš„ã€‚å¦å¤–é”è¿˜å­˜åœ¨ç€æ­»é”çš„é£é™©ã€‚ ä¸é”ç›¸æ¯”ï¼Œvolatileæ˜¯ä¸€ç§æ›´åŠ è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ï¼Œå› ä¸ºåœ¨ä½¿ç”¨è¿™äº›å˜é‡çš„æ—¶å€™ä¸ä¼šå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹è°ƒåº¦ç­‰æ“ä½œã€‚ä½†æ˜¯volatileåŒæ ·ä¹Ÿå­˜åœ¨å±€é™æ€§:å½“å˜é‡ä¾èµ–äºå…¶ä»–å˜é‡æˆ–æ—§å€¼æ—¶ï¼ˆè‡ªå¢ï¼‰å°±ä¸èƒ½ä½¿ç”¨volatileå˜é‡ï¼Œ å› ä¸ºä»–ä»¬ä¸æ˜¯åŸå­æ“ä½œã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[zookeeper]]></title>
    <url>%2F2019%2F12%2F21%2F15.%E5%A4%A7%E6%95%B0%E6%8D%AE%2F%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B7%A5%E5%85%B7%2Fzookeeper%2F</url>
    <content type="text"><![CDATA[Zookeeper çš„ç®€ä»‹zookeeperçš„ä½œç”¨Zookeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼›å°±æ˜¯ä¸ºç”¨æˆ·çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºæä¾›åè°ƒæœåŠ¡ ä¸»è¦ç”¨æ¥ç»™åˆ†å¸ƒå¼èŠ‚ç‚¹æä¾›æ•°æ®ä¿ç®¡å’ŒèŠ‚ç‚¹ç›‘å¬åŠŸèƒ½ zookeeperç‰¹ç‚¹ zookeeperæ˜¯ä¸ºåˆ«çš„åˆ†å¸ƒå¼ç¨‹åºæœåŠ¡çš„ Zookeeperæœ¬èº«å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç¨‹åºï¼ˆåªè¦æœ‰åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼Œzkå°±èƒ½æ­£å¸¸æœåŠ¡ï¼Œä¸€èˆ¬è¦éƒ¨ç½²å¥‡æ•°å°ï¼Œæœ€å¥½å¤§äºç­‰äºä¸‰å°ï¼‰ Zookeeperæ‰€æä¾›çš„æœåŠ¡æ¶µç›–ï¼šä¸»ä»åè°ƒã€æœåŠ¡å™¨èŠ‚ç‚¹åŠ¨æ€ä¸Šä¸‹çº¿ã€ç»Ÿä¸€é…ç½®ç®¡ç†ã€åˆ†å¸ƒå¼å…±äº«é”ã€ç»Ÿä¸€åç§°æœåŠ¡â€¦â€¦ è™½ç„¶è¯´å¯ä»¥æä¾›å„ç§æœåŠ¡ï¼Œä½†æ˜¯zookeeperåœ¨åº•å±‚å…¶å®åªæä¾›äº†ä¸¤ä¸ªåŠŸèƒ½ï¼š1. ç®¡ç†(å­˜å‚¨ï¼Œè¯»å–)ç”¨æˆ·ç¨‹åºæäº¤çš„æ•°æ®ï¼›2. ä¸ºç”¨æˆ·ç¨‹åºæä¾›æ•°æ®èŠ‚ç‚¹ç›‘å¬æœåŠ¡ï¼› zookeeperé›†ç¾¤çš„è§’è‰²ï¼š Leader follower ï¼ˆObserverï¼‰ zookeeperé›†ç¾¤çš„é€‰ä¸¾æœºåˆ¶ï¼ˆå…¨æ–°é›†ç¾¤ï¼‰å‡è®¾æœ‰äº”å°æœåŠ¡å™¨ç»„æˆçš„zookeeperé›†ç¾¤,å®ƒä»¬çš„idä»1-5,åŒæ—¶å®ƒä»¬éƒ½æ˜¯æœ€æ–°å¯åŠ¨çš„,ä¹Ÿå°±æ˜¯æ²¡æœ‰å†å²æ•°æ®,åœ¨å­˜æ”¾æ•°æ®é‡è¿™ä¸€ç‚¹ä¸Š,éƒ½æ˜¯ä¸€æ ·çš„.å‡è®¾è¿™äº›æœåŠ¡å™¨ä¾åºå¯åŠ¨ï¼› æœåŠ¡å™¨1å¯åŠ¨,æ­¤æ—¶åªæœ‰å®ƒä¸€å°æœåŠ¡å™¨å¯åŠ¨äº†,å®ƒå‘å‡ºå»çš„æŠ¥æ²¡æœ‰ä»»ä½•å“åº”,æ‰€ä»¥å®ƒçš„é€‰ä¸¾çŠ¶æ€ä¸€ç›´æ˜¯LOOKINGçŠ¶æ€ æœåŠ¡å™¨2å¯åŠ¨,å®ƒä¸æœ€å¼€å§‹å¯åŠ¨çš„æœåŠ¡å™¨1è¿›è¡Œé€šä¿¡,äº’ç›¸äº¤æ¢è‡ªå·±çš„é€‰ä¸¾ç»“æœ,ç”±äºä¸¤è€…éƒ½æ²¡æœ‰å†å²æ•°æ®,æ‰€ä»¥idå€¼è¾ƒå¤§çš„æœåŠ¡å™¨2èƒœå‡º,ä½†æ˜¯ç”±äºæ²¡æœ‰è¾¾åˆ°è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨éƒ½åŒæ„é€‰ä¸¾å®ƒ(è¿™ä¸ªä¾‹å­ä¸­çš„åŠæ•°ä»¥ä¸Šæ˜¯3),æ‰€ä»¥æœåŠ¡å™¨1,2è¿˜æ˜¯ç»§ç»­ä¿æŒLOOKINGçŠ¶æ€. æœåŠ¡å™¨3å¯åŠ¨,æ ¹æ®å‰é¢çš„ç†è®ºåˆ†æ,æœåŠ¡å™¨3æˆä¸ºæœåŠ¡å™¨1,2,3ä¸­çš„è€å¤§,è€Œä¸ä¸Šé¢ä¸åŒçš„æ˜¯,æ­¤æ—¶æœ‰ä¸‰å°æœåŠ¡å™¨é€‰ä¸¾äº†å®ƒ,æ‰€ä»¥å®ƒæˆä¸ºäº†è¿™æ¬¡é€‰ä¸¾çš„leader. æœåŠ¡å™¨4å¯åŠ¨,æ ¹æ®å‰é¢çš„åˆ†æ,ç†è®ºä¸ŠæœåŠ¡å™¨4åº”è¯¥æ˜¯æœåŠ¡å™¨1,2,3,4ä¸­æœ€å¤§çš„,ä½†æ˜¯ç”±äºå‰é¢å·²ç»æœ‰åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨é€‰ä¸¾äº†æœåŠ¡å™¨3,æ‰€ä»¥å®ƒåªèƒ½æ¥æ”¶å½“å°å¼Ÿçš„å‘½äº†. æœåŠ¡å™¨5å¯åŠ¨,åŒ4ä¸€æ ·,å½“å°å¼Ÿ. zookeeperé›†ç¾¤çš„é€‰ä¸¾æœºåˆ¶ï¼ˆè¿è¡Œä¸­é›†ç¾¤ï¼‰è¿è¡Œä¸­é›†ç¾¤çš„é€‰ä¸¾æœºåˆ¶éœ€è¦åŠ å…¥æ•°æ®idã€leader idå’Œé€»è¾‘æ—¶é’Ÿçš„æ¦‚å¿µã€‚ æ•°æ®idï¼šæ•°æ®æ–°çš„idå°±å¤§ï¼Œæ•°æ®æ¯æ¬¡æ›´æ–°éƒ½ä¼šæ›´æ–°idã€‚ Leader idï¼šå°±æ˜¯æˆ‘ä»¬é…ç½®çš„myidä¸­çš„å€¼ï¼Œæ¯ä¸ªæœºå™¨ä¸€ä¸ªã€‚ é€»è¾‘æ—¶é’Ÿï¼šè¿™ä¸ªå€¼ä»0å¼€å§‹é€’å¢,æ¯æ¬¡é€‰ä¸¾å¯¹åº”ä¸€ä¸ªå€¼,ä¹Ÿå°±æ˜¯è¯´: å¦‚æœåœ¨åŒä¸€æ¬¡é€‰ä¸¾ä¸­,é‚£ä¹ˆè¿™ä¸ªå€¼åº”è¯¥æ˜¯ä¸€è‡´çš„ ; é€»è¾‘æ—¶é’Ÿå€¼è¶Šå¤§,è¯´æ˜è¿™ä¸€æ¬¡é€‰ä¸¾leaderçš„è¿›ç¨‹æ›´æ–°. é€‰ä¸¾çš„æ ‡å‡†å°±å˜æˆï¼š â€‹ 1ã€é€»è¾‘æ—¶é’Ÿå°çš„é€‰ä¸¾ç»“æœè¢«å¿½ç•¥ï¼Œé‡æ–°æŠ•ç¥¨ â€‹ 2ã€ç»Ÿä¸€é€»è¾‘æ—¶é’Ÿåï¼Œæ•°æ®idå¤§çš„èƒœå‡º â€‹ 3ã€æ•°æ®idç›¸åŒçš„æƒ…å†µä¸‹ï¼Œleader idå¤§çš„èƒœå‡º zookeeperé›†ç¾¤ç‰¹æ€§ Zookeeperï¼šä¸€ä¸ªleaderï¼Œå¤šä¸ªfollowerç»„æˆçš„é›†ç¾¤ å…¨å±€æ•°æ®ä¸€è‡´ï¼šæ¯ä¸ªserverä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼Œclientæ— è®ºè¿æ¥åˆ°å“ªä¸ªserverï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ åˆ†å¸ƒå¼è¯»å†™ï¼Œæ›´æ–°è¯·æ±‚è½¬å‘ï¼Œç”±leaderå®æ–½ æ›´æ–°è¯·æ±‚é¡ºåºè¿›è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ªclientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œ æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼Œclientèƒ½è¯»åˆ°æœ€æ–°æ•°æ® zookeeperçš„ç›‘å¬å·¥ä½œæœºåˆ¶ åŸç†: ç›‘å¬å™¨æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬çš„ä»£ç ä¸­å¯ä»¥å®ç°Watherè¿™ä¸ªæ¥å£ï¼Œå®ç°å…¶ä¸­çš„processæ–¹æ³•ï¼Œæ–¹æ³•ä¸­å³æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œå½“zookeeperæ£€æµ‹åˆ°æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±ä¼šè¿›è¡Œäº‹ä»¶å›è°ƒï¼Œå‡ºå‘processæ–¹æ³• ç›‘å¬å™¨çš„æ³¨å†Œæ˜¯åœ¨è·å–æ•°æ®çš„æ“ä½œä¸­å®ç°ï¼š getData(path,watch?)ç›‘å¬çš„äº‹ä»¶æ˜¯ï¼šèŠ‚ç‚¹æ•°æ®å˜åŒ–äº‹ä»¶ getChildren(path,watch?)ç›‘å¬çš„äº‹ä»¶æ˜¯ï¼šèŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹å¢å‡å˜åŒ–äº‹ä»¶ zookeeper çš„éƒ¨ç½²æ­¥éª¤ å‰æ: æ¯å°æœåŠ¡å™¨å®‰è£…å¥½jdk, 3å°ä»¥ä¸Šçš„éƒ¨ç½²æœº ä¸‹è½½zookeeperçš„å‹ç¼©åŒ…(æ¯å°æ‰§è¡Œ) 1wget ....../zookeeper-3.4.5.tar.gz è§£å‹ç¼©(æ¯å°æ‰§è¡Œ) 12tar -zxvf -C /opt/apps zookeeper-3.4.5.tar.gzmv /opt/apps/zookeeper-3.4.5 /opt/apps/zookeeper ä¿®æ”¹ç¯å¢ƒå˜é‡(æ¯å°æ‰§è¡Œ) 123echo "export ZOOKEEEPER_HOME=/opt/apps/zookeeper"echo "export PATH=$PATH:$ZOOKEEPER_HOME/bin"source /etc/profile ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶(æ¯å°æ‰§è¡Œ) 12345678cp /opt/apps/zookeeper/conf/zoo_sample.cfg /opt/apps/zookeeper/conf/zoo.cfgecho "server.1=ip1:2888:3888" # 1.2.3 ä»£è¡¨zookeeperé›†ç¾¤ä¸­çš„idecho "server.2=ip2:2888:3888"echo "server.3=ip3:2888:3888"vi /opt/apps/zookeeper/conf/zoo.cfgdataDir=/opt/apps/zookeeper/data # é…ç½®zookeeperæ•°æ®ç›®å½•dataLogDir=/opt/apps/zookeeper/log # é…ç½®zookeeper logç›®å½• åˆ›å»ºæ•°æ®æ–‡ä»¶å¤¹(æ¯å°æ‰§è¡Œ) 12mkdir -m 755 /opt/apps/zookeeper/datamkdir -m 755 /opt/apps/zookeeper/ åˆ›å»ºmyidæ–‡ä»¶(æ¯å°æ‰§è¡Œ) 123cd datavi myid1 # æ·»åŠ æ¯å°æœºå™¨çš„idæ–‡ä»¶ï¼Œå¯¹åº”cfgæ–‡ä»¶ä¸­çš„server.x å¯åŠ¨zookeeper 1zkServer.sh start æŸ¥çœ‹é›†ç¾¤çš„çŠ¶æ€ 12jpsï¼ˆæŸ¥çœ‹è¿›ç¨‹ï¼‰zkServer.sh statusï¼ˆæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼Œä¸»ä»ä¿¡æ¯ï¼‰ zookeeperæ•°æ®ç»“æ„æ•°æ®ç»“æ„å›¾zookeeperæ˜¯æŒ‰ç…§æ ‘çŠ¶ç»“æ„å¯¹æ•°æ®è¿›è¡Œå­˜å‚¨çš„ æ•°æ®ç»“æ„ç‰¹ç‚¹ å±‚æ¬¡åŒ–çš„ç›®å½•ç»“æ„ï¼Œå‘½åç¬¦åˆå¸¸è§„æ–‡ä»¶ç³»ç»Ÿè§„èŒƒ(è§ä¸‹å›¾) æ¯ä¸ªèŠ‚ç‚¹åœ¨zookeeperä¸­å«åšznode,å¹¶ä¸”å…¶æœ‰ä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„æ ‡è¯† èŠ‚ç‚¹Znodeå¯ä»¥åŒ…å«æ•°æ®å’Œå­èŠ‚ç‚¹ï¼ˆä½†æ˜¯EPHEMERALç±»å‹çš„èŠ‚ç‚¹ä¸èƒ½æœ‰å­èŠ‚ç‚¹ï¼Œä¸‹ä¸€é¡µè¯¦ç»†è®²è§£ï¼‰ å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥åœ¨èŠ‚ç‚¹ä¸Šè®¾ç½®ç›‘è§†å™¨ï¼ˆåç»­è¯¦ç»†è®²è§£ï¼‰ èŠ‚ç‚¹ç±»å‹znodeçš„ä¸¤ç§ç±»å‹ çŸ­æš‚(ephemeral) : å®¢æˆ·ç«¯æ–­å¼€åèŠ‚ç‚¹è‡ªåŠ¨åˆ é™¤ï¼ŒèŠ‚ç‚¹ä¸èƒ½æœ‰å­èŠ‚ç‚¹ æŒä¹…(persistent)ï¼šå®¢æˆ·ç«¯æ–­å¼€åä¸åˆ é™¤èŠ‚ç‚¹ znodeå››ç§ç›®å½•å½¢å¼(é»˜è®¤persistent) persistent : æŒä¹…èŠ‚ç‚¹ persistent_sequential: æŒä¹…åºåˆ—èŠ‚ç‚¹ï¼Œznodeåç§°åä¼šé™„åŠ ä¸€ä¸ªå€¼ï¼Œé¡ºåºå·æ˜¯ä¸€ä¸ªå•è°ƒé€’å¢çš„è®¡æ•°å™¨ï¼Œç”±çˆ¶èŠ‚ç‚¹ç»´æŠ¤(ä¾‹: /test0000000019)ï¼Œ ephemeral: çŸ­æš‚èŠ‚ç‚¹ ephemera_sequential: çŸ­æš‚åºåˆ—èŠ‚ç‚¹ åºåˆ—èŠ‚ç‚¹çš„ä½œç”¨ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé¡ºåºå·å¯ä»¥è¢«ç”¨äºä¸ºæ‰€æœ‰çš„äº‹ä»¶è¿›è¡Œå…¨å±€æ’åºï¼Œè¿™æ ·å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡é¡ºåºå·æ¨æ–­äº‹ä»¶çš„é¡ºåº zookeeper å‘½ä»¤è¡Œæ“ä½œå¯åŠ¨å®¢æˆ·ç«¯ 1zkCli.sh -server &lt;ip&gt; # è¿æ¥æœ¬æœºå¯ä»¥çœç•¥-server ip æŸ¥çœ‹å½“å‰èŠ‚ç‚¹åŒ…å«çš„æ‰€æœ‰èŠ‚ç‚¹ 1[zk: 202.115.36.251:2181(CONNECTED) 1] ls / åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ 123# /zk æ˜¯èŠ‚ç‚¹åç§° myData æ˜¯èŠ‚ç‚¹ä¸­ä¿å­˜çš„æ•°æ®# -e åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹ï¼Œ -s åˆ›å»ºåºåˆ—èŠ‚ç‚¹[zk: 202.115.36.251:2181(CONNECTED) 1] create [-s] [-e] /zk "myData" è·å–èŠ‚ç‚¹æ•°æ® 12# å½“ä½¿ç”¨watchåç¼€æ—¶ï¼Œ ç›‘å¬è¿™ä¸ªèŠ‚ç‚¹çš„å˜åŒ–,å½“å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯æ”¹å˜/zkæ—¶,ä¼šå‡ºå‘watchäº‹ä»¶ï¼Œå®¢æˆ·ç«¯å®ƒä¼šæ‰“å°watchæ—¶é—´ä¿¡æ¯[zk: 202.115.36.251:2181(CONNECTED) 3] get /zk [watch] æ›´æ”¹èŠ‚ç‚¹æ•°æ® 1[zk: 202.115.36.251:2181(CONNECTED) 4] set /zk "zslâ€œ åˆ é™¤èŠ‚ç‚¹ 12[zk: 202.115.36.251:2181(CONNECTED) 5] delete /zk[zk: 202.115.36.251:2181(CONNECTED) 5] rmr /zk # é€’å½’åˆ é™¤èŠ‚ç‚¹ zookeeper java api ä½¿ç”¨org.apache.zookeeper.Zookeeper æ˜¯zookeeperå®¢æˆ·ç«¯å…¥å£çš„ä¸»è¦ç±»ï¼Œè´Ÿè´£å»ºç«‹ä¸zk server çš„ä¼šè¯ ä¸»è¦æ–¹æ³• create åœ¨æœ¬åœ°ç›®å½•æ ‘ä¸­åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ delete åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ exists æµ‹è¯•æœ¬åœ°æ˜¯å¦å­˜åœ¨ç›®æ ‡èŠ‚ç‚¹ get/setData ä»ç›®æ ‡èŠ‚ç‚¹ä¸Šè¯»å– / å†™æ•°æ® get/setACL è·å– / è®¾ç½®ç›®æ ‡èŠ‚ç‚¹è®¿é—®æ§åˆ¶åˆ—è¡¨ä¿¡æ¯ getChildren æ£€ç´¢ä¸€ä¸ªå­èŠ‚ç‚¹ä¸Šçš„åˆ—è¡¨ sync ç­‰å¾…è¦è¢«ä¼ é€çš„æ•°æ® zookeeperç®€å•ä½¿ç”¨ä»£ç ç¤ºä¾‹å®ç°ç®€å•çš„å¢åˆ æ”¹æŸ¥å’Œç›‘å¬æ“ä½œ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495package com.bigdata.utils.zookeeper;import org.apache.zookeeper.*;import org.apache.zookeeper.ZooDefs.Ids;import org.apache.zookeeper.data.Stat;import org.junit.Before;import org.junit.Test;import java.util.List;public class SimpleZkClient &#123; private static final String connectString = "mini1:2181,mini2:2181,mini3:2181"; private static final int sessionTimeout = 2000; private ZooKeeper zkClient = null; @Before public void init() throws Exception &#123; zkClient = new ZooKeeper(connectString, sessionTimeout, new Watcher() &#123; @Override public void process(WatchedEvent event) &#123; // æ”¶åˆ°äº‹ä»¶é€šçŸ¥åçš„å›è°ƒå‡½æ•°ï¼ˆåº”è¯¥æ˜¯æˆ‘ä»¬è‡ªå·±çš„äº‹ä»¶å¤„ç†é€»è¾‘ï¼‰ System.out.println(event.getType() + "---" + event.getPath()); try &#123; zkClient.getChildren("/", true); &#125; catch (Exception e) &#123; &#125; &#125; &#125;); &#125; /** * æ•°æ®çš„å¢åˆ æ”¹æŸ¥ * * @throws InterruptedException * @throws KeeperException */ // åˆ›å»ºæ•°æ®èŠ‚ç‚¹åˆ°zkä¸­ public void testCreate() throws KeeperException, InterruptedException &#123; // å‚æ•°1ï¼šè¦åˆ›å»ºçš„èŠ‚ç‚¹çš„è·¯å¾„ å‚æ•°2ï¼šèŠ‚ç‚¹å¤§æ•°æ® å‚æ•°3ï¼šèŠ‚ç‚¹çš„æƒé™ å‚æ•°4ï¼šèŠ‚ç‚¹çš„ç±»å‹ String nodeCreated = zkClient.create("/eclipse", "hellozk".getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT); //ä¸Šä¼ çš„æ•°æ®å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œä½†éƒ½è¦è½¬æˆbyte[] &#125; //åˆ¤æ–­znodeæ˜¯å¦å­˜åœ¨ @Test public void testExist() throws Exception&#123; Stat stat = zkClient.exists("/eclipse", false); System.out.println(stat==null?"not exist":"exist"); &#125; // è·å–å­èŠ‚ç‚¹ @Test public void getChildren() throws Exception &#123; List&lt;String&gt; children = zkClient.getChildren("/", true); for (String child : children) &#123; System.out.println(child); &#125; Thread.sleep(Long.MAX_VALUE); &#125; //è·å–znodeçš„æ•°æ® @Test public void getData() throws Exception &#123; byte[] data = zkClient.getData("/eclipse", false, null); System.out.println(new String(data)); &#125; //åˆ é™¤znode @Test public void deleteZnode() throws Exception &#123; //å‚æ•°2ï¼šæŒ‡å®šè¦åˆ é™¤çš„ç‰ˆæœ¬ï¼Œ-1è¡¨ç¤ºåˆ é™¤æ‰€æœ‰ç‰ˆæœ¬ zkClient.delete("/eclipse", -1); &#125; //åˆ é™¤znode @Test public void setData() throws Exception &#123; // -1 ä»£è¡¨åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹ç‰ˆæœ¬ zkClient.setData("/app1", "imissyou angelababy".getBytes(), -1); byte[] data = zkClient.getData("/app1", false, null); System.out.println(new String(data)); &#125;&#125; åˆ†å¸ƒå¼ç³»ç»Ÿä½¿ç”¨zookeeperè¿›è¡Œåè°ƒç¤ºä¾‹å®ç°åŠŸèƒ½: åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ‰å¤šå°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯å¯ä»¥åŠ¨æ€çš„ä¸Šä¸‹çº¿ï¼Œè¦å®ç°å®¢æˆ·ç«¯å¯ä»¥åŠ¨æ€çš„æ„ŸçŸ¥æœåŠ¡èŠ‚ç‚¹çš„å˜åŒ–å’Œæœ€æ–°çŠ¶æ€ æœåŠ¡ç«¯ä»£ç ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273package com.bigdata.utils.zookeeper;import org.apache.zookeeper.CreateMode;import org.apache.zookeeper.WatchedEvent;import org.apache.zookeeper.Watcher;import org.apache.zookeeper.ZooDefs.Ids;import org.apache.zookeeper.ZooKeeper;public class DistributedServer &#123; private static final String connectString = "mini1:2181,mini2:2181,mini3:2181"; private static final int sessionTimeout = 2000; private static final String parentNode = "/servers"; private ZooKeeper zk = null; /** * åˆ›å»ºåˆ°zkçš„å®¢æˆ·ç«¯è¿æ¥ * * @throws Exception */ public void getConnect() throws Exception &#123; zk = new ZooKeeper(connectString, sessionTimeout, new Watcher() &#123; @Override public void process(WatchedEvent event) &#123; // æ”¶åˆ°äº‹ä»¶é€šçŸ¥åçš„å›è°ƒå‡½æ•°ï¼ˆåº”è¯¥æ˜¯æˆ‘ä»¬è‡ªå·±çš„äº‹ä»¶å¤„ç†é€»è¾‘ï¼‰ System.out.println(event.getType() + "---" + event.getPath()); try &#123; zk.getChildren("/", true); &#125; catch (Exception e) &#123; &#125; &#125; &#125;); &#125; /** * å‘zké›†ç¾¤æ³¨å†ŒæœåŠ¡å™¨ä¿¡æ¯ * * @param hostname * @throws Exception */ public void registerServer(String hostname) throws Exception &#123; String create = zk.create(parentNode + "/server", hostname.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL); System.out.println(hostname + "is online.." + create); &#125; /** * ä¸šåŠ¡åŠŸèƒ½ * * @throws InterruptedException */ public void handleBussiness(String hostname) throws InterruptedException &#123; System.out.println(hostname + "start working....."); Thread.sleep(Long.MAX_VALUE); &#125; public static void main(String[] args) throws Exception &#123; // è·å–zkè¿æ¥ DistributedServer server = new DistributedServer(); server.getConnect(); // åˆ©ç”¨zkè¿æ¥æ³¨å†ŒæœåŠ¡å™¨ä¿¡æ¯ server.registerServer(args[0]); // å¯åŠ¨ä¸šåŠ¡åŠŸèƒ½ server.handleBussiness(args[0]); &#125;&#125; å®¢æˆ·ç«¯ä»£ç ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788package com.bigdata.utils.zookeeper;import org.apache.zookeeper.WatchedEvent;import org.apache.zookeeper.Watcher;import org.apache.zookeeper.ZooKeeper;import java.util.ArrayList;import java.util.List;public class DistributedClient &#123; private static final String connectString = "mini1:2181,mini2:2181,mini3:2181"; private static final int sessionTimeout = 2000; private static final String parentNode = "/servers"; // æ³¨æ„:åŠ volatileçš„æ„ä¹‰ä½•åœ¨ï¼Ÿ private volatile List&lt;String&gt; serverList; private ZooKeeper zk = null; /** * åˆ›å»ºåˆ°zkçš„å®¢æˆ·ç«¯è¿æ¥ * * @throws Exception */ public void getConnect() throws Exception &#123; zk = new ZooKeeper(connectString, sessionTimeout, new Watcher() &#123; @Override public void process(WatchedEvent event) &#123; // æ”¶åˆ°äº‹ä»¶é€šçŸ¥åçš„å›è°ƒå‡½æ•°ï¼ˆåº”è¯¥æ˜¯æˆ‘ä»¬è‡ªå·±çš„äº‹ä»¶å¤„ç†é€»è¾‘ï¼‰ try &#123; //é‡æ–°æ›´æ–°æœåŠ¡å™¨åˆ—è¡¨ï¼Œå¹¶ä¸”æ³¨å†Œäº†ç›‘å¬ getServerList(); &#125; catch (Exception e) &#123; &#125; &#125; &#125;); &#125; /** * è·å–æœåŠ¡å™¨ä¿¡æ¯åˆ—è¡¨ * * @throws Exception */ public void getServerList() throws Exception &#123; // è·å–æœåŠ¡å™¨å­èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¹¶ä¸”å¯¹çˆ¶èŠ‚ç‚¹è¿›è¡Œç›‘å¬ List&lt;String&gt; children = zk.getChildren(parentNode, true); // å…ˆåˆ›å»ºä¸€ä¸ªå±€éƒ¨çš„listæ¥å­˜æœåŠ¡å™¨ä¿¡æ¯ List&lt;String&gt; servers = new ArrayList&lt;String&gt;(); for (String child : children) &#123; // childåªæ˜¯å­èŠ‚ç‚¹çš„èŠ‚ç‚¹å byte[] data = zk.getData(parentNode + "/" + child, false, null); servers.add(new String(data)); &#125; // æŠŠserversèµ‹å€¼ç»™æˆå‘˜å˜é‡serverListï¼Œå·²æä¾›ç»™å„ä¸šåŠ¡çº¿ç¨‹ä½¿ç”¨ serverList = servers; //æ‰“å°æœåŠ¡å™¨åˆ—è¡¨ System.out.println(serverList); &#125; /** * ä¸šåŠ¡åŠŸèƒ½ * * @throws InterruptedException */ public void handleBussiness() throws InterruptedException &#123; System.out.println("client start working....."); Thread.sleep(Long.MAX_VALUE); &#125; public static void main(String[] args) throws Exception &#123; // è·å–zkè¿æ¥ DistributedClient client = new DistributedClient(); client.getConnect(); // è·å–serversçš„å­èŠ‚ç‚¹ä¿¡æ¯ï¼ˆå¹¶ç›‘å¬ï¼‰ï¼Œä»ä¸­è·å–æœåŠ¡å™¨ä¿¡æ¯åˆ—è¡¨ client.getServerList(); // ä¸šåŠ¡çº¿ç¨‹å¯åŠ¨ client.handleBussiness(); &#125;&#125;]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
        <category>å¤§æ•°æ®å·¥å…·</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[shellæ–‡æœ¬å‘½ä»¤]]></title>
    <url>%2F2019%2F12%2F20%2F09.shell%2Fshell%E8%AF%AD%E6%B3%95%2Fshell%E6%96%87%E6%9C%AC%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[cutå‘½ä»¤ä»ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æˆ–è€…æ–‡æœ¬æµä»æå–æ–‡æœ¬åˆ— å‚æ•°-d: ç”¨ä»€ä¹ˆå­—ç¬¦æ¥åˆ†éš”æ–‡æœ¬ï¼Œ -f: å–åˆ†éš”åçš„ç¬¬å‡ åˆ—ï¼Œæ”¯æŒæ ¼å¼ : n; n1,n2; n1-n2; n1-; ç¤ºä¾‹12345text='/sbin:/usr/sbin:/usr/local/bin:/usr/x11R6/bin'echo $test | cut -d '':'' -f 1-3# /bin:/usr/bin:/sbin: sort å‘½ä»¤å¯¹æ–‡ä»¶çš„è¡Œè¿›è¡Œæ’åºï¼Œå¹¶å°†ç»“æœå†™åˆ°æ ‡å‡†è¾“å‡ºï¼Œå¦‚æœæŒ‡å®šå¤šä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆsortå‘½ä»¤å°†è¿™äº›æ–‡ä»¶é“¾æ¥èµ·æ¥ï¼Œå¹¶å½“åšä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæ’åº å‚æ•°-f : å¿½ç•¥å¤§å°å†™çš„å·®å¼‚ -b : å¿½ç•¥æœ€è§é¢çš„ç©ºæ ¼ç¬¦éƒ¨åˆ† -M : ä»¥æœˆä»½çš„åå­—æ¥æ’åº -n : ä½¿ç”¨çº¯æ•°å­—æ¥è¿›è¡Œæ’åºï¼Œé»˜è®¤æ˜¯ä»¥æ–‡å­—å½¢æ€æ¥æ’åºçš„ -r : åå‘æ’åº -u : ç›¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œä»…å‡ºç°ä¸€è¡Œä»£è¡¨ -t ï¼šåˆ†éš”ç¬¦ï¼Œé»˜è®¤æ˜¯ç”¨tabé”®æ¥åˆ†éš” -k : ä»¥å“ªä¸ªåŒºé—´æ¥è¿›è¡Œæ’åº ç¤ºä¾‹123cat /test.txt | sort -t ":" -k 3rn# å¯¹æ–‡ä»¶æ¯è¡Œè¿›è¡Œ: åˆ†éš”ï¼Œ å¹¶å–ç¬¬ä¸‰åˆ—è¿›è¡Œåå‘æ’åºï¼Œå¹¶ä¸”ä½¿ç”¨æ•°å­—æ¥æ’åº wc å‘½ä»¤ç»Ÿè®¡æ–‡æœ¬çš„è¡Œæ•°å’Œå­—ç¬¦æ•°é‡ç­‰ å‚æ•°-l ï¼šç»Ÿè®¡è¡Œæ•° -w : ç»Ÿè®¡å•è¯æ°´æµª -m : ç»Ÿè®¡å­—èŠ‚æ•°é‡ sed å‘½ä»¤å¯¹æ–‡æœ¬çš„å†…å®¹è¿›è¡Œæ›¿æ¢, åˆ é™¤ï¼Œæ›´æ–°ç­‰æ“ä½œ å‘½ä»¤åŸºæœ¬æ ¼å¼1sed [é€‰é¡¹] [è„šæœ¬å‘½ä»¤] æ–‡ä»¶å å‘½ä»¤å‚æ•°-e : è¯¥é€‰é¡¹ä¼šå°†å…¶åè·Ÿçš„è„šæœ¬å‘½ä»¤æ·»åŠ åˆ°å·²æœ‰çš„å‘½ä»¤ä¸­ã€‚ -f ï¼šè¯¥é€‰é¡¹ä¼šå°†å…¶åæ–‡ä»¶ä¸­çš„è„šæœ¬å‘½ä»¤æ·»åŠ åˆ°å·²æœ‰çš„å‘½ä»¤ä¸­ -n : é»˜è®¤æƒ…å†µä¸‹ï¼Œsed ä¼šåœ¨æ‰€æœ‰çš„è„šæœ¬æŒ‡å®šæ‰§è¡Œå®Œæ¯•åï¼Œä¼šè‡ªåŠ¨è¾“å‡ºå¤„ç†åçš„å†…å®¹ï¼Œè€Œè¯¥é€‰é¡¹ä¼šå±è”½å¯åŠ¨è¾“å‡ºï¼Œéœ€ä½¿ç”¨ print å‘½ä»¤æ¥å®Œæˆè¾“å‡ºã€‚ -i : æ­¤é€‰é¡¹ä¼šç›´æ¥ä¿®æ”¹æºæ–‡ä»¶ï¼Œè¦æ…ç”¨ã€‚ è„šæœ¬å‘½ä»¤æ›¿æ¢è„šæœ¬å‘½ä»¤så‘½ä»¤æ ¼å¼ 1[address]s/pattern/replacement/flags å¸¸è§flag n 1~512 ä¹‹é—´çš„æ•°å­—ï¼Œè¡¨ç¤ºæŒ‡å®šè¦æ›¿æ¢çš„å­—ç¬¦ä¸²å‡ºç°ç¬¬å‡ æ¬¡æ—¶æ‰è¿›è¡Œæ›¿æ¢ï¼Œä¾‹å¦‚ï¼Œä¸€è¡Œä¸­æœ‰ 3 ä¸ª Aï¼Œä½†ç”¨æˆ·åªæƒ³æ›¿æ¢ç¬¬äºŒä¸ª Aï¼Œè¿™æ˜¯å°±ç”¨åˆ°è¿™ä¸ªæ ‡è®°ï¼› g å¯¹æ•°æ®ä¸­æ‰€æœ‰åŒ¹é…åˆ°çš„å†…å®¹è¿›è¡Œæ›¿æ¢ï¼Œå¦‚æœæ²¡æœ‰ gï¼Œåˆ™åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŒ¹é…æˆåŠŸæ—¶åšæ›¿æ¢æ“ä½œã€‚ä¾‹å¦‚ï¼Œä¸€è¡Œæ•°æ®ä¸­æœ‰ 3 ä¸ª Aï¼Œåˆ™åªä¼šæ›¿æ¢ç¬¬ä¸€ä¸ª Aï¼› p ä¼šæ‰“å°ä¸æ›¿æ¢å‘½ä»¤ä¸­æŒ‡å®šçš„æ¨¡å¼åŒ¹é…çš„è¡Œã€‚æ­¤æ ‡è®°é€šå¸¸ä¸ -n é€‰é¡¹ä¸€èµ·ä½¿ç”¨ã€‚ w file å°†ç¼“å†²åŒºä¸­çš„å†…å®¹å†™åˆ°æŒ‡å®šçš„ file æ–‡ä»¶ä¸­ï¼› &amp; ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹è¿›è¡Œæ›¿æ¢ï¼› \n åŒ¹é…ç¬¬ n ä¸ªå­ä¸²ï¼Œè¯¥å­ä¸²ä¹‹å‰åœ¨ pattern ä¸­ç”¨ () æŒ‡å®šã€‚ \ è½¬ä¹‰ï¼ˆè½¬ä¹‰æ›¿æ¢éƒ¨åˆ†åŒ…å«ï¼š&amp;ã€\ ç­‰ï¼‰ã€‚ ä½¿ç”¨ç¤ºä¾‹ 12sed 's/test/trial/2' data4.txt# å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨æ•°å­— 2 ä½œä¸ºæ ‡è®°çš„ç»“æœå°±æ˜¯ï¼Œsed ç¼–è¾‘å™¨åªæ›¿æ¢æ¯è¡Œä¸­ç¬¬ 2 æ¬¡å‡ºç°çš„åŒ¹é…æ¨¡å¼ã€‚ åˆ é™¤è„šæœ¬å‘½ä»¤å‘½ä»¤æ ¼å¼ 1[address]d ä½¿ç”¨ç¤ºä¾‹ 123sed '2,3d' data6.txt # åˆ é™¤ç¬¬2ã€3è¡Œçš„æ•°æ®sed '/1/,/3/d' data6.txt # åˆ é™¤1~3è¡Œçš„æ•°æ®sed '3,$d' data6.txt # åˆ é™¤ç¬¬3è¡Œåˆ°æœ€åä¸€è¡Œçš„æ•°æ® æ’å…¥æ•°æ®è¡Œå‘½ä»¤å‘½ä»¤æ ¼å¼ 1[address]aï¼ˆæˆ– iï¼‰\æ–°æ–‡æœ¬å†…å®¹ å¤‡æ³¨: a å‘½ä»¤è¡¨ç¤ºåœ¨æŒ‡å®šè¡Œçš„åé¢é™„åŠ ä¸€è¡Œï¼Œi å‘½ä»¤è¡¨ç¤ºåœ¨æŒ‡å®šè¡Œçš„å‰é¢æ’å…¥ä¸€è¡Œ ä½¿ç”¨ç¤ºä¾‹ 12sed '3a\&gt; This is an appended line.' data6.txt # å°†ä¸€ä¸ªæ–°è¡Œé™„åŠ åˆ°æ•°æ®æµä¸­ç¬¬ä¸‰è¡Œå æ›¿æ¢è„šæœ¬å‘½ä»¤cå‘½ä»¤æ ¼å¼ 1[address]c\ç”¨äºæ›¿æ¢çš„æ–°æ–‡æœ¬ ä½¿ç”¨ç¤ºä¾‹ 1234567sed '3c\&gt; This is a changed line of text.' data6.txt # sed ç¼–è¾‘å™¨ä¼šä¿®æ”¹ç¬¬ä¸‰è¡Œä¸­çš„æ–‡æœ¬sed '/number 3/c\&gt; This is a changed line of text.' data6.txt# sed ç¼–è¾‘å™¨ä¼šä¿®æ”¹åŒ…å«number 3 çš„è¡Œ è½¬æ¢è„šæœ¬å‘½ä»¤å‘½ä»¤æ ¼å¼ 1[address]y/inchars/outchars/ ä½¿ç”¨ç¤ºä¾‹ 1sed 'y/123/789/' data8.txt # å°†1=&gt;7, 2=&gt;8, 3=&gt;9]]></content>
      <categories>
        <category>shell</category>
        <category>shellè¯­æ³•</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[jdbc ä½¿ç”¨]]></title>
    <url>%2F2019%2F12%2F13%2F14.Java%2FJava%E5%9F%BA%E7%A1%80%2Fjdbc%2F</url>
    <content type="text"><![CDATA[JDBC çš„ä»‹ç»JDBC:java database connectivity JDBCå®šä¹‰ä¸€å¥—æ ‡å‡†æ¥å£ï¼Œå³è®¿é—®æ•°æ®åº“çš„é€šç”¨APIï¼Œä¸åŒçš„æ•°æ®åº“å‚å•†æ ¹æ®å„è‡ªæ•°æ®åº“çš„ç‰¹ç‚¹å»å®ç°è¿™äº›æ¥å£ï¼Œå®ç°æ¥å£ã€ç±»ï¼šé©±åŠ¨ï¼šç”±æ•°æ®åº“å‚å•†å®ç° JDBCæ˜¯javaåº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ä¹‹é—´çš„é€šä¿¡æ¡¥æ¢ï¼Œæ˜¯javaåº”ç”¨ç¨‹åºè®¿é—®æ•°æ®åº“çš„é€šé“ JDBCæ ‡å‡†ä¸»è¦ç”±ä¸€ç»„æ¥å£ç»„æˆï¼Œå…¶å¥½å¤„æ˜¯ç»Ÿä¸€äº†å„ç§æ•°æ®åº“è®¿é—®æ–¹å¼ JDBCæ¥å£çš„å®ç°ç±»ç§°ä¸ºæ•°æ®åº“é©±åŠ¨ï¼Œç”±å„ä¸ªæ•°æ®åº“å‚å•†æä¾›ï¼Œä½¿ç”¨JDBCå¿…é¡»å¯¼å…¥è¿™ä¸ªé©±åŠ¨ï¼ä¸€å®šçŸ¥é“é©±åŠ¨æ˜¯ä»€ä¹ˆï¼ JDBC è¿›è¡ŒCURDJDBCä½¿ç”¨æ­¥éª¤1ã€å¯¼å…¥JDBCé©±åŠ¨ å†mavené…ç½®ä¸­å¯¼å…¥ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.32&lt;/version&gt;&lt;/dependency&gt; 1ã€æ³¨å†ŒJDBCé©±åŠ¨ â€‹ å‚æ•°ï¼šâ€œé©±åŠ¨ç¨‹åºç±»åâ€ 1Class.forname("é©±åŠ¨ç¨‹åºç±»å") 3ã€è·å¾—Connectionå¯¹è±¡ éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼šurlï¼Œusernameï¼Œpassword - è¿æ¥åˆ°æ•°æ®åº“ 1connection = DriverManager.getConnection(url, user, password); 4ã€åˆ›å»ºStatementï¼ˆè¯­å¥ï¼‰å¯¹è±¡ 1234567state = conn.getStatemnent() æ–¹æ³•åˆ›å»ºå¯¹è±¡state.execute(ddl) æ‰§è¡Œä»»ä½•SQLï¼Œå¸¸ç”¨äºæ‰§è¡ŒDDLã€DCLstate.executeUpdate(dmlï¼‰ æ‰§è¡ŒDMLè¯­å¥ï¼Œå¦‚ï¼šinsertï¼Œupdateï¼Œdeletestate.executeQuery(dql) æ‰§è¡ŒDQLè¯­å¥ï¼Œå¦‚ï¼šselect 5å¤„ç†æ‰§è¡Œç»“æœï¼š 1234567state.execute(ddl) å¦‚æœæ²¡æœ‰å¼‚å¸¸åˆ™æˆåŠŸ booleanstate.executeUpdate(dmlï¼‰ è¿”å›æ•°å­—ï¼Œè¡¨ç¤ºæ›´æ–°â€œè¡Œâ€æ•°é‡ï¼ŒæŠ›å‡ºå¼‚å¸¸åˆ™å¤±è´¥ intstate.executeQuery(dql) è¿”å›ResultSetï¼ˆç»“æœï¼‰å¯¹è±¡ï¼Œä»£è¡¨2ç»´æŸ¥è¯¢ç»“æœï¼Œ ResultSetä½¿ç”¨foréå†å¤„ç†ï¼Œå¦‚æœæŸ¥è¯¢å¤±è´¥æŠ›å‡ºå¼‚å¸¸ 6ã€å…³é—­æ•°æ®è¿æ¥ï¼ï¼ 1conn.close(); JDBCä½¿ç”¨ç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import java.sql.Connection;import java.sql.DriverManager;import java.sql.PreparedStatement;import java.sql.ResultSet;/** * @author Evan */public class JDBCTest &#123; public static void main(String[] args) throws Exception &#123; Connection connection = null; PreparedStatement prepareStatement = null; ResultSet rs = null; try &#123; // åŠ è½½é©±åŠ¨ Class.forName("com.mysql.jdbc.Driver"); // è·å–è¿æ¥ String url = "jdbc:mysql://127.0.0.1:3306/ssmdemo"; String user = "root"; String password = "123456"; connection = DriverManager.getConnection(url, user, password); // è·å–statementï¼ŒpreparedStatement String sql = "select * from tb_user where id=?"; prepareStatement = connection.prepareStatement(sql); // è®¾ç½®å‚æ•° prepareStatement.setLong(1, 1l); // æ‰§è¡ŒæŸ¥è¯¢ rs = prepareStatement.executeQuery(); // å¤„ç†ç»“æœé›† while (rs.next()) &#123; System.out.println(rs.getString("userName")); System.out.println(rs.getString("name")); System.out.println(rs.getInt("age")); System.out.println(rs.getDate("birthday")); &#125; &#125; finally &#123; // å…³é—­è¿æ¥ï¼Œé‡Šæ”¾èµ„æº if (rs != null) &#123; rs.close(); &#125; if (prepareStatement != null) &#123; prepareStatement.close(); &#125; if (connection != null) &#123; connection.close(); &#125; &#125; &#125;&#125; è§£å†³sqlæ³¨å…¥é—®é¢˜è§£å†³åŠæ³•Statementä¸»è¦ç”¨äºæ‰§è¡Œé™æ€SQLè¯­å¥ï¼Œå³å†…å®¹å›ºå®šä¸å˜çš„SQLè¯­å¥ï¼› è¿™æ ·å®¹æ˜“å¼•å…¥sqlæ³¨å…¥çš„æ”»å‡»é—®é¢˜ï¼› PreparedStatementå¯¹è±¡ç”¨äºæ‰§è¡Œå¸¦å‚æ•°çš„é¢„ç¼–è¯‘æ‰§è¡Œè®¡åˆ’ï¼›å¯ä»¥é‡å¤ä½¿ç”¨æ‰§è¡Œè®¡åˆ’ï¼Œæé«˜DBæ•ˆç‡ï¼Œå¯ä»¥é‡ç”¨æ‰§è¡Œè®¡åˆ’ï¼Œè€Œä¸”å¯ä»¥æ‰§è¡Œå¤šæ¬¡ï¼›å¯ä»¥é¿å…æ³¨å…¥æ”»å‡»ã€‚ æ‰€ä»¥ä½¿ç”¨PreparedStatement æ¥ä»£æ›¿Statement æ¥è§£å†³sqlæ³¨å…¥çš„é—®é¢˜ ä½¿ç”¨ç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package demo;import java.sql.Connection;import java.sql.DriverManager;import java.sql.PreparedStatement;import java.sql.ResultSet;import org.junit.Test;public class TestLogin &#123; @Test public void testLogin() &#123; try &#123; login("zhangsan' or 'zhangsan", "666"); &#125; catch (Exception ex) &#123; ex.printStackTrace(); &#125; &#125; public void login(String username, String password) throws Exception &#123; Class.forName("com.mysql.jdbc.Driver"); String url = "jdbc:mysql://localhost:3306/mybase"; String usern = "root"; String pwd = "xuyiqing"; Connection conn = DriverManager.getConnection(url, usern, pwd); String sql = "select * from users where username=? and upassword=?"; PreparedStatement pstmt = conn.prepareStatement(sql); pstmt.setString(1, username); pstmt.setString(2, password); ResultSet rs = pstmt.executeQuery(); if (rs.next()) &#123; System.out.println("ç™»å½•æˆåŠŸ"); System.out.println(sql); &#125; else &#123; System.out.println("è´¦å·æˆ–å¯†ç é”™è¯¯ï¼"); &#125; if (rs != null) &#123; rs.close(); &#125; if (pstmt != null) &#123; pstmt.close(); &#125; if (conn != null) &#123; conn.close(); &#125; &#125;&#125; äº‹åŠ¡æ“ä½œæ€æ ·è¿›è¡Œäº‹åŠ¡æ“ä½œæ•°æ®åº“æä¾›äº†äº‹åŠ¡æ§åˆ¶åŠŸèƒ½ï¼Œæ”¯æŒACIDç‰¹æ€§ JDBCæä¾›äº†APIï¼Œæ–¹ä¾¿åœ°è°ƒç”¨æ•°æ®åº“çš„äº‹åŠ¡åŠŸèƒ½ï¼Œå…¶æ–¹æ³•æœ‰ï¼š Connection.getAutoCommit()ï¼šè·å¾—å½“å‰äº‹åŠ¡çš„æäº¤æ–¹å¼ï¼Œé»˜è®¤æ˜¯true Connection.setAutoCommit()ï¼šè®¾ç½®äº‹åŠ¡çš„æäº¤å±æ€§ï¼Œå‚æ•°æ˜¯trueï¼šè‡ªåŠ¨æäº¤ï¼›falseï¼šä¸è‡ªåŠ¨æäº¤ï¼Œå–æ¶ˆè‡ªåŠ¨æäº¤ï¼Œåç»­æ‰‹åŠ¨æäº¤ Connection.Commit()ï¼šæäº¤äº‹åŠ¡ Connection.rollback()ï¼šå›æ»šäº‹åŠ¡ ä½¿ç”¨ç¤ºä¾‹123456789101112131415161718192021222324252627282930public static void dbTest() &#123; Connection conn = null; try &#123; conn = DBUtils.getConnection(); conn.setAutoCommit(false); //ä¸šåŠ¡å¤„ç† æ‰§è¡Œè®¡åˆ’ä½¿ç”¨æ­¥éª¤ String sql = "insert into test_wcx values( ?,?,?)"; // 1ã€å°†å¸¦å‚æ•°çš„SQLå‘é€åˆ°æ•°æ®åº“åˆ›å»ºæ‰§è¡Œè®¡åˆ’ PreparedStatement ps = conn.prepareStatement(sql); //2ã€æ›¿æ¢æ‰§è¡Œè®¡åˆ’ä¸­çš„å‚æ•° ps.setInt(1, 2); ps.setString(2, "weicx"); ps.setString(3, "test"); //3ã€æ‰§è¡Œæ‰§è¡Œè®¡åˆ’ï¼Œå¾—åˆ°ç»“æœ int result = ps.executeUpdate(); System.out.println(result); conn.commit(); &#125; catch (Exception e) &#123; e.printStackTrace(); DBUtils.rollback(conn); &#125; finally &#123; DBUtils.close(conn); &#125; &#125; æ•°æ®åº“è¿æ¥æ± ä¸ºä»€ä¹ˆä½¿ç”¨è¿æ¥æ± æ•°æ®åº“è¿æ¥æ± æ˜¯ç®¡ç†å¹¶å‘è®¿é—®æ•°æ®åº“è¿æ¥çš„ç†æƒ³è§£å†³æ–¹æ¡ˆ è§£å†³å¹¶å‘é—®é¢˜;æ•°æ®åº“çš„å¹¶å‘æœ‰é™,é™åˆ¶è¿æ¥æ•°ï¼Œé¿å…æ•°æ®åº“å´©æºƒ;é‡ç”¨æ•°æ®åº“è¿æ¥ è§£å†³åŠæ³•è¿æ¥æ± æ˜¯åˆ›å»ºå’Œç®¡ç†è¿æ¥çš„ç¼“å†²æ± æŠ€æœ¯ï¼Œå°†è¿æ¥å‡†å¤‡å¥½è¢«ä»»ä½•éœ€è¦ä»–ä»¬çš„åº”ç”¨ä½¿ç”¨ DriverManagerç®¡ç†æ•°æ®åº“è¿æ¥é€‚åˆå•çº¿ç¨‹æƒ…å†µï¼Œè€Œåœ¨å¤šçº¿ç¨‹å¹¶å‘æƒ…å†µä¸‹ï¼Œä¸ºäº†èƒ½å¤Ÿé‡ç”¨æ•°æ®åº“è¿æ¥ï¼ŒåŒæ—¶æ§åˆ¶å¹¶å‘è¿æ¥æ€»æ•°ï¼Œä¿æŠ¤æ•°æ®åº“é¿å…è¿æ¥è¿‡è½½ï¼Œä¸€å®šè¦ä½¿ç”¨æ•°æ®åº“è¿æ¥æ±  DBCPçš„ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± çš„å¼€æºå®ç°éå¸¸å¤šï¼ŒDBCPæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚ ä½¿ç”¨DBCPæ­¥éª¤ï¼š å¯¼å…¥è¿æ¥æ± ä¾èµ–ï¼Œä¿®æ”¹maven çš„pomæ–‡ä»¶ 12345678910&lt;dependency&gt; &lt;groupId&gt;commons-dbcp&lt;/groupId&gt; &lt;artifactId&gt;commons-dbcp&lt;/artifactId&gt; &lt;version&gt;1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;commons-pool&lt;/groupId&gt; &lt;artifactId&gt;commons-pool&lt;/artifactId&gt; &lt;version&gt;1.5.4&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºè¿æ¥æ± å¯¹è±¡ è®¾ç½®æ•°æ®åº“å¿…é¡»çš„è¿æ¥å‚æ•°, å¯é€‰çš„è¿æ¥å‚æ•° ä»è¿æ¥æ± ä¸­è·å¾—æ´»åŠ¨çš„æ•°æ®åº“è¿æ¥ æ‰§è¡Œsqlæ“ä½œ ä½¿ç”¨ä»¥åå…³é—­æ•°æ®åº“è¿æ¥ï¼Œè¿™ä¸ªå…³é—­ä¸å†æ˜¯çœŸçš„å…³é—­è¿æ¥ï¼Œè€Œæ˜¯å°†ä½¿ç”¨è¿‡çš„è¿æ¥å½’è¿˜ç»™è¿æ¥æ±  ä½¿ç”¨ç¤ºä¾‹æ™®é€šæ–¹å¼è¿æ¥ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package com.java.dbcp;import java.sql.Connection;import java.sql.PreparedStatement;import java.sql.SQLException;import org.apache.commons.dbcp.BasicDataSource;import com.java.jdbc.util.JDBCUtil;public class DBCPDemo &#123; public void testDBCP01() &#123; Connection connection = null; PreparedStatement ps = null; try &#123; //1ã€æ„å»ºæ•°æ®æºå¯¹è±¡ BasicDataSource dataSource = new BasicDataSource(); dataSource.setDriverClassName("com.mysql.jdbc.Driver"); dataSource.setUrl("jdbc:mysql://localhost/php?useSSL=false"); dataSource.setUsername("root"); dataSource.setPassword("123456"); //2ã€å¾—åˆ°è¿æ¥å¯¹è±¡ connection = dataSource.getConnection(); String sql = "insert into stus values(6,?,?)"; ps = connection.prepareStatement(sql); ps.setString(1, "ling"); ps.setString(2, "666666"); ps.executeUpdate(); &#125; catch (SQLException e) &#123; e.printStackTrace(); &#125;finally &#123; JDBCUtil.release(connection, ps); &#125; &#125; public static void main(String[] args) &#123; DBCPDemo dbcp = new DBCPDemo(); dbcp.testDBCP01(); &#125;&#125; é€šè¿‡é…ç½®æ–‡ä»¶çš„æ–¹å¼è¿æ¥ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package com.java.dbcp;import java.io.FileInputStream;import java.io.InputStream;import java.sql.Connection;import java.sql.PreparedStatement;import java.util.Properties;import javax.sql.DataSource;import org.apache.commons.dbcp.BasicDataSourceFactory;import com.java.jdbc.util.JDBCUtil;public class DBCPDemo02 &#123; public void dbcpdemo() &#123; Connection connection = null; PreparedStatement ps = null; try &#123; BasicDataSourceFactory factory = new BasicDataSourceFactory(); Properties properties = new Properties(); InputStream iStream = new FileInputStream("src/dbcpconfig.properties"); properties.load(iStream); DataSource dataSource = factory.createDataSource(properties); //2ã€å¾—åˆ°è¿æ¥å¯¹è±¡ connection = dataSource.getConnection(); String sql = "insert into stus values(7,?,?)"; ps = connection.prepareStatement(sql); ps.setString(1, "wu"); ps.setString(2, "123456789"); ps.executeUpdate(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125;finally &#123; JDBCUtil.release(connection, ps); &#125; &#125; public static void main(String[] args) &#123; DBCPDemo02 demo = new DBCPDemo02(); demo.dbcpdemo(); &#125;&#125; é…ç½®æ–‡ä»¶ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132#è¿æ¥è®¾ç½®driverClassName=com.mysql.jdbc.Driverurl=jdbc:mysql://localhost/php?useSSL=falseusername=rootpassword=abc123456#&lt;!-- åˆå§‹åŒ–è¿æ¥ --&gt;initialSize=10#æœ€å¤§è¿æ¥æ•°é‡maxActive=50#&lt;!-- æœ€å¤§ç©ºé—²è¿æ¥ --&gt;maxIdle=20#&lt;!-- æœ€å°ç©ºé—²è¿æ¥ --&gt;minIdle=5#&lt;!-- è¶…æ—¶ç­‰å¾…æ—¶é—´ä»¥æ¯«ç§’ä¸ºå•ä½ 6000æ¯«ç§’/1000ç­‰äº60ç§’ --&gt;maxWait=60000#JDBCé©±åŠ¨å»ºç«‹è¿æ¥æ—¶é™„å¸¦çš„è¿æ¥å±æ€§å±æ€§çš„æ ¼å¼å¿…é¡»ä¸ºè¿™æ ·ï¼š[å±æ€§å=property;] #æ³¨æ„ï¼š"user" ä¸ "password" ä¸¤ä¸ªå±æ€§ä¼šè¢«æ˜ç¡®åœ°ä¼ é€’ï¼Œå› æ­¤è¿™é‡Œä¸éœ€è¦åŒ…å«ä»–ä»¬ã€‚connectionProperties=useUnicode=true;characterEncoding=gbk#æŒ‡å®šç”±è¿æ¥æ± æ‰€åˆ›å»ºçš„è¿æ¥çš„è‡ªåŠ¨æäº¤ï¼ˆauto-commitï¼‰çŠ¶æ€ã€‚defaultAutoCommit=true#driver default æŒ‡å®šç”±è¿æ¥æ± æ‰€åˆ›å»ºçš„è¿æ¥çš„äº‹åŠ¡çº§åˆ«ï¼ˆTransactionIsolationï¼‰ã€‚#å¯ç”¨å€¼ä¸ºä¸‹åˆ—ä¹‹ä¸€ï¼šï¼ˆè¯¦æƒ…å¯è§javadocã€‚ï¼‰NONE,READ_UNCOMMITTED, READ_COMMITTED, REPEATABLE_READ, SERIALIZABLEdefaultTransactionIsolation=READ_UNCOMMITTED]]></content>
      <categories>
        <category>Java</category>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[maven ä½¿ç”¨]]></title>
    <url>%2F2019%2F12%2F07%2F14.Java%2FJava%E5%9F%BA%E7%A1%80%2Fmaven%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯Mavenæ„å»ºjavaé¡¹ç›®éœ€è¦ç”¨åˆ°å¾ˆå¤šç¬¬ä¸‰æ–¹çš„ç±»åº“ï¼Œéœ€è¦å¼•å…¥å¤§é‡çš„jaråŒ…ã€‚JaråŒ…ä¹‹é—´çš„å…³ç³»é”™ç»¼å¤æ‚ï¼Œä¸€ä¸ªJaråŒ…å¾€å¾€åˆä¼šå¼•ç”¨å…¶ä»–JaråŒ…ï¼Œç¼ºå°‘ä»»ä½•ä¸€ä¸ªJaråŒ…éƒ½ä¼šå¯¼è‡´é¡¹ç›®ç¼–è¯‘å¤±è´¥ã€‚ ä»¥å¾€å¼€å‘é¡¹ç›®æ—¶ï¼Œç¨‹åºå‘˜å¾€å¾€éœ€è¦èŠ±è¾ƒå¤šçš„ç²¾åŠ›åœ¨å¼•ç”¨JaråŒ…æ­å»ºé¡¹ç›®ç¯å¢ƒä¸Šï¼Œè€Œè¿™ä¸€é¡¹å·¥ä½œå°¤ä¸ºè‰°éš¾ã€‚ è€ŒMavenå°±æ˜¯ä¸€æ¬¾å¸®åŠ©ç¨‹åºå‘˜æ„å»ºé¡¹ç›®çš„å·¥å…·ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰Mavenéœ€è¦å“ªäº›Jar åŒ…ï¼Œå®ƒä¼šå¸®åŠ©æˆ‘ä»¬ä¸‹è½½æ‰€æœ‰çš„Jarï¼Œæå¤§æå‡å¼€å‘æ•ˆç‡ã€‚ maven ä¸‹è½½åœ°å€: http://maven.apache.org/download.cgi Maven ç›®å½•ç»“æ„ MavenåŸºæœ¬å‘½ä»¤ -v: æŸ¥è¯¢Mavenç‰ˆæœ¬ æœ¬å‘½ä»¤ç”¨äºæ£€æŸ¥mavenæ˜¯å¦å®‰è£…æˆåŠŸã€‚ Mavenå®‰è£…å®Œæˆä¹‹åï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥mvn -vï¼Œè‹¥å‡ºç°mavenä¿¡æ¯ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚ compileï¼šç¼–è¯‘ å°†javaæºæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶ test: æµ‹è¯•é¡¹ç›® æ‰§è¡Œtestç›®å½•ä¸‹çš„æµ‹è¯•ç”¨ä¾‹ package: æ‰“åŒ… å°†é¡¹ç›®æ‰“æˆjaråŒ… clean: åˆ é™¤targetæ–‡ä»¶å¤¹ install: å®‰è£… å°†å½“å‰é¡¹ç›®æ”¾åˆ°Mavençš„æœ¬åœ°ä»“åº“ä¸­ã€‚ä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨ Maven ä»“åº“Mavenä»“åº“ç”¨æ¥å­˜æ”¾Mavenç®¡ç†çš„æ‰€æœ‰JaråŒ…ã€‚åˆ†ä¸ºï¼šæœ¬åœ°ä»“åº“ å’Œ ä¸­å¤®ä»“åº“ã€‚ æœ¬åœ°ä»“åº“ï¼šMavenæœ¬åœ°çš„JaråŒ…ä»“åº“ã€‚ ä¸­å¤®ä»“åº“ï¼š Mavenå®˜æ–¹æä¾›çš„è¿œç¨‹ä»“åº“ã€‚ å½“é¡¹ç›®ç¼–è¯‘æ—¶ï¼ŒMavené¦–å…ˆä»æœ¬åœ°ä»“åº“ä¸­å¯»æ‰¾é¡¹ç›®æ‰€éœ€çš„JaråŒ…ï¼Œè‹¥æœ¬åœ°ä»“åº“æ²¡æœ‰ï¼Œå†åˆ°Mavençš„ä¸­å¤®ä»“åº“ä¸‹è½½æ‰€éœ€JaråŒ…ã€‚ Maven åæ ‡åœ¨Mavenä¸­ï¼Œåæ ‡æ˜¯JaråŒ…çš„å”¯ä¸€æ ‡è¯†ï¼ŒMavené€šè¿‡åæ ‡åœ¨ä»“åº“ä¸­æ‰¾åˆ°é¡¹ç›®æ‰€éœ€çš„JaråŒ…ã€‚ å¦‚ä¸‹ä»£ç ä¸­ï¼ŒgroupIdå’ŒartifactIdæ„æˆäº†ä¸€ä¸ªJaråŒ…çš„åæ ‡ã€‚ 123456&lt;dependency&gt; &lt;groupId&gt;cn.missbe.web.search&lt;/groupId&gt; &lt;artifactId&gt;resource-search&lt;/artifactId&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; groupId:æ‰€éœ€JaråŒ…çš„é¡¹ç›®å artifactId:æ‰€éœ€JaråŒ…çš„æ¨¡å—å version:æ‰€éœ€JaråŒ…çš„ç‰ˆæœ¬å· ä¼ é€’ä¾èµ–å’Œæ’é™¤ä¾èµ– ä¼ é€’ä¾èµ–ï¼šå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®å¼•ç”¨äº†ä¸€ä¸ªJaråŒ…ï¼Œè€Œè¯¥JaråŒ…åˆå¼•ç”¨äº†å…¶ä»–JaråŒ…ï¼Œé‚£ä¹ˆåœ¨é»˜è®¤æƒ…å†µä¸‹é¡¹ç›®ç¼–è¯‘æ—¶ï¼ŒMavenä¼šæŠŠç›´æ¥å¼•ç”¨å’Œé—´æ¥å¼•ç”¨çš„JaråŒ…éƒ½ä¸‹è½½åˆ°æœ¬åœ°ã€‚ æ’é™¤ä¾èµ–ï¼šå¦‚æœæˆ‘ä»¬åªæƒ³ä¸‹è½½ç›´æ¥å¼•ç”¨çš„JaråŒ…ï¼Œé‚£ä¹ˆéœ€è¦åœ¨pom.xmlä¸­åšå¦‚ä¸‹é…ç½®ï¼š(å°†éœ€è¦æ’é™¤çš„JaråŒ…çš„åæ ‡å†™åœ¨ä¸­) 12345678&lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;cn.missbe.web.search&lt;/groupId&gt; &lt;artifactId&gt;resource-search&lt;/artifactId&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/exclusion&gt;&lt;/exclusions&gt; ä¾èµ–èŒƒå›´ scopeåœ¨é¡¹ç›®å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œå¸®åŠ©å†³å®šå“ªäº›æ„ä»¶è¢«åŒ…æ‹¬è¿›æ¥ã€‚æ¬²çŸ¥è¯¦æƒ…è¯·å‚è€ƒä¾èµ–æœºåˆ¶ã€‚ compile ï¼šé»˜è®¤èŒƒå›´ï¼Œç”¨äºç¼–è¯‘ providedï¼šç±»ä¼¼äºç¼–è¯‘ï¼Œä½†æ”¯æŒä½ æœŸå¾…jdkæˆ–è€…å®¹å™¨æä¾›ï¼Œç±»ä¼¼äºclasspath runtime: åœ¨æ‰§è¡Œæ—¶éœ€è¦ä½¿ç”¨ test: ç”¨äºtestä»»åŠ¡æ—¶ä½¿ç”¨ system: éœ€è¦å¤–åœ¨æä¾›ç›¸åº”çš„å…ƒç´ ã€‚é€šè¿‡systemPathæ¥å–å¾— systemPath: ä»…ç”¨äºèŒƒå›´ä¸ºsystemã€‚æä¾›ç›¸åº”çš„è·¯å¾„ optional: å½“é¡¹ç›®è‡ªèº«è¢«ä¾èµ–æ—¶ï¼Œæ ‡æ³¨ä¾èµ–æ˜¯å¦ä¼ é€’ã€‚ç”¨äºè¿ç»­ä¾èµ–æ—¶ä½¿ç”¨ ä¾èµ–å†²çªè‹¥é¡¹ç›®ä¸­å¤šä¸ªJaråŒæ—¶å¼•ç”¨äº†ç›¸åŒçš„Jaræ—¶ï¼Œä¼šäº§ç”Ÿä¾èµ–å†²çªï¼Œä½†Mavené‡‡ç”¨äº†ä¸¤ç§é¿å…å†²çªçš„ç­–ç•¥ï¼Œå› æ­¤åœ¨Mavenä¸­æ˜¯ä¸å­˜åœ¨ä¾èµ–å†²çªçš„ã€‚ çŸ­è·¯ä¼˜å…ˆ æœ¬é¡¹ç›®â€”â€”&gt;A.jarâ€”â€”&gt;B.jarâ€”â€”&gt;X.jar æœ¬é¡¹ç›®â€”â€”&gt;C.jarâ€”â€”&gt;X.jar è‹¥æœ¬é¡¹ç›®å¼•ç”¨äº†A.jarï¼ŒA.jaråˆå¼•ç”¨äº†B.jarï¼ŒB.jaråˆå¼•ç”¨äº†X.jarï¼Œå¹¶ä¸”C.jarä¹Ÿå¼•ç”¨äº†X.jarã€‚ åœ¨æ­¤æ—¶ï¼ŒMavenåªä¼šå¼•ç”¨å¼•ç”¨è·¯å¾„æœ€çŸ­çš„Jarã€‚ å£°æ˜ä¼˜å…ˆ è‹¥å¼•ç”¨è·¯å¾„é•¿åº¦ç›¸åŒæ—¶ï¼Œå†pom.xmlä¸­è°å…ˆè¢«ç”Ÿå‘½ï¼Œå°±ä½¿ç”¨è°ï¼› èšåˆ ä»€ä¹ˆæ˜¯èšåˆ å°†å¤šä¸ªé¡¹ç›®åŒæ—¶æ„å»ºå°±ç§°ä¸ºèšåˆ å¦‚ä½•å®ç°èšåˆ å†mavené¡¹ç›®çš„pomä¸­ä½œå¦‚ä¸‹é…ç½® 1234&lt;modules&gt; &lt;module&gt;web-connection-pool&lt;/module&gt; &lt;module&gt;web-java-crawler&lt;/module&gt;&lt;/modules&gt; ç»§æ‰¿ ä»€ä¹ˆæ˜¯ç»§æ‰¿ å†èšåˆå¤šä¸ªé¡¹ç›®æ—¶ï¼Œå¦‚æœè¿™äº›è¢«èšåˆçš„é¡¹ç›®ä¸­éœ€è¦å¼•å…¥ç›¸åŒçš„jaråŒ…ï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™äº›jarå†™å…¥çˆ¶pomä¸­ï¼Œå„ä¸ªå­é¡¹ç›®ç»§æ‰¿è¯¥pomå³å¯ã€‚ å¦‚æœå®ç°ç»§æ‰¿ çˆ¶pomé…ç½®: å°†éœ€è¦ç»§æ‰¿çš„jaråŒ…çš„åæ ‡æ”¾å…¥æ ‡ç­¾å³å¯ 12345678910&lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;cn.missbe.web.search&lt;/groupId&gt; &lt;artifactId&gt;resource-search&lt;/artifactId&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/dependencyManagement&gt; å­pomé…ç½®: 1234567891011&lt;parent&gt; &lt;groupId&gt;çˆ¶pomæ‰€åœ¨é¡¹ç›®çš„groupId&lt;/groupId&gt; &lt;artifactId&gt;çˆ¶pomæ‰€åœ¨é¡¹ç›®çš„artifactId&lt;/artifactId&gt; &lt;version&gt;çˆ¶pomæ‰€åœ¨é¡¹ç›®çš„ç‰ˆæœ¬å·&lt;/version&gt;&lt;/parent&gt; &lt;parent&gt; &lt;artifactId&gt;resource-search&lt;/artifactId&gt; &lt;groupId&gt;cn.missbe.web.search&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;&lt;/parent&gt; pomé…ç½®è§£æä¸€ã€åŸºæœ¬é…ç½®1.é…ç½®è¯´æ˜ 1234567891011121314151617181920212223242526272829&lt;!-- æ¨¡å‹ç‰ˆæœ¬ã€‚maven2.0å¿…é¡»æ˜¯è¿™æ ·å†™ï¼Œç°åœ¨æ˜¯maven2å”¯ä¸€æ”¯æŒçš„ç‰ˆæœ¬ --&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;!-- å…¬å¸æˆ–è€…ç»„ç»‡çš„å”¯ä¸€æ ‡å¿—ï¼Œå¹¶ä¸”é…ç½®æ—¶ç”Ÿæˆçš„è·¯å¾„ä¹Ÿæ˜¯ç”±æ­¤ç”Ÿæˆï¼Œ å¦‚com.winner.tradeï¼Œmavenä¼šå°†è¯¥é¡¹ç›®æ‰“æˆçš„jaråŒ…æ”¾æœ¬åœ°è·¯å¾„ï¼š/com/winner/trade --&gt; &lt;groupId&gt;com.winner.trade&lt;/groupId&gt;&lt;!-- æœ¬é¡¹ç›®çš„å”¯ä¸€IDï¼Œä¸€ä¸ªgroupIdä¸‹é¢å¯èƒ½å¤šä¸ªé¡¹ç›®ï¼Œå°±æ˜¯é artifactIdæ¥åŒºåˆ†çš„ --&gt;&lt;artifactId&gt;...&lt;/artifactId&gt;&lt;!-- æœ¬é¡¹ç›®ç›®å‰æ‰€å¤„çš„ç‰ˆæœ¬å· --&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;!-- æ‰“åŒ…çš„æœºåˆ¶ï¼Œå¦‚pom,jar, maven-plugin, ejb, war, ear, rar, parï¼Œé»˜è®¤ä¸ºjar --&gt;&lt;packaging&gt;jar&lt;/packaging&gt;&lt;!-- å®šä¹‰æœ¬é¡¹ç›®çš„ä¾èµ–å…³ç³» --&gt; &lt;dependencies&gt;...&lt;/dependencies&gt;&lt;!-- çˆ¶é¡¹ç›®çš„åæ ‡ã€‚å¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰è§„å®šæŸä¸ªå…ƒç´ çš„å€¼ï¼Œé‚£ä¹ˆçˆ¶é¡¹ç›®ä¸­çš„å¯¹åº”å€¼å³ä¸ºé¡¹ç›®çš„é»˜è®¤å€¼ã€‚åæ ‡åŒ…æ‹¬group IDï¼Œartifact IDå’Œ versionæˆ–è€…è¿˜æœ‰relativePath --&gt; &lt;parent&gt;...&lt;/parent&gt;&lt;!-- å®šä¹‰æœ¬é¡¹ç›®çš„ä¾èµ–å…³ç³» --&gt; &lt;dependencyManagement&gt;...&lt;/dependencyManagement&gt;&lt;!-- å­æ¨¡å—ä»£ç ï¼Œå¯¹modulesä¸‹çš„æ¨¡å—è¿›è¡Œèšåˆ --&gt; &lt;modules&gt;...&lt;/modules&gt;&lt;!-- ä¸ºpomå®šä¹‰ä¸€äº›å¸¸é‡ï¼Œåœ¨pomä¸­çš„å…¶å®ƒåœ°æ–¹å¯ä»¥ç›´æ¥å¼•ç”¨ ä½¿ç”¨æ–¹å¼ å¦‚ ï¼š$&#123;file.encoding&#125; --&gt; &lt;properties&gt;...&lt;/properties&gt; 2.dependencies å’Œ dependecyManagement çš„åŒºåˆ« 1ï¼‰dependencieså³ä½¿åœ¨å­é¡¹ç›®ä¸­ä¸å†™è¯¥ä¾èµ–é¡¹ï¼Œé‚£ä¹ˆå­é¡¹ç›®ä»ç„¶ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿è¯¥ä¾èµ–é¡¹ï¼ˆå…¨éƒ¨ç»§æ‰¿ï¼‰ 2ï¼‰dependencyManagementé‡Œåªæ˜¯å£°æ˜ä¾èµ–ï¼Œå¹¶ä¸å®ç°å¼•å…¥ï¼Œå› æ­¤å­é¡¹ç›®éœ€è¦æ˜¾ç¤ºçš„å£°æ˜éœ€è¦ç”¨çš„ä¾èµ–ã€‚å¦‚æœä¸åœ¨å­é¡¹ç›®ä¸­å£°æ˜ä¾èµ–ï¼Œæ˜¯ä¸ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿ä¸‹æ¥çš„ï¼›åªæœ‰åœ¨å­é¡¹ç›®ä¸­å†™äº†è¯¥ä¾èµ–é¡¹ï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®šå…·ä½“ç‰ˆæœ¬ï¼Œæ‰ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿è¯¥é¡¹ï¼Œå¹¶ä¸”versionå’Œscopeéƒ½è¯»å–è‡ªçˆ¶pom;å¦å¤–å¦‚æœå­é¡¹ç›®ä¸­æŒ‡å®šäº†ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨å­é¡¹ç›®ä¸­æŒ‡å®šçš„jarç‰ˆæœ¬ äºŒã€æ„å»ºè¿‡ç¨‹çš„è®¾ç½®1.é…ç½®ç¤ºä¾‹ 12345678910111213141516171819202122&lt;build&gt; &lt;finalName&gt;platform-b2c&lt;/finalName&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;$&#123;basedir&#125;/src/main/resources&lt;/directory&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;excludes&gt; &lt;exclude&gt;**/*.xls&lt;/exclude&gt; &lt;/excludes&gt; &lt;/resource&gt; &lt;!-- xlsæ–‡ä»¶ä¸èƒ½filterå¤„ç†ï¼Œéœ€åŒºåˆ†å‡ºæ¥ --&gt; &lt;resource&gt; &lt;directory&gt;$&#123;basedir&#125;/src/main/resources&lt;/directory&gt; &lt;filtering&gt;false&lt;/filtering&gt; &lt;includes&gt; &lt;include&gt;**/*.xls&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;plugins&gt;åˆ°æ—¶å€™è¯¦ç»†çœ‹&lt;/plugins&gt; &lt;pluginManagement&gt;åˆ°æ—¶å€™è¯¦ç»†çœ‹&lt;/pluginManagement&gt;&lt;/build&gt; 2.é…ç½®è¯´æ˜ 12345678910111213141516171819202122232425262728&lt;!-- äº§ç”Ÿçš„æ„ä»¶çš„æ–‡ä»¶åï¼Œé»˜è®¤å€¼æ˜¯$&#123;artifactId&#125;-$&#123;version&#125;ã€‚ --&gt; &lt;finalName&gt;myPorjectName&lt;/finalName&gt; &lt;!-- æ„å»ºäº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶å­˜æ”¾çš„ç›®å½•,é»˜è®¤ä¸º$&#123;basedir&#125;/targetï¼Œå³é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„target --&gt; &lt;directory&gt;$&#123;basedir&#125;/target&lt;/directory&gt; &lt;!--å¿…é¡»è·Ÿå‘½ä»¤è¡Œä¸Šçš„å‚æ•°ç›¸åŒä¾‹å¦‚jar:jarï¼Œæˆ–è€…ä¸æŸä¸ªé˜¶æ®µï¼ˆphaseï¼‰ç›¸åŒä¾‹å¦‚installã€compileç­‰ --&gt; &lt;defaultGoal&gt;install&lt;/defaultGoal&gt; &lt;!--å½“filteringå¼€å…³æ‰“å¼€æ—¶ï¼Œä½¿ç”¨åˆ°çš„è¿‡æ»¤å™¨å±æ€§æ–‡ä»¶åˆ—è¡¨ã€‚ --&gt; &lt;filters&gt; &lt;filter&gt;../filter.properties&lt;/filter&gt; &lt;/filters&gt; &lt;!--é¡¹ç›®ç›¸å…³çš„æ‰€æœ‰èµ„æºè·¯å¾„åˆ—è¡¨ï¼Œä¾‹å¦‚å’Œé¡¹ç›®ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€å±æ€§æ–‡ä»¶ï¼Œè¿™äº›èµ„æºè¢«åŒ…å«åœ¨æœ€ç»ˆçš„æ‰“åŒ…æ–‡ä»¶é‡Œã€‚ --&gt; &lt;resources&gt; &lt;resource&gt;è§3&lt;/resource&gt;&lt;/resources&gt; &lt;!--ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨ --&gt;&lt;plugins&gt; &lt;plugin&gt;...&lt;/plugin&gt;&lt;/plugins&gt; &lt;!--pluginManagementä¸»è¦æ˜¯ä¸ºäº†ç»Ÿä¸€ç®¡ç†æ’ä»¶ï¼Œç¡®ä¿æ‰€æœ‰å­POMä½¿ç”¨çš„æ’ä»¶ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œç±»ä¼¼dependencieså’ŒdependencyManagementï¼Œåªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œä¸€èˆ¬ç”¨åœ¨çˆ¶pomæ–‡ä»¶ä¸­ --&gt;&lt;pluginManagement&gt; &lt;plugins&gt;...&lt;/plugins&gt; &lt;/pluginManagement&gt; 3.resource è¯´æ˜ 123456789101112131415161718192021222324252627&lt;resources&gt; &lt;resource&gt; &lt;!--æè¿°äº†èµ„æºçš„ç›®æ ‡è·¯å¾„ã€‚è¯¥è·¯å¾„ç›¸å¯¹target/classesç›®å½•ï¼ˆä¾‹å¦‚$&#123;project.build.outputDirectory&#125;ï¼‰ã€‚ --&gt; &lt;!--ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æƒ³èµ„æºåœ¨ç‰¹å®šçš„åŒ…é‡Œ(org.apache.maven.messages)ï¼Œä½ å°±å¿…é¡»è¯¥å…ƒç´ è®¾ç½®ä¸ºorg/apache/maven/messagesã€‚ --&gt; &lt;!--ç„¶è€Œï¼Œå¦‚æœä½ åªæ˜¯æƒ³æŠŠèµ„æºæ”¾åˆ°æºç ç›®å½•ç»“æ„é‡Œï¼Œå°±ä¸éœ€è¦è¯¥é…ç½®ã€‚ --&gt; &lt;targetPath&gt;resources&lt;/targetPath&gt; &lt;!--æ˜¯å¦ä½¿ç”¨å‚æ•°å€¼ä»£æ›¿å‚æ•°åã€‚å‚æ•°å€¼å–è‡ªpropertieså…ƒç´ æˆ–è€…æ–‡ä»¶é‡Œé…ç½®çš„å±æ€§ï¼Œæ–‡ä»¶åœ¨filterså…ƒç´ é‡Œåˆ—å‡ºã€‚ --&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;!--æè¿°å­˜æ”¾èµ„æºçš„ç›®å½•ï¼Œè¯¥è·¯å¾„ç›¸å¯¹POMè·¯å¾„ --&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;!--åŒ…å«çš„æ¨¡å¼åˆ—è¡¨ --&gt; &lt;includes&gt; &lt;include&gt;**/*.properties&lt;/include&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;!--æ’é™¤çš„æ¨¡å¼åˆ—è¡¨ å¦‚æœ&lt;include&gt;ä¸&lt;exclude&gt;åˆ’å®šçš„èŒƒå›´å­˜åœ¨å†²çªï¼Œä»¥&lt;exclude&gt;ä¸ºå‡† --&gt; &lt;excludes&gt; &lt;exclude&gt;jdbc.properties&lt;/exclude&gt; &lt;/excludes&gt; &lt;/resource&gt; &lt;/resources&gt; 4.pluginsè¯´æ˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;&lt;/groupId&gt; &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt; &lt;version&gt;2.5.5&lt;/version&gt; &lt;!--åœ¨æ„å»ºç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œä¸€ç»„ç›®æ ‡çš„é…ç½®ã€‚æ¯ä¸ªç›®æ ‡å¯èƒ½æœ‰ä¸åŒçš„é…ç½®ã€‚ --&gt; &lt;executions&gt; &lt;execution&gt; &lt;!--æ‰§è¡Œç›®æ ‡çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºæ ‡è¯†æ„å»ºè¿‡ç¨‹ä¸­çš„ç›®æ ‡ï¼Œæˆ–è€…åŒ¹é…ç»§æ‰¿è¿‡ç¨‹ä¸­éœ€è¦åˆå¹¶çš„æ‰§è¡Œç›®æ ‡ --&gt; &lt;id&gt;assembly&lt;/id&gt; &lt;!--ç»‘å®šäº†ç›®æ ‡çš„æ„å»ºç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼Œå¦‚æœçœç•¥ï¼Œç›®æ ‡ä¼šè¢«ç»‘å®šåˆ°æºæ•°æ®é‡Œé…ç½®çš„é»˜è®¤é˜¶æ®µ --&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;!--é…ç½®çš„æ‰§è¡Œç›®æ ‡ --&gt; &lt;goals&gt; &lt;goal&gt;single&lt;/goal&gt; &lt;/goals&gt; &lt;!--é…ç½®æ˜¯å¦è¢«ä¼ æ’­åˆ°å­POM --&gt; &lt;inherited&gt;false&lt;/inherited&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;!--ä½œä¸ºDOMå¯¹è±¡çš„é…ç½®,é…ç½®é¡¹å› æ’ä»¶è€Œå¼‚ --&gt; &lt;configuration&gt; &lt;finalName&gt;$&#123;finalName&#125;&lt;/finalName&gt; &lt;appendAssemblyId&gt;false&lt;/appendAssemblyId&gt; &lt;descriptor&gt;assembly.xml&lt;/descriptor&gt; &lt;/configuration&gt; &lt;!--æ˜¯å¦ä»è¯¥æ’ä»¶ä¸‹è½½Mavenæ‰©å±•ï¼ˆä¾‹å¦‚æ‰“åŒ…å’Œç±»å‹å¤„ç†å™¨ï¼‰ï¼Œ --&gt; &lt;!--ç”±äºæ€§èƒ½åŸå› ï¼Œåªæœ‰åœ¨çœŸéœ€è¦ä¸‹è½½æ—¶ï¼Œè¯¥å…ƒç´ æ‰è¢«è®¾ç½®æˆtrueã€‚ --&gt; &lt;extensions&gt;false&lt;/extensions&gt; &lt;!--é¡¹ç›®å¼•å…¥æ’ä»¶æ‰€éœ€è¦çš„é¢å¤–ä¾èµ– --&gt; &lt;dependencies&gt; &lt;dependency&gt;...&lt;/dependency&gt; &lt;/dependencies&gt; &lt;!--ä»»ä½•é…ç½®æ˜¯å¦è¢«ä¼ æ’­åˆ°å­é¡¹ç›® --&gt; &lt;inherited&gt;true&lt;/inherited&gt; &lt;/plugin&gt; &lt;/plugins&gt; ä¸‰ã€åå¥½è®¾ç½®profile1.é…ç½®ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374&lt;!--åœ¨åˆ—çš„é¡¹ç›®æ„å»ºprofileï¼Œå¦‚æœè¢«æ¿€æ´»ï¼Œä¼šä¿®æ”¹æ„å»ºå¤„ç† --&gt; &lt;profiles&gt; &lt;!--æ ¹æ®ç¯å¢ƒå‚æ•°æˆ–å‘½ä»¤è¡Œå‚æ•°æ¿€æ´»æŸä¸ªæ„å»ºå¤„ç† --&gt; &lt;profile&gt; &lt;!-- ä¸€èˆ¬æ˜¯ç¯å¢ƒçš„id --&gt; &lt;id /&gt; &lt;build /&gt; &lt;modules /&gt; &lt;repositories /&gt; &lt;pluginRepositories /&gt; &lt;dependencies /&gt; &lt;reporting /&gt; &lt;dependencyManagement /&gt; &lt;distributionManagement /&gt; &lt;!-- ç¯å¢ƒçš„å±æ€§è®¾ç½®,ä¸€èˆ¬å¯ä»¥ç»™ä¸ªå±æ€§å€¼ï¼Œæ¯”å¦‚dev,test,uat,prodï¼Œ ä»è€Œæ¿€å‘æŸä¸ªç¯å¢ƒçš„é…ç½®ï¼Œæ¯”å¦‚ç”¨åœ¨buildçš„resourceä¸­ --&gt; &lt;properties /&gt; &lt;!--è‡ªåŠ¨è§¦å‘profileçš„æ¡ä»¶é€»è¾‘ã€‚Activationæ˜¯profileçš„å¼€å¯é’¥åŒ™ã€‚ --&gt; &lt;activation&gt; &lt;!--profileé»˜è®¤æ˜¯å¦æ¿€æ´»çš„æ ‡è¯† --&gt; &lt;activeByDefault&gt;false&lt;/activeByDefault&gt; &lt;!--activationæœ‰ä¸€ä¸ªå†…å»ºçš„javaç‰ˆæœ¬æ£€æµ‹ï¼Œå¦‚æœæ£€æµ‹åˆ°jdkç‰ˆæœ¬ä¸æœŸå¾…çš„ä¸€æ ·ï¼Œprofileè¢«æ¿€æ´»ã€‚ --&gt; &lt;jdk&gt;1.7&lt;/jdk&gt; &lt;!--å½“åŒ¹é…çš„æ“ä½œç³»ç»Ÿå±æ€§è¢«æ£€æµ‹åˆ°ï¼Œprofileè¢«æ¿€æ´»ã€‚oså…ƒç´ å¯ä»¥å®šä¹‰ä¸€äº›æ“ä½œç³»ç»Ÿç›¸å…³çš„å±æ€§ã€‚ --&gt; &lt;os&gt; &lt;!--æ¿€æ´»profileçš„æ“ä½œç³»ç»Ÿçš„åå­— --&gt; &lt;name&gt;Windows XP&lt;/name&gt; &lt;!--æ¿€æ´»profileçš„æ“ä½œç³»ç»Ÿæ‰€å±å®¶æ—(å¦‚ 'windows') --&gt; &lt;family&gt;Windows&lt;/family&gt; &lt;!--æ¿€æ´»profileçš„æ“ä½œç³»ç»Ÿä½“ç³»ç»“æ„ --&gt; &lt;arch&gt;x86&lt;/arch&gt; &lt;!--æ¿€æ´»profileçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬ --&gt; &lt;version&gt;5.1.2600&lt;/version&gt; &lt;/os&gt; &lt;!--å¦‚æœMavenæ£€æµ‹åˆ°æŸä¸€ä¸ªå±æ€§ï¼ˆå…¶å€¼å¯ä»¥åœ¨POMä¸­é€šè¿‡$&#123;åç§°&#125;å¼•ç”¨ï¼‰ï¼Œå…¶æ‹¥æœ‰å¯¹åº”çš„åç§°å’Œå€¼ï¼ŒProfileå°±ä¼šè¢«æ¿€æ´»ã€‚ --&gt; &lt;!-- å¦‚æœå€¼å­—æ®µæ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå­˜åœ¨å±æ€§åç§°å­—æ®µå°±ä¼šæ¿€æ´»profileï¼Œå¦åˆ™æŒ‰åŒºåˆ†å¤§å°å†™æ–¹å¼åŒ¹é…å±æ€§å€¼å­—æ®µ --&gt; &lt;property&gt; &lt;!--æ¿€æ´»profileçš„å±æ€§çš„åç§° --&gt; &lt;name&gt;mavenVersion&lt;/name&gt; &lt;!--æ¿€æ´»profileçš„å±æ€§çš„å€¼ --&gt; &lt;value&gt;2.0.3&lt;/value&gt; &lt;/property&gt; &lt;!--æä¾›ä¸€ä¸ªæ–‡ä»¶åï¼Œé€šè¿‡æ£€æµ‹è¯¥æ–‡ä»¶çš„å­˜åœ¨æˆ–ä¸å­˜åœ¨æ¥æ¿€æ´»profileã€‚missingæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ¿€æ´»profileã€‚ --&gt; &lt;!--å¦ä¸€æ–¹é¢ï¼Œexistsåˆ™ä¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™æ¿€æ´»profileã€‚ --&gt; &lt;file&gt; &lt;!--å¦‚æœæŒ‡å®šçš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ¿€æ´»profileã€‚ --&gt; &lt;exists&gt;/usr/local/hudson/hudson-home/jobs/maven-guide-zh-to-production/workspace/&lt;/exists&gt; &lt;!--å¦‚æœæŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ¿€æ´»profileã€‚ --&gt; &lt;missing&gt;/usr/local/hudson/hudson-home/jobs/maven-guide-zh-to-production/workspace/&lt;/missing&gt; &lt;/file&gt; &lt;/activation&gt; &lt;/profile&gt; &lt;profiles&gt; pom.xml ç¤ºä¾‹pom.xmlæ˜¯Mavençš„æ ¸å¿ƒï¼Œä½ çš„é¡¹ç›®éœ€è¦ä»€ä¹ˆJaråŒ…å°±åœ¨pom.xmlé‡Œé¢é…ç½®ã€‚å½“ç¼–è¯‘é¡¹ç›®æ—¶Mavenè¯»å–è¯¥æ–‡ä»¶ï¼Œå¹¶ä»ä»“åº“ä¸­ä¸‹è½½ç›¸åº”çš„JaråŒ…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0http://maven.apache.org/maven-v4_0_0.xsd"&gt; &lt;!--çˆ¶é¡¹ç›®çš„åæ ‡ã€‚å¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰è§„å®šæŸä¸ªå…ƒç´ çš„å€¼ï¼Œé‚£ä¹ˆçˆ¶é¡¹ç›®ä¸­çš„å¯¹åº”å€¼å³ä¸ºé¡¹ç›®çš„é»˜è®¤å€¼ã€‚ åæ ‡åŒ…æ‹¬group IDï¼Œartifact IDå’Œ versionã€‚--&gt; &lt;parent&gt; &lt;!--è¢«ç»§æ‰¿çš„çˆ¶é¡¹ç›®çš„æ„ä»¶æ ‡è¯†ç¬¦--&gt; &lt;artifactId/&gt; &lt;!--è¢«ç»§æ‰¿çš„çˆ¶é¡¹ç›®çš„å…¨çƒå”¯ä¸€æ ‡è¯†ç¬¦--&gt; &lt;groupId/&gt; &lt;!--è¢«ç»§æ‰¿çš„çˆ¶é¡¹ç›®çš„ç‰ˆæœ¬--&gt; &lt;version/&gt; &lt;/parent&gt; &lt;!--å£°æ˜é¡¹ç›®æè¿°ç¬¦éµå¾ªå“ªä¸€ä¸ªPOMæ¨¡å‹ç‰ˆæœ¬ã€‚æ¨¡å‹æœ¬èº«çš„ç‰ˆæœ¬å¾ˆå°‘æ”¹å˜ï¼Œè™½ç„¶å¦‚æ­¤ï¼Œä½†å®ƒä»ç„¶æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè¿™æ˜¯ä¸ºäº†å½“Mavenå¼•å…¥äº†æ–°çš„ç‰¹æ€§æˆ–è€…å…¶ä»–æ¨¡å‹å˜æ›´çš„æ—¶å€™ï¼Œç¡®ä¿ç¨³å®šæ€§ã€‚--&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;!--é¡¹ç›®çš„å…¨çƒå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ä½¿ç”¨å…¨é™å®šçš„åŒ…ååŒºåˆ†è¯¥é¡¹ç›®å’Œå…¶ä»–é¡¹ç›®ã€‚å¹¶ä¸”æ„å»ºæ—¶ç”Ÿæˆçš„è·¯å¾„ä¹Ÿæ˜¯ç”±æ­¤ç”Ÿæˆï¼Œ å¦‚com.mycompany.appç”Ÿæˆçš„ç›¸å¯¹è·¯å¾„ä¸ºï¼š/com/mycompany/app--&gt; &lt;groupId&gt;cn.missbe.web&lt;/groupId&gt; &lt;!-- æ„ä»¶çš„æ ‡è¯†ç¬¦ï¼Œå®ƒå’Œgroup IDä¸€èµ·å”¯ä¸€æ ‡è¯†ä¸€ä¸ªæ„ä»¶ã€‚æ¢å¥è¯è¯´ï¼Œä½ ä¸èƒ½æœ‰ä¸¤ä¸ªä¸åŒçš„é¡¹ç›®æ‹¥æœ‰åŒæ ·çš„artifact IDå’ŒgroupIDï¼›åœ¨æŸä¸ª ç‰¹å®šçš„group IDä¸‹ï¼Œartifact IDä¹Ÿå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚æ„ä»¶æ˜¯é¡¹ç›®äº§ç”Ÿçš„æˆ–ä½¿ç”¨çš„ä¸€ä¸ªä¸œè¥¿ï¼ŒMavenä¸ºé¡¹ç›®äº§ç”Ÿçš„æ„ä»¶åŒ…æ‹¬ï¼šJARsï¼Œæºç ï¼ŒäºŒè¿›åˆ¶å‘å¸ƒå’ŒWARsç­‰ã€‚--&gt; &lt;artifactId&gt;search-resources&lt;/artifactId&gt; &lt;!--é¡¹ç›®äº§ç”Ÿçš„æ„ä»¶ç±»å‹ï¼Œä¾‹å¦‚jarã€warã€earã€pomã€‚æ’ä»¶å¯ä»¥åˆ›å»ºä»–ä»¬è‡ªå·±çš„æ„ä»¶ç±»å‹ï¼Œæ‰€ä»¥å‰é¢åˆ—çš„ä¸æ˜¯å…¨éƒ¨æ„ä»¶ç±»å‹--&gt; &lt;packaging&gt;war&lt;/packaging&gt; &lt;!--é¡¹ç›®å½“å‰ç‰ˆæœ¬ï¼Œæ ¼å¼ä¸º:ä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.å¢é‡ç‰ˆæœ¬-é™å®šç‰ˆæœ¬å·--&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;!--é¡¹ç›®çš„åç§°, Mavenäº§ç”Ÿçš„æ–‡æ¡£ç”¨--&gt; &lt;name&gt;search-resources&lt;/name&gt; &lt;!--é¡¹ç›®ä¸»é¡µçš„URL, Mavenäº§ç”Ÿçš„æ–‡æ¡£ç”¨--&gt; &lt;url&gt;http://www.missbe.cn&lt;/url&gt; &lt;!-- é¡¹ç›®çš„è¯¦ç»†æè¿°, Maven äº§ç”Ÿçš„æ–‡æ¡£ç”¨ã€‚ å½“è¿™ä¸ªå…ƒç´ èƒ½å¤Ÿç”¨HTMLæ ¼å¼æè¿°æ—¶ï¼ˆä¾‹å¦‚ï¼ŒCDATAä¸­çš„æ–‡æœ¬ä¼šè¢«è§£æå™¨å¿½ç•¥ï¼Œå°±å¯ä»¥åŒ…å«HTMLæ ‡ ç­¾ï¼‰ï¼Œ ä¸é¼“åŠ±ä½¿ç”¨çº¯æ–‡æœ¬æè¿°ã€‚å¦‚æœä½ éœ€è¦ä¿®æ”¹äº§ç”Ÿçš„webç«™ç‚¹çš„ç´¢å¼•é¡µé¢ï¼Œä½ åº”è¯¥ä¿®æ”¹ä½ è‡ªå·±çš„ç´¢å¼•é¡µæ–‡ä»¶ï¼Œè€Œä¸æ˜¯è°ƒæ•´è¿™é‡Œçš„æ–‡æ¡£ã€‚--&gt; &lt;description&gt;A maven project to study maven.&lt;/description&gt; &lt;!--æè¿°äº†è¿™ä¸ªé¡¹ç›®æ„å»ºç¯å¢ƒä¸­çš„å‰ææ¡ä»¶ã€‚--&gt; &lt;prerequisites&gt; &lt;!--æ„å»ºè¯¥é¡¹ç›®æˆ–ä½¿ç”¨è¯¥æ’ä»¶æ‰€éœ€è¦çš„Mavençš„æœ€ä½ç‰ˆæœ¬--&gt; &lt;maven/&gt; &lt;/prerequisites&gt; &lt;!--æ„å»ºé¡¹ç›®éœ€è¦çš„ä¿¡æ¯--&gt; &lt;build&gt; &lt;!--è¯¥å…ƒç´ è®¾ç½®äº†é¡¹ç›®æºç ç›®å½•ï¼Œå½“æ„å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œæ„å»ºç³»ç»Ÿä¼šç¼–è¯‘ç›®å½•é‡Œçš„æºç ã€‚è¯¥è·¯å¾„æ˜¯ç›¸å¯¹äºpom.xmlçš„ç›¸å¯¹è·¯å¾„ã€‚--&gt; &lt;sourceDirectory/&gt; &lt;!--è¯¥å…ƒç´ è®¾ç½®äº†é¡¹ç›®è„šæœ¬æºç ç›®å½•ï¼Œè¯¥ç›®å½•å’Œæºç ç›®å½•ä¸åŒï¼šç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥ç›®å½•ä¸‹çš„å†…å®¹ ä¼šè¢«æ‹·è´åˆ°è¾“å‡ºç›®å½•(å› ä¸ºè„šæœ¬æ˜¯è¢«è§£é‡Šçš„ï¼Œè€Œä¸æ˜¯è¢«ç¼–è¯‘çš„)ã€‚--&gt; &lt;scriptSourceDirectory/&gt; &lt;!--è¯¥å…ƒç´ è®¾ç½®äº†é¡¹ç›®å•å…ƒæµ‹è¯•ä½¿ç”¨çš„æºç ç›®å½•ï¼Œå½“æµ‹è¯•é¡¹ç›®çš„æ—¶å€™ï¼Œæ„å»ºç³»ç»Ÿä¼šç¼–è¯‘ç›®å½•é‡Œçš„æºç ã€‚è¯¥è·¯å¾„æ˜¯ç›¸å¯¹äºpom.xmlçš„ç›¸å¯¹è·¯å¾„ã€‚--&gt; &lt;testSourceDirectory/&gt; &lt;!--è¢«ç¼–è¯‘è¿‡çš„åº”ç”¨ç¨‹åºclassæ–‡ä»¶å­˜æ”¾çš„ç›®å½•ã€‚--&gt; &lt;outputDirectory/&gt; &lt;!--è¢«ç¼–è¯‘è¿‡çš„æµ‹è¯•classæ–‡ä»¶å­˜æ”¾çš„ç›®å½•ã€‚--&gt; &lt;testOutputDirectory/&gt; &lt;!--ä½¿ç”¨æ¥è‡ªè¯¥é¡¹ç›®çš„ä¸€ç³»åˆ—æ„å»ºæ‰©å±•--&gt; &lt;extensions&gt; &lt;!--æè¿°ä½¿ç”¨åˆ°çš„æ„å»ºæ‰©å±•ã€‚--&gt; &lt;extension&gt; &lt;!--æ„å»ºæ‰©å±•çš„groupId--&gt; &lt;groupId/&gt; &lt;!--æ„å»ºæ‰©å±•çš„artifactId--&gt; &lt;artifactId/&gt; &lt;!--æ„å»ºæ‰©å±•çš„ç‰ˆæœ¬--&gt; &lt;version/&gt; &lt;/extension&gt; &lt;/extensions&gt; &lt;!--è¿™ä¸ªå…ƒç´ æè¿°äº†é¡¹ç›®ç›¸å…³çš„æ‰€æœ‰èµ„æºè·¯å¾„åˆ—è¡¨ï¼Œä¾‹å¦‚å’Œé¡¹ç›®ç›¸å…³çš„å±æ€§æ–‡ä»¶ï¼Œè¿™äº›èµ„æºè¢«åŒ…å«åœ¨æœ€ç»ˆçš„æ‰“åŒ…æ–‡ä»¶é‡Œã€‚--&gt; &lt;resources&gt; &lt;!--è¿™ä¸ªå…ƒç´ æè¿°äº†é¡¹ç›®ç›¸å…³æˆ–æµ‹è¯•ç›¸å…³çš„æ‰€æœ‰èµ„æºè·¯å¾„--&gt; &lt;resource&gt; &lt;!-- æè¿°äº†èµ„æºçš„ç›®æ ‡è·¯å¾„ã€‚è¯¥è·¯å¾„ç›¸å¯¹target/classesç›®å½•ï¼ˆä¾‹å¦‚$&#123;project.build.outputDirectory&#125;ï¼‰ã€‚ä¸¾ä¸ªä¾‹ å­ï¼Œå¦‚æœä½ æƒ³èµ„æºåœ¨ç‰¹å®šçš„åŒ…é‡Œ(org.apache.maven.messages)ï¼Œä½ å°±å¿…é¡»è¯¥å…ƒç´ è®¾ç½®ä¸ºorg/apache/maven /messagesã€‚ç„¶è€Œï¼Œå¦‚æœä½ åªæ˜¯æƒ³æŠŠèµ„æºæ”¾åˆ°æºç ç›®å½•ç»“æ„é‡Œï¼Œå°±ä¸éœ€è¦è¯¥é…ç½®ã€‚--&gt; &lt;targetPath/&gt; &lt;!--æ˜¯å¦ä½¿ç”¨å‚æ•°å€¼ä»£æ›¿å‚æ•°åã€‚å‚æ•°å€¼å–è‡ªpropertieså…ƒç´ æˆ–è€…æ–‡ä»¶é‡Œé…ç½®çš„å±æ€§ï¼Œæ–‡ä»¶åœ¨filterså…ƒç´ é‡Œåˆ—å‡ºã€‚--&gt; &lt;filtering/&gt; &lt;!--æè¿°å­˜æ”¾èµ„æºçš„ç›®å½•ï¼Œè¯¥è·¯å¾„ç›¸å¯¹POMè·¯å¾„--&gt; &lt;directory/&gt; &lt;!--åŒ…å«çš„æ¨¡å¼åˆ—è¡¨ï¼Œä¾‹å¦‚**/*.xml.--&gt; &lt;includes/&gt; &lt;!--æ’é™¤çš„æ¨¡å¼åˆ—è¡¨ï¼Œä¾‹å¦‚**/*.xml--&gt; &lt;excludes/&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;!--è¿™ä¸ªå…ƒç´ æè¿°äº†å•å…ƒæµ‹è¯•ç›¸å…³çš„æ‰€æœ‰èµ„æºè·¯å¾„ï¼Œä¾‹å¦‚å’Œå•å…ƒæµ‹è¯•ç›¸å…³çš„å±æ€§æ–‡ä»¶ã€‚--&gt; &lt;testResources&gt; &lt;!--è¿™ä¸ªå…ƒç´ æè¿°äº†æµ‹è¯•ç›¸å…³çš„æ‰€æœ‰èµ„æºè·¯å¾„ï¼Œå‚è§build/resources/resourceå…ƒç´ çš„è¯´æ˜--&gt; &lt;testResource&gt; &lt;targetPath/&gt;&lt;filtering/&gt;&lt;directory/&gt;&lt;includes/&gt;&lt;excludes/&gt; &lt;/testResource&gt; &lt;/testResources&gt; &lt;!--æ„å»ºäº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶å­˜æ”¾çš„ç›®å½•--&gt; &lt;directory/&gt; &lt;!--äº§ç”Ÿçš„æ„ä»¶çš„æ–‡ä»¶åï¼Œé»˜è®¤å€¼æ˜¯$&#123;artifactId&#125;-$&#123;version&#125;ã€‚--&gt; &lt;finalName/&gt; &lt;!--å½“filteringå¼€å…³æ‰“å¼€æ—¶ï¼Œä½¿ç”¨åˆ°çš„è¿‡æ»¤å™¨å±æ€§æ–‡ä»¶åˆ—è¡¨--&gt; &lt;filters/&gt; &lt;!--å­é¡¹ç›®å¯ä»¥å¼•ç”¨çš„é»˜è®¤æ’ä»¶ä¿¡æ¯ã€‚è¯¥æ’ä»¶é…ç½®é¡¹ç›´åˆ°è¢«å¼•ç”¨æ—¶æ‰ä¼šè¢«è§£ææˆ–ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸã€‚ç»™å®šæ’ä»¶çš„ä»»ä½•æœ¬åœ°é…ç½®éƒ½ä¼šè¦†ç›–è¿™é‡Œçš„é…ç½®--&gt; &lt;pluginManagement&gt; &lt;!--ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨ ã€‚--&gt; &lt;plugins&gt; &lt;!--pluginå…ƒç´ åŒ…å«æè¿°æ’ä»¶æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚--&gt; &lt;plugin&gt; &lt;!--æ’ä»¶åœ¨ä»“åº“é‡Œçš„group ID--&gt; &lt;groupId/&gt; &lt;!--æ’ä»¶åœ¨ä»“åº“é‡Œçš„artifact ID--&gt; &lt;artifactId/&gt; &lt;!--è¢«ä½¿ç”¨çš„æ’ä»¶çš„ç‰ˆæœ¬ï¼ˆæˆ–ç‰ˆæœ¬èŒƒå›´ï¼‰--&gt; &lt;version/&gt; &lt;!--æ˜¯å¦ä»è¯¥æ’ä»¶ä¸‹è½½Mavenæ‰©å±•ï¼ˆä¾‹å¦‚æ‰“åŒ…å’Œç±»å‹å¤„ç†å™¨ï¼‰ï¼Œç”±äºæ€§èƒ½åŸå› ï¼Œåªæœ‰åœ¨çœŸéœ€è¦ä¸‹è½½æ—¶ï¼Œè¯¥å…ƒç´ æ‰è¢«è®¾ç½®æˆenabledã€‚--&gt; &lt;extensions/&gt; &lt;!--åœ¨æ„å»ºç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œä¸€ç»„ç›®æ ‡çš„é…ç½®ã€‚æ¯ä¸ªç›®æ ‡å¯èƒ½æœ‰ä¸åŒçš„é…ç½®ã€‚--&gt; &lt;executions&gt; &lt;!--executionå…ƒç´ åŒ…å«äº†æ’ä»¶æ‰§è¡Œéœ€è¦çš„ä¿¡æ¯--&gt; &lt;execution&gt; &lt;!--æ‰§è¡Œç›®æ ‡çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºæ ‡è¯†æ„å»ºè¿‡ç¨‹ä¸­çš„ç›®æ ‡ï¼Œæˆ–è€…åŒ¹é…ç»§æ‰¿è¿‡ç¨‹ä¸­éœ€è¦åˆå¹¶çš„æ‰§è¡Œç›®æ ‡--&gt; &lt;id/&gt; &lt;!--ç»‘å®šäº†ç›®æ ‡çš„æ„å»ºç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼Œå¦‚æœçœç•¥ï¼Œç›®æ ‡ä¼šè¢«ç»‘å®šåˆ°æºæ•°æ®é‡Œé…ç½®çš„é»˜è®¤é˜¶æ®µ--&gt; &lt;phase/&gt; &lt;!--é…ç½®çš„æ‰§è¡Œç›®æ ‡--&gt; &lt;goals/&gt; &lt;!--é…ç½®æ˜¯å¦è¢«ä¼ æ’­åˆ°å­POM--&gt; &lt;inherited/&gt; &lt;!--ä½œä¸ºDOMå¯¹è±¡çš„é…ç½®--&gt; &lt;configuration/&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;!--é¡¹ç›®å¼•å…¥æ’ä»¶æ‰€éœ€è¦çš„é¢å¤–ä¾èµ–--&gt; &lt;dependencies&gt; &lt;!--å‚è§dependencies/dependencyå…ƒç´ --&gt; &lt;dependency&gt; ...... &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!--ä»»ä½•é…ç½®æ˜¯å¦è¢«ä¼ æ’­åˆ°å­é¡¹ç›®--&gt; &lt;inherited/&gt; &lt;!--ä½œä¸ºDOMå¯¹è±¡çš„é…ç½®--&gt; &lt;configuration/&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/pluginManagement&gt; &lt;!--ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨--&gt; &lt;plugins&gt; &lt;!--å‚è§build/pluginManagement/plugins/pluginå…ƒç´ --&gt; &lt;plugin&gt; &lt;groupId/&gt;&lt;artifactId/&gt;&lt;version/&gt;&lt;extensions/&gt; &lt;executions&gt; &lt;execution&gt; &lt;id/&gt;&lt;phase/&gt;&lt;goals/&gt;&lt;inherited/&gt;&lt;configuration/&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;dependencies&gt; &lt;!--å‚è§dependencies/dependencyå…ƒç´ --&gt; &lt;dependency&gt; ...... &lt;/dependency&gt; &lt;/dependencies&gt; &lt;goals/&gt;&lt;inherited/&gt;&lt;configuration/&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;!--æ¨¡å—ï¼ˆæœ‰æ—¶ç§°ä½œå­é¡¹ç›®ï¼‰ è¢«æ„å»ºæˆé¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚åˆ—å‡ºçš„æ¯ä¸ªæ¨¡å—å…ƒç´ æ˜¯æŒ‡å‘è¯¥æ¨¡å—çš„ç›®å½•çš„ç›¸å¯¹è·¯å¾„--&gt; &lt;modules/&gt; &lt;!--å‘ç°ä¾èµ–å’Œæ‰©å±•çš„è¿œç¨‹ä»“åº“åˆ—è¡¨ã€‚--&gt; &lt;repositories&gt; &lt;!--åŒ…å«éœ€è¦è¿æ¥åˆ°è¿œç¨‹ä»“åº“çš„ä¿¡æ¯--&gt; &lt;repository&gt; &lt;!--å¦‚ä½•å¤„ç†è¿œç¨‹ä»“åº“é‡Œå‘å¸ƒç‰ˆæœ¬çš„ä¸‹è½½--&gt; &lt;releases&gt; &lt;!--trueæˆ–è€…falseè¡¨ç¤ºè¯¥ä»“åº“æ˜¯å¦ä¸ºä¸‹è½½æŸç§ç±»å‹æ„ä»¶ï¼ˆå‘å¸ƒç‰ˆï¼Œå¿«ç…§ç‰ˆï¼‰å¼€å¯ã€‚ --&gt; &lt;enabled/&gt; &lt;!--è¯¥å…ƒç´ æŒ‡å®šæ›´æ–°å‘ç”Ÿçš„é¢‘ç‡ã€‚Mavenä¼šæ¯”è¾ƒæœ¬åœ°POMå’Œè¿œç¨‹POMçš„æ—¶é—´æˆ³ã€‚è¿™é‡Œçš„é€‰é¡¹æ˜¯ï¼šalwaysï¼ˆä¸€ç›´ï¼‰ï¼Œdailyï¼ˆé»˜è®¤ï¼Œæ¯æ—¥ï¼‰ï¼Œintervalï¼šXï¼ˆè¿™é‡ŒXæ˜¯ä»¥åˆ†é’Ÿä¸ºå•ä½çš„æ—¶é—´é—´éš”ï¼‰ï¼Œæˆ–è€…neverï¼ˆä»ä¸ï¼‰ã€‚--&gt; &lt;updatePolicy/&gt; &lt;!--å½“MavenéªŒè¯æ„ä»¶æ ¡éªŒæ–‡ä»¶å¤±è´¥æ—¶è¯¥æ€ä¹ˆåšï¼šignoreï¼ˆå¿½ç•¥ï¼‰ï¼Œfailï¼ˆå¤±è´¥ï¼‰ï¼Œæˆ–è€…warnï¼ˆè­¦å‘Šï¼‰ã€‚--&gt; &lt;checksumPolicy/&gt; &lt;/releases&gt; &lt;!-- å¦‚ä½•å¤„ç†è¿œç¨‹ä»“åº“é‡Œå¿«ç…§ç‰ˆæœ¬çš„ä¸‹è½½ã€‚æœ‰äº†releaseså’Œsnapshotsè¿™ä¸¤ç»„é…ç½®ï¼ŒPOMå°±å¯ä»¥åœ¨æ¯ä¸ªå•ç‹¬çš„ä»“åº“ä¸­ï¼Œä¸ºæ¯ç§ç±»å‹çš„æ„ä»¶é‡‡å–ä¸åŒçš„ ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½æœ‰äººä¼šå†³å®šåªä¸ºå¼€å‘ç›®çš„å¼€å¯å¯¹å¿«ç…§ç‰ˆæœ¬ä¸‹è½½çš„æ”¯æŒã€‚å‚è§repositories/repository/releaseså…ƒç´  --&gt; &lt;snapshots&gt; &lt;enabled/&gt;&lt;updatePolicy/&gt;&lt;checksumPolicy/&gt; &lt;/snapshots&gt; &lt;!--è¿œç¨‹ä»“åº“å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å¯ä»¥ç”¨æ¥åŒ¹é…åœ¨settings.xmlæ–‡ä»¶é‡Œé…ç½®çš„è¿œç¨‹ä»“åº“--&gt; &lt;id&gt;banseon-repository-proxy&lt;/id&gt; &lt;!--è¿œç¨‹ä»“åº“åç§°--&gt; &lt;name&gt;banseon-repository-proxy&lt;/name&gt; &lt;!--è¿œç¨‹ä»“åº“URLï¼ŒæŒ‰protocol://hostname/pathå½¢å¼--&gt; &lt;url&gt;http://192.168.1.169:9999/repository/&lt;/url&gt; &lt;!-- ç”¨äºå®šä½å’Œæ’åºæ„ä»¶çš„ä»“åº“å¸ƒå±€ç±»å‹-å¯ä»¥æ˜¯defaultï¼ˆé»˜è®¤ï¼‰æˆ–è€…legacyï¼ˆé—ç•™ï¼‰ã€‚Maven 2ä¸ºå…¶ä»“åº“æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å¸ƒå±€ï¼›ç„¶ è€Œï¼ŒMaven 1.xæœ‰ä¸€ç§ä¸åŒçš„å¸ƒå±€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥å…ƒç´ æŒ‡å®šå¸ƒå±€æ˜¯defaultï¼ˆé»˜è®¤ï¼‰è¿˜æ˜¯legacyï¼ˆé—ç•™ï¼‰ã€‚--&gt; &lt;layout&gt;default&lt;/layout&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;!--å‘ç°æ’ä»¶çš„è¿œç¨‹ä»“åº“åˆ—è¡¨ï¼Œè¿™äº›æ’ä»¶ç”¨äºæ„å»ºå’ŒæŠ¥è¡¨--&gt; &lt;pluginRepositories&gt; &lt;!--åŒ…å«éœ€è¦è¿æ¥åˆ°è¿œç¨‹æ’ä»¶ä»“åº“çš„ä¿¡æ¯.å‚è§repositories/repositoryå…ƒç´ --&gt; &lt;pluginRepository&gt; ...... &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; &lt;!--è¯¥å…ƒç´ æè¿°äº†é¡¹ç›®ç›¸å…³çš„æ‰€æœ‰ä¾èµ–ã€‚ è¿™äº›ä¾èµ–ç»„æˆäº†é¡¹ç›®æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªä¸ªç¯èŠ‚ã€‚å®ƒä»¬è‡ªåŠ¨ä»é¡¹ç›®å®šä¹‰çš„ä»“åº“ä¸­ä¸‹è½½ã€‚è¦è·å–æ›´å¤šä¿¡æ¯ï¼Œè¯·çœ‹é¡¹ç›®ä¾èµ–æœºåˆ¶ã€‚--&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;!--ä¾èµ–çš„group ID--&gt; &lt;groupId&gt;org.apache.maven&lt;/groupId&gt; &lt;!--ä¾èµ–çš„artifact ID--&gt; &lt;artifactId&gt;maven-artifact&lt;/artifactId&gt; &lt;!--ä¾èµ–çš„ç‰ˆæœ¬å·ã€‚ åœ¨Maven 2é‡Œ, ä¹Ÿå¯ä»¥é…ç½®æˆç‰ˆæœ¬å·çš„èŒƒå›´ã€‚--&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;!-- ä¾èµ–ç±»å‹ï¼Œé»˜è®¤ç±»å‹æ˜¯jarã€‚å®ƒé€šå¸¸è¡¨ç¤ºä¾èµ–çš„æ–‡ä»¶çš„æ‰©å±•åï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–ã€‚ä¸€ä¸ªç±»å‹å¯ä»¥è¢«æ˜ å°„æˆå¦å¤–ä¸€ä¸ªæ‰©å±•åæˆ–åˆ†ç±»å™¨ã€‚ç±»å‹ç»å¸¸å’Œä½¿ç”¨çš„æ‰“åŒ…æ–¹å¼å¯¹åº”ï¼Œ å°½ç®¡è¿™ä¹Ÿæœ‰ä¾‹å¤–ã€‚ä¸€äº›ç±»å‹çš„ä¾‹å­ï¼šjarï¼Œwarï¼Œejb-clientå’Œtest-jarã€‚å¦‚æœè®¾ç½®extensionsä¸º trueï¼Œå°±å¯ä»¥åœ¨ pluginé‡Œå®šä¹‰æ–°çš„ç±»å‹ã€‚æ‰€ä»¥å‰é¢çš„ç±»å‹çš„ä¾‹å­ä¸å®Œæ•´ã€‚--&gt; &lt;type&gt;jar&lt;/type&gt; &lt;!-- ä¾èµ–çš„åˆ†ç±»å™¨ã€‚åˆ†ç±»å™¨å¯ä»¥åŒºåˆ†å±äºåŒä¸€ä¸ªPOMï¼Œä½†ä¸åŒæ„å»ºæ–¹å¼çš„æ„ä»¶ã€‚åˆ†ç±»å™¨åè¢«é™„åŠ åˆ°æ–‡ä»¶åçš„ç‰ˆæœ¬å·åé¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦æ„å»ºä¸¤ä¸ªå•ç‹¬çš„æ„ä»¶æˆ JARï¼Œä¸€ä¸ªä½¿ç”¨Java 1.4ç¼–è¯‘å™¨ï¼Œå¦ä¸€ä¸ªä½¿ç”¨Java 6ç¼–è¯‘å™¨ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨åˆ†ç±»å™¨æ¥ç”Ÿæˆä¸¤ä¸ªå•ç‹¬çš„JARæ„ä»¶ã€‚--&gt; &lt;classifier&gt;&lt;/classifier&gt; &lt;!--ä¾èµ–èŒƒå›´ã€‚åœ¨é¡¹ç›®å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œå¸®åŠ©å†³å®šå“ªäº›æ„ä»¶è¢«åŒ…æ‹¬è¿›æ¥ã€‚æ¬²çŸ¥è¯¦æƒ…è¯·å‚è€ƒä¾èµ–æœºåˆ¶ã€‚ - compile ï¼šé»˜è®¤èŒƒå›´ï¼Œç”¨äºç¼–è¯‘ - providedï¼šç±»ä¼¼äºç¼–è¯‘ï¼Œä½†æ”¯æŒä½ æœŸå¾…jdkæˆ–è€…å®¹å™¨æä¾›ï¼Œç±»ä¼¼äºclasspath - runtime: åœ¨æ‰§è¡Œæ—¶éœ€è¦ä½¿ç”¨ - test: ç”¨äºtestä»»åŠ¡æ—¶ä½¿ç”¨ - system: éœ€è¦å¤–åœ¨æä¾›ç›¸åº”çš„å…ƒç´ ã€‚é€šè¿‡systemPathæ¥å–å¾— - systemPath: ä»…ç”¨äºèŒƒå›´ä¸ºsystemã€‚æä¾›ç›¸åº”çš„è·¯å¾„ - optional: å½“é¡¹ç›®è‡ªèº«è¢«ä¾èµ–æ—¶ï¼Œæ ‡æ³¨ä¾èµ–æ˜¯å¦ä¼ é€’ã€‚ç”¨äºè¿ç»­ä¾èµ–æ—¶ä½¿ç”¨--&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;!--ä»…ä¾›systemèŒƒå›´ä½¿ç”¨ã€‚æ³¨æ„ï¼Œä¸é¼“åŠ±ä½¿ç”¨è¿™ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”åœ¨æ–°çš„ç‰ˆæœ¬ä¸­è¯¥å…ƒç´ å¯èƒ½è¢«è¦†ç›–æ‰ã€‚è¯¥å…ƒç´ ä¸ºä¾èµ–è§„å®šäº†æ–‡ä»¶ç³»ç»Ÿä¸Šçš„è·¯å¾„ã€‚éœ€è¦ç»å¯¹è·¯å¾„è€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„ã€‚æ¨èä½¿ç”¨å±æ€§åŒ¹é…ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚$&#123;java.home&#125;ã€‚--&gt; &lt;systemPath&gt;&lt;/systemPath&gt; &lt;!--å½“è®¡ç®—ä¼ é€’ä¾èµ–æ—¶ï¼Œ ä»ä¾èµ–æ„ä»¶åˆ—è¡¨é‡Œï¼Œåˆ—å‡ºè¢«æ’é™¤çš„ä¾èµ–æ„ä»¶é›†ã€‚å³å‘Šè¯‰mavenä½ åªä¾èµ–æŒ‡å®šçš„é¡¹ç›®ï¼Œä¸ä¾èµ–é¡¹ç›®çš„ä¾èµ–ã€‚æ­¤å…ƒç´ ä¸»è¦ç”¨äºè§£å†³ç‰ˆæœ¬å†²çªé—®é¢˜--&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;!--å¯é€‰ä¾èµ–ï¼Œå¦‚æœä½ åœ¨é¡¹ç›®Bä¸­æŠŠCä¾èµ–å£°æ˜ä¸ºå¯é€‰ï¼Œä½ å°±éœ€è¦åœ¨ä¾èµ–äºBçš„é¡¹ç›®ï¼ˆä¾‹å¦‚é¡¹ç›®Aï¼‰ä¸­æ˜¾å¼çš„å¼•ç”¨å¯¹Cçš„ä¾èµ–ã€‚å¯é€‰ä¾èµ–é˜»æ–­ä¾èµ–çš„ä¼ é€’æ€§ã€‚--&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!-- ç»§æ‰¿è‡ªè¯¥é¡¹ç›®çš„æ‰€æœ‰å­é¡¹ç›®çš„é»˜è®¤ä¾èµ–ä¿¡æ¯ã€‚è¿™éƒ¨åˆ†çš„ä¾èµ–ä¿¡æ¯ä¸ä¼šè¢«ç«‹å³è§£æ,è€Œæ˜¯å½“å­é¡¹ç›®å£°æ˜ä¸€ä¸ªä¾èµ–ï¼ˆå¿…é¡»æè¿°group IDå’Œ artifact IDä¿¡æ¯ï¼‰ï¼Œå¦‚æœgroup IDå’Œartifact IDä»¥å¤–çš„ä¸€äº›ä¿¡æ¯æ²¡æœ‰æè¿°ï¼Œåˆ™é€šè¿‡group IDå’Œartifact ID åŒ¹é…åˆ°è¿™é‡Œçš„ä¾èµ–ï¼Œå¹¶ä½¿ç”¨è¿™é‡Œçš„ä¾èµ–ä¿¡æ¯ã€‚--&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!--å‚è§dependencies/dependencyå…ƒç´ --&gt; &lt;dependency&gt; ...... &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;!--é¡¹ç›®åˆ†å‘ä¿¡æ¯ï¼Œåœ¨æ‰§è¡Œmvn deployåè¡¨ç¤ºè¦å‘å¸ƒçš„ä½ç½®ã€‚æœ‰äº†è¿™äº›ä¿¡æ¯å°±å¯ä»¥æŠŠç½‘ç«™éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨æˆ–è€…æŠŠæ„ä»¶éƒ¨ç½²åˆ°è¿œç¨‹ä»“åº“ã€‚--&gt; &lt;distributionManagement&gt; &lt;!--éƒ¨ç½²é¡¹ç›®äº§ç”Ÿçš„æ„ä»¶åˆ°è¿œç¨‹ä»“åº“éœ€è¦çš„ä¿¡æ¯--&gt; &lt;repository&gt; &lt;!--æ˜¯åˆ†é…ç»™å¿«ç…§ä¸€ä¸ªå”¯ä¸€çš„ç‰ˆæœ¬å·ï¼ˆç”±æ—¶é—´æˆ³å’Œæ„å»ºæµæ°´å·ï¼‰ï¼Ÿè¿˜æ˜¯æ¯æ¬¡éƒ½ä½¿ç”¨ç›¸åŒçš„ç‰ˆæœ¬å·ï¼Ÿå‚è§repositories/repositoryå…ƒç´ --&gt; &lt;uniqueVersion/&gt; &lt;id&gt;banseon-maven2&lt;/id&gt; &lt;name&gt;banseon maven2&lt;/name&gt; &lt;url&gt;file://$&#123;basedir&#125;/target/deploy&lt;/url&gt; &lt;layout/&gt; &lt;/repository&gt; &lt;!--æ„ä»¶çš„å¿«ç…§éƒ¨ç½²åˆ°å“ªé‡Œï¼Ÿå¦‚æœæ²¡æœ‰é…ç½®è¯¥å…ƒç´ ï¼Œé»˜è®¤éƒ¨ç½²åˆ°repositoryå…ƒç´ é…ç½®çš„ä»“åº“ï¼Œå‚è§distributionManagement/repositoryå…ƒç´ --&gt; &lt;snapshotRepository&gt; &lt;uniqueVersion/&gt; &lt;id&gt;banseon-maven2&lt;/id&gt; &lt;name&gt;Banseon-maven2 Snapshot Repository&lt;/name&gt; &lt;url&gt;scp://svn.baidu.com/banseon:/usr/local/maven-snapshot&lt;/url&gt; &lt;layout/&gt; &lt;/snapshotRepository&gt; &lt;!--éƒ¨ç½²é¡¹ç›®çš„ç½‘ç«™éœ€è¦çš„ä¿¡æ¯--&gt; &lt;site&gt; &lt;!--éƒ¨ç½²ä½ç½®çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨æ¥åŒ¹é…ç«™ç‚¹å’Œsettings.xmlæ–‡ä»¶é‡Œçš„é…ç½®--&gt; &lt;id&gt;banseon-site&lt;/id&gt; &lt;!--éƒ¨ç½²ä½ç½®çš„åç§°--&gt; &lt;name&gt;business api website&lt;/name&gt; &lt;!--éƒ¨ç½²ä½ç½®çš„URLï¼ŒæŒ‰protocol://hostname/pathå½¢å¼--&gt; &lt;url&gt; scp://svn.baidu.com/banseon:/var/www/localhost/banseon-web &lt;/url&gt; &lt;/site&gt; &lt;!--é¡¹ç›®ä¸‹è½½é¡µé¢çš„URLã€‚å¦‚æœæ²¡æœ‰è¯¥å…ƒç´ ï¼Œç”¨æˆ·åº”è¯¥å‚è€ƒä¸»é¡µã€‚ä½¿ç”¨è¯¥å…ƒç´ çš„åŸå› æ˜¯ï¼šå¸®åŠ©å®šä½é‚£äº›ä¸åœ¨ä»“åº“é‡Œçš„æ„ä»¶ï¼ˆç”±äºlicenseé™åˆ¶ï¼‰ã€‚--&gt; &lt;downloadUrl/&gt; &lt;!-- ç»™å‡ºè¯¥æ„ä»¶åœ¨è¿œç¨‹ä»“åº“çš„çŠ¶æ€ã€‚ä¸å¾—åœ¨æœ¬åœ°é¡¹ç›®ä¸­è®¾ç½®è¯¥å…ƒç´ ï¼Œå› ä¸ºè¿™æ˜¯å·¥å…·è‡ªåŠ¨æ›´æ–°çš„ã€‚æœ‰æ•ˆçš„å€¼æœ‰ï¼šnoneï¼ˆé»˜è®¤ï¼‰ï¼Œconvertedï¼ˆä»“åº“ç®¡ç†å‘˜ä» Maven 1 POMè½¬æ¢è¿‡æ¥ï¼‰ï¼Œpartnerï¼ˆç›´æ¥ä»ä¼™ä¼´Maven 2ä»“åº“åŒæ­¥è¿‡æ¥ï¼‰ï¼Œdeployedï¼ˆä»Maven 2å®ä¾‹éƒ¨ ç½²ï¼‰ï¼Œverifiedï¼ˆè¢«æ ¸å®æ—¶æ­£ç¡®çš„å’Œæœ€ç»ˆçš„ï¼‰ã€‚--&gt; &lt;status/&gt; &lt;/distributionManagement&gt; &lt;!--ä»¥å€¼æ›¿ä»£åç§°ï¼ŒPropertieså¯ä»¥åœ¨æ•´ä¸ªPOMä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè§¦å‘æ¡ä»¶ï¼ˆè§settings.xmlé…ç½®æ–‡ä»¶é‡Œactivationå…ƒç´ çš„è¯´æ˜ï¼‰ã€‚æ ¼å¼æ˜¯&lt;name&gt;value&lt;/name&gt;ã€‚--&gt; &lt;properties/&gt; &lt;/project&gt;]]></content>
      <categories>
        <category>Java</category>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é‡åŒ–æ‰«ç›²]]></title>
    <url>%2F2019%2F12%2F01%2F13.%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93%2F%E5%8C%BA%E5%9D%97%E9%93%BE%2F%E6%89%AB%E7%9B%B2%2F</url>
    <content type="text"><![CDATA[é‡åŒ–äº¤æ˜“ç”¨æ•°å­¦æ¨¡å‹ï¼Œè€Œä¸æ˜¯äººè„‘ï¼Œå†³å®šäº¤æ˜“çš„å“ç§ã€æ–¹å‘ã€æ—¶æœºã€æ•°é‡ã€‚ æ•°å­¦æ¨¡å‹å¯ä»¥å¤æ‚ï¼Œä¹Ÿå¯ä»¥ç®€å• å¯ä»¥æ˜¯è‡ªåŠ¨äº¤æ˜“ï¼Œä¹Ÿå¯ä»¥ä¸è‡ªåŠ¨äº¤æ˜“ æœ‰ä»·æ ¼æ›²çº¿çš„å“ç§ï¼Œéƒ½èƒ½é‡åŒ–äº¤æ˜“ äº¤æ˜“ç©æ³•ä¼—å¤š äº¤æ˜“æµç¨‹ æ„å»ºç­–ç•¥(æ•°å­¦æ¨¡å‹) å›æµ‹(ç”¨å†å²æ•°æ®å»éªŒè¯ç­–ç•¥çš„æ•ˆæœ) å®ç›˜æµ‹è¯•(ç”¨èµ„é‡‘å»è·‘) å®ç›˜ å¸¸ç”¨ç­–ç•¥ è·¨äº¤æ˜“æ‰€å¸å¸å¥—åˆ©(2017-09ä¹‹å‰) ç¨‹åºè‡ªåŠ¨å¥—åˆ©(2018-05ä¹‹å‰) é«˜é¢‘äº¤æ˜“(èµ„é‡‘å®¹é‡å°, éœ€è¦å®æ—¶ç›¯ç›˜å£æ•°æ®ï¼Œéœ€è¦å¤§é‡ip) é€‰å¸äº¤æ˜“(æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥é€‰æ‹©ä¸Šæ¶¨æœ€é«˜ï¼Œæˆ–è€…ä¸‹è·Œæœ€å°‘çš„å¸ç§) æœŸç°å¥—åˆ©(åˆ©ç”¨æœŸè´§å’Œç°è´§çš„ä»·å·®ï¼Œåšç©ºæœŸè´§ï¼Œå®ç°æ— é£é™©å¥—åˆ©ï¼Œæœºä¼šä¸å®¹æ˜“è·å¾—) è·¨æœŸå¥—åˆ©(è¿‘æœŸåˆçº¦å’Œè¿œæœŸåˆçº¦ä¹‹é—´ä»·å·®çš„å¥—åˆ©) å¤šç©ºè¶‹åŠ¿äº¤æ˜“(CTAç­–ç•¥, ç­–ç•¥åˆ¤æ–­æ¶¨è·Œï¼Œä¹°æ¶¨ä¹°è·Œåˆçº¦)]]></content>
      <categories>
        <category>é‡åŒ–äº¤æ˜“</category>
        <category>åŒºå—é“¾</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>é‡åŒ–äº¤æ˜“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®è°ƒåº¦å¹³å°åå°]]></title>
    <url>%2F2019%2F11%2F30%2F11.Golang%2FGolang%E9%A1%B9%E7%9B%AE%2F%E6%95%B0%E6%8D%AE%E8%B0%83%E5%BA%A6%E5%B9%B3%E5%8F%B0%E5%90%8E%E5%8F%B0%2F</url>
    <content type="text"><![CDATA[æ¬¢è¿æ¥åˆ° data-platform-admindata-platform-admin æ˜¯ä»€ä¹ˆdata-platform-admin æ˜¯data-platormçš„ä¸€ä¸ªåå°é¡¹ç›®ï¼Œç”¨æ¥é…ç½®æ•°æ®æºçš„å¯¹æ¥ï¼Œç¼–å†™æ•°æ®å¤„ç†æ–¹æ³•ç­‰ï¼› å®‰è£…æ–¹æ³•ï¼ˆå•ç‹¬å®‰è£…/å’Œdata-platformä¸€èµ·å®‰è£…ï¼‰ å•ç‹¬å®‰è£… å‰ææ¡ä»¶ï¼šç”¨æœ‰python3çš„è¿è¡Œç¯å¢ƒ 12pip install -r requirements.txt # å®‰è£…ä¾èµ–python manage.py runserver --insecure 8800 # å¯åŠ¨åå°ç¨‹åºï¼Œ è®¿é—®8800ç«¯å£å°±å¯ä»¥è®¿é—®åå°ç³»ç»Ÿ dockerå®‰è£… 1bash deploy.sh start ä½¿ç”¨æ–¹æ³• å¹³å°é¦–é¡µ æ•°æ®æºé…ç½®ç›¸å…³ç•Œé¢ æ•°æ®apié…ç½®é¡µé¢ å˜é‡é…ç½®ç•Œé¢ å¿«é€Ÿä½“éªŒä¸‹é¢ä½“éªŒä¸€ä¸‹å¿«é€Ÿçš„å¯¹æ¥æ•°æ®æºå¹¶æä¾›httpæ¥å£çš„æ­¥éª¤ å…ˆæŒ‰ç…§ä¹‹å‰çš„æ­¥éª¤æ­å»ºå¥½æ•°æ®è°ƒåº¦å¹³å°ï¼Œå¹¶è¿è¡Œdata-platform-adminé¡¹ç›® ç„¶åæˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°æ®åº“é‡Œé¢æœ‰è¿™æ ·ä¸€æ¡æ•°æ®ï¼Œæƒ³è¦é€šè¿‡æ¥å£è®¿é—®çš„æ–¹å¼æ‹¿åˆ° åœ¨æ•°æ®åœ°å€ç®¡ç†ç•Œé¢å…ˆé…ç½®å¥½æ•°æ®æºçš„åœ°å€ä¿¡æ¯(ä»¥mysqlæ•°æ®ä¸ºä¾‹) å¢åŠ æ•°æ®æºï¼Œåœ¨æ•°æ®æºç®¡ç†ç•Œé¢å¢åŠ ä¸€æ¡mysqlæ•°æ®æºä¿¡æ¯ï¼ˆmysqlä¸ºä¾‹ï¼‰ æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥é€šè¿‡httpè¯·æ±‚ï¼Œè¯·æ±‚æ•°æ® 1curl localhost:3000/api/basic -X POST -d 'hello=world' è¿™é‡Œåªæ¼”ç¤ºæ¥å…¥æ•°æ®çš„æœ€åŸºæœ¬æ–¹å¼ï¼Œæƒ³è¦å¯¹æ•°æ®è¿›è¡Œå¤„ç†æˆ–è€…åšå‚æ•°åŠ å·¥ï¼Œè¿”å›ç»“æœåŠ å·¥å’Œå°è£…ï¼Œæ—¥å¿—æ—¥å®šä¹‰ï¼Œç­‰å¯ä»¥å¤šçœ‹ä¸€ä¸‹é¡µé¢æœ‰å“ªäº›ç›¸å…³é…ç½®ï¼Œæˆ–è€…è¯»å–æºç æ¥æ›´æ·±å…¥äº†è§£ è´¡çŒ®ä»£ç  æ‹‰å–ä»£ç  1git clone https://github.com/KyleAdultHub/data-platform-admin.git åˆ›å»ºémaseråˆ†æ”¯ï¼Œæ›´æ”¹ä»£ç åæäº¤è¯·æ±‚]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangé¡¹ç›®</category>
      </categories>
      <tags>
        <tag>æ•°æ®å¹³å°</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®è°ƒåº¦å¹³å°]]></title>
    <url>%2F2019%2F11%2F30%2F11.Golang%2FGolang%E9%A1%B9%E7%9B%AE%2F%E6%95%B0%E6%8D%AE%E8%B0%83%E5%BA%A6%E5%B9%B3%E5%8F%B0%2F</url>
    <content type="text"><![CDATA[æ¬¢è¿æ¥åˆ° data-platformdata-platform æ˜¯ä»€ä¹ˆdata-platform æ˜¯ä¸€ä¸ªå¿«é€Ÿå¯¹æ¥æ•°æ®æº, å¯ä»¥å®ç°è‡ªç”±çš„åŠ å·¥(jsä»£ç )å’Œæ•´åˆæ•°æ®ï¼Œ å¹¶è‡ªåŠ¨æä¾›å°è£…apiçš„ä¸€ä¸ªå¹³å°ï¼Œå¹¶å…·æœ‰ç»“æ„åŒ–çš„logè¾“å‡ºå’Œrestçš„æ¥å£é£æ ¼ï¼› å…¶åˆ†ä¸ºäº”ä¸ªæœåŠ¡: æ•°æ®æºå¯¹æ¥æœåŠ¡(data-source)ï¼Œæ•°æ®æºhttpä»£ç†æœåŠ¡(data-source-api), æ•°æ®apiå°è£…æœåŠ¡(data-api), æ•°æ®å˜é‡åŠ å·¥æœåŠ¡(data-derive), æ•°æ®å¹³å°æ€»ä»£ç†(data-proxy)ï¼› åœ¨ä½¿ç”¨å¹³å°çš„æ—¶å€™å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©éœ€è¦çš„æœåŠ¡, ä¸éœ€è¦æ‰€æœ‰æœåŠ¡éƒ½ä½¿ç”¨; æ•°æ®æ¥å…¥å’Œç¼–å†™åŠ å·¥é€»è¾‘ç­‰, å¯ä»¥é€šè¿‡ data-platform-admin é¡¹ç›®è¿›è¡Œé¡µé¢å¯è§†åŒ–ç¼–è¾‘; æ•°æ®æºå¯¹æ¥æœåŠ¡æ•°æ®æºå¯¹æ¥æœåŠ¡, å¯ä»¥å¿«é€Ÿçš„å®ç°æ•°æ®å¯¹æ¥, å¹¶æä¾›rpcæ¥å£ä¾›è®¿é—® æ”¯æŒæ•°æ®ç§ç±»: mysqlï¼Œ oracleï¼Œredis, couchdbï¼Œ tidbï¼Œmongoï¼Œfileï¼Œhttp æ•°æ®æºhttpä»£ç†æœåŠ¡å¯¹æ•°æ®æºå¯¹æ¥æœåŠ¡å¾—rpcæ¥å£è¿›è¡Œå°è£…ï¼Œè¿›è¡Œåå‘ä»£ç†ï¼Œæä¾›httpæœåŠ¡ä¾›è°ƒç”¨ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©æ˜¯å¦ä½¿ç”¨ æ•°æ®apiå°è£…æœåŠ¡å¯¹æ•°æ®æºæ¥å…¥çš„æ•°æ®è¿”å›è¿›è¡ŒåŠ å·¥ï¼Œè¿”å›åŠ å·¥åçš„ç»“æœï¼Œå¹¶è‡ªåŠ¨æä¾›httpæ¥å£ä¾›è®¿é—®ï¼Œæ”¯æŒå¯¹è®¿é—®å‚æ•°åšåŠ å·¥ï¼Œå¯¹è¿”å›ç»“æœåšåŠ å·¥ï¼Œ å¯¹logè¾“å‡ºç»“æœåšåŠ å·¥ï¼› æ•°æ®å˜é‡åŠ å·¥æœåŠ¡å¯¹æ‰¹é‡çš„æ•°æ®apiå°è£…çš„ç»“æœè¿›è¡Œæ•´åˆï¼Œå¹¶åŠ å·¥å’Œå°è£…ï¼Œå¹¶å¯ä»¥ä»¥å˜é‡å’Œå˜é‡é›†åˆçš„æ–¹å¼ä½œä¸ºæ¥å£è°ƒç”¨çš„è¿”å›ï¼Œæ”¯æŒå¯¹è®¿é—®å‚æ•°åšåŠ å·¥ï¼Œå¯¹è¿”å›ç»“æœåšåŠ å·¥ï¼Œ å¯¹logè¾“å‡ºç»“æœåšåŠ å·¥ï¼Œå¯¹å˜é‡æ•´åˆæˆé›†åˆç­‰ï¼› æ•°æ®å¹³å°æ€»ä»£ç†å¯¹è°ƒç”¨è¿›è¡Œä»£ç†ï¼Œè§„æ•´åŒ–è¯·æ±‚æ–¹æ³•ï¼Œæ¸…æ´—æ¥å£è°ƒç”¨æ–¹å¼ å®‰è£…æ–¹æ³•(æå‰å®‰è£…dockerï¼Œdocker-compose) æ‹‰å–ä»£ç  åˆ¶ä½œäºŒè¿›åˆ¶ç¨‹åº(å¦‚æœå·²ç»å­˜åœ¨å¯ä»¥è·³è¿‡) 123456cd docker-deploggo build -o data-source ../services/main-control/main_data_source_plus.go # ç¼–è¯‘data-sourcego build -o data-source-api ../apis/data-source/api.go # ç¼–è¯‘data-source-apigo build -o data-api ../webs/main-control/main_data_api.go # ç¼–è¯‘data-apigo build -o data-derive ../webs/main-control/main_data_derive.go # ç¼–è¯‘data-derivego build -o data-proxy ../data-proxy/main.go # ç¼–è¯‘data-proxy ä¿®æ”¹é…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶ä½ç½®ï¼š docker-compose/config ç›®å½• ï¼Œ å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªå·±æ›´æ”¹é…ç½®æ–‡ä»¶çš„å†…å®¹ å¯åŠ¨æ•°æ®å¹³å°ä¾èµ– 12bash import-images.shdocker-compose -f docker-compose-db.yml up -d å¯åŠ¨æ•°æ®å¹³å°æœåŠ¡ 1docker-compose -f docker-compose-local.yml up -d ä½¿ç”¨æ–¹æ³• æ•°æ®æºæ¥å…¥ï¼ŒåŠ å·¥æ•°æ®ç­‰æ–¹å¼ æ•°æ®æºæ¥å…¥ï¼ŒåŠ å·¥æ•°æ®ï¼Œå‚æ•°ï¼Œlogæ—¥å¿—ç­‰éƒ½æ˜¯é€šè¿‡é¡µé¢é…ç½®çš„æ–¹å¼è¿›è¡Œï¼Œæ”¹éƒ¨åˆ†å‚è€ƒ data-platform é¡¹ç›® æ•°æ®è°ƒç”¨ æ•°æ®è°ƒç”¨éƒ½æ˜¯é€šè¿‡httpçš„æ–¹å¼è¿›è¡Œï¼Œæš´éœ²çš„æ¥å£é›†åˆå¦‚ä¸‹ æ•°æ®æºç›¸å…³æ¥å£123456789æ•°æ®æºæ‰€éœ€å‚æ•°è·å–æ–¹å¼url: /ds/query/paramsmethod: POSTparams: code æ•°æ®æºä»£ç  æ•°æ®è°ƒç”¨æ–¹å¼url: /ds/query/datamethod: POSTparams: code æ•°æ®æºä»£ç  | data æ•°æ®æºé…ç½®æ‰€éœ€è¦çš„å‚æ•° | cache 0/1 æ˜¯å¦éœ€è¦ç¼“å­˜æ•°æ® æ•°æ®apiå°è£…ç›¸å…³æ¥å£1234567891011121314apiæ‰€éœ€å‚æ•°è·å–æ–¹å¼url: /data-api/data/paramsmethod: POSTparams: code æ•°æ®apiä»£ç apiæ•°æ®è°ƒç”¨æ–¹å¼url: /data-api/data/querymethod: POSTparams: code apiä»£ç  | data apiæ‰€éœ€è¦çš„å‚æ•° | cache 0/1 æ˜¯å¦éœ€è¦ç¼“å­˜æ•°æ®apiæ¥å£éªŒè¯æ–¹å¼url: /data-api/data/verifymethod: POSTparams: code apiä»£ç  æ•°æ®å˜é‡ç›¸å…³æ¥å£ 123456789101112131415161718192021222324å˜é‡æ‰€éœ€å‚æ•°è·å–æ–¹å¼url: /data-derive/data/paramsmethod: POSTparams: code æ•°æ®å˜é‡ä»£ç å˜é‡è°ƒç”¨æ–¹å¼url: /data-derive/data/queryDerivemethod: POSTparams: code å˜é‡ä»£ç  | data å˜é‡é…ç½®æ‰€éœ€è¦çš„å‚æ•° | cache 0/1 æ˜¯å¦éœ€è¦ç¼“å­˜æ•°æ®å˜é‡æ•°æ®æ¥å£éªŒè¯æ–¹å¼url: /data-api/data/verifyDerivemethod: POSTparams: code å˜é‡ä»£ç  å˜é‡é›†è°ƒç”¨æ–¹å¼url: /data-derive/data/queryDeriveSetmethod: POSTparams: code å˜é‡é›†ä»£ç  | data å˜é‡é›†é…ç½®æ‰€éœ€è¦çš„å‚æ•° | cache 0/1 æ˜¯å¦éœ€è¦ç¼“å­˜æ•°æ®å˜é‡é›†æ•°æ®æ¥å£éªŒè¯æ–¹å¼url: /data-api/data/verifyDeriveSetmethod: POSTparams: code å˜é‡é›†ä»£ç  consul æœåŠ¡å–æ¶ˆ1curl --request PUT http://127.0.0.1:8500/v1/agent/service/deregister/&#123;&#125; è´¡çŒ®ä»£ç  æ‹‰å–ä»£ç  1git clone https://github.com/KyleAdultHub/data-platform.git åˆ›å»ºémaseråˆ†æ”¯ï¼Œæ›´æ”¹ä»£ç åæäº¤è¯·æ±‚]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangé¡¹ç›®</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>æ•°æ®å¹³å°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fabric å…±è¯†æœºåˆ¶]]></title>
    <url>%2F2019%2F09%2F11%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2FHyperledger%20fabric%2F7.Fabric%20%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[fabric å…±è¯†æœºåˆ¶ç”±äºfabricæ˜¯åˆ†å¸ƒå¼çš„ç³»ç»Ÿï¼Œå› æ­¤éœ€è¦å…±è¯†æœºåˆ¶æ¥ä¿éšœå„ä¸ªèŠ‚ç‚¹ä»¥ç›¸åŒçš„é¡ºåºçŠ¶æ€ä¿å­˜è´¦æœ¬ï¼Œè¾¾æˆä¸€è‡´æ€§ã€‚ åœ¨å½“å‰fabric1.4ç‰ˆæœ¬ä¸­ï¼Œå­˜åœ¨ä¸‰ç§å…±è¯†æœºåˆ¶ï¼Œåˆ†åˆ«æ˜¯soloï¼Œkafkaï¼Œetcdraftã€‚äº¤æ˜“çš„å…±è¯†åŒ…æ‹¬3ä¸ªé˜¶æ®µçš„å¤„ç†ï¼šæè®®é˜¶æ®µã€æ‰“åŒ…é˜¶æ®µå’ŒéªŒè¯é˜¶æ®µã€‚ 1.Solo å…±è¯†æ¨¡å¼Soloå…±è¯†æ¨¡å¼æŒ‡ç½‘ç»œç¯å¢ƒä¸­åªæœ‰ä¸€ä¸ªæ’åºèŠ‚ç‚¹ï¼Œä»PeerèŠ‚ç‚¹å‘é€æ¥çš„æ¶ˆæ¯ç”±ä¸€ä¸ªæ’åºèŠ‚ç‚¹è¿›è¡Œæ’åºå’Œäº§ç”ŸåŒºå—ï¼›ç”±äºæ’åºæœåŠ¡åªæœ‰ä¸€ä¸ªæ’åºèŠ‚ç‚¹ä¸ºæ‰€æœ‰PeerèŠ‚ç‚¹æœåŠ¡ï¼Œæ²¡æœ‰é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¸é€‚åˆç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œé€šå¸¸ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚ Soloå…±è¯†æ¨¡å¼è°ƒç”¨è¿‡ç¨‹è¯´æ˜ï¼š PeerèŠ‚ç‚¹é€šè¿‡gPRCè¿æ¥æ’åºæœåŠ¡ï¼Œè¿æ¥æˆåŠŸåï¼Œå‘é€äº¤æ˜“ä¿¡æ¯ã€‚ æ’åºæœåŠ¡é€šè¿‡Recvæ¥å£ï¼Œç›‘å¬PeerèŠ‚ç‚¹å‘é€è¿‡æ¥çš„ä¿¡æ¯ï¼Œæ”¶åˆ°ä¿¡æ¯åè¿›è¡Œæ•°æ®åŒºå—å¤„ç†ã€‚ æ’åºæœåŠ¡æ ¹æ®æ”¶åˆ°çš„æ¶ˆæ¯ç”Ÿæˆæ•°æ®åŒºå—ï¼Œå¹¶å°†æ•°æ®åŒºå—å†™å…¥è´¦æœ¬ï¼ˆLedgerï¼‰ä¸­ï¼Œè¿”å›å¤„ç†ä¿¡æ¯ã€‚ PeerèŠ‚ç‚¹é€šè¿‡deliveræ¥å£ï¼Œè·å–æ’åºæœåŠ¡ç”Ÿæˆçš„åŒºå—æ•°æ®ã€‚ 2.Kafka å…±è¯†æ¨¡å¼Hyperledger Fabricçš„æ ¸å¿ƒå…±è¯†ç®—æ³•é€šè¿‡Kafkaé›†ç¾¤å®ç°ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡Kafkaå¯¹æ‰€æœ‰äº¤æ˜“ä¿¡æ¯è¿›è¡Œæ’åºï¼ˆå¦‚æœç³»ç»Ÿå­˜åœ¨å¤šä¸ªchannelï¼Œåˆ™å¯¹æ¯ä¸ªchannelåˆ†åˆ«æ’åºï¼‰ã€‚Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¼ä¿¡æ¯å¤„ç†å¹³å°ï¼Œç›®æ ‡æ˜¯ä¸ºå®æ—¶æ•°æ®æä¾›ç»Ÿä¸€çš„ã€é«˜ååã€ä½å»¶è¿Ÿçš„æ€§èƒ½ã€‚Kafkaç”±ä»¥ä¸‹å‡ ç±»è§’è‰²æ„æˆï¼š Brokerï¼šæ¶ˆæ¯å¤„ç†èŠ‚ç‚¹ï¼Œä¸»è¦ä»»åŠ¡æ˜¯æ¥æ”¶producerså‘é€çš„æ¶ˆæ¯ï¼Œç„¶åå†™å…¥å¯¹åº”çš„topicçš„partitionä¸­ï¼Œå¹¶å°†æ’åºåçš„æ¶ˆæ¯å‘é€ç»™è®¢é˜…è¯¥topicçš„consumersã€‚ å¤§é‡çš„BrokerèŠ‚ç‚¹æé«˜äº†æ•°æ®ååé‡ï¼Œå¹¶äº’ç›¸å¯¹partitionæ•°æ®åšå†—ä½™å¤‡ä»½ï¼ˆç±»ä¼¼RAIDæŠ€æœ¯ï¼‰ã€‚ Zookeeperï¼šä¸ºBrokersæä¾›é›†ç¾¤ç®¡ç†æœåŠ¡å’Œå…±è¯†ç®—æ³•æœåŠ¡ï¼ˆpaxosç®—æ³•ï¼‰ï¼Œä¾‹å¦‚ï¼Œé€‰ä¸¾leaderèŠ‚ç‚¹å¤„ç†æ¶ˆæ¯å¹¶å°†ç»“æœåŒæ­¥ç»™å…¶å®ƒfollowersèŠ‚ç‚¹ï¼Œç§»é™¤æ•…éšœèŠ‚ç‚¹ä»¥åŠåŠ å…¥æ–°èŠ‚ç‚¹å¹¶å°†æœ€æ–°çš„ç½‘ç»œæ‹“æ‰‘å›¾åŒæ­¥å‘é€ç»™æ‰€æœ‰Brokersã€‚ Producerï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨Producer APIå°†æ¶ˆæ¯å‘é€ç»™Brokersã€‚ Consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡Consumer APIè®¢é˜…topicå¹¶æ¥æ”¶å¤„ç†åçš„æ¶ˆæ¯ã€‚ Kafkaå°†æ¶ˆæ¯åˆ†ç±»ä¿å­˜ä¸ºå¤šä¸ªtopicï¼Œæ¯ä¸ªtopicä¸­åŒ…å«å¤šä¸ªpartitionï¼Œæ¶ˆæ¯è¢«è¿ç»­è¿½åŠ å†™å…¥partitionä¸­ï¼Œå½¢æˆç›®å½•å¼çš„ç»“æ„ã€‚ä¸€ä¸ªtopicå¯ä»¥è¢«å¤šä¸ªconsumersè®¢é˜…ã€‚ç®€å•æ¥è¯´ï¼Œpartitionå°±æ˜¯ä¸€ä¸ªFIFOçš„æ¶ˆæ¯ç®¡é“ï¼Œä¸€ç«¯ç”±producerå†™å…¥æ¶ˆæ¯ï¼Œå¦ä¸€ç«¯ç”±consumerå–èµ°æ¶ˆæ¯ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œçš„å–èµ°å¹¶ä¸ä¼šç§»é™¤æ¶ˆæ¯ï¼Œè€Œæ˜¯ç§»åŠ¨consumerçš„ä½ç½®æŒ‡é’ˆï¼‰ã€‚ åœ¨Hyperledger Fabricä¸­çš„Kafkaå®é™…è¿è¡Œé€»è¾‘å¦‚ä¸‹ï¼š å¯¹äºæ¯ä¸€æ¡é“¾ï¼Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„åˆ†åŒº æ¯ä¸ªé“¾å¯¹åº”ä¸€ä¸ªå•ä¸€çš„åˆ†åŒºä¸»é¢˜ æ’åºèŠ‚ç‚¹è´Ÿè´£å°†æ¥è‡ªç‰¹å®šé“¾çš„äº¤æ˜“ï¼ˆé€šè¿‡å¹¿æ’­RPCæ¥æ”¶ï¼‰ä¸­ç»§åˆ°å¯¹åº”çš„åˆ†åŒº æ’åºèŠ‚ç‚¹å¯ä»¥è¯»å–åˆ†åŒºå¹¶è·å¾—åœ¨æ‰€æœ‰æ’åºèŠ‚ç‚¹é—´è¾¾æˆä¸€è‡´çš„æ’åºäº¤æ˜“åˆ—è¡¨ ä¸€ä¸ªé“¾ä¸­çš„äº¤æ˜“æ˜¯å®šæ—¶åˆ†æ‰¹å¤„ç†çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ªæ–°çš„æ‰¹æ¬¡çš„ç¬¬ä¸€ä¸ªäº¤æ˜“è¿›æ¥æ—¶ï¼Œå¼€å§‹è®¡æ—¶ å½“äº¤æ˜“è¾¾åˆ°æœ€å¤§æ•°é‡æ—¶æˆ–è¶…æ—¶åè¿›è¡Œæ‰¹æ¬¡åˆ‡åˆ†ï¼Œç”Ÿæˆæ–°çš„åŒºå— å®šæ—¶äº¤æ˜“æ˜¯å¦ä¸€ä¸ªäº¤æ˜“ï¼Œç”±ä¸Šé¢æè¿°çš„å®šæ—¶å™¨ç”Ÿæˆ æ¯ä¸ªæ’åºèŠ‚ç‚¹ä¸ºæ¯ä¸ªé“¾ç»´æŠ¤ä¸€ä¸ªæœ¬åœ°æ—¥å¿—ï¼Œç”Ÿæˆçš„åŒºå—ä¿å­˜åœ¨æœ¬åœ°è´¦æœ¬ä¸­ äº¤æ˜“åŒºå—é€šè¿‡åˆ†å‘RPCè¿”å›å®¢æˆ·ç«¯ å½“å‘ç”Ÿå´©æºƒæ—¶ï¼Œå¯ä»¥åˆ©ç”¨ä¸åŒçš„æ’åºèŠ‚ç‚¹åˆ†å‘åŒºå—ï¼Œå› ä¸ºæ‰€æœ‰çš„æ’åºèŠ‚ç‚¹éƒ½ç»´æŠ¤æœ‰æœ¬åœ°æ—¥å¿— 3. Etcdraft å…±è¯†æ¨¡å¼Raft æ˜¯ v1.4.1 ä¸­å¼•å…¥çš„ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäº etcd çš„å´©æºƒå®¹é”™ï¼ˆCFTï¼‰æ’åºæœåŠ¡ã€‚Raft éµå¾ª â€œé¢†å¯¼è€…å’Œè¿½éšè€…â€ æ¨¡å‹ï¼Œå…¶ä¸­é¢†å¯¼è€…åœ¨é€šé“ä¸­çš„ordererèŠ‚ç‚¹ä¹‹é—´åŠ¨æ€é€‰å‡ºï¼ˆè¿™ä¸ªèŠ‚ç‚¹é›†åˆç§°ä¸ºâ€œconsenter setâ€ï¼‰ï¼Œè¯¥é¢†å¯¼è€…å°†æ¶ˆæ¯å¤åˆ¶åˆ°è·Ÿéšè€…èŠ‚ç‚¹ã€‚ç”±äºç³»ç»Ÿå¯ä»¥æ‰¿å—èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬é¢†å¯¼èŠ‚ç‚¹ï¼‰çš„ä¸¢å¤±ï¼Œåªè¦å‰©ä¸‹å¤§å¤šæ•°æ’åºèŠ‚ç‚¹ï¼ˆå³æ‰€è°“çš„â€œä»²è£â€ï¼‰ï¼ŒRaftå°±è¢«ç§°ä¸ºâ€œå´©æºƒå®¹é”™â€ï¼ˆCFTï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€ä¸ªé€šé“ä¸­æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå®ƒå¯ä»¥æ‰¿å—ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸¢å¤±ï¼ˆå‰©ä¸‹ä¸¤ä¸ªèŠ‚ç‚¹ï¼‰ã€‚ 3.1 raftç›¸å…³æ¦‚å¿µ æ—¥å¿—æ¡ç›®ï¼šRaftæ’åºæœåŠ¡ä¸­çš„ä¸»è¦å·¥ä½œå•å…ƒæ˜¯â€œæ—¥å¿—æ¡ç›®â€ï¼Œè¿™äº›æ¡ç›®çš„å®Œæ•´åºåˆ—ç§°ä¸ºâ€œæ—¥å¿—â€ã€‚å¦‚æœæˆå‘˜çš„å¤šæ•°ï¼ˆæ³•å®šäººæ•°ï¼Œæ¢è¨€ä¹‹ï¼‰æˆå‘˜åˆ°æ¡ç›®åŠå…¶é¡ºåºè¾¾æˆä¸€è‡´ï¼Œæˆ‘ä»¬è®¤ä¸ºæ—¥å¿—æ˜¯ä¸€è‡´çš„ã€‚ Consenterè®¾ç½®ï¼šæ’åºèŠ‚ç‚¹ä¸»åŠ¨å‚ä¸ç»™å®šä¿¡é“çš„å…±è¯†æœºåˆ¶å¹¶æ¥æ”¶ä¿¡é“çš„å¤åˆ¶æ—¥å¿—ã€‚è¿™å¯ä»¥æ˜¯æ‰€æœ‰å¯ç”¨èŠ‚ç‚¹ï¼ˆåœ¨å•ä¸ªç¾¤é›†ä¸­æˆ–åœ¨å¯¹ç³»ç»Ÿé€šé“æœ‰è´¡çŒ®çš„å¤šä¸ªç¾¤é›†ä¸­ï¼‰ï¼Œæˆ–è€…æ˜¯è¿™äº›èŠ‚ç‚¹çš„å­é›†ã€‚ æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰ï¼šRaftä¸­çš„æ¯ä¸ªæ’åºèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªFSMï¼Œå®ƒä»¬å…±åŒç”¨äºç¡®ä¿å„ä¸ªæ’åºèŠ‚ç‚¹ä¸­çš„æ—¥å¿—åºåˆ—æ˜¯ç¡®å®šæ€§çš„ï¼ˆä»¥ç›¸åŒçš„é¡ºåºç¼–å†™ï¼‰ã€‚ æ³•å®šäººæ•°ï¼šæè¿°éœ€è¦ç¡®è®¤ææ¡ˆçš„æœ€å°‘æ•°é‡çš„åŒæ„è€…ï¼Œä»¥ä¾¿å¯ä»¥æäº¤äº¤æ˜“ã€‚å¯¹äºæ¯ä¸ªconsenteré›†ï¼Œè¿™æ˜¯ å¤§å¤šæ•°èŠ‚ç‚¹ã€‚åœ¨å…·æœ‰äº”ä¸ªèŠ‚ç‚¹çš„ç¾¤é›†ä¸­ï¼Œå¿…é¡»æœ‰ä¸‰ä¸ªèŠ‚ç‚¹æ‰èƒ½å­˜åœ¨ä»²è£ã€‚å¦‚æœç”±äºä»»ä½•åŸå› å¯¼è‡´æ³•å®šæ•°é‡çš„èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œåˆ™ordererå°†æ— æ³•ç”¨äºé€šé“ä¸Šçš„è¯»å–å’Œå†™å…¥æ“ä½œï¼Œå¹¶ä¸”ä¸èƒ½æäº¤æ–°æ—¥å¿—ã€‚ Leaderï¼šLeaderè´Ÿè´£æå–æ–°çš„æ—¥å¿—æ¡ç›®ï¼Œå°†å®ƒä»¬å¤åˆ¶åˆ°è·Ÿéšè€…è®¢è´­èŠ‚ç‚¹ï¼Œä»¥åŠç®¡ç†ä½•æ—¶è®¤ä¸ºæ¡ç›®å·²æäº¤ã€‚è¿™ä¸æ˜¯ç‰¹æ®Šç±»å‹ordereräººã€‚åœ¨æƒ…å†µå†³å®šçš„æƒ…å†µä¸‹ï¼Œè¿™åªæ˜¯ordereråœ¨æŸäº›æ—¶å€™å¯èƒ½æ‹¥æœ‰çš„è§’è‰²ï¼Œè€Œä¸æ˜¯å…¶ä»–è§’è‰²ã€‚ Followerï¼šFollowerä»Leaderé‚£é‡Œæ¥æ”¶æ—¥å¿—å¹¶ç¡®å®šæ€§åœ°å¤åˆ¶å®ƒä»¬ï¼Œç¡®ä¿æ—¥å¿—ä¿æŒä¸€è‡´ã€‚Followerä¹Ÿä¼šæ”¶åˆ°æ¥è‡ªLeaderçš„â€œå¿ƒè·³â€ä¿¡æ¯ã€‚å¦‚æœLeaderåœæ­¢åœ¨å¯é…ç½®çš„æ—¶é—´å†…å‘é€è¿™äº›æ¶ˆæ¯ï¼Œåˆ™è¿½å°†å‘èµ·é€‰ä¸¾ï¼Œå…¶ä¸­ä¸€ä¸ªFollowerå°†è¢«é€‰ä¸ºæ–°Leaderã€‚ 3.2 raftåœ¨äº¤æ˜“ä¸­çš„æµç¨‹æ¯ä¸ªé€šé“éƒ½åœ¨Raftåè®®çš„å•ç‹¬å®ä¾‹ä¸Šè¿è¡Œï¼Œè¿™å…è®¸æ¯ä¸ªå®ä¾‹é€‰æ‹©ä¸åŒçš„leaderã€‚è¿˜å…è®¸é›†ç¾¤ç”±ä¸åŒç»„ç»‡æ§åˆ¶çš„æ’åºèŠ‚ç‚¹ç»„æˆçš„ç”¨ä¾‹ä¸­è¿›ä¸€æ­¥åˆ†æ•£æœåŠ¡ã€‚è™½ç„¶æ‰€æœ‰RaftèŠ‚ç‚¹å¿…é¡»æ˜¯ç³»ç»Ÿé€šé“çš„ä¸€éƒ¨åˆ†ï¼Œä½†å®ƒä»¬ä¸ä¸€å®šå¿…é¡»æ˜¯æ‰€æœ‰åº”ç”¨ç¨‹åºé€šé“çš„ä¸€éƒ¨åˆ†ã€‚é€šé“åˆ›å»ºè€…ï¼ˆå’Œé€šé“ç®¡ç†å‘˜ï¼‰å¯ä»¥é€‰æ‹©å¯ç”¨ordererçš„å­é›†ï¼Œå¹¶æ ¹æ®éœ€è¦æ·»åŠ æˆ–åˆ é™¤ordererï¼ˆä¸€æ¬¡åªèƒ½æ·»åŠ æˆ–åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ã€‚ åœ¨Raftä¸­ï¼Œäº¤æ˜“ï¼ˆææ¡ˆæˆ–é…ç½®æ›´æ–°çš„å½¢å¼ï¼‰ç”±æ¥æ”¶äº¤æ˜“çš„ordererèŠ‚ç‚¹è‡ªåŠ¨è·¯ç”±åˆ°è¯¥ä¿¡é“çš„å½“å‰leaderã€‚è¿™æ„å‘³ç€peerå’Œåº”ç”¨ç¨‹åºä¸éœ€è¦çŸ¥é“leaderæ˜¯è°ã€‚åªæœ‰ordererèŠ‚ç‚¹éœ€è¦çŸ¥é“ã€‚ 3.3 raftèŠ‚ç‚¹é€‰ä¸¾æ—¥å¿—ä¼ è¾“raftèŠ‚ç‚¹å§‹ç»ˆå¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼šfollowerï¼Œcandidateæˆ–leaderã€‚æ‰€æœ‰èŠ‚ç‚¹æœ€åˆéƒ½æ˜¯followerã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œä»–ä»¬å¯ä»¥æ¥å—æ¥è‡ªleaderçš„æ—¥å¿—æ¡ç›®ï¼ˆå¦‚æœå·²ç»å½“é€‰ï¼‰ï¼Œæˆ–è€…ä¸ºleaderæŠ•ç¥¨ã€‚å¦‚æœåœ¨è®¾å®šçš„æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ—¥å¿—æ¡ç›®æˆ–å¿ƒè·³ï¼ˆä¾‹å¦‚ï¼Œäº”ç§’ï¼‰ï¼Œåˆ™èŠ‚ç‚¹ä¼šè‡ªæˆ‘æå‡åˆ°candidateçŠ¶æ€ã€‚åœ¨å€™é€‰çŠ¶æ€ä¸­ï¼ŒèŠ‚ç‚¹è¯·æ±‚æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„æŠ•ç¥¨ã€‚å¦‚æœå€™é€‰äººè·å¾—æ³•å®šæ•°é‡çš„é€‰ç¥¨ï¼Œåˆ™å°†å…¶æå‡ä¸ºleaderã€‚leaderæ¥å—æ–°çš„æ—¥å¿—æ¡ç›®å¹¶å°†å…¶å¤åˆ¶ç»™followerã€‚ è™½ç„¶å¯ä»¥æ— é™æœŸåœ°ä¿ç•™æ‰€æœ‰æ—¥å¿—ï¼Œä½†ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼ŒRaftä½¿ç”¨ä¸€ä¸ªåä¸ºâ€œsnapshottingâ€çš„è¿›ç¨‹ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰å°†åœ¨æ—¥å¿—ä¸­ä¿ç•™å¤šå°‘å­—èŠ‚çš„æ•°æ®ã€‚æ¯ä¸ªå¿«ç…§å°†åŒ…å«ä¸€å®šæ•°é‡çš„å—ï¼‰ã€‚]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>Hyperledger fabric</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç”µå­åˆåŒå’Œç”µå­ç­¾å]]></title>
    <url>%2F2019%2F07%2F30%2F20.%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%2FCA%2F%E7%94%B5%E5%AD%90%E5%90%88%E5%90%8C%E5%92%8C%E7%94%B5%E5%AD%90%E7%AD%BE%E5%90%8D%2F</url>
    <content type="text"><![CDATA[ç”µå­åˆåŒçš„ç®€ä»‹ä»€ä¹ˆæ˜¯ç”µå­åˆåŒç”µå­åˆåŒå®ç°äº†åˆåŒçš„ç­¾çº¦æ–¹å¯ä»¥é€šè¿‡äº’è”ç½‘è¿›è¡Œç­¾è®¢ï¼Œå¹¿æ³›åº”ç”¨äºäº’è”ç½‘é‡‘èã€ç”µå­å•†åŠ¡ã€O2Oç­‰è¡Œä¸šï¼Œæ˜¯äº’è”ç½‘ä¸­ä¸€é¡¹ç›¸å½“é‡è¦çš„åŸºç¡€æ€§æœåŠ¡ï¼Œä¹Ÿæ˜¯ä»äº‹äº’è”ç½‘è¡Œä¸šçš„äº§å“ç»ç†å¿…é¡»ç€é‡ç ”ç©¶å­¦ä¹ çš„é¢†åŸŸã€‚ç”µå­åˆåŒçš„æœ‰æ•ˆæ€§æ¥è‡ªäºç”µå­ç­¾åï¼Œæœ¬ç¯‡æ–‡ç« å°†è¯¦ç»†è§£æç”µå­åˆåŒåŠç”µå­ç­¾åçš„åŸç†ä»¥åŠç”µå­åˆåŒçš„äº§å“è®¾è®¡æ€è·¯ã€‚ ä¾æ®2013å¹´å•†åŠ¡éƒ¨å…¬å¸ƒçš„ã€Šç”µå­åˆåŒåœ¨çº¿è®¢ç«‹æµç¨‹è§„èŒƒã€‹, ç”µå­åˆåŒæ˜¯æŒ‡â€å¹³ç­‰ä¸»ä½“çš„è‡ªç„¶äººã€æ³•äººã€å…¶ä»–ç»„ç»‡ä¹‹é—´ä»¥æ•°æ®ç”µæ–‡ä¸ºè½½ä½“, å¹¶åˆ©ç”¨ç”µå­é€šä¿¡æ‰‹æ®µè®¾ç«‹ã€å˜æ›´ã€ç»ˆæ­¢æ°‘äº‹æƒåˆ©ä¹‰åŠ¡å…³ç³»çš„åè®®â€ã€‚ è€Œæ ¹æ®ã€Šç”µå­ç­¾åæ³•ã€‹çš„è§„å®š, æ•°æ®ç”µæ–‡æ˜¯æŒ‡â€ä»¥ç”µå­ã€å…‰å­¦ã€ç£æˆ–è€…ç±»ä¼¼æ‰‹æ®µç”Ÿæˆã€å‘é€ã€æ¥æ”¶æˆ–è€…å‚¨å­˜çš„ä¿¡æ¯â€ã€‚æ®æ­¤, æˆ‘ä»¬ç†è§£, ç”µå­åˆåŒæ˜¯ä»¥æ•°æ®ç”µæ–‡ä¸ºè½½ä½“, ä»¥ç”µå­é€šä¿¡ä¸ºæ‰‹æ®µçš„åè®®, é€‚ç”¨å…³äºæ•°æ®ç”µæ–‡çš„ç›¸å…³è§„å®šã€‚ ç”µå­åˆåŒçš„å±æ€§æ ¹æ®ã€ŠåˆåŒæ³•ã€‹çš„è§„å®š, å½“äº‹äººè®¢ç«‹åˆåŒ, æœ‰ä¹¦é¢å½¢å¼ã€å£å¤´å½¢å¼å’Œå…¶ä»–å½¢å¼ã€‚æ³•å¾‹ã€è¡Œæ”¿æ³•è§„è§„å®šé‡‡ç”¨ä¹¦é¢å½¢å¼åº”å½“é‡‡ç”¨ä¹¦é¢å½¢å¼ã€‚å½“äº‹äººçº¦å®šé‡‡ç”¨ä¹¦é¢å½¢å¼çš„, åº”å½“é‡‡ç”¨ä¹¦é¢å½¢å¼ã€‚åŒæ—¶, ã€ŠåˆåŒæ³•ã€‹ä¹Ÿè§„å®š, ä¹¦é¢å½¢å¼æ˜¯æŒ‡åˆåŒä¹¦ã€ä¿¡ä»¶å’Œæ•°æ®ç”µæ–‡(åŒ…æ‹¬ç”µæŠ¥ã€ç”µä¼ ã€ä¼ çœŸã€ç”µå­æ•°æ®äº¤æ¢å’Œç”µå­é‚®ä»¶)ç­‰å¯ä»¥æœ‰å½¢åœ°è¡¨ç°æ‰€è½½å†…å®¹çš„å½¢å¼ã€‚æ®æ­¤, ç»“åˆä¸Šè¿°è®ºè¿°, ç”µå­åˆåŒæ—¢ç„¶ä»¥æ•°æ®ç”µæ–‡ä½œä¸ºè½½ä½“, å³èƒ½å¤Ÿä½œä¸ºä¹¦é¢å½¢å¼åˆåŒçš„ä¸€ç§, å¾—åˆ°ã€ŠåˆåŒæ³•ã€‹çš„è®¤å¯ä¸é€‚ç”¨ã€‚ ç”µå­åˆåŒçš„ç”µå­ç­¾åè€ƒè™‘åˆ°ä¸€ä»½æˆç«‹å¹¶ç”Ÿæ•ˆçš„ç”µå­åˆåŒéœ€è¦åˆæ„çš„è¾¾æˆä½œä¸ºå…ˆå†³æ¡ä»¶, åˆç»“åˆç”µå­åˆåŒä¸ä¼ ç»Ÿçº¸è´¨åˆåŒç›¸æ¯”é‡‡ç”¨äº†æ–°çš„ä¿¡æ¯æ‰¿è½½æ–¹å¼, æ‰€ä»¥ç”µå­åˆåŒä½œä¸ºä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç”µæ–‡, é™¤äº†è¦æ»¡è¶³ä¼ ç»ŸåˆåŒæ‰€è¦æ±‚çš„æ³•å¾‹è¦ä»¶å¤–, è¿˜éœ€è¦æ»¡è¶³ã€Šç”µå­ç­¾åæ³•ã€‹ä¸­å…³äºæ•°æ®ç”µæ–‡çš„æ„æ€è¡¨ç¤ºè¾¾æˆæ–¹å¼çš„æ³•å¾‹è¦ä»¶ã€‚ ç”µå­åˆåŒçš„ç»„æˆç»“åˆæ³•å¾‹æ³•è§„, ä¸€ä»½å®Œæ•´çš„æ•°æ®ç”µæ–‡ä¸»è¦åŒ…æ‹¬: æ•°æ®ç”µæ–‡å’Œç”µå­ç­¾åï¼› å…¶ä¸­ç”µå­ç­¾ååˆåŒ…æ‹¬ æ•°å­—è¯ä¹¦ã€å¯ä¿¡æ—¶é—´æˆ³ å’Œ å…¶ä»–ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€åˆ—ç¤ºã€‚ CA è¯ä¹¦æ³•å¾‹æ•ˆç›Š(æœ‰æ•ˆæ€§)ç”µå­ç­¾åæ³•æ¡ä¾‹ç¬¬åä¸€æ¡ï¼š ä¹¦é¢å½¢å¼æ˜¯æŒ‡åˆåŒä¹¦ã€ä¿¡ä»¶å’Œæ•°æ®ç”µæ–‡ï¼ˆåŒ…æ‹¬ç”µæŠ¥ã€ç”µä¼ ã€ä¼ çœŸã€ç”µå­æ•°æ®äº¤æ¢å’Œç”µå­é‚®ä»¶ï¼‰ç­‰å¯ä»¥æœ‰å½¢åœ°è¡¨ç°æ‰€è½½å†…å®¹çš„å½¢å¼ã€‚ è¯¥æ¡ä¾‹ç¡®å®šäº†ç”µå­åˆåŒå±äºä¹¦é¢åˆåŒçš„ä¸€ç§ï¼Œå¾—åˆ°äº†åˆåŒæ³•çš„ä»»ä½•å’Œé€‚ç”¨ï¼› ç¬¬åä¸‰æ¡: ç”µå­ç­¾ååˆ¶ä½œæ•°æ®ç”¨äºç”µå­ç­¾åæ—¶ï¼Œå±äºç”µå­ç­¾åäººä¸“æœ‰ï¼› ç­¾ç½²æ—¶ç”µå­ç­¾ååˆ¶ä½œæ•°æ®ä»…ç”±ç”µå­ç­¾åäººæ§åˆ¶ï¼› ç­¾ç½²åå¯¹ç”µå­ç­¾åçš„ä»»ä½•æ”¹åŠ¨èƒ½å¤Ÿè¢«å‘ç°ï¼› ç­¾ç½²åå¯¹æ•°æ®ç”µæ–‡å†…å®¹å’Œå½¢å¼çš„ä»»ä½•æ”¹åŠ¨èƒ½å¤Ÿè¢«å‘ç°ã€‚ è¯¥æ¡ä¾‹è§„ä¸ä»…è®¤å¯äº†å¯é ç”µå­ç­¾åï¼ˆç”µå­ç­¾ç« ï¼‰çš„æ³•å¾‹æ•ˆåŠ›ï¼ŒåŒæ—¶ä¹Ÿå¯¹å¯é ç”µå­ç­¾åï¼ˆç”µå­ç­¾ç« ï¼‰åšå‡ºäº†è¦æ±‚ï¼šé”å®šç­¾çº¦ä¸»ä½“çœŸå®èº«ä»½ã€æœ‰æ•ˆé˜²æ­¢æ–‡ä»¶ç¯¡æ”¹ã€ç²¾ç¡®è®°å½•ç­¾çº¦æ—¶é—´ã€‚ ç¬¬åå››æ¡: å¯é çš„ç”µå­ç­¾åä¸æ‰‹å†™ç­¾åæˆ–è€…ç›–ç« å…·æœ‰åŒç­‰çš„æ³•å¾‹æ•ˆåŠ› â€œå¯é çš„ç”µå­ç­¾åâ€: å°±æ˜¯é‡‡ç”¨åˆæ³•CAç­¾å‘çš„æ•°å­—è¯ä¹¦ç­¾ç½²äº§ç”Ÿçš„æ•°å­—ç­¾å ç¬¬åå…­æ¡: ç”µå­ç­¾åæ³•ç¬¬åå…­æ¡: ç”µå­ç­¾åéœ€è¦æœ‰ç¬¬ä¸‰æ–¹è®¤è¯çš„ï¼Œç”±ä¾æ³•è®¾ç«‹çš„ç”µå­è®¤è¯æœåŠ¡æä¾›è€…æä¾›è®¤è¯æœåŠ¡ã€‚ è¯¥æ¡ä¾‹è§„å®šäº†ç”µå­ç­¾åçš„è®¤è¯æ¥æº æ€»ç»“: ç”µå­ç­¾åæ˜¯ç”±ä¾æ³•è®¾ç«‹çš„ç”µå­è®¤è¯æœåŠ¡æä¾›è€…æä¾›çš„æ³•å¾‹è®¤å¯çš„ä¸€ç§ä¹¦é¢å½¢å¼çš„åˆåŒï¼› å¹¶ä¸”æœ‰æ•ˆçš„ç”µå­åˆåŒéœ€è¦æ»¡è¶³ç”µå­ç­¾åæ³•ç¬¬åä¸‰æ¡ä»¥ä¸‹å››ä¸ªå±æ€§, ç®€ç§°ä¸º: â€œçœŸå®èº«ä»½ã€çœŸå®æ„æ„¿ã€ç­¾åæœªæ”¹ã€åŸæ–‡æœªæ”¹â€œ åˆæ³•çš„ç¬¬ä¸‰å‘CAæœºæ„å…·æœ‰æ³•å¾‹æ•ˆç›Šçš„å›½å®¶CAæœºæ„æœ‰å¤§çº¦37å®¶å·¦å³ï¼Œä»»ä½•ä¸€å®¶éƒ½å¯ä»¥ä½œä¸ºç”µå­åˆåŒçš„ç¬¬ä¸‰æ–¹è®¤è¯æœºæ„ï¼› æ¯”è¾ƒå¸¸ç”¨çš„CAæœºæ„æœ‰: æ²ƒé€šCAã€CFCA ç­‰ã€‚ã€‚ã€‚ ç”µå­ç­¾åæŠ€æœ¯åŸç†(ç¡®ä¿æœ‰æ•ˆæ€§)ç”µå­ç­¾åæ»¡è¶³ç”µå­ç­¾åæ³•ç¬¬åå››æ¡çš„è§„å®šï¼Œéœ€è¦æ»¡è¶³å››ä¸ªå±æ€§ï¼Œç®€ç§°ä¸ºâ€œèº«ä»½çœŸå®ã€çœŸå®æ„æ„¿ã€ç­¾åæœªæ”¹ã€åŸæ–‡æœªæ”¹â€ï¼Œæ˜¯è¿›è¡Œäº§å“è®¾è®¡æ—¶è¦è€ƒè™‘çš„é¦–è¦å› ç´ ã€‚ è¿™äº›å±æ€§ï¼Œç”µå­ç­¾åè®¤è¯æä¾›å•†éœ€è¦å……åˆ†è€ƒè™‘ï¼Œ åªæœ‰æ»¡è¶³äº†è¿™äº›å±æ€§ï¼Œæ‰èƒ½ç¡®ä¿ç”µå­ç­¾åå…·æœ‰ä¸€å®šçš„æœ‰æ•ˆæ€§ï¼› 1. çœŸå®èº«ä»½å¯¹ç­¾çº¦æ–¹çœŸå®èº«ä»½çš„ç¡®å®šï¼Œæ˜¯é€šè¿‡å„ç§å®åè®¤è¯æ–¹å¼æ¥è¿›è¡Œä¿è¯ï¼Œæ‰€ä»¥å®åè®¤è¯æ˜¯ç”µå­åˆåŒäº§å“è®¾è®¡ä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯ã€‚å®åè®¤è¯åŠŸèƒ½å¯ä»¥ç”±ç”µå­åˆåŒæœåŠ¡æä¾›å•†æä¾›ï¼Œä¹Ÿå¯ä»¥ç”±å…¶ä»–ç¬¬ä¸‰æ–¹ç¬¦åˆè¦æ±‚çš„æœåŠ¡å•†æä¾›ã€‚ å®åè®¤è¯åˆ†ä¸ºå¤šç§æ–¹å¼ï¼Œå¯é æ€§å’Œç”¨æˆ·ä½“éªŒå„æœ‰ä¸åŒï¼Œè¦æ ¹æ®äº§å“éœ€æ±‚çµæ´»é€‰ç”¨ã€‚ 2. çœŸå®æ„æ„¿æ„æ„¿è®¤è¯æ˜¯æŒ‡åœ¨æ¯ä¸€æ¬¡ç­¾ç½²å‰å¯¹ç”¨æˆ·çš„èº«ä»½è¿›è¡Œç¡®è®¤ï¼Œä¿è¯æ˜¯ç”¨æˆ·æœ¬äººæ“ä½œçš„è®¤è¯æ–¹å¼ã€‚æˆ‘ä»¬å¸¸è§çš„ç”¨æˆ·å¯†ç ç™»å½•å…¶å®å°±æ˜¯ä¸€ç§æ„æ„¿è®¤è¯ï¼Œä½†ç”±äºç›®å‰ç™»å½•å¯†ç ä¸¢å¤±ã€è¢«ç›—å–ã€è¢«ç ´è§£çš„é£é™©å¾ˆé«˜ï¼Œæ‰€ä»¥å¯¹äºæ¶‰åŠé‡‘é¢è¾ƒå¤§å’Œè¾ƒé‡è¦çš„ç”µå­åˆåŒï¼Œäº§å“è®¾è®¡ä¸­è¦è€ƒè™‘åŠ å…¥å…¶ä»–æ„æ„¿è®¤è¯æ–¹å¼è¿›è¡Œå¯é æ€§å¼ºåŒ–ã€‚ å¸¸è§çš„æ„æ„¿è®¤è¯æ–¹å¼æœ‰ï¼šæŒ‡çº¹ç™»å…¥ã€çŸ­ä¿¡éªŒè¯ç ç™»å…¥ã€è¯­éŸ³éªŒè¯ç ç™»å…¥ã€äººè„¸è¯†åˆ«ç™»å…¥ã€UKEYç™»å…¥ç­‰ã€‚å„ç§æ„æ„¿è®¤è¯æ–¹å¼åŒæ ·å¯é æ€§å’Œç”¨æˆ·ä½“éªŒå„æœ‰ä¸åŒï¼Œæ ¹æ®ä¸åŒäº§å“è¦æ±‚å¯ä»¥è¿›è¡Œé€‰ç”¨ã€‚ æ¯”å¦‚åœ¨æ¯”ç‰¹å¸ç½‘ç»œä¸­ï¼Œç”¨æˆ·å¦‚æœæƒ³è¦è¿›è¡Œäº¤æ˜“ï¼Œåˆ™å¿…é¡»ç”¨ä¿å­˜åœ¨æœ¬åœ°çš„ç§é’¥è¿›è¡Œç­¾åæ‰èƒ½è¿›è¡Œäº¤æ˜“ï¼Œå› æ­¤ä¹Ÿç¡®ä¿äº†çœŸæ˜¯æ„æ„¿æ€§ï¼› 3. ç­¾åæœªæ”¹åŠåŸæ–‡æœªæ”¹ç­¾åæœªæ”¹åŠåŸæ–‡æœªæ”¹æ˜¯é€šè¿‡æ•°å­—ç­¾åæŠ€æœ¯+æ—¶é—´æˆ³+CAæœºæ„é¢å‘çš„æ•°å­—è¯ä¹¦ä¸€èµ·ä¿è¯å’Œå®ç°çš„ï¼Œæ•°å­—ç­¾åæŠ€æœ¯æ˜¯å…¶ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ—¶é—´æˆ³å’Œæ•°å­—è¯ä¹¦çš„å®ç°æ–¹å¼éƒ½ä½¿ç”¨åˆ°æ•°å­—ç­¾åã€‚ å¯¹äºæ•°å­—ç­¾åå’Œéå¯¹ç§°ç®—æ³•ç­‰å†…å®¹ï¼Œå¯ä»¥å‚è€ƒåŒºå—é“¾éƒ¨åˆ†çš„å¯†ç å­¦æ–‡ç« ï¼› ä¸‹é¢ä»‹ç»ä¸€ä¸‹æ•°å­—ç­¾ååœ¨ç”µå­ç­¾åä¸­çš„åº”ç”¨: å‡è®¾ä¸€ä¸ªç”¨æˆ·Aæ‰§è¡Œäº†ç”µå­åˆåŒç­¾çº¦ï¼Œåˆ™æœåŠ¡ç«¯å…ˆå¯¹ç”µå­åˆåŒåŸæ–‡è¿›è¡Œå“ˆå¸Œç®—æ³•ï¼Œå¾—åˆ°ç”µå­åˆåŒåŸæ–‡çš„å“ˆå¸Œå€¼ã€‚ç„¶åä½¿ç”¨ç”¨æˆ·Açš„ç§é’¥å¯¹å“ˆå¸Œå€¼è¿›è¡ŒåŠ å¯†ï¼ŒæŠŠåŠ å¯†å¾—åˆ°çš„æ•°å­—ç­¾åè¿åŒç”µå­åˆåŒä¸€èµ·å‘é€å‡ºå»ã€‚ ç”¨æˆ·Bæ”¶åˆ°å¸¦æ•°å­—ç­¾åçš„ç”µå­åˆåŒåï¼Œå…ˆå¯¹åŸæ–‡ç”¨å“ˆå¸Œç®—æ³•å¾—åˆ°å“ˆå¸Œå€¼ï¼Œç„¶åä½¿ç”¨ç”¨æˆ·Açš„å…¬é’¥å¯¹æ•°å­—ç­¾åè¿›è¡Œè§£å¯†ï¼ˆå¯¹äºç”¨æˆ·Açš„å…¬é’¥å¯ä¿¡åº¦æ˜¯ç”±CAæœºæ„çš„æ•°å­—è¯ä¹¦æ¥ä¿è¯ï¼Œåªè¦æ˜¯å›½å®¶è®¤è¯çš„CAæœºæ„é¢å‘çš„æ•°å­—è¯ä¹¦éƒ½è®¤ä¸ºæ˜¯å¯ä¿¡çš„ï¼Œåœ¨æ­¤ä¸å±•å¼€è®²è§£ï¼‰ï¼Œè§£å¯†å¾—åˆ°çš„å“ˆå¸Œå€¼ä¸åŸæ–‡ç”¨å“ˆå¸Œç®—æ³•å¾—åˆ°å“ˆå¸Œå€¼è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœå“ˆå¸Œå€¼ä¸€è‡´ï¼Œåˆ™è¯æ˜ç”µå­åˆåŒç¡®å®æ˜¯Aæ‰€ç­¾ç½²çš„ï¼Œå¹¶ä¸”æ²¡æœ‰è¢«çº‚æ”¹è¿‡ï¼Œä¹Ÿå°±è¾¾åˆ°éªŒè¯â€œç­¾åæœªæ”¹ã€åŸæ–‡æœªæ”¹â€çš„ç›®çš„ã€‚ æ—¶é—´æˆ³åœ¨ç”µå­åˆåŒä¸­çš„åº”ç”¨ï¼š ç­¾è®¢æ—¶é—´åŒæ ·æ˜¯ç”µå­ç­¾åæˆç«‹å’Œæœ‰æ•ˆæ€§å…³é”®ç¯èŠ‚ï¼Œç”µå­ç­¾åä¸€èˆ¬ä½¿ç”¨æ—¶é—´æˆ³æŠ€æœ¯æ¥å¯¹ç”µå­åˆåŒçš„ç­¾è®¢æ—¶é—´è¿›è¡Œæœ‰æ•ˆç¡®è®¤ã€‚åŸç†æ˜¯å¯¹ç”µå­åˆåŒè¿›è¡Œä¸€æ¬¡å“ˆå¸Œè¿ç®—ï¼Œå°†å“ˆå¸Œå€¼å‘é€ç»™æ—¶é—´æˆ³ç­¾å‘ä¸­å¿ƒï¼Œæ—¶é—´æˆ³ç­¾å‘ä¸­å¿ƒä½¿ç”¨æ•°å­—ç­¾åæŠ€æœ¯å¯¹å“ˆå¸Œå€¼å’Œå½“å‰æ—¶é—´è¿›è¡Œä¸€æ¬¡æ•°å­—ç­¾åã€‚ ç”±äºå¯¹äºç”µå­åˆåŒå“ˆå¸Œå€¼å…·æœ‰å”¯ä¸€æ€§ï¼Œæ‰€ä»¥æ—¶é—´æˆ³çš„æ•°å­—ç­¾åå¯ä»¥ç¡®è®¤ç”µå­åˆåŒç­¾çº¦çš„æ—¶é—´ç‚¹ï¼Œè¿™æ ·å°±ä¿è¯äº†â€œç­¾åæœªæ”¹â€çš„å®ç°ã€‚ å¦‚ä½•æ¥å…¥ç¬¬ä¸‰æ–¹CAæœºæ„(CFCAå®‰å¿ƒç­¾ + ä¾›åº”é“¾é‡‘è ä¸ºä¾‹)CFCAçš„è¯æ®ä¿å…¨ä¸å¸æ³•æœåŠ¡CFCAä¸ºè¯æ®é‡‡é›†ã€è¯æ®å‡†å¤‡åŠè¯æ®å—ç†æä¾›å…¨æµç¨‹æœåŠ¡ã€‚ åœ¨è¯æ®é‡‡é›†é˜¶æ®µï¼Œç”µå­è¯æ®ä¿å…¨ç³»ç»Ÿé€šè¿‡é‡‡é›†å®¢æˆ·ä¸šåŠ¡æ´»åŠ¨è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ç”µå­æ•°æ®ï¼Œè¿›è¡Œä¿å…¨ï¼Œå½¢æˆç”µå­è¯æ®ï¼Œå¹¶å‡ºå…·è¯æ®ä¿å…¨æŠ¥å‘Šã€‚ åœ¨è¯æ®å‡†å¤‡é˜¶æ®µï¼Œé€šè¿‡æ•°å­—ç­¾åéªŒè¯å¹³å°ä¸ºå®¢æˆ·ä¸šåŠ¡æ´»åŠ¨ä¸­ä½¿ç”¨çš„æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯ï¼Œå¹¶å‡ºå…·æ•°å­—ç­¾åéªŒè¯æŠ¥å‘Šã€‚ åœ¨è¯æ®å—ç†é˜¶æ®µï¼Œå¸æ³•æœºå…³é€šè¿‡æ³•å¾‹æœåŠ¡å¹³å°å¯¹æ•°å­—ç­¾åéªŒè¯æŠ¥å‘Šå’Œè¯æ®ä¿å…¨æŠ¥å‘Šç­‰ç”µå­è¯æ®è¿›è¡Œä¸“ä¸šåŒ–åœ¨çº¿éªŒè¯ã€‚ CFCA å¯¹ä¾›åº”é“¾é‡‘èçš„è§£å†³æ–¹æ³•ä¸šåŠ¡æ¦‚è¿° éšç€ç¤¾ä¼šåŒ–ç”Ÿäº§æ–¹å¼çš„ä¸æ–­æ·±å…¥ï¼Œå¸‚åœºç«äº‰å·²ç»ä»å•ä¸€å®¢æˆ·ä¹‹é—´çš„ç«äº‰è½¬å˜ä¸ºä¾›åº”é“¾ä¸ä¾›åº”é“¾ä¹‹é—´çš„ç«äº‰ï¼ŒåŒä¸€ä¾›åº”é“¾å†…éƒ¨å„æ–¹ç›¸äº’ä¾å­˜ï¼ŒåŒæ—¶èµŠé”€å·²æˆä¸ºäº¤æ˜“çš„ä¸»æµæ–¹å¼ï¼Œå¤„äºä¾›åº”é“¾ä¸­ä¸Šæ¸¸çš„ä¾›åº”å•†ï¼Œå¾ˆéš¾é€šè¿‡ä¼ ç»Ÿçš„ä¿¡è´·æ–¹å¼è·å¾—é“¶è¡Œçš„èµ„é‡‘æ”¯æŒï¼Œè€Œèµ„é‡‘çŸ­ç¼ºåˆä¼šç›´æ¥å¯¼è‡´åç»­ç¯èŠ‚çš„åœæ»ã€‚ 2011å¹´ä»¥æ¥ï¼Œå„å®¶å•†ä¸šé“¶è¡Œå—åˆ°ä¿¡è´·è§„æ¨¡çš„é™åˆ¶ï¼Œå¯ä»¥å‘æ”¾çš„è´·æ¬¾é¢åº¦ååˆ†æœ‰é™ï¼Œä½†æ˜¯é€šè¿‡æ‰¿å…‘ã€ç¥¨æ®ã€ä¿¡ç”¨è¯ç­‰å»¶æœŸæ”¯ä»˜å·¥å…·ï¼Œæ—¢èƒ½å¤Ÿå¢å¼ºä¼ä¸šä¹‹é—´çš„äº’ç›¸ä¿¡ä»»ï¼Œä¹Ÿç¨³å®šäº†ä¸€æ‰¹å®¢æˆ·ï¼Œé“¶è¡Œä¸šç©ºå‰é‡è§†ä¾›åº”é“¾é‡‘èä¸šåŠ¡ã€‚é¢å¯¹å›½å†…äº’è”ç½‘é‡‘èçš„é£é€Ÿå‘å±•ï¼Œä¼ ç»Ÿçº¿ä¸‹çš„ä¾›åº”é“¾é‡‘èæ¨¡å¼å·²ç»å¾ˆéš¾æ»¡è¶³ä¼ä¸šå®¢æˆ·å¯¹äºé«˜æ•ˆã€ä¾¿æ·ã€ä¸å—æ—¶ç©ºé™åˆ¶çš„éœ€æ±‚ï¼Œåˆ©ç”¨çº¿ä¸Šä¾›åº”é“¾é‡‘èå¹³å°å®ç°çº¿ä¸Šä¸šåŠ¡åŠç†å·²æ˜¯è¶‹åŠ¿ã€‚ ä¼ ç»Ÿä¾›åº”é“¾é‡‘èé‡‡ç”¨ç°åœºé¢ç­¾çš„æ–¹å¼ï¼Œè€Œé‡‡ç”¨äº’è”ç½‘æ¨¡å¼çš„ä¾›åº”é“¾é‡‘èé¢ä¸´çš„æœ€å¤§çš„æŒ‘æˆ˜è¿˜æ˜¯æ³•å¾‹é£é™©ã€äº¤æ˜“é£é™©ã€æŠ€æœ¯é£é™©ï¼Œå¼•å…¥CFCAæ•°å­—è¯ä¹¦ä½“ç³»å¯ä»¥æœ‰æ•ˆçš„è§£å†³ä¸Šè¿°é£é™©ã€‚ å¹³å°ä»·å€¼â€‹ è§£å†³æ–¹æ¡ˆâ€‹ æ€»ä½“æ¶æ„ Â·å‚ä¸å„æ–¹ï¼ˆèèµ„ä¼ä¸šã€æ ¸å¿ƒä¼ä¸šã€å•†ä¸šé“¶è¡Œï¼‰è·å¾—ç”±ä¾›åº”é“¾é‡‘èå¹³å°å‘æ”¾çš„æ•°å­—è¯ä¹¦ï¼Œç™»å½•å¹³å°ã€ç­¾ç½²ç”µå­åˆåŒæ—¶ä½¿ç”¨è¯ä¹¦åšèº«ä»½éªŒè¯å’Œç”µå­ç­¾åï¼› Â·ä¾›åº”é“¾é‡‘èå¹³å°è°ƒç”¨RAç³»ç»Ÿå®ç°è¯ä¹¦ç®¡ç†åŠŸèƒ½ï¼Œè°ƒç”¨ç­¾åéªŒç­¾æœåŠ¡å™¨å®ç°ç­¾åéªŒç­¾çš„åŠŸèƒ½ï¼ŒRAç³»ç»Ÿè¿æ¥CFCAçš„CAç³»ç»Ÿå®Œæˆè¯ä¹¦ç­¾å‘å’Œç®¡ç†ã€‚ ä¸šåŠ¡æµç¨‹â€‹ æ–¹æ¡ˆç‰¹ç‚¹ç”¨æˆ·çœŸå®èº«ä»½ çº¿ä¸‹é¢å¯¹é¢å¹¶ä½¿ç”¨çº¸è´¨è¯ä»¶ä»£è¡¨å‚ä¸å„æ–¹çš„èº«ä»½ï¼Œçº¿ä¸Šä½¿ç”¨æ•°å­—è¯ä¹¦å®ç°é«˜å¼ºåº¦çš„èº«ä»½è®¤è¯ï¼Œå¹¶è§£å†³ç”¨æˆ·èº«ä»½çœŸå®æ€§éªŒè¯é—®é¢˜ï¼Œé˜²æ­¢å‡å†’ç”¨æˆ·æ¶æ„æ“ä½œï¼› ç”µå­åˆåŒæ³•å¾‹æ•ˆåŠ› åœ¨å¹³å°ç­¾ç½²ç”µå­åˆåŒæ—¶ä½¿ç”¨ç”µå­ç­¾åæŠ€æœ¯ï¼Œç¬¦åˆç”µå­ç­¾åæ³•çš„è¦æ±‚ï¼Œä»è€Œä¿è¯å¹³å°ç­¾ç½²çš„ç”µå­åˆåŒå…·æœ‰æ³•å¾‹æ•ˆåŠ›ï¼› ç”µå­åˆåŒä¿¡æ¯åšåˆ°é˜²ç¯¡æ”¹å’Œä¿å¯† å¹³å°å„å‚ä¸æ–¹ç­¾ç½²ç”µå­åˆåŒåŒ…å«æ•æ„Ÿä¸šåŠ¡ä¿¡æ¯ï¼Œä½¿ç”¨ç­¾åå’ŒåŠ å¯†æŠ€æœ¯å®ç°æ•æ„Ÿä¸šåŠ¡ä¿¡æ¯çš„é˜²ç¯¡æ”¹å’Œä¿å¯†ï¼› å¹³å°ç”¨æˆ·çš„æ˜“æ“ä½œæ€§ æ•°å­—è¯ä¹¦å’Œç­¾åæŠ€æœ¯å·²ç»æ˜¯å¹¿æ³›åº”ç”¨çš„æˆç†ŸæŠ€æœ¯ï¼Œç›®å‰åœ¨ç½‘ä¸Šé“¶è¡Œå¹¿æ³›ä½¿ç”¨ï¼Œå¹³å°ç”¨æˆ·å·²ç»æˆç†ŸæŒæ¡è¯¥æŠ€æœ¯çš„æ“ä½œå’Œä½¿ç”¨ã€‚ å®‰å¿ƒç­¾å¹³å°æ¥å…¥æµç¨‹å®‰å¿ƒç­¾å¹³å°ä»‹ç»å®‰å¿ƒç­¾æ˜¯ä¸­å›½é‡‘èè®¤è¯ä¸­å¿ƒï¼ˆä»¥ä¸‹ç®€ç§°â€œCFCAâ€ï¼‰æ——ä¸‹çš„ç¬¬ä¸‰æ–¹ç”µå­ç¼”çº¦æœåŠ¡å¹³å°ï¼Œä¸ºæŒæœ‰æœ‰æ•ˆæ•°å­—è¯ä¹¦çš„ç”¨æˆ·æä¾›æ•°æ®ç”µæ–‡æˆ–ç”µå­ç¼”çº¦æ–‡ä»¶çš„åœ¨çº¿ç­¾ç½²ã€å­˜å‚¨å’Œç®¡ç†æœåŠ¡ã€‚ åè¯ä»‹ç»å®¢æˆ·å¹³å°: ä¸å®‰å¿ƒç­¾å¯¹æ¥çš„ç”µå­åˆåŒå»ºè®¾æ–¹ã€‚ å¹³å°ç”¨æˆ·: å®¢æˆ·å¹³å°çš„ç”¨æˆ·ï¼Œé€šè¿‡å®¢æˆ·å¹³å°æ–¹ä½¿ç”¨å®‰å¿ƒç­¾ç”µå­åˆåŒæœåŠ¡ã€‚ ç”¨æˆ·ä¸‰è¦ç´ : ç”¨æˆ·åã€è¯ä»¶ç±»å‹ã€è¯ä»¶å·ç ï¼Œç”¨ä»¥åˆ¤æ–­ç”¨æˆ·èº«ä»½åŠå”¯ä¸€æ€§ï¼Œç›¸åŒçš„ä¸‰è¦ç´ è§†ä¸ºåŒä¸€ä¸ªç”¨æˆ·ã€‚ ä¸šåŠ¡æµç¨‹åˆ†ç±»å®¢æˆ·å¹³å°ä¸å®‰å¿ƒç­¾å¯¹æ¥ï¼Œå®ç°ç”µå­åˆåŒç­¾ç½²ï¼Œæ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ç§æ–¹å¼ã€‚ 1. è¯ä¹¦æ‰˜ç®¡ + åˆåŒæ¨¡æ¿æ–¹å¼ å¹³å°ç”¨æˆ·é€šè¿‡å®¢æˆ·å¹³å°åœ¨å®‰å¿ƒç­¾å¼€æˆ·ï¼Œå®‰å¿ƒç­¾è‡ªåŠ¨ä¸ºç”¨æˆ·ç”Ÿæˆæ•°å­—è¯ä¹¦å¹¶ä¿å­˜åœ¨å®‰å¿ƒç­¾ä¸­ã€‚å®¢æˆ·å¹³å°é¢„å…ˆç”ŸæˆåˆåŒæ¨¡æ¿å¹¶ä¿å­˜åœ¨å®‰å¿ƒç­¾ä¸­ã€‚åˆåŒç­¾ç½²æ—¶ï¼Œå®¢æˆ·å¹³å°å°†å…³é”®ä¿¡æ¯åŠç”¨æˆ·ä¿¡æ¯ä¼ ç»™å®‰å¿ƒç­¾ï¼Œå®‰å¿ƒç­¾è‡ªåŠ¨å°†å…³é”®ä¿¡æ¯å¡«å…¥ç›¸åº”çš„åˆåŒæ¨¡æ¿ä¸­ï¼Œå¹¶è°ƒç”¨ç”¨æˆ·è¯ä¹¦è¿›è¡Œç­¾ç½²ï¼Œç”Ÿæˆç”µå­åˆåŒã€‚ 2.è¯ä¹¦æ‰˜ç®¡ + è‡ªå®šä¹‰åˆåŒæ–¹å¼ å¹³å°ç”¨æˆ·é€šè¿‡å®¢æˆ·å¹³å°åœ¨å®‰å¿ƒç­¾å¼€æˆ·ï¼Œå®‰å¿ƒç­¾è‡ªåŠ¨ä¸ºç”¨æˆ·ç”Ÿæˆæ•°å­—è¯ä¹¦å¹¶ä¿å­˜åœ¨å®‰å¿ƒç­¾ä¸­ã€‚åˆåŒç­¾ç½²æ—¶ï¼Œå®¢æˆ·å¹³å°å°†åˆåŒæ–‡ä»¶å’Œç”¨æˆ·ä¿¡æ¯ä¼ ç»™å®‰å¿ƒç­¾ï¼Œå®‰å¿ƒç­¾è°ƒç”¨ç”¨æˆ·è¯ä¹¦åœ¨åˆåŒçš„æŒ‡å®šä½ç½®è¿›è¡Œç­¾ç½²ï¼Œç”Ÿæˆç”µå­åˆåŒã€‚ ä¸Šè¿°ä¸¤ç§æ–¹å¼çš„åŒºåˆ«åœ¨äºï¼Œå¦‚æœæ¯ä»½åˆåŒå·®åˆ«ä¸å¤§ï¼Œåˆ™é€‚ç”¨åˆåŒæ¨¡æ¿çš„æ–¹å¼ï¼›å¦‚æœæ¯ä»½åˆåŒå·®åˆ«è¾ƒå¤§ï¼Œåˆ™é€‚ç”¨è‡ªå®šä¹‰åˆåŒçš„æ–¹å¼ã€‚ 3.è‡ªæœ‰è¯ä¹¦ç­¾ç½² + åˆåŒæ¨¡æ¿æ–¹å¼ å¦‚æœå®¢æˆ·å¹³å°æˆ–å¹³å°ç”¨æˆ·ä¸å¸Œæœ›å®‰å¿ƒç­¾æ‰˜ç®¡è¯ä¹¦ï¼Œå¹³å°ç”¨æˆ·å¯ä»¥é€šè¿‡å®¢æˆ·å¹³å°åœ¨å®‰å¿ƒç­¾å¼€æˆ·ï¼Œå¹¶ç»‘å®šè‡ªæœ‰çš„CFCAè¯ä¹¦ï¼Œå³åœ¨å®‰å¿ƒç­¾ä¸­ä½¿ç”¨ç”¨æˆ·è‡ªå·±ä¿ç®¡çš„CFCAè¯ä¹¦ï¼ˆè¯¥è¯ä¹¦ä¿¡æ¯å¿…é¡»å·²ç»æ”¶å½•åœ¨ç½‘ç»œèº«ä»½è®¤è¯å¹³å°æ•°æ®åº“ä¸­ï¼Œå…·ä½“ä¸šåŠ¡ä¸­å®¢æˆ·è‹¥éœ€è¦ç»‘å®šè‡ªæœ‰è¯ä¹¦ï¼Œè¯·æŠ€æœ¯æ”¯æŒä¸ä¸šåŠ¡ç¡®è®¤è¯¥ä¿¡æ¯ï¼‰ã€‚å®¢æˆ·å¹³å°é¢„å…ˆç”ŸæˆåˆåŒæ¨¡æ¿å¹¶ä¿å­˜åœ¨å®‰å¿ƒç­¾ä¸­ã€‚åˆåŒç­¾ç½²æ—¶ï¼Œå®¢æˆ·å¹³å°å°†å…³é”®ä¿¡æ¯åŠç”¨æˆ·ä¿¡æ¯ä¼ ç»™å®‰å¿ƒç­¾ï¼Œå®‰å¿ƒç­¾è‡ªåŠ¨å°†å…³é”®ä¿¡æ¯å¡«å…¥ç›¸åº”çš„åˆåŒæ¨¡æ¿ä¸­ï¼Œç”ŸæˆåˆåŒå…¨æ–‡ï¼Œè·å–åˆåŒæ‘˜è¦ï¼ˆå“ˆå¸Œå€¼ï¼‰ï¼Œå®¢æˆ·å¹³å°åœ¨ç”¨æˆ·æœ¬åœ°è°ƒç”¨ç”¨æˆ·è¯ä¹¦å¯¹åˆåŒæ‘˜è¦è¿›è¡Œç­¾ç½²ï¼ˆç­¾åå€¼ï¼‰ï¼Œå¹¶å°†ç­¾åå€¼å‘é€åˆ°å®‰å¿ƒç­¾ï¼Œç”Ÿæˆç”µå­åˆåŒã€‚ 4.è¯ä¹¦æ‰˜ç®¡ + åˆåŒæ¨¡æ¿æ–¹å¼ å¦‚æœå®¢æˆ·å¹³å°æˆ–å¹³å°ç”¨æˆ·ä¸å¸Œæœ›å®‰å¿ƒç­¾æ‰˜ç®¡è¯ä¹¦ï¼Œå¹³å°ç”¨æˆ·å¯ä»¥é€šè¿‡å®¢æˆ·å¹³å°åœ¨å®‰å¿ƒç­¾å¼€æˆ·ï¼Œå¹¶ç»‘å®šè‡ªæœ‰çš„CFCAè¯ä¹¦ï¼Œå³åœ¨å®‰å¿ƒç­¾ä¸­ä½¿ç”¨ç”¨æˆ·è‡ªå·±ä¿ç®¡çš„CFCAè¯ä¹¦ï¼ˆè¯¥è¯ä¹¦ä¿¡æ¯å¿…é¡»å·²ç»æ”¶å½•åœ¨ç½‘ç»œèº«ä»½è®¤è¯å¹³å°æ•°æ®åº“ä¸­ï¼Œå…·ä½“ä¸šåŠ¡ä¸­å®¢æˆ·è‹¥éœ€è¦ç»‘å®šè‡ªæœ‰è¯ä¹¦ï¼Œè¯·æŠ€æœ¯æ”¯æŒä¸ä¸šåŠ¡ç¡®è®¤è¯¥ä¿¡æ¯ï¼‰ã€‚åˆåŒç­¾ç½²æ—¶ï¼Œå®¢æˆ·å¹³å°å°†åˆåŒæ–‡ä»¶å’Œç”¨æˆ·ä¿¡æ¯ä¼ ç»™å®‰å¿ƒç­¾ã€‚å®¢æˆ·å¹³å°åœ¨è·å–åˆåŒæ‘˜è¦ï¼ˆå“ˆå¸Œå€¼ï¼‰åï¼Œåœ¨ç”¨æˆ·æœ¬åœ°è°ƒç”¨ç”¨æˆ·è¯ä¹¦å¯¹åˆåŒæ‘˜è¦è¿›è¡Œç­¾ç½²ï¼ˆç­¾åå€¼ï¼‰ï¼Œå¹¶å°†ç­¾åå€¼å‘é€åˆ°å®‰å¿ƒç­¾ï¼Œç”Ÿæˆç”µå­åˆåŒã€‚]]></content>
      <categories>
        <category>å¼€å‘å·¥å…·</category>
        <category>CA</category>
      </categories>
      <tags>
        <tag>true</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hyperleder explorer éƒ¨ç½²]]></title>
    <url>%2F2019%2F07%2F26%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2FHyperledger%20fabric%2F6.Hyperledger%20explorer%2F</url>
    <content type="text"><![CDATA[è¯¥ç¯‡æ–‡æ¡£çš„å‰ææ˜¯å·²ç»å­˜åœ¨éƒ¨ç½²å¥½çš„fabricç½‘ç»œ, å¹¶ä¸”åœ¨peerèŠ‚ç‚¹æœ‰è¿è¡Œçš„è‡ªå®šä¹‰é“¾ç  Explorer åŒºå—é“¾æµè§ˆå™¨éƒ¨ç½²åŒºå—é“¾ç½‘ç»œéƒ¨ç½²(å‰æ) åœ¨éƒ¨ç½² Exploreré¡¹ç›®å‰æå‰è¦æœ‰å­˜åœ¨çš„åŒºå—é“¾ç½‘ç»œï¼Œè¿™é‡Œè¯´ä¸€ä¸‹åŒºå—é“¾ç½‘ç»œéƒ¨ç½²æ—¶åº”è¯¥æ³¨æ„ç‚¹çš„ç‚¹ åœ¨åŒºå—é“¾ç½‘ç»œä¸­å¯åŠ¨æ“ä½œæœåŠ¡å™¨ å¦‚æœè¦ä½¿ç”¨åŒºå—é“¾ç›‘æ§ï¼Œåœ¨å¯åŠ¨ç½‘ç»œçš„æ—¶å€™åº”è¯¥åŠ ä¸Šå¦‚ä¸‹ç¯å¢ƒå˜é‡ 1234- ORDERER_OPERATIONS_LISTENADDRESS=0.0.0.0:8443 # operation RESTful API- ORDERER_METRICS_PROVIDER=prometheus # prometheus will pull metrics from orderer via /metrics RESTful API- CORE_OPERATIONS_LISTENADDRESS=0.0.0.0:9443 # operation RESTful API- CORE_METRICS_PROVIDER=prometheus # prometheus will pull metrics from orderer via /metrics RESTful API åŠ¡å¿…å¼€å¯gossip å¼€å¯gossipï¼Œ ä½¿åŒºå—é“¾ç½‘ç»œå¼€å¯å‘ç°æœåŠ¡ 12- CORE_PEER_GOSSIP_BOOTSTRAP=X.X.X.X:XXXX- CORE_PEER_GOSSIP_EXTERNALENDPOINT=X.X.X.X:XXXX é¡¹ç›®æ‹‰å–12git clone https://github.com/hyperledger/blockchain-explorer.gitcd blockchain-explorer å®‰è£…æ•°æ®åº“é…ç½®prostgreSQLæ•°æ®åº“ ç¬¬ä¸€ç§é…ç½®æ–¹æ³• cd blockchain-explorer/app ä¿®æ”¹ explorerconfig.json 1234567"postgreSQL": &#123; "host": "127.0.0.1", "port": "5432", "database": "fabricexplorer", "username": "hppoc", "passwd": "password"&#125; ç¬¬äºŒç§é…ç½®æ–¹æ³• 12345export DATABASE_HOST=127.0.0.1export DATABASE_PORT=5432export DATABASE_DATABASE=fabricexplorerexport DATABASE_USERNAME=hppocexport DATABASE_PASSWD=pass12345 ç»™æ‰§è¡Œsqlè„šæœ¬çš„ç›®å½•å¸¦æ‰§è¡Œæƒé™1chomd -R 775 /blockchain-explorer/app/persistence/fabric/postgreSQL/db æ‰§è¡Œæ•°æ®åº“è„šæœ¬12cd blockchain-explorer/app/persistence/fabric/postgreSQL/dbsudo -u postgres ./createdb.sh é…ç½®èº«ä»½è®¤è¯é…ç½®jwtâ€‹ cd blockchain-explorer/app ä¿®æ”¹explorerconfig.json æ–‡ä»¶ 1234"jwt": &#123; "secret" : "a secret phrase!!", # ç”¨æ¥ç­¾åpayloadçš„å¯†é’¥ "expiresIn": "2 days" # token è¿‡æœŸæ—¶é—´ Eg: 60, "2 days", "10h", "7d".&#125; é…ç½®explorer é“¾æ¥åˆ°åŒºå—é“¾ç½‘ç»œé…ç½® explorer é“¾æ¥åŒºå—é“¾ç½‘ç»œ é…ç½®ç½‘ç»œæ–‡ä»¶ä½ç½®: /blockchain-explorer/app/platform/fabric/config.json é…ç½®é“¾æ¥æ–‡ä»¶ä½ç½®: /blockchain-explorer/app/platform/fabric/connection-profile é…ç½® prometheus é“¾æ¥åˆ°æ“ä½œæœåŠ¡å™¨â€‹ 1. é…ç½®æ–‡ä»¶ä½ç½®: app/platform/fabric/artifacts/operations/balance-transfer/prometheus.yml å®‰è£…å¹¶é…ç½® grafana é…ç½®æ–‡ä»¶ä½ç½®: app/platform/fabric/artifacts/operations/balance-transfer/balance-transfer-grafana-dashboard.json é…ç½®æ–‡ä»¶ä½ç½®: app/platform/fabric/artifacts/operations/grafana_conf/provisioning/dashboards/dashboard.yaml é…ç½®æ–‡ä»¶ä½ç½®: app/platform/fabric/artifacts/operations/grafana_conf/provisioning/datasources/datasource.yaml Build Explorer é¡¹ç›®12./main.sh clean./main.sh install è¿è¡ŒExploreré¡¹ç›®1234567891011121314cd blockchain-explorer/app ä¿®æ”¹explorerconfig.json åŒæ­¥é¢‘ç‡ ä¸»æœºç±»å‹ åŒºå—åŒæ­¥æ—¶é—´çš„è¯¦ç»†é…ç½®# æ™®é€šæ–¹å¼è¿è¡Œå’Œåœæ­¢cd blockchain-explorer/./start.sh (it will have the backend up)../start.sh debug (it will have the backend in debug mode)../start.sh print (it will print help).Launch the URL http(s)://localhost:8080 on a browser../stop.sh (it will stop the node server).# Syncæ–¹å¼è¿è¡Œå’Œåœæ­¢cd blockchain-explorer/./syncstart.sh (it will have the sync node up)../syncstop.sh (it will stop the sync node). Explorer Docker éƒ¨ç½² å‰æ: bash Docker Docker Compose ä»“åº“åœ°å€: Hyperledger Explorer docker repository https://hub.docker.com/r/hyperledger/explorer/ Hyperledger Explorer PostgreSQL docker repository https://hub.docker.com/r/hyperledger/explorer-db åŒºå—é“¾ç½‘ç»œéƒ¨ç½²(å‰æ) åœ¨éƒ¨ç½² Exploreré¡¹ç›®å‰æå‰è¦æœ‰å­˜åœ¨çš„åŒºå—é“¾ç½‘ç»œï¼Œè¿™é‡Œè¯´ä¸€ä¸‹åŒºå—é“¾ç½‘ç»œéƒ¨ç½²æ—¶åº”è¯¥æ³¨æ„ç‚¹çš„ç‚¹ åœ¨åŒºå—é“¾ç½‘ç»œä¸­å¯åŠ¨æ“ä½œæœåŠ¡å™¨ å¦‚æœè¦ä½¿ç”¨åŒºå—é“¾ç›‘æ§ï¼Œåœ¨å¯åŠ¨ç½‘ç»œçš„æ—¶å€™åº”è¯¥åŠ ä¸Šå¦‚ä¸‹ç¯å¢ƒå˜é‡ 1234- ORDERER_OPERATIONS_LISTENADDRESS=0.0.0.0:8443 # operation RESTful API- ORDERER_METRICS_PROVIDER=prometheus # prometheus will pull metrics from orderer via /metrics RESTful API- CORE_OPERATIONS_LISTENADDRESS=0.0.0.0:9443 # operation RESTful API- CORE_METRICS_PROVIDER=prometheus # prometheus will pull metrics from orderer via /metrics RESTful API åŠ¡å¿…å¼€å¯gossip å¼€å¯gossipï¼Œ ä½¿åŒºå—é“¾ç½‘ç»œå¼€å¯å‘ç°æœåŠ¡ 12- CORE_PEER_GOSSIP_BOOTSTRAP=X.X.X.X:XXXX- CORE_PEER_GOSSIP_EXTERNALENDPOINT=X.X.X.X:XXXX Exploreré¡¹ç›®æ‹‰å–12git clone https://github.com/hyperledger/blockchain-explorer.gitcd blockchain-explorer é…ç½®Exploreré…ç½®explorerå’Œfabricç½‘ç»œçš„è¿æ¥å‚è€ƒé…ç½®æ–‡ä»¶ä½ç½®: examples/net1/config.json è¿æ¥çš„ä¸»é…ç½®æ–‡ä»¶ examples/net1/connection-profile å’Œ fabric çš„è¿æ¥é…ç½® examples/net1/crypto ç½‘ç»œä¼ è¾“åŠ å¯†æ–‡ä»¶ç›®å½•(å¦‚æœæœ‰çš„è¯) é…ç½® prometheuså‚è€ƒé…ç½®æ–‡ä»¶ä½ç½®: app/platform/fabric/artifacts/operations/balance-transfer/prometheus.yml é…ç½® grafanaå‚è€ƒé…ç½®æ–‡ä»¶ä½ç½®: app/platform/fabric/artifacts/operations/balance-transfer/balance-transfer-grafana-dashboard.json ä¸€ä¸ªdashboardçš„è¯¦ç»†é…ç½® app/platform/fabric/artifacts/operations/grafana_conf/provisioning/dashboards/dashboard.yaml dashboardçš„å­˜å‚¨ç›®å½•ç­‰åŸºæœ¬é…ç½® app/platform/fabric/artifacts/operations/grafana_conf/provisioning/datasources/datasource.yaml æ•°æ®æºçš„é…ç½® é…ç½®docker-compose æ–‡ä»¶é…ç½®ç½‘ç»œé…ç½®ç½‘ç»œï¼Œå¯ä»¥æŒ‡å®šå·²ç»å­˜åœ¨çš„ç½‘ç»œï¼Œå¦‚æœå’ŒåŒºå—é“¾ç½‘ç»œåœ¨åŒä¸€å°æœºå™¨ä¸Šå¯ä»¥ä½¿ç”¨åŒºå—é“¾ç½‘ç»œ å¦‚æœå’ŒåŒºå—é“¾ç½‘ç»œæ˜¯åˆ†å¼€éƒ¨ç½²çš„ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªå…¶ä»–çš„ä»»æ„ç½‘ç»œ 1234networks: mynetwork.com: external: name: net_byfn é…ç½®æ•°æ®åº“1234567environment: # é…ç½®æ•°æ®åº“åç§°ï¼Œç”¨æˆ·å¯†ç ç­‰ - DATABASE_DATABASE=fabricexplorer - DATABASE_USERNAME=hppoc - DATABASE_PASSWORD=password volumes: # é…ç½®æ•°æ®åº“åˆ›å»ºç›‘æœ¬ä½ç½®ï¼› é…ç½®æ•°æ®åº“æŒä¹…åŒ–çš„ä½ç½® - ./app/persistence/fabric/postgreSQL/db/createdb.sh:/docker-entrypoint-initdb.d/createdb.sh - pgdata:/var/lib/postgresql/data é…ç½® explorer12345678910environment: - DATABASE_HOST=explorerdb.mynetwork.com # è¿æ¥çš„æ•°æ®åº“é…ç½® - DATABASE_USERNAME=hppoc - DATABASE_PASSWD=password - DISCOVERY_AS_LOCALHOST=false # å¦‚æœæ˜¯é€šè¿‡æ¡¥æ¥çš„æ–¹å¼è¿æ¥åˆ°åŒºå—é“¾æµè§ˆå™¨ï¼ŒåŠ¡å¿…è®¾ç½®ä¸ºfalse volumes: # å¼•ç”¨çš„é…ç½®æ–‡ä»¶ä½ç½®é…ç½® - ./examples/net1/config.json:/opt/explorer/app/platform/fabric/config.json - ./examples/net1/connection-profile:/opt/explorer/app/platform/fabric/connection-profile - ./examples/net1/crypto:/tmp/crypto - walletstore:/opt/wallet é…ç½® prometheus123volumes: - ./app/platform/fabric/artifacts/operations/balance-transfer/prometheus.yml:/etc/prometheus/prometheus.yml # å¼•ç”¨çš„é…ç½®æ–‡ä»¶ä½ç½® - prometheus-storage:/prometheus # prometheusæ•°æ®æŒä¹…åŒ–çš„ä½ç½® é…ç½® grafana1234volumes: # é…ç½®å¼•ç”¨é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œä»¥åŠæ•°æ®æŒä¹…åŒ–çš„æ–‡èŒ - ./app/platform/fabric/artifacts/operations/balance-transfer/balance-transfer-grafana-dashboard.json:/var/lib/grafana/dashboards/mydashboard.json - ./app/platform/fabric/artifacts/operations/grafana_conf/provisioning:/etc/grafana/provisioning - grafana-storage:/var/lib/grafana docker-compose.yaml æ–‡ä»¶çš„ç¤ºä¾‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970version: '2.1'volumes: pgdata: walletstore: grafana-storage: prometheus-storage:networks: mynetwork.com: external: name: net_byfnservices: explorerdb.mynetwork.com: image: hyperledger/explorer-db:latest container_name: explorerdb.mynetwork.com hostname: explorerdb.mynetwork.com environment: - DATABASE_DATABASE=fabricexplorer - DATABASE_USERNAME=hppoc - DATABASE_PASSWORD=password volumes: - ./app/persistence/fabric/postgreSQL/db/createdb.sh:/docker-entrypoint-initdb.d/createdb.sh - pgdata:/var/lib/postgresql/data networks: - mynetwork.com explorer.mynetwork.com: image: hyperledger/explorer:latest container_name: explorer.mynetwork.com hostname: explorer.mynetwork.com environment: - DATABASE_HOST=explorerdb.mynetwork.com - DATABASE_USERNAME=hppoc - DATABASE_PASSWD=password - DISCOVERY_AS_LOCALHOST=false volumes: - ./examples/net1/config.json:/opt/explorer/app/platform/fabric/config.json - ./examples/net1/connection-profile:/opt/explorer/app/platform/fabric/connection-profile - ./examples/net1/crypto:/tmp/crypto - walletstore:/opt/wallet command: sh -c "sleep 16&amp;&amp; node /opt/explorer/main.js &amp;&amp; tail -f /dev/null" ports: - 8090:8080 networks: - mynetwork.com proms: container_name: proms image: prom/prometheus:latest volumes: - ./app/platform/fabric/artifacts/operations/balance-transfer/prometheus.yml:/etc/prometheus/prometheus.yml - prometheus-storage:/prometheus ports: - '9090:9090' networks: - mynetwork.com grafana: container_name: grafana image: grafana/grafana:latest volumes: - ./app/platform/fabric/artifacts/operations/balance-transfer/balance-transfer-grafana-dashboard.json:/var/lib/grafana/dashboards/mydashboard.json - ./app/platform/fabric/artifacts/operations/grafana_conf/provisioning:/etc/grafana/provisioning - grafana-storage:/var/lib/grafana ports: - '3000:3000' networks: - mynetwork.com å¯åŠ¨ç½‘ç»œ1docker-compose up -d]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>Hyperledger fabric</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webpack ä½¿ç”¨]]></title>
    <url>%2F2019%2F07%2F16%2F03.web%E5%89%8D%E7%AB%AF%2FVUE%2Fwebpack%20%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[ä¸€ã€webpackä»‹ç»1ã€ç”±æ¥ç”±äºå‰ç«¯ä¹‹å‰jsã€cssã€å›¾ç‰‡æ–‡ä»¶éœ€è¦å•ç‹¬è¿›è¡Œå‹ç¼©å’Œæ‰“åŒ…ï¼Œè¿™æ ·å›¢é˜Ÿäººå‘˜å¤„ç†å¾ˆç¹çï¼Œç„¶å Instagram å›¢é˜Ÿå°±æƒ³è®©è¿™äº›å·¥ä½œè‡ªåŠ¨åŒ–ï¼Œç„¶åwebpackåº”è¿è€Œç”Ÿã€‚ 2ã€ä»‹ç»webpackæ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å™¨ï¼ˆmodule bundlerï¼‰ï¼Œwebpackè§†HTMLï¼ŒJSï¼ŒCSSï¼Œå›¾ç‰‡ç­‰æ–‡ä»¶éƒ½æ˜¯ä¸€ç§ èµ„æº ï¼Œæ¯ä¸ªèµ„æºæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼ˆmoduleï¼‰æ–‡ä»¶ï¼Œwebpackå°±æ˜¯æ ¹æ®æ¯ä¸ªæ¨¡å—æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»å°†æ‰€æœ‰çš„æ¨¡å—æ‰“åŒ…ï¼ˆbundleï¼‰èµ·æ¥ã€‚ 3ã€ä½œç”¨ å¯¹ CommonJS ã€ AMD ã€ES6çš„è¯­æ³•åšäº†å…¼å®¹ å¯¹jsã€cssã€å›¾ç‰‡ç­‰èµ„æºæ–‡ä»¶éƒ½æ”¯æŒæ‰“åŒ…ï¼ˆé€‚åˆå›¢é˜ŸåŒ–å¼€å‘ï¼‰ ï¼Œæ¯”æ–¹ä½ å†™ä¸€ä¸ªjsæ–‡ä»¶ï¼Œå¦å¤–ä¸€ä¸ªäººä¹Ÿå†™ä¸€ä¸ªjsæ–‡ä»¶ï¼Œéœ€è¦åˆå¹¶å¾ˆéº»çƒ¦ï¼Œç°åœ¨äº¤ç»™webpackåˆå¹¶å¾ˆç®€å• æœ‰ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶webpack.config.js å¯ä»¥å°†ä»£ç åˆ‡å‰²æˆä¸åŒçš„chunkï¼Œå®ç°æŒ‰éœ€åŠ è½½ï¼Œé™ä½äº†åˆå§‹åŒ–æ—¶é—´ å…·æœ‰å¼ºå¤§çš„Pluginï¼ˆæ’ä»¶ï¼‰æ¥å£ï¼Œå¤§å¤šæ˜¯å†…éƒ¨æ’ä»¶ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒçµæ´» 4ã€æ‹“å±•è¯´æ˜ CommonJSã€AMDã€CMDæ˜¯ç”¨äºJavaScriptæ¨¡å—ç®¡ç†çš„ä¸‰å¤§è§„èŒƒï¼ŒCommonJSå®šä¹‰çš„æ˜¯æ¨¡å—çš„åŒæ­¥åŠ è½½ï¼Œæ˜¯ä¸€ä¸ªæ›´åå‘äºæœåŠ¡å™¨ç«¯çš„è§„èŒƒï¼ˆä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼‰ï¼Œä¸»è¦ç”¨äºNodejsï¼Œæ ¹æ®CommonJSè§„èŒƒï¼Œä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼ŒåŠ è½½æ¨¡å—ä½¿ç”¨require()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶æ‰§è¡Œï¼Œæœ€åè¿”å›æ–‡ä»¶å†…éƒ¨çš„exportså¯¹è±¡ã€‚ AMDå’ŒCMDåˆ™æ˜¯å®šä¹‰æ¨¡å—å¼‚æ­¥åŠ è½½é€‚ç”¨äºæµè§ˆå™¨ç«¯ï¼Œéƒ½æ˜¯ä¸ºäº† JavaScript çš„æ¨¡å—åŒ–å¼€å‘ï¼Œï¼ˆè¿™é‡Œè¯´ä¸€ä¸‹ä¸ºä»€è¦æœ‰å¼‚æ­¥åŠ è½½ï¼Œå› ä¸ºæµè§ˆå™¨å¦‚æœä½¿ç”¨common.jsåŒæ­¥åŠ è½½æ¨¡å—çš„è¯ï¼Œå°±ä¼šå¯¼è‡´æ€§èƒ½ç­‰é—®é¢˜ï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œåˆå‡ºäº†ä¸€ä¸ªè§„èŒƒï¼Œè¿™ä¸ªè§„èŒƒå¯ä»¥å®ç°å¼‚æ­¥åŠ è½½ä¾èµ–æ¨¡å—ï¼‰ AMDè§„èŒƒä¼šæå‰åŠ è½½ä¾èµ–æ¨¡å—ï¼ŒAMDè§„èŒƒæ˜¯é€šè¿‡requireJs åœ¨æ¨å¹¿è¿‡ç¨‹ä¸­å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒåŒ–äº§å‡ºã€‚ CMDè§„èŒƒä¼šå»¶è¿ŸåŠ è½½ä¾èµ–æ¨¡å—ï¼Œ CMD è§„èŒƒæ˜¯ SeaJs åœ¨æ¨å¹¿è¿‡ç¨‹ä¸­å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒåŒ–äº§å‡ºã€‚ AMDè§„èŒƒå’ŒCMDè§„èŒƒçš„åŒºåˆ« å¯¹äºä¾èµ–çš„æ¨¡å—ï¼ŒAMD æ˜¯æå‰æ‰§è¡Œï¼ŒCMD æ˜¯å»¶è¿Ÿæ‰§è¡Œã€‚ä¸è¿‡ RequireJS ä» 2.0 å¼€å§‹ï¼Œä¹Ÿæ”¹æˆå¯ä»¥å»¶è¿Ÿæ‰§è¡Œï¼ˆæ ¹æ®å†™æ³•ä¸åŒï¼Œå¤„ç†æ–¹å¼ä¸åŒï¼‰CMD æ¨å´‡ä¾èµ–å°±è¿‘ï¼ŒAMD æ¨å´‡ä¾èµ–å‰ç½®AMD çš„ API é»˜è®¤æ˜¯ä¸€ä¸ªå½“å¤šä¸ªç”¨ï¼ŒCMD çš„ API ä¸¥æ ¼åŒºåˆ†ï¼Œæ¨å´‡èŒè´£å•ä¸€ã€‚æ¯”å¦‚ AMD é‡Œï¼Œrequire åˆ†å…¨å±€ require å’Œå±€éƒ¨ requireï¼Œéƒ½å« requireã€‚CMD é‡Œï¼Œæ²¡æœ‰å…¨å±€ requireï¼Œè€Œæ˜¯æ ¹æ®æ¨¡å—ç³»ç»Ÿçš„å®Œå¤‡æ€§ï¼Œæä¾› seajs.use æ¥å®ç°æ¨¡å—ç³»ç»Ÿçš„åŠ è½½å¯åŠ¨ã€‚CMD é‡Œï¼Œæ¯ä¸ª API éƒ½ç®€å•çº¯ç²¹webpackå’Œgulpçš„åŒºåˆ« gulpæ˜¯å‰ç«¯è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œå¼ºè°ƒçš„æ˜¯å‰ç«¯å¼€å‘çš„å·¥ä½œæµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®ä¸€ç³»åˆ—çš„taskï¼Œå®šä¹‰taskå¤„ç†çš„äº‹æƒ…ï¼ˆä»£ç å‹ç¼©ã€åˆå¹¶ã€ç¼–è¯‘ã€æµè§ˆå™¨å®æ—¶æ›´æ–°ç­‰ï¼‰ï¼Œç„¶åå®šä¹‰æ‰§è¡Œé¡ºåºï¼Œæ¥è®©gulpæ‰§è¡Œè¿™äº›taskï¼Œä»è€Œæ„å»ºé¡¹ç›®çš„æ•´ä¸ªå‰ç«¯å¼€å‘æµç¨‹ï¼Œè‡ªåŠ¨åŒ–æ„å»ºå·¥å…·å¹¶ä¸èƒ½æŠŠæ‰€æœ‰æ¨¡å—æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œä¹Ÿä¸èƒ½æ„å»ºä¸åŒæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚webpackæ˜¯ JavaScript åº”ç”¨ç¨‹åºçš„æ¨¡å—æ‰“åŒ…å™¨ï¼Œå¼ºè°ƒçš„æ˜¯ä¸€ä¸ªå‰ç«¯æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œæ›´ä¾§é‡æ¨¡å—æ‰“åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¼€å‘ä¸­çš„æ‰€æœ‰èµ„æºï¼ˆå›¾ç‰‡ã€jsæ–‡ä»¶ã€cssæ–‡ä»¶ç­‰ï¼‰éƒ½çœ‹æˆæ¨¡å—ï¼Œé€šè¿‡loaderï¼ˆåŠ è½½å™¨ï¼‰å’Œpluginsï¼ˆæ’ä»¶ï¼‰å¯¹èµ„æºè¿›è¡Œå¤„ç†ï¼Œæ‰“åŒ…æˆç¬¦åˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„å‰ç«¯èµ„æºã€‚ 5ã€webpackæ•´ä½“è®¤çŸ¥ (1)ã€webpackçš„æ ¸å¿ƒæ¦‚å¿µåˆ†ä¸º å…¥å£(Entry)ã€åŠ è½½å™¨(Loader)ã€æ’ä»¶(Plugins)ã€å‡ºå£(Output); å…¥å£(Entry)ï¼šå…¥å£èµ·ç‚¹å‘Šè¯‰ webpack ä»å“ªé‡Œå¼€å§‹ï¼Œå¹¶æ ¹æ®ä¾èµ–å…³ç³»å›¾ç¡®å®šéœ€è¦æ‰“åŒ…çš„æ–‡ä»¶å†…å®¹ åŠ è½½å™¨(Loader)ï¼šwebpack å°†æ‰€æœ‰çš„èµ„æºï¼ˆcss, js, image ç­‰ï¼‰éƒ½çœ‹åšæ¨¡å—ï¼Œä½†æ˜¯ webpack èƒ½å¤„ç†çš„åªæ˜¯ JavaScriptï¼Œå› æ­¤ï¼Œéœ€è¦å­˜åœ¨ä¸€ä¸ªèƒ½å°†å…¶ä»–èµ„æºè½¬æ¢ä¸ºæ¨¡å—ï¼Œè®© webpack èƒ½å°†å…¶åŠ å…¥ä¾èµ–æ ‘ä¸­çš„ä¸œè¥¿ï¼Œå®ƒå°±æ˜¯ loaderã€‚loaderç”¨äºå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢ã€‚loader å¯ä»¥ä½¿ä½ åœ¨ import æˆ–â€åŠ è½½â€æ¨¡å—æ—¶é¢„å¤„ç†æ–‡ä»¶ã€‚å› æ­¤ï¼Œloader ç±»ä¼¼äºå…¶ä»–æ„å»ºå·¥å…·ä¸­â€œä»»åŠ¡(task)â€ï¼Œå¹¶æä¾›äº†å¤„ç†å‰ç«¯æ„å»ºæ­¥éª¤çš„å¼ºå¤§æ–¹æ³•ã€‚ 1234567js rules: [ &#123; test: /\.(js|jsx)$/, use: 'babel-loader' &#125; ] æ’ä»¶(Plugins)ï¼šloader åªèƒ½é’ˆå¯¹æŸç§ç‰¹å®šç±»å‹çš„æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œè€Œ plugin çš„åŠŸèƒ½åˆ™æ›´ä¸ºå¼ºå¤§ã€‚åœ¨ plugin ä¸­èƒ½å¤Ÿä»‹å…¥åˆ°æ•´ä¸ª webpack ç¼–è¯‘çš„ç”Ÿå‘½å‘¨æœŸï¼ŒPluginsç”¨äºè§£å†³ loader æ— æ³•å®ç°çš„å…¶ä»–äº‹æƒ…ï¼Œä¹Ÿå°±æ˜¯è¯´loaderæ˜¯é¢„å¤„ç†æ–‡ä»¶ï¼Œé‚£plugin å°±æ˜¯åå¤„ç†æ–‡ä»¶ã€‚æ¯”å¦‚å¯¹loaderæ‰“åŒ…åçš„æ¨¡å—æ–‡ä»¶ï¼ˆbundle.jsï¼‰è¿›è¡ŒäºŒæ¬¡ä¼˜åŒ–å¤„ç†ï¼Œä¾‹å¦‚ï¼šä»£ç å‹ç¼©ä»è€Œå‡å°æ–‡ä»¶ä½“ç§¯ï¼›æä¾›è¾…åŠ©å¼€å‘çš„ä½œç”¨ï¼šä¾‹å¦‚ï¼šçƒ­æ›´æ–°ï¼ˆæµè§ˆå™¨å®æ—¶æ˜¾ç¤ºï¼‰ 1234plugins: [ new webpack.optimize.UglifyJsPlugin(), new HtmlWebpackPlugin(&#123;template: './src/index.html'&#125;)] äºŒã€webpackå®‰è£…1ã€å®‰è£…nodeä½¿ç”¨ node -v å‘½ä»¤æ£€æŸ¥ç‰ˆæœ¬ 2ã€å®‰è£…cnpm1npm install -g cnpm --registry=https://registry.npm.taobao.org ä½¿ç”¨ cnpm -v å‘½ä»¤æ£€æŸ¥ç‰ˆæœ¬ 3ã€å®‰è£…nrmçš„ä¸¤ç§æ–¹æ³•nrmå¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ‡æ¢ä¸åŒçš„NPMæºçš„å¿«æ·å¼€å…³ï¼Œå¯ä»¥åˆ‡æ¢çš„NPMæºåŒ…æ‹¬ï¼šnpmï¼Œcnpmï¼Œtaobaoï¼Œ rednpmï¼Œ npmMirror ï¼Œ edunpm ç¬¬ä¸€ç§æ–¹æ³•ï¼ˆç”±äºæ˜¯å¤–ç½‘è®¿é—®è¿›è¡Œå®‰è£…ï¼Œå¯èƒ½ä¼šè¢«å¢™ï¼‰ 1npm install -g nrm ç¬¬äºŒç§æ–¹æ³•ï¼ˆå›½å†…çš„æ·˜å®é•œåƒï¼Œè®¿é—®ç¨³å®šï¼Œæ¨èï¼‰ 1cnpm install -g nrm ä½¿ç”¨ nrm - V å‘½ä»¤æ£€æŸ¥ç‰ˆæœ¬(æ³¨æ„è¿™é‡Œçš„ V æ˜¯å¤§å†™çš„)ä½¿ç”¨nrm ls å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰å¯ä»¥å¯ä»¥åˆ‡æ¢çš„ NPMæºä½¿ç”¨ npm use cnpm å‘½ä»¤ æŒ‡å®šè¦ä½¿ç”¨çš„å“ªç§NPMæº 4ã€å®‰è£…webpackå…¨å±€å®‰è£… 1npm install --global webpack åœ¨é¡¹ç›®ä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬æˆ–ç‰¹å®šç‰ˆæœ¬ï¼Œåˆ†åˆ«æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 12npm install --save-dev webpack npm install --save-dev webpack@&lt; version &gt; ä¸‰ã€webpacké…ç½®0ã€æ­å»ºé¡¹ç›®ç»“æ„12345678Project- dist- src- - js- - - moudle1.js- - - main.js- index.html- webpack.config.js ## æ‰‹åŠ¨åˆ›å»º 1ã€åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ï¼ˆä¼šåˆ›å»ºä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼‰1npm init 2ã€åœ¨å½“å‰çš„é¡¹ç›®ä¸­å®‰è£…Webpackä½œä¸ºä¾èµ–åŒ…1npm install --save-dev webpack â€“save ï¼šå°†é…ç½®ä¿¡æ¯ä¿å­˜åˆ°package.jsonä¸­ï¼Œä¹Ÿæ˜¯é¡¹ç›®ç”Ÿäº§ç¯å¢ƒï¼Œé¡¹ç›®å‘å¸ƒä¹‹åè¿˜ä¾èµ–çš„ä¸œè¥¿ï¼Œä¿å­˜åœ¨dependencies â€“save-dev ï¼šæ˜¯é¡¹ç›®å¼€å‘ç¯å¢ƒä¾èµ–çš„ä¸œè¥¿ï¼Œä¿å­˜åœ¨devDependenciesä¸­, ä¾‹å¦‚ï¼šå†™ ES6 ä»£ç ï¼Œå¦‚æœä½ æƒ³ç¼–è¯‘æˆ ES5 å‘å¸ƒé‚£ä¹ˆ babel å°±æ˜¯devDependencies 3ã€å½“å‰é¡¹ç›®ç»“æ„ 4ã€å®ç°CSSæ‰“åŒ…1cnpm install css-loader style-loader --save-dev åœ¨srcâ€”&gt;cssç›®å½•ä¸­æ–°å»ºmain.css 1234css #first&#123; border: 1px solid red; &#125; åœ¨webpack.config.jsä¸­é…ç½®ç›¸å…³çš„loader 123456789101112131415161718192021222324const path = require('path'); // é¦–å…ˆè¦å¼•å…¥node.jsä¸­path æ¨¡å—ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸ç›®å½•çš„è·¯å¾„// const å‘½ä»¤å£°æ˜ä¸€ä¸ªåªè¯»çš„å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜ï¼Œå€¼ä¸å¯ä»¥æ”¹å˜ï¼Œæ”¹å˜ä¼šæŠ¥é”™ï¼›åªå£°æ˜ä¸èµ‹å€¼ä¹Ÿä¼šæŠ¥é”™// å¸¸é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä¸å¯ä»¥å˜åŒ–çš„å˜é‡ã€‚// module.exports = &#123; entry:'./src/./js/main.js', // æŒ‡å®šå…¥å£æ–‡ä»¶ output:&#123; path: path.resolve(__dirname, './dist/js'), // æŒ‡å®šå‡ºå£æ–‡ä»¶çš„è·¯å¾„ç›®å½• filename: 'bulid.js' // åˆ¶å®šå‡ºå£æ–‡ä»¶çš„åç§° &#125;, module:&#123; rules:[ // åœ¨webpack2ä¸­ï¼Œloaders è¢«æ›¿æ¢æˆäº† rules å…¶å®å°±æ˜¯loaderçš„è§„åˆ™ &#123; test: /\.css$/, use: [ 'style-loader', 'css-loader' ] // test è¯´æ˜äº†å½“å‰ loader èƒ½å¤„ç†é‚£äº›ç±»å‹çš„æ–‡ä»¶ // use åˆ™æŒ‡å®šäº† loader çš„ç±»å‹ã€‚ // æ³¨æ„ï¼šæ•°ç»„ä¸­çš„loaderä¸èƒ½çœç•¥æ‰©å±•å &#125; ] &#125;&#125; åœ¨main.jsä¸­è·å–cssç›®å½•ä¸­çš„main.cssæ–‡ä»¶ 12345678910111213141516// 1ã€è·å–index.htmlä¸­çš„domå¯¹è±¡var first = document.getElementById('first');var btn = document.getElementById('btn');var two = document.getElementById('two');var res = document.getElementById('res'); btn.onclick = function()&#123; var firstValue = parseFloat(first.value); var twoValue = parseFloat(two.value); //2ã€è·å– module1.jsä¸­çš„ sumå‡½æ•° //http://www.ruanyifeng.com/blog/2015/05/require.html var sum = require('./module1.js'); res.value = sum(firstValue,twoValue); &#125;// 3ã€è·å–cssç›®å½•ä¸­çš„main.cssæ–‡ä»¶require('../css/main.css'); åœ¨ç»ˆç«¯ä¸­è¾“å…¥ webpackå‘½ä»¤è¿›è¡Œcssæ–‡ä»¶æ‰“åŒ… 5ã€å®ç°SCSSæ‰“åŒ…åœ¨srcç›®å½•ä¸­æ–°å»º sassç›®å½•â€“&gt; scss1.scss 12345// scss1.scssæ–‡ä»¶ $color:purple; #two&#123; border:1px solid $color; &#125; å®‰è£…å¯¹åº”çš„loader 1cnpm install sass-loader css-loader style-loader node-sass webpack --save-dev åœ¨webpack.config.jsä¸­é…ç½®ç›¸å…³çš„loader 1234567891011121314151617181920212223242526272829const path = require('path'); // é¦–å…ˆè¦å¼•å…¥node.jsä¸­path æ¨¡å—ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸ç›®å½•çš„è·¯å¾„// const å‘½ä»¤å£°æ˜ä¸€ä¸ªåªè¯»çš„å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜ï¼Œå€¼ä¸å¯ä»¥æ”¹å˜ï¼Œæ”¹å˜ä¼šæŠ¥é”™ï¼›åªå£°æ˜ä¸èµ‹å€¼ä¹Ÿä¼šæŠ¥é”™// å¸¸é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä¸å¯ä»¥å˜åŒ–çš„å˜é‡ã€‚// module.exports = &#123; entry:'./src/./js/main.js', // æŒ‡å®šå…¥å£æ–‡ä»¶ output:&#123; path: path.resolve(__dirname, './dist/js'), // æŒ‡å®šå‡ºå£æ–‡ä»¶çš„è·¯å¾„ç›®å½• filename: 'bulid.js' // åˆ¶å®šå‡ºå£æ–‡ä»¶çš„åç§° &#125;, module:&#123; rules:[ // åœ¨webpack2ä¸­ï¼Œloaders è¢«æ›¿æ¢æˆäº† rules å…¶å®å°±æ˜¯loaderçš„è§„åˆ™ // å®ç° css æ‰“åŒ… &#123; test: /\.css\$/, use: [ 'style-loader', 'css-loader' ] // test è¯´æ˜äº†å½“å‰ loader èƒ½å¤„ç†é‚£äº›ç±»å‹çš„æ–‡ä»¶ // use åˆ™æŒ‡å®šäº† loader çš„ç±»å‹ã€‚ // æ³¨æ„ï¼šæ•°ç»„ä¸­çš„loaderä¸èƒ½çœç•¥æ‰©å±•å &#125;, &#123; test: /\.scss$/, // æ³¨æ„ æ˜¯sass-loader ï¼Œä¸æ˜¯ scss-loader use: [ 'style-loader', 'css-loader', 'sass-loader' ] &#125; ] &#125; åœ¨jsç›®å½•ä¸­ main.jsé‡Œé¢å¼•å…¥ scss1.scss 1234567891011121314151617// 1ã€è·å–index.htmlä¸­çš„domå¯¹è±¡var first = document.getElementById('first');var btn = document.getElementById('btn');var two = document.getElementById('two');var res = document.getElementById('res');btn.onclick = function()&#123; var firstValue = parseFloat(first.value); var twoValue = parseFloat(two.value); //2ã€è·å– module1.jsä¸­çš„ sumå‡½æ•° //http://www.ruanyifeng.com/blog/2015/05/require.html var sum = require('./module1.js'); res.value = sum(firstValue,twoValue);&#125;// 3ã€è·å–cssç›®å½•ä¸­çš„main.cssæ–‡ä»¶require('../css/main.css');// 4ã€è·å–sassç›®å½•ä¸­çš„scss1.scssæ–‡ä»¶require('../sass/scss1.scss'); åœ¨ç»ˆç«¯ä¸­è¾“å…¥ webpackå‘½ä»¤è¿›è¡Œscssæ–‡ä»¶æ‰“åŒ… 6ã€å®ç°æ‰“åŒ…urlèµ„æºï¼ˆå›¾ç‰‡ã€gifã€å›¾æ ‡ç­‰ï¼‰åŠŸèƒ½åœ¨src ç›®å½•ä¸­ æ–°å»ºimgsç›®å½•ï¼Œæ”¾å…¥ä¸¤å¼ ä¸åŒå¤§å°çš„å›¾ç‰‡ åœ¨index.htmlä¸­æ–°å¢ &lt; div id=â€bg1â€ &gt;&lt; /div &gt; &lt; div id=â€bg2â€ &gt;&lt; /div &gt; åœ¨mian.cssä¸­æ–°å¢ // mian.cssæ–‡ä»¶ 12345#bg1&#123; width: 200px; height: 200px; background: url('../imgs/bxg.jpg');&#125; 12345#bg2&#123; width: 200px; height: 200px; background: url('../imgs/web.jpg') no-repeat;&#125; å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨é¡µé¢å¼•å…¥å›¾ç‰‡ï¼ˆåŒ…æ‹¬imgçš„srcå’Œbackgroundçš„urlï¼‰ã€‚å½“æˆ‘ä»¬åŸºäºwebpackè¿›è¡Œå¼€å‘æ—¶ï¼Œå¼•å…¥å›¾ç‰‡ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚ å…¶ä¸­ä¸€ä¸ªå°±æ˜¯å¼•ç”¨è·¯å¾„çš„é—®é¢˜ã€‚æ‹¿backgroundæ ·å¼ç”¨urlå¼•å…¥èƒŒæ™¯å›¾æ¥è¯´ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œwebpackæœ€ç»ˆä¼šå°†å„ä¸ªæ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬æ ·å¼ä¸­çš„urlè·¯å¾„æ˜¯ç›¸å¯¹å…¥å£htmlé¡µé¢çš„ï¼Œè€Œä¸æ˜¯ç›¸å¯¹äºåŸå§‹cssæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„çš„ã€‚è¿™å°±ä¼šå¯¼è‡´å›¾ç‰‡å¼•å…¥å¤±è´¥ã€‚è¿™ä¸ªé—®é¢˜æ˜¯ç”¨file-loaderè§£å†³çš„ï¼Œfile-loaderå¯ä»¥è§£æé¡¹ç›®ä¸­çš„urlå¼•å…¥ï¼ˆä¸ä»…é™äºcssï¼‰ï¼Œæ ¹æ®æˆ‘ä»¬çš„é…ç½®ï¼Œå°†å›¾ç‰‡æ‹·è´åˆ°ç›¸åº”çš„è·¯å¾„ï¼Œå†æ ¹æ®æˆ‘ä»¬çš„é…ç½®ï¼Œä¿®æ”¹æ‰“åŒ…åæ–‡ä»¶å¼•ç”¨è·¯å¾„ï¼Œä½¿ä¹‹æŒ‡å‘æ­£ç¡®çš„æ–‡ä»¶ã€‚ å¦å¤–ï¼Œå¦‚æœå›¾ç‰‡è¾ƒå¤šï¼Œä¼šå‘å¾ˆå¤šhttpè¯·æ±‚ï¼Œä¼šé™ä½é¡µé¢æ€§èƒ½ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡url-loaderè§£å†³ã€‚url-loaderä¼šå°†å¼•å…¥çš„å›¾ç‰‡ç¼–ç ï¼Œç”ŸæˆdataURlã€‚ç›¸å½“äºæŠŠå›¾ç‰‡æ•°æ®ç¿»è¯‘æˆä¸€ä¸²å­—ç¬¦ã€‚å†æŠŠè¿™ä¸²å­—ç¬¦æ‰“åŒ…åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆåªéœ€è¦å¼•å…¥è¿™ä¸ªæ–‡ä»¶å°±èƒ½è®¿é—®å›¾ç‰‡äº†ã€‚å½“ç„¶ï¼Œå¦‚æœå›¾ç‰‡è¾ƒå¤§ï¼Œç¼–ç ä¼šæ¶ˆè€—æ€§èƒ½ã€‚å› æ­¤url-loaderæä¾›äº†ä¸€ä¸ªlimitå‚æ•°ï¼Œå°äºlimitå­—èŠ‚çš„æ–‡ä»¶ä¼šè¢«è½¬ä¸ºDataURlï¼Œå¤§äºlimitçš„è¿˜ä¼šä½¿ç”¨file-loaderè¿›è¡Œcopyã€‚ url-loaderå’Œfile-loaderæ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿç®€ç­”åœ°è¯´ï¼Œurl-loaderå°è£…äº†file-loaderã€‚url-loaderä¸ä¾èµ–äºfile-loaderï¼Œå³ä½¿ç”¨url-loaderæ—¶ï¼Œåªéœ€è¦å®‰è£…url-loaderå³å¯ï¼Œä¸éœ€è¦å®‰è£…file-loaderï¼Œå› ä¸ºurl-loaderå†…ç½®äº†file-loaderã€‚é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œurl-loaderå·¥ä½œåˆ†ä¸¤ç§æƒ…å†µï¼š1.æ–‡ä»¶å¤§å°å°äºlimitå‚æ•°ï¼Œurl-loaderå°†ä¼šæŠŠæ–‡ä»¶è½¬ä¸ºDataURLï¼›2.æ–‡ä»¶å¤§å°å¤§äºlimitï¼Œurl-loaderä¼šè°ƒç”¨file-loaderè¿›è¡Œå¤„ç†ï¼Œå‚æ•°ä¹Ÿä¼šç›´æ¥ä¼ ç»™file-loaderã€‚å› æ­¤æˆ‘ä»¬åªéœ€è¦å®‰è£…url-loaderå³å¯ã€‚ å®‰è£… 1cnpm install url-loader file-loader --save-dev åœ¨webpack.config.jsä¸­é…ç½®ç›¸å…³çš„loader 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556const path = require('path'); // é¦–å…ˆè¦å¼•å…¥node.jsä¸­path æ¨¡å—ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸ç›®å½•çš„è·¯å¾„// const å‘½ä»¤å£°æ˜ä¸€ä¸ªåªè¯»çš„å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜ï¼Œå€¼ä¸å¯ä»¥æ”¹å˜ï¼Œæ”¹å˜ä¼šæŠ¥é”™ï¼›åªå£°æ˜ä¸èµ‹å€¼ä¹Ÿä¼šæŠ¥é”™// å¸¸é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä¸å¯ä»¥å˜åŒ–çš„å˜é‡ã€‚// module.exports = &#123; entry:'./src/./js/main.js', // æŒ‡å®šå…¥å£æ–‡ä»¶ output:&#123; path: path.resolve(__dirname, './dist/js'), // æŒ‡å®šå‡ºå£æ–‡ä»¶çš„è·¯å¾„ç›®å½• filename: 'bulid.js' // åˆ¶å®šå‡ºå£æ–‡ä»¶çš„åç§° publicPath:'dist/' // path:æ‰€æœ‰è¾“å‡ºæ–‡ä»¶çš„ç›®æ ‡è·¯å¾„; // publicPath:è¾“å‡ºè§£ææ–‡ä»¶çš„ç›®å½•ï¼Œurl ç›¸å¯¹äº HTML é¡µé¢ &#125;, module:&#123; rules:[ // åœ¨webpack2ä¸­ï¼Œloaders è¢«æ›¿æ¢æˆäº† rules å…¶å®å°±æ˜¯loaderçš„è§„åˆ™ // å®ç° css æ‰“åŒ… &#123; test: /\.css\$/, use: [ 'style-loader', 'css-loader' ] // test è¯´æ˜äº†å½“å‰ loader èƒ½å¤„ç†é‚£äº›ç±»å‹çš„æ–‡ä»¶ // use åˆ™æŒ‡å®šäº† loader çš„ç±»å‹ã€‚ // æ³¨æ„ï¼šæ•°ç»„ä¸­çš„loaderä¸èƒ½çœç•¥æ‰©å±•å &#125;, // å®ç° scss æ‰“åŒ… &#123; test: /\.scss\$/, // æ³¨æ„ æ˜¯sass-loader ï¼Œä¸æ˜¯ scss-loader use: [ 'style-loader', 'css-loader', 'sass-loader' ] &#125;, // å®ç° less æ‰“åŒ… &#123; test: /\.less\$/, use: [ 'style-loader', 'css-loader', 'less-loader' ] &#125;, // å®ç° url èµ„æºæ‰“åŒ… &#123; // å›¾ç‰‡å’Œå­—ä½“æ–‡ä»¶ä½¿ç”¨ url-loader æ¥å¤„ç† test: /\.(png|jpg|gif|ttf|eot|woff|woff2|svg)$/, use: [ &#123; loader: 'url-loader', // options ä¸ºå¯ä»¥é…ç½®çš„é€‰é¡¹ options: &#123; limit: 8192 // limit=8192è¡¨ç¤ºå°†æ‰€æœ‰å°äº8kbçš„å›¾ç‰‡éƒ½è½¬ä¸ºbase64å½¢å¼ï¼ˆä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä¸€ä¸ªå¾ˆå°çš„å›¾ç‰‡ï¼Œä¸å€¼å½“çš„å»å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå‡å°‘è¯·æ±‚æ¬¡æ•°; å…¶å®åº”è¯¥è¯´è¶…è¿‡8kbçš„æ‰ä½¿ç”¨ url-loader æ¥æ˜ å°„åˆ°æ–‡ä»¶ï¼Œå¦åˆ™è½¬ä¸ºdataurlå½¢å¼ï¼‰ &#125; &#125; ] //ä¿è¯è¾“å‡ºçš„å›¾ç‰‡åç§°ä¸ä¹‹å‰å‘½åçš„å›¾ç‰‡åç§°ä¿æŒä¸€è‡´(ç›®å‰åªæ˜¯æ”¯æŒè¿™æ ·çš„å†™æ³•ï¼Œwebpack3 æ²¡æœ‰å“åº”çš„optionsè¿›è¡Œé…ç½®) // use:'url-loader?limit=8192&amp;name=imgs/[name].[ext]' &#125; ] &#125;&#125; åœ¨main.jsä¸­å¼•å…¥muiç›®å½•ä¸­icons-extra.cssçš„æ–‡ä»¶ 12// 6ã€è·å–srcç›®å½•ä¸­çš„muiç›®å½•ä¸­icons-extra.cssçš„æ–‡ä»¶require('../mui/css/icons-extra.css'); 7ã€Webpack-dev-serverç»“åˆåç«¯æœåŠ¡å™¨çš„çƒ­æ›¿æ¢é…ç½®webpack-dev-serveræä¾›äº†ä¸€ä¸ªç®€å•çš„ web æœåŠ¡å™¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿå®æ—¶é‡æ–°åŠ è½½(live reloading)ï¼ŒåŒæ—¶æŠŠç”Ÿæˆå¥½çš„jså’Œhtmlæ„å»ºåˆ°æˆ‘ä»¬çš„ç”µè„‘å†…å­˜ä¸­ï¼Œè¿™æ ·çš„è¯ï¼Œå³ä½¿æˆ‘ä»¬çš„ç›®å½•ä¸­æ²¡æœ‰äº†ç›¸å…³jsç­‰æ–‡ä»¶ï¼Œè¿˜èƒ½å¤ŸåŠ è½½å‡ºæ¥ï¼Œè¿™æ ·èƒ½å¤Ÿæé«˜æˆ‘ä»¬é¡µé¢è¿è¡Œé€Ÿåº¦ã€‚ å®‰è£… webpack-dev-server æ’ä»¶ 1cnpm install webpack-dev-server --save-dev 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263// webpack.config.js const path = require('path'); // é¦–å…ˆè¦å¼•å…¥node.jsä¸­path æ¨¡å—ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸ç›®å½•çš„è·¯å¾„ // const å‘½ä»¤å£°æ˜ä¸€ä¸ªåªè¯»çš„å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜ï¼Œå€¼ä¸å¯ä»¥æ”¹å˜ï¼Œæ”¹å˜ä¼šæŠ¥é”™ï¼›åªå£°æ˜ä¸èµ‹å€¼ä¹Ÿä¼šæŠ¥é”™ // å¸¸é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä¸å¯ä»¥å˜åŒ–çš„å˜é‡ã€‚ module.exports = &#123; entry:'./src/./js/main.js', // æŒ‡å®šå…¥å£æ–‡ä»¶ output:&#123; path: path.resolve(__dirname, 'dist/js'), // æŒ‡å®šå‡ºå£æ–‡ä»¶çš„è·¯å¾„ç›®å½• filename: 'bulid.js' // åˆ¶å®šå‡ºå£æ–‡ä»¶çš„åç§° &#125;, module:&#123; rules:[ // åœ¨webpack2ä¸­ï¼Œloaders è¢«æ›¿æ¢æˆäº† rules å…¶å®å°±æ˜¯loaderçš„è§„åˆ™ // å®ç° css æ‰“åŒ… &#123; test: /\.css$/, use: [ 'style-loader', 'css-loader' ] // test è¯´æ˜äº†å½“å‰ loader èƒ½å¤„ç†é‚£äº›ç±»å‹çš„æ–‡ä»¶ // use åˆ™æŒ‡å®šäº† loader çš„ç±»å‹ã€‚ // æ³¨æ„ï¼šæ•°ç»„ä¸­çš„loaderä¸èƒ½çœç•¥æ‰©å±•å &#125;, // å®ç° scss æ‰“åŒ… &#123; test: /\.scss$/, // æ³¨æ„ æ˜¯sass-loader ï¼Œä¸æ˜¯ scss-loader use: [ 'style-loader', 'css-loader', 'sass-loader' ] &#125;, // å®ç° less æ‰“åŒ… &#123; test: /\.less$/, use: [ 'style-loader', 'css-loader', 'less-loader' ] &#125;, // å®ç° url èµ„æºæ‰“åŒ… &#123; // å›¾ç‰‡æ–‡ä»¶ä½¿ç”¨ url-loader æ¥å¤„ç† test: /\.(png|jpg|gif|ttf)$/, use: [ &#123; loader: 'url-loader', // options ä¸ºå¯ä»¥é…ç½®çš„é€‰é¡¹ options: &#123; limit: 8192 // limit=8192è¡¨ç¤ºå°†æ‰€æœ‰å°äº8kbçš„å›¾ç‰‡éƒ½è½¬ä¸ºbase64å½¢å¼ // ï¼ˆå…¶å®åº”è¯¥è¯´è¶…è¿‡8kbçš„æ‰ä½¿ç”¨ url-loader æ¥æ˜ å°„åˆ°æ–‡ä»¶ï¼Œå¦åˆ™è½¬ä¸ºdata urlå½¢å¼ï¼‰ &#125; &#125; ] &#125; ] &#125;, devServer: &#123; // contentBase: './dist', // åœ¨ localhost:8080(é»˜è®¤) ä¸‹å»ºç«‹æœåŠ¡ï¼Œå°† dist ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä½œä¸ºå¯è®¿é—®æ–‡ä»¶contentBaseï¼šå‘Šè¯‰æœåŠ¡å™¨ä»å“ªé‡Œæä¾›å†…å®¹ // æˆ–è€…é€šè¿‡ä»¥ä¸‹æ–¹å¼é…ç½® contentBase: path.join(__dirname, "dist"), compress: true, // å½“å®ƒè¢«è®¾ç½®ä¸ºtrueçš„æ—¶å€™å¯¹æ‰€æœ‰çš„æœåŠ¡å™¨èµ„æºé‡‡ç”¨gzipå‹ç¼© // å¯¹JSï¼ŒCSSèµ„æºçš„å‹ç¼©ç‡å¾ˆé«˜ï¼Œå¯ä»¥æå¤§å¾—æé«˜æ–‡ä»¶ä¼ è¾“çš„é€Ÿç‡ï¼Œä»è€Œæå‡webæ€§èƒ½ port: 9000, // å¦‚æœæƒ³è¦æ”¹ç«¯å£ï¼Œå¯ä»¥é€šè¿‡ portæ›´æ”¹ hot: true, // å¯ç”¨ webpack çš„æ¨¡å—çƒ­æ›¿æ¢ç‰¹æ€§() inline: true, // å®ç°å®æ—¶é‡è½½ï¼ˆå®ç°è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ï¼‰é»˜è®¤æƒ…å†µä¸‹æ˜¯ trueã€‚ host: "localhost" // å¦‚æœä½ å¸Œæœ›æœåŠ¡å™¨å¤–éƒ¨å¯è®¿é—®ï¼ŒæŒ‡å®šä½¿ç”¨ä¸€ä¸ª hostã€‚é»˜è®¤æ˜¯ localhost(ä¹Ÿå°±æ˜¯ä½ å¯ä»¥ä¸å†™è¿™ä¸ªhostè¿™ä¸ªé…ç½®å±æ€§)ã€‚ &#125;&#125; 123456789101112131415161718192021222324252627// package.json&#123; "name": "mywebpack", "version": "1.0.0", "description": "", "main": "webpack.config.js", "scripts": &#123; "test": "echo \"Error: no test specified\" &amp;&amp; exit 1", "start": "webpack-dev-server --open" // "start": "webpack-dev-server --open --port 8080 --hot --inline" // å¦‚æœåœ¨è¿™é‡Œé…ç½®äº†ï¼Œå°±ä¸ç”¨åœ¨webpack.config.jsä¸­é…ç½®devServerå±æ€§äº†ã€‚ &#125;, "author": "", "license": "ISC", "devDependencies": &#123; "css-loader": "^0.28.7", "file-loader": "^1.1.5", "html-webpack-plugin": "^2.30.1", "less": "^3.0.0-alpha.3", "less-loader": "^4.0.5", "node-sass": "^4.5.3", "sass-loader": "^6.0.6", "style-loader": "^0.19.0", "url-loader": "^0.6.2", "webpack": "^3.8.1", "webpack-dev-server": "^2.9.3" &#125;&#125; åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ npm startï¼Œå°±ä¼šçœ‹åˆ°æµè§ˆå™¨è‡ªåŠ¨åŠ è½½é¡µé¢ã€‚å¦‚æœç°åœ¨ä¿®æ”¹å’Œä¿å­˜ä»»æ„æºæ–‡ä»¶ï¼Œweb æœåŠ¡å™¨å°±ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½ç¼–è¯‘åçš„ä»£ç ï¼Œä½†æ˜¯æ‰“å¼€åå‘ç°ï¼Œæ‰“å¼€çš„æ˜¯ distç›®å½•ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯ index.htmlæ˜¾ç¤ºæˆ‘ä»¬çš„é¡µé¢ï¼Œæ‰€ä»¥è¿™æ˜¯æˆ‘ä»¬è¿˜è¦å€ŸåŠ©é‡Œå¦ä¸€ä¸ª html-webpack-plugin æ’ä»¶ã€‚ 8ã€html-webpack-plugin æ’ä»¶å®‰è£…html-webpack-plugin ç®€å•åˆ›å»º HTML æ–‡ä»¶ï¼Œç”¨äºæœåŠ¡å™¨è®¿é—®ï¼Œå…¶ä¸­åŒ…æ‹¬ä½¿ç”¨scriptæ ‡ç­¾çš„bodyä¸­çš„æ‰€æœ‰webpackåŒ…ã€‚ å®‰è£… html-webpack-plugin æ’ä»¶ 1cnpm install --save-dev html-webpack-plugin webpack.config.jsé…ç½® 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071// webpack.config.js const path = require('path'); // é¦–å…ˆè¦å¼•å…¥node.jsä¸­path æ¨¡å—ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸ç›®å½•çš„è·¯å¾„ // const å‘½ä»¤å£°æ˜ä¸€ä¸ªåªè¯»çš„å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜ï¼Œå€¼ä¸å¯ä»¥æ”¹å˜ï¼Œæ”¹å˜ä¼šæŠ¥é”™ï¼›åªå£°æ˜ä¸èµ‹å€¼ä¹Ÿä¼šæŠ¥é”™ // å¸¸é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä¸å¯ä»¥å˜åŒ–çš„å˜é‡ã€‚ module.exports = &#123; entry:'./src/./js/main.js', // æŒ‡å®šå…¥å£æ–‡ä»¶ output:&#123; path: path.resolve(__dirname, 'dist/js'), // æŒ‡å®šå‡ºå£æ–‡ä»¶çš„è·¯å¾„ç›®å½• filename: 'bulid.js' // åˆ¶å®šå‡ºå£æ–‡ä»¶çš„åç§° &#125;, module:&#123; rules:[ // åœ¨webpack2ä¸­ï¼Œloaders è¢«æ›¿æ¢æˆäº† rules å…¶å®å°±æ˜¯loaderçš„è§„åˆ™ // å®ç° css æ‰“åŒ… &#123; test: /\.css$/, use: [ 'style-loader', 'css-loader' ] // test è¯´æ˜äº†å½“å‰ loader èƒ½å¤„ç†é‚£äº›ç±»å‹çš„æ–‡ä»¶ // use åˆ™æŒ‡å®šäº† loader çš„ç±»å‹ã€‚ // æ³¨æ„ï¼šæ•°ç»„ä¸­çš„loaderä¸èƒ½çœç•¥æ‰©å±•å &#125;, // å®ç° scss æ‰“åŒ… &#123; test: /\.scss$/, // æ³¨æ„ æ˜¯sass-loader ï¼Œä¸æ˜¯ scss-loader use: [ 'style-loader', 'css-loader', 'sass-loader' ] &#125;, // å®ç° less æ‰“åŒ… &#123; test: /\.less$/, use: [ 'style-loader', 'css-loader', 'less-loader' ] &#125;, // å®ç° url èµ„æºæ‰“åŒ… &#123; // å›¾ç‰‡æ–‡ä»¶ä½¿ç”¨ url-loader æ¥å¤„ç† test: /\.(png|jpg|gif|ttf)$/, use: [ &#123; loader: 'url-loader', // options ä¸ºå¯ä»¥é…ç½®çš„é€‰é¡¹ options: &#123; limit: 8192 // limit=8192è¡¨ç¤ºå°†æ‰€æœ‰å°äº8kbçš„å›¾ç‰‡éƒ½è½¬ä¸ºbase64å½¢å¼ // ï¼ˆå…¶å®åº”è¯¥è¯´è¶…è¿‡8kbçš„æ‰ä½¿ç”¨ url-loader æ¥æ˜ å°„åˆ°æ–‡ä»¶ï¼Œå¦åˆ™è½¬ä¸ºdata urlå½¢å¼ï¼‰ &#125; &#125; ] &#125; ] &#125;, devServer: &#123; // contentBase: './dist', // åœ¨ localhost:8080(é»˜è®¤) ä¸‹å»ºç«‹æœåŠ¡ï¼Œå°† dist ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä½œä¸ºå¯è®¿é—®æ–‡ä»¶contentBaseï¼šå‘Šè¯‰æœåŠ¡å™¨ä»å“ªé‡Œæä¾›å†…å®¹ // æˆ–è€…é€šè¿‡ä»¥ä¸‹æ–¹å¼é…ç½® contentBase: path.join(__dirname, "dist"), compress: true, // å½“å®ƒè¢«è®¾ç½®ä¸ºtrueçš„æ—¶å€™å¯¹æ‰€æœ‰çš„æœåŠ¡å™¨èµ„æºé‡‡ç”¨gzipå‹ç¼© // å¯¹JSï¼ŒCSSèµ„æºçš„å‹ç¼©ç‡å¾ˆé«˜ï¼Œå¯ä»¥æå¤§å¾—æé«˜æ–‡ä»¶ä¼ è¾“çš„é€Ÿç‡ï¼Œä»è€Œæå‡webæ€§èƒ½ port: 9000, // å¦‚æœæƒ³è¦æ”¹ç«¯å£ï¼Œå¯ä»¥é€šè¿‡ portæ›´æ”¹ hot: true, // å¯ç”¨ webpack çš„æ¨¡å—çƒ­æ›¿æ¢ç‰¹æ€§() inline: true, // å®ç°å®æ—¶é‡è½½ï¼ˆå®ç°è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ï¼‰é»˜è®¤æƒ…å†µä¸‹æ˜¯ trueã€‚ host: "localhost" // å¦‚æœä½ å¸Œæœ›æœåŠ¡å™¨å¤–éƒ¨å¯è®¿é—®ï¼ŒæŒ‡å®šä½¿ç”¨ä¸€ä¸ª hostã€‚é»˜è®¤æ˜¯ localhost(ä¹Ÿå°±æ˜¯ä½ å¯ä»¥ä¸å†™è¿™ä¸ªhostè¿™ä¸ªé…ç½®å±æ€§)ã€‚ &#125; plugins: [ new HtmlWebpackPlugin(&#123; title: 'é¦–é¡µ', // ç”¨äºç”Ÿæˆçš„HTMLæ–‡æ¡£çš„æ ‡é¢˜ filename: 'index.html', //å†™å…¥HTMLçš„æ–‡ä»¶ã€‚é»˜è®¤ä¸ºindex.htmlã€‚ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå­ç›®å½•ï¼ˆä¾‹å¦‚ï¼šï¼‰assets/admin.html template: 'index.html' // Webpackéœ€è¦æ¨¡æ¿çš„è·¯å¾„ &#125;), new webpack.HotModuleReplacementPlugin() // éœ€è¦ç»“åˆ å¯ç”¨çƒ­æ›¿æ¢æ¨¡å—(Hot Module Replacement)ï¼Œä¹Ÿè¢«ç§°ä¸º HMR ]&#125; å†æ¬¡ä½¿ç”¨npm startå‘½ä»¤å°±å¯ä»¥å®ç°æµè§ˆå™¨è‡ªåŠ¨æ›´æ–°ã€‚ é—®é¢˜æ¥äº†ï¼ŒHtmlWebpackPluginä¸­çš„ titleå¹¶æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼ŒåŸå› æ˜¯éœ€è¦åœ¨å®šä¹‰çš„templateæ¨¡æ¿ä¸­ä½¿ç”¨ejsè¯­æ³•ï¼Œ 123456789101112131415161718192021&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt; &lt;!-- EJS è¯­æ³• /* EJSæ˜¯ä¸€ä¸ªç®€å•é«˜æ•ˆçš„æ¨¡æ¿è¯­è¨€ï¼Œé€šè¿‡æ•°æ®å’Œæ¨¡æ¿ï¼Œå¯ä»¥ç”ŸæˆHTMLæ ‡è®°æ–‡æœ¬ã€‚å¯ä»¥è¯´EJSæ˜¯ä¸€ä¸ªJavaScriptåº“ï¼ŒEJSå¯ä»¥åŒæ—¶è¿è¡Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯å®‰è£…ç›´æ¥å¼•å…¥æ–‡ä»¶å³å¯ */ --&gt; &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title%&gt;&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;input type="text" id="first"&gt; &lt;input type="button" id="btn" value="+"&gt; &lt;input type="text" id="two"&gt; &lt;input type="button" id="btn" value="="&gt; &lt;input type="text" id="res"&gt; &lt;div id="bg1"&gt;&lt;/div&gt; &lt;div id="bg2"&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; 9ã€ES6è½¬æ¢ä¸ºES5è¯­æ³•å®‰è£… 1cnpm install --save-dev babel-loader babel-core babel-preset-env babel-core å¦‚æœæŸäº›ä»£ç éœ€è¦è°ƒç”¨Babelçš„APIè¿›è¡Œè½¬ç ï¼Œå°±è¦ä½¿ç”¨babel-coreæ¨¡å—babel-preset-env é€šè¿‡æ ¹æ®æ‚¨çš„ç›®æ ‡æµè§ˆå™¨æˆ–è¿è¡Œæ—¶ç¯å¢ƒè‡ªåŠ¨ç¡®å®šæ‚¨éœ€è¦çš„Babelæ’ä»¶babel å¯¹ä¸€äº›å…¬å…±æ–¹æ³•ä½¿ç”¨äº†éå¸¸å°çš„è¾…åŠ©ä»£ç ï¼Œæ¯”å¦‚ _extendã€‚ é»˜è®¤æƒ…å†µä¸‹ä¼šè¢«æ·»åŠ åˆ°æ¯ä¸€ä¸ªéœ€è¦å®ƒçš„æ–‡ä»¶ä¸­,ä½ å¯ä»¥å¼•å…¥ babel runtime ä½œä¸ºä¸€ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œæ¥é¿å…é‡å¤å¼•å…¥ã€‚ ä½ å¿…é¡»æ‰§è¡Œ npm install babel-plugin-transform-runtime â€“save-dev æ¥æŠŠå®ƒåŒ…å«åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œä¹Ÿè¦ä½¿ç”¨ npm install babel-runtime â€“save æŠŠ babel-runtime å®‰è£…ä¸ºä¸€ä¸ªä¾èµ– é…ç½® 1234567891011121314151617181920212223242526// å®ç° url èµ„æºæ‰“åŒ… &#123; // å›¾ç‰‡æ–‡ä»¶ä½¿ç”¨ url-loader æ¥å¤„ç† test: /\.(png|jpg|gif|ttf)$/, use: [&#123; loader: 'url-loader', // options ä¸ºå¯ä»¥é…ç½®çš„é€‰é¡¹ options: &#123; limit: 8192 // limit=8192è¡¨ç¤ºå°†æ‰€æœ‰å°äº8kbçš„å›¾ç‰‡éƒ½è½¬ä¸ºbase64å½¢å¼ // ï¼ˆå…¶å®åº”è¯¥è¯´è¶…è¿‡8kbçš„æ‰ä½¿ç”¨ url-loader æ¥æ˜ å°„åˆ°æ–‡ä»¶ï¼Œå¦åˆ™è½¬ä¸ºdata urlå½¢å¼ï¼‰ &#125; &#125;] &#125;, // å®ç° ES6è½¬ ES5 &#123; test: /\.js$/, exclude: /(node_modules)/, // exclude æ’é™¤çš„æ„æ€ï¼ŒæŠŠ node_modulesæ–‡ä»¶å¤¹æ’é™¤ç¼–è¯‘ä¹‹å¤– use: &#123; loader: 'babel-loader', options: &#123; // presets é¢„è®¾åˆ—è¡¨ï¼ˆä¸€ç»„æ’ä»¶ï¼‰åŠ è½½å’Œä½¿ç”¨ presets: ['env'], plugins: ['transform-runtime'] // åŠ è½½å’Œä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨ &#125; &#125; &#125; æŠŠä¸€äº›ä»£ç æ”¹æˆES6 è¯­æ³•çš„å†™æ³• 1234567891011// moudule1.jsfunction sum(x,y)&#123; return x + y;&#125;// å¯¼å‡º sum å‡½æ•°// module.exports = sum;// æ”¹æˆES6 çš„å†™æ³•è¯­æ³•export default&#123; sum&#125; 12345678910111213141516171819202122232425262728293031323334353637// main.js// 1ã€è·å–index.htmlä¸­çš„domå¯¹è±¡var first = document.getElementById('first');var btn1 = document.getElementById('btn1');var two = document.getElementById('two');var res = document.getElementById('res');console.log(1);btn1.onclick = function() &#123; var firstValue = parseFloat(first.value); var twoValue = parseFloat(two.value); //2ã€è·å– module1.jsä¸­çš„ sumå‡½æ•° //http://www.ruanyifeng.com/blog/2015/05/require.html console.log(2); /* var sum = require('./module1.js'); res.value = sum(firstValue,twoValue);*/ res.value = sumObj.sum(firstValue, twoValue);&#125;// 3ã€è·å–cssç›®å½•ä¸­çš„main.cssæ–‡ä»¶// require('../css/main.css');// æŠŠæ­¥éª¤3 æ”¹ä¸º ES6å†™æ³•,å¼•å…¥cssç›®å½•ä¸­çš„main.cssæ–‡ä»¶import '../css/main.css';// 4ã€è·å–sassç›®å½•ä¸­çš„scss1.scssæ–‡ä»¶require('../sass/scss1.scss');// 5ã€è·å–lessç›®å½•ä¸­çš„less1.lessæ–‡ä»¶require('../less/less1.less');// 6ã€è·å–srcç›®å½•ä¸­çš„muiç›®å½•ä¸­icons-extra.cssçš„æ–‡ä»¶require('../mui/css/icons-extra.css');// æŠŠ var sum = require('./module1.js'); å†™æˆ ES6è¯­æ³•import sumObj from './module1.js' 10ã€é˜²æ­¢æ–‡ä»¶ç¼“å­˜ï¼ˆç”Ÿæˆå¸¦æœ‰20ä½çš„hashå€¼çš„å”¯ä¸€æ–‡ä»¶ï¼‰1234567// webpack.config.jsoutput: &#123; path: path.resolve(__dirname, 'dist/js'), // æŒ‡å®šå‡ºå£æ–‡ä»¶çš„è·¯å¾„ç›®å½• // filename: 'bulid.js' // åˆ¶å®šå‡ºå£æ–‡ä»¶çš„åç§° filename: '[name].[hash].js' // å°†å…¥å£æ–‡ä»¶é‡å‘½åä¸ºå¸¦æœ‰20ä½çš„hashå€¼çš„å”¯ä¸€æ–‡ä»¶ &#125; 11ã€æŠ½å–CSSä¸ºå•ç‹¬æ–‡ä»¶å®‰è£…æ’ä»¶ä» build.jsæ–‡ä»¶ä¸­æå–æ–‡æœ¬ï¼ˆCSSï¼‰åˆ°å•ç‹¬çš„æ–‡ä»¶ 1npm install --save-dev extract-text-webpack-plugin 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778// webpack.config.js const path = require('path'); // é¦–å…ˆè¦å¼•å…¥node.jsä¸­path æ¨¡å—ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸ç›®å½•çš„è·¯å¾„ // const å‘½ä»¤å£°æ˜ä¸€ä¸ªåªè¯»çš„å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜ï¼Œå€¼ä¸å¯ä»¥æ”¹å˜ï¼Œæ”¹å˜ä¼šæŠ¥é”™ï¼›åªå£°æ˜ä¸èµ‹å€¼ä¹Ÿä¼šæŠ¥é”™ // å¸¸é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä¸å¯ä»¥å˜åŒ–çš„å˜é‡ã€‚ module.exports = &#123; entry:'./src/./js/main.js', // æŒ‡å®šå…¥å£æ–‡ä»¶ output:&#123; path: path.resolve(__dirname, 'dist/js'), // æŒ‡å®šå‡ºå£æ–‡ä»¶çš„è·¯å¾„ç›®å½• filename: 'bulid.js' // åˆ¶å®šå‡ºå£æ–‡ä»¶çš„åç§° &#125;, module:&#123; rules:[ // åœ¨webpack2ä¸­ï¼Œloaders è¢«æ›¿æ¢æˆäº† rules å…¶å®å°±æ˜¯loaderçš„è§„åˆ™ // å®ç° css æ‰“åŒ… &#123; test: /\.css$/, use: [ 'style-loader', 'css-loader' ] // test è¯´æ˜äº†å½“å‰ loader èƒ½å¤„ç†é‚£äº›ç±»å‹çš„æ–‡ä»¶ // use åˆ™æŒ‡å®šäº† loader çš„ç±»å‹ã€‚ // æ³¨æ„ï¼šæ•°ç»„ä¸­çš„loaderä¸èƒ½çœç•¥æ‰©å±•å &#125;, // å®ç° scss æ‰“åŒ… &#123; test: /\.scss$/, // æ³¨æ„ æ˜¯sass-loader ï¼Œä¸æ˜¯ scss-loader use: [ 'style-loader', 'css-loader', 'sass-loader' ] &#125;, // å®ç° less æ‰“åŒ… &#123; test: /\.less$/, use: [ 'style-loader', 'css-loader', 'less-loader' ] &#125;, // å®ç° url èµ„æºæ‰“åŒ… &#123; // å›¾ç‰‡æ–‡ä»¶ä½¿ç”¨ url-loader æ¥å¤„ç† test: /\.(png|jpg|gif|ttf)$/, use: [ &#123; loader: 'url-loader', // options ä¸ºå¯ä»¥é…ç½®çš„é€‰é¡¹ options: &#123; limit: 8192 // limit=8192è¡¨ç¤ºå°†æ‰€æœ‰å°äº8kbçš„å›¾ç‰‡éƒ½è½¬ä¸ºbase64å½¢å¼ // ï¼ˆå…¶å®åº”è¯¥è¯´è¶…è¿‡8kbçš„æ‰ä½¿ç”¨ url-loader æ¥æ˜ å°„åˆ°æ–‡ä»¶ï¼Œå¦åˆ™è½¬ä¸ºdata urlå½¢å¼ï¼‰ &#125; &#125;, &#123; test: /\.css$/, use: ExtractTextPlugin.extract(&#123; fallback: "style-loader", use: "css-loader" &#125;) &#125; ] &#125; ] &#125;, devServer: &#123; // contentBase: './dist', // åœ¨ localhost:8080(é»˜è®¤) ä¸‹å»ºç«‹æœåŠ¡ï¼Œå°† dist ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä½œä¸ºå¯è®¿é—®æ–‡ä»¶contentBaseï¼šå‘Šè¯‰æœåŠ¡å™¨ä»å“ªé‡Œæä¾›å†…å®¹ // æˆ–è€…é€šè¿‡ä»¥ä¸‹æ–¹å¼é…ç½® contentBase: path.join(__dirname, "dist"), compress: true, // å½“å®ƒè¢«è®¾ç½®ä¸ºtrueçš„æ—¶å€™å¯¹æ‰€æœ‰çš„æœåŠ¡å™¨èµ„æºé‡‡ç”¨gzipå‹ç¼© // å¯¹JSï¼ŒCSSèµ„æºçš„å‹ç¼©ç‡å¾ˆé«˜ï¼Œå¯ä»¥æå¤§å¾—æé«˜æ–‡ä»¶ä¼ è¾“çš„é€Ÿç‡ï¼Œä»è€Œæå‡webæ€§èƒ½ port: 9000, // å¦‚æœæƒ³è¦æ”¹ç«¯å£ï¼Œå¯ä»¥é€šè¿‡ portæ›´æ”¹ hot: true, // å¯ç”¨ webpack çš„æ¨¡å—çƒ­æ›¿æ¢ç‰¹æ€§() inline: true, // å®ç°å®æ—¶é‡è½½ï¼ˆå®ç°è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ï¼‰é»˜è®¤æƒ…å†µä¸‹æ˜¯ trueã€‚ host: "localhost" // å¦‚æœä½ å¸Œæœ›æœåŠ¡å™¨å¤–éƒ¨å¯è®¿é—®ï¼ŒæŒ‡å®šä½¿ç”¨ä¸€ä¸ª hostã€‚é»˜è®¤æ˜¯ localhost(ä¹Ÿå°±æ˜¯ä½ å¯ä»¥ä¸å†™è¿™ä¸ªhostè¿™ä¸ªé…ç½®å±æ€§)ã€‚ &#125; plugins: [ new HtmlWebpackPlugin(&#123; title: 'é¦–é¡µ', // ç”¨äºç”Ÿæˆçš„HTMLæ–‡æ¡£çš„æ ‡é¢˜ filename: 'index.html', //å†™å…¥HTMLçš„æ–‡ä»¶ã€‚é»˜è®¤ä¸ºindex.htmlã€‚ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå­ç›®å½•ï¼ˆä¾‹å¦‚ï¼šï¼‰assets/admin.html template: 'index.html' // Webpackéœ€è¦æ¨¡æ¿çš„è·¯å¾„ &#125;), new webpack.HotModuleReplacementPlugin() // éœ€è¦ç»“åˆ å¯ç”¨çƒ­æ›¿æ¢æ¨¡å—(Hot Module Replacement)ï¼Œä¹Ÿè¢«ç§°ä¸º HMR ]&#125; 12ã€å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„åˆ†ç¦»ï¼ˆ1ï¼‰å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒåˆ†ç¦»çš„åŸå› å¦‚ä¸‹ï¼šåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çƒ­æ›´æ–°æ’ä»¶å¸®åŠ©æˆ‘ä»¬å®ç°æµè§ˆå™¨çš„è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ï¼Œæˆ‘ä»¬çš„ä»£ç æ²¡æœ‰è¿›è¡Œå‹ç¼©ï¼Œå¦‚æœå‹ç¼©äº†ä¸æ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•ä»£ç ç­‰ç­‰ï¼Œæ‰€ä»¥ä»¥ä¸Šè¿™äº›ä»£ç ä¸åº”å‡ºç°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æŠŠé¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬ä¼šå¯¹ä»£ç è¿›è¡Œå„ç§å„æ ·çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚å‹ç¼©ä»£ç ç­‰ç­‰ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¸åº”è¯¥æŠŠè¿™äº›ä»£ç æ”¾åˆ°å¼€å‘ç¯å¢ƒä¸­ï¼Œä¸åˆ©äºä»£ç å¼€å‘å’Œè°ƒè¯•ã€‚ æ€»ç»“ï¼šé’ˆå¯¹ä»¥ä¸Šè¿™äº›è¯´æ˜ï¼Œæˆ‘ä»¬å¾ˆæœ‰å¿…è¦æŠŠåŒºåˆ†å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒåˆ†ç¦»ã€‚ ï¼ˆ2ï¼‰å¼€å‘ç¯å¢ƒçš„é…ç½®å’Œç”Ÿäº§æ¢ç¯å¢ƒé…ç½®çš„åŒºåˆ«ã€‚å¼€å‘ç¯å¢ƒæœ‰çš„é…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒä¸ä¸€å®šæœ‰ï¼Œæ¯”å¦‚è¯´çƒ­æ›´æ–°æ—¶ä½¿ç”¨åˆ°çš„HotModuleReplacementPluginã€‚ ç”Ÿäº§ç¯å¢ƒæœ‰çš„é…ç½®ï¼Œå¼€å‘ç¯å¢ƒä¸ä¸€å®šæœ‰ï¼Œæ¯”å¦‚è¯´ç”¨æ¥å‹ç¼©jsç”¨çš„UglifyJsPluginã€‚ ï¼ˆ3ï¼‰å¦‚ä½•æ˜¯å¼€å¼€å‘å’Œç”Ÿäº§åˆ†ç¦»ï¼Ÿ 1&gt; å› ä¸ºwebpack é»˜è®¤æ‰¾çš„æ˜¯ webpack.config.jsé…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥è¦æŠŠå¼€å‘ç¯å¢ƒçš„webpack.config.jsé…ç½®æ–‡ä»¶æ”¹ä¸ºwebpack.dev.config.jsä»£è¡¨å¼€å‘ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ã€‚ 2&gt; æ–°å»ºä¸€ä¸ªwebpack.prod.config.jsï¼Œå†æŠŠå¼€å‘ç¯å¢ƒä¸­çš„webpack.config.jså¤åˆ¶è¿›å»ï¼ˆæ²¡ç”¨çš„é…ç½®æ–‡ä»¶è¯¥åˆ é™¤çš„åˆ é™¤ï¼‰ 3&gt; ä¿®æ”¹package.jsonæ–‡ä»¶ï¼ˆåœ¨scripts æ ‡ç­¾ä¸­æ·»åŠ â€devâ€å’Œâ€prodâ€ å±æ€§é…ç½®ï¼‰ 123456js "scripts": &#123; "test": "echo \"Error: no test specified\" &amp;&amp; exit 1", "dev": "webpack --config webpack.dev.config.js", "prod": "webpack --config webpack.prod.config.js" &#125;, æ‰§è¡Œæ„å»ºå‘½ä»¤ 1234# æ‰§è¡Œå¼€å‘ç¯å¢ƒçš„ä¸­é…ç½® npm run dev# æ‰§è¡Œç”Ÿäº§ç¯å¢ƒçš„ä¸­é…ç½® npm run prod 13ã€åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®ä»£ç å‹ç¼©åŠŸèƒ½é…ç½®webpack.prod.config.js æ–‡ä»¶ 12345678910111213// webpack.prod.config.jsvar UglifyJsPlugin = webpack.optimize.UglifyJsPlugin; // â€¦â€¦ plugins: [ // â€¦â€¦ // jsä»£ç  å‹ç¼© new UglifyJsPlugin(&#123; compress: &#123; warnings: false &#125; &#125;)] æ‰§è¡Œ npm run prod å‘½ä»¤]]></content>
      <categories>
        <category>webå‰ç«¯</category>
        <category>VUE</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>VUE</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vue-cli ä½¿ç”¨]]></title>
    <url>%2F2019%2F07%2F15%2F03.web%E5%89%8D%E7%AB%AF%2FVUE%2Fvue-cli%20%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ª: https://www.cnblogs.com/m18320364494/p/9560522.html ä¸€ã€å®‰è£…vue-cliå®‰è£…vue-cliçš„å‰ææ˜¯ä½ å·²ç»å®‰è£…äº†npmï¼Œå®‰è£…npmä½ å¯ä»¥ç›´æ¥ä¸‹è½½nodeçš„å®‰è£…åŒ…è¿›è¡Œå®‰è£…ã€‚ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œå·¥å…·é‡Œè¾“å…¥npm -v æ£€æµ‹ä½ æ˜¯å¦å®‰è£…äº†npmå’Œç‰ˆæœ¬æƒ…å†µã€‚å‡ºç°ç‰ˆæœ¬å·è¯´æ˜ä½ å·²ç»å®‰è£…äº†npmå’Œnodeï¼Œæˆ‘è¿™é‡Œçš„npmç‰ˆæœ¬ä¸º3.10.10ã€‚å¦‚æœè¯¥å‘½ä»¤ä¸å¯ä»¥ä½¿ç”¨ï¼Œéœ€è¦å®‰è£…nodeè½¯ä»¶åŒ…ï¼Œæ ¹æ®ä½ çš„ç³»ç»Ÿç‰ˆæœ¬é€‰æ‹©ä¸‹è½½å®‰è£…å°±å¯ä»¥äº†ã€‚ npmæ²¡æœ‰é—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ç”¨npm å‘½ä»¤å®‰è£…vue-cliäº†ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼š 1npm install vue-cli -g -g :ä»£è¡¨å…¨å±€å®‰è£…ã€‚å¦‚æœä½ å®‰è£…æ—¶æŠ¥é”™ï¼Œä¸€èˆ¬æ˜¯ç½‘ç»œé—®é¢˜ï¼Œä½ å¯ä»¥å°è¯•ç”¨cnpmæ¥è¿›è¡Œå®‰è£…ã€‚å®‰è£…å®Œæˆåï¼Œå¯ä»¥ç”¨vue -Væ¥è¿›è¡ŒæŸ¥çœ‹ vue-cliçš„ç‰ˆæœ¬å·ã€‚æ³¨æ„è¿™é‡Œçš„Væ˜¯å¤§å†™çš„ã€‚æˆ‘è¿™é‡Œç‰ˆæœ¬å·æ˜¯2.8.1. å¦‚æœvue -Vçš„å‘½ä»¤ç®¡ç”¨äº†ï¼Œè¯´æ˜å·²ç»é¡ºåˆ©çš„æŠŠvue-cliå®‰è£…åˆ°æˆ‘ä»¬çš„è®¡ç®—æœºé‡Œäº†ã€‚ äºŒã€åˆå§‹åŒ–é¡¹ç›®æˆ‘ä»¬ç”¨vue initå‘½ä»¤æ¥åˆå§‹åŒ–é¡¹ç›®ï¼Œå…·ä½“çœ‹ä¸€ä¸‹è¿™æ¡å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ã€‚ 1vue init &lt;template-name&gt; &lt;project-name&gt; initï¼šè¡¨ç¤ºæˆ‘è¦ç”¨vue-cliæ¥åˆå§‹åŒ–é¡¹ç›® template-nameï¼šè¡¨ç¤ºæ¨¡æ¿åç§°ï¼Œvue-cliå®˜æ–¹ä¸ºæˆ‘ä»¬æä¾›äº†5ç§æ¨¡æ¿ï¼Œ webpack: ä¸€ä¸ªå…¨é¢çš„webpack+vue-loaderçš„æ¨¡æ¿ï¼ŒåŠŸèƒ½åŒ…æ‹¬çƒ­åŠ è½½ï¼Œlinting,æ£€æµ‹å’ŒCSSæ‰©å±•ã€‚ webpack-simple: ä¸€ä¸ªç®€å•webpack+vue-loaderçš„æ¨¡æ¿ï¼Œä¸åŒ…å«å…¶ä»–åŠŸèƒ½ï¼Œè®©ä½ å¿«é€Ÿçš„æ­å»ºvueçš„å¼€å‘ç¯å¢ƒã€‚ browserify: ä¸€ä¸ªå…¨é¢çš„Browserify+vueify çš„æ¨¡æ¿ï¼ŒåŠŸèƒ½åŒ…æ‹¬çƒ­åŠ è½½ï¼Œlinting,å•å…ƒæ£€æµ‹ã€‚ browserify-simple: ä¸€ä¸ªç®€å•Browserify+vueifyçš„æ¨¡æ¿ï¼Œä¸åŒ…å«å…¶ä»–åŠŸèƒ½ï¼Œè®©ä½ å¿«é€Ÿçš„æ­å»ºvueçš„å¼€å‘ç¯å¢ƒã€‚ simple: ä¸€ä¸ªæœ€ç®€å•çš„å•é¡µåº”ç”¨æ¨¡æ¿ã€‚ project-name: æ ‡è¯†é¡¹ç›®åç§°ï¼Œè¿™ä¸ªä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„é¡¹ç›®æ¥èµ·åå­—ã€‚ åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨webpackè¿™ä¸ªæ¨¡æ¿ï¼Œé‚£æˆ‘ä»¬è¿™é‡Œä¹Ÿå®‰è£…è¿™ä¸ªæ¨¡æ¿ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 1vue init webpack vuecliTest è¾“å…¥å‘½ä»¤åï¼Œä¼šè¯¢é—®æˆ‘ä»¬å‡ ä¸ªç®€å•çš„é€‰é¡¹ï¼Œæˆ‘ä»¬æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œå¡«å†™å°±å¯ä»¥äº†ã€‚ Project name :é¡¹ç›®åç§° ï¼Œå¦‚æœä¸éœ€è¦æ›´æ”¹ç›´æ¥å›è½¦å°±å¯ä»¥äº†ã€‚æ³¨æ„ï¼šè¿™é‡Œä¸èƒ½ä½¿ç”¨å¤§å†™ï¼Œæ‰€ä»¥æˆ‘æŠŠåç§°æ”¹æˆäº†vueclitest Project description:é¡¹ç›®æè¿°ï¼Œé»˜è®¤ä¸ºA Vue.js project,ç›´æ¥å›è½¦ï¼Œä¸ç”¨ç¼–å†™ã€‚ Authorï¼šä½œè€…ï¼Œå¦‚æœä½ æœ‰é…ç½®gitçš„ä½œè€…ï¼Œä»–ä¼šè¯»å–ã€‚ Install vue-router? æ˜¯å¦å®‰è£…vueçš„è·¯ç”±æ’ä»¶ï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦å®‰è£…ï¼Œæ‰€ä»¥é€‰æ‹©Y Use ESLint to lint your code? æ˜¯å¦ç”¨ESLintæ¥é™åˆ¶ä½ çš„ä»£ç é”™è¯¯å’Œé£æ ¼ã€‚æˆ‘ä»¬è¿™é‡Œä¸éœ€è¦è¾“å…¥nï¼Œå¦‚æœä½ æ˜¯å¤§å‹å›¢é˜Ÿå¼€å‘ï¼Œæœ€å¥½æ˜¯è¿›è¡Œé…ç½®ã€‚ setup unit tests with Karma + Mocha? æ˜¯å¦éœ€è¦å®‰è£…å•å…ƒæµ‹è¯•å·¥å…·Karma+Mochaï¼Œæˆ‘ä»¬è¿™é‡Œä¸éœ€è¦ï¼Œæ‰€ä»¥è¾“å…¥nã€‚ Setup e2e tests with Nightwatch?æ˜¯å¦å®‰è£…e2eæ¥è¿›è¡Œç”¨æˆ·è¡Œä¸ºæ¨¡æ‹Ÿæµ‹è¯•ï¼Œæˆ‘ä»¬è¿™é‡Œä¸éœ€è¦ï¼Œæ‰€ä»¥è¾“å…¥nã€‚ å‘½ä»¤è¡Œå‡ºç°ä¸Šé¢çš„æ–‡å­—ï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»åˆå§‹åŒ–å¥½äº†ç¬¬ä¸€æ­¥ã€‚å‘½ä»¤è¡Œæç¤ºæˆ‘ä»¬ç°åœ¨å¯ä»¥ä½œçš„ä¸‰ä»¶äº‹æƒ…ã€‚ 1ã€cd vuecliTest è¿›å…¥æˆ‘ä»¬çš„vueé¡¹ç›®ç›®å½•ã€‚ 2ã€npm install å®‰è£…æˆ‘ä»¬çš„é¡¹ç›®ä¾èµ–åŒ…ï¼Œä¹Ÿå°±æ˜¯å®‰è£…package.jsoné‡Œçš„åŒ…ï¼Œå¦‚æœä½ ç½‘é€Ÿä¸å¥½ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨cnpmæ¥å®‰è£…ã€‚ 3ã€npm run dev å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºï¼ˆå®é™…ä¸Šæ˜¯æ‰§è¡Œäº†package.json ä¸­çš„scriptè„šæœ¬ï¼‰ã€‚ç»™æˆ‘ä»¬è‡ªåŠ¨æ„å»ºäº†å¼€å‘ç”¨çš„æœåŠ¡å™¨ç¯å¢ƒå’Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œå¹¶å®æ—¶ç›‘è§†æˆ‘ä»¬çš„ä»£ç æ›´æ”¹ï¼Œå³æ—¶å‘ˆç°ç»™æˆ‘ä»¬ã€‚ ä¸‰ã€Vue-clié¡¹ç›®ç»“æ„è®²è§£vue-cliè„šæ‰‹æ¶å·¥å…·å°±æ˜¯ä¸ºæˆ‘ä»¬æ­å»ºäº†å¼€å‘æ‰€éœ€è¦çš„ç¯å¢ƒï¼Œä¸ºæˆ‘ä»¬çœå»äº†å¾ˆå¤šç²¾åŠ›ã€‚æœ‰å¿…è¦å¯¹è¿™ä¸ªç¯å¢ƒè¿›è¡Œç†Ÿæ‚‰ï¼Œæˆ‘ä»¬å°±ä»é¡¹ç›®çš„ç»“æ„è®²èµ·ã€‚ Psï¼šç”±äºç‰ˆæœ¬å®æ—¶æ›´æ–°å’Œä½ é€‰æ‹©å®‰è£…çš„ä¸åŒï¼ˆè¿™é‡Œåˆ—å‡ºçš„æ˜¯æ¨¡æ¿ä¸ºwebpackçš„ç›®å½•ç»“æ„ï¼‰ï¼Œæ‰€ä»¥ä½ çœ‹åˆ°çš„æœ‰å¯èƒ½å’Œä¸‹è¾¹çš„æœ‰æ‰€å·®åˆ«ã€‚ 123456789101112131415161718192021222324252627282930.|-- build // é¡¹ç›®æ„å»º(webpack)ç›¸å…³ä»£ç | |-- build.js // ç”Ÿäº§ç¯å¢ƒæ„å»ºä»£ç | |-- check-version.js // æ£€æŸ¥nodeã€npmç­‰ç‰ˆæœ¬| |-- dev-client.js // çƒ­é‡è½½ç›¸å…³| |-- dev-server.js // æ„å»ºæœ¬åœ°æœåŠ¡å™¨| |-- utils.js // æ„å»ºå·¥å…·ç›¸å…³| |-- webpack.base.conf.js // webpackåŸºç¡€é…ç½®| |-- webpack.dev.conf.js // webpackå¼€å‘ç¯å¢ƒé…ç½®| |-- webpack.prod.conf.js // webpackç”Ÿäº§ç¯å¢ƒé…ç½®|-- config // é¡¹ç›®å¼€å‘ç¯å¢ƒé…ç½®| |-- dev.env.js // å¼€å‘ç¯å¢ƒå˜é‡| |-- index.js // é¡¹ç›®ä¸€äº›é…ç½®å˜é‡| |-- prod.env.js // ç”Ÿäº§ç¯å¢ƒå˜é‡| |-- test.env.js // æµ‹è¯•ç¯å¢ƒå˜é‡|-- src // æºç ç›®å½•| |-- components // vueå…¬å…±ç»„ä»¶| |-- store // vuexçš„çŠ¶æ€ç®¡ç†| |-- App.vue // é¡µé¢å…¥å£æ–‡ä»¶| |-- main.js // ç¨‹åºå…¥å£æ–‡ä»¶ï¼ŒåŠ è½½å„ç§å…¬å…±ç»„ä»¶|-- static // é™æ€æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸€äº›å›¾ç‰‡ï¼Œjsonæ•°æ®ç­‰| |-- data // ç¾¤èŠåˆ†æå¾—åˆ°çš„æ•°æ®ç”¨äºæ•°æ®å¯è§†åŒ–|-- .babelrc // ES6è¯­æ³•ç¼–è¯‘é…ç½®|-- .editorconfig // å®šä¹‰ä»£ç æ ¼å¼|-- .gitignore // gitä¸Šä¼ éœ€è¦å¿½ç•¥çš„æ–‡ä»¶æ ¼å¼|-- README.md // é¡¹ç›®è¯´æ˜|-- favicon.ico |-- index.html // å…¥å£é¡µé¢|-- package.json // é¡¹ç›®åŸºæœ¬ä¿¡æ¯. é‡è¦æ–‡ä»¶è®²è§£ï¼š package.jsonpackage.jsonæ–‡ä»¶æ˜¯é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå®šä¹‰è¯¥é¡¹ç›®å¼€å‘æ‰€éœ€è¦çš„å„ç§æ¨¡å—ä»¥åŠä¸€äº›é¡¹ç›®é…ç½®ä¿¡æ¯ï¼ˆå¦‚é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€æè¿°ã€ä½œè€…ç­‰ï¼‰ã€‚ package.json é‡Œçš„scriptså­—æ®µï¼Œè¿™ä¸ªå­—æ®µå®šä¹‰äº†ä½ å¯ä»¥ç”¨npmè¿è¡Œçš„å‘½ä»¤ã€‚åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œåœ¨å‘½ä»¤è¡Œå·¥å…·ä¸­è¿è¡Œnpm run dev å°±ç›¸å½“äºæ‰§è¡Œ node build/dev-server.js .ä¹Ÿå°±æ˜¯å¼€å¯äº†ä¸€ä¸ªnodeå†™çš„å¼€å‘è¡Œå»ºè®®æœåŠ¡å™¨ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡ºscriptå­—æ®µæ˜¯ç”¨æ¥æŒ‡å®šnpmç›¸å…³å‘½ä»¤çš„ç¼©å†™ã€‚ 1234"scripts": &#123; "dev": "node build/dev-server.js", "build": "node build/build.js"&#125;, dependencieså­—æ®µå’ŒdevDependencieså­—æ®µ dependencieså­—æ®µæŒ‡é¡¹ç›®è¿è¡Œæ—¶æ‰€ä¾èµ–çš„æ¨¡å—ï¼› devDependencieså­—æ®µæŒ‡å®šäº†é¡¹ç›®å¼€å‘æ—¶æ‰€ä¾èµ–çš„æ¨¡å—ï¼› åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œnpm installå‘½ä»¤ï¼Œä¼šè‡ªåŠ¨å®‰è£…dependencieså’ŒdevDempendencieså­—æ®µä¸­çš„æ¨¡å—ã€‚package.jsonè¿˜æœ‰å¾ˆå¤šç›¸å…³é…ç½®ï¼Œå¦‚æœä½ æƒ³å…¨é¢äº†è§£ï¼Œå¯ä»¥ä¸“é—¨å»ç™¾åº¦å­¦ä¹ ä¸€ä¸‹ã€‚ webpacké…ç½®ç›¸å…³æˆ‘ä»¬åœ¨ä¸Šé¢è¯´äº†è¿è¡Œnpm run dev å°±ç›¸å½“äºæ‰§è¡Œäº†node build/dev-server.js,è¯´æ˜è¿™ä¸ªæ–‡ä»¶ç›¸å½“é‡è¦ï¼Œå…ˆæ¥ç†Ÿæ‚‰ä¸€ä¸‹å®ƒã€‚ æˆ‘è´´å‡ºä»£ç å¹¶ç»™å‡ºé‡è¦çš„è§£é‡Šã€‚ dev-server.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109// æ£€æŸ¥ Node å’Œ npm ç‰ˆæœ¬require('./check-versions')()// è·å– config/index.js çš„é»˜è®¤é…ç½®var config = require('../config')// å¦‚æœ Node çš„ç¯å¢ƒæ— æ³•åˆ¤æ–­å½“å‰æ˜¯ dev / product ç¯å¢ƒ// ä½¿ç”¨ config.dev.env.NODE_ENV ä½œä¸ºå½“å‰çš„ç¯å¢ƒif (!process.env.NODE_ENV) process.env.NODE_ENV = JSON.parse(config.dev.env.NODE_ENV)// ä½¿ç”¨ NodeJS è‡ªå¸¦çš„æ–‡ä»¶è·¯å¾„å·¥å…·var path = require('path')// ä½¿ç”¨ expressvar express = require('express')// ä½¿ç”¨ webpackvar webpack = require('webpack')// ä¸€ä¸ªå¯ä»¥å¼ºåˆ¶æ‰“å¼€æµè§ˆå™¨å¹¶è·³è½¬åˆ°æŒ‡å®š url çš„æ’ä»¶var opn = require('opn')// ä½¿ç”¨ proxyTablevar proxyMiddleware = require('http-proxy-middleware')// ä½¿ç”¨ dev ç¯å¢ƒçš„ webpack é…ç½®var webpackConfig = require('./webpack.dev.conf')// default port where dev server listens for incoming traffic// å¦‚æœæ²¡æœ‰æŒ‡å®šè¿è¡Œç«¯å£ï¼Œä½¿ç”¨ config.dev.port ä½œä¸ºè¿è¡Œç«¯å£var port = process.env.PORT || config.dev.port// Define HTTP proxies to your custom API backend// https://github.com/chimurai/http-proxy-middleware// ä½¿ç”¨ config.dev.proxyTable çš„é…ç½®ä½œä¸º proxyTable çš„ä»£ç†é…ç½®var proxyTable = config.dev.proxyTable// ä½¿ç”¨ express å¯åŠ¨ä¸€ä¸ªæœåŠ¡var app = express()// å¯åŠ¨ webpack è¿›è¡Œç¼–è¯‘var compiler = webpack(webpackConfig)// å¯åŠ¨ webpack-dev-middlewareï¼Œå°† ç¼–è¯‘åçš„æ–‡ä»¶æš‚å­˜åˆ°å†…å­˜ä¸­var devMiddleware = require('webpack-dev-middleware')(compiler, &#123; publicPath: webpackConfig.output.publicPath, stats: &#123; colors: true, chunks: false &#125;&#125;)// å¯åŠ¨ webpack-hot-middlewareï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ Hot-reloadvar hotMiddleware = require('webpack-hot-middleware')(compiler)// force page reload when html-webpack-plugin template changescompiler.plugin('compilation', function (compilation) &#123; compilation.plugin('html-webpack-plugin-after-emit', function (data, cb) &#123; hotMiddleware.publish(&#123; action: 'reload' &#125;) cb() &#125;)&#125;)// proxy api requests// å°† proxyTable ä¸­çš„è¯·æ±‚é…ç½®æŒ‚åœ¨åˆ°å¯åŠ¨çš„ express æœåŠ¡ä¸ŠObject.keys(proxyTable).forEach(function (context) &#123; var options = proxyTable[context] if (typeof options === 'string') &#123; options = &#123; target: options &#125; &#125; app.use(proxyMiddleware(context, options))&#125;)// handle fallback for HTML5 history API// ä½¿ç”¨ connect-history-api-fallback åŒ¹é…èµ„æºï¼Œå¦‚æœä¸åŒ¹é…å°±å¯ä»¥é‡å®šå‘åˆ°æŒ‡å®šåœ°å€app.use(require('connect-history-api-fallback')())// serve webpack bundle output// å°†æš‚å­˜åˆ°å†…å­˜ä¸­çš„ webpack ç¼–è¯‘åçš„æ–‡ä»¶æŒ‚åœ¨åˆ° express æœåŠ¡ä¸Šapp.use(devMiddleware)// enable hot-reload and state-preserving// compilation error display// å°† Hot-reload æŒ‚åœ¨åˆ° express æœåŠ¡ä¸Šapp.use(hotMiddleware)// serve pure static assets// æ‹¼æ¥ static æ–‡ä»¶å¤¹çš„é™æ€èµ„æºè·¯å¾„var staticPath = path.posix.join(config.dev.assetsPublicPath, config.dev.assetsSubDirectory)// ä¸ºé™æ€èµ„æºæä¾›å“åº”æœåŠ¡app.use(staticPath, express.static('./static'))// è®©æˆ‘ä»¬è¿™ä¸ª express æœåŠ¡ç›‘å¬ port çš„è¯·æ±‚ï¼Œå¹¶ä¸”å°†æ­¤æœåŠ¡ä½œä¸º dev-server.js çš„æ¥å£æš´éœ²module.exports = app.listen(port, function (err) &#123; if (err) &#123; console.log(err) return &#125; var uri = 'http://localhost:' + port console.log('Listening at ' + uri + '\n') // when env is testing, don't need open it // å¦‚æœä¸æ˜¯æµ‹è¯•ç¯å¢ƒï¼Œè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨å¹¶è·³åˆ°æˆ‘ä»¬çš„å¼€å‘åœ°å€ if (process.env.NODE_ENV !== 'testing') &#123; opn(uri) &#125;&#125;) webpack.base.confg.js webpackçš„åŸºç¡€é…ç½®æ–‡ä»¶123456789101112131415161718192021222324252627282930......module.export = &#123; // ç¼–è¯‘å…¥å£æ–‡ä»¶ entry: &#123;&#125;, // ç¼–è¯‘è¾“å‡ºè·¯å¾„ output: &#123;&#125;, // ä¸€äº›è§£å†³æ–¹æ¡ˆé…ç½® resolve: &#123;&#125;, resolveLoader: &#123;&#125;, module: &#123; // å„ç§ä¸åŒç±»å‹æ–‡ä»¶åŠ è½½å™¨é…ç½® loaders: &#123; ... ... // jsæ–‡ä»¶ç”¨babelè½¬ç  &#123; test: /\.js$/, loader: 'babel', include: projectRoot, // å“ªäº›æ–‡ä»¶ä¸éœ€è¦è½¬ç  exclude: /node_modules/ &#125;, ... ... &#125; &#125;, // vueæ–‡ä»¶ä¸€äº›ç›¸å…³é…ç½® vue: &#123;&#125;&#125; .babelrcBabelè§£é‡Šå™¨çš„é…ç½®æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨æ ¹ç›®å½•ä¸‹ã€‚Babelæ˜¯ä¸€ä¸ªè½¬ç å™¨ï¼Œé¡¹ç›®é‡Œéœ€è¦ç”¨å®ƒå°†ES6ä»£ç è½¬ä¸ºES5ä»£ç ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œå¯ä»¥æŸ¥çœ‹babelçš„çŸ¥è¯†ã€‚ 1234567891011121314151617&#123; //è®¾å®šè½¬ç è§„åˆ™ "presets": [ ["env", &#123; "modules": false &#125;], "stage-2" ], //è½¬ç ç”¨çš„æ’ä»¶ "plugins": ["transform-runtime"], "comments": false, //å¯¹BABEL_ENVæˆ–è€…NODE_ENVæŒ‡å®šçš„ä¸åŒçš„ç¯å¢ƒå˜é‡ï¼Œè¿›è¡Œä¸åŒçš„ç¼–è¯‘æ“ä½œ "env": &#123; "test": &#123; "presets": ["env", "stage-2"], "plugins": [ "istanbul" ] &#125; &#125;&#125; .editorconfigè¯¥æ–‡ä»¶å®šä¹‰é¡¹ç›®çš„ç¼–ç è§„èŒƒï¼Œç¼–è¯‘å™¨çš„è¡Œä¸ºä¼šä¸.editorconfigæ–‡ä»¶ä¸­å®šä¹‰çš„ä¸€è‡´ï¼Œå¹¶ä¸”å…¶ä¼˜å…ˆçº§æ¯”ç¼–è¯‘å™¨è‡ªèº«çš„è®¾ç½®è¦é«˜ï¼Œè¿™åœ¨å¤šäººåˆä½œå¼€å‘é¡¹ç›®æ—¶ååˆ†æœ‰ç”¨è€Œä¸”å¿…è¦ã€‚ 123456789root = true[*] // å¯¹æ‰€æœ‰æ–‡ä»¶åº”ç”¨ä¸‹é¢çš„è§„åˆ™charset = utf-8 // ç¼–ç è§„åˆ™ç”¨utf-8indent_style = space // ç¼©è¿›ç”¨ç©ºæ ¼indent_size = 2 // ç¼©è¿›æ•°é‡ä¸º2ä¸ªç©ºæ ¼end_of_line = lf // æ¢è¡Œç¬¦æ ¼å¼insert_final_newline = true // æ˜¯å¦åœ¨æ–‡ä»¶çš„æœ€åæ’å…¥ä¸€ä¸ªç©ºè¡Œtrim_trailing_whitespace = true // æ˜¯å¦åˆ é™¤è¡Œå°¾çš„ç©ºæ ¼ è¿™æ˜¯æ¯”è¾ƒé‡è¦çš„å…³äºvue-cliçš„é…ç½®æ–‡ä»¶ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šåœ¨ä»¥åçš„æ–‡ç« ä¸­è®²è§£ã€‚ å››ã€Vue-cliçš„æ¨¡æ¿1ã€npm run build å‘½ä»¤æœ‰å°ä¼™ä¼´é—®æˆ‘ï¼Œå¦‚ä½•æŠŠå†™å¥½çš„Vueç½‘é¡µæ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼Œé‚£æˆ‘å°±åœ¨è¿™é‡Œè®²è§£ä¸€ä¸‹ï¼Œä¸»è¦çš„å‘½ä»¤å°±æ˜¯è¦ç”¨åˆ°npm run build å‘½ä»¤ã€‚æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥npm run buildå‘½ä»¤åï¼Œvue-cliä¼šè‡ªåŠ¨è¿›è¡Œé¡¹ç›®å‘å¸ƒæ‰“åŒ…ã€‚ä½ åœ¨package.jsonæ–‡ä»¶çš„scriptså­—æ®µä¸­å¯ä»¥çœ‹å‡ºï¼Œä½ æ‰§è¡Œçš„npm run buildå‘½ä»¤å°±ç›¸å¯¹æ‰§è¡Œçš„ node build/build.js ã€‚ package.jsonçš„scripts å­—æ®µï¼š1234"scripts": &#123; "dev": "node build/dev-server.js", "build": "node build/build.js"&#125;, åœ¨æ‰§è¡Œå®Œnpm run buildå‘½ä»¤åï¼Œåœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆäº†distæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œè¾¹å°±æ˜¯æˆ‘ä»¬è¦ä¼ åˆ°æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚ distæ–‡ä»¶å¤¹ä¸‹ç›®å½•åŒ…æ‹¬ï¼š index.html ä¸»é¡µæ–‡ä»¶:å› ä¸ºæˆ‘ä»¬å¼€å‘çš„æ˜¯å•é¡µwebåº”ç”¨ï¼Œæ‰€ä»¥è¯´ä¸€èˆ¬åªæœ‰ä¸€ä¸ªhtmlæ–‡ä»¶ã€‚ static é™æ€èµ„æºæ–‡ä»¶å¤¹ï¼šé‡Œè¾¹jsã€CSSå’Œä¸€äº›å›¾ç‰‡ã€‚ 2ã€main.jsæ–‡ä»¶è§£è¯»main.jsæ˜¯æ•´ä¸ªé¡¹ç›®çš„å…¥å£æ–‡ä»¶,åœ¨srcæ–‡ä»¶å¤¹ä¸‹ï¼š 12345678910111213import Vue from 'vue' import App from './App'import router from './router'Vue.config.productionTip = false //ç”Ÿäº§ç¯å¢ƒæç¤ºï¼Œè¿™é‡Œè®¾ç½®æˆäº†false/* eslint-disable no-new */new Vue(&#123; el: '#app', router, template: '&lt;App/&gt;', components: &#123; App &#125;&#125;) é€šè¿‡ä»£ç å¯ä»¥çœ‹å‡ºè¿™é‡Œå¼•è¿›äº†Appçš„ç»„ä»¶å’Œâ€™&lt; APP /&gt;â€™çš„æ¨¡æ¿ï¼Œå®ƒæ˜¯é€šè¿‡ import App from â€˜./Appâ€™è¿™å¥ä»£ç å¼•å…¥çš„ã€‚ æˆ‘ä»¬æ‰¾åˆ°App.vueæ–‡ä»¶ï¼Œæ‰“å¼€æŸ¥çœ‹ã€‚ 3ã€App.vueæ–‡ä»¶:1234567891011121314151617181920212223&lt;template&gt; &lt;div id=&quot;app&quot;&gt; &lt;img src=&quot;./assets/logo.png&quot;&gt; &lt;router-view&gt;&lt;/router-view&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123; name: &apos;app&apos;&#125;&lt;/script&gt;&lt;style&gt;#app &#123; font-family: &apos;Avenir&apos;, Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; text-align: center; color: #2c3e50; margin-top: 60px;&#125;&lt;/style&gt; app.vueæ–‡ä»¶æˆ‘ä»¬å¯ä»¥åˆ†æˆä¸‰éƒ¨åˆ†è§£è¯»ï¼Œ &lt; template &gt;&lt; /template &gt;æ ‡ç­¾åŒ…è£¹çš„å†…å®¹ï¼šè¿™æ˜¯æ¨¡æ¿çš„HTMLDomç»“æ„ï¼Œé‡Œè¾¹å¼•å…¥äº†ä¸€å¼ å›¾ç‰‡å’Œ&lt; router-view &gt;&lt; /router-view &gt;æ ‡ç­¾ï¼Œ&lt; router-view &gt;æ ‡ç­¾è¯´æ˜ä½¿ç”¨äº†è·¯ç”±æœºåˆ¶ã€‚æˆ‘ä»¬ä¼šåœ¨ä»¥åä¸“é—¨æ‹¿å‡ºä¸€ç¯‡æ–‡ç« è®²Vue-routerã€‚ &lt; script &gt;&lt; /script &gt;æ ‡ç­¾åŒ…æ‹¬çš„jså†…å®¹ï¼šä½ å¯ä»¥åœ¨è¿™é‡Œäº›ä¸€äº›é¡µé¢çš„åŠ¨æ€æ•ˆæœå’ŒVueçš„é€»è¾‘ä»£ç ã€‚ &lt; style&gt;&lt; /style &gt;æ ‡ç­¾åŒ…è£¹çš„csså†…å®¹ï¼šè¿™é‡Œå°±æ˜¯ä½ å¹³æ—¶å†™çš„CSSæ ·å¼ï¼Œå¯¹é¡µé¢æ ·å­è¿›è¡Œè£…é¥°ç”¨çš„ï¼Œéœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ä½ å¯ä»¥ç”¨&lt; style scoped &gt;&lt; /style &gt;æ¥å£°æ˜è¿™äº›cssæ ·å¼åªåœ¨æœ¬æ¨¡æ¿ä¸­èµ·ä½œç”¨ã€‚ 4ã€router/index.js è·¯ç”±æ–‡ä»¶å¼•æ–‡åœ¨app.vueä¸­æˆ‘ä»¬çœ‹åˆ°äº†è·¯ç”±æ–‡ä»¶ï¼Œè™½ç„¶routerçš„å†…å®¹æ¯”è¾ƒå¤šï¼Œä½†æ˜¯æˆ‘ä»¬å…ˆç®€å•çš„çœ‹ä¸€ä¸‹ã€‚ 123456789101112131415import Vue from 'vue'import Router from 'vue-router'import Hello from '@/components/Hello'Vue.use(Router)export default new Router(&#123; routes: [ &#123; path: '/', name: 'Hello', component: Hello &#125; ]&#125;) æˆ‘ä»¬å¯ä»¥çœ‹åˆ° import Hello from â€˜@/components/Helloâ€™è¿™å¥è¯ï¼Œ æ–‡ä»¶å¼•å…¥äº†/components/Hello.vueæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶é‡Œå°±é…ç½®äº†ä¸€ä¸ªè·¯ç”±ï¼Œå°±æ˜¯å½“æˆ‘ä»¬è®¿é—®ç½‘ç«™æ—¶ç»™æˆ‘ä»¬æ˜¾ç¤ºHello.vueçš„å†…å®¹ã€‚ 5ã€Hello.vueæ–‡ä»¶è§£è¯»ï¼šè¿™ä¸ªæ–‡ä»¶å°±æ˜¯æˆ‘ä»¬åœ¨ç¬¬ä¸€èŠ‚è¯¾çœ‹åˆ°çš„é¡µé¢æ–‡ä»¶äº†ã€‚ä¹Ÿæ˜¯åˆ†ä¸º&lt; template &gt;&lt; script &gt;&lt; style &gt;ä¸‰ä¸ªéƒ¨åˆ†ï¼Œä»¥åæˆ‘ä»¬å¤§éƒ¨åˆ†çš„å·¥ä½œéƒ½æ˜¯å†™è¿™äº›.vueç»“å°¾çš„æ–‡ä»¶ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è¯•ç€æ”¹ä¸€äº›å†…å®¹ï¼Œç„¶åé¢„è§ˆä¸€ä¸‹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;template&gt; &lt;div class=&quot;hello&quot;&gt; &lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;/h1&gt; &lt;h2&gt;Essential Links&lt;/h2&gt; &lt;ul&gt; &lt;li&gt;&lt;a href=&quot;https://vuejs.org&quot; target=&quot;_blank&quot;&gt;Core Docs&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://forum.vuejs.org&quot; target=&quot;_blank&quot;&gt;Forum&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://gitter.im/vuejs/vue&quot; target=&quot;_blank&quot;&gt;Gitter Chat&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://twitter.com/vuejs&quot; target=&quot;_blank&quot;&gt;Twitter&lt;/a&gt;&lt;/li&gt; &lt;br&gt; &lt;li&gt;&lt;a href=&quot;http://vuejs-templates.github.io/webpack/&quot; target=&quot;_blank&quot;&gt;Docs for This Template&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;h2&gt;Ecosystem&lt;/h2&gt; &lt;ul&gt; &lt;li&gt;&lt;a href=&quot;http://router.vuejs.org/&quot; target=&quot;_blank&quot;&gt;vue-router&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;http://vuex.vuejs.org/&quot; target=&quot;_blank&quot;&gt;vuex&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;http://vue-loader.vuejs.org/&quot; target=&quot;_blank&quot;&gt;vue-loader&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/vuejs/awesome-vue&quot; target=&quot;_blank&quot;&gt;awesome-vue&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123; name: &apos;hello&apos;, data () &#123; return &#123; msg: &apos;Welcome to Your Vue.js App&apos; &#125; &#125;&#125;&lt;/script&gt;&lt;!-- Add &quot;scoped&quot; attribute to limit CSS to this component only --&gt;&lt;style scoped&gt;h1, h2 &#123; font-weight: normal;&#125;ul &#123; list-style-type: none; padding: 0;&#125;li &#123; display: inline-block; margin: 0 10px;&#125;a &#123; color: #42b983;&#125;&lt;/style&gt;]]></content>
      <categories>
        <category>webå‰ç«¯</category>
        <category>VUE</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>VUE</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vue åŸºç¡€è¯­æ³•]]></title>
    <url>%2F2019%2F07%2F10%2F03.web%E5%89%8D%E7%AB%AF%2FVUE%2Fvue%20%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%2F</url>
    <content type="text"><![CDATA[1. vueçš„åŸºç¡€è¯­æ³•ä»‹ç»1-1åŸºæœ¬æ•°æ®ç»‘å®š12345678910&lt;div id="app"&gt; &#123;&#123; msg &#125;&#125;&lt;/div&gt;//scriptnew Vue(&#123; el:"#app",//ä»£è¡¨vueçš„èŒƒå›´ data:&#123; msg:'hello Vue' //æ•°æ® &#125;&#125;) åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥è¿›è¡Œèµ‹å€¼ 123var app = new Vue(...);app.msg = 'åˆæ¢vue';//é‚£ä¹ˆé¡µé¢çš„å€¼å°±è¢«æ”¹å˜äº† 1-2 v-htmlå‘½ä»¤12345678910&lt;div id="app" v-html="msg"&gt; &lt;/div&gt;//scriptnew Vue(&#123; el:"#app",//ä»£è¡¨vueçš„èŒƒå›´ data:&#123; msg:'&lt;h1&gt;ä½ å¥½ï¼Œä¸–ç•Œ&lt;/h1&gt;' //è¿™é‡Œå°±ä¸ä¼šæ˜¯æ–‡æœ¬äº† è€Œæ˜¯ä¼šè¢«å½“æˆæ˜¯htmlæ ‡ç­¾äº† &#125;&#125;) 1-3 v-on:click||@clickæŒ‡ä»¤12345678910111213141516171819202122232425262728293031&lt;div id="app"&gt;&lt;button v-on:clikc="clickHead"&gt;äº‹ä»¶&lt;/button&gt;&lt;button @click="clickHead"&gt;äº‹ä»¶&lt;/button&gt;&lt;/div&gt;//jsnew Vue(&#123; el:"#app", methods:&#123; clickHead:functoin()&#123; alert('vueçš„äº‹ä»¶ç»‘å®š') &#125; &#125;&#125;)//åœ¨es6è¯­æ³•ä¸­å¯¹è±¡ä¸­çš„å‡½æ•°å¯ä»¥const json=&#123; clickHead()&#123; //do something &#125;&#125;json.clickHead()è°ƒç”¨æ–¹æ³•//å’Œä¸€æ ·çš„const json=&#123; clickHead:function()&#123; //do something &#125;&#125; 1-4 v-bind å±æ€§ç»‘å®šæŒ‡ä»¤ ä¾‹å¦‚ç»‘å®šclass å’Œid å·²ç»å·²ç»å­˜åœ¨çš„å±æ€§ å’Œè‡ªå®šä¹‰å±æ€§ ç»‘å®šç±»å 12345678910111213141516171819202122&lt;div id="app"&gt; &lt;p v-bind:class="className"&gt;&#123;&#123;msg&#125;&#125;&lt;/p&gt; &lt;/div&gt;/*v-bind è‡ªå®šä¹‰åå­—v-bind:id="..." ç»‘å®šidåå­—v-bind:title="..."ç»‘å®štitleå±æ€§v-bind:style="..." ç»‘å®šæ ·å¼å±æ€§ v-bind:...="..."ç»‘å®šè‡ªå®šä¹‰å±æ€§ã€ã€ã€*///jsnew Vue(&#123; el:"#app", data:&#123; msg:'è¿™æ˜¯v-bindç»‘å®šæ•°æ®', className:'contatiner' &#125;,&#125;)const Name = document.querySelector('.contatiner');console.log(Name) //èƒ½æ­£å¸¸çš„è·å–è¿™ä¸ªå…ƒç´  1-5 v-show æ ¹æ®å€¼çš„çœŸå‡ æ§åˆ¶å…ƒç´ çš„displayçš„å±æ€§ 12345678910111213&lt;div id="app"&gt; &lt;p v-show="msg"&gt; å¯ä»¥çœ‹åˆ°å•Š &lt;/p&gt; &lt;p v-show="msg1"&gt; ä¸å¯ä»¥çœ‹åˆ°å•Š &lt;/p&gt; &lt;/div&gt;//jsnew Vue(&#123; el:"#app", data:&#123; msg:1+1==2, msg1:1+1!=2 &#125;&#125;) 1-6 v-text èµ‹äºˆæ–‡æœ¬å€¼ 1234567891011&lt;div id="app"&gt; &lt;p v-text="msg"&gt; å¯ä»¥çœ‹åˆ°å•Š &lt;/p&gt; &lt;!-- æœ€ç»ˆä¼šè¢«æ›¿æ¢æ‰ 1+1==2 --&gt;&lt;/div&gt;//jsnew Vue(&#123; el:"#app", data:&#123; msg:'ä½ å¥½å“ˆ v-text' &#125;&#125;) 1-7 v-for å¾ªç¯ 123456789101112131415161718 &lt;div id="app"&gt; &lt;ol&gt; &lt;li v-for="module in modules"&gt;&#123;&#123;module.msg&#125;&#125;&lt;/li&gt; &lt;/ol&gt;&lt;/div&gt;//jsnew Vue(&#123; el:"#app", data:&#123; modules:[ &#123;msg:'ç¬¬ä¸€ä¸ª'&#125;, &#123;msg:'ç¬¬äºŒä¸ª'&#125;, &#123;msg:'ç¬¬ä¸‰ä¸ª'&#125;, &#123;msg:'ç¬¬å››ä¸ª'&#125; ] &#125;&#125;) 1-8 v-model åŒå‘æ•°æ®ç»‘å®š123456789101112&lt;div id="app"&gt; &lt;input type="text" v-model="msg"&gt; &lt;p&gt;&#123;&#123;msg&#125;&#125;&lt;/p&gt;&lt;/div&gt;//jsnew Vue(&#123; el:"#app", data:&#123; msg:'' &#125;&#125;) 1-9 templateå±æ€§123456789101112&lt;div id="app"&gt; &lt;span&gt;ä½ å¥½å•Š&lt;/span&gt;&lt;/div&gt;//jsnew Vue(&#123; el:"#app", data:&#123; msg:'è¿™æ˜¯æ•°æ®' &#125;, template:"&lt;div&gt;æ¨¡æ¿div&lt;/div&gt;"&#125;) æœ€ç»ˆçš„æ•ˆæœæ˜¯æŠŠidä¸ºappçš„divç›´æ¥æ›¿æ¢æˆtemplateé‡Œé¢çš„å…ƒç´  æ³¨æ„åœ¨templateçš„å€¼ä¸­ä¸èƒ½å«æœ‰å…„å¼Ÿæ ¹èŠ‚ç‚¹ 1234new Vue(&#123; el:"#app", template:"&lt;div&gt;1&lt;div&gt;&lt;div&gt;2&lt;div&gt;"&#125;) è¿™æ ·æ˜¯é”™è¯¯çš„ , åœ¨template å¯ä»¥æŠŠå›¢è‹ç‰‡æ®µæ”¾åœ¨scriptæ ‡ç­¾å†… 12345678910111213141516171819&lt;div id="app"&gt; &lt;span&gt;ä½ å¥½å•Š&lt;/span&gt; &lt;/div&gt; &lt;script type="x-template" id="temp"&gt; //è¿™ä¸ªåœ°æ–¹å°±æ˜¯æ¨¡æ¿ç‰‡æ®µ &lt;div id="tpl"&gt; &lt;p&gt; è¿™æ˜¯æ¨¡æ¿å•Š,&#123;&#123;msg&#125;&#125; &lt;/p&gt; &lt;input type="text" v-model="msg" /&gt; &lt;/div&gt; &lt;/script&gt; &lt;script src="js/vue.min.js"&gt;&lt;/script&gt; &lt;script&gt; new Vue(&#123; el:"#app", data:&#123; msg:'' &#125;, template:"#temp" &#125;) &lt;/script&gt; 2. vueå®ä¾‹ä¸­çš„å±æ€§2-1 el elè¡¨ç¤ºåœ¨vueçš„å®ä¾‹ä¸­çš„ä½œç”¨èŒƒå›´ 123new Vue(&#123; el:"#app" //ä½œç”¨åœ¨idåä¸ºappçš„divä¸Š&#125;) 2-2 data dataçš„å±æ€§å°±æ˜¯æ•°æ®ç»‘å®š 12345678new Vue(&#123; data:&#123; msg:'æ•°æ®çš„å€¼' arrayData:[ &#123;title:'è¿™æ˜¯1'&#125; ] &#125;&#125;) 2-3 methods methodsç»‘å®šäº‹ä»¶ 12345678new Vue(&#123; el:"#app", methods:&#123; mouseClick()&#123; alert('ç»‘å®šäº‹ä»¶') &#125; &#125;&#125;) 2-3 template templateæ¨¡æ¿çš„ç»‘å®š 1234new Vue(&#123; el:"#app", template:'&lt;div&gt;è¿™æ˜¯æ¨¡æ¿å±æ€§&lt;/div&gt;'&#125;) 2-4 render renderæ¨¡æ¿çš„ç»‘å®š 1234567891011121314151617181920212223242526new Vue(&#123; el:"#app", render(createElement)&#123; return createElement( "ol", &#123; //æ–°åˆ›å»ºçš„å…ƒç´ èº«ä¸Šç»‘å®šå±æ€§ style:&#123; fontSize:'30px', border:'1px solid red', fontWeight:'bold' &#125;, attrs:&#123; title:'ä½ å¥½å•Š', coundNum:'01', id:'ls', class:'bg' &#125; &#125;, [ createElement("li",'è¿™æ˜¯ç¬¬ä¸€ä¸ªæ–‡æœ¬'), createElement("li",'è¿™æ˜¯ç¬¬äºŒä¸ªæ–‡æœ¬'), createElement("li",'è¿™æ˜¯ç¬¬ä¸‰ä¸ªæ–‡æœ¬'), ] ) &#125;&#125;) 3. vueçš„è‡ªå®šä¹‰æŒ‡ä»¤ åœ¨vueä¸­é™¤äº†å†…ç½®çš„æŒ‡ä»¤å¦‚v-forã€v-ifâ€¦,ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æŒ‡ä»¤å®˜ç½‘ 123456789//è¿™é‡Œå®šä¹‰v-focusdirectives: &#123; focus: &#123; // æŒ‡ä»¤çš„å®šä¹‰ inserted: function (el) &#123; el.focus() &#125; &#125;&#125; ä¸€ä¸ªæŒ‡ä»¤å®šä¹‰å¯¹è±¡å¯ä»¥æä¾›å¦‚ä¸‹å‡ ä¸ªé’©å­å‡½æ•° (å‡ä¸ºå¯é€‰)ï¼š bindï¼šåªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ã€‚åœ¨è¿™é‡Œå¯ä»¥è¿›è¡Œä¸€æ¬¡æ€§çš„åˆå§‹åŒ–è®¾ç½®ã€‚ insertedï¼šè¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ (ä»…ä¿è¯çˆ¶èŠ‚ç‚¹å­˜åœ¨ï¼Œä½†ä¸ä¸€å®šå·²è¢«æ’å…¥æ–‡æ¡£ä¸­)ã€‚ updateï¼šæ‰€åœ¨ç»„ä»¶çš„ VNode æ›´æ–°æ—¶è°ƒç”¨ï¼Œä½†æ˜¯å¯èƒ½å‘ç”Ÿåœ¨å…¶å­ VNode æ›´æ–°ä¹‹å‰ã€‚æŒ‡ä»¤çš„å€¼å¯èƒ½å‘ç”Ÿäº†æ”¹å˜ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ã€‚ä½†æ˜¯ä½ å¯ä»¥é€šè¿‡æ¯”è¾ƒæ›´æ–°å‰åçš„å€¼æ¥å¿½ç•¥ä¸å¿…è¦çš„æ¨¡æ¿æ›´æ–° (è¯¦ç»†çš„é’©å­å‡½æ•°å‚æ•°è§ä¸‹)ã€‚ componentUpdatedï¼šæŒ‡ä»¤æ‰€åœ¨ç»„ä»¶çš„ VNode åŠå…¶å­ VNode å…¨éƒ¨æ›´æ–°åè°ƒç”¨ã€‚ unbindï¼šåªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶è°ƒç”¨ã€‚ 4. vueçš„æ‰©å±•4-1 v-bindæ ¹æ®æ¡ä»¶ç»‘å®šç±»å æ¡ˆä¾‹ æ¯”å¦‚ç°åœ¨åœ¨trueçš„æƒ…å†µä¸‹ç»‘å®šredç±»å 1234567891011121314&lt;div id="app"&gt; &lt;span :class="&#123;red:addClass&#125;"&gt;&#123;&#123;msg&#125;&#125;&lt;/span&gt; &lt;!--å¯ä»¥åˆ©ç”¨ç®€å•çš„è¡¨è¾¾å¼--&gt;&lt;!--è¿™æ˜¯v-bindæŒ‡ä»¤å¯ä»¥çœç•¥--&gt;&lt;/div&gt;&lt;script src="js/vue.min.js"&gt;&lt;/script&gt;&lt;script&gt; new Vue(&#123; el:"#app", data:&#123; msg:'æ¡ä»¶ç»‘å®šç±»å', addClass:true &#125; &#125;)&lt;/script&gt; 4-2 v-on || @eventName äº‹ä»¶ç»‘å®š æœ‰ä¸€ä¸ªäº‹ä»¶ä¿®é¥°ç¬¦12345678910//é˜»æ­¢äº‹ä»¶å†’æ³¡&lt;div v-on:click.stop="eventHadles"&gt;&lt;/div&gt;//é˜»æ­¢é»˜è®¤äº‹ä»¶&lt;div v-on:click.prevent="eventHadles"&gt;&lt;/div&gt;//äº‹ä»¶åªèƒ½è§¦å‘ä¸€æ¬¡&lt;div v-on:click.once="eventHadles"&gt;&lt;/div&gt;//åªèƒ½å›è½¦è§¦å‘äº‹ä»¶&lt;div @keyup.enter="eventHadles"&gt;&lt;/div&gt;//åªèƒ½æŒ‡å®škeyCodeçš„å€¼è§¦å‘äº‹ä»¶&lt;div @keyup.13="eventHadles"&gt;&lt;/div&gt; 5. vueçš„è®¡ç®—å±æ€§ -computed ä¾‹å¦‚ä¸€ä¸ªæ¡ˆä¾‹éœ€è¦è¿‡æ»¤ä¸€äº›åˆ—è¡¨ è€Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨v-forè¿›è¡Œå¾ªç¯å‡ºæ¥åˆ—è¡¨ éœ€è¦ç”¨åˆ°æˆ‘ä»¬çš„å®ä¾‹çš„å±æ€§ computed è¯´é€ç‚¹å°±æ˜¯è¿‡æ»¤ä½ çš„æ•°æ®æ ¹æ®ä½ çš„æ¡ä»¶è¿›è¡Œè¿‡æ»¤ 1234567891011121314151617181920212223242526272829303132333435363738394041//jsnew Vue(&#123; el:"#app", data:&#123; list:[ &#123; title:'ä½ å¥½å•Š', isChecked:true &#125;, &#123; title:'ä½ å¥½å•Š2', isChecked:false &#125; ]ï¼Œ hash:'all' //è¿‡æ»¤æ¡ä»¶ &#125;, computed:&#123; //é‡å¤´æˆ filterData()&#123; //è¿™ä¸ªæ ¹æ®ä½ çš„æ¡ä»¶è¿›è¡Œè¿‡æ»¤ è®°ä½è¿™ä¸ªå‡½æ•°æœ€ç»ˆè¿”å›çš„æ˜¯æ•°æ®éœ€è¦return æ•°æ®å‡ºæ¥ ä¸éœ€è¦è°ƒç”¨æ­¤å‡½æ•° let filterDatas = &#123; all(list)&#123; return list &#125;, unfinshed(list)&#123; return list.filter(function(item)&#123; return !item.isChecked &#125;) &#125;, finshed(list)&#123; return list.filter(function(item)&#123; return item.isChecked &#125;) &#125; &#125; return filterDatas[ä½ çš„æ¡ä»¶]?filterDatas[ä½ çš„æ¡ä»¶](this.list):this.list //è¿™é‡Œçš„ä½ çš„æ¡ä»¶å¯ä»¥ä½¿hashå€¼ ç„¶åå¾ˆä¹…hashå€¼çš„ä¸åŒè¿›è¡Œè¿‡æ»¤ ä¸éœ€è¦è°ƒç”¨è¿™ä¸ªå‡½æ•° &#125; &#125;&#125;)//ç„¶ååœ¨v-forçš„æŒ‡ä»¤ä¸­&lt;div v-for="item in filterData"&gt;&lt;/div&gt; &lt;!--æ³¨æ„ä¸æ˜¯listäº† è€Œæ˜¯åˆšåˆšçš„computedä¸­çš„è®¡ç®—å±æ€§çš„å‡½æ•°åå­—--&gt; 6. vueçš„ç»„ä»¶6-1 åº•å±‚å­¦ä¹ ç»„ä»¶ ç»„ä»¶ (Component) æ˜¯ Vue.js æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ç»„ä»¶å¯ä»¥æ‰©å±• HTML å…ƒç´ ï¼Œå°è£…å¯é‡ç”¨çš„ä»£ç ã€‚åœ¨è¾ƒé«˜å±‚é¢ä¸Šï¼Œç»„ä»¶æ˜¯è‡ªå®šä¹‰å…ƒç´ ï¼ŒVue.js çš„ç¼–è¯‘å™¨ä¸ºå®ƒæ·»åŠ ç‰¹æ®ŠåŠŸèƒ½ã€‚åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œç»„ä»¶ä¹Ÿå¯ä»¥è¡¨ç°ä¸ºç”¨ is ç‰¹æ€§è¿›è¡Œäº†æ‰©å±•çš„åŸç”Ÿ HTML å…ƒç´ ã€‚ 12345678910111213//html&lt;div id="app"&gt; &lt;my-test&gt;&lt;/my-test&gt; &lt;!--è‡ªå®šä¹‰æ ‡ç­¾--&gt;&lt;/div&gt;//jsVue.component('my-test',&#123; //æ³¨å†Œç»„ä»¶ template:'&lt;div&gt;åˆå­¦ç»„ä»¶&lt;/div&gt;' &#125;);new Vue(&#123; el:"#app"&#125;) 6-2 çˆ¶å­ç»„ä»¶é€šä¿¡ åˆ©ç”¨propsè¿›è¡Œä¼ å€¼ 1234567891011121314151617181920212223242526//å±€éƒ¨ç»„ä»¶&lt;div id="app"&gt; &lt;my-test msg="ä½ å¥½"&gt;&lt;/my-test&gt; &lt;my-test msg="ä¼ å€¼2"&gt;&lt;/my-test&gt;&lt;/div&gt;//jsnew Vue(&#123; el:"#app", components:&#123; 'my-test':&#123; props:['msg'], template:'&lt;div&gt;&#123;&#123;msg&#125;&#125;&lt;/div&gt;' &#125; &#125;&#125;)//å…¨å±€ç»„ä»¶&lt;div id="app"&gt; &lt;my-test msg="ä½ å¥½"&gt;&lt;/my-test&gt; &lt;my-test msg="ä¼ å€¼2"&gt;&lt;/my-test&gt;&lt;/div&gt;//jsVue.component('my-test',&#123; props:['msg'], template:'&lt;div&gt;&#123;&#123;msg&#125;&#125;&lt;/div&gt;'&#125;) å¦‚æœéœ€è¦ä¼ çš„å€¼åœ¨vueçš„å®ä¾‹ä¸­ 12345678910111213141516171819202122232425//html&lt;div id="app"&gt; &lt;my-test v-bind:listData="list"&gt;&lt;/my-test&gt;&lt;/div&gt;//jsnew Vue(&#123; el:"#app", data:&#123; list:[ &#123;title:'è¿™æ˜¯æ•°æ®'&#125;, &#123;title:'è¿™æ˜¯æ•°æ®22'&#125; ] &#125;, components:&#123; 'my-test':&#123; props:['listData'], template:` &lt;select name="" id=""&gt; &lt;option v-for="item in listData"&gt;&#123;&#123;item.title&#125;&#125;&lt;/option&gt; &lt;/select&gt; ` &#125; &#125;&#125;) 7. vueè·å–domå…ƒç´ 1234567891011121314åœ¨æƒ³è·å–çš„å…ƒç´ èº«ä¸Š&lt;div class="container" rel="getDom"&gt;//jsnew Vue(&#123; el:"#app", methods:&#123; _someDo()&#123; this.dom = this.$refs.getDom; &#125; &#125;, mounted()&#123; this._someDo(); //vueå®ŒæˆæŒ‚è½½ è°ƒç”¨å‡½æ•° &#125;&#125;) 8. vueæ¸²æŸ“domæ˜¯å¼‚æ­¥$.nextTick()å‡½æ•° å› ä¸ºvueæ¸²æŸ“domæ˜¯å¼‚æ­¥çš„æ‰€ä»¥ç›´æ¥æ“ä½œdomæ˜¯ä¼šå‡ºé”™çš„ æ¡ˆä¾‹ ä¾‹å¦‚ åˆ›å»ºvueå®ä¾‹çš„æ—¶å€™è¯·æ±‚æ¥å£æ•°æ®ï¼Œç„¶åè¦è¿›è¡Œdomå…ƒç´ æ“ä½œ 1234567891011121314151617new Vue(&#123; data:&#123; result:'' &#125;, created()&#123; axios.get('/data') .then(data=&gt;&#123; this.result = data.data //å¦‚æœåœ¨domä¸­ç”¨åˆ°äº†v-forè¿™äº›å…ƒç´  è€Œæˆ‘ä»¬ä¹¡æ“ä½œè¿™äº›å…ƒç´  this.$nextTick(()=&gt;&#123; //è¿™ä¸ªå‡½æ•°çš„æ„ä¹‰å°±æ˜¯ç­‰å¾…domæ¸²æŸ“ç»“æŸåæ‰§è¡Œ &#125;) &#125;) .catch(err=&gt;&#123; //é”™è¯¯å¤„ç† &#125;) &#125;&#125;)]]></content>
      <categories>
        <category>webå‰ç«¯</category>
        <category>VUE</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>VUE</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ES6 æ–°è¯­æ³• (äºŒ)]]></title>
    <url>%2F2019%2F07%2F09%2F03.web%E5%89%8D%E7%AB%AF%2FJavaScript%2FES6%20%E6%96%B0%E8%AF%AD%E6%B3%95(%E4%BA%8C)%2F</url>
    <content type="text"><![CDATA[ES6 å¯¹è±¡å¯¹è±¡å­—é¢é‡å±æ€§çš„ç®€æ´è¡¨ç¤ºæ³• ES6å…è®¸å¯¹è±¡çš„å±æ€§ç›´æ¥å†™å˜é‡ï¼Œè¿™æ—¶å€™å±æ€§åæ˜¯å˜é‡åï¼Œå±æ€§å€¼æ˜¯å˜é‡å€¼ã€‚ 1234567891011const age = 12; const name = "Amy";const person = &#123;age, name&#125;; person //&#123;age: 12, name: "Amy"&#125; //ç­‰åŒäº const person = &#123;age: age, name: name&#125; æ–¹æ³•åä¹Ÿå¯ä»¥ç®€å†™ 12345678910111213const person = &#123; sayHi()&#123; console.log("Hi"); &#125;&#125;person.sayHi(); //"Hi"//ç­‰åŒäºconst person = &#123; sayHi:function()&#123; console.log("Hi"); &#125;&#125;person.sayHi();//"Hi" å¦‚æœæ˜¯Generator å‡½æ•°ï¼Œåˆ™è¦åœ¨å‰é¢åŠ ä¸€ä¸ªæ˜Ÿå·: 1234567891011const obj = &#123; * myGenerator() &#123; yield 'hello world'; &#125;&#125;;//ç­‰åŒäºconst obj = &#123; myGenerator: function* () &#123; yield 'hello world'; &#125;&#125;; å±æ€§åè¡¨è¾¾å¼ ES6å…è®¸ç”¨è¡¨è¾¾å¼ä½œä¸ºå±æ€§åï¼Œä½†æ˜¯ä¸€å®šè¦å°†è¡¨è¾¾å¼æ”¾åœ¨æ–¹æ‹¬å·å†…ã€‚ 123456const obj = &#123; ["he"+"llo"]()&#123; return "Hi"; &#125;&#125;obj.hello(); //"Hi" æ³¨æ„ç‚¹ï¼šå±æ€§çš„ç®€æ´è¡¨ç¤ºæ³•å’Œå±æ€§åè¡¨è¾¾å¼ä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ 1234567891011const hello = "Hello";const obj = &#123; [hello]&#125;;obj //SyntaxError: Unexpected token &#125; const hello = "Hello";const obj = &#123; [hello+"2"]:"world"&#125;;obj //&#123;Hello2: "world"&#125; å¯¹è±¡æ‹“å±•è¿ç®—ç¬¦æ‹“å±•è¿ç®—ç¬¦ï¼ˆâ€¦ï¼‰ç”¨äºå–å‡ºå‚æ•°å¯¹è±¡æ‰€æœ‰å¯éå†å±æ€§ç„¶åæ‹·è´åˆ°å½“å‰å¯¹è±¡ã€‚ åŸºæœ¬ç”¨æ³• 123let person = &#123;name: "Amy", age: 15&#125;;let someone = &#123; ...person &#125;;someone; //&#123;name: "Amy", age: 15&#125; å¯ç”¨äºåˆå¹¶ä¸¤ä¸ªå¯¹è±¡ 1234let age = &#123;age: 15&#125;;let name = &#123;name: "Amy"&#125;;let person = &#123;...age, ...name&#125;;person; //&#123;age: 15, name: "Amy"&#125; å¯¹è±¡çš„æ–°æ–¹æ³•ä¸€ã€Object.assign 1Object.assign(target, source_1, Â·Â·Â·) ç”¨äºå°†æºå¯¹è±¡çš„æ‰€æœ‰å¯æšä¸¾å±æ€§å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ä¸­ã€‚ åŸºæœ¬ç”¨æ³• 123456let target = &#123;a: 1&#125;;let object2 = &#123;b: 2&#125;;let object3 = &#123;c: 3&#125;;Object.assign(target,object2,object3); // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œåé¢çš„å‚æ•°æ˜¯æºå¯¹è±¡target; // &#123;a: 1, b: 2, c: 3 å¦‚æœç›®æ ‡å¯¹è±¡å’Œæºå¯¹è±¡æœ‰åŒåå±æ€§ï¼Œæˆ–è€…å¤šä¸ªæºå¯¹è±¡æœ‰åŒåå±æ€§ï¼Œåˆ™åé¢çš„å±æ€§ä¼šè¦†ç›–å‰é¢çš„å±æ€§ã€‚ å¦‚æœè¯¥å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå½“å‚æ•°ä¸ºå¯¹è±¡æ—¶ï¼Œç›´æ¥è¿”å›è¯¥å¯¹è±¡ï¼›å½“å‚æ•°ä¸æ˜¯å¯¹è±¡æ—¶ï¼Œä¼šå…ˆå°†å‚æ•°è½¬ä¸ºå¯¹è±¡ç„¶åè¿”å›ã€‚ 12Object.assign(3); // Number &#123;3&#125;typeof Object.assign(3); // "object" å› ä¸º null å’Œ undefined ä¸èƒ½è½¬åŒ–ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™: 1234567Object.assign(null); // TypeError: Cannot convert undefined or null to objectObject.assign(undefined); // TypeError: Cannot convert undefined or null to objectå½“å‚æ•°ä¸æ­¢ä¸€ä¸ªæ—¶ï¼Œnull å’Œ undefined ä¸æ”¾ç¬¬ä¸€ä¸ªï¼Œå³ä¸ä¸ºç›®æ ‡å¯¹è±¡æ—¶ï¼Œä¼šè·³è¿‡ null å’Œ undefined ï¼Œä¸æŠ¥é”™Object.assign(1,undefined); // Number &#123;1&#125;Object.assign(&#123;a: 1&#125;,null); // &#123;a: 1&#125; Object.assign(undefined,&#123;a: 1&#125;); // TypeError: Cannot convert undefined or null to object æ³¨æ„ç‚¹ assign çš„å±æ€§æ‹·è´æ˜¯æµ…æ‹·è´: 12345let sourceObj = &#123; a: &#123; b: 1&#125;&#125;;let targetObj = &#123;c: 3&#125;;Object.assign(targetObj, sourceObj);targetObj.a.b = 2;sourceObj.a.b; // 2 åŒåå±æ€§æ›¿æ¢ 1234targetObj = &#123; a: &#123; b: 1, c:2&#125;&#125;;sourceObj = &#123; a: &#123; b: "hh"&#125;&#125;;Object.assign(targetObj, sourceObj);targetObj; // &#123;a: &#123;b: "hh"&#125;&#125; æ•°ç»„çš„å¤„ç† 1Object.assign([2,3], [5]); // [5,3] ä¼šå°†æ•°ç»„å¤„ç†æˆå¯¹è±¡ï¼Œæ‰€ä»¥å…ˆå°† [2,3] è½¬ä¸º {0:2,1:3} ï¼Œç„¶åå†è¿›è¡Œå±æ€§å¤åˆ¶ï¼Œæ‰€ä»¥æºå¯¹è±¡çš„ 0 å·å±æ€§è¦†ç›–äº†ç›®æ ‡å¯¹è±¡çš„ 0ã€‚ äºŒã€Object.is 1Object.is(value1, value2) ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ä¸¥æ ¼ç›¸ç­‰ï¼Œä¸ï¼ˆ===ï¼‰åŸºæœ¬ç±»ä¼¼ã€‚ åŸºæœ¬ç”¨æ³• 1234Object.is("q","q"); // trueObject.is(1,1); // trueObject.is([1],[1]); // falseObject.is(&#123;q:1&#125;,&#123;q:1&#125;); // false ä¸ï¼ˆ===ï¼‰çš„åŒºåˆ« 123456//ä¸€æ˜¯+0ä¸ç­‰äº-0Object.is(+0,-0); //false+0 === -0 //true//äºŒæ˜¯NaNç­‰äºæœ¬èº«Object.is(NaN,NaN); //trueNaN === NaN //false ES6 æ•°ç»„æ•°ç»„åˆ›å»ºArray.of å°†å‚æ•°ä¸­æ‰€æœ‰å€¼ä½œä¸ºå…ƒç´ å½¢æˆæ•°ç»„ã€‚ 1234567console.log(Array.of(1, 2, 3, 4)); // [1, 2, 3, 4] // å‚æ•°å€¼å¯ä¸ºä¸åŒç±»å‹console.log(Array.of(1, '2', true)); // [1, '2', true] // å‚æ•°ä¸ºç©ºæ—¶è¿”å›ç©ºæ•°ç»„console.log(Array.of()); // [] Array.from å°†ç±»æ•°ç»„å¯¹è±¡æˆ–å¯è¿­ä»£å¯¹è±¡è½¬åŒ–ä¸ºæ•°ç»„ã€‚ 12345// å‚æ•°ä¸ºæ•°ç»„,è¿”å›ä¸åŸæ•°ç»„ä¸€æ ·çš„æ•°ç»„console.log(Array.from([1, 2])); // [1, 2] // å‚æ•°å«ç©ºä½console.log(Array.from([1, , 3])); // [1, undefined, 3] array.from æ¥æ”¶çš„å‚æ•°: Array.from(arrayLike[, mapFn[, thisArg]]) ; è¿”å›å€¼ä¸ºè½¬æ¢åçš„æ•°ç»„ã€‚ arrayLike: æƒ³è¦è½¬æ¢çš„ç±»æ•°ç»„å¯¹è±¡æˆ–å¯è¿­ä»£å¯¹è±¡ã€‚ 1console.log(Array.from([1, 2, 3])); // [1, 2, 3] mapFn: å¯é€‰ï¼Œmap å‡½æ•°ï¼Œç”¨äºå¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œæ”¾å…¥æ•°ç»„çš„æ˜¯å¤„ç†åçš„å…ƒç´ ã€‚ 1console.log(Array.from([1, 2, 3], (n) =&gt; n * 2)); // [2, 4, 6] thisArg: å¯é€‰ï¼Œç”¨äºæŒ‡å®š map å‡½æ•°æ‰§è¡Œæ—¶çš„ this å¯¹è±¡ã€‚ 123456789let map = &#123; do: function(n) &#123; return n * 2; &#125;&#125;let arrayLike = [1, 2, 3];console.log(Array.from(arrayLike, function (n)&#123; return this.do(n);&#125;, map)); // [2, 4, 6] ç±»æ•°ç»„å¯¹è±¡ ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡å¿…é¡»å«æœ‰ length å±æ€§ï¼Œä¸”å…ƒç´ å±æ€§åå¿…é¡»æ˜¯æ•°å€¼æˆ–è€…å¯è½¬æ¢ä¸ºæ•°å€¼çš„å­—ç¬¦ã€‚ 1234567891011121314151617181920212223let arr = Array.from(&#123; 0: '1', 1: '2', 2: 3, length: 3&#125;);console.log(); // ['1', '2', 3] // æ²¡æœ‰ length å±æ€§,åˆ™è¿”å›ç©ºæ•°ç»„let array = Array.from(&#123; 0: '1', 1: '2', 2: 3,&#125;);console.log(array); // [] // å…ƒç´ å±æ€§åä¸ä¸ºæ•°å€¼ä¸”æ— æ³•è½¬æ¢ä¸ºæ•°å€¼ï¼Œè¿”å›é•¿åº¦ä¸º length å…ƒç´ å€¼ä¸º undefined çš„æ•°ç»„ let array1 = Array.from(&#123; a: 1, b: 2, length: 2&#125;);console.log(array1); // [undefined, undefined] è½¬æ¢å¯è¿­ä»£å¯¹è±¡ è½¬æ¢map 12345let map = new Map();map.set('key0', 'value0');map.set('key1', 'value1');console.log(Array.from(map)); // [['key0', 'value0'],['key1',// 'value1']] è½¬æ¢set 123let arr = [1, 2, 3];let set = new Set(arr);console.log(Array.from(set)); // [1, 2, 3] è½¬æ¢å­—ç¬¦ä¸² 12let str = 'abc';console.log(Array.from(str)); // ["a", "b", "c"] æ•°ç»„æ‹“å±•æ–¹æ³•æŸ¥æ‰¾ find() æŸ¥æ‰¾æ•°ç»„ä¸­ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ,è‹¥æœ‰å¤šä¸ªç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ 12345let arr = Array.of(1, 2, 3, 4);console.log(arr.find(item =&gt; item &gt; 2)); // 3 // æ•°ç»„ç©ºä½å¤„ç†ä¸º undefinedconsole.log([, 1].find(n =&gt; true)); // undefined findIndex() æŸ¥æ‰¾æ•°ç»„ä¸­ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ç´¢å¼•ï¼Œè‹¥æœ‰å¤šä¸ªç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ç´¢å¼•ã€‚ 1234567let arr = Array.of(1, 2, 1, 3);// å‚æ•°1ï¼šå›è°ƒå‡½æ•°// å‚æ•°2(å¯é€‰)ï¼šæŒ‡å®šå›è°ƒå‡½æ•°ä¸­çš„ this å€¼console.log(arr.findIndex(item =&gt; item = 1)); // 0 // æ•°ç»„ç©ºä½å¤„ç†ä¸º undefinedconsole.log([, 1].findIndex(n =&gt; true)); //0 å¡«å…… fill() å°†ä¸€å®šèŒƒå›´ç´¢å¼•çš„æ•°ç»„å…ƒç´ å†…å®¹å¡«å……ä¸ºå•ä¸ªæŒ‡å®šçš„å€¼ã€‚ 12345let arr = Array.of(1, 2, 3, 4);// å‚æ•°1ï¼šç”¨æ¥å¡«å……çš„å€¼// å‚æ•°2ï¼šè¢«å¡«å……çš„èµ·å§‹ç´¢å¼•// å‚æ•°3(å¯é€‰)ï¼šè¢«å¡«å……çš„ç»“æŸç´¢å¼•ï¼Œé»˜è®¤ä¸ºæ•°ç»„æœ«å°¾console.log(arr.fill(0,1,2)); // [1, 0, 3, 4] copyWithin() å°†ä¸€å®šèŒƒå›´ç´¢å¼•çš„æ•°ç»„å…ƒç´ ä¿®æ”¹ä¸ºæ­¤æ•°ç»„å¦ä¸€æŒ‡å®šèŒƒå›´ç´¢å¼•çš„å…ƒç´ ã€‚ 123456789// å‚æ•°1ï¼šè¢«ä¿®æ”¹çš„èµ·å§‹ç´¢å¼•// å‚æ•°2ï¼šè¢«ç”¨æ¥è¦†ç›–çš„æ•°æ®çš„èµ·å§‹ç´¢å¼•// å‚æ•°3(å¯é€‰)ï¼šè¢«ç”¨æ¥è¦†ç›–çš„æ•°æ®çš„ç»“æŸç´¢å¼•ï¼Œé»˜è®¤ä¸ºæ•°ç»„æœ«å°¾console.log([1, 2, 3, 4].copyWithin(0,2,4)); // [3, 4, 3, 4] // å‚æ•°1ä¸ºè´Ÿæ•°è¡¨ç¤ºå€’æ•°console.log([1, 2, 3, 4].copyWithin(-2, 0)); // [1, 2, 1, 2] console.log([1, 2, ,4].copyWithin(0, 2, 4)); // [, 4, , 4] éå† entries()ï¼š éå†é”®å€¼å¯¹ã€‚ keys()ï¼š éå†é”®åï¼› values(): éå†é”®å€¼ï¼› 12345678910111213for(let [key, value] of ['a', 'b'].entries())&#123; console.log(key, value);&#125;// 0 "a"// 1 "b" // ä¸ä½¿ç”¨ for... of å¾ªç¯let entries = ['a', 'b'].entries();console.log(entries.next().value); // [0, "a"]console.log(entries.next().value); // [1, "b"] // æ•°ç»„å«ç©ºä½console.log([...[,'a'].entries()]); // [[0, undefined], [1, "a"]] åŒ…å« includes() æ•°ç»„æ˜¯å¦åŒ…å«æŒ‡å®šå€¼ã€‚ æ³¨æ„ï¼šä¸ Set å’Œ Map çš„ has æ–¹æ³•åŒºåˆ†ï¼›Set çš„ has æ–¹æ³•ç”¨äºæŸ¥æ‰¾å€¼ï¼›Map çš„ has æ–¹æ³•ç”¨äºæŸ¥æ‰¾é”®åã€‚ 12345678// å‚æ•°1ï¼šåŒ…å«çš„æŒ‡å®šå€¼[1, 2, 3].includes(1); // true // å‚æ•°2ï¼šå¯é€‰ï¼Œæœç´¢çš„èµ·å§‹ç´¢å¼•ï¼Œé»˜è®¤ä¸º0[1, 2, 3].includes(1, 2); // false // NaN çš„åŒ…å«åˆ¤æ–­[1, NaN, 3].includes(NaN); // true åµŒå¥—æ•°ç»„è½¬ä¸€ç»´æ•°ç»„ flat() 12345678910console.log([1 ,[2, 3]].flat()); // [1, 2, 3] // æŒ‡å®šè½¬æ¢çš„åµŒå¥—å±‚æ•°console.log([1, [2, [3, [4, 5]]]].flat(2)); // [1, 2, 3, [4, 5]] // ä¸ç®¡åµŒå¥—å¤šå°‘å±‚console.log([1, [2, [3, [4, 5]]]].flat(Infinity)); // [1, 2, 3, 4, 5] // è‡ªåŠ¨è·³è¿‡ç©ºä½console.log([1, [2, , 3]].flat()); // [1, 2, 3] flatMap() å…ˆå¯¹æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ è¿›è¡Œäº†çš„å¤„ç†ï¼Œå†å¯¹æ•°ç»„æ‰§è¡Œ flat() æ–¹æ³•ã€‚ 123// å‚æ•°1ï¼šéå†å‡½æ•°ï¼Œè¯¥éå†å‡½æ•°å¯æ¥å—3ä¸ªå‚æ•°ï¼šå½“å‰å…ƒç´ ã€å½“å‰å…ƒç´ ç´¢å¼•ã€åŸæ•°ç»„// å‚æ•°2ï¼šæŒ‡å®šéå†å‡½æ•°ä¸­ this çš„æŒ‡å‘console.log([1, 2, 3].flatMap(n =&gt; [n * 2])); // [2, 4, 6] æ•°ç»„ç¼“å†²åŒºæ•°ç»„ç¼“å†²åŒºæ˜¯å†…å­˜ä¸­çš„ä¸€æ®µåœ°å€ã€‚ å®šå‹æ•°ç»„çš„åŸºç¡€ã€‚ å®é™…å­—èŠ‚æ•°åœ¨åˆ›å»ºæ—¶ç¡®å®šï¼Œä¹‹ååªå¯ä¿®æ”¹å…¶ä¸­çš„æ•°æ®ï¼Œä¸å¯ä¿®æ”¹å¤§å°ã€‚ åˆ›å»ºæ•°ç»„ç¼“å†²åŒº é€šè¿‡æ„é€ å‡½æ•°åˆ›å»º: 123456let buffer = new ArrayBuffer(10);console.log(buffer.byteLength); // 10åˆ†å‰²å·²æœ‰æ•°ç»„ç¼“å†²åŒºlet buffer = new ArrayBuffer(10);let buffer1 = buffer.slice(1, 3);console.log(buffer1.byteLength); // 2 è§†å›¾ è§†å›¾æ˜¯ç”¨æ¥æ“ä½œå†…å­˜çš„æ¥å£ã€‚ è§†å›¾å¯ä»¥æ“ä½œæ•°ç»„ç¼“å†²åŒºæˆ–ç¼“å†²åŒºå­—èŠ‚çš„å­é›†,å¹¶æŒ‰ç…§å…¶ä¸­ä¸€ç§æ•°å€¼æ•°æ®ç±»å‹æ¥è¯»å–å’Œå†™å…¥æ•°æ®ã€‚ DataView ç±»å‹æ˜¯ä¸€ç§é€šç”¨çš„æ•°ç»„ç¼“å†²åŒºè§†å›¾,å…¶æ”¯æŒæ‰€æœ‰8ç§æ•°å€¼å‹æ•°æ®ç±»å‹ã€‚ 12345678910// é»˜è®¤ DataView å¯æ“ä½œæ•°ç»„ç¼“å†²åŒºå…¨éƒ¨å†…å®¹let buffer = new ArrayBuffer(10); dataView = new DataView(buffer); dataView.setInt8(0,1);console.log(dataView.getInt8(0)); // 1 // é€šè¿‡è®¾å®šåç§»é‡(å‚æ•°2)ä¸é•¿åº¦(å‚æ•°3)æŒ‡å®š DataView å¯æ“ä½œçš„å­—èŠ‚èŒƒå›´let buffer1 = new ArrayBuffer(10); dataView1 = new DataView(buffer1, 0, 3);dataView1.setInt8(5,1); // RangeError å®šå‹æ•°ç»„æ•°ç»„ç¼“å†²åŒºçš„ç‰¹å®šç±»å‹çš„è§†å›¾ã€‚ å¯ä»¥å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„æ•°æ®ç±»å‹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é€šç”¨çš„ DataView å¯¹è±¡æ¥æ“ä½œæ•°ç»„ç¼“å†²åŒºã€‚ åˆ›å»º é€šè¿‡æ•°ç»„ç¼“å†²åŒºç”Ÿæˆ 123let buffer = new ArrayBuffer(10), view = new Int8Array(buffer);console.log(view.byteLength); // 10 é€šè¿‡æ„é€ å‡½æ•° 1234567891011121314151617181920212223242526let view = new Int32Array(10);console.log(view.byteLength); // 40console.log(view.length); // 10 // ä¸ä¼ å‚åˆ™é»˜è®¤é•¿åº¦ä¸º0// åœ¨è¿™ç§æƒ…å†µä¸‹æ•°ç»„ç¼“å†²åŒºåˆ†é…ä¸åˆ°ç©ºé—´ï¼Œåˆ›å»ºçš„å®šå‹æ•°ç»„ä¸èƒ½ç”¨æ¥ä¿å­˜æ•°æ®let view1 = new Int32Array();console.log(view1.byteLength); // 0console.log(view1.length); // 0 // å¯æ¥å—å‚æ•°åŒ…æ‹¬å®šå‹æ•°ç»„ã€å¯è¿­ä»£å¯¹è±¡ã€æ•°ç»„ã€ç±»æ•°ç»„å¯¹è±¡let arr = Array.from(&#123; 0: '1', 1: '2', 2: 3, length: 3&#125;);let view2 = new Int16Array([1, 2]), view3 = new Int32Array(view2), view4 = new Int16Array(new Set([1, 2, 3])), view5 = new Int16Array([1, 2, 3]), view6 = new Int16Array(arr);console.log(view2 .buffer === view3.buffer); // falseconsole.log(view4.byteLength); // 6console.log(view5.byteLength); // 6console.log(view6.byteLength); // 6 æ³¨æ„è¦ç‚¹ length å±æ€§ä¸å¯å†™ï¼Œå¦‚æœå°è¯•ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šç›´æ¥å¿½ç•¥è¯¥æ“ä½œï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡ºé”™è¯¯ã€‚ 123let view = new Int16Array([1, 2]);view.length = 3;console.log(view.length); // 2 å®šå‹æ•°ç»„å¯ä½¿ç”¨ entries()ã€keys()ã€values()è¿›è¡Œè¿­ä»£ã€‚ 123456let view = new Int16Array([1, 2]);for(let [k, v] of view.entries())&#123; console.log(k, v);&#125;// 0 1// 1 2 find() ç­‰æ–¹æ³•ä¹Ÿå¯ç”¨äºå®šå‹æ•°ç»„ï¼Œä½†æ˜¯å®šå‹æ•°ç»„ä¸­çš„æ–¹æ³•ä¼šé¢å¤–æ£€æŸ¥æ•°å€¼ç±»å‹æ˜¯å¦å®‰å…¨,ä¹Ÿä¼šé€šè¿‡ Symbol.species ç¡®è®¤æ–¹æ³•çš„è¿”å›å€¼æ˜¯å®šå‹æ•°ç»„è€Œéæ™®é€šæ•°ç»„ã€‚concat() æ–¹æ³•ç”±äºä¸¤ä¸ªå®šå‹æ•°ç»„åˆå¹¶ç»“æœä¸ç¡®å®šï¼Œæ•…ä¸èƒ½ç”¨äºå®šå‹æ•°ç»„ï¼›å¦å¤–ï¼Œç”±äºå®šå‹æ•°ç»„çš„å°ºå¯¸ä¸å¯æ›´æ”¹,å¯ä»¥æ”¹å˜æ•°ç»„çš„å°ºå¯¸çš„æ–¹æ³•ï¼Œä¾‹å¦‚ splice() ï¼Œä¸é€‚ç”¨äºå®šå‹æ•°ç»„ã€‚ 12let view = new Int16Array([1, 2]);view.find((n) &gt; 1); // 2 æ‰€æœ‰å®šå‹æ•°ç»„éƒ½å«æœ‰é™æ€ of() æ–¹æ³•å’Œ from() æ–¹æ³•,è¿è¡Œæ•ˆæœåˆ†åˆ«ä¸ Array.of() æ–¹æ³•å’Œ Array.from() æ–¹æ³•ç›¸ä¼¼,åŒºåˆ«æ˜¯å®šå‹æ•°ç»„çš„æ–¹æ³•è¿”å›å®šå‹æ•°ç»„,è€Œæ™®é€šæ•°ç»„çš„æ–¹æ³•è¿”å›æ™®é€šæ•°ç»„ã€‚ 12let view = Int16Array.of(1, 2);console.log(view instanceof Int16Array); // true å®šå‹æ•°ç»„ä¸æ˜¯æ™®é€šæ•°ç»„ï¼Œä¸ç»§æ‰¿è‡ª Array ã€‚ 12let view = new Int16Array([1, 2]);console.log(Array.isArray(view)); // false å®šå‹æ•°ç»„ä¸­å¢åŠ äº† set() ä¸ subarray() æ–¹æ³•ã€‚ set() æ–¹æ³•ç”¨äºå°†å…¶ä»–æ•°ç»„å¤åˆ¶åˆ°å·²æœ‰å®šå‹æ•°ç»„, subarray() ç”¨äºæå–å·²æœ‰å®šå‹æ•°ç»„çš„ä¸€éƒ¨åˆ†å½¢æˆæ–°çš„å®šå‹æ•°ç»„ã€‚ 123456789101112131415161718// set æ–¹æ³•// å‚æ•°1ï¼šä¸€ä¸ªå®šå‹æ•°ç»„æˆ–æ™®é€šæ•°ç»„// å‚æ•°2ï¼šå¯é€‰ï¼Œåç§»é‡ï¼Œå¼€å§‹æ’å…¥æ•°æ®çš„ä½ç½®ï¼Œé»˜è®¤ä¸º0let view= new Int16Array(4);view.set([1, 2]);view.set([3, 4], 2);console.log(view); // [1, 2, 3, 4] // subarray æ–¹æ³•// å‚æ•°1ï¼šå¯é€‰ï¼Œå¼€å§‹ä½ç½®// å‚æ•°2ï¼šå¯é€‰ï¼Œç»“æŸä½ç½®(ä¸åŒ…å«ç»“æŸä½ç½®)let view= new Int16Array([1, 2, 3, 4]), subview1 = view.subarray(), subview2 = view.subarray(1), subview3 = view.subarray(1, 3);console.log(subview1); // [1, 2, 3, 4]console.log(subview2); // [2, 3, 4]console.log(subview3); // [2, 3] æ‹“å±•è¿ç®—ç¬¦å¤åˆ¶æ•°ç»„ 12345678let arr = [1, 2], arr1 = [...arr];console.log(arr1); // [1, 2] // æ•°ç»„å«ç©ºä½let arr2 = [1, , 3], arr3 = [...arr2];console.log(arr3); [1, undefined, 3] ES6 è¿­ä»£å™¨IteratorIterator æ˜¯ ES6 å¼•å…¥çš„ä¸€ç§æ–°çš„éå†æœºåˆ¶ï¼Œè¿­ä»£å™¨æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š è¿­ä»£å™¨æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä½¿å„ç§æ•°æ®ç»“æ„å¯è¢«ä¾¿æ·çš„è®¿é—®ï¼Œå®ƒæ˜¯é€šè¿‡ä¸€ä¸ªé”®ä¸ºSymbol.iterator çš„æ–¹æ³•æ¥å®ç°ã€‚ è¿­ä»£å™¨æ˜¯ç”¨äºéå†æ•°æ®ç»“æ„å…ƒç´ çš„æŒ‡é’ˆï¼ˆå¦‚æ•°æ®åº“ä¸­çš„æ¸¸æ ‡ï¼‰ã€‚ è¿­ä»£è¿‡ç¨‹è¿­ä»£åŸç† é€šè¿‡ Symbol.iterator åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½® éšåé€šè¿‡ next æ–¹æ³•è¿›è¡Œå‘ä¸‹è¿­ä»£æŒ‡å‘ä¸‹ä¸€ä¸ªä½ç½®ï¼Œ next æ–¹æ³•ä¼šè¿”å›å½“å‰ä½ç½®çš„å¯¹è±¡ï¼Œå¯¹è±¡åŒ…å«äº† value å’Œ done ä¸¤ä¸ªå±æ€§ï¼Œ value æ˜¯å½“å‰å±æ€§çš„å€¼ï¼Œ done ç”¨äºåˆ¤æ–­æ˜¯å¦éå†ç»“æŸ å½“ done ä¸º true æ—¶åˆ™éå†ç»“æŸ ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­è¿›è¡Œè¯´æ˜ï¼š 1234567891011const items = ["zero", "one", "two"];const it = items[Symbol.iterator](); it.next();&gt;&#123;value: "zero", done: false&#125;it.next();&gt;&#123;value: "one", done: false&#125;it.next();&gt;&#123;value: "two", done: false&#125;it.next();&gt;&#123;value: undefined, done: true&#125; ä¸Šé¢çš„ä¾‹å­ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œç„¶åé€šè¿‡ Symbol.iterator æ–¹æ³•åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œä¹‹åä¸æ–­çš„è°ƒç”¨ next æ–¹æ³•å¯¹æ•°ç»„å†…éƒ¨é¡¹è¿›è¡Œè®¿é—®ï¼Œå½“å±æ€§ done ä¸º true æ—¶è®¿é—®ç»“æŸã€‚ è¿­ä»£å™¨æ˜¯åè®®ï¼ˆä½¿ç”¨å®ƒä»¬çš„è§„åˆ™ï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºè¿­ä»£ã€‚è¯¥åè®®çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§å°±æ˜¯å®ƒæ˜¯é¡ºåºçš„ï¼šè¿­ä»£å™¨ä¸€æ¬¡è¿”å›ä¸€ä¸ªå€¼ã€‚è¿™æ„å‘³ç€å¦‚æœå¯è¿­ä»£æ•°æ®ç»“æ„æ˜¯éçº¿æ€§çš„ï¼ˆä¾‹å¦‚æ ‘ï¼‰ï¼Œè¿­ä»£å°†ä¼šä½¿å…¶çº¿æ€§åŒ–ã€‚ å¯è¿­ä»£çš„æ•°æ®ç»“æ„å¯è¿­ä»£ç»“æ„ Array String Map Set Domå…ƒç´ ï¼ˆæ­£åœ¨è¿›è¡Œä¸­ï¼‰ for â€¦ of å¾ªç¯forâ€¦of æ˜¯ ES6 æ–°å¼•å…¥çš„å¾ªç¯ï¼Œç”¨äºæ›¿ä»£ for..in å’Œ forEach() ï¼Œå¹¶ä¸”æ”¯æŒæ–°çš„è¿­ä»£åè®®ã€‚å®ƒå¯ç”¨äºè¿­ä»£å¸¸è§„çš„æ•°æ®ç±»å‹ï¼Œå¦‚ Array ã€ String ã€ Map å’Œ Set ç­‰ç­‰ã€‚ å¾ªç¯æ–¹æ³• 12345678910111213141516171819202122let myMap = new Map();myMap.set(0, "zero");myMap.set(1, "one");myMap.set(2, "two"); // éå† key å’Œ valuefor (let [key, value] of myMap) &#123; console.log(key + " = " + value);&#125;for (let [key, value] of myMap.entries()) &#123; console.log(key + " = " + value);&#125; // åªéå† keyfor (let key of myMap.keys()) &#123; console.log(key);&#125; // åªéå† valuefor (let value of myMap.values()) &#123; console.log(value);&#125; å¯è¿­ä»£æ•°æ®ç»“æ„of æ“ä½œæ•°å¿…é¡»æ˜¯å¯è¿­ä»£ï¼Œè¿™æ„å‘³ç€å¦‚æœæ˜¯æ™®é€šå¯¹è±¡åˆ™æ— æ³•è¿›è¡Œè¿­ä»£ã€‚å¦‚æœæ•°æ®ç»“æ„ç±»ä¼¼äºæ•°ç»„çš„å½¢å¼ï¼Œåˆ™å¯ä»¥å€ŸåŠ© Array.from() æ–¹æ³•è¿›è¡Œè½¬æ¢è¿­ä»£ã€‚ 1234567891011121314const arrayLink = &#123;length: 2, 0: "zero", 1: "one"&#125;// æŠ¥ TypeError å¼‚å¸¸for (let item of arrayLink) &#123; console.log(item);&#125; // æ­£å¸¸è¿è¡Œ// output:// zero// onefor (let item of Array.from(arrayLink)) &#123; console.log(item);&#125; let ã€const å’Œ var ç”¨äº for..of å¦‚æœä½¿ç”¨ let å’Œ const ï¼Œæ¯æ¬¡è¿­ä»£å°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­˜å‚¨ç©ºé—´ï¼Œè¿™å¯ä»¥ä¿è¯ä½œç”¨åŸŸåœ¨è¿­ä»£çš„å†…éƒ¨ã€‚ 1234567const nums = ["zero", "one", "two"]; for (const num of nums) &#123; console.log(num);&#125;// æŠ¥ ReferenceErrorconsole.log(num); ä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬çœ‹åˆ°ï¼Œæœ€åä¸€å¥ä¼šæŠ¥å¼‚å¸¸ï¼ŒåŸå›  num çš„ä½œç”¨åŸŸåªåœ¨å¾ªç¯ä½“å†…éƒ¨ï¼Œå¤–éƒ¨æ— æ•ˆï¼Œå…·ä½“å¯æŸ¥é˜… let ä¸ const ç« èŠ‚ã€‚ä½¿ç”¨ var åˆ™ä¸ä¼šå‡ºç°ä¸Šè¿°æƒ…å†µï¼Œå› ä¸º var ä¼šä½œç”¨äºå…¨å±€ï¼Œè¿­ä»£å°†ä¸ä¼šæ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å­˜å‚¨ç©ºé—´ã€‚ 1234567const nums = ["zero", "one", "two"]; forv (var num of nums) &#123; console.log(num);&#125;// output: twoconsole.log(num); ES6 Class ç±»æ¦‚è¿°åœ¨ES6ä¸­ï¼Œclass (ç±»)ä½œä¸ºå¯¹è±¡çš„æ¨¡æ¿è¢«å¼•å…¥ï¼Œå¯ä»¥é€šè¿‡ class å…³é”®å­—å®šä¹‰ç±»ã€‚ class çš„æœ¬è´¨æ˜¯ functionã€‚ å®ƒå¯ä»¥çœ‹ä½œä¸€ä¸ªè¯­æ³•ç³–ï¼Œè®©å¯¹è±¡åŸå‹çš„å†™æ³•æ›´åŠ æ¸…æ™°ã€æ›´åƒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­æ³•ã€‚ åŸºç¡€ç”¨æ³•ç±»å®šä¹‰ç±»è¡¨è¾¾å¼å¯ä»¥ä¸ºåŒ¿åæˆ–å‘½åã€‚ 123456789101112// åŒ¿åç±»let Example = class &#123; constructor(a) &#123; this.a = a; &#125;&#125;// å‘½åç±»let Example = class Example &#123; constructor(a) &#123; this.a = a; &#125;&#125; ç±»å£°æ˜12345class Example &#123; constructor(a) &#123; this.a = a; &#125;&#125; æ³¨æ„è¦ç‚¹ï¼šä¸å¯é‡å¤å£°æ˜ã€‚ 123456789class Example&#123;&#125;class Example&#123;&#125;// Uncaught SyntaxError: Identifier 'Example' has already been // declared let Example1 = class&#123;&#125;class Example&#123;&#125;// Uncaught SyntaxError: Identifier 'Example' has already been // declared æ³¨æ„è¦ç‚¹ç±»å®šä¹‰ä¸ä¼šè¢«æå‡ï¼Œè¿™æ„å‘³ç€ï¼Œå¿…é¡»åœ¨è®¿é—®å‰å¯¹ç±»è¿›è¡Œå®šä¹‰ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚ ç±»ä¸­æ–¹æ³•ä¸éœ€è¦ function å…³é”®å­—ã€‚ æ–¹æ³•é—´ä¸èƒ½åŠ åˆ†å·ã€‚ ç±»çš„ä¸»ä½“å±æ€§ prototype ES6 ä¸­ï¼Œprototype ä»æ—§å­˜åœ¨ï¼Œè™½ç„¶å¯ä»¥ç›´æ¥è‡ªç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œä½†æ˜¯å…¶å®æ–¹æ³•è¿˜æ˜¯å®šä¹‰åœ¨ prototype ä¸Šçš„ã€‚ è¦†ç›–æ–¹æ³• / åˆå§‹åŒ–æ—¶æ·»åŠ æ–¹æ³• 123Example.prototype=&#123; //methods&#125; æ·»åŠ æ–¹æ³• 123Object.assign(Example.prototype,&#123; //methods&#125;) é™æ€å±æ€§ é™æ€å±æ€§ï¼šclass æœ¬èº«çš„å±æ€§ï¼Œå³ç›´æ¥å®šä¹‰åœ¨ç±»å†…éƒ¨çš„å±æ€§ï¼ˆ Class.propname ï¼‰ï¼Œä¸éœ€è¦å®ä¾‹åŒ–ã€‚ ES6 ä¸­è§„å®šï¼ŒClass å†…éƒ¨åªæœ‰é™æ€æ–¹æ³•ï¼Œæ²¡æœ‰é™æ€å±æ€§ã€‚ 123456class Example &#123;// æ–°ææ¡ˆ static a = 2;&#125;// ç›®å‰å¯è¡Œå†™æ³•Example.b = 2; å…¬å…±å±æ€§ 12class Example&#123;&#125;Example.prototype.a = 2; å®ä¾‹å±æ€§ å®ä¾‹å±æ€§ï¼šå®šä¹‰åœ¨å®ä¾‹å¯¹è±¡ï¼ˆ this ï¼‰ä¸Šçš„å±æ€§ã€‚ 123456class Example &#123; a = 2; constructor () &#123; console.log(this.a); &#125;&#125; nameå±æ€§ è¿”å›è·Ÿåœ¨ class åçš„ç±»å(å­˜åœ¨æ—¶)ã€‚ 12345678910111213let Example=class Exam &#123; constructor(a) &#123; this.a = a; &#125;&#125;console.log(Example.name); // Exam let Example=class &#123; constructor(a) &#123; this.a = a; &#125;&#125;console.log(Example.name); // Example æ–¹æ³• constructor æ–¹æ³• constructor æ–¹æ³•æ˜¯ç±»çš„é»˜è®¤æ–¹æ³•ï¼Œåˆ›å»ºç±»çš„å®ä¾‹åŒ–å¯¹è±¡æ—¶è¢«è°ƒç”¨ã€‚ 123456class Example&#123; constructor()&#123; console.log('æˆ‘æ˜¯constructor'); &#125;&#125;new Example(); // æˆ‘æ˜¯constructor è¿”å›å¯¹è±¡ 1234567891011121314class Test &#123; constructor()&#123; // é»˜è®¤è¿”å›å®ä¾‹å¯¹è±¡ this &#125;&#125;console.log(new Test() instanceof Test); // true class Example &#123; constructor()&#123; // æŒ‡å®šè¿”å›å¯¹è±¡ return new Test(); &#125;&#125;console.log(new Example() instanceof Example); // false é™æ€æ–¹æ³• 123456class Example&#123; static sum(a, b) &#123; console.log(a+b); &#125;&#125;Example.sum(1, 2); // 3 åŸå‹æ–¹æ³• 1234567class Example &#123; sum(a, b) &#123; console.log(a + b); &#125;&#125;let exam = new Example();exam.sum(1, 2); // 3 å®ä¾‹æ–¹æ³• 1234567class Example &#123; constructor() &#123; this.sum = (a, b) =&gt; &#123; console.log(a + b); &#125; &#125;&#125; ç±»çš„å®ä¾‹åŒ–new class çš„å®ä¾‹åŒ–å¿…é¡»é€šè¿‡ new å…³é”®å­—ã€‚ 1234class Example &#123;&#125; let exam1 = Example(); // Class constructor Example cannot be invoked without 'new' å®ä¾‹åŒ–å¯¹è±¡ å…±äº«åŸå‹å¯¹è±¡ 12345678910111213141516171819class Example &#123; constructor(a, b) &#123; this.a = a; this.b = b; console.log('Example'); &#125; sum() &#123; return this.a + this.b; &#125;&#125;let exam1 = new Example(2, 1);let exam2 = new Example(3, 1);console.log(exam1._proto_ == exam2._proto_); // true exam1._proto_.sub = function() &#123; return this.a - this.b;&#125;console.log(exam1.sub()); // 1console.log(exam2.sub()); // 2 decoratordecorator æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥ä¿®æ”¹ç±»çš„è¡Œä¸ºï¼Œåœ¨ä»£ç ç¼–è¯‘æ—¶äº§ç”Ÿä½œç”¨ã€‚ ç±»ä¿®é¥° ä¸€ä¸ªå‚æ•° ç¬¬ä¸€ä¸ªå‚æ•° targetï¼ŒæŒ‡å‘ç±»æœ¬èº«ã€‚ 123456function testable(target) &#123; target.isTestable = true;&#125;@testableclass Example &#123;&#125;Example.isTestable; // true å¤šä¸ªå‚æ•°â€”â€”åµŒå¥—å®ç° 12345678function testable(isTestable) &#123; return function(target) &#123; target.isTestable=isTestable; &#125;&#125;@testable(true)class Example &#123;&#125;Example.isTestable; // true å®ä¾‹å±æ€§ ä¸Šé¢ä¸¤ä¸ªä¾‹å­æ·»åŠ çš„æ˜¯é™æ€å±æ€§ï¼Œè‹¥è¦æ·»åŠ å®ä¾‹å±æ€§ï¼Œåœ¨ç±»çš„ prototype ä¸Šæ“ä½œå³å¯ã€‚ æ–¹æ³•ä¿®é¥° 3ä¸ªå‚æ•°ï¼štargetï¼ˆç±»çš„åŸå‹å¯¹è±¡ï¼‰ã€nameï¼ˆä¿®é¥°çš„å±æ€§åï¼‰ã€descriptorï¼ˆè¯¥å±æ€§çš„æè¿°å¯¹è±¡ï¼‰ 12345678910class Example &#123; @writable sum(a, b) &#123; return a + b; &#125;&#125;function writable(target, name, descriptor) &#123; descriptor.writable = false; return descriptor; // å¿…é¡»è¿”å›&#125; ä¿®é¥°å™¨æ‰§è¡Œé¡ºåº ç”±å¤–å‘å†…è¿›å…¥ï¼Œç”±å†…å‘å¤–æ‰§è¡Œã€‚ 123456789101112131415class Example &#123; @logMethod(1) @logMthod(2) sum(a, b)&#123; return a + b; &#125;&#125;function logMethod(id) &#123; console.log('evaluated logMethod'+id); return (target, name, desctiptor) =&gt; console.log('excuted logMethod '+id);&#125;// evaluated logMethod 1// evaluated logMethod 2// excuted logMethod 2// excuted logMethod 1 å°è£…ä¸ç»§æ‰¿getter / setter å®šä¹‰ 12345678910111213141516171819202122232425262728293031class Example&#123; constructor(a, b) &#123; this.a = a; // å®ä¾‹åŒ–æ—¶è°ƒç”¨ set æ–¹æ³• this.b = b; &#125; get a()&#123; console.log('getter'); return this.a; &#125; set a(a)&#123; console.log('setter'); this.a = a; // è‡ªèº«é€’å½’è°ƒç”¨ &#125;&#125;let exam = new Example(1,2); // ä¸æ–­è¾“å‡º setter ï¼Œæœ€ç»ˆå¯¼è‡´ RangeErrorclass Example1&#123; constructor(a, b) &#123; this.a = a; this.b = b; &#125; get a()&#123; console.log('getter'); return this._a; &#125; set a(a)&#123; console.log('setter'); this._a = a; &#125;&#125;let exam1 = new Example1(1,2); // åªè¾“å‡º setter , ä¸ä¼šè°ƒç”¨ getter æ–¹æ³•console.log(exam._a); // 1, å¯ä»¥ç›´æ¥è®¿é—® getter ä¸å¯å•ç‹¬å‡ºç° 123456789class Example &#123; constructor(a) &#123; this.a = a; &#125; get a() &#123; return this.a; &#125;&#125;let exam = new Example(1); // Uncaught TypeError: Cannot set property // a of #&lt;Example&gt; which has only a getter getter ä¸ setter å¿…é¡»åŒçº§å‡ºç° 123456789101112131415161718192021222324252627282930313233343536class Father &#123; constructor()&#123;&#125; get a() &#123; return this._a; &#125;&#125;class Child extends Father &#123; constructor()&#123; super(); &#125; set a(a) &#123; this._a = a; &#125;&#125;let test = new Child();test.a = 2;console.log(test.a); // undefined class Father1 &#123; constructor()&#123;&#125; // æˆ–è€…éƒ½æ”¾åœ¨å­ç±»ä¸­ get a() &#123; return this._a; &#125; set a(a) &#123; this._a = a; &#125;&#125;class Child1 extends Father1 &#123; constructor()&#123; super(); &#125;&#125;let test1 = new Child1();test1.a = 2;console.log(test1.a); // 2 extends é€šè¿‡ extends å®ç°ç±»çš„ç»§æ‰¿ã€‚ 1class Child extends Father &#123; ... &#125; super å­ç±» constructor æ–¹æ³•ä¸­å¿…é¡»æœ‰ super ï¼Œä¸”å¿…é¡»å‡ºç°åœ¨ this ä¹‹å‰ã€‚ 1234567891011121314class Father &#123; constructor() &#123;&#125;&#125;class Child extends Father &#123; constructor() &#123;&#125; // or // constructor(a) &#123; // this.a = a; // super(); // &#125;&#125;let test = new Child(); // Uncaught ReferenceError: Must call super // constructor in derived class before accessing 'this' or returning // from derived constructor è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°,åªèƒ½å‡ºç°åœ¨å­ç±»çš„æ„é€ å‡½æ•°ã€‚ 12345678910111213141516171819class Father &#123; test()&#123; return 0; &#125; static test1()&#123; return 1; &#125;&#125;class Child extends Father &#123; constructor()&#123; super(); &#125;&#125;class Child1 extends Father &#123; test2() &#123; super(); // Uncaught SyntaxError: 'super' keyword unexpected // here &#125;&#125; è°ƒç”¨çˆ¶ç±»æ–¹æ³•, super ä½œä¸ºå¯¹è±¡ï¼Œåœ¨æ™®é€šæ–¹æ³•ä¸­ï¼ŒæŒ‡å‘çˆ¶ç±»çš„åŸå‹å¯¹è±¡ï¼Œåœ¨é™æ€æ–¹æ³•ä¸­ï¼ŒæŒ‡å‘çˆ¶ç±» 123456789101112class Child2 extends Father &#123; constructor()&#123; super(); // è°ƒç”¨çˆ¶ç±»æ™®é€šæ–¹æ³• console.log(super.test()); // 0 &#125; static test3()&#123; // è°ƒç”¨çˆ¶ç±»é™æ€æ–¹æ³• return super.test1+2; &#125;&#125;Child2.test3(); // 3 æ³¨æ„è¦ç‚¹ ä¸å¯ç»§æ‰¿å¸¸è§„å¯¹è±¡ 12345678910var Father = &#123; // ...&#125;class Child extends Father &#123; // ...&#125;// Uncaught TypeError: Class extends value #&lt;Object&gt; is not a constructor or null // è§£å†³æ–¹æ¡ˆObject.setPrototypeOf(Child.prototype, Father); ES6 æ¨¡å—æ¦‚è¿°åœ¨ ES6 å‰ï¼Œ å®ç°æ¨¡å—åŒ–ä½¿ç”¨çš„æ˜¯ RequireJS æˆ–è€… seaJSï¼ˆåˆ†åˆ«æ˜¯åŸºäº AMD è§„èŒƒçš„æ¨¡å—åŒ–åº“ï¼Œ å’ŒåŸºäº CMD è§„èŒƒçš„æ¨¡å—åŒ–åº“ï¼‰ã€‚ ES6 å¼•å…¥äº†æ¨¡å—åŒ–ï¼Œå…¶è®¾è®¡æ€æƒ³æ˜¯åœ¨ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šæ¨¡å—çš„ä¾èµ–å…³ç³»ï¼Œä»¥åŠè¾“å…¥å’Œè¾“å‡ºçš„å˜é‡ã€‚ ES6 çš„æ¨¡å—åŒ–åˆ†ä¸ºå¯¼å‡ºï¼ˆexportï¼‰ @ä¸å¯¼å…¥ï¼ˆimportï¼‰ä¸¤ä¸ªæ¨¡å—ã€‚ ES6 æ¨¡å—çš„ç‰¹ç‚¹ES6 çš„æ¨¡å—è‡ªåŠ¨å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¸ç®¡ä½ æœ‰æ²¡æœ‰åœ¨æ¨¡å—å¤´éƒ¨åŠ ä¸Š use strict;ã€‚ æ¨¡å—ä¸­å¯ä»¥å¯¼å…¥å’Œå¯¼å‡ºå„ç§ç±»å‹çš„å˜é‡ï¼Œå¦‚å‡½æ•°ï¼Œå¯¹è±¡ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œå¸ƒå°”å€¼ï¼Œç±»ç­‰ã€‚ æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼Œæ¯ä¸€ä¸ªæ¨¡å—å†…å£°æ˜çš„å˜é‡éƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚ æ¯ä¸€ä¸ªæ¨¡å—åªåŠ è½½ä¸€æ¬¡ï¼ˆæ˜¯å•ä¾‹çš„ï¼‰ï¼Œ è‹¥å†å»åŠ è½½åŒç›®å½•ä¸‹åŒæ–‡ä»¶ï¼Œç›´æ¥ä»å†…å­˜ä¸­è¯»å–ã€‚ export ä¸ importåŸºæœ¬ ç”¨æ³• æ¨¡å—å¯¼å…¥å¯¼å‡ºå„ç§ç±»å‹çš„å˜é‡ï¼Œå¦‚å­—ç¬¦ä¸²ï¼Œæ•°å€¼ï¼Œå‡½æ•°ï¼Œç±»ã€‚ å¯¼å‡ºçš„å‡½æ•°å£°æ˜ä¸ç±»å£°æ˜å¿…é¡»è¦æœ‰åç§°ï¼ˆexport default å‘½ä»¤å¦å¤–è€ƒè™‘ï¼‰ã€‚ ä¸ä»…èƒ½å¯¼å‡ºå£°æ˜è¿˜èƒ½å¯¼å‡ºå¼•ç”¨ï¼ˆä¾‹å¦‚å‡½æ•°ï¼‰ã€‚ export å‘½ä»¤å¯ä»¥å‡ºç°åœ¨æ¨¡å—çš„ä»»ä½•ä½ç½®ï¼Œä½†å¿…éœ€å¤„äºæ¨¡å—é¡¶å±‚ã€‚ import å‘½ä»¤ä¼šæå‡åˆ°æ•´ä¸ªæ¨¡å—çš„å¤´éƒ¨ï¼Œé¦–å…ˆæ‰§è¡Œã€‚ 1234567891011121314151617/*-----export [test.js]-----*/let myName = "Tom";let myAge = 20;let myfn = function()&#123; return "My name is" + myName + "! I'm '" + myAge + "years old."&#125;let myClass = class myClass &#123; static a = "yeah!";&#125;export &#123; myName, myAge, myfn, myClass &#125; /*-----import [xxx.js]-----*/import &#123; myName, myAge, myfn, myClass &#125; from "./test.js";console.log(myfn());// My name is Tom! I'm 20 years old.console.log(myAge);// 20console.log(myName);// Tomconsole.log(myClass.a );// yeah! å»ºè®®ä½¿ç”¨å¤§æ‹¬å·æŒ‡å®šæ‰€è¦è¾“å‡ºçš„ä¸€ç»„å˜é‡å†™åœ¨æ–‡æ¡£å°¾éƒ¨ï¼Œæ˜ç¡®å¯¼å‡ºçš„æ¥å£ã€‚ å‡½æ•°ä¸ç±»éƒ½éœ€è¦æœ‰å¯¹åº”çš„åç§°ï¼Œå¯¼å‡ºæ–‡æ¡£å°¾éƒ¨ä¹Ÿé¿å…äº†æ— å¯¹åº”åç§°ã€‚ as çš„ç”¨æ³• export å‘½ä»¤å¯¼å‡ºçš„æ¥å£åç§°ï¼Œé¡»å’Œæ¨¡å—å†…éƒ¨çš„å˜é‡æœ‰ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚ å¯¼å…¥çš„å˜é‡åï¼Œé¡»å’Œå¯¼å‡ºçš„æ¥å£åç§°ç›¸åŒï¼Œå³é¡ºåºå¯ä»¥ä¸ä¸€è‡´ã€‚ 12345678910111213141516171819/*-----export [test.js]-----*/let myName = "Tom";export &#123; myName as exportName &#125; /*-----import [xxx.js]-----*/import &#123; exportName &#125; from "./test.js";console.log(exportName);// Tomä½¿ç”¨ as é‡æ–°å®šä¹‰å¯¼å‡ºçš„æ¥å£åç§°ï¼Œéšè—æ¨¡å—å†…éƒ¨çš„å˜é‡/*-----export [test1.js]-----*/let myName = "Tom";export &#123; myName &#125;/*-----export [test2.js]-----*/let myName = "Jerry";export &#123; myName &#125;/*-----import [xxx.js]-----*/import &#123; myName as name1 &#125; from "./test1.js";import &#123; myName as name2 &#125; from "./test2.js";console.log(name1);// Tomconsole.log(name2);// Jerry ä¸åŒæ¨¡å—å¯¼å‡ºæ¥å£åç§°å‘½åé‡å¤ï¼Œ ä½¿ç”¨ as é‡æ–°å®šä¹‰å˜é‡åã€‚ import å‘½ä»¤ç‰¹ç‚¹ åªè¯»å±æ€§ï¼šä¸å…è®¸åœ¨åŠ è½½æ¨¡å—çš„è„šæœ¬é‡Œé¢ï¼Œæ”¹å†™æ¥å£çš„å¼•ç”¨æŒ‡å‘ï¼Œå³å¯ä»¥æ”¹å†™ import å˜é‡ç±»å‹ä¸ºå¯¹è±¡çš„å±æ€§å€¼ï¼Œä¸èƒ½æ”¹å†™ import å˜é‡ç±»å‹ä¸ºåŸºæœ¬ç±»å‹çš„å€¼ã€‚ 12345import &#123;a&#125; from "./xxx.js"a = &#123;&#125;; // error import &#123;a&#125; from "./xxx.js"a.foo = "hello"; // a = &#123; foo : 'hello' &#125; å•ä¾‹æ¨¡å¼ï¼šå¤šæ¬¡é‡å¤æ‰§è¡ŒåŒä¸€å¥ import è¯­å¥ï¼Œé‚£ä¹ˆåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œä¸ä¼šæ‰§è¡Œå¤šæ¬¡ã€‚import åŒä¸€æ¨¡å—ï¼Œå£°æ˜ä¸åŒæ¥å£å¼•ç”¨ï¼Œä¼šå£°æ˜å¯¹åº”å˜é‡ï¼Œä½†åªæ‰§è¡Œä¸€æ¬¡ import ã€‚ 1234567import &#123; a &#125; "./xxx.js";import &#123; a &#125; "./xxx.js";// ç›¸å½“äº import &#123; a &#125; "./xxx.js"; import &#123; a &#125; from "./xxx.js";import &#123; b &#125; from "./xxx.js";// ç›¸å½“äº import &#123; a, b &#125; from "./xxx.js"; é™æ€æ‰§è¡Œç‰¹æ€§ï¼šimport æ˜¯é™æ€æ‰§è¡Œï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨è¡¨è¾¾å¼å’Œå˜é‡ã€‚ 1234567891011import &#123; "f" + "oo" &#125; from "methods";// errorlet module = "methods";import &#123; foo &#125; from module;// errorif (true) &#123; import &#123; foo &#125; from "method1";&#125; else &#123; import &#123; foo &#125; from "method2";&#125;// error export default å‘½ä»¤åŸºæœ¬å±æ€§ åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–æ¨¡å—ä¸­ï¼Œexportã€import å¯ä»¥æœ‰å¤šä¸ªï¼Œexport default ä»…æœ‰ä¸€ä¸ªã€‚ export default ä¸­çš„ default æ˜¯å¯¹åº”çš„å¯¼å‡ºæ¥å£å˜é‡ã€‚ é€šè¿‡ export æ–¹å¼å¯¼å‡ºï¼Œåœ¨å¯¼å…¥æ—¶è¦åŠ { }ï¼Œexport default åˆ™ä¸éœ€è¦ã€‚ export default å‘å¤–æš´éœ²çš„æˆå‘˜ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„å˜é‡æ¥æ¥æ”¶ã€‚ 123456var a = "My name is Tom!";export default a; // ä»…æœ‰ä¸€ä¸ªexport default var c = "error"; // errorï¼Œdefault å·²ç»æ˜¯å¯¹åº”çš„å¯¼å‡ºå˜é‡ï¼Œä¸èƒ½è·Ÿç€å˜é‡å£°æ˜è¯­å¥ import b from "./xxx.js"; // ä¸éœ€è¦åŠ &#123;&#125;ï¼Œ ä½¿ç”¨ä»»æ„å˜é‡æ¥æ”¶ å¤åˆä½¿ç”¨export å’Œ import å¤åˆä½¿ç”¨ export ä¸ import å¯ä»¥åœ¨åŒä¸€æ¨¡å—ä½¿ç”¨ï¼Œä½¿ç”¨ç‰¹ç‚¹ï¼š å¯ä»¥å°†å¯¼å‡ºæ¥å£æ”¹åï¼ŒåŒ…æ‹¬ defaultã€‚ å¤åˆä½¿ç”¨ export ä¸ import ï¼Œä¹Ÿå¯ä»¥å¯¼å‡ºå…¨éƒ¨ï¼Œå½“å‰æ¨¡å—å¯¼å‡ºçš„æ¥å£ä¼šè¦†ç›–ç»§æ‰¿å¯¼å‡ºçš„ã€‚ ES6 Promiseå¯¹è±¡æ¦‚è¿°æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚ Promise çŠ¶æ€çŠ¶æ€çš„ç‰¹ç‚¹ Promise å¼‚æ­¥æ“ä½œæœ‰ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆå·²æˆåŠŸï¼‰å’Œ rejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚é™¤äº†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚ Promise å¯¹è±¡åªæœ‰ï¼šä» pending å˜ä¸º fulfilled å’Œä» pending å˜ä¸º rejected çš„çŠ¶æ€æ”¹å˜ã€‚åªè¦å¤„äº fulfilled å’Œ rejected ï¼ŒçŠ¶æ€å°±ä¸ä¼šå†å˜äº†å³ resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚ 12345678910111213141516const p1 = new Promise(function(resolve,reject)&#123; resolve('success1'); resolve('success2');&#125;); const p2 = new Promise(function()&#123; resolve('success3'); reject('reject');&#125;); p1.then(function(value)&#123; console.log(value); // success1&#125;);p2.then(function(value)&#123; console.log(value); // success3&#125;); çŠ¶æ€çš„ç¼ºç‚¹ æ— æ³•å–æ¶ˆ Promise ï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚ å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromise å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚ å½“å¤„äº pending çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚ thenæ–¹æ³•åœ¨ JavaScript äº‹ä»¶é˜Ÿåˆ—çš„å½“å‰è¿è¡Œå®Œæˆä¹‹å‰ï¼Œå›è°ƒå‡½æ•°æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚ 1234567891011const p = new Promise(function(resolve,reject)&#123; resolve('success');&#125;); p.then(function(value)&#123; console.log(value);&#125;); console.log('first');// first// success é€šè¿‡ .then å½¢å¼æ·»åŠ çš„å›è°ƒå‡½æ•°ï¼Œä¸è®ºä»€ä¹ˆæ—¶å€™ï¼Œéƒ½ä¼šè¢«è°ƒç”¨ã€‚ é€šè¿‡å¤šæ¬¡è°ƒç”¨ .then å¯ä»¥æ·»åŠ å¤šä¸ªå›è°ƒå‡½æ•°ï¼Œ ä»–ä»¬ä¼šæŒ‰ç…§æ’å…¥é¡ºåºå¹¶ä¸”ç‹¬ç«‹è¿è¡Œ 123456789101112131415161718const p = new Promise(function(resolve,reject)&#123; resolve(1);&#125;).then(function(value)&#123; // ç¬¬ä¸€ä¸ªthen // 1 console.log(value); return value * 2;&#125;).then(function(value)&#123; // ç¬¬äºŒä¸ªthen // 2 console.log(value);&#125;).then(function(value)&#123; // ç¬¬ä¸‰ä¸ªthen // undefined console.log(value); return Promise.resolve('resolve'); &#125;).then(function(value)&#123; // ç¬¬å››ä¸ªthen // resolve console.log(value); return Promise.reject('reject'); &#125;).then(function(value)&#123; // ç¬¬äº”ä¸ªthen //reject:reject console.log('resolve:' + value);&#125;, function(err) &#123; console.log('reject:' + err);&#125;); then æ–¹æ³•å°†è¿”å›ä¸€ä¸ª resolved æˆ– rejected çŠ¶æ€çš„ Promise å¯¹è±¡ç”¨äºé“¾å¼è°ƒç”¨ï¼Œä¸” Promise å¯¹è±¡çš„å€¼å°±æ˜¯è¿™ä¸ªè¿”å›å€¼ã€‚ then æ–¹æ³•æ³¨æ„ç‚¹ ç®€ä¾¿çš„ Promise é“¾å¼ç¼–ç¨‹æœ€å¥½ä¿æŒæ‰å¹³åŒ–ï¼Œä¸è¦åµŒå¥— Promiseã€‚ æ³¨æ„æ€»æ˜¯è¿”å›æˆ–ç»ˆæ­¢ Promise é“¾ã€‚ 12345const p1 = new Promise(function(resolve,reject)&#123; resolve(1);&#125;).then(function(result) &#123; p2(result).then(newResult =&gt; p3(newResult));&#125;).then(() =&gt; p4()); åˆ›å»ºæ–° Promise ä½†å¿˜è®°è¿”å›å®ƒæ—¶ï¼Œå¯¹åº”é“¾æ¡è¢«æ‰“ç ´ï¼Œå¯¼è‡´ p4 ä¼šä¸ p2 å’Œ p3 åŒæ—¶è¿›è¡Œã€‚ å¤§å¤šæ•°æµè§ˆå™¨ä¸­ä¸èƒ½ç»ˆæ­¢çš„ Promise é“¾é‡Œçš„ rejectionï¼Œå»ºè®®åé¢éƒ½è·Ÿä¸Š .catch(error =&gt; console.log(error)); ES6 Generator å‡½æ•°ES6 æ–°å¼•å…¥äº† Generator å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ yield å…³é”®å­—ï¼ŒæŠŠå‡½æ•°çš„æ‰§è¡ŒæµæŒ‚èµ·ï¼Œä¸ºæ”¹å˜æ‰§è¡Œæµç¨‹æä¾›äº†å¯èƒ½ï¼Œä»è€Œä¸ºå¼‚æ­¥ç¼–ç¨‹æä¾›è§£å†³æ–¹æ¡ˆã€‚ åŸºæœ¬ç”¨æ³• Generator å‡½æ•°ç»„æˆGenerator æœ‰ä¸¤ä¸ªåŒºåˆ†äºæ™®é€šå‡½æ•°çš„éƒ¨åˆ†ï¼š ä¸€æ˜¯åœ¨ function åé¢ï¼Œå‡½æ•°åä¹‹å‰æœ‰ä¸ª * ï¼› å‡½æ•°å†…éƒ¨æœ‰ yield è¡¨è¾¾å¼ã€‚ å…¶ä¸­ * ç”¨æ¥è¡¨ç¤ºå‡½æ•°ä¸º Generator å‡½æ•°ï¼Œyield ç”¨æ¥å®šä¹‰å‡½æ•°å†…éƒ¨çš„çŠ¶æ€ã€‚ 12345678function* func()&#123; console.log("one"); yield '1'; console.log("two"); yield '2'; console.log("three"); return '3';&#125; æ‰§è¡Œæœºåˆ¶è°ƒç”¨ Generator å‡½æ•°å’Œè°ƒç”¨æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œåœ¨å‡½æ•°ååé¢åŠ ä¸Š()å³å¯ï¼Œä½†æ˜¯ Generator å‡½æ•°ä¸ä¼šåƒæ™®é€šå‡½æ•°ä¸€æ ·ç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€å¯¹è±¡çš„æŒ‡é’ˆï¼Œæ‰€ä»¥è¦è°ƒç”¨éå†å™¨å¯¹è±¡Iterator çš„ next æ–¹æ³•ï¼ŒæŒ‡é’ˆå°±ä¼šä»å‡½æ•°å¤´éƒ¨æˆ–è€…ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œã€‚ 1234567891011121314f.next();// one// &#123;value: "1", done: false&#125; f.next();// two// &#123;value: "2", done: false&#125; f.next();// three// &#123;value: "3", done: true&#125; f.next();// &#123;value: undefined, done: true&#125; ç¬¬ä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•æ—¶ï¼Œä» Generator å‡½æ•°çš„å¤´éƒ¨å¼€å§‹æ‰§è¡Œï¼Œå…ˆæ˜¯æ‰“å°äº† one ,æ‰§è¡Œåˆ° yield å°±åœä¸‹æ¥ï¼Œå¹¶å°†yield åè¾¹è¡¨è¾¾å¼çš„å€¼ â€˜1â€™ï¼Œä½œä¸ºè¿”å›å¯¹è±¡çš„ value å±æ€§å€¼ï¼Œæ­¤æ—¶å‡½æ•°è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œ è¿”å›å¯¹è±¡çš„ done å±æ€§å€¼æ˜¯ falseã€‚ ç¬¬äºŒæ¬¡è°ƒç”¨ next æ–¹æ³•æ—¶ï¼ŒåŒä¸Šæ­¥ ã€‚ ç¬¬ä¸‰æ¬¡è°ƒç”¨ next æ–¹æ³•æ—¶ï¼Œå…ˆæ˜¯æ‰“å°äº† three ï¼Œç„¶åæ‰§è¡Œäº†å‡½æ•°çš„è¿”å›æ“ä½œï¼Œå¹¶å°† return åé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›å¯¹è±¡çš„ value å±æ€§å€¼ï¼Œæ­¤æ—¶å‡½æ•°å·²ç»ç»“æŸï¼Œå¤šä»¥ done å±æ€§å€¼ä¸ºtrue ã€‚ ç¬¬å››æ¬¡è°ƒç”¨ next æ–¹æ³•æ—¶ï¼Œ æ­¤æ—¶å‡½æ•°å·²ç»æ‰§è¡Œå®Œäº†ï¼Œæ‰€ä»¥è¿”å› value å±æ€§å€¼æ˜¯ undefined ï¼Œdone å±æ€§å€¼æ˜¯ true ã€‚å¦‚æœæ‰§è¡Œç¬¬ä¸‰æ­¥æ—¶ï¼Œæ²¡æœ‰ return è¯­å¥çš„è¯ï¼Œå°±ç›´æ¥è¿”å› {value: undefined, done: true}ã€‚ å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡çš„æ–¹æ³•next æ–¹æ³• ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œnext æ–¹æ³•ä¸ä¼ å…¥å‚æ•°çš„æ—¶å€™ï¼Œyield è¡¨è¾¾å¼çš„è¿”å›å€¼æ˜¯ undefined ã€‚å½“ next ä¼ å…¥å‚æ•°çš„æ—¶å€™ï¼Œè¯¥å‚æ•°ä¼šä½œä¸ºä¸Šä¸€æ­¥yieldçš„è¿”å›å€¼ã€‚ 12345678function* sendParameter()&#123; console.log("strat"); var x = yield '2'; console.log("one:" + x); var y = yield '3'; console.log("two:" + y); console.log("total:" + (x + y));&#125; nextä¸ä¼ å‚ 1234567891011121314151617181920212223var sendp1 = sendParameter();sendp1.next();// strat// &#123;value: "2", done: false&#125;sendp1.next();// one:undefined// &#123;value: "3", done: false&#125;sendp1.next();// two:undefined// total:NaN// &#123;value: undefined, done: true&#125;nextä¼ å‚var sendp2 = sendParameter();sendp2.next(10);// strat// &#123;value: "2", done: false&#125;sendp2.next(20);// one:20// &#123;value: "3", done: false&#125;sendp2.next(30);// two:30// total:50// &#123;value: undefined, done: true&#125; é™¤äº†ä½¿ç”¨ next ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ forâ€¦ of å¾ªç¯éå† Generator å‡½æ•°ç”Ÿäº§çš„ Iterator å¯¹è±¡ã€‚ return æ–¹æ³• return æ–¹æ³•è¿”å›ç»™å®šå€¼ï¼Œå¹¶ç»“æŸéå† Generator å‡½æ•°ã€‚ return æ–¹æ³•æä¾›å‚æ•°æ—¶ï¼Œè¿”å›è¯¥å‚æ•°ï¼›ä¸æä¾›å‚æ•°æ—¶ï¼Œè¿”å› undefined ã€‚ 123456789101112131415161718192021222324252627282930313233function* foo()&#123; yield 1; yield 2; yield 3;&#125;var f = foo();f.next();// &#123;value: 1, done: false&#125;f.return("foo");// &#123;value: "foo", done: true&#125;f.next();// &#123;value: undefined, done: true&#125;throw æ–¹æ³•throw æ–¹æ³•å¯ä»¥å† Generator å‡½æ•°ä½“å¤–é¢æŠ›å‡ºå¼‚å¸¸ï¼Œå†å‡½æ•°ä½“å†…éƒ¨æ•è·ã€‚var g = function* () &#123; try &#123; yield; &#125; catch (e) &#123; console.log('catch inner', e); &#125;&#125;; var i = g();i.next(); try &#123; i.throw('a'); i.throw('b');&#125; catch (e) &#123; console.log('catch outside', e);&#125;// catch inner a// catch outside b éå†å™¨å¯¹è±¡æŠ›å‡ºäº†ä¸¤ä¸ªé”™è¯¯ï¼Œç¬¬ä¸€ä¸ªè¢« Generator å‡½æ•°å†…éƒ¨æ•è·ï¼Œç¬¬äºŒä¸ªå› ä¸ºå‡½æ•°ä½“å†…éƒ¨çš„catch å‡½æ•°å·²ç»æ‰§è¡Œè¿‡äº†ï¼Œä¸ä¼šå†æ•è·è¿™ä¸ªé”™è¯¯ï¼Œæ‰€ä»¥è¿™ä¸ªé”™è¯¯å°±æŠ›å‡º Generator å‡½æ•°ä½“ï¼Œè¢«å‡½æ•°ä½“å¤–çš„ catch æ•è·ã€‚ yield*è¡¨è¾¾å¼ yield* è¡¨è¾¾å¼è¡¨ç¤º yield è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨äºåœ¨ Generator å‡½æ•°å†…éƒ¨ï¼Œè°ƒç”¨å¦ä¸€ä¸ª Generator å‡½æ•°ã€‚ 1234567891011121314151617181920212223242526function* callee() &#123; console.log('callee: ' + (yield));&#125;function* caller() &#123; while (true) &#123; yield* callee(); &#125;&#125;const callerObj = caller();callerObj.next();// &#123;value: undefined, done: false&#125;callerObj.next("a");// callee: a// &#123;value: undefined, done: false&#125;callerObj.next("b");// callee: b// &#123;value: undefined, done: false&#125; // ç­‰åŒäºfunction* caller() &#123; while (true) &#123; for (var value of callee) &#123; yield value; &#125; &#125;&#125; ä½¿ç”¨åœºæ™¯å®ç°Iterator ä¸ºä¸å…·å¤‡ Iterator æ¥å£çš„å¯¹è±¡æä¾›éå†æ–¹æ³•ã€‚ 12345678910111213function* objectEntries(obj) &#123; const propKeys = Reflect.ownKeys(obj); for (const propKey of propKeys) &#123; yield [propKey, obj[propKey]]; &#125;&#125; const jane = &#123; first: 'Jane', last: 'Doe' &#125;;for (const [key,value] of objectEntries(jane)) &#123; console.log(`$&#123;key&#125;: $&#123;value&#125;`);&#125;// first: Jane// last: Doe Reflect.ownKeys() è¿”å›å¯¹è±¡æ‰€æœ‰çš„å±æ€§ï¼Œä¸ç®¡å±æ€§æ˜¯å¦å¯æšä¸¾ï¼ŒåŒ…æ‹¬ Symbolã€‚ jane åŸç”Ÿæ˜¯ä¸å…·å¤‡ Iterator æ¥å£æ— æ³•é€šè¿‡ forâ€¦ oféå†ã€‚è¿™è¾¹ç”¨äº† Generator å‡½æ•°åŠ ä¸Šäº† Iterator æ¥å£ï¼Œæ‰€ä»¥å°±å¯ä»¥éå† jane å¯¹è±¡äº†ã€‚ ES6 async å‡½æ•°asyncasync æ˜¯ ES7 æ‰æœ‰çš„ä¸å¼‚æ­¥æ“ä½œæœ‰å…³çš„å…³é”®å­—ï¼Œå’Œ Promise ï¼Œ Generator æœ‰å¾ˆå¤§å…³è”çš„ã€‚ è¯­æ³•1async function name([param[, param[, ... param]]]) &#123; statements &#125; name: å‡½æ•°åç§°ã€‚ param: è¦ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°çš„åç§°ã€‚ statements: å‡½æ•°ä½“è¯­å¥ã€‚ è¿”å›å€¼async å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ then æ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚ 123456789async function helloAsync()&#123; return "helloAsync"; &#125; console.log(helloAsync()) // Promise &#123;&lt;resolved&gt;: "helloAsync"&#125; helloAsync().then(v=&gt;&#123; console.log(v); // helloAsync&#125;) async å‡½æ•°ä¸­å¯èƒ½ä¼šæœ‰ await è¡¨è¾¾å¼ï¼Œasync å‡½æ•°æ‰§è¡Œæ—¶ï¼Œå¦‚æœé‡åˆ° await å°±ä¼šå…ˆæš‚åœæ‰§è¡Œ ï¼Œç­‰åˆ°è§¦å‘çš„å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œæ¢å¤ async å‡½æ•°çš„æ‰§è¡Œå¹¶è¿”å›è§£æå€¼ã€‚ await å…³é”®å­—ä»…åœ¨ async function ä¸­æœ‰æ•ˆã€‚å¦‚æœåœ¨ async function å‡½æ•°ä½“å¤–ä½¿ç”¨ await ï¼Œä½ åªä¼šå¾—åˆ°ä¸€ä¸ªè¯­æ³•é”™è¯¯ã€‚ 12345678910111213141516function testAwait()&#123; return new Promise((resolve) =&gt; &#123; setTimeout(function()&#123; console.log("testAwait"); resolve(); &#125;, 1000); &#125;);&#125; async function helloAsync()&#123; await testAwait(); console.log("helloAsync"); &#125;helloAsync();// testAwait// helloAsync awaitawait æ“ä½œç¬¦ç”¨äºç­‰å¾…ä¸€ä¸ª Promise å¯¹è±¡, å®ƒåªèƒ½åœ¨å¼‚æ­¥å‡½æ•° async function å†…éƒ¨ä½¿ç”¨ã€‚ è¯­æ³•1[return_value] = await expression; expression: ä¸€ä¸ª Promise å¯¹è±¡æˆ–è€…ä»»ä½•è¦ç­‰å¾…çš„å€¼ã€‚ è¿”å›å€¼è¿”å› Promise å¯¹è±¡çš„å¤„ç†ç»“æœã€‚å¦‚æœç­‰å¾…çš„ä¸æ˜¯ Promise å¯¹è±¡ï¼Œåˆ™è¿”å›è¯¥å€¼æœ¬èº«ã€‚ å¦‚æœä¸€ä¸ª Promise è¢«ä¼ é€’ç»™ä¸€ä¸ª await æ“ä½œç¬¦ï¼Œawait å°†ç­‰å¾… Promise æ­£å¸¸å¤„ç†å®Œæˆå¹¶è¿”å›å…¶å¤„ç†ç»“æœã€‚ 1234567891011121314function testAwait (x) &#123; return new Promise(resolve =&gt; &#123; setTimeout(() =&gt; &#123; resolve(x); &#125;, 2000); &#125;);&#125; async function helloAsync() &#123; var x = await testAwait ("hello world"); console.log(x); &#125;helloAsync ();// hello world æ­£å¸¸æƒ…å†µä¸‹ï¼Œawait å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå®ƒä¹Ÿå¯ä»¥è·Ÿå…¶ä»–å€¼ï¼Œå¦‚å­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼ï¼Œæ•°å€¼ä»¥åŠæ™®é€šå‡½æ•°ã€‚ 12345678910function testAwait()&#123; console.log("testAwait");&#125;async function helloAsync()&#123; await testAwait(); console.log("helloAsync");&#125;helloAsync();// testAwait// helloAsync awaité’ˆå¯¹æ‰€è·Ÿä¸åŒè¡¨è¾¾å¼çš„å¤„ç†æ–¹å¼ï¼š Promise å¯¹è±¡ï¼šawait ä¼šæš‚åœæ‰§è¡Œï¼Œç­‰å¾… Promise å¯¹è±¡ resolveï¼Œç„¶åæ¢å¤ async å‡½æ•°çš„æ‰§è¡Œå¹¶è¿”å›è§£æå€¼ã€‚ é Promise å¯¹è±¡ï¼šç›´æ¥è¿”å›å¯¹åº”çš„å€¼ã€‚]]></content>
      <categories>
        <category>webå‰ç«¯</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ES6 æ–°è¯­æ³• (ä¸€)]]></title>
    <url>%2F2019%2F07%2F09%2F03.web%E5%89%8D%E7%AB%AF%2FJavaScript%2FES6%20%E6%96%B0%E8%AF%AD%E6%B3%95(%E4%B8%80)%2F</url>
    <content type="text"><![CDATA[ECMAScriptç®€ä»‹ä»‹ç»ES6ï¼Œ å…¨ç§° ECMAScript 6.0 ï¼Œæ˜¯ JavaScript çš„ä¸‹ä¸€ä¸ªç‰ˆæœ¬æ ‡å‡†ï¼Œ2015.06 å‘ç‰ˆã€‚ ES6 ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ ES5 çš„å…ˆå¤©ä¸è¶³ï¼Œæ¯”å¦‚ JavaScript é‡Œå¹¶æ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œä½†æ˜¯ç›®å‰æµè§ˆå™¨çš„ JavaScript æ˜¯ ES5 ç‰ˆæœ¬ï¼Œå¤§å¤šæ•°é«˜ç‰ˆæœ¬çš„æµè§ˆå™¨ä¹Ÿæ”¯æŒ ES6ï¼Œä¸è¿‡åªå®ç°äº† ES6 çš„éƒ¨åˆ†ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚ ECMAScript çš„èƒŒæ™¯JavaScript æ˜¯å¤§å®¶æ‰€äº†è§£çš„è¯­è¨€åç§°ï¼Œä½†æ˜¯è¿™ä¸ªè¯­è¨€åç§°æ˜¯å•†æ ‡ï¼ˆ Oracle å…¬å¸æ³¨å†Œçš„å•†æ ‡ï¼‰ã€‚å› æ­¤ï¼ŒJavaScript çš„æ­£å¼åç§°æ˜¯ ECMAScript ã€‚1996å¹´11æœˆï¼ŒJavaScript çš„åˆ›é€ è€…ç½‘æ™¯å…¬å¸å°† JS æäº¤ç»™å›½é™…åŒ–æ ‡å‡†ç»„ç»‡ ECMAï¼ˆEuropean computer manufactures associationï¼Œæ¬§æ´²è®¡ç®—æœºåˆ¶é€ è”åˆä¼šï¼‰ï¼Œå¸Œæœ›è¿™ç§è¯­è¨€èƒ½å¤Ÿæˆä¸ºå›½é™…æ ‡å‡†ï¼Œéšå ECMA å‘å¸ƒäº†è§„å®šæµè§ˆå™¨è„šæœ¬è¯­è¨€çš„æ ‡å‡†ï¼Œå³ ECMAScriptã€‚è¿™ä¹Ÿæœ‰åˆ©äºè¿™é—¨è¯­è¨€çš„å¼€æ”¾å’Œä¸­ç«‹ã€‚ ECMAScriptçš„å†å²ES6 æ˜¯ ECMAScript æ ‡å‡†åä½™å¹´æ¥å˜åŠ¨æœ€å¤§çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¸ºå…¶æ·»åŠ äº†è®¸å¤šæ–°çš„è¯­æ³•ç‰¹æ€§ã€‚ 1997 å¹´ ECMAScript 1.0 è¯ç”Ÿã€‚ 1998 å¹´ 6 æœˆ ECMAScript 2.0 è¯ç”Ÿï¼ŒåŒ…å«ä¸€äº›å°çš„æ›´æ”¹ï¼Œç”¨äºåŒæ­¥ç‹¬ç«‹çš„ ISO å›½é™…æ ‡å‡†ã€‚ 1999 å¹´ 12 æœˆ ECMAScript 3.0è¯ç”Ÿï¼Œå®ƒæ˜¯ä¸€ä¸ªå·¨å¤§çš„æˆåŠŸï¼Œåœ¨ä¸šç•Œå¾—åˆ°äº†å¹¿æ³›çš„æ”¯æŒï¼Œå®ƒå¥ å®šäº† JS çš„åŸºæœ¬è¯­æ³•ï¼Œè¢«å…¶åç‰ˆæœ¬å®Œå…¨ç»§æ‰¿ã€‚ç›´åˆ°ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å­¦ä¹  JS ï¼Œå…¶å®å°±æ˜¯åœ¨å­¦ 3.0 ç‰ˆçš„è¯­æ³•ã€‚ 2000 å¹´çš„ ECMAScript 4.0 æ˜¯å½“ä¸‹ ES6 çš„å‰èº«ï¼Œä½†ç”±äºè¿™ä¸ªç‰ˆæœ¬å¤ªè¿‡æ¿€çƒˆï¼Œå¯¹ ES 3 åšäº†å½»åº•å‡çº§ï¼Œæ‰€ä»¥æš‚æ—¶è¢«â€å’Œè°â€äº†ã€‚ 2009 å¹´ 12 æœˆï¼ŒECMAScript 5.0 ç‰ˆæ­£å¼å‘å¸ƒã€‚ECMA ä¸“å®¶ç»„é¢„è®¡ ECMAScript çš„ç¬¬äº”ä¸ªç‰ˆæœ¬ä¼šåœ¨ 2013 å¹´ä¸­æœŸåˆ° 2018 å¹´ä½œä¸ºä¸»æµçš„å¼€å‘æ ‡å‡†ã€‚2011å¹´6æœˆï¼ŒES 5.1 ç‰ˆå‘å¸ƒï¼Œå¹¶ä¸”æˆä¸º ISO å›½é™…æ ‡å‡†ã€‚ 2013 å¹´ï¼ŒES6 è‰æ¡ˆå†»ç»“ï¼Œä¸å†æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œæ–°çš„åŠŸèƒ½å°†è¢«æ”¾åˆ° ES7 ä¸­ï¼›2015å¹´6æœˆï¼Œ ES6 æ­£å¼é€šè¿‡ï¼Œæˆä¸ºå›½é™…æ ‡å‡†ã€‚ webpackwebpackä»‹ç»webpack æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å™¨ (module bundler) ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾ (dependency graph) ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª bundle ã€‚ webçš„æ˜¯ä¸ªæ ¸å¿ƒæ¦‚å¿µ å…¥å£ (entry) è¾“å‡º (output) loader æ’ä»¶ (plugins) å…¥å£(entry)å…¥å£ä¼šæŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹ã€‚è¿›å…¥å…¥å£èµ·ç‚¹åï¼Œwebpack ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œåº“æ˜¯å…¥å£èµ·ç‚¹ï¼ˆç›´æ¥å’Œé—´æ¥ï¼‰ä¾èµ–çš„ã€‚åœ¨ webpack ä¸­å…¥å£æœ‰å¤šç§æ–¹å¼æ¥å®šä¹‰ï¼Œå¦‚ä¸‹é¢ä¾‹å­ï¼š 12345678910// å•ä¸ªå…¥å£ï¼ˆç®€å†™ï¼‰è¯­æ³•:const config = &#123; entry: "./src/main.js"&#125;// å¯¹è±¡è¯­æ³•:const config = &#123; app: "./src/main.js", vendors: "./src/vendors.js"&#125; è¾“å‡º(output)output å±æ€§ä¼šå‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒåˆ›å»ºçš„ bundles ï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶ï¼Œé»˜è®¤å€¼ä¸º ./dist: 1234567const config = &#123; entry: "./src/main.js", output: &#123; filename: "bundle.js", path: path.resolve(__dirname, 'dist') &#125;&#125; loaderloader è®© webpack å¯ä»¥å»å¤„ç†é‚£äº›é JavaScript æ–‡ä»¶ï¼ˆ webpack è‡ªèº«åªç†è§£ JavaScript ï¼‰ã€‚loader å¯ä»¥å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶è½¬æ¢ä¸º webpack èƒ½å¤Ÿæœ‰æ•ˆå¤„ç†çš„æ¨¡å—ï¼Œä¾‹å¦‚ï¼Œå¼€å‘çš„æ—¶å€™ä½¿ç”¨ ES6 ï¼Œé€šè¿‡ loader å°† ES6 çš„è¯­æ³•è½¬ä¸º ES5 ï¼Œå¦‚ä¸‹é…ç½®ï¼š 12345678910111213141516171819const config = &#123; entry: "./src/main.js", output: &#123; filename: "bundle.js", path: path.resolve(__dirname, 'dist') &#125;, module: &#123; rules: [ &#123; test: /\.js$/, exclude: /node_modules/, loader: "babel-loader", options: [ presets: ["env"] ] &#125; ] &#125;&#125; æ’ä»¶(plugins)loader è¢«ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—ï¼Œè€Œæ’ä»¶åˆ™å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚åŒ…æ‹¬æ‰“åŒ…ä¼˜åŒ–ã€å‹ç¼©ã€å®šä¹‰ç¯å¢ƒå˜é‡ç­‰ç­‰ã€‚æ’ä»¶çš„åŠŸèƒ½å¼ºå¤§ï¼Œæ˜¯ webpack æ‰©å±•éå¸¸é‡è¦çš„åˆ©å™¨ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†å„ç§å„æ ·çš„ä»»åŠ¡ã€‚ä½¿ç”¨ä¸€ä¸ªæ’ä»¶ä¹Ÿéå¸¸å®¹æ˜“ï¼Œåªéœ€è¦ require() ï¼Œç„¶åæ·»åŠ åˆ° plugins æ•°ç»„ä¸­ã€‚ 12345678910111213141516171819// é€šè¿‡ npm å®‰è£…const HtmlWebpackPlugin = require('html-webpack-plugin');// ç”¨äºè®¿é—®å†…ç½®æ’ä»¶ const webpack = require('webpack'); const config = &#123; module: &#123; rules: [ &#123; test: /\.js$/, exclude: /node_modules/, loader: "babel-loader" &#125; ] &#125;, plugins: [ new HtmlWebpackPlugin(&#123;template: './src/index.html'&#125;) ]&#125;; åˆ©ç”¨ webpack æ­å»ºåº”ç”¨1234567891011121314151617181920212223242526const path = require('path'); module.exports = &#123; mode: "development", // "production" | "development" // é€‰æ‹© development ä¸ºå¼€å‘æ¨¡å¼ï¼Œ production ä¸ºç”Ÿäº§æ¨¡å¼ entry: "./src/main.js", output: &#123; filename: "bundle.js", path: path.resolve(__dirname, 'dist') &#125;, module: &#123; rules: [ &#123; test: /\.js$/, exclude: /node_modules/, loader: "babel-loader", options: [ presets: ["env"] ] &#125; ] &#125;, plugins: [ ... ]&#125; ES6 æ–°è¯­æ³•ç‰¹æ€§let ä¸ constlet çš„ä½¿ç”¨æ–¹æ³• let ç”Ÿå‘½çš„æ˜¯å—çº§çš„å˜é‡ï¼Œå£°æ˜çš„å˜é‡åªåœ¨ let å‘½ä»¤æ‰€åœ¨çš„ä»£ç å—å†…æœ‰æ•ˆã€‚ 1234567891011121314151617181920212223242526&#123; let a = 0; a // 0&#125;a // æŠ¥é”™ ReferenceError: a is not defined&#123; let a = 0; var b = 1;&#125;a // ReferenceError: a is not definedb // 1// for å¾ªç¯è®¡æ•°å™¨å¾ˆé€‚åˆç”¨ letfor (var i = 0; i &lt; 10; i++) &#123; setTimeout(function()&#123; console.log(i); &#125;)&#125;// è¾“å‡ºåä¸ª 10for (let j = 0; j &lt; 10; j++) &#123; setTimeout(function()&#123; console.log(j); &#125;)&#125;// è¾“å‡º 0123456789 å˜é‡ i æ˜¯ç”¨ var å£°æ˜çš„ï¼Œåœ¨å…¨å±€èŒƒå›´å†…æœ‰æ•ˆï¼Œæ‰€ä»¥å…¨å±€ä¸­åªæœ‰ä¸€ä¸ªå˜é‡ i, æ¯æ¬¡å¾ªç¯æ—¶ï¼ŒsetTimeout å®šæ—¶å™¨é‡Œé¢çš„ i æŒ‡çš„æ˜¯å…¨å±€å˜é‡ i ï¼Œè€Œå¾ªç¯é‡Œçš„åä¸ª setTimeout æ˜¯åœ¨å¾ªç¯ç»“æŸåæ‰æ‰§è¡Œï¼Œæ‰€ä»¥æ­¤æ—¶çš„ i éƒ½æ˜¯ 10ã€‚ å˜é‡ j æ˜¯ç”¨ let å£°æ˜çš„ï¼Œå½“å‰çš„ i åªåœ¨æœ¬è½®å¾ªç¯ä¸­æœ‰æ•ˆï¼Œæ¯æ¬¡å¾ªç¯çš„ j å…¶å®éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œæ‰€ä»¥ setTimeout å®šæ—¶å™¨é‡Œé¢çš„ j å…¶å®æ˜¯ä¸åŒçš„å˜é‡ï¼Œå³æœ€åè¾“å‡º12345ã€‚ï¼ˆè‹¥æ¯æ¬¡å¾ªç¯çš„å˜é‡ j éƒ½æ˜¯é‡æ–°å£°æ˜çš„ï¼Œå¦‚ä½•çŸ¥é“å‰ä¸€ä¸ªå¾ªç¯çš„å€¼ï¼Ÿè¿™æ˜¯å› ä¸º JavaScript å¼•æ“å†…éƒ¨ä¼šè®°ä½å‰ä¸€ä¸ªå¾ªç¯çš„å€¼ï¼‰ã€‚ letçš„ç‰¹ç‚¹ let å£°æ˜çš„å˜é‡ä»£ç å—å†…æœ‰æ•ˆï¼› ä¸èƒ½é‡å¤å£°æ˜ï¼› ä¸å­˜åœ¨å˜é‡æå‡ï¼Œåœ¨å£°æ˜ä¹‹å‰é¥®ç”¨ä¼šæŠ¥é”™ï¼› const å‘½ä»¤const å£°æ˜ä¸€ä¸ªåªè¯»å˜é‡ï¼Œå£°æ˜ä¹‹åä¸å…è®¸æ”¹å˜ã€‚æ„å‘³ç€ï¼Œä¸€æ—¦å£°æ˜å¿…é¡»åˆå§‹åŒ–ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ åŸºæœ¬ç”¨æ³• 1234const PI = "3.1415926";PI // 3.1415926const MY_AGE; // SyntaxError: Missing initializer in const declaration æš‚æ—¶æ€§æ­»åŒº 12345var PI = "a";if(true)&#123; console.log(PI); // ReferenceError: PI is not defined const PI = "3.1415926";&#125; ES6 æ˜ç¡®è§„å®šï¼Œä»£ç å—å†…å¦‚æœå­˜åœ¨ let æˆ–è€… constï¼Œä»£ç å—ä¼šå¯¹è¿™äº›å‘½ä»¤å£°æ˜çš„å˜é‡ä»å—çš„å¼€å§‹å°±å½¢æˆä¸€ä¸ªå°é—­ä½œç”¨åŸŸã€‚ä»£ç å—å†…ï¼Œåœ¨å£°æ˜å˜é‡ PI ä¹‹å‰ä½¿ç”¨å®ƒä¼šæŠ¥é”™ã€‚ è§£æ„èµ‹å€¼æ¦‚å¿µè§£æ„èµ‹å€¼æ˜¯å¯¹èµ‹å€¼è¿ç®—ç¬¦çš„æ‰©å±•ã€‚ ä»–æ˜¯ä¸€ç§é’ˆå¯¹æ•°ç»„æˆ–è€…å¯¹è±¡è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼Œç„¶åå¯¹å…¶ä¸­çš„å˜é‡è¿›è¡Œèµ‹å€¼ã€‚ åœ¨ä»£ç ä¹¦å†™ä¸Šç®€æ´ä¸”æ˜“è¯»ï¼Œè¯­ä¹‰æ›´åŠ æ¸…æ™°æ˜äº†ï¼›ä¹Ÿæ–¹ä¾¿äº†å¤æ‚å¯¹è±¡ä¸­æ•°æ®å­—æ®µè·å–ã€‚ è§£æ„æ¨¡å‹åœ¨è§£æ„ä¸­ï¼Œæœ‰ä¸‹é¢ä¸¤éƒ¨åˆ†å‚ä¸ï¼š è§£æ„çš„æºï¼Œè§£æ„èµ‹å€¼è¡¨è¾¾å¼çš„å³è¾¹éƒ¨åˆ†ã€‚è§£æ„çš„ç›®æ ‡ï¼Œè§£æ„èµ‹å€¼è¡¨è¾¾å¼çš„å·¦è¾¹éƒ¨åˆ†ã€‚ æ•°ç»„æ¨¡å‹çš„è§£æ„(Array)åŸºæœ¬ 1let [a, b, c] = [1, 2, 3]; // a = 1 // b = 2 // c = 3 å¯åµŒå¥— 1let [a, [[b], c]] = [1, [[2], 3]]; // a = 1 // b = 2 // c = 3 å¯å¿½ç•¥ 1let [a, , b] = [1, 2, 3]; // a = 1 // b = 3 ä¸å®Œå…¨è§£æ„ 1let [a = 1, b] = []; // a = 1, b = undefined å‰©ä½™è¿ç®—ç¬¦ 1let [a, ...b] = [1, 2, 3]; //a = 1 //b = [2, 3] å­—ç¬¦ä¸²ç­‰ åœ¨æ•°ç»„çš„è§£æ„ä¸­ï¼Œè§£æ„çš„ç›®æ ‡è‹¥ä¸ºå¯éå†å¯¹è±¡ï¼Œçš†å¯è¿›è¡Œè§£æ„èµ‹å€¼ã€‚å¯éå†å¯¹è±¡å³å®ç° Iterator æ¥å£çš„æ•°æ®ã€‚ 1let [a, b, c, d, e] = 'hello'; // a = 'h' // b = 'e' // c = 'l' // d = 'l' // e = 'o' è§£æ„é»˜è®¤å€¼ 123let [a = 2] = [undefined]; // a = 2// å½“è§£æ„æ¨¡å¼æœ‰åŒ¹é…ç»“æœï¼Œä¸”åŒ¹é…ç»“æœæ˜¯ undefined æ—¶ï¼Œä¼šè§¦å‘é»˜è®¤å€¼ä½œä¸ºè¿”å›ç»“æœã€‚ 12345678let [a = 3, b = a] = []; // a = 3, b = 3 let [a = 3, b = a] = [1]; // a = 1, b = 1 let [a = 3, b = a] = [1, 2]; // a = 1, b = 2// a ä¸ b åŒ¹é…ç»“æœä¸º undefined ï¼Œè§¦å‘é»˜è®¤å€¼ï¼ša = 3; b = a =3// a æ­£å¸¸è§£æ„èµ‹å€¼ï¼ŒåŒ¹é…ç»“æœï¼ša = 1ï¼Œb åŒ¹é…ç»“æœ undefined ï¼Œè§¦å‘é»˜è®¤å€¼ï¼šb = a =1// a ä¸ b æ­£å¸¸è§£æ„èµ‹å€¼ï¼ŒåŒ¹é…ç»“æœï¼ša = 1ï¼Œb = 2 å¯¹è±¡æ¨¡å‹çš„è§£æ„ï¼ˆObjectï¼‰åŸºæœ¬ 123456789let &#123; foo, bar &#125; = &#123; foo: 'aaa', bar: 'bbb' &#125;; // foo = 'aaa' // bar = 'bbb' let &#123; baz : foo &#125; = &#123; baz : 'ddd' &#125;; // foo = 'ddd' å¯åµŒå¥—å¯å¿½ç•¥ 12345678910111213let obj = &#123;p: ['hello', &#123;y: 'world'&#125;] &#125;; let &#123;p: [x, &#123; y &#125;] &#125; = obj;// x = 'hello' // y = 'world' let obj = &#123;p: ['hello', &#123;y: 'world'&#125;] &#125;; let &#123;p: [x, &#123; &#125;] &#125; = obj; // x = 'hello' ä¸å®Œå…¨è§£æ„ 1234567let obj = &#123;p: [&#123;y: 'world'&#125;] &#125;; let &#123;p: [&#123; y &#125;, x ] &#125; = obj; // x = undefined // y = 'world' å‰©ä½™è¿ç®—ç¬¦ 1234567let &#123;a, b, ...rest&#125; = &#123;a: 10, b: 20, c: 30, d: 40&#125;; // a = 10 // b = 20 // rest = &#123;c: 30, d: 40&#125; è§£æ„é»˜è®¤å€¼ 1234567let &#123;a = 10, b = 5&#125; = &#123;a: 3&#125;; // a = 3; b = 5; let &#123;a: aa = 10, b: bb = 5&#125; = &#123;a: 3&#125;; // aa = 3; bb = 5; ES6 Symbolæ¦‚è¿°ES6 å¼•å…¥äº†ä¸€ç§æ–°çš„åŸå§‹æ•°æ®ç±»å‹ Symbol ï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ï¼Œæœ€å¤§çš„ç”¨æ³•æ˜¯ç”¨æ¥å®šä¹‰å¯¹è±¡çš„å”¯ä¸€å±æ€§åã€‚ ES6 æ•°æ®ç±»å‹é™¤äº† Number ã€ String ã€ Boolean ã€ Objec tã€ null å’Œ undefined ï¼Œè¿˜æ–°å¢äº† Symbol ã€‚ åŸºæœ¬ç”¨æ³•Symbol å‡½æ•°æ ˆä¸èƒ½ç”¨ new å‘½ä»¤ï¼Œå› ä¸º Symbol æ˜¯åŸå§‹æ•°æ®ç±»å‹ï¼Œä¸æ˜¯å¯¹è±¡ã€‚å¯ä»¥æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œä¸ºæ–°åˆ›å»ºçš„ Symbol æä¾›æè¿°ï¼Œç”¨æ¥æ˜¾ç¤ºåœ¨æ§åˆ¶å°æˆ–è€…ä½œä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™ä½¿ç”¨ï¼Œä¾¿äºåŒºåˆ†ã€‚ 1234567let sy = Symbol("KK");console.log(sy); // Symbol(KK)typeof(sy); // "symbol" // ç›¸åŒå‚æ•° Symbol() è¿”å›çš„å€¼ä¸ç›¸ç­‰let sy1 = Symbol("kk"); sy === sy1; // false ä½¿ç”¨åœºæ™¯ä½œä¸ºå±æ€§å ç”±äºæ¯ä¸€ä¸ª Symbol çš„å€¼éƒ½æ˜¯ä¸ç›¸ç­‰çš„ï¼Œæ‰€ä»¥ Symbol ä½œä¸ºå¯¹è±¡çš„å±æ€§åï¼Œå¯ä»¥ä¿è¯å±æ€§ä¸é‡åã€‚ 1234567891011121314151617let sy = Symbol("key1"); // å†™æ³•1let syObject = &#123;&#125;;syObject[sy] = "kk";console.log(syObject); // &#123;Symbol(key1): "kk"&#125; // å†™æ³•2let syObject = &#123; [sy]: "kk"&#125;;console.log(syObject); // &#123;Symbol(key1): "kk"&#125; // å†™æ³•3let syObject = &#123;&#125;;Object.defineProperty(syObject, sy, &#123;value: "kk"&#125;);console.log(syObject); // &#123;Symbol(key1): "kk"&#125; Symbol ä½œä¸ºå¯¹è±¡å±æ€§åæ—¶ä¸èƒ½ç”¨.è¿ç®—ç¬¦ï¼Œè¦ç”¨æ–¹æ‹¬å·ã€‚å› ä¸º.è¿ç®—ç¬¦åé¢æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å–åˆ°çš„æ˜¯å­—ç¬¦ä¸² sy å±æ€§ï¼Œè€Œä¸æ˜¯ Symbol å€¼ sy å±æ€§ã€‚ 12345let syObject = &#123;&#125;;syObject[sy] = "kk"; syObject[sy]; // "kk"syObject.sy; // undefined æ³¨æ„ç‚¹ Symbol å€¼ä½œä¸ºå±æ€§åæ—¶ï¼Œè¯¥å±æ€§æ˜¯å…¬æœ‰å±æ€§ä¸æ˜¯ç§æœ‰å±æ€§ï¼Œå¯ä»¥åœ¨ç±»çš„å¤–éƒ¨è®¿é—®ã€‚ä½†æ˜¯ä¸ä¼šå‡ºç°åœ¨ forâ€¦in ã€ forâ€¦of çš„å¾ªç¯ä¸­ï¼Œä¹Ÿä¸ä¼šè¢« Object.keys() ã€ Object.getOwnPropertyNames() è¿”å›ã€‚å¦‚æœè¦è¯»å–åˆ°ä¸€ä¸ªå¯¹è±¡çš„ Symbol å±æ€§ï¼Œå¯ä»¥é€šè¿‡ Object.getOwnPropertySymbols() å’Œ Reflect.ownKeys() å–åˆ°ã€‚ 1234567891011let syObject = &#123;&#125;;syObject[sy] = "kk";console.log(syObject); for (let i in syObject) &#123; console.log(i);&#125; // æ— è¾“å‡º Object.keys(syObject); // []Object.getOwnPropertySymbols(syObject); // [Symbol(key1)]Reflect.ownKeys(syObject); // [Symbol(key1)] å®šä¹‰å¸¸é‡ åœ¨ ES5 ä½¿ç”¨å­—ç¬¦ä¸²è¡¨ç¤ºå¸¸é‡ã€‚ä¾‹å¦‚ï¼š 123const COLOR_RED = "red";const COLOR_YELLOW = "yellow";const COLOR_BLUE = "blue"; ä½†æ˜¯ç”¨å­—ç¬¦ä¸²ä¸èƒ½ä¿è¯å¸¸é‡æ˜¯ç‹¬ç‰¹çš„ï¼Œè¿™æ ·ä¼šå¼•èµ·ä¸€äº›é—®é¢˜ï¼š 12345678910111213141516171819const COLOR_RED = "red";const COLOR_YELLOW = "yellow";const COLOR_BLUE = "blue";const MY_BLUE = "blue"ï¼› function getConstantName(color) &#123; switch (color) &#123; case COLOR_RED : return "COLOR_RED"; case COLOR_YELLOW : return "COLOR_YELLOW "; case COLOR_BLUE: return "COLOR_BLUE"; case MY_BLUE: return "MY_BLUE"; default: throw new Exception('Can't find this color'); &#125;&#125; ä½†æ˜¯ä½¿ç”¨ Symbol å®šä¹‰å¸¸é‡ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯è¿™ä¸€ç»„å¸¸é‡çš„å€¼éƒ½ä¸ç›¸ç­‰ã€‚ç”¨ Symbol æ¥ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­ã€‚ 12345678910111213141516const COLOR_RED = Symbol("red");const COLOR_YELLOW = Symbol("yellow");const COLOR_BLUE = Symbol("blue"); function getConstantName(color) &#123; switch (color) &#123; case COLOR_RED : return "COLOR_RED"; case COLOR_YELLOW : return "COLOR_YELLOW "; case COLOR_BLUE: return "COLOR_BLUE"; default: throw new Exception('Can't find this color'); &#125;&#125; Symbol çš„å€¼æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ç›¸åŒå€¼å¾—å¸¸é‡ï¼Œå³å¯ä»¥ä¿è¯ switch æŒ‰ç…§ä»£ç é¢„æƒ³çš„æ–¹å¼æ‰§è¡Œã€‚ *Symbol.for() * Symbol.for() ç±»ä¼¼å•ä¾‹æ¨¡å¼ï¼Œé¦–å…ˆä¼šåœ¨å…¨å±€æœç´¢è¢«ç™»è®°çš„ Symbol ä¸­æ˜¯å¦æœ‰è¯¥å­—ç¬¦ä¸²å‚æ•°ä½œä¸ºåç§°çš„ Symbol å€¼ï¼Œå¦‚æœæœ‰å³è¿”å›è¯¥ Symbol å€¼ï¼Œè‹¥æ²¡æœ‰åˆ™æ–°å»ºå¹¶è¿”å›ä¸€ä¸ªä»¥è¯¥å­—ç¬¦ä¸²å‚æ•°ä¸ºåç§°çš„ Symbol å€¼ï¼Œå¹¶ç™»è®°åœ¨å…¨å±€ç¯å¢ƒä¸­ä¾›æœç´¢ã€‚ 123456let yellow = Symbol("Yellow");let yellow1 = Symbol.for("Yellow");yellow === yellow1; // false let yellow2 = Symbol.for("Yellow");yellow1 === yellow2; // true Symbol.keyFor() 12let yellow1 = Symbol.for("Yellow");Symbol.keyFor(yellow1); // "Yellow" ES6 Map ä¸ SetMap å¯¹è±¡Map å¯¹è±¡ä¿å­˜é”®å€¼å¯¹ã€‚ä»»ä½•å€¼(å¯¹è±¡æˆ–è€…åŸå§‹å€¼) éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªé”®æˆ–ä¸€ä¸ªå€¼ã€‚ Maps ä¸Objects çš„åŒºåˆ« ä¸€ä¸ª Object çš„é”®åªèƒ½æ˜¯å­—ç¬¦ä¸²æˆ–è€… Symbolsï¼Œä½†ä¸€ä¸ª Map çš„é”®å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚ Map ä¸­çš„é”®å€¼æ˜¯æœ‰åºçš„ï¼ˆFIFO åŸåˆ™ï¼‰ï¼Œè€Œæ·»åŠ åˆ°å¯¹è±¡ä¸­çš„é”®åˆ™ä¸æ˜¯ã€‚ Map çš„é”®å€¼å¯¹ä¸ªæ•°å¯ä»¥ä» size å±æ€§è·å–ï¼Œè€Œ Object çš„é”®å€¼å¯¹ä¸ªæ•°åªèƒ½æ‰‹åŠ¨è®¡ç®—ã€‚ Object éƒ½æœ‰è‡ªå·±çš„åŸå‹ï¼ŒåŸå‹é“¾ä¸Šçš„é”®åæœ‰å¯èƒ½å’Œä½ è‡ªå·±åœ¨å¯¹è±¡ä¸Šçš„è®¾ç½®çš„é”®åäº§ç”Ÿå†²çªã€‚ Map ä¸­çš„keykey æ˜¯å­—ç¬¦ä¸² 123456789var myMap = new Map(); var keyString = "a string"; myMap.set(keyString, "å’Œé”®'a string'å…³è”çš„å€¼"); myMap.get(keyString); // "å’Œé”®'a string'å…³è”çš„å€¼" myMap.get("a string"); // "å’Œé”®'a string'å…³è”çš„å€¼" ï¼Œå› ä¸º keyString === 'a string' key æ˜¯å¯¹è±¡ 123456789var myMap = new Map(); var keyObj = &#123;&#125; myMap.set(keyObj, "å’Œé”® keyObj å…³è”çš„å€¼"); myMap.get(keyObj); // "å’Œé”® keyObj å…³è”çš„å€¼" myMap.get(&#123;&#125;); // undefined, å› ä¸º keyObj !== &#123;&#125; key æ˜¯å‡½æ•° 123456789var myMap = new Map(); var keyFunc = function () &#123;&#125;, // å‡½æ•° myMap.set(keyFunc, "å’Œé”® keyFunc å…³è”çš„å€¼"); myMap.get(keyFunc); // "å’Œé”® keyFunc å…³è”çš„å€¼" myMap.get(function() &#123;&#125;) // undefined, å› ä¸º keyFunc !== function () &#123;&#125; key æ˜¯ NaN 12345678910var myMap = new Map(); myMap.set(NaN, "not a number"); myMap.get(NaN); // "not a number" var otherNaN = Number("foo"); myMap.get(otherNaN); // "not a number"// è™½ç„¶ NaN å’Œä»»ä½•å€¼ç”šè‡³å’Œè‡ªå·±éƒ½ä¸ç›¸ç­‰(NaN !== NaN è¿”å›true)ï¼ŒNaNä½œä¸ºMapçš„é”®æ¥è¯´æ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚ Map çš„è¿­ä»£forâ€¦of 123456789101112131415161718192021222324var myMap = new Map();myMap.set(0, "zero");myMap.set(1, "one"); // å°†ä¼šæ˜¾ç¤ºä¸¤ä¸ª logã€‚ ä¸€ä¸ªæ˜¯ "0 = zero" å¦ä¸€ä¸ªæ˜¯ "1 = one"for (var [key, value] of myMap) &#123; console.log(key + " = " + value);&#125;for (var [key, value] of myMap.entries()) &#123; console.log(key + " = " + value);&#125;/* è¿™ä¸ª entries æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Iterator å¯¹è±¡ï¼Œå®ƒæŒ‰æ’å…¥é¡ºåºåŒ…å«äº† Map å¯¹è±¡ä¸­æ¯ä¸ªå…ƒç´ çš„ [key, value] æ•°ç»„ã€‚ */ // å°†ä¼šæ˜¾ç¤ºä¸¤ä¸ªlogã€‚ ä¸€ä¸ªæ˜¯ "0" å¦ä¸€ä¸ªæ˜¯ "1"for (var key of myMap.keys()) &#123; console.log(key);&#125;/* è¿™ä¸ª keys æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Iterator å¯¹è±¡ï¼Œ å®ƒæŒ‰æ’å…¥é¡ºåºåŒ…å«äº† Map å¯¹è±¡ä¸­æ¯ä¸ªå…ƒç´ çš„é”®ã€‚ */ // å°†ä¼šæ˜¾ç¤ºä¸¤ä¸ªlogã€‚ ä¸€ä¸ªæ˜¯ "zero" å¦ä¸€ä¸ªæ˜¯ "one"for (var value of myMap.values()) &#123; console.log(value);&#125;/* è¿™ä¸ª values æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Iterator å¯¹è±¡ï¼Œå®ƒæŒ‰æ’å…¥é¡ºåºåŒ…å«äº† Map å¯¹è±¡ä¸­æ¯ä¸ªå…ƒç´ çš„å€¼ã€‚ */ forEach 12345678var myMap = new Map();myMap.set(0, "zero");myMap.set(1, "one"); // å°†ä¼šæ˜¾ç¤ºä¸¤ä¸ª logsã€‚ ä¸€ä¸ªæ˜¯ "0 = zero" å¦ä¸€ä¸ªæ˜¯ "1 = one"myMap.forEach(function(value, key) &#123; console.log(key + " = " + value);&#125;, myMap) Mapå¯¹è±¡çš„æ“ä½œMap ä¸ Arrayçš„è½¬æ¢ 1234567var kvArray = [["key1", "value1"], ["key2", "value2"]]; // Map æ„é€ å‡½æ•°å¯ä»¥å°†ä¸€ä¸ª äºŒç»´ é”®å€¼å¯¹æ•°ç»„è½¬æ¢æˆä¸€ä¸ª Map å¯¹è±¡var myMap = new Map(kvArray); // ä½¿ç”¨ Array.from å‡½æ•°å¯ä»¥å°†ä¸€ä¸ª Map å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªäºŒç»´é”®å€¼å¯¹æ•°ç»„var outArray = Array.from(myMap); Map çš„å…‹éš† 12345var myMap1 = new Map([["key1", "value1"], ["key2", "value2"]]);var myMap2 = new Map(myMap1); console.log(original === clone); // æ‰“å° falseã€‚ Map å¯¹è±¡æ„é€ å‡½æ•°ç”Ÿæˆå®ä¾‹ï¼Œè¿­ä»£å‡ºæ–°çš„å¯¹è±¡ã€‚ Map çš„åˆå¹¶ 12345var first = new Map([[1, 'one'], [2, 'two'], [3, 'three'],]);var second = new Map([[1, 'uno'], [2, 'dos']]); // åˆå¹¶ä¸¤ä¸ª Map å¯¹è±¡æ—¶ï¼Œå¦‚æœæœ‰é‡å¤çš„é”®å€¼ï¼Œåˆ™åé¢çš„ä¼šè¦†ç›–å‰é¢çš„ï¼Œå¯¹åº”å€¼å³ unoï¼Œdosï¼Œ threevar merged = new Map([...first, ...second]); Set å¯¹è±¡Set å¯¹è±¡å…è®¸ä½ å­˜å‚¨ä»»ä½•ç±»å‹çš„å”¯ä¸€å€¼ï¼Œæ— è®ºæ˜¯åŸå§‹å€¼æˆ–è€…æ˜¯å¯¹è±¡å¼•ç”¨ã€‚ Set ä¸­çš„ç‰¹æ®Šå€¼ Set å¯¹è±¡å­˜å‚¨çš„å€¼æ€»æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦æ’ç­‰ã€‚æœ‰å‡ ä¸ªç‰¹æ®Šå€¼éœ€è¦ç‰¹æ®Šå¯¹å¾…ï¼š +0 ä¸ -0 åœ¨å­˜å‚¨åˆ¤æ–­å”¯ä¸€æ€§çš„æ—¶å€™æ˜¯æ’ç­‰çš„ï¼Œæ‰€ä»¥ä¸é‡å¤ï¼› undefined ä¸ undefined æ˜¯æ’ç­‰çš„ï¼Œæ‰€ä»¥ä¸é‡å¤ï¼› NaN ä¸ NaN æ˜¯ä¸æ’ç­‰çš„ï¼Œä½†æ˜¯åœ¨ Set ä¸­åªèƒ½å­˜ä¸€ä¸ªï¼Œä¸é‡å¤ã€‚ åŸºæœ¬ä½¿ç”¨ 123456789101112let mySet = new Set(); mySet.add(1); // Set(1) &#123;1&#125;mySet.add(5); // Set(2) &#123;1, 5&#125;mySet.add(5); // Set(2) &#123;1, 5&#125; è¿™é‡Œä½“ç°äº†å€¼çš„å”¯ä¸€æ€§mySet.add("some text"); // Set(3) &#123;1, 5, "some text"&#125; è¿™é‡Œä½“ç°äº†ç±»å‹çš„å¤šæ ·æ€§var o = &#123;a: 1, b: 2&#125;; mySet.add(o);mySet.add(&#123;a: 1, b: 2&#125;); // Set(5) &#123;1, 5, "some text", &#123;â€¦&#125;, &#123;â€¦&#125;&#125; // è¿™é‡Œä½“ç°äº†å¯¹è±¡ä¹‹é—´å¼•ç”¨ä¸åŒä¸æ’ç­‰ï¼Œå³ä½¿å€¼ç›¸åŒï¼ŒSet ä¹Ÿèƒ½å­˜å‚¨ Set ç±»å‹è½¬æ¢ 12345678// Array è½¬ Setvar mySet = new Set(["value1", "value2", "value3"]);// ç”¨...æ“ä½œç¬¦ï¼Œå°† Set è½¬ Arrayvar myArray = [...mySet];String// String è½¬ Setvar mySet = new Set('hello'); // Set(4) &#123;"h", "e", "l", "o"&#125;// æ³¨ï¼šSet ä¸­ toString æ–¹æ³•æ˜¯ä¸èƒ½å°† Set è½¬æ¢æˆ String Set å¯¹è±¡çš„ä½œç”¨æ•°ç»„å»é‡ 123var mySet = new Set([1, 2, 3, 4, 4]); [...mySet]; // [1, 2, 3, 4] å¹¶é›† 12345var a = new Set([1, 2, 3]); var b = new Set([4, 3, 2]); var union = new Set([...a, ...b]); // &#123;1, 2, 3, 4&#125; äº¤é›† 12345var a = new Set([1, 2, 3]); var b = new Set([4, 3, 2]); var intersect = new Set([...a].filter(x =&gt; b.has(x))); // &#123;2, 3&#125; å·®é›† 12345var a = new Set([1, 2, 3]); var b = new Set([4, 3, 2]); var difference = new Set([...a].filter(x =&gt; !b.has(x))); // &#123;1&#125; ES6 Reflect ä¸ Proxyæ¦‚è¿°Proxy ä¸ Reflect æ˜¯ ES6 ä¸ºäº†æ“ä½œå¯¹è±¡å¼•å…¥çš„ API ã€‚ Proxy å¯ä»¥å¯¹ç›®æ ‡å¯¹è±¡çš„è¯»å–ã€å‡½æ•°è°ƒç”¨ç­‰æ“ä½œè¿›è¡Œæ‹¦æˆªï¼Œç„¶åè¿›è¡Œæ“ä½œå¤„ç†ã€‚å®ƒä¸ç›´æ¥æ“ä½œå¯¹è±¡ï¼Œè€Œæ˜¯åƒä»£ç†æ¨¡å¼ï¼Œé€šè¿‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œåœ¨è¿›è¡Œè¿™äº›æ“ä½œæ—¶ï¼Œå¯ä»¥æ·»åŠ ä¸€äº›éœ€è¦çš„é¢å¤–æ“ä½œã€‚ Reflect å¯ä»¥ç”¨äºè·å–ç›®æ ‡å¯¹è±¡çš„è¡Œä¸ºï¼Œå®ƒä¸ Object ç±»ä¼¼ï¼Œä½†æ˜¯æ›´æ˜“è¯»ï¼Œä¸ºæ“ä½œå¯¹è±¡æä¾›äº†ä¸€ç§æ›´ä¼˜é›…çš„æ–¹å¼ã€‚å®ƒçš„æ–¹æ³•ä¸ Proxy æ˜¯å¯¹åº”çš„ã€‚ ProxyåŸºæœ¬ç”¨æ³•ä¸€ä¸ª Proxy å¯¹è±¡ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š target ã€ handler ã€‚ åœ¨é€šè¿‡ Proxy æ„é€ å‡½æ•°ç”Ÿæˆå®ä¾‹å¯¹è±¡æ—¶ï¼Œéœ€è¦æä¾›è¿™ä¸¤ä¸ªå‚æ•°ã€‚ target å³ç›®æ ‡å¯¹è±¡ï¼Œ handler æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå£°æ˜äº†ä»£ç† target çš„æŒ‡å®šè¡Œä¸ºã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344let target = &#123; name: 'Tom', age: 24&#125;let handler = &#123; get: function(target, key) &#123; console.log('getting '+key); return target[key]; // ä¸æ˜¯target.key &#125;, set: function(target, key, value) &#123; console.log('setting '+key); target[key] = value; &#125;&#125;let proxy = new Proxy(target, handler)proxy.name // å®é™…æ‰§è¡Œ handler.getproxy.age = 25 // å®é™…æ‰§è¡Œ handler.set// getting name// setting age// 25 // target å¯ä»¥ä¸ºç©ºå¯¹è±¡let targetEpt = &#123;&#125;let proxyEpt = new Proxy(targetEpt, handler)// è°ƒç”¨ get æ–¹æ³•ï¼Œæ­¤æ—¶ç›®æ ‡å¯¹è±¡ä¸ºç©ºï¼Œæ²¡æœ‰ name å±æ€§proxyEpt.name // getting name// è°ƒç”¨ set æ–¹æ³•ï¼Œå‘ç›®æ ‡å¯¹è±¡ä¸­æ·»åŠ äº† name å±æ€§proxyEpt.name = 'Tom'// setting name// "Tom"// å†æ¬¡è°ƒç”¨ get ï¼Œæ­¤æ—¶å·²ç»å­˜åœ¨ name å±æ€§proxyEpt.name// getting name// "Tom" // é€šè¿‡æ„é€ å‡½æ•°æ–°å»ºå®ä¾‹æ—¶å…¶å®æ˜¯å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œäº†æµ…æ‹·è´ï¼Œå› æ­¤ç›®æ ‡å¯¹è±¡ä¸ä»£ç†å¯¹è±¡ä¼šäº’ç›¸å½±å“targetEpt)// &#123;name: "Tom"&#125; // handler å¯¹è±¡ä¹Ÿå¯ä»¥ä¸ºç©ºï¼Œç›¸å½“äºä¸è®¾ç½®æ‹¦æˆªæ“ä½œï¼Œç›´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡let targetEmpty = &#123;&#125;let proxyEmpty = new Proxy(targetEmpty,&#123;&#125;)proxyEmpty.name = "Tom"targetEmpty) // &#123;name: "Tom"&#125; Proxyå®ä¾‹æ–¹æ³•get æ–¹æ³• 1get(target, propKey, receiver) ç”¨äº target å¯¹è±¡ä¸Š propKey çš„è¯»å–æ“ä½œã€‚ 12345678910111213let exam =&#123; name: "Tom", age: 24&#125;let proxy = new Proxy(exam, &#123; get(target, propKey, receiver) &#123; console.log('Getting ' + propKey); return target[propKey]; &#125;&#125;)proxy.name // Getting name// "Tom" get() æ–¹æ³•å¯ä»¥ç»§æ‰¿ã€‚ 1234567891011121314let proxy = new Proxy(&#123;&#125;, &#123; get(target, propKey, receiver) &#123; // å®ç°ç§æœ‰å±æ€§è¯»å–ä¿æŠ¤ if(propKey[0] === '_')&#123; throw new Erro(`Invalid attempt to get private "$&#123;propKey&#125;"`); &#125; console.log('Getting ' + propKey); return target[propKey]; &#125;&#125;); let obj = Object.create(proxy);obj.name// Getting name set æ–¹æ³• 1set(target, propKey, value, receiver) ç”¨äºæ‹¦æˆª target å¯¹è±¡ä¸Šçš„ propKey çš„èµ‹å€¼æ“ä½œã€‚å¦‚æœç›®æ ‡å¯¹è±¡è‡ªèº«çš„æŸä¸ªå±æ€§ï¼Œä¸å¯å†™ä¸”ä¸å¯é…ç½®ï¼Œé‚£ä¹ˆsetæ–¹æ³•å°†ä¸èµ·ä½œç”¨ã€‚ 12345678910111213141516171819let validator = &#123; set: function(obj, prop, value) &#123; if (prop === 'age') &#123; if (!Number.isInteger(value)) &#123; throw new TypeError('The age is not an integer'); &#125; if (value &gt; 200) &#123; throw new RangeError('The age seems invalid'); &#125; &#125; // å¯¹äºæ»¡è¶³æ¡ä»¶çš„ age å±æ€§ä»¥åŠå…¶ä»–å±æ€§ï¼Œç›´æ¥ä¿å­˜ obj[prop] = value; &#125;&#125;;let proxy= new Proxy(&#123;&#125;, validator)proxy.age = 100;proxy.age // 100proxy.age = 'oppps' // æŠ¥é”™proxy.age = 300 // æŠ¥é”™ ç¬¬å››ä¸ªå‚æ•° receiver è¡¨ç¤ºåŸå§‹æ“ä½œè¡Œä¸ºæ‰€åœ¨å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯ Proxy å®ä¾‹æœ¬èº«ã€‚ 12345678910111213const handler = &#123; set: function(obj, prop, value, receiver) &#123; obj[prop] = receiver; &#125;&#125;;const proxy = new Proxy(&#123;&#125;, handler);proxy.name= 'Tom';proxy.name=== proxy // true const exam = &#123;&#125;Object.setPrototypeOf(exam, proxy)exam.name = "Tom"exam.name === exam // true æ³¨æ„ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œsetä»£ç†å¦‚æœæ²¡æœ‰è¿”å›trueï¼Œå°±ä¼šæŠ¥é”™ã€‚ apply æ–¹æ³• 1apply(target, ctx, args) ç”¨äºæ‹¦æˆªå‡½æ•°çš„è°ƒç”¨ã€call å’Œ reply æ“ä½œã€‚target è¡¨ç¤ºç›®æ ‡å¯¹è±¡ï¼Œctx è¡¨ç¤ºç›®æ ‡å¯¹è±¡ä¸Šä¸‹æ–‡ï¼Œargs è¡¨ç¤ºç›®æ ‡å¯¹è±¡çš„å‚æ•°æ•°ç»„ã€‚ 12345678910111213function sub(a, b)&#123; return a - b;&#125;let handler = &#123; apply: function(target, ctx, args)&#123; console.log('handle apply'); return Reflect.apply(...arguments); &#125;&#125;let proxy = new Proxy(sub, handler)proxy(2, 1) // handle apply// 1 has æ–¹æ³• 1has(target, propKey) ç”¨äºæ‹¦æˆª HasProperty æ“ä½œï¼Œå³åœ¨åˆ¤æ–­ target å¯¹è±¡æ˜¯å¦å­˜åœ¨ propKey å±æ€§æ—¶ï¼Œä¼šè¢«è¿™ä¸ªæ–¹æ³•æ‹¦æˆªã€‚æ­¤æ–¹æ³•ä¸åˆ¤æ–­ä¸€ä¸ªå±æ€§æ˜¯å¯¹è±¡è‡ªèº«çš„å±æ€§ï¼Œè¿˜æ˜¯ç»§æ‰¿çš„å±æ€§ã€‚ 1234567891011let handler = &#123; has: function(target, propKey)&#123; console.log("handle has"); return propKey in target; &#125;&#125;let exam = &#123;name: "Tom"&#125;let proxy = new Proxy(exam, handler)'name' in proxy// handle has// true æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¸æ‹¦æˆª for â€¦ in å¾ªç¯ã€‚ construct æ–¹æ³• 1construct(target, args) ç”¨äºæ‹¦æˆª new å‘½ä»¤ã€‚è¿”å›å€¼å¿…é¡»ä¸ºå¯¹è±¡ã€‚ 1234567891011121314let handler = &#123; construct: function(target, args, newTarget)&#123; console.log("handle construct"); return Reflect.construct(target, args, newTarget); &#125; &#125;class exam = &#123; constructor(name)&#123; this.name = name; &#125;&#125;let proxy = new Proxy(exam,handler)new proxy("Tom")// handle construct// exam &#123;name: "Tom"&#125; deleteProperty æ–¹æ³• 1deleteProperty(target, propKey) ç”¨äºæ‹¦æˆª delete æ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯æˆ–è€…è¿”å› false ï¼ŒpropKey å±æ€§å°±æ— æ³•è¢« delete å‘½ä»¤åˆ é™¤ã€‚ defineProperty æ–¹æ³• 1defineProperty(target, propKey, propDesc) ç”¨äºæ‹¦æˆª Object.defineProè‹¥ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼Œå¢åŠ ç›®æ ‡å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§ä¼šæŠ¥é”™ï¼› è‹¥å±æ€§ä¸å¯å†™æˆ–ä¸å¯é…ç½®ï¼Œåˆ™ä¸èƒ½æ”¹å˜è¿™äº›å±æ€§ã€‚ 123456789101112131415161718192021222324let handler = &#123; defineProperty: function(target, propKey, propDesc)&#123; console.log("handle defineProperty"); return true; &#125;&#125;plet target = &#123;&#125;let proxy = new Proxy(target, handler)proxy.name = "Tom"// handle definePropertytarget// &#123;name: "Tom"&#125; // defineProperty è¿”å›å€¼ä¸ºfalseï¼Œæ·»åŠ å±æ€§æ“ä½œæ— æ•ˆlet handler1 = &#123; defineProperty: function(target, propKey, propDesc)&#123; console.log("handle defineProperty"); return false; &#125;&#125;let target1 = &#123;&#125;let proxy1 = new Proxy(target1, handler1)proxy1.name = "Jerry"target1// &#123;&#125; getOwnPropertyDescriptoræ–¹æ³• 1getOwnPropertyDescriptor(target, propKey) ç”¨äºæ‹¦æˆª Object.getOwnPropertyD() è¿”å›å€¼ä¸ºå±æ€§æè¿°å¯¹è±¡æˆ–è€… undefined ã€‚ 123456789let handler = &#123; getOwnPropertyDescriptor: function(target, propKey)&#123; return Object.getOwnPropertyDescriptor(target, propKey); &#125;&#125;ilet target = &#123;name: "Tom"&#125;let proxy = new Proxy(target, handler)Object.getOwnPropertyDescriptor(proxy, 'name')// &#123;value: "Tom", writable: true, enumerable: true, configurable: // true&#125; getPrototypeOf æ–¹æ³• 1getPrototypeOf(target) ä¸»è¦ç”¨äºæ‹¦æˆªè·å–å¯¹è±¡åŸå‹çš„æ“ä½œã€‚åŒ…æ‹¬ä»¥ä¸‹æ“ä½œï¼š Object.prototype.proto Object.prototype.isPrototypeOf() Object.getPrototypeOf() Reflect.getPrototypeOf() instanceof 1234567let exam = &#123;&#125;let proxy = new Proxy(&#123;&#125;,&#123; getPrototypeOf: function(target)&#123; return exam; &#125;&#125;)Object.getPrototypeOf(proxy) // &#123;&#125; æ³¨æ„ï¼Œè¿”å›å€¼å¿…é¡»æ˜¯å¯¹è±¡æˆ–è€… null ï¼Œå¦åˆ™æŠ¥é”™ã€‚å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆnon-extensibleï¼‰ï¼ŒgetPrototypeOf æ–¹æ³•å¿…é¡»è¿”å›ç›®æ ‡å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚ 1234567let proxy = new Proxy(&#123;&#125;,&#123; getPrototypeOf: function(target)&#123; return true; &#125;&#125;)Object.getPrototypeOf(proxy)// TypeError: 'getPrototypeOf' on proxy: trap returned neither object // nor null isExtensible æ–¹æ³• 1isExtensible(target) ç”¨äºæ‹¦æˆª Object.isExtensible æ“ä½œã€‚ è¯¥æ–¹æ³•åªèƒ½è¿”å›å¸ƒå°”å€¼ï¼Œå¦åˆ™è¿”å›å€¼ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚ 123456let proxy = new Proxy(&#123;&#125;,&#123; isExtensible:function(target)&#123; return true; &#125;&#125;)Object.isExtensible(proxy) // true æ³¨æ„ï¼šå®ƒçš„è¿”å›å€¼å¿…é¡»ä¸ç›®æ ‡å¯¹è±¡çš„isExtensibleå±æ€§ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚ 12345678let proxy = new Proxy(&#123;&#125;,&#123; isExtensible:function(target)&#123; return false; &#125;&#125;)Object.isExtensible(proxy)// TypeError: 'isExtensible' on proxy: trap result does not reflect // extensibility of proxy target (which is 'true') ownKeys æ–¹æ³• 1ownKeys(target) ç”¨äºæ‹¦æˆªå¯¹è±¡è‡ªèº«å±æ€§çš„è¯»å–æ“ä½œã€‚ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ“ä½œï¼š Object.getOwnPropertyNames() Object.getOwnPropertySymbols() Object.keys() orâ€¦in æ–¹æ³•è¿”å›çš„æ•°ç»„æˆå‘˜ï¼Œåªèƒ½æ˜¯å­—ç¬¦ä¸²æˆ– Symbol å€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ è‹¥ç›®æ ‡å¯¹è±¡ä¸­å«æœ‰ä¸å¯é…ç½®çš„å±æ€§ï¼Œåˆ™å¿…é¡»å°†è¿™äº›å±æ€§åœ¨ç»“æœä¸­è¿”å›ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚ è‹¥ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼Œåˆ™å¿…é¡»å…¨éƒ¨è¿”å›ä¸”åªèƒ½è¿”å›ç›®æ ‡å¯¹è±¡åŒ…å«çš„æ‰€æœ‰å±æ€§ï¼Œä¸èƒ½åŒ…å«ä¸å­˜åœ¨çš„å±æ€§ï¼Œå¦åˆ™ä¹Ÿä¼šæŠ¥é”™ã€‚ 123456789101112131415161718192021222324252627282930313233let proxy = new Proxy( &#123; name: "Tom", age: 24&#125;, &#123; ownKeys(target) &#123; return ['name']; &#125;&#125;);Object.keys(proxy)// [ 'name' ]fè¿”å›ç»“æœä¸­ï¼Œä¸‰ç±»å±æ€§ä¼šè¢«è¿‡æ»¤ï¼š// - ç›®æ ‡å¯¹è±¡ä¸Šæ²¡æœ‰çš„å±æ€§// - å±æ€§åä¸º Symbol å€¼çš„å±æ€§// - ä¸å¯éå†çš„å±æ€§ let target = &#123; name: "Tom", [Symbol.for('age')]: 24,&#125;;// æ·»åŠ ä¸å¯éå†å±æ€§ 'gender'Object.defineProperty(target, 'gender', &#123; enumerable: false, configurable: true, writable: true, value: 'male'&#125;);let handler = &#123; ownKeys(target) &#123; return ['name', 'parent', Symbol.for('age'), 'gender']; &#125;&#125;;let proxy = new Proxy(target, handler);Object.keys(proxy)// ['name'] preventExtensions æ–¹æ³• 1preventExtensions(target) æ‹¦æˆª Object.preventExtensions æ“ä½œã€‚ è¯¥æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚ 1234567891011121314151617181920// åªæœ‰ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•æ—¶ï¼ˆå³ Object.isExtensible(proxy) ä¸º false ï¼‰ï¼Œ// proxy.preventExtensions æ‰èƒ½è¿”å› true ï¼Œå¦åˆ™ä¼šæŠ¥é”™var proxy = new Proxy(&#123;&#125;, &#123; preventExtensions: function(target) &#123; return true; &#125;&#125;);// ç”±äº proxy.preventExtensions è¿”å› trueï¼Œæ­¤å¤„ä¹Ÿä¼šè¿”å› trueï¼Œå› æ­¤ä¼šæŠ¥é”™Object.preventExtensions(proxy) è¢«// TypeError: 'preventExtensions' on proxy: trap returned truish but // the proxy target is extensible // è§£å†³æ–¹æ¡ˆ var proxy = new Proxy(&#123;&#125;, &#123; preventExtensions: function(target) &#123; // è¿”å›å‰å…ˆè°ƒç”¨ Object.preventExtensions Object.preventExtensions(target); return true; &#125;&#125;);Object.preventExtensions(proxy)// Proxy &#123;&#125; setPrototypeOf æ–¹æ³• 1setPrototypeOf ä¸»è¦ç”¨æ¥æ‹¦æˆª Object.setPrototypeOf æ–¹æ³•ã€‚ è¿”å›å€¼å¿…é¡»ä¸ºå¸ƒå°”å€¼ï¼Œå¦åˆ™ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚ è‹¥ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ŒsetPrototypeOf æ–¹æ³•ä¸å¾—æ”¹å˜ç›®æ ‡å¯¹è±¡çš„åŸå‹ã€‚ 12345678910let proto = &#123;&#125;let proxy = new Proxy(function () &#123;&#125;, &#123; setPrototypeOf: function(target, proto) &#123; console.log("setPrototypeOf"); return true; &#125;&#125;);Object.setPrototypeOf(proxy, proto);// setPrototypeOf revocable æ–¹æ³• ç”¨äºè¿”å›ä¸€ä¸ªå¯å–æ¶ˆçš„ Proxy å®ä¾‹ã€‚ 12345let &#123;proxy, revoke&#125; = Proxy.revocable(&#123;&#125;, &#123;&#125;);proxy.name = "Tom";revoke();proxy.name // TypeError: Cannot perform 'get' on a proxy that has been revoked Reflectä»‹ç»ES6 ä¸­å°† Object çš„ä¸€äº›æ˜æ˜¾å±äºè¯­è¨€å†…éƒ¨çš„æ–¹æ³•ç§»æ¤åˆ°äº† Reflect å¯¹è±¡ä¸Šï¼ˆå½“å‰æŸäº›æ–¹æ³•ä¼šåŒæ—¶å­˜åœ¨äº Object å’Œ Reflect å¯¹è±¡ä¸Šï¼‰ï¼Œæœªæ¥çš„æ–°æ–¹æ³•ä¼šåªéƒ¨ç½²åœ¨ Reflect å¯¹è±¡ä¸Šã€‚ Reflect å¯¹è±¡å¯¹æŸäº›æ–¹æ³•çš„è¿”å›ç»“æœè¿›è¡Œäº†ä¿®æ”¹ï¼Œä½¿å…¶æ›´åˆç†ã€‚ Reflect å¯¹è±¡ä½¿ç”¨å‡½æ•°çš„æ–¹å¼å®ç°äº† Object çš„å‘½ä»¤å¼æ“ä½œã€‚ Reflecté™æ€æ–¹æ³•Reflect.get 1Reflect.get(target, name, receiver) æŸ¥æ‰¾å¹¶è¿”å› target å¯¹è±¡çš„ name å±æ€§ã€‚ 123456789101112131415161718192021let exam = &#123; name: "Tom", age: 24, get info()&#123; return this.name + this.age; &#125;&#125;Reflect.get(exam, 'name'); // "Tom" // å½“ target å¯¹è±¡ä¸­å­˜åœ¨ name å±æ€§çš„ getter æ–¹æ³•ï¼Œ getter æ–¹æ³•çš„ this ä¼šç»‘å®š // receiverlet receiver = &#123; name: "Jerry", age: 20&#125;Reflect.get(exam, 'info', receiver); // Jerry20 // å½“ name ä¸ºä¸å­˜åœ¨äº target å¯¹è±¡çš„å±æ€§æ—¶ï¼Œè¿”å› undefinedReflect.get(exam, 'birth'); // undefined // å½“ target ä¸æ˜¯å¯¹è±¡æ—¶ï¼Œä¼šæŠ¥é”™Reflect.get(1, 'name'); // TypeError Reflect.set 1Reflect.set(target, name, value, receiver) å°† target çš„ name å±æ€§è®¾ç½®ä¸º valueã€‚è¿”å›å€¼ä¸º boolean ï¼Œtrue è¡¨ç¤ºä¿®æ”¹æˆåŠŸï¼Œfalse è¡¨ç¤ºå¤±è´¥ã€‚å½“ target ä¸ºä¸å­˜åœ¨çš„å¯¹è±¡æ—¶ï¼Œä¼šæŠ¥é”™ã€‚ 123456789101112131415161718192021222324252627let exam = &#123; name: "Tom", age: 24, set info(value)&#123; return this.age = value; &#125;&#125;exam.age; // 24Reflect.set(exam, 'age', 25); // trueexam.age; // 25 // value ä¸ºç©ºæ—¶ä¼šå°† name å±æ€§æ¸…é™¤Reflect.set(exam, 'age', ); // trueexam.age; // undefined // å½“ target å¯¹è±¡ä¸­å­˜åœ¨ name å±æ€§ setter æ–¹æ³•æ—¶ï¼Œsetter æ–¹æ³•ä¸­çš„ this ä¼šç»‘å®š // receiver , æ‰€ä»¥ä¿®æ”¹çš„å®é™…ä¸Šæ˜¯ receiver çš„å±æ€§,let receiver = &#123; age: 18&#125;Reflect.set(exam, 'info', 1, receiver); // truereceiver.age; // 1 let receiver1 = &#123; name: 'oppps'&#125;Reflect.set(exam, 'info', 1, receiver1);receiver1.age; // 1 Reflect.has 1Reflect.has(obj, name) æ˜¯ name in obj æŒ‡ä»¤çš„å‡½æ•°åŒ–ï¼Œç”¨äºæŸ¥æ‰¾ name å±æ€§åœ¨ obj å¯¹è±¡ä¸­æ˜¯å¦å­˜åœ¨ã€‚è¿”å›å€¼ä¸º booleanã€‚å¦‚æœ obj ä¸æ˜¯å¯¹è±¡åˆ™ä¼šæŠ¥é”™ TypeErrorã€‚ 12345let exam = &#123; name: "Tom", age: 24&#125;Reflect.has(exam, 'name'); // true Reflect.deleteProperty 1Reflect.deleteProperty(obj, property) æ˜¯ delete obj[property] çš„å‡½æ•°åŒ–ï¼Œç”¨äºåˆ é™¤ obj å¯¹è±¡çš„ property å±æ€§ï¼Œè¿”å›å€¼ä¸º booleanã€‚å¦‚æœ obj ä¸æ˜¯å¯¹è±¡åˆ™ä¼šæŠ¥é”™ TypeErrorã€‚ 12345678let exam = &#123; name: "Tom", age: 24&#125;Reflect.deleteProperty(exam , 'name'); // trueexam // &#123;age: 24&#125; // property ä¸å­˜åœ¨æ—¶ï¼Œä¹Ÿä¼šè¿”å› trueReflect.deleteProperty(exam , 'name'); // true Reflect.construct 1Reflect.construct(obj, args) ç­‰åŒäº new target(â€¦args)ã€‚ 1234function exam(name)&#123; this.name = name;&#125;Reflect.construct(exam, ['Tom']); // exam &#123;name: "Tom"&#125; Reflect.getPrototypeOf 1Reflect.getPrototypeOf(obj) ç”¨äºè¯»å– obj çš„ _proto_ å±æ€§ã€‚åœ¨ obj ä¸æ˜¯å¯¹è±¡æ—¶ä¸ä¼šåƒ Object ä¸€æ ·æŠŠ obj è½¬ä¸ºå¯¹è±¡ï¼Œè€Œæ˜¯ä¼šæŠ¥é”™ã€‚ 123class Exam&#123;&#125;let obj = new Exam()Reflect.getPrototypeOf(obj) === Exam.prototype // true Reflect.setPrototypeOf 1Reflect.setPrototypeOf(obj, newProto) ç”¨äºè®¾ç½®ç›®æ ‡å¯¹è±¡çš„ prototypeã€‚ 12let obj =&#123;&#125;Reflect.setPrototypeOf(obj, Array.prototype); // true Reflect.apply 1Reflect.apply(func, thisArg, args) ç­‰åŒäº Function.prototype.apply.call(func, thisArg, args) ã€‚func è¡¨ç¤ºç›®æ ‡å‡½æ•°ï¼›thisArg è¡¨ç¤ºç›®æ ‡å‡½æ•°ç»‘å®šçš„ this å¯¹è±¡ï¼›args è¡¨ç¤ºç›®æ ‡å‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°åˆ—è¡¨ï¼Œå¯ä»¥æ˜¯æ•°ç»„æˆ–ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚è‹¥ç›®æ ‡å‡½æ•°æ— æ³•è°ƒç”¨ï¼Œä¼šæŠ›å‡º TypeError ã€‚ 1Reflect.apply(Math.max, Math, [1, 3, 5, 3, 1]); // 5 Reflect.defineProperty 1Reflect.defineProperty(target, propertyKey, attributes) ç”¨äºä¸ºç›®æ ‡å¯¹è±¡å®šä¹‰å±æ€§ã€‚å¦‚æœ target ä¸æ˜¯å¯¹è±¡ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚ 1234let myDate= &#123;&#125;Reflect.defineProperty(MyDate, 'now', &#123; value: () =&gt; Date.now()&#125;); // true Reflect.getOwnPropertyDescriptor 1Reflect.getOwnPropertyDescriptor(target, propertyKey) ç”¨äºå¾—åˆ° target å¯¹è±¡çš„ propertyKey å±æ€§çš„æè¿°å¯¹è±¡ã€‚åœ¨ target ä¸æ˜¯å¯¹è±¡æ—¶ï¼Œä¼šæŠ›å‡ºé”™è¯¯è¡¨ç¤ºå‚æ•°éæ³•ï¼Œä¸ä¼šå°†éå¯¹è±¡è½¬æ¢ä¸ºå¯¹è±¡ã€‚ 123456789101112var exam = &#123;&#125;Reflect.defineProperty(exam, 'name', &#123; value: true, enumerable: false,&#125;)Reflect.getOwnPropertyDescriptor(exam, 'name')// &#123; configurable: false, enumerable: false, value: true, writable:// false&#125; // propertyKey å±æ€§åœ¨ target å¯¹è±¡ä¸­ä¸å­˜åœ¨æ—¶ï¼Œè¿”å› undefinedReflect.getOwnPropertyDescriptor(exam, 'age') // undefined Reflect.isExtensible 1Reflect.isExtensible(target) ç”¨äºåˆ¤æ–­ target å¯¹è±¡æ˜¯å¦å¯æ‰©å±•ã€‚è¿”å›å€¼ä¸º boolean ã€‚å¦‚æœ target å‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚ 12let exam = &#123;&#125;Reflect.isExtensible(exam) // true Reflect.preventExtensions 1Reflect.preventExtensions(target) ç”¨äºè®© target å¯¹è±¡å˜ä¸ºä¸å¯æ‰©å±•ã€‚å¦‚æœ target å‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚ 12let exam = &#123;&#125;Reflect.preventExtensions(exam) // true Reflect.ownKeys 1Reflect.ownKeys(target) ç”¨äºè¿”å› target å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œç­‰åŒäº Object.getOwnPropertyNames ä¸Object.getOwnPropertySymbols ä¹‹å’Œã€‚ 12345var exam = &#123; name: 1, [Symbol.for('age')]: 4&#125;Reflect.ownKeys(exam) // ["name", Symbol(age)] Proxy å’Œ Reflectç»„åˆä½¿ç”¨Reflect å¯¹è±¡çš„æ–¹æ³•ä¸ Proxy å¯¹è±¡çš„æ–¹æ³•æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æ‰€ä»¥ Proxy å¯¹è±¡çš„æ–¹æ³•å¯ä»¥é€šè¿‡è°ƒç”¨ Reflect å¯¹è±¡çš„æ–¹æ³•è·å–é»˜è®¤è¡Œä¸ºï¼Œç„¶åè¿›è¡Œé¢å¤–æ“ä½œã€‚ 1234567891011121314151617181920let exam = &#123; name: "Tom", age: 24&#125;let handler = &#123; get: function(target, key)&#123; console.log("getting "+key); return Reflect.get(target, key); &#125;, set: function(target, key, value)&#123; console.log("setting "+key+" to "+value) Reflect.set(target, key, value); &#125;&#125;let proxy = new Proxy(exam, handler)proxy.name = "Jerry"proxy.name// setting name to Jerry// getting name// "Jerry" ä½¿ç”¨åœºæ™¯æ‹“å±• 1234567891011121314// å®šä¹‰ Set é›†åˆconst queuedObservers = new Set();// æŠŠè§‚å¯Ÿè€…å‡½æ•°éƒ½æ”¾å…¥ Set é›†åˆä¸­const observe = fn =&gt; queuedObservers.add(fn);// observable è¿”å›åŸå§‹å¯¹è±¡çš„ä»£ç†ï¼Œæ‹¦æˆªèµ‹å€¼æ“ä½œconst observable = obj =&gt; new Proxy(obj, &#123;set&#125;);function set(target, key, value, receiver) &#123; // è·å–å¯¹è±¡çš„èµ‹å€¼æ“ä½œ const result = Reflect.set(target, key, value, receiver); // æ‰§è¡Œæ‰€æœ‰è§‚å¯Ÿè€… queuedObservers.forEach(observer =&gt; observer()); // æ‰§è¡Œèµ‹å€¼æ“ä½œ return result;&#125;]]></content>
      <categories>
        <category>webå‰ç«¯</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GlusterFS åŸç†åŠä½¿ç”¨]]></title>
    <url>%2F2019%2F07%2F01%2F10.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%2FGlusterFS%2FGlusterFS%2F</url>
    <content type="text"><![CDATA[Gluster ç®€ä»‹Gluster æ¦‚è¿° Glusterfsæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼› æ˜¯Scaleå­˜å‚¨çš„æ ¸å¿ƒ,èƒ½å¤Ÿå¤„ç†åƒæ•°é‡çº§çš„å®¢æˆ·ç«¯.åœ¨ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆä¸­Glusterfsèƒ½å¤Ÿçµæ´»çš„ç»“åˆç‰©ç†çš„,è™šæ‹Ÿçš„å’Œäº‘èµ„æºå»ä½“ç°é«˜å¯ç”¨å’Œä¼ä¸šçº§çš„æ€§èƒ½å­˜å‚¨. Glusterfsé€šè¿‡TCP/IPæˆ–InfiniBand RDMAç½‘ç»œé“¾æ¥å°†å®¢æˆ·ç«¯çš„å­˜å‚¨èµ„å—æºèšé›†åœ¨ä¸€èµ·ï¼› ä½¿ç”¨å•ä¸€çš„å…¨å±€å‘½åç©ºé—´æ¥ç®¡ç†æ•°æ®,ç£ç›˜å’Œå†…å­˜èµ„æº. GlusterfsåŸºäºå †å çš„ç”¨æˆ·ç©ºé—´è®¾è®¡,å¯ä»¥ä¸ºä¸åŒçš„å·¥ä½œè´Ÿè½½æä¾›é«˜ä¼˜çš„æ€§èƒ½. Glusterfsæ”¯æŒè¿è¡Œåœ¨ä»»ä½•æ ‡å‡†IPç½‘ç»œä¸Šæ ‡å‡†åº”ç”¨ç¨‹åºçš„æ ‡å‡†å®¢æˆ·ç«¯ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¨å±€ç»Ÿä¸€çš„å‘½åç©ºé—´ä¸­ä½¿ç”¨NFS/CIFSç­‰æ ‡å‡†åè®®æ¥è®¿é—®åº”ç”¨æ•°æ®. Gluster ä¸»è¦ç‰¹å¾æ‰©å±•æ€§å’Œé«˜æ€§èƒ½GlusterFSåˆ©ç”¨åŒé‡ç‰¹æ€§æ¥æä¾›å‡ TBè‡³æ•°PBçš„é«˜æ‰©å±•å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚Scale-Outæ¶æ„å…è®¸é€šè¿‡ç®€å•åœ°å¢åŠ èµ„æºæ¥æé«˜å­˜å‚¨å®¹é‡å’Œæ€§èƒ½ï¼Œç£ç›˜ã€è®¡ç®—å’ŒI/Oèµ„æºéƒ½å¯ä»¥ç‹¬ç«‹å¢åŠ ï¼Œæ”¯æŒ10GbEå’ŒInfiniBandç­‰é«˜é€Ÿç½‘ç»œäº’è”ã€‚Glusterå¼¹æ€§å“ˆå¸Œï¼ˆElastic Hashï¼‰è§£é™¤äº†GlusterFSå¯¹å…ƒæ•°æ®æœåŠ¡å™¨çš„éœ€æ±‚ï¼Œæ¶ˆé™¤äº†å•ç‚¹æ•…éšœå’Œæ€§èƒ½ç“¶é¢ˆï¼ŒçœŸæ­£å®ç°äº†å¹¶è¡ŒåŒ–æ•°æ®è®¿é—®ã€‚ é«˜å¯ç”¨æ€§GlusterFSå¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œè‡ªåŠ¨å¤åˆ¶ï¼Œå¦‚é•œåƒæˆ–å¤šæ¬¡å¤åˆ¶ï¼Œä»è€Œç¡®ä¿æ•°æ®æ€»æ˜¯å¯ä»¥è®¿é—®ï¼Œç”šè‡³æ˜¯åœ¨ç¡¬ä»¶æ•…éšœçš„æƒ…å†µä¸‹ä¹Ÿèƒ½æ­£å¸¸è®¿é—®ã€‚è‡ªæˆ‘ä¿®å¤åŠŸèƒ½èƒ½å¤ŸæŠŠæ•°æ®æ¢å¤åˆ°æ­£ç¡®çš„çŠ¶æ€ï¼Œè€Œä¸”ä¿®å¤æ˜¯ä»¥å¢é‡çš„æ–¹å¼åœ¨åå°æ‰§è¡Œï¼Œå‡ ä¹ä¸ä¼šäº§ç”Ÿæ€§èƒ½è´Ÿè½½ã€‚GlusterFSæ²¡æœ‰è®¾è®¡è‡ªå·±çš„ç§æœ‰æ•°æ®æ–‡ä»¶æ ¼å¼ï¼Œè€Œæ˜¯é‡‡ç”¨æ“ä½œç³»ç»Ÿä¸­ä¸»æµæ ‡å‡†çš„ç£ç›˜æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚EXT3ã€ZFSï¼‰æ¥å­˜å‚¨æ–‡ä»¶ï¼Œå› æ­¤æ•°æ®å¯ä»¥ä½¿ç”¨å„ç§æ ‡å‡†å·¥å…·è¿›è¡Œå¤åˆ¶å’Œè®¿é—®ã€‚ å…¨å±€ç»Ÿä¸€å‘½åç©ºé—´å…¨å±€ç»Ÿä¸€å‘½åç©ºé—´å°†ç£ç›˜å’Œå†…å­˜èµ„æºèšé›†æˆä¸€ä¸ªå•ä¸€çš„è™šæ‹Ÿå­˜å‚¨æ± ï¼Œå¯¹ä¸Šå±‚ç”¨æˆ·å’Œåº”ç”¨å±è”½äº†åº•å±‚çš„ç‰©ç†ç¡¬ä»¶ã€‚å­˜å‚¨èµ„æºå¯ä»¥æ ¹æ®éœ€è¦åœ¨è™šæ‹Ÿå­˜å‚¨æ± ä¸­è¿›è¡Œå¼¹æ€§æ‰©å±•ï¼Œæ¯”å¦‚æ‰©å®¹æˆ–æ”¶ç¼©ã€‚å½“å­˜å‚¨è™šæ‹Ÿæœºæ˜ åƒæ—¶ï¼Œå­˜å‚¨çš„è™šæ‹Ÿæ˜ åƒæ–‡ä»¶æ²¡æœ‰æ•°é‡é™åˆ¶ï¼Œæˆåƒè™šæ‹Ÿæœºå‡é€šè¿‡å•ä¸€æŒ‚è½½ç‚¹è¿›è¡Œæ•°æ®å…±äº«ã€‚è™šæ‹ŸæœºI/Oå¯åœ¨å‘½åç©ºé—´å†…çš„æ‰€æœ‰æœåŠ¡å™¨ä¸Šè‡ªåŠ¨è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œæ¶ˆé™¤äº†SANç¯å¢ƒä¸­ç»å¸¸å‘ç”Ÿçš„è®¿é—®çƒ­ç‚¹å’Œæ€§èƒ½ç“¶é¢ˆé—®é¢˜ã€‚ å¼¹æ€§å“ˆå¸Œç®—æ³•GlusterFSé‡‡ç”¨å¼¹æ€§å“ˆå¸Œç®—æ³•åœ¨å­˜å‚¨æ± ä¸­å®šä½æ•°æ®ï¼Œè€Œä¸æ˜¯é‡‡ç”¨é›†ä¸­å¼æˆ–åˆ†å¸ƒå¼å…ƒæ•°æ®æœåŠ¡å™¨ç´¢å¼•ã€‚åœ¨å…¶ä»–çš„Scale-Outå­˜å‚¨ç³»ç»Ÿä¸­ï¼Œå…ƒæ•°æ®æœåŠ¡å™¨é€šå¸¸ä¼šå¯¼è‡´I/Oæ€§èƒ½ç“¶é¢ˆå’Œå•ç‚¹æ•…éšœé—®é¢˜ã€‚GlusterFSä¸­ï¼Œæ‰€æœ‰åœ¨Scale-Outå­˜å‚¨é…ç½®ä¸­çš„å­˜å‚¨ç³»ç»Ÿéƒ½å¯ä»¥æ™ºèƒ½åœ°å®šä½ä»»æ„æ•°æ®åˆ†ç‰‡ï¼Œä¸éœ€è¦æŸ¥çœ‹ç´¢å¼•æˆ–è€…å‘å…¶ä»–æœåŠ¡å™¨æŸ¥è¯¢ã€‚è¿™ç§è®¾è®¡æœºåˆ¶å®Œå…¨å¹¶è¡ŒåŒ–äº†æ•°æ®è®¿é—®ï¼Œå®ç°äº†çœŸæ­£çš„çº¿æ€§æ€§èƒ½æ‰©å±•ã€‚ åŸºäºæ ‡å‡†åè®®Glusterå­˜å‚¨æœåŠ¡æ”¯æŒNFS, CIFS, HTTP, FTPä»¥åŠGlusteråŸç”Ÿåè®®ï¼Œå®Œå…¨ä¸POSIXæ ‡å‡†å…¼å®¹ã€‚ç°æœ‰åº”ç”¨ç¨‹åºä¸éœ€è¦ä½œä»»ä½•ä¿®æ”¹æˆ–ä½¿ç”¨ä¸“ç”¨APIï¼Œå°±å¯ä»¥å¯¹Glusterä¸­çš„æ•°æ®è¿›è¡Œè®¿é—®ã€‚è¿™åœ¨å…¬æœ‰äº‘ç¯å¢ƒä¸­éƒ¨ç½²Glusteræ—¶éå¸¸æœ‰ç”¨ï¼ŒGlusterå¯¹äº‘æœåŠ¡æä¾›å•†ä¸“ç”¨APIè¿›è¡ŒæŠ½è±¡ï¼Œç„¶åæä¾›æ ‡å‡†POSIXæ¥å£ã€‚ æ˜¾è‘—ä¼˜ç‚¹ å¼€æºï¼Œä¸”ç½‘ä¸Šçš„æ–‡æ¡£åŸºæœ¬ä¸Šè¶³å¤Ÿä½ ç»´æŠ¤ä¸€å¥—ç®€å•çš„å­˜å‚¨ç³»ç»Ÿã€‚ æ”¯æŒå¤šå®¢æˆ·ç«¯å¤„ç†ï¼Œå½“å‰å·²çŸ¥çš„æ”¯æŒåƒçº§åˆ«åŠä»¥ä¸Šè§„æ¨¡å®¢æˆ·ã€‚ æ”¯æŒPOSIX&lt;ç®€å•æ¥è¯´ï¼Œè½¯ä»¶è·¨å¹³å°ï¼Œä¹Ÿå¯ä»¥çœ‹æ‰¾çš„å…¶ä»–åšå®¢è¯´æ˜ï¼Œè§â€˜å‚è€ƒæ–‡ä»¶â€™&gt;ã€‚ æ”¯æŒå„ç§ä½ç«¯ç¡¬ä»¶ï¼Œå½“ç„¶å¹¶ä¸æ¨å´‡ï¼Œä½†æ˜¯å¯ä»¥å®ç°ã€‚æˆ‘åœ¨çº¿ä¸Šç”¨è¿‡8æ ¸ï¼Œ32Gï¼Œä¾ç„¶è·‘çš„å¾ˆæºœã€‚ æ”¯æŒNFS/SMB/CIFS/GLUSTERFSç­‰è¡Œä¸šæ ‡å‡†åè®®è®¿é—®ã€‚ æä¾›å„ç§ä¼˜ç§€çš„åŠŸèƒ½ï¼Œå¦‚ç£ç›˜é…é¢ã€å¤åˆ¶å¼ã€åˆ†å¸ƒå¼ã€å¿«ç…§ã€æ€§èƒ½æ£€æµ‹å‘½ä»¤ç­‰ã€‚ æ”¯æŒå¤§å®¹é‡å­˜å‚¨ï¼Œå½“å‰å·²çŸ¥çš„æ”¯æŒPBåŠä»¥ä¸Šè§„æ¨¡å­˜å‚¨ã€‚ å¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒæ‰©å±•å±æ€§çš„ondiskæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚xattr. å¼ºå¤§ä¸”ç®€å•çš„æ‰©å±•èƒ½åŠ›ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å¿«é€Ÿæ‰©å®¹ã€‚ è‡ªåŠ¨é…ç½®æ•…éšœè½¬ç§»ï¼Œåœ¨æ•…éšœå‘ç”Ÿæ—¶ï¼Œæ— éœ€ä»»ä½•æ“ä½œå³å¯æ¢å¤æ•°æ®ï¼Œä¸”æœ€æ–°å‰¯æœ¬ä¾ç„¶ä»ä»åœ¨è¿è¡Œçš„èŠ‚ç‚¹è·å–ã€‚ æœ¯è¯­ä»‹ç»Brick: GFSä¸­çš„å­˜å‚¨å•å…ƒï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå—ä¿¡å­˜å‚¨æ± ä¸­çš„æœåŠ¡å™¨çš„ä¸€ä¸ªå¯¼å‡ºç›®å½•ã€‚å¯ä»¥é€šè¿‡ä¸»æœºåå’Œç›®å½•åæ¥æ ‡è¯†ï¼Œå¦‚â€™SERVER:EXPORTâ€™ Client: æŒ‚è½½äº†GFSå·çš„è®¾å¤‡ Extended Attributes: xattræ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œå…¶æ”¯æŒç”¨æˆ·æˆ–ç¨‹åºå…³è”æ–‡ä»¶/ç›®å½•å’Œå…ƒæ•°æ®ã€‚ FUSE: Filesystem Userspaceæ˜¯ä¸€ä¸ªå¯åŠ è½½çš„å†…æ ¸æ¨¡å—ï¼Œå…¶æ”¯æŒéç‰¹æƒç”¨æˆ·åˆ›å»ºè‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿè€Œä¸éœ€è¦ä¿®æ”¹å†…æ ¸ä»£ç ã€‚é€šè¿‡åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œæ–‡ä»¶ç³»ç»Ÿçš„ä»£ç é€šè¿‡FUSEä»£ç ä¸å†…æ ¸è¿›è¡Œæ¡¥æ¥ã€‚ GFID: GFSå·ä¸­çš„æ¯ä¸ªæ–‡ä»¶æˆ–ç›®å½•éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„128ä½çš„æ•°æ®ç›¸å…³è”ï¼Œå…¶ç”¨äºæ¨¡æ‹Ÿinode Namespace: æ¯ä¸ªGlusterå·éƒ½å¯¼å‡ºå•ä¸ªnsä½œä¸ºPOSIXçš„æŒ‚è½½ç‚¹ Node: ä¸€ä¸ªæ‹¥æœ‰è‹¥å¹²brickçš„è®¾å¤‡ RDMA: è¿œç¨‹ç›´æ¥å†…å­˜è®¿é—®ï¼Œæ”¯æŒä¸é€šè¿‡åŒæ–¹çš„OSè¿›è¡Œç›´æ¥å†…å­˜è®¿é—®ã€‚ RRDNS: round robin DNSæ˜¯ä¸€ç§é€šè¿‡DNSè½®è½¬è¿”å›ä¸åŒçš„è®¾å¤‡ä»¥è¿›è¡Œè´Ÿè½½å‡è¡¡çš„æ–¹æ³• Self-heal: ç”¨äºåå°è¿è¡Œæ£€æµ‹å¤æœ¬å·ä¸­æ–‡ä»¶å’Œç›®å½•çš„ä¸ä¸€è‡´æ€§å¹¶è§£å†³è¿™äº›ä¸ä¸€è‡´ã€‚ Split-brain: è„‘è£‚ Volfile: glusterfsè¿›ç¨‹çš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸ä½äº/var/lib/glusterd/vols/volname Volume: ä¸€ç»„bricksçš„é€»è¾‘é›†åˆ å·¥ä½œåŸç† é¦–å…ˆæ˜¯åœ¨å®¢æˆ·ç«¯ï¼Œ ç”¨æˆ·é€šè¿‡glusterfsçš„mount point æ¥è¯»å†™æ•°æ®ï¼Œ å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œé›†ç¾¤ç³»ç»Ÿçš„å­˜åœ¨å¯¹ç”¨æˆ·æ˜¯å®Œå…¨é€æ˜çš„ï¼Œç”¨æˆ·æ„Ÿè§‰ä¸åˆ°æ˜¯æ“ä½œæœ¬åœ°ç³»ç»Ÿè¿˜æ˜¯è¿œç«¯çš„é›†ç¾¤ç³»ç»Ÿã€‚ ç”¨æˆ·çš„è¿™ä¸ªæ“ä½œè¢«é€’äº¤ç»™ æœ¬åœ°linuxç³»ç»Ÿçš„VFSæ¥å¤„ç†ã€‚ VFS å°†æ•°æ®é€’äº¤ç»™FUSE å†…æ ¸æ–‡ä»¶ç³»ç»Ÿ:åœ¨å¯åŠ¨ glusterfs å®¢æˆ·ç«¯ä»¥å‰ï¼Œéœ€è¦æƒ³ç³»ç»Ÿæ³¨å†Œä¸€ä¸ªå®é™…çš„æ–‡ä»¶ç³»ç»ŸFUSE,å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿä¸ext3åœ¨åŒä¸€ä¸ªå±‚æ¬¡ä¸Šé¢ï¼Œ ext3 æ˜¯å¯¹å®é™…çš„ç£ç›˜è¿›è¡Œå¤„ç†ï¼Œ è€Œfuse æ–‡ä»¶ç³»ç»Ÿåˆ™æ˜¯å°†æ•°æ®é€šè¿‡/dev/fuse è¿™ä¸ªè®¾å¤‡æ–‡ä»¶é€’äº¤ç»™äº†glusterfs clientç«¯ã€‚æ‰€ä»¥ï¼Œ æˆ‘ä»¬å¯ä»¥å°† fuseæ–‡ä»¶ç³»ç»Ÿç†è§£ä¸ºä¸€ä¸ªä»£ç†ã€‚ æ•°æ®è¢«fuse é€’äº¤ç»™Glusterfs client åï¼Œ client å¯¹æ•°æ®è¿›è¡Œä¸€äº›æŒ‡å®šçš„å¤„ç†ï¼ˆæ‰€è°“çš„æŒ‡å®šï¼Œæ˜¯æŒ‰ç…§client é…ç½®æ–‡ä»¶æ®æ¥è¿›è¡Œçš„ä¸€ç³»åˆ—å¤„ç†ï¼Œ æˆ‘ä»¬åœ¨å¯åŠ¨glusterfs client æ—¶éœ€è¦æŒ‡å®šè¿™ä¸ªæ–‡ä»¶ã€‚ åœ¨glusterfs clientçš„å¤„ç†æœ«ç«¯ï¼Œé€šè¿‡ç½‘ç»œå°†æ•°æ®é€’äº¤ç»™ Glusterfs Serverï¼Œå¹¶ä¸”å°†æ•°æ®å†™å…¥åˆ°æœåŠ¡å™¨æ‰€æ§åˆ¶çš„å­˜å‚¨è®¾å¤‡ä¸Šã€‚ GlusterFS æ•´ä½“å·¥ä½œæµ 1ï¼Œåªè¦å®‰è£…äº†glusterFSï¼Œä¼šåˆ›å»ºä¸€ä¸ªglusterç®¡ç†å®ˆæŠ¤è¿›ç¨‹(glusterd)äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯¥å®ˆæŠ¤è¿›ç¨‹åº”è¯¥åœ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰è®¾å¤‡ä¸Šè¿è¡Œã€‚ 2ï¼Œå¯åŠ¨glusterdåï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç”±æ‰€æœ‰å­˜å‚¨æœåŠ¡å™¨èŠ‚ç‚¹ç»„æˆçš„å—ä¿¡ä»»çš„æœåŠ¡å™¨æ± (TSPå¯ä»¥åŒ…å«å•ä¸ªèŠ‚ç‚¹) 3ï¼Œä½œä¸ºåŸºæœ¬å­˜å‚¨å•å…ƒçš„brickå¯ä»¥å†è¿™äº›æœåŠ¡å™¨ä¸­ä½œä¸ºå¯¼å‡ºç›®å½•åˆ›å»ºã€‚ 4ï¼Œä»è¿™ä¸ªTSPçš„ä»»ä½•æ•°é‡çš„brickéƒ½å¯ä»¥è¢«è”åˆèµ·æ¥å½¢æˆä¸€ä¸ªæ•´ä½“ã€‚ 5ï¼Œä¸€æ—¦åˆ›å»ºäº†volumeï¼Œglusterfsdè¿›ç¨‹å°±ä¼šå¼€å§‹åœ¨æ¯ä¸ªå‚ä¸çš„brickä¸­è¿è¡Œï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå°†åœ¨/var/lib/glusterd/vols/ç”Ÿæˆä¸ºvolæ–‡ä»¶çš„é…ç½®æ–‡ä»¶ã€‚ 6ï¼Œvolumeä¸­å°†ä¼šæœ‰ä¸æ¯ä¸ªbrickå¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­åŒ…å«å…³äºç‰¹å®šbrickçš„æ‰€æœ‰å†…å®¹ã€‚ 7ï¼Œå®¢æˆ·ç«¯è¿›ç¨‹æ‰€éœ€çš„é…ç½®æ–‡ä»¶ä¹Ÿå°†è¢«åˆ›å»ºã€‚ 8ï¼Œæ–‡ä»¶ç³»ç»Ÿå®Œæˆï¼ŒæŒ‚è½½ä½¿ç”¨ã€‚ 9ï¼ŒæŒ‚è½½çš„IP/ä¸»æœºåå¯ä»¥æ˜¯å—ä¿¡ä»»æœåŠ¡å™¨æ± ä¸­åˆ›å»ºæ‰€éœ€volumeçš„ä»»ä½•èŠ‚ç‚¹çš„IP/ä¸»æœºåã€‚ 10ï¼Œå½“æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å®‰è£…volumeæ—¶ï¼Œå®¢æˆ·ç«¯glusterfsè¿›ç¨‹ä¸æœåŠ¡å™¨çš„glusterdè¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚ 11ï¼ŒæœåŠ¡å™¨glusterdè¿›ç¨‹å‘é€ä¸€ä¸ªé…ç½®æ–‡ä»¶(vol)æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬å®¢æˆ·ç«¯è½¬æ¢å™¨åˆ—è¡¨ï¼Œå¦ä¸€ä¸ªåŒ…å«volumeä¸­æ¯ä¸ªbrickçš„ä¿¡æ¯ã€‚ 12ï¼Œå€ŸåŠ©äºè¯¥æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯glusterfsè¿›ç¨‹å¯ä»¥ä¸æ¯ä¸ªbrickçš„glusterfsdè¿›è¡Œé€šä¿¡ã€‚ 13ï¼Œå½“æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå®¢æˆ·ç«¯å‘å‡ºç³»ç»Ÿè°ƒç”¨&lt;æ–‡ä»¶æ“ä½œæˆ–Fopæˆ–æ‰“å¼€æ–‡ä»¶&gt;æ—¶ï¼Œ 14ï¼ŒVFSè¯†åˆ«æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸ºglusterfsï¼Œä¼šå°†è¯·æ±‚å‘é€åˆ°FUSEå†…æ ¸æ¨¡å—ã€‚ 15ï¼ŒFUSEå†…æ ¸æ¨¡å—å°†é€šè¿‡/dev/fuseå°†å…¶å‘é€åˆ°å®¢æˆ·æœºèŠ‚ç‚¹çš„ç”¨æˆ·ç©ºé—´ä¸­çš„glusterFSã€‚ 16ï¼Œå®¢æˆ·ç«¯ä¸Šçš„glusterFSè¿›ç¨‹ç”±ä¸€å †æˆä¸ºå®¢æˆ·ç«¯ç¿»è¯‘å™¨çš„ç¿»è¯‘å™¨ç»„æˆã€‚è¿™äº›ç¿»è¯‘å™¨åœ¨å­˜å‚¨æœåŠ¡å™¨glusterdè¿›ç¨‹å‘é€çš„é…ç½®æ–‡ä»¶(volæ–‡ä»¶)ä¸­å®šä¹‰ã€‚ 17ï¼Œè¿™äº›ç¿»è¯‘å™¨ä¸­çš„ç¬¬ä¸€ä¸ªç”±FUSEåº“(libfuse)ç»„æˆçš„FUSEç¿»è¯‘å™¨ã€‚ 18ï¼Œæ¯ä¸ªç¿»è¯‘å™¨éƒ½å…·æœ‰ä¸æ¯ä¸ªæ–‡ä»¶æ“ä½œå¯¹åº”çš„åŠŸèƒ½æˆ–glusterfsæ”¯æŒçš„fopã€‚ 19ï¼Œè¯¥è¯·æ±‚å°†åœ¨æ¯ä¸ªç¿»è¯‘å™¨ä¸­å‘æŒ¥ç›¸åº”çš„åŠŸèƒ½ã€‚ å¸¸ç”¨volume å·ç±»å‹åˆ†å¸ƒï¼ˆdistributedï¼‰é»˜è®¤æ¨¡å¼ï¼Œæ—¢DHT, ä¹Ÿå« åˆ†å¸ƒå·: å°†æ–‡ä»¶å·²hashç®—æ³•éšæœºåˆ†å¸ƒåˆ° ä¸€å°æœåŠ¡å™¨èŠ‚ç‚¹ä¸­å­˜å‚¨ã€‚ å¤åˆ¶ï¼ˆreplicateï¼‰å¤åˆ¶æ¨¡å¼ï¼Œæ—¢AFR, åˆ›å»ºvolume æ—¶å¸¦ replica x æ•°é‡: å°†æ–‡ä»¶å¤åˆ¶åˆ° replica x ä¸ªèŠ‚ç‚¹ä¸­ã€‚ æ¡å¸¦ï¼ˆstripedï¼‰æ¡å¸¦æ¨¡å¼ï¼Œæ—¢Striped, åˆ›å»ºvolume æ—¶å¸¦ stripe x æ•°é‡ï¼š å°†æ–‡ä»¶åˆ‡å‰²æˆæ•°æ®å—ï¼Œåˆ†åˆ«å­˜å‚¨åˆ° stripe x ä¸ªèŠ‚ç‚¹ä¸­ ( ç±»ä¼¼raid 0 )ã€‚ åˆ†å¸ƒå¼æ¡å¸¦å·(distribute stripe volume)åˆ†å¸ƒå¼æ¡å¸¦æ¨¡å¼ï¼ˆç»„åˆå‹ï¼‰ï¼Œæœ€å°‘éœ€è¦4å°æœåŠ¡å™¨æ‰èƒ½åˆ›å»ºã€‚ åˆ›å»ºvolume æ—¶ stripe 2 server = 4 ä¸ªèŠ‚ç‚¹ï¼š æ˜¯DHT ä¸ Striped çš„ç»„åˆå‹ã€‚ åˆ†å¸ƒå¼å¤åˆ¶å·(distribute replica volume)åˆ†å¸ƒå¼å¤åˆ¶æ¨¡å¼ï¼ˆç»„åˆå‹ï¼‰, æœ€å°‘éœ€è¦4å°æœåŠ¡å™¨æ‰èƒ½åˆ›å»ºã€‚ åˆ›å»ºvolume æ—¶ replica 2 server = 4 ä¸ªèŠ‚ç‚¹ï¼šæ˜¯DHT ä¸ AFR çš„ç»„åˆå‹ã€‚ æ¡å¸¦å¤åˆ¶å·(stripe replica volume)æ¡å¸¦å¤åˆ¶å·æ¨¡å¼ï¼ˆç»„åˆå‹ï¼‰, æœ€å°‘éœ€è¦4å°æœåŠ¡å™¨æ‰èƒ½åˆ›å»ºã€‚ åˆ›å»ºvolume æ—¶ stripe 2 replica 2 server = 4 ä¸ªèŠ‚ç‚¹ï¼š æ˜¯ Striped ä¸ AFR çš„ç»„åˆå‹ã€‚ åˆ†å¸ƒå¼æ¡å¸¦å¤åˆ¶å·(distribute stripe replicavolume) ä¸‰ç§æ¨¡å¼æ··åˆ, è‡³å°‘éœ€è¦8å° æœåŠ¡å™¨æ‰èƒ½åˆ›å»ºã€‚ stripe 2 replica 2 , æ¯4ä¸ªèŠ‚ç‚¹ ç»„æˆä¸€ä¸ª ç»„ã€‚ ç¯å¢ƒå‡†å¤‡å‰ç½®æ¡ä»¶ è‡³å°‘éœ€è¦ä¸¤å°è®¾å¤‡/èŠ‚ç‚¹ã€‚ å…·å¤‡æ­£å¸¸çš„ç½‘ç»œè¿æ¥ è‡³å°‘éœ€è¦ä¸¤ä¸ªç£ç›˜ï¼Œä¸€ä¸ªç”¨äºOSå®‰è£…ï¼Œä¸€ä¸ªç”¨äºæœåŠ¡glusterå­˜å‚¨ï¼› ç¯å¢ƒé…ç½®å…³é—­é˜²ç«å¢™ 12systemctl stop firewalld.service #åœæ­¢firewalldsystemctl disable firewalld.service #ç¦æ­¢firewalldå¼€æœºè‡ªå¯ å…³é—­SELinux 123sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/selinux/config #å…³é—­SELinuxsetenforce 0getenforce é…ç½®hostæ–‡ä»¶ 123410.0.0.101 node0110.0.0.102 node0210.0.0.103 node0310.0.0.104 node04 åŒæ­¥æ—¶é—´ 1ntpdate time.windows.com #åŒæ­¥æ—¶é—´ *å®‰è£… gluster æº * 1yum -y install centos-release-gluster312.noarch å®‰è£…glusterfs 1yum -y --enablerepo=centos-gluster*-test install glusterfs-server glusterfs-cli glusterfs-geo-replication å¯åŠ¨glusterï¼Œ å¹¶è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ 12345glusterfs -vsystemctl start glusterd.servicesystemctl enable glusterd.servicesystemctl status glusterd.servicenetstat -lntup | grep gluster æ ¼å¼åŒ–ç£ç›˜(å…¨éƒ¨gluster ) åœ¨æ¯å°ä¸»æœºä¸Šåˆ›å»ºå‡ å—ç¡¬ç›˜ï¼Œåšæ¥ä¸‹æ¥çš„åˆ†å¸ƒå¼å­˜å‚¨ä½¿ç”¨ æ³¨ï¼šåˆ›å»ºçš„ç¡¬ç›˜è¦ç”¨xfsæ ¼å¼æ¥æ ¼å¼åŒ–ç¡¬ç›˜ï¼Œå¦‚æœç”¨ext4æ¥æ ¼å¼åŒ–ç¡¬ç›˜çš„è¯ï¼Œå¯¹äºå¤§äº16TBç©ºé—´æ ¼å¼åŒ–å°±æ— æ³•å®ç°äº†ã€‚æ‰€ä»¥è¿™é‡Œè¦ç”¨xfsæ ¼å¼åŒ–ç£ç›˜(centos7é»˜è®¤çš„æ–‡ä»¶æ ¼å¼å°±æ˜¯xfs)ï¼Œå¹¶ä¸”xfsçš„æ–‡ä»¶æ ¼å¼æ”¯æŒPBçº§çš„æ•°æ®é‡ 123456789fdisk -l # æŸ¥çœ‹æ‰€æœ‰ç£ç›˜è®¾å¤‡mkfs.xfs -i size=512 /dev/sdb # æ ¼å¼åŒ–ç£ç›˜, ä¸€å—ç£ç›˜ç›¸å½“äºä¸€ä¸ªbrickmkfs.xfs -i size=512 /dev/sdcmkfs.xfs -i size=512 /dev/sddmkdir -p /data/brick&#123;1..3&#125; # åˆ›å»ºæŒ‚è½½å—è®¾å¤‡çš„ç›®å½•echo '/dev/sdb /data/brick1 xfs defaults 0 0' &gt;&gt; /etc/fstabecho '/dev/sdc /data/brick2 xfs defaults 0 0' &gt;&gt; /etc/fstabecho '/dev/sdd /data/brick3 xfs defaults 0 0' &gt;&gt; /etc/fstabmount -a å°†server ä¸»æœºåŠ å…¥åˆ°ä¿¡ä»»æ±  éšä¾¿åœ¨ä¸€ä¸ªå¼€å¯glusterfsæœåŠ¡çš„ä¸»æœºä¸Šå°†å…¶ä»–ä¸»æœºåŠ å…¥åˆ°ä¸€ä¸ªä¿¡ä»»çš„ä¸»æœºæ± é‡Œï¼Œè¿™é‡Œé€‰æ‹©node01 1234567gluster peer probe node01gluster peer probe node02gluster peer probe node03gluster peer probe node04gluster peer detach xxx # ç”¨æ¥å°†èŠ‚ç‚¹ä»ä¿¡ä»»æ± ä¸­åˆ é™¤gluster peer status # æŸ¥çœ‹ä¿¡ä»»ä¸»æœºæ± çŠ¶æ€# å½“å®¢æˆ·ç«¯éœ€è¦æŒ‚è½½å·çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦åŠ å…¥åˆ°ä¿¡ä»»ä¸»æœºæ± ä¸­ gluster å· æ“ä½œGlusterFS äº”ç§å·çš„åˆ›å»ºæ³¨æ„ Distributedï¼šåˆ†å¸ƒå¼å·ï¼Œæ–‡ä»¶é€šè¿‡ hash ç®—æ³•éšæœºåˆ†å¸ƒåˆ°ç”± bricks ç»„æˆçš„å·ä¸Šã€‚ Replicated: å¤åˆ¶å¼å·ï¼Œç±»ä¼¼ RAID 1ï¼Œreplica æ•°å¿…é¡»ç­‰äº volume ä¸­ brick æ‰€åŒ…å«çš„å­˜å‚¨æœåŠ¡å™¨æ•°ï¼Œå¯ç”¨æ€§é«˜ã€‚ Striped: æ¡å¸¦å¼å·ï¼Œç±»ä¼¼ RAID 0ï¼Œstripe æ•°å¿…é¡»ç­‰äº volume ä¸­ brick æ‰€åŒ…å«çš„å­˜å‚¨æœåŠ¡å™¨æ•°ï¼Œæ–‡ä»¶è¢«åˆ†æˆæ•°æ®å—ï¼Œä»¥ Round Robin çš„æ–¹å¼å­˜å‚¨åœ¨ bricks ä¸­ï¼Œå¹¶å‘ç²’åº¦æ˜¯æ•°æ®å—ï¼Œå¤§æ–‡ä»¶æ€§èƒ½å¥½ã€‚ Distributed Striped: åˆ†å¸ƒå¼çš„æ¡å¸¦å·ï¼Œvolumeä¸­ brick æ‰€åŒ…å«çš„å­˜å‚¨æœåŠ¡å™¨æ•°å¿…é¡»æ˜¯ stripe çš„å€æ•°ï¼ˆ&gt;=2å€ï¼‰ï¼Œå…¼é¡¾åˆ†å¸ƒå¼å’Œæ¡å¸¦å¼çš„åŠŸèƒ½ã€‚ Distributed Replicated: åˆ†å¸ƒå¼çš„å¤åˆ¶å·ï¼Œvolume ä¸­ brick æ‰€åŒ…å«çš„å­˜å‚¨æœåŠ¡å™¨æ•°å¿…é¡»æ˜¯ replica çš„å€æ•°ï¼ˆ&gt;=2å€ï¼‰ï¼Œå…¼é¡¾åˆ†å¸ƒå¼å’Œå¤åˆ¶å¼çš„åŠŸèƒ½ã€‚ åˆ†å¸ƒå¼å¤åˆ¶å·çš„brické¡ºåºå†³å®šäº†æ–‡ä»¶åˆ†å¸ƒçš„ä½ç½®ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå…ˆæ˜¯ä¸¤ä¸ªbrickå½¢æˆä¸€ä¸ªå¤åˆ¶å…³ç³»ï¼Œç„¶åä¸¤ä¸ªå¤åˆ¶å…³ç³»å½¢æˆåˆ†å¸ƒã€‚ ä¼ä¸šä¸€èˆ¬ç”¨åä¸¤ç§ï¼Œå¤§éƒ¨åˆ†ä¼šç”¨åˆ†å¸ƒå¼å¤åˆ¶ï¼ˆå¯ç”¨å®¹é‡ä¸º æ€»å®¹é‡/å¤åˆ¶ä»½æ•°ï¼‰ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“çš„è¯æœ€å¥½ç”¨ä¸‡å…†äº¤æ¢æœºï¼Œä¸‡å…†ç½‘å¡æ¥åšã€‚è¿™æ ·å°±ä¼šä¼˜åŒ–ä¸€éƒ¨åˆ†æ€§èƒ½ã€‚å®ƒä»¬çš„æ•°æ®éƒ½æ˜¯é€šè¿‡ç½‘ç»œæ¥ä¼ è¾“çš„ã€‚ é…ç½®åˆ†å¸ƒå¼å·123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657#åœ¨ä¿¡ä»»çš„ä¸»æœºæ± ä¸­ä»»æ„ä¸€å°è®¾å¤‡ä¸Šåˆ›å»ºå·éƒ½å¯ä»¥ï¼Œè€Œä¸”åˆ›å»ºå¥½åå¯åœ¨ä»»æ„è®¾å¤‡æŒ‚è½½åéƒ½å¯ä»¥æŸ¥çœ‹[root@node01 ~] gluster volume create gv1 node01:/data/brick1 node02:/data/brick1 force #åˆ›å»ºåˆ†å¸ƒå¼å·volume create: gv1: success: please start the volume to access data[root@node01 ~] gluster volume start gv1 #å¯åŠ¨å·gv1volume start: gv1: success[root@node01 ~] gluster volume info gv1 #æŸ¥çœ‹gv1çš„é…ç½®ä¿¡æ¯ Volume Name: gv1Type: Distribute #åˆ†å¸ƒå¼å·Volume ID: 85622964-4b48-47d5-b767-d6c6f1e684ccStatus: StartedSnapshot Count: 0Number of Bricks: 2Transport-type: tcpBricks:Brick1: node01:/data/brick1Brick2: node02:/data/brick1Options Reconfigured:transport.address-family: inetnfs.disable: on[root@node01 ~] mount -t glusterfs 127.0.0.1:/gv1 /opt #æŒ‚è½½gv1å·[root@node01 ~] df -hæ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹/dev/sdc 5.0G 33M 5.0G 1% /data/brick2/dev/sdd 5.0G 33M 5.0G 1% /data/brick3/dev/sdb 5.0G 33M 5.0G 1% /data/brick1127.0.0.1:/gv1 10G 65M 10G 1% /opt # ä¸¤ä¸ªè®¾å¤‡å®¹é‡ä¹‹å’Œ[root@node01 ~] cd /opt/[root@node01 opt] touch &#123;a..f&#125; #åˆ›å»ºæµ‹è¯•æ–‡ä»¶[root@node01 opt] llæ€»ç”¨é‡ 0-rw-r--r--. 1 root root 0 2æœˆ 2 23:59 a-rw-r--r--. 1 root root 0 2æœˆ 2 23:59 b-rw-r--r--. 1 root root 0 2æœˆ 2 23:59 c-rw-r--r--. 1 root root 0 2æœˆ 2 23:59 d-rw-r--r--. 1 root root 0 2æœˆ 2 23:59 e-rw-r--r--. 1 root root 0 2æœˆ 2 23:59 f# åœ¨node04ä¹Ÿå¯çœ‹åˆ°æ–°åˆ›å»ºçš„æ–‡ä»¶ï¼Œä¿¡ä»»å­˜å‚¨æ± ä¸­çš„æ¯ä¸€å°ä¸»æœºæŒ‚è½½è¿™ä¸ªå·åéƒ½å¯ä»¥çœ‹åˆ°[root@node04 ~] mount -t glusterfs 127.0.0.1:/gv1 /opt[root@node04 ~] ll /opt/æ€»ç”¨é‡ 0-rw-r--r--. 1 root root 0 2æœˆ 2 2018 a-rw-r--r--. 1 root root 0 2æœˆ 2 2018 b-rw-r--r--. 1 root root 0 2æœˆ 2 2018 c-rw-r--r--. 1 root root 0 2æœˆ 2 2018 d-rw-r--r--. 1 root root 0 2æœˆ 2 2018 e-rw-r--r--. 1 root root 0 2æœˆ 2 2018 f[root@node01 opt] ll /data/brick1/æ€»ç”¨é‡ 0-rw-r--r--. 2 root root 0 2æœˆ 2 23:59 a-rw-r--r--. 2 root root 0 2æœˆ 2 23:59 b-rw-r--r--. 2 root root 0 2æœˆ 2 23:59 c-rw-r--r--. 2 root root 0 2æœˆ 2 23:59 e[root@node02 ~] ll /data/brick1æ€»ç”¨é‡ 0-rw-r--r--. 2 root root 0 2æœˆ 2 23:59 d-rw-r--r--. 2 root root 0 2æœˆ 2 23:59 f#æ–‡ä»¶å®é™…å­˜åœ¨ä½ç½®node01å’Œnode02ä¸Šçš„/data/brick1ç›®å½•ä¸‹,é€šè¿‡hashåˆ†åˆ«å­˜åˆ°node01å’Œnode02ä¸Šçš„åˆ†å¸ƒå¼ç£ç›˜ä¸Š é…ç½®å¤åˆ¶å·å¤åˆ¶æ¨¡å¼ï¼Œæ—¢AFR, åˆ›å»ºvolume æ—¶å¸¦ replica x æ•°é‡: å°†æ–‡ä»¶å¤åˆ¶åˆ° replica x ä¸ªèŠ‚ç‚¹ä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# è¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯ä½¿ç”¨Replicatedçš„æ–¹å¼ï¼Œå»ºç«‹ä¸€ä¸ªåä¸ºgv2çš„å·(Volume)ï¼Œå­˜å‚¨å—(Brick)ä¸º2ä¸ªï¼Œåˆ†åˆ«ä¸ºnode01:/data/brick2 å’Œ node02:/data/brick2ï¼›# foreä¸ºå¼ºåˆ¶åˆ›å»ºï¼šå› ä¸ºå¤åˆ¶å·åœ¨åŒæ–¹ä¸»æœºé€šä¿¡æœ‰æ•…éšœå†æ¢å¤é€šä¿¡æ—¶å®¹æ˜“å‘ç”Ÿè„‘è£‚ã€‚æœ¬æ¬¡ä¸ºå®éªŒç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ã€‚[root@node01 ~] gluster volume create gv2 replica 2 node01:/data/brick2 node02:/data/brick2 force volume create: gv2: success: please start the volume to access data[root@node01 ~] gluster volume start gv2 #å¯åŠ¨gv2å·volume start: gv2: success[root@node01 ~] gluster volume info gv2 #æŸ¥çœ‹gv2ä¿¡æ¯Volume Name: gv2Type: Replicate #å¤åˆ¶å·Volume ID: 9f33bd9a-7096-4749-8d91-1e6de3b50053Status: StartedSnapshot Count: 0Number of Bricks: 1 x 2 = 2Transport-type: tcpBricks:Brick1: node01:/data/brick2Brick2: node02:/data/brick2Options Reconfigured:transport.address-family: inetnfs.disable: onperformance.client-io-threads: off[root@node01 ~] mount -t glusterfs 127.0.0.1:/gv2 /mnt[root@node01 ~] df -hæ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹/dev/sdc 5.0G 33M 5.0G 1% /data/brick2/dev/sdd 5.0G 33M 5.0G 1% /data/brick3/dev/sdb 5.0G 33M 5.0G 1% /data/brick1127.0.0.1:/gv1 10G 65M 10G 1% /opt127.0.0.1:/gv2 5.0G 33M 5.0G 1% /mnt #å®¹é‡æ˜¯æ€»å®¹é‡çš„ä¸€åŠ[root@node01 ~] cd /mnt/[root@node01 mnt] touch &#123;1..6&#125;[root@node01 mnt] ll /data/brick2æ€»ç”¨é‡ 0-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 1-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 2-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 3-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 4-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 5-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 6[root@node02 ~] ll /data/brick2æ€»ç”¨é‡ 0-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 1-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 2-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 3-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 4-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 5-rw-r--r--. 2 root root 0 2æœˆ 3 01:06 6# åˆ›å»ºæ–‡ä»¶çš„å®é™…å­˜åœ¨ä½ç½®ä¸ºnode01å’Œnode02ä¸Šçš„/data/brick2ç›®å½•ä¸‹ï¼Œå› ä¸ºæ˜¯å¤åˆ¶å·ï¼Œè¿™ä¸¤ä¸ªç›®å½•ä¸‹çš„å†…å®¹æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ é…ç½®æ¡å¸¦å·12345678910111213141516171819202122232425262728293031323334353637383940414243[root@node01 ~] gluster volume create gv3 stripe 2 node01:/data/brick3 node02:/data/brick3 forcevolume create: gv3: success: please start the volume to access data[root@node01 ~] gluster volume start gv3volume start: gv3: success[root@node01 ~] gluster volume info gv3 Volume Name: gv3Type: StripeVolume ID: 54c16832-6bdf-42e2-81a9-6b8d7b547c1aStatus: StartedSnapshot Count: 0Number of Bricks: 1 x 2 = 2Transport-type: tcpBricks:Brick1: node01:/data/brick3Brick2: node02:/data/brick3Options Reconfigured:transport.address-family: inetnfs.disable: on[root@node01 ~] mkdir /data01[root@node01 ~] mount -t glusterfs 127.0.0.1:/gv3 /data01[root@node01 ~] df -hæ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹127.0.0.1:/gv3 10G 65M 10G 1% /data01[root@node01 ~] dd if=/dev/zero bs=1024 count=10000 of=/data01/10M.file[root@node01 ~] dd if=/dev/zero bs=1024 count=20000 of=/data01/20M.file[root@node01 ~] ll /data01/ -hæ€»ç”¨é‡ 30M-rw-r--r--. 1 root root 9.8M 2æœˆ 3 02:03 10M.file-rw-r--r--. 1 root root 20M 2æœˆ 3 02:04 20M.file*************************************************************************************#æ–‡ä»¶çš„å®é™…å­˜æ”¾ä½ç½®ï¼š[root@node01 ~] ll -h /data/brick3æ€»ç”¨é‡ 15M-rw-r--r--. 2 root root 4.9M 2æœˆ 3 02:03 10M.file-rw-r--r--. 2 root root 9.8M 2æœˆ 3 02:03 20M.file[root@node02 ~] ll -h /data/brick3æ€»ç”¨é‡ 15M-rw-r--r--. 2 root root 4.9M 2æœˆ 3 02:03 10M.file-rw-r--r--. 2 root root 9.8M 2æœˆ 3 02:04 20M.file# ä¸Šé¢å¯ä»¥çœ‹åˆ° 10M 20M çš„æ–‡ä»¶åˆ†åˆ«åˆ†æˆäº† 2 å—ï¼ˆè¿™æ˜¯æ¡å¸¦çš„ç‰¹ç‚¹ï¼‰ï¼Œå†™å…¥çš„æ—¶å€™æ˜¯å¾ªç¯åœ°ä¸€ç‚¹ä¸€ç‚¹åœ¨node01å’Œnode02çš„ç£ç›˜ä¸Š.#ä¸Šé¢é…ç½®çš„æ¡å¸¦å·åœ¨ç”Ÿäº§ç¯å¢ƒæ˜¯å¾ˆå°‘ä½¿ç”¨çš„ï¼Œå› ä¸ºå®ƒä¼šå°†æ–‡ä»¶ç ´åï¼Œæ¯”å¦‚ä¸€ä¸ªå›¾ç‰‡ï¼Œå®ƒä¼šå°†å›¾ç‰‡ä¸€ä»½ä¸€ä»½åœ°åˆ†åˆ«å­˜åˆ°æ¡å¸¦å·ä¸­çš„brickä¸Šã€‚ é…ç½®åˆ†å¸ƒå¼å¤åˆ¶å·(æ‹“å±•å·)æ³¨æ„: å—æœåŠ¡å™¨çš„æ•°é‡å¿…é¡»æ˜¯å¤åˆ¶çš„å€æ•° å°†æŒ‰å—æœåŠ¡å™¨çš„æ’åˆ—é¡ºåºæŒ‡å®šç›¸é‚»çš„å—æœåŠ¡å™¨æˆä¸ºå½¼æ­¤çš„å¤åˆ¶ï¼› ä¾‹å¦‚ï¼Œ8å°æœåŠ¡å™¨ï¼š å½“å¤åˆ¶å‰¯æœ¬ä¸º2æ—¶ï¼ŒæŒ‰ç…§æœåŠ¡å™¨åˆ—è¡¨çš„é¡ºåºï¼ŒæœåŠ¡å™¨1å’Œ2ä½œä¸ºä¸€ä¸ªå¤åˆ¶,3å’Œ4ä½œä¸ºä¸€ä¸ªå¤åˆ¶,5å’Œ6ä½œä¸ºä¸€ä¸ªå¤åˆ¶,7å’Œ8ä½œä¸ºä¸€ä¸ªå¤åˆ¶ å½“å¤åˆ¶å‰¯æœ¬ä¸º4æ—¶ï¼ŒæŒ‰ç…§æœåŠ¡å™¨åˆ—è¡¨çš„é¡ºåºï¼ŒæœåŠ¡å™¨1/2/3/4ä½œä¸ºä¸€ä¸ªå¤åˆ¶,5/6/7/8ä½œä¸ºä¸€ä¸ªå¤åˆ¶ 1234567891011121314151617181920212223242526272829#å°†åŸæœ‰çš„å¤åˆ¶å·gv2è¿›è¡Œæ‰©å®¹ï¼Œä½¿å…¶æˆä¸ºåˆ†å¸ƒå¼å¤åˆ¶å·ï¼›#è¦æ‰©å®¹å‰éœ€åœæ‰gv2[root@node01 ~] gluster volume stop gv2[root@node01 ~] gluster volume add-brick gv2 replica 2 node03:/data/brick1 node04:/data/brick1 force #æ·»åŠ brickåˆ°gv2ä¸­volume add-brick: success[root@node01 ~] gluster volume start gv2volume start: gv2: success[root@node01 ~] gluster volume info gv2 Volume Name: gv2Type: Distributed-Replicate # è¿™é‡Œæ˜¾ç¤ºæ˜¯åˆ†å¸ƒå¼å¤åˆ¶å·ï¼Œæ˜¯åœ¨ gv2 å¤åˆ¶å·çš„åŸºç¡€ä¸Šå¢åŠ  2 å— brick å½¢æˆçš„Volume ID: 9f33bd9a-7096-4749-8d91-1e6de3b50053Status: StartedSnapshot Count: 0Number of Bricks: 2 x 2 = 4Transport-type: tcpBricks:Brick1: node01:/data/brick2Brick2: node02:/data/brick2Brick3: node03:/data/brick1Brick4: node04:/data/brick1Options Reconfigured:transport.address-family: inetnfs.disable: onperformance.client-io-threads: offæ³¨æ„ï¼šå½“ä½ ç»™åˆ†å¸ƒå¼å¤åˆ¶å·å’Œåˆ†å¸ƒå¼æ¡å¸¦å·å¢åŠ  bricks æ—¶ï¼Œä½ å¢åŠ çš„ bricks æ•°ç›®å¿…é¡»æ˜¯å¤åˆ¶æˆ–æ¡å¸¦æ•°ç›®çš„å€æ•°ï¼Œä¾‹å¦‚ï¼šä½ ç»™ä¸€ä¸ªåˆ†å¸ƒå¼å¤åˆ¶å·çš„ replica ä¸º 2ï¼Œä½ åœ¨å¢åŠ  bricks çš„æ—¶å€™æ•°é‡å¿…é¡»ä¸º2ã€4ã€6ã€8ç­‰ã€‚æ‰©å®¹åè¿›è¡Œæµ‹è¯•ï¼Œå‘ç°æ–‡ä»¶éƒ½åˆ†å¸ƒåœ¨æ‰©å®¹å‰çš„å·ä¸­ã€‚ é…ç½®åˆ†å¸ƒå¼æ¡å¸¦å·(æ‹“å±•å·)1234567891011121314151617181920212223#å°†åŸæœ‰çš„å¤åˆ¶å·gv3è¿›è¡Œæ‰©å®¹ï¼Œä½¿å…¶æˆä¸ºåˆ†å¸ƒå¼æ¡å¸¦å·#è¦æ‰©å®¹å‰éœ€åœæ‰gv3[root@node01 ~] gluster volume stop gv3[root@node01 ~] gluster volume add-brick gv3 stripe 2 node03:/data/brick2 node04:/data/brick2 force #æ·»åŠ brickåˆ°gv3ä¸­[root@node01 ~] gluster volume start gv3volume start: gv3: success[root@node01 ~] gluster volume info gv3 Volume Name: gv3Type: Distributed-Stripe # è¿™é‡Œæ˜¾ç¤ºæ˜¯åˆ†å¸ƒå¼æ¡å¸¦å·ï¼Œæ˜¯åœ¨ gv3 æ¡å¸¦å·çš„åŸºç¡€ä¸Šå¢åŠ  2 å— brick å½¢æˆçš„Volume ID: 54c16832-6bdf-42e2-81a9-6b8d7b547c1aStatus: StartedSnapshot Count: 0Number of Bricks: 2 x 2 = 4Transport-type: tcpBricks:Brick1: node01:/data/brick3Brick2: node02:/data/brick3Brick3: node03:/data/brick2Brick4: node04:/data/brick2Options Reconfigured:transport.address-family: inetnfs.disable: on ç£ç›˜å­˜å‚¨å¹³è¡¡(æ‹“å±•å·åæ“ä½œ)å¹³è¡¡å¸ƒå±€æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå› ä¸ºå¸ƒå±€ç»“æ„æ˜¯é™æ€çš„ï¼Œå½“æ–°çš„ bricks åŠ å…¥ç°æœ‰å·ï¼Œæ–°åˆ›å»ºçš„æ–‡ä»¶ä¼šåˆ†å¸ƒåˆ°æ—§çš„ bricks ä¸­ï¼Œæ‰€ä»¥éœ€è¦å¹³è¡¡å¸ƒå±€ç»“æ„ï¼Œä½¿æ–°åŠ å…¥çš„ bricks ç”Ÿæ•ˆã€‚å¸ƒå±€å¹³è¡¡åªæ˜¯ä½¿æ–°å¸ƒå±€ç”Ÿæ•ˆï¼Œå¹¶ä¸ä¼šåœ¨æ–°çš„å¸ƒå±€ä¸­ç§»åŠ¨è€çš„æ•°æ®ï¼Œå¦‚æœä½ æƒ³åœ¨æ–°å¸ƒå±€ç”Ÿæ•ˆåï¼Œé‡æ–°å¹³è¡¡å·ä¸­çš„æ•°æ®ï¼Œè¿˜éœ€è¦å¯¹å·ä¸­çš„æ•°æ®è¿›è¡Œå¹³è¡¡ã€‚ 12345678910111213141516171819202122232425262728293031#åœ¨gv2çš„åˆ†å¸ƒå¼å¤åˆ¶å·çš„æŒ‚è½½ç›®å½•ä¸­åˆ›å»ºæµ‹è¯•æ–‡ä»¶å¦‚ä¸‹[root@node01 ~] df -hæ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹127.0.0.1:/gv2 10G 65M 10G 1% /mnt[root@node01 ~] cd /mnt/[root@node01 mnt] touch &#123;x..z&#125;#æ–°åˆ›å»ºçš„æ–‡ä»¶åªåœ¨è€çš„brickä¸­æœ‰ï¼Œåœ¨æ–°åŠ å…¥çš„brickä¸­æ˜¯æ²¡æœ‰çš„[root@node01 mnt]# ls /data/brick21 2 3 4 5 6 x y z[root@node02 ~] ls /data/brick21 2 3 4 5 6 x y z[root@node03 ~] ll -h /data/brick1æ€»ç”¨é‡ 0[root@node04 ~] ll -h /data/brick1æ€»ç”¨é‡ 0# ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œæ–°åˆ›å»ºçš„æ–‡ä»¶è¿˜æ˜¯åœ¨ä¹‹å‰çš„ bricks ä¸­ï¼Œå¹¶æ²¡æœ‰åˆ†å¸ƒä¸­æ–°åŠ çš„ bricks ä¸­# ä¸‹é¢è¿›è¡Œç£ç›˜å­˜å‚¨å¹³è¡¡[root@node01 ~] gluster volume rebalance gv2 start[root@node01 ~] gluster volume rebalance gv2 status #æŸ¥çœ‹å¹³è¡¡å­˜å‚¨çŠ¶æ€# æŸ¥çœ‹ç£ç›˜å­˜å‚¨å¹³è¡¡åæ–‡ä»¶åœ¨ bricks ä¸­çš„åˆ†å¸ƒæƒ…å†µ[root@node01 ~] ls /data/brick21 5 y[root@node02 ~] ls /data/brick21 5 y[root@node03 ~] ls /data/brick12 3 4 6 x z[root@node04 ~] ls /data/brick12 3 4 6 x z# ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºéƒ¨åˆ†æ–‡ä»¶å·²ç»å¹³è¡¡åˆ°æ–°åŠ å…¥çš„brickä¸­äº†# æ¯åšä¸€æ¬¡æ‰©å®¹åéƒ½éœ€è¦åšä¸€æ¬¡ç£ç›˜å¹³è¡¡ã€‚ ç£ç›˜å¹³è¡¡æ˜¯åœ¨ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹å†åšçš„ï¼Œä¸€èˆ¬å†åˆ›å»ºä¸€ä¸ªå·å°±å¯ä»¥äº†ã€‚ ç§»é™¤brick(æ”¶ç¼©å·)ä½ å¯èƒ½æƒ³åœ¨çº¿ç¼©å°å·çš„å¤§å°ï¼Œä¾‹å¦‚ï¼šå½“ç¡¬ä»¶æŸåæˆ–ç½‘ç»œæ•…éšœçš„æ—¶å€™ï¼Œä½ å¯èƒ½æƒ³åœ¨å·ä¸­ç§»é™¤ç›¸å…³çš„ bricksã€‚ æ³¨æ„ï¼šå½“ä½ ç§»é™¤ bricks çš„æ—¶å€™ï¼Œä½ åœ¨ gluster çš„æŒ‚è½½ç‚¹å°†ä¸èƒ½ç»§ç»­è®¿é—®æ•°æ®ï¼Œåªæœ‰é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ç§»é™¤åä½ æ‰èƒ½ç»§ç»­è®¿é—® bricks ä¸­çš„æ•°æ®ã€‚å½“ç§»é™¤åˆ†å¸ƒå¼å¤åˆ¶å·æˆ–è€…åˆ†å¸ƒå¼æ¡å¸¦å·çš„æ—¶å€™ï¼Œç§»é™¤çš„ bricks æ•°ç›®å¿…é¡»æ˜¯ replica æˆ–è€… stripe çš„å€æ•°ã€‚ ä½†æ˜¯ç§»é™¤brickåœ¨ç”Ÿäº§ç¯å¢ƒä¸­åŸºæœ¬ä¸Šä¸åšçš„ï¼Œå¦‚æœæ˜¯ç¡¬ç›˜åæ‰çš„è¯ï¼Œç›´æ¥æ¢ä¸ªå¥½çš„ç¡¬ç›˜å³å¯ï¼Œç„¶åå†å¯¹æ–°çš„ç¡¬ç›˜è®¾ç½®å·æ ‡è¯†å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œåé¢ä¼šæ¼”ç¤ºç¡¬ä»¶æ•…éšœæˆ–ç³»ç»Ÿæ•…éšœçš„è§£å†³åŠæ³•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243[root@node01 ~] gluster volume stop gv2# å…ˆå°†æ•°æ®è¿ç§»åˆ°å…¶å®ƒå¯ç”¨çš„Brickï¼Œè¿ç§»ç»“æŸåæ‰å°†è¯¥Brickç§»é™¤ï¼š[root@node01 ~] gluster volume remove-brick gv2 replica 2 node03:/data/brick1 node04:/data/brick1 start# åœ¨æ‰§è¡Œäº†startä¹‹åï¼Œå¯ä»¥ä½¿ç”¨statuså‘½ä»¤æŸ¥çœ‹ç§»é™¤è¿›åº¦[root@node01 ~] gluster volume remove-brick gv2 replica 2 node03:/data/brick1 node04:/data/brick1 status# ä¸è¿›è¡Œæ•°æ®è¿ç§»ï¼Œç›´æ¥åˆ é™¤è¯¥Brick[root@node01 ~] gluster volume remove-brick gv2 replica 2 node03:/data/brick1 node04:/data/brick1 commit[root@node01 ~] gluster volume info gv2 Volume Name: gv2Type: ReplicateVolume ID: 9f33bd9a-7096-4749-8d91-1e6de3b50053Status: StoppedSnapshot Count: 0Number of Bricks: 1 x 2 = 2Transport-type: tcpBricks:Brick1: node01:/data/brick2Brick2: node02:/data/brick2Options Reconfigured:transport.address-family: inetnfs.disable: onperformance.client-io-threads: off# å¦‚æœè¯¯æ“ä½œåˆ é™¤äº†åï¼Œå…¶å®æ–‡ä»¶è¿˜åœ¨ /storage/brick1 é‡Œé¢çš„ï¼ŒåŠ å›æ¥å°±å¯ä»¥äº†[root@node01 ~] gluster volume add-brick gv2 replica 2 node03:/data/brick1 node04:/data/brick1 force volume add-brick: success[root@node01 ~] gluster volume info gv2 Volume Name: gv2Type: Distributed-ReplicateVolume ID: 9f33bd9a-7096-4749-8d91-1e6de3b50053Status: StoppedSnapshot Count: 0Number of Bricks: 2 x 2 = 4Transport-type: tcpBricks:Brick1: node01:/data/brick2Brick2: node02:/data/brick2Brick3: node03:/data/brick1Brick4: node04:/data/brick1Options Reconfigured:transport.address-family: inetnfs.disable: onperformance.client-io-threads: off è¿ç§»å·(è¿ç§»å·)12345678910111213141516171819202122[root@node01 ~] gluster volume stop gv2# å…ˆå°†æ•°æ®è¿ç§»åˆ°å…¶å®ƒå¯ç”¨çš„Brickï¼š[root@node01 ~] gluster volume replace-brick gv2 node03:/data/brick1 node06:/data/brick1 start# åœ¨æ‰§è¡Œäº†startä¹‹åï¼Œå¯ä»¥ä½¿ç”¨statuså‘½ä»¤æŸ¥çœ‹è¿ç§»è¿›åº¦[root@node01 ~] gluster volume replace-brick gv2 node03:/data/brick1 node06:/data/brick1 status# åœ¨æ•°æ®è¿ç§»ç»“æŸåï¼Œæ‰§è¡Œcommitå‘½ä»¤æ¥è¿›è¡ŒBrickæ›¿æ¢ï¼Œå¦‚æœä¸è¿›è¡Œè¿ç§»ç›´æ¥commitä¼šé€ æˆæ•°æ®ä¸¢å¤±[root@node01 ~] gluster volume replace-brick gv2 node03:/data/brick1 node06:/data/brick1 commit[root@node01 ~] gluster volume info gv2 Volume Name: gv2Type: ReplicateVolume ID: 9f33bd9a-7096-4749-8d91-1e6de3b50053Status: StoppedSnapshot Count: 0Number of Bricks: 1 x 2 = 2Transport-type: tcpBricks:Brick1: node01:/data/brick2Brick2: node02:/data/brick2Options Reconfigured:transport.address-family: inetnfs.disable: onperformance.client-io-threads: off åˆ é™¤å·ä¸€èˆ¬ä¼šç”¨åœ¨å‘½åä¸è§„èŒƒçš„æ—¶å€™æ‰ä¼šåˆ é™¤ 12[root@node01 ~] gluster volume stop gv1[root@node01 ~] gluster volume delete gv å·è¯¯åˆ è§£å†³åŠæ³•12345678910[root@node01 ~] ls /var/lib/glusterd/vols/gv2 gv3[root@node01 ~] rm -rf /var/lib/glusterd/vols/gv3 #åˆ é™¤å·gv3çš„å·ä¿¡æ¯[root@node01 ~] ls /var/lib/glusterd/vols/ #å†æŸ¥çœ‹å·ä¿¡æ¯æƒ…å†µå¦‚ä¸‹ï¼šgv3å·ä¿¡æ¯è¢«åˆ é™¤äº†gv2[root@node01 ~] gluster volume sync node02 #å› ä¸ºå…¶ä»–èŠ‚ç‚¹æœåŠ¡å™¨ä¸Šçš„å·ä¿¡æ¯æ˜¯å®Œæ•´çš„ï¼Œæ¯”å¦‚ä»node02ä¸ŠåŒæ­¥æ‰€æœ‰å·ä¿¡æ¯å¦‚ä¸‹ï¼šSync volume may make data inaccessible while the sync is in progress. Do you want to continue? (y/n) yvolume sync: success[root@node01 ~] ls /var/lib/glusterd/vols/ #éªŒè¯å·ä¿¡æ¯æ˜¯å¦åŒæ­¥è¿‡æ¥gv2 gv3 å·æ•°æ®ä¸ä¸€è‡´è§£å†³åŠæ³•1234567891011[root@node01 ~] ls /data/brick2 #å¤åˆ¶å·çš„å­˜å‚¨ä½ç½®çš„æ•°æ®1 5 y[root@node01 ~] rm -f /data/brick2/y [root@node01 ~] ls /data/brick21 5[root@node02 ~] ls /data/brick21 5 y[root@node01 ~] gluster start gv2 #å› ä¸ºä¹‹å‰å…³é—­äº†ï¼Œå¦‚æœæœªå…³é—­å¯ä»¥å¿½ç•¥æ­¤æ­¥ã€‚[root@node01 ~] cat /mnt/y #é€šè¿‡è®¿é—®è¿™ä¸ªå¤åˆ¶å·çš„æŒ‚è½½ç‚¹çš„æ•°æ®æ¥åŒæ­¥æ•°æ®[root@node01 ~] ls /data/brick2/ #è¿™æ—¶å€™å†çœ‹å¤åˆ¶å·çš„æ•°æ®æ˜¯å¦åŒæ­¥æˆåŠŸ1 5 y glusterfs åˆ†å¸ƒå¼å­˜å‚¨ä¼˜åŒ–ä¼˜åŒ–å‚æ•° 1234567891011121314Auth_allow #IPè®¿é—®æˆæƒï¼›ç¼ºçœå€¼ï¼ˆ*.allow allï¼‰ï¼›åˆæ³•å€¼ï¼šIpåœ°å€Cluster.min-free-disk #å‰©ä½™ç£ç›˜ç©ºé—´é˜€å€¼ï¼›ç¼ºçœå€¼ï¼ˆ10%ï¼‰ï¼›åˆæ³•å€¼ï¼šç™¾åˆ†æ¯”Cluster.stripe-block-size #æ¡å¸¦å¤§å°ï¼›ç¼ºçœå€¼ï¼ˆ128KBï¼‰ï¼›åˆæ³•å€¼ï¼šå­—èŠ‚Network.frame-timeout #è¯·æ±‚ç­‰å¾…æ—¶é—´ï¼›ç¼ºçœå€¼ï¼ˆ1800sï¼‰ï¼›åˆæ³•å€¼ï¼š1-1800Network.ping-timeout #å®¢æˆ·ç«¯ç­‰å¾…æ—¶é—´ï¼›ç¼ºçœå€¼ï¼ˆ42sï¼‰ï¼›åˆæ³•å€¼ï¼š0-42Nfs.disabled #å…³é—­NFSæœåŠ¡ï¼›ç¼ºçœå€¼ï¼ˆOffï¼‰ï¼›åˆæ³•å€¼ï¼šOff|onPerformance.io-thread-count #IOçº¿ç¨‹æ•°ï¼›ç¼ºçœå€¼ï¼ˆ16ï¼‰ï¼›åˆæ³•å€¼ï¼š0-65Performance.cache-refresh-timeout #ç¼“å­˜æ ¡éªŒæ—¶é—´ï¼›ç¼ºçœå€¼ï¼ˆ1sï¼‰ï¼›åˆæ³•å€¼ï¼š0-61Performance.cache-size #è¯»ç¼“å­˜å¤§å°ï¼›ç¼ºçœå€¼ï¼ˆ32MBï¼‰ï¼›åˆæ³•å€¼ï¼šå­—èŠ‚Performance.quick-read: #ä¼˜åŒ–è¯»å–å°æ–‡ä»¶çš„æ€§èƒ½Performance.read-ahead: #ç”¨é¢„è¯»çš„æ–¹å¼æé«˜è¯»å–çš„æ€§èƒ½ï¼Œæœ‰åˆ©äºåº”ç”¨é¢‘ç¹æŒç»­æ€§çš„è®¿é—®æ–‡ä»¶ï¼Œå½“åº”ç”¨å®Œæˆå½“å‰æ•°æ®å—è¯»å–çš„æ—¶å€™ï¼Œä¸‹ä¸€ä¸ªæ•°æ®å—å°±å·²ç»å‡†å¤‡å¥½äº†ã€‚Performance.write-behind:å…ˆå†™å…¥ç¼“å­˜å†…ï¼Œåœ¨å†™å…¥ç¡¬ç›˜ï¼Œä»¥æé«˜å†™å…¥çš„æ€§èƒ½ã€‚Performance.io-cache:ç¼“å­˜å·²ç»è¢«è¯»è¿‡çš„ã€ ä¼˜åŒ–æ–¹å¼ 123456789å‘½ä»¤æ ¼å¼ï¼šgluster.volume set &lt;å·&gt;&lt;å‚æ•°&gt;ä¾‹å¦‚ï¼š#æ‰“å¼€é¢„è¯»æ–¹å¼è®¿é—®å­˜å‚¨[root@node01 ~]# gluster volume set gv2 performance.read-ahead on#è°ƒæ•´è¯»å–ç¼“å­˜çš„å¤§å°[root@mystorage gv2]# gluster volume set gv2 performance.cache-size 256M glusterfs ç›‘æ§åŠç»´æŠ¤1234567891011121314151617181920212223242526272829303132333435363738394041424344ä½¿ç”¨zabbixè‡ªå¸¦çš„æ¨¡æ¿å³å¯ï¼ŒCPUã€å†…å­˜ã€ç£ç›˜ç©ºé—´ã€ä¸»æœºè¿è¡Œæ—¶é—´ã€ç³»ç»Ÿloadã€‚æ—¥å¸¸æƒ…å†µè¦æŸ¥çœ‹æœåŠ¡å™¨ç›‘æ§å€¼ï¼Œé‡åˆ°æŠ¥è­¦è¦åŠæ—¶å¤„ç†ã€‚#çœ‹ä¸‹èŠ‚ç‚¹æœ‰æ²¡æœ‰åœ¨çº¿gluster volume status nfsp#å¯åŠ¨å®Œå…¨ä¿®å¤gluster volume heal gv2 full#æŸ¥çœ‹éœ€è¦ä¿®å¤çš„æ–‡ä»¶gluster volume heal gv2 info#æŸ¥çœ‹ä¿®å¤æˆåŠŸçš„æ–‡ä»¶gluster volume heal gv2 info healed#æŸ¥çœ‹ä¿®å¤å¤±è´¥çš„æ–‡ä»¶gluster volume heal gv2 heal-failed#æŸ¥çœ‹ä¸»æœºçš„çŠ¶æ€gluster peer status#æŸ¥çœ‹è„‘è£‚çš„æ–‡ä»¶gluster volume heal gv2 info split-brain#æ¿€æ´»quotaåŠŸèƒ½gluster volume quota gv2 enable#å…³é—­quotaåŠŸèƒ½gulster volume quota gv2 disable#ç›®å½•é™åˆ¶ï¼ˆå·ä¸­æ–‡ä»¶å¤¹çš„å¤§å°ï¼‰gluster volume quota limit-usage /data/30MB --/gv2/data#quotaä¿¡æ¯åˆ—è¡¨gluster volume quota gv2 list#é™åˆ¶ç›®å½•çš„quotaä¿¡æ¯gluster volume quota gv2 list /data#è®¾ç½®ä¿¡æ¯çš„è¶…æ—¶æ—¶é—´gluster volume set gv2 features.quota-timeout 5#åˆ é™¤æŸä¸ªç›®å½•çš„quotaè®¾ç½®gluster volume quota gv2 remove /dataå¤‡æ³¨ï¼šquotaåŠŸèƒ½ï¼Œä¸»è¦æ˜¯å¯¹æŒ‚è½½ç‚¹ä¸‹çš„æŸä¸ªç›®å½•è¿›è¡Œç©ºé—´é™é¢ã€‚å¦‚ï¼š/mnt/gulster/dataç›®å½•ï¼Œè€Œä¸æ˜¯å¯¹ç»„æˆå·ç»„çš„ç©ºé—´è¿›è¡Œé™åˆ¶ã€‚ æ•…éšœå¤„ç†ä¸€å°ä¸»æœºæ•…éšœä¸€å°èŠ‚ç‚¹æ•…éšœçš„æƒ…å†µåŒ…å«ä»¥ä¸‹æƒ…å†µï¼š ç‰©ç†æ•…éšœ åŒæ—¶æœ‰å¤šå—ç¡¬ç›˜æ•…éšœï¼Œé€ æˆæ•°æ®ä¸¢å¤± ç³»ç»ŸæŸåä¸å¯ä¿®å¤ è§£å†³æ–¹æ³•ï¼š â€‹ æ‰¾ä¸€å°å®Œå…¨ä¸€æ ·çš„æœºå™¨ï¼Œè‡³å°‘è¦ä¿è¯ç¡¬ç›˜æ•°é‡å’Œå¤§å°ä¸€è‡´ï¼Œå®‰è£…ç³»ç»Ÿï¼Œé…ç½®å’Œæ•…éšœæœºåŒæ ·çš„ IPï¼Œå®‰è£… gluster è½¯ä»¶ï¼Œä¿è¯é…ç½®ä¸€æ ·ï¼Œåœ¨å…¶ä»–å¥åº·èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ gluster peer statusï¼ŒæŸ¥çœ‹æ•…éšœæœåŠ¡å™¨çš„ uuid 1234567891011121314151617181920212223242526[root@mystorage2 ~] gluster peer statusNumber of Peers: 3Hostname: mystorage3Uuid: 36e4c45c-466f-47b0-b829-dcd4a69ca2e7State: Peer in Cluster (Connected)Hostname: mystorage4Uuid: c607f6c2-bdcb-4768-bc82-4bc2243b1b7aState: Peer in Cluster (Connected)Hostname: mystorage1Uuid: 6e6a84af-ac7a-44eb-85c9-50f1f46acef1State: Peer in Cluster (Disconnected)å¤åˆ¶ä»£ç ä¿®æ”¹æ–°åŠ æœºå™¨çš„ /var/lib/glusterd/glusterd.info å’Œ æ•…éšœæœºå™¨ä¸€æ ·[root@mystorage1 ~] cat /var/lib/glusterd/glusterd.infoUUID=6e6a84af-ac7a-44eb-85c9-50f1f46acef1operating-version=30712åœ¨ä¿¡ä»»å­˜å‚¨æ± ä¸­ä»»æ„èŠ‚ç‚¹æ‰§è¡Œgluster volume heal gv2 fullå°±ä¼šè‡ªåŠ¨å¼€å§‹åŒæ­¥ï¼Œä½†åœ¨åŒæ­¥çš„æ—¶å€™ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ã€‚å¯ä»¥æŸ¥çœ‹çŠ¶æ€gluster volume heal gv2 info]]></content>
      <categories>
        <category>æ•°æ®å­˜å‚¨</category>
        <category>GlusterFS</category>
      </categories>
      <tags>
        <tag>glusterfs</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fabricæ¶æ„]]></title>
    <url>%2F2019%2F06%2F21%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2FHyperledger%20fabric%2F5.Fabric%E6%9E%B6%E6%9E%84%2F</url>
    <content type="text"><![CDATA[Fabricçš„äº¤æ˜“æµç¨‹Fabric èŠ‚ç‚¹çš„ä¸»è¦åˆ†ç±»è®°è´¦èŠ‚ç‚¹ã€èƒŒä¹¦èŠ‚ç‚¹ã€æ’åºèŠ‚ç‚¹ äº¤æ˜“ä¸ƒæ­¥æ›² Propose å®¢æˆ·ç«¯æäº¤äº¤æ˜“ææ¡ˆï¼ŒåŠè°ƒç”¨äº†é“¾ç çš„è¯·æ±‚ Execute endorseèŠ‚ç‚¹è¿è¡Œä»¿çœŸç»“æœï¼Œäº§ç”Ÿè¯»å†™é›†ï¼Œå¹¶ç­¾åè¿”å›ç»™å®¢æˆ·ç«¯ Proposal å®¢æˆ·ç«¯æ¥æ”¶åˆ°äº†endorseèŠ‚ç‚¹çš„è¿è¡Œç»“æœï¼Œæ ¹æ®èƒŒä¹¦ç­–ç•¥ï¼Œå¦‚æœèƒŒä¹¦é€šè¿‡ï¼Œäº§ç”Ÿproposalç»™orderèŠ‚ç‚¹æ‰“åŒ…åŒºå— Order Trasantion OrderèŠ‚ç‚¹æ ¹æ®ä¸€å®šè§„åˆ™å°†äº¤æ˜“æ‰“åŒ…è¿›åŒºå—ï¼Œæ­¤å¤„ä¼šåº”ç”¨ä¸€å®šçš„å…±è¯†ç­–ç•¥ Deliver æ’åºèŠ‚ç‚¹å°†æ‰“åŒ…å¥½çš„åŒºå—åˆ†å‘ç»™commiterèŠ‚ç‚¹ Validate CommiterèŠ‚ç‚¹æ”¶åˆ°åŒºå—åï¼Œå¯¹æ¯ä¸€ä¸ªäº¤æ˜“è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡(ä¼šè¿›è¡ŒèƒŒä¹¦ç­–ç•¥ï¼Œå½“å‰keyçš„çŠ¶æ€ç­‰éªŒè¯)ï¼Œå°±è¿è¡Œè¯»å†™é›†ï¼Œå¹¶å°†åŒºå—ä¸Šé“¾ Notify å®¢æˆ·ç«¯æ”¶åˆ°åŒºå—ä¸Šé“¾çš„Eventï¼Œç¡®è®¤äº†äº¤æ˜“æˆåŠŸ Fabric æ€ä¹ˆè§£å†³åŒèŠ±çš„åœ¨ç¬¬ä¸€æ­¥åŒèŠ±çš„æƒ…å†µä¼šè¿è¡ŒæˆåŠŸï¼Œä½†æ˜¯å½“ç¬¬ä¸€æ¬¡èŠ±è´¹æˆåŠŸçš„æƒ…å†µä¸‹ï¼Œåé¢èŠ‚ç‚¹å†éªŒè¯äº¤æ˜“çš„è¯»å†™é›†çš„æ—¶å€™ï¼Œä¼šå› ä¸ºkeyçš„çŠ¶æ€å˜åŒ–è€ŒéªŒè¯å¤±è´¥ï¼Œæ‰€ä»¥åŒèŠ±åªä¼šåœ¨ç¬¬ä¸€æ¬¡çš„äº¤æ˜“ä¸­æˆåŠŸï¼› äº¤æ˜“æµç¨‹å›¾ Fabric çš„channelchannelçš„åˆ†ç±»ç³»ç»Ÿchannel: åœ¨ç½‘ç»œå¯åŠ¨çš„æ—¶å€™ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºçš„channel è‡ªå®šä¹‰channel: æ ¹æ®ä¸šåŠ¡é€»è¾‘åœ¨åé¢å¼€å‘çš„ä¸šåŠ¡channel åˆ›å»ºchannelçš„è¿‡ç¨‹åœ¨åˆ›å»ºchannelçš„æ—¶å€™ï¼Œ ä¼šæƒ³ç³»ç»Ÿchannel å‘é€ä¸€ä¸ªåˆ›å»ºchannelçš„è¯·æ±‚ï¼Œ äº§ç”Ÿåˆ›å»ºchannelçš„äº¤æ˜“ ä¸åŒchannelçš„æ•°æ®æ˜¯éš”ç¦»çš„ï¼Œå³ä¸€ä¸ªchannelä¼šç»´æŠ¤åŒä¸€å¥—è´¦æœ¬ åœ¨channelä¸Šéƒ¨ç½²æ™ºèƒ½åˆçº¦åŒä¸€ä¸ªchannelä¸­çš„æ™ºèƒ½åˆçº¦å¯ä»¥äº’ç›¸è°ƒç”¨ ä¸åŒchannelçš„æ™ºèƒ½åˆçº¦æŒ‡å®šæŸ¥è¯¢ä½†æ˜¯ä¸èƒ½æ›´æ”¹è´¦æœ¬çš„å†…å®¹ Fabric peerPeer èŠ‚ç‚¹ä»‹ç»peer èŠ‚ç‚¹çš„è§’è‰² ä»£è¡¨è”ç›Ÿé“¾ä¸­æ¯ä¸ªç»„ç»‡çš„èŠ‚ç‚¹ æ˜¯åŒºå—é“¾ç½‘ç»œçš„åŸºç¡€ï¼Œæ˜¯è´¦æœ¬å’Œæ™ºèƒ½åˆçº¦çš„è½½ä½“ çº¢è‰²æ¡†ä¸ºpeerèŠ‚ç‚¹åœ¨ç½‘ç»œä¸­çš„åœ°ä½ peerèŠ‚ç‚¹çš„åŠŸèƒ½ è¿æ¥äº†ä¸€ä¸ªæˆ–è€…å¤šä¸ªchannel ç»´æŠ¤äº†ä¸€ä¸ªæˆ–è€…å¤šä¸ªè´¦æœ¬ æä¾›æ™ºèƒ½åˆçº¦çš„è¿è¡Œç¯å¢ƒ æä¾›èº«ä»½è®¤è¯ï¼ŒåŠ å¯†ç­¾åï¼ŒèƒŒä¹¦ç­‰åŠŸèƒ½ èƒŒä¹¦ç­–ç•¥çš„ç¤ºä¾‹ Ledger çš„ä»‹ç»LedgeråŒ…å«çš„å†…å®¹lederåŒ…å«: blockchain(ç”±åŒºå—ç»„æˆçš„é“¾ï¼Œä»£è¡¨åŒºå—é“¾è´¦æœ¬) ã€Word state(è®°å½•è´¦æœ¬çš„å…¨å±€çŠ¶æ€) åŒºå—å­˜æ”¾çš„ä¿¡æ¯ åŒºå—å¤´å­˜æ”¾ä¿¡æ¯ äº¤æ˜“å­˜æ”¾çš„ä¿¡æ¯ å…¨å±€æ•°æ®åº“ç»´æŠ¤è´¦æœ¬çš„å½“å‰ä¿¡æ¯ï¼Œ ä»£è¡¨åŒºå—é“¾çš„å…¨å±€çŠ¶æ€ æ™ºèƒ½åˆçº¦çš„ä»‹ç»æ™ºèƒ½åˆçº¦çš„ä½œç”¨ å®šä¹‰äº†ä¸åŒç»„ç»‡è®°è´¦çš„è§„åˆ™ ç”Ÿæˆäº¤æ˜“å¹¶æ›´æ”¹è´¦æœ¬çš„çŠ¶æ€ fabricé€šè¿‡chaincodeæ¥å®ç°æ™ºèƒ½åˆçº¦ æ™ºèƒ½åˆçº¦æ˜¯æ€ä¹ˆæ›´æ”¹è´¦æœ¬çš„ chaincode ç”Ÿå‘½å‘¨æœŸ ç³»ç»Ÿchaincode LSCC: å¤„ç†é“¾ç æ‰“åŒ… install instanceç­‰ CSCC: ç»„ä»¶channel å¯¹channel è¿›è¡Œjoin é…ç½®ç­‰æ“ä½œ QSCC: æä¾›è´¦æœ¬query ç­‰api ESCC: å¯¹èƒŒä¹¦èŠ‚ç‚¹å¯¹ææ¡ˆè¿è¡Œçš„ç»“æœè¿›è¡Œç­¾å VSCC: éªŒè¯äº¤æ˜“çš„èƒŒä¹¦ç­–ç•¥ï¼Œ ESCC + VSCC ä¸»è¦è§£å†³äº†fabric çš„å…±è¯†é—®é¢˜ Gossipåè®® ç”¨æ¥ç®¡ç†peerèŠ‚ç‚¹çš„å‘ç° å’Œchannelçš„æˆå‘˜ç®¡ç†ï¼Œ ä¸æ–­å‘ç°æ–°çš„peer peerèŠ‚ç‚¹çš„è´¦æœ¬æ•°æ®ä¼ æ’­ æ–°åŠ å…¥çš„peerï¼Œå¯ä»¥é€šè¿‡gossip è¿›è¡Œç‚¹å¯¹ç‚¹å¿«é€Ÿæ›´æ–°æ•°æ® peerèŠ‚ç‚¹çš„åˆ†ç±»Leader peer è¿æ¥ order èŠ‚ç‚¹ï¼Œå¹¶æ¥å—æ–°åŒºå— å°†åŒºå—ä¿¡æ¯åˆ†å‘ç»™ç»„ç»‡ä¸­å…¶ä»–committing peers ä¸€ä¸ªç»„ç»‡ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªleader peer leader peer çš„é€‰ä¸¾è§„åˆ™å¯ä»¥æ˜¯: static(é™æ€æŒ‡å®š), Dynamicï¼ˆåŠ¨æ€é€‰ä¸¾ï¼‰ Anchor Peer é€šè¿‡ gossip åè®®ï¼Œ è®©ä¸åŒç»„ç»‡ä¹‹é—´çš„ peer èŠ‚ç‚¹äº’ç›¸è®¤è¯†ï¼Œ å¸®åŠ©ä¸åŒç»„ç»‡ä¹‹é—´çš„peerèŠ‚ç‚¹å»ºç«‹è¿æ¥ leader peer èŠ‚ç‚¹çš„é…ç½®æ–¹æ³• Orderer èŠ‚ç‚¹OrderèŠ‚ç‚¹çš„æ€§è´¨ å‚ä¸æ’åºçš„å·¥ä½œï¼Œå¯¹æ‰€æœ‰èŠ‚ç‚¹æäº¤çš„äº¤æ˜“è¿›è¡Œæ’åºæˆå— æ¯ä¸ªorderèŠ‚ç‚¹äº§ç”Ÿå—çš„hashå€¼å¿…é¡»ä¸€è‡´ è¦æœ‰å®¹é”™æœºåˆ¶ï¼Œå³ä¸€ä¸ªorderèŠ‚ç‚¹å¼‚å¸¸åï¼Œå…¶ä»–çš„èŠ‚ç‚¹è¦å¯ä»¥ç»§ç»­æ‰§è¡Œæ’åºå·¥ä½œ(ä¸€èˆ¬ä¼šæœ‰å®¹é”™çš„æœºåˆ¶) å¼ºä¸€è‡´æ€§ï¼Œå’Œpowä¸åŒï¼Œfabricæäº¤çš„åŒºå—å³æ˜¯ç¡®å®šçš„åŒºå—ï¼Œäº¤æ˜“æ˜¯ä¸èƒ½è¢«å¤å†™çš„ï¼Œæ‰€ä»¥ä¸€è‡´æ€§æ˜¯å¿…é¡»è¦æ±‚çš„ ä¸å…è®¸æœ‰èƒŒå›çš„orderèŠ‚ç‚¹ï¼Œ orderæ˜¯CFTçš„æ’åºç®—æ³•ï¼› Order å‡ºå—è§„åˆ™BatchSize: MaxMessageCount: AbsoluteMaxBytes PreferredMaxBytes BatchTimeout: Timeout: OrerèŠ‚ç‚¹æ€ä¹ˆåˆ›å»ºChannelçš„system Channel: ç®¡ç†å…¶ä»–ç”¨æˆ·çš„é“¾ï¼Œ åˆ›å»ºé“¾çš„æ—¶å€™é€šè¿‡systemchannelåˆ›å»ºä¸€ä¸ªæ–°çš„channelçš„ genesis block Order èŠ‚ç‚¹ç±»å‹SOLOåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ åªè¿›è¡Œç®€å•çš„æ‰“åŒ… hash å’Œå‡ºå—ï¼Œåªå¯ä»¥ç”¨äºæµ‹è¯•ç¯å¢ƒ Kafkaé€šè¿‡Kafka å’Œ zookeeperè¿›è¡Œæ’åº é€šè¿‡ Kafkaçš„ TTC message æ¥ä¿è¯æ‰€æœ‰çš„orderèŠ‚ç‚¹ï¼Œæ¯æ¬¡æ‰“åŒ…çš„åŒºå—åŒ…å«çš„äº¤æ˜“ç›¸åŒï¼Œå‡ºå—çš„hashå€¼ä¸€æ ·ï¼› Raft åŸºäº Etcd/raft çš„library è¿›è¡Œçš„å…±è¯† ä¸éœ€è¦zookeeperç­‰å¤–éƒ¨ä¾èµ–ï¼Œè¿ç»´ç®€å• å®ç°äº†orderä¹‹é—´çš„é€šè®¯å±‚ ä¸€ä¸ªchannelå¯ä»¥åœ¨æ‰€æœ‰orderèŠ‚ç‚¹çš„å­é›†ä¸­è¿è¡Œ æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´å¿…é¡»ä½¿ç”¨TLSé€šè®¯ ä¸kafkaåŒºåˆ«æ˜¯ï¼Œkafkaæ˜¯åŸºäºäº¤æ˜“åšçš„å…±è¯†ï¼Œ raftæ˜¯å¯¹å—åšçš„å…±è¯† MSPä¸CAFabric caåŠŸèƒ½ æ³¨å†Œåˆ›å»ºç”¨æˆ·å®ä¾‹ å°†ç”¨æˆ·è¯ä¹¦ç­¾åå¹¶ä¸‹è½½ è¯ä¹¦çš„æ›´æ–°å’Œæ’¤é”€ fabric ca æ˜¯å…¸å‹çš„CSç»“æ„ fabric server çš„å‚æ•° fabric ca init åäº§ç”Ÿçš„æ–‡ä»¶ fabric ca clientç«¯çš„å‘½ä»¤å‚æ•° fabric ca æ”¯æŒIdentityç±»å‹ peerã€orderã€clientã€ user ç”Ÿæˆè¯ä¹¦çš„ç¤ºä¾‹ Identity lifecycle PKI-X.509PKIä»‹ç»å…¬é’¥åŸºç¡€è®¾æ–½(PKI)æ˜¯ä¸€ä¸ªåˆ©ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•åŸç†å’ŒæŠ€æœ¯å®ç°å¹¶æä¾›å®‰å…¨æœåŠ¡çš„å…·æœ‰é€šç”¨æ€§çš„æŠ€æœ¯è§„èŒƒå’Œæ ‡å‡†ã€‚æ˜¯ç®¡ç†éå¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥å’Œç¡®è®¤ä¿¡æ¯ã€‚æ•´åˆæ•°å­—è¯ä¹¦ã€å…¬é’¥åŠ å¯†æŠ€æœ¯å’ŒCAçš„ç³»ç»Ÿã€‚å…¶ç»“åˆäº†è½¯ä»¶ã€åŠ å¯†æŠ€æœ¯å’Œç»„ç»‡éœ€è¦è¿›è¡Œéå¯¹ç§°åŠ å¯†ç®—æ³•çš„æœåŠ¡ã€‚ å…¬é’¥åŸºç¡€è®¾æ–½(PKI)æ˜¯ä¸€ç§éµå¾ªæ—¢å®šæ ‡å‡†çš„å¯†é’¥ç®¡ç†å¹³å°ï¼Œå®ƒé€šè¿‡â€œä¿¡æ¯åŠ å¯†â€å’Œâ€œæ•°å­—ç­¾åâ€ç­‰å¯†ç æœåŠ¡åŠæ‰€å¿…éœ€çš„å¯†é’¥å’Œè¯ä¹¦ç®¡ç†ä½“ç³»ï¼Œä¸ºå®ç°ç½‘ç»œé€šä¿¡ä¿å¯†æ€§ã€å®Œæ•´æ€§å’Œä¸å¯å¦è®¤æ€§çš„ä¸€å¥—å®Œæ•´ã€æˆç†Ÿå¯é çš„è§£å†³æ–¹æ¡ˆã€‚ç®€å•æ¥è¯´ï¼ŒPKIå°±æ˜¯åˆ©ç”¨å…¬é’¥ç†è®ºå’ŒæŠ€æœ¯å»ºç«‹çš„æä¾›å®‰å…¨æœåŠ¡çš„åŸºç¡€è®¾æ–½ã€‚PKIæŠ€æœ¯æ˜¯ä¿¡æ¯å®‰å…¨æŠ€æœ¯çš„æ ¸å¿ƒã€‚ä¹Ÿæ˜¯ç”µå­å•†åŠ¡çš„å…³é”®å’ŒåŸºç¡€æŠ€æœ¯ã€‚ MSPä»‹ç» MSPç»“æ„ Fabric åº”ç”¨å¼€å‘å¼€å‘æµç¨‹ éƒ¨ç½²Fabricç½‘ç»œ å¼€å‘å¹¶éƒ¨ç½²æ™ºèƒ½åˆçº¦ é€šè¿‡fabric-ca å’Œfabric-sdk è¿›è¡Œapplicationå±‚çš„ä¸šåŠ¡é€»è¾‘å¼€å‘ Fabric ç½‘ç»œéƒ¨ç½²æµç¨‹ å®‰è£…ordering service å®‰è£…peerèŠ‚ç‚¹ å¹¶é…ç½® è®°è´¦å’ŒèƒŒä¹¦èŠ‚ç‚¹ åˆ›å»ºchannel å°†ç»„ç»‡åŠ å…¥åˆ°channel å®‰è£…å¹¶å®ä¾‹åŒ–chaincode è°ƒç”¨é“¾ç  å¼€å‘äººå‘˜ä¸»è¦å…³å¿ƒçš„æ­¥éª¤é€šè¿‡fabricè¿›è¡Œå¼€å‘ï¼Œæˆ‘ä»¬ä¸»è¦éœ€è¦å¼€å‘çš„æœ‰ä¸¤éƒ¨åˆ†ï¼š å³ä¸Šå›¾æ©˜é»„è‰²çš„éƒ¨åˆ†: 1. chaincodeå¼€å‘ï¼› 2. Applicationå¼€å‘]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>Hyperledger fabric</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fabric æ™ºèƒ½åˆçº¦ç¼–å†™]]></title>
    <url>%2F2019%2F06%2F11%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2FHyperledger%20fabric%2F4.Fabric%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E7%BC%96%E5%86%99%2F</url>
    <content type="text"><![CDATA[Chaincode ä»‹ç»chaincodeä½œç”¨Fabricçš„Chaincodeæ˜¯ä¸€æ®µè¿è¡Œåœ¨å®¹å™¨ä¸­çš„ç¨‹åºã€‚Chaincodeæ˜¯å®¢æˆ·ç«¯ç¨‹åºå’ŒFabricä¹‹é—´çš„æ¡¥æ¢ã€‚ é€šè¿‡Chaincodeå®¢æˆ·ç«¯ç¨‹åºå¯ä»¥å‘èµ·äº¤æ˜“ï¼ŒæŸ¥è¯¢äº¤æ˜“ã€‚ chaincode è¿è¡Œç¯å¢ƒChaincodeæ˜¯è¿è¡Œåœ¨Dokcerå®¹å™¨ä¸­ï¼Œå› æ­¤ç›¸å¯¹æ¥è¯´å®‰å…¨ã€‚ æ”¯æŒè¯­è¨€ç›®å‰æ”¯æŒ java,nodeï¼Œgo,goæ˜¯æœ€ç¨³å®šçš„ã€‚å…¶ä»–è¿˜åœ¨å®Œå–„ã€‚ chaincode è¿è¡Œå’Œä½¿ç”¨æ­¥éª¤ åˆ›å»ºä»£ç ç›®å½• mkdir -p {path} å­˜æ”¾ç¼–å†™å¥½çš„chaincodeæºä»£ç  éƒ¨ç½²chaincode 1peer chaincode install -n &#123;chaincodeId&#125; -v &#123;version&#125; -p &#123;path&#125; å®ä¾‹åŒ–chaincode 1peer chaincode instantiate -o &#123;order_address&#125; -C &#123;channel&#125; -n &#123;chaincodeId&#125; -v &#123;version&#125; -c '&#123;"Args": ["init", "a", "100", "b", "200"]&#125;' -P "OR('Org1MSP.member', 'Org2MSP.member')" è°ƒç”¨chaincode 1peer chaincode invoke -o &#123;order_address&#125; -C &#123;chainnel&#125; -n &#123;chaincodeId&#125; -v &#123;version&#125; -c '&#123;"Args":["invoke", "1", "a", "b"]&#125;' Golang ç‰ˆChaincode ç¼–å†™è§„èŒƒChaincode ä»£ç ç»“æ„åŒ…åä¸€ä¸ªchaincodeé€šå¸¸æ˜¯ä¸€ä¸ª Goalngæºæ–‡ä»¶ï¼ŒåŒ…åå¿…é¡»æ˜¯main â€”â€” package main shimåŒ…â€œgithub.com/hyperledger/fabric/core/shaincode/shimâ€ pb â€œgithub.com/hyperledger/fabric/protos/peerâ€ shimæä¾›äº†Fabricç³»ç»Ÿçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ŒåŒ…å«äº†Chaincodeå’ŒFabicäº¤äº’çš„æ¥å£ã€‚ åœ¨Chaincodeä¸­ï¼Œæ‰§è¡Œèµ‹å€¼ï¼ŒæŸ¥è¯¢ï¼Œç­‰åŠŸèƒ½éƒ½æ˜¯éœ€è¦é€šè¿‡shim. å®šä¹‰ç»“æ„ä½“1type chainCodeExample struct &#123;&#125; chaincodeå¿…é¡»å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œç»“æ„ä½“çš„åç§°å¯ä»¥æ˜¯ä»»æ„ç¬¦åˆGolangå‘½åè§„èŒƒçš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å¿…é¡»å®ç°Init å’Œ Invoke æ¥å£æ–¹æ³•ï¼› å®ç°Initæ–¹æ³•123func (t *chainCodeExample) Init(stub shim.ChaincodeStubInterface) pb.Response &#123; Func, args := stub.GetFunvtionAndParameters()&#125; Initæ–¹æ³•æ˜¯ç³»ç»Ÿåˆå§‹åŒ–æ–¹æ³•ï¼Œå½“æ‰§è¡Œå‘½ä»¤ peer chaincode instantiate å®ä¾‹åŒ–chaincodeçš„æ—¶å€™è°ƒç”¨è¯¥æ–¹æ³•ï¼› å®ç°Invokeæ–¹æ³•123func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; Func, args := stub.GetFunvtionAndParameters()&#125; Invokeæ–¹æ³•ä¸»è¦æ˜¯å†™å…¥æ•°æ®ç­‰å¯¹é“¾è¿›è¡ŒæŸ¥è¯¢å’Œæ’å…¥ä¿®æ”¹ç­‰æ“ä½œçš„ä¸»è¦æ–¹æ³•ï¼› shimåŒ…æ ¸å¿ƒæ–¹æ³•Success1234func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; Func, args := stub.GetFunvtionAndParameters() return shim.Success([]byte("success invoke"))&#125; Success æ–¹æ³•è´Ÿè´£å°†æ­£ç¡®çš„æ¶ˆæ¯è¿”å›ç»™è°ƒç”¨chaincode çš„å®¢æˆ·ç«¯ Error1234func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; Func, args := stub.GetFunvtionAndParameters() return shim.Success([]byte("success invoke"))&#125; Erroræ–¹æ³•å°†é”™è¯¯çš„ä¿¡æ¯è¿”å›ç»™è°ƒç”¨Chaincodeçš„å®¢æˆ·ç«¯ã€‚ LogLevel12345func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; logLevel, _ := shim.LogLevel("DEBUG") shim.SetLoggingLevel(logLevel) return shim.Success([]byte("success invoke and not opter!"))&#125; LogLevel æ–¹æ³•è´Ÿè´£ä¿®æ”¹Chaincode ä¸­è¿è¡Œæ—¥å¿—çº§åˆ« Chaincode StubInterface æ¥å£æ–¹æ³•shimåŒ…æä¾›äº†ä¸€ä¸ªæ¥å£ ChaincodeStubInteï¼Œ åœ¨Invokeæ–¹æ³•å’ŒInit æ–¹æ³•ä¸­è¯¥æ¥å£ä½œä¸ºå‚æ•°ä¼ å…¥æ–¹æ³•ä¸­ï¼› ChaincodeStubInte ä¸»è¦æ–¹æ³• GetFunctionAndParameters è·å–è°ƒç”¨é“¾ç çš„æ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ PutState å­˜å‚¨æ•°æ®åˆ°è´¦æœ¬ä¸­ DelState åˆ é™¤è´¦æœ¬ä¸­çš„æ•°æ® GetState ä»è´¦æœ¬ä¸­è·å–æŒ‡å®šæ•°æ® CreateCompositeKey åˆ›å»ºç¬¦åˆé”® GetStateByPartialCompositeKey é€šè¿‡ç¬¦åˆé”®å–å€¼ SplitCompositeKey æ‹†åˆ†å¤åˆé”® GetStateByRange æŸ¥è¯¢æŒ‡å®škey æŒ‡å®šèŒƒå›´çš„å†å²è®°å½• GetHistoryForKey è·å–æŒ‡å®škeyçš„å†å²è®°å½• GetTxID è·å–äº¤æ˜“ç¼–å· GetTxTimestamp è·å–äº¤æ˜“çš„æ—¶é—´ GetCreator è·å–äº¤æ˜“çš„åˆ›å»ºè€… InvokeChaincode è°ƒç”¨å…¶ä»–çš„é“¾ç  1ã€ PutStateæ–¹æ³•å°†è°ƒç”¨è€…çš„æ•°æ®å­˜å‚¨åˆ°Fabricé“¾ä¸Š 1234func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; stub.PutState("a", []byte("test")) return shim.Success([]byte("success invoke"))&#125; 2ã€ GetStateæ–¹æ³•å°†è°ƒç”¨è€…çš„æ•°æ®å­˜å‚¨åˆ°Fabricé“¾ä¸Š 123456789func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; var keyValue []byte var err error keyValue, err = stub.GetState("getKey") if err != nil &#123; retutn shim.Error("find error") &#125; reutrn shim.Success(keyValue)&#125; 3ã€GetStateByRangeæ–¹æ³•æ ¹æ®Keyçš„èŒƒå›´æ¥æŸ¥è¯¢ç›¸å…³æ•°æ® 12345678910111213141516171819202122232425func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; startKey := "startKey" enKey := "endKey" keysIter, err := stub.GetStateByRange(startKey, endKey) if err != nil &#123; return shim.Error(fmt.Sprintf("GetStateByRange find err: %s", err)) &#125; defer keysIter.Close() var keyValues map[string]string for keysIter.HasNext() &#123; response, iterError := keysIter.Next() if iterError != nil &#123; return shim.Error(fmt.Sprintf("find and error %s", iterErr)) &#125; keyValues[response.Key] = response.Value &#125; for key, value := range keyValues &#123; fmt.Printf("key %d contains %s\n", key, value) &#125; jsonKeys, err := json.Marshal(keys) if err != nil &#123; return shim.Error(fmt.Sprintf("find error on marshaling json: %s", err)) &#125; return shim.Success(jsonKeys)&#125; 4ã€GetHistoryForKeyæ–¹æ³•æŸ¥è¯¢æŸä¸ªé”®çš„å†å²è®°å½• 12345678910111213141516171819202122232425262728func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; keyName := "key" keysIter, err := stub.GetHistoryForKey(keyName) if err != nil &#123; return shim.Error(fmt.Sprintf("GetHistoryForKey failed err: %s", err)) &#125; defer keysIter.Close() var keys []string for keysIter.HasNext() &#123; response, iterError := keysIter.Next() if iterError != nil &#123; return shim.Error(fmt.Sprintf("iter occur error %s", iterErr)) &#125; txid := response.TxId txvalue := response.Value txstatus := response.IsDelete txtimesamp := response.Timestamp tm := time.Unix(txtimesamp.Seconds, 0) datestr := tm.Format("2006-01-02 03:04:05 PM") fmt.Printf("Tx info - txid: %s value: %s if delete: %t datetime: %s \n", txid, string(txvalue), txstatus, datestr) keys = append(keys, txid) &#125; jsonKeys, err := json.Marshal(keys) if err != nil &#123; return shim.Error(fmt.Sprintf("find error on marshaling json: %s", err)) &#125; return shim.Success(jsonKeys)&#125; 5ã€DelState æ–¹æ³•12345678func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; delKey := "testKey" err := stub.DelState(delKey) if err != nil &#123; return shim.Error("delete error !") &#125; reutrn shim.Success([]byte("delete success !"))&#125; 6ã€CreateCompositeKey æ–¹æ³•è´Ÿè´£åˆ›å»ºç»„åˆé”® 1234567891011func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; params := []string("a", "b", "c") cparams := "test_params" keyName := "testKey" cKey, _ := stub.CreateCompositeKey(keyName, params) err := stub.PutState(ckey, []byte(c_params)) if err != nil &#123; fmt.Println("find errors %s", err) &#125; return shim.Success([]byte(cKey))&#125; 7ã€GetStateByPartialCompositeKey å’Œ SplitCompositeKey æ–¹æ³•ç”¨æ¥æŸ¥è¯¢å¤åˆé”®çš„å€¼ 12345678910111213141516171819202122232425func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; params := []string("a", "b") keyName := "testKey" response, err := stub.GetStateByPartialCompositeKey(keyName, params) if err != nil &#123; error_str := fmt.Sprintf("find error: %s", err) return shim.Error(error_str) &#125; defer response.Close() var i int var tlist []string for i = 0; response.HasNext; i++ &#123; responseRange, err := response.Next() if err != nil &#123; err_str := fmt.Springf("find error: %s", err) fmt.Println(err_str) return shim.Error(error_str) &#125; value1, compositeKeyParts, _ := stub.SplitCompositeKey(responseRange.Key) value2 := compositeKeyParts[0] value3 := compositeKeyParts[1] fmt.Printf("find value v1:%s v2:%s v3:%s\n", value1, value2, value3) &#125; return shim.Success("success")&#125; 8ã€GetTxTimestampæ–¹æ³•è´Ÿè´£å¥½å¶å»å½“å‰å®¢æˆ·ç«¯å‘é€äº¤æ˜“çš„æ—¶é—´æˆ³ 12345678910func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; txTime, err := stub.GetTxTimestamp() if err != nil &#123; fmt.Printf("Error getting transaction timestamp: %s", err) return shim.Error(fmt.Springf("Error getting transaction timestamp: %s', err)) &#125; tm := time.Unix(txTime.Seconds, 0) fmt.Printf("Transaction Time: %v\n", time.Format("2006-01-02 03:04:05 PM")) return shim.Success([]byte(fmt.Springf("time is : %s", tm.Format("2006-01-02 03:04:05 PM"))))&#125; 9ã€InvokeChaincodeæ–¹æ³•ç”¨æ¥åœ¨chaincodeä¸­è°ƒç”¨å…¶ä»–çš„chaincodeé“¾ç  123456789101112131415161718func (t *chainCodeExample) Invoke (stub shim.ChaincodeStubInterface) pb.Response &#123; chaincodeId := "chaincode2" channelId := "channel2" params1 := []string&#123;"query", "a"&#125; queryArgs := make([][]byte, len(params1)) for i, arg := range params1 &#123; queryArgs[i] = []byte(arg) &#125; response := stub.InvokeChaincode(chaincodeId, params1, channelId) if response.Status != shim.OD &#123; errStr := fmt.Sprintf("Failed to query chaincode, got error: %s", response.Payload) fmt.Printf(errStr) return shim.Error(errStr) &#125; result := string(response.Payload) fmt.Printf("invoke chaincode %s", result) return shim.Success([]byte("success invoke chaincode and not opter!"))&#125; Chaincode æ“ä½œå‘½ä»¤123456789101112131415161718Available Commands: install instantiate invoke list package query signpackage upgradeFlags: --cafile -o, --orderer --tls --transientGlobal Flags: --logging-level --test.coverprofile -v, --version ChaincodeèƒŒä¹¦è§„åˆ™æŒ‡å®šèƒŒä¹¦ä»‹ç»Fabaric ä¸­å¯¹æ•°æ®å‚ä¸æ–¹å¯¹æ•°æ®çš„ç¡®è®¤æ˜¯çœŸå®é€šè¿‡Chaincodeæ¥è¿›è¡Œçš„ã€‚ ä»€ä¹ˆæ˜¯èƒŒä¹¦å‘¢ï¼Ÿ èƒŒä¹¦å°±æ˜¯ä»ªè¡¨äº¤æ˜“è¢«ç¡®è®¤çš„è¿‡ç¨‹ã€‚å¤§æ¦‚æ„æ€å°±æ˜¯äº¤æ˜“ä½ å¿…é¡»èƒŒä¼šä¸€æœ¬ä¹¦æ‰èƒ½æ“ä½œã€‚ èƒŒä¹¦ç­–ç•¥è¢«ç”¨æ¥æŒ‡ç¤ºå¯¹ç›¸å…³çš„å‚ä¸æ–¹å¦‚ä½•å¯¹äº¤æ˜“è¿›è¡Œç¡®è®¤ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ°ä¸€ä¸ªäº¤æ˜“è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨vsccç³»ç»Ÿï¼ˆç³»ç»ŸChaincodeï¼Œä¸“é—¨è´Ÿè´£å¤„ç†èƒŒä¹¦ç›¸å…³çš„æ“ä½œï¼‰ä¸äº¤æ˜“çš„Chaincodeå…±åŒæ¥éªŒè¯äº¤æ˜“çš„åˆæ³•æ€§ã€‚åœ¨vsccå’Œäº¤æ˜“çš„ Chaincodeå…±åŒå¯¹äº¤æ˜“çš„ç¡®è®¤ä¸­ï¼Œé€šå¸¸ä¼šåšä¸€ä¸‹çš„æ ¡éªŒã€‚ æ‰€æœ‰çš„èƒŒä¹¦æ˜¯å¦æœ‰æ•ˆ å‚ä¸èƒŒä¹¦çš„æ•°é‡æ˜¯å¦æ»¡è¶³è¦æ±‚ æ‰€æœ‰èƒŒä¹¦å‚ä¸æ–¹æ˜¯å¦æ»¡è¶³è¦æ±‚ æŒ‡å®šèƒŒä¹¦è§„åˆ™çš„æ–¹æ³•èƒŒä¹¦ç­–ç•¥çš„è®¾ç½®æ˜¯é€šè¿‡Chaincodeéƒ¨ç½²æ—¶instantiateå‘½ä»¤ä¸­çš„-på‚æ•°æ¥è®¾ç½®çš„ã€‚ 1peer chaincode instantiate -o &#123;order_address&#125; -C &#123;channel&#125; -n &#123;chaincodeId&#125; -v &#123;version&#125; -c '&#123;"Args": ["init", "a", "100", "b", "200"]&#125;' -P "OR('Org1MSP.member', 'Org2MSP.member')" è¿™ä¸ªå‚æ•°åŒ…è¯´æ˜æ˜¯å½“å‰Chaincodeå‘èµ·çš„äº¤æ˜“ï¼Œéœ€è¦ç»„ç»‡ç¼–å·ä¸º Org1MSPçš„ç»„ç»‡ç¼–å·ä¸ºOrg2MSPçš„ç»„ç»‡ä¸­çš„ä»»ä½•ä¸€ä¸ªç”¨æˆ·å…±åŒå‚ä¸äº¤æ˜“çš„ç¡®è®¤å¹¶ä¸”åŒæ„ã€‚è¿™æ ·äº¤æ˜“æ‰èƒ½ç”Ÿæ•ˆå¹¶ä¸”è®°å½•åˆ° åŒºå—é“¾ä¸­ã€‚ é€šè¿‡ä¸Šè¿°èƒŒä¹¦ç­–ç•¥çš„ç¤ºä¾‹æˆ‘ä»¬å¯ä»¥çŸ¥é“èƒŒä¹¦ç­–ç•¥æ˜¯é€šè¿‡ä¸€å®šçš„å…³é”®å­—å’Œç³»ç»Ÿçš„å±æ€§ç»„æˆçš„ã€‚ èƒŒä¹¦ç¼–å†™ç¤ºä¾‹ é€»è¾‘ä¸å…³ç³» 1AND('Org1MSP.member', 'Org2MSP.member', 'Org3MSP.member') é€»è¾‘æˆ–å…³ç³» 1OR('Org1MSP.member', 'Org2MSP.member', 'Org3MSP.member') é€»è¾‘ä¸æˆ–å…³ç³»å¹¶å­˜ 1OR('Org1MSP.member', AND('Org2MSP.member', 'Org3MSP.member'))]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>Hyperledger fabric</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>Fabric</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[oauth2åŸç†åŠåº”ç”¨]]></title>
    <url>%2F2019%2F05%2F27%2F11.Golang%2FGolang%E5%B7%A5%E5%85%B7%E5%8C%85%2Foauth2%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8%2F</url>
    <content type="text"><![CDATA[OAuth2 çš„ç®€å•è§£é‡ŠOAuth2 æ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„æˆæƒæœºåˆ¶ï¼Œç”¨æ¥æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨æ¥ä½¿ç”¨ç”¨æˆ·çš„ä¸€äº›æ•°æ® é€šè¿‡OAuth2å¯ä»¥æ¯”è¾ƒç®€å•çš„å®ç°è·¨å¹³å°çš„èµ„æºå…±äº«ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹OAuth2å…·ä½“è§£å†³äº†å“ªæ–¹é¢çš„é—®é¢˜ï¼› ä¸€ä¸ªå…³äºå°åŒºé€å¿«é€’çš„åœºæ™¯åœ¨ä¸€ä¸ªå¤§å‹çš„å±…æ°‘å°åŒºï¼Œå°åŒºå…¥å£å¤„çš„é—¨æœ‰å¯†ç é”ï¼› è¿›å‡ºé—¨çš„æ—¶å€™ï¼Œéœ€è¦ä¸šä¸»è¾“å…¥å¯†ç ä¸‹èƒ½è¿›å…¥ï¼› ä½†æ˜¯å°åŒºç»å¸¸ä¼šæœ‰å¤–å–å’Œå¿«é€’å‘˜å‡ºå…¥ï¼Œå¿«é€’å‘˜éœ€è¦åœ¨æœ‰å¿«ä»¶æ´¾é€çš„æ—¶å€™æœ‰æƒé™è¿›å…¥å°åŒºï¼Œç°åœ¨å¿…é¡»æœ‰ä¸€ç§åŠæ³•å¯ä»¥è®©å¿«é€’å‘˜åœ¨æ²¡æœ‰è´¦å·å¯†ç çš„æƒ…å†µä¸‹é€šè¿‡é—¨ç¦ç³»ç»Ÿï¼Œè¿›å…¥å°åŒº å¦‚æœä¸šä¸»å°†å¯†ç å‘Šè¯‰äº†å¿«é€’å‘˜ï¼Œ é‚£å¿«é€’å‘˜å°±æ‹¥æœ‰äº†å’Œä¸šä¸»ä¸€æ ·çš„æƒé™ï¼Œå¿«é€’å‘˜å¯ä»¥ç”¨å¯†ç ååå¤å¤å‡ºå…¥å°åŒº, å¥½åƒå¹¶ä¸èƒ½è¿™æ ·è®¾è®¡ã€‚ å°åŒºæˆæƒæœºåˆ¶è®¾è®¡å¯¹äºä»¥ä¸Šé—®é¢˜ï¼Œå¯ä»¥è®¾è®¡ä¸€å¥—å¦‚ä¸‹çš„æˆæƒæ–¹æ¡ˆï¼Œæˆæƒçš„æµç¨‹å¦‚ä¸‹ é—¨ç¦ç³»ç»Ÿçš„å¯†ç è¾“å…¥ä¸‹æ–¹ï¼Œæä¾›ä¸€ä¸ªè·å–æˆæƒçš„æŒ‰é’®ã€‚å¿«é€’å‘˜éœ€è¦é¦–å…ˆæŒ‰è¿™ä¸ªæŒ‰é’®ï¼Œå»ç”³è¯·æˆæƒã€‚ æŒ‰ä¸‹æŒ‰é’®ä»¥åï¼Œ ä¸šä¸»çš„æ‰‹æœºå°±ä¼šå¼¹å‡ºå¯¹è¯æ¡†ï¼Œ æœ‰äººæ­£åœ¨è¦æ±‚æˆæƒã€‚ç³»ç»Ÿè¿˜ä¼šæ˜¾ç¤ºå‡ºè¯¥å¿«é€’å‘˜çš„å§“åï¼Œå·¥å·å’Œæ‰€å±çš„å¿«é€’å…¬å¸ï¼Œä¸šä¸»ç¡®è®¤å¿«é€’å‘˜çš„è¯·æ±‚å±å®ï¼Œå°±ä¼šç‚¹å‡»æŒ‰é’®ï¼Œå‘Šè¯‰é—¨ç¦ç³»ç»Ÿï¼Œæˆ‘åŒæ„ç»™ä¸ä»–è¿›å…¥å°åŒºçš„æƒé™ï¼› é—¨ç¦ç³»ç»Ÿå¾—åˆ°ä¸šä¸»çš„ç¡®è®¤ä»¥åï¼Œå‘å¿«é€’å‘˜æ˜¾ç¤ºä¸€ä¸ªè¿›å…¥å°åŒºçš„ä»¤ç‰Œ(ä¸€ä¸ªä¸´æ—¶å¯†ç , ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªæœŸé™)ã€‚ å¿«é€’å‘˜è¾“å…¥ä¸´æ—¶å¯†ç åï¼Œä¾¿å¯ä»¥è¿›å…¥å°åŒºï¼› äº’è”ç½‘æˆæƒæœºåˆ¶OAuthå…³äºå¿«é€’çš„ä¾‹å­ï¼Œè§£å†³äº†ä¸€ä¸ªä¸å±äºæœ¬å°åŒºç”¨æˆ·ï¼Œé€šè¿‡ä¸šä¸»(èµ„æºæ‰€æœ‰è€…)çš„æˆæƒï¼Œæœ‰äº†ä¸´æ—¶è¿›å…¥å°åŒºï¼Œæ‰§è¡Œä¸€äº›ä¸šä¸»æƒé™çš„é—®é¢˜ï¼› æŠŠè¯¥ä¾‹å­åº”ç”¨åˆ°äº’è”ç½‘åº”ç”¨çš„åœºæ™¯ï¼Œå°±æ˜¯OAuthçš„ä½œç”¨äº†ï¼› ä¸€ã€å±…æ°‘å°åŒºå°±ç›¸å½“äºæ‹¥æœ‰ç”¨æˆ·æ•°æ®èµ„æºçš„èµ„æºæœåŠ¡å™¨ã€‚æ¯”å¦‚ï¼Œæ”¯ä»˜å®å­˜å‚¨äº†æˆ‘ä»¬çš„å¤´åƒå’Œä¿¡ç”¨åˆ†ç­‰ä¿¡æ¯ï¼Œæƒ³è¦è·å–è¿™äº›æ•°æ®ï¼Œç”¨æˆ·ä¸€å®šè¦å…ˆæˆåŠŸç™»é™†æ”¯ä»˜å®ï¼› äºŒã€å¿«é€’å‘˜ç›¸å½“äºç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæƒ³è¦ç©¿è¿‡é—¨ç¦ç³»ç»Ÿï¼Œè¿›å…¥å°åŒºã€‚æ¯”å¦‚ï¼ŒæŸè´·æ¬¾æœºæ„æƒ³è¦é€šè¿‡æ”¯ä»˜å®ï¼Œè·å–ç”¨æˆ·çš„èŠéº»é¥®ç”¨åˆ†æ¥åˆ¤æ–­è´·æ¬¾é‡‘é¢ï¼› ä¸‰ã€å°±æ˜¯ä¸šä¸»æœ¬äººç›¸å½“äºäº’è”ç½‘åº”ç”¨çš„èµ„æºæ‰€æœ‰è€…ï¼ŒåŒæ„å¿«é€’å‘˜ç¬¬ä¸‰æ–¹è¿›å…¥å°åŒºï¼Œæ‰§è¡Œä¸šä¸»æœ¬äººçš„ä¸€äº›æƒé™ã€‚ æ€»ç»“: OAuthå°±æ˜¯ä¸€ç§æˆæƒæœºåˆ¶ï¼Œ æ•°æ®æ‰€æœ‰è€…å‘Šè¯‰ç³»ç»Ÿï¼ŒåŒæ„å¹¶æˆæƒç¬¬ä¸‰æ–¹è¿›å…¥ç³»ç»Ÿï¼Œè·å–ä¸€äº›æŒ‡å®šçš„æ•°æ®çš„æƒé™ã€‚ç³»ç»Ÿä»è€Œä¼šæä¾›ä¸€ä¸ªçŸ­æœŸçš„ä»¤ç‰Œç»™ç¬¬ä¸‰æ–¹ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…ï¼Œç¬¬ä¸‰æ–¹éƒ½å¯ä»¥é€šè¿‡è¯¥ä»¤ç‰Œè·å–ç”¨æˆ·å·²ç»æˆæƒè·å–çš„æ•°æ®ï¼›OAuthè§£å†³äº†ç¬¬ä¸‰æ–¹åº”ç”¨è·å–å¹³å°ç”¨æˆ·æ•°æ®çš„é—®é¢˜ï¼› OAuth2çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µä»€ä¹ˆæ˜¯OAuth2.0OAuth 2.0, å…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæ¥ä»£è¡¨èµ„æºæ‰€æœ‰è€…è·å¾—å¯¹HTTPæœåŠ¡çš„æœ‰é™è®¿é—®æƒé™ä»¥è‡ªå·±çš„åä¹‰è·å–è®¿é—®æƒé™ã€‚ åœ¨ä¼ ç»Ÿçš„å®¢æˆ·ç«¯ - æœåŠ¡å™¨èº«ä»½éªŒè¯æ¨¡å‹ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡ä½¿ç”¨èµ„æºæ‰€æœ‰è€…çš„å‡­æ®å‘æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯æ¥è¯·æ±‚æœåŠ¡å™¨ä¸Šçš„è®¿é—®å—é™èµ„æºï¼ˆå—ä¿æŠ¤èµ„æºï¼‰ã€‚ä¸ºäº†å‘ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæä¾›å¯¹å—é™èµ„æºçš„è®¿é—®ï¼Œèµ„æºæ‰€æœ‰è€…ä¸ç¬¬ä¸‰æ–¹å…±äº«å…¶å‡­æ®ã€‚è¿™ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜å’Œé™åˆ¶ã€‚ OAuthé€šè¿‡å¼•å…¥æˆæƒå±‚å¹¶å°†å®¢æˆ·ç«¯çš„è§’è‰²ä¸èµ„æºæ‰€æœ‰è€…çš„è§’è‰²åˆ†å¼€æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚åœ¨OAuthä¸­ï¼Œå®¢æˆ·ç«¯è¯·æ±‚è®¿é—®ç”±èµ„æºæ‰€æœ‰è€…æ§åˆ¶å¹¶ç”±èµ„æºæœåŠ¡å™¨æ‰˜ç®¡çš„èµ„æºï¼Œå¹¶å‘å‡ºä¸èµ„æºæ‰€æœ‰è€…ä¸åŒçš„å‡­æ®é›†ã€‚ å®¢æˆ·ç«¯ä¸æ˜¯ä½¿ç”¨èµ„æºæ‰€æœ‰è€…çš„å‡­è¯æ¥è®¿é—®å—ä¿æŠ¤èµ„æºï¼Œè€Œæ˜¯è·å–è®¿é—®ä»¤ç‰Œ - è¡¨ç¤ºç‰¹å®šèŒƒå›´ï¼Œç”Ÿå‘½å‘¨æœŸå’Œå…¶ä»–è®¿é—®å±æ€§çš„å­—ç¬¦ä¸²ã€‚æˆæƒæœåŠ¡å™¨åœ¨èµ„æºæ‰€æœ‰è€…çš„æ‰¹å‡†ä¸‹å‘ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯é¢å‘è®¿é—®ä»¤ç‰Œã€‚å®¢æˆ·ç«¯ä½¿ç”¨è®¿é—®ä»¤ç‰Œæ¥è®¿é—®èµ„æºæœåŠ¡å™¨æ‰˜ç®¡çš„å—ä¿æŠ¤èµ„æº ä»€ä¹ˆæ˜¯OpenID Connect 1.0OpenID Connect 1.0æ˜¯OAuth 2.0åè®®ä¹‹ä¸Šçš„ç®€å•èº«ä»½å±‚ã€‚å®ƒä½¿å®¢æˆ·ç«¯èƒ½å¤Ÿæ ¹æ®æˆæƒæœåŠ¡å™¨æ‰§è¡Œçš„èº«ä»½éªŒè¯æ¥éªŒè¯æœ€ç»ˆç”¨æˆ·çš„èº«ä»½ï¼Œä»¥åŠä»¥å¯äº’æ“ä½œå’Œç±»ä¼¼RESTçš„æ–¹å¼è·å–æœ‰å…³æœ€ç»ˆç”¨æˆ·çš„åŸºæœ¬é…ç½®æ–‡ä»¶ä¿¡æ¯ã€‚ ä½œä¸ºèƒŒæ™¯ï¼ŒOAuth 2.0æˆæƒæ¡†æ¶å’ŒOAuth 2.0æ‰¿è½½ä»¤ç‰Œä½¿ç”¨è§„èŒƒä¸ºç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªé€šç”¨æ¡†æ¶ï¼Œä»¥è·å–å’Œä½¿ç”¨å¯¹HTTPèµ„æºçš„æœ‰é™è®¿é—®ã€‚å®ƒä»¬å®šä¹‰äº†è·å–å’Œä½¿ç”¨è®¿é—®ä»¤ç‰Œæ¥è®¿é—®èµ„æºçš„æœºåˆ¶ï¼Œä½†æ²¡æœ‰å®šä¹‰æ ‡å‡†æ–¹æ³•æ¥æä¾›èº«ä»½ä¿¡æ¯ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰åˆ†æOAuth 2.0ï¼Œå®ƒå°±æ— æ³•æä¾›æœ‰å…³æœ€ç»ˆç”¨æˆ·èº«ä»½éªŒè¯çš„ä¿¡æ¯ã€‚ OpenID Connectå®ç°èº«ä»½éªŒè¯ï¼Œä½œä¸ºOAuth 2.0æˆæƒè¿‡ç¨‹çš„æ‰©å±•ã€‚ OpenID Connectå…è®¸æ‰€æœ‰ç±»å‹çš„å®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬åŸºäºWebï¼Œç§»åŠ¨å’ŒJavaScriptå®¢æˆ·ç«¯ï¼‰è¯·æ±‚å’Œæ¥æ”¶æœ‰å…³ç»è¿‡èº«ä»½éªŒè¯çš„ä¼šè¯å’Œæœ€ç»ˆç”¨æˆ·çš„ä¿¡æ¯ã€‚è§„èŒƒå¥—ä»¶æ˜¯å¯æ‰©å±•çš„ï¼Œå…è®¸å‚ä¸è€…åœ¨å¯¹å®ƒä»¬æœ‰æ„ä¹‰æ—¶ä½¿ç”¨å¯é€‰åŠŸèƒ½ï¼Œä¾‹å¦‚èº«ä»½æ•°æ®åŠ å¯†ï¼ŒOpenIDæä¾›ç¨‹åºçš„å‘ç°å’Œä¼šè¯ç®¡ç†ã€‚ OAuth2 çš„è§’è‰²å®šä¹‰ èµ„æºæ‰€æœ‰è€… èµ„æºæ‰€æœ‰è€…æ˜¯ OAuth 2 å››å¤§åŸºæœ¬è§’è‰²ä¹‹ä¸€ï¼Œåœ¨ OAuth 2 æ ‡å‡†ä¸­ï¼Œèµ„æºæ‰€æœ‰è€…å³ä»£è¡¨æˆæƒå®¢æˆ·ç«¯è®¿é—®æœ¬èº«èµ„æºä¿¡æ¯çš„ç”¨æˆ·ï¼ˆUserï¼‰ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨åœºæ™¯ä¸­çš„â€œå¼€å‘è€…Aâ€ã€‚å®¢æˆ·ç«¯è®¿é—®ç”¨æˆ·å¸æˆ·çš„æƒé™ä»…é™äºç”¨æˆ·æˆæƒçš„â€œèŒƒå›´â€ï¼ˆaka. scopeï¼Œä¾‹å¦‚è¯»å–æˆ–å†™å…¥æƒé™ï¼‰ã€‚ å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œä¸‹æ–‡ä¸­å‡ºç°çš„â€ç”¨æˆ·â€å°†ç»Ÿä¸€ä»£è¡¨èµ„æºæ‰€æœ‰è€…ã€‚ ç”¨æˆ·è®¤è¯ä¸­å¿ƒ éªŒè¯ç”¨æˆ·èº«ä»½çš„åœ°æ–¹ï¼Œæ¯”å¦‚ç½‘ç«™çš„ç™»å½•ç³»ç»Ÿï¼ˆå¯†ç éªŒè¯/ sessionéªŒè¯ï¼‰ï¼› èµ„æºæœåŠ¡å™¨(resource server) èµ„æºæœåŠ¡å™¨æ‰˜ç®¡äº†æ‰€æœ‰çš„å—ä¿æŠ¤çš„ç”¨æˆ·èµ„æºç­‰, å­˜å‚¨æœåŠ¡èµ„æºçš„åœ°æ–¹å°±æ˜¯èµ„æºæœåŠ¡å™¨ï¼› æˆ‘ä»¬ä½¿ç”¨æˆæƒçš„ç›®çš„ï¼Œå°±æ˜¯è·å–åœ¨èµ„æºæœåŠ¡å™¨ä¸Šå’Œç”¨æˆ·ç›¸å…³èµ„æºçš„èµ„æ ¼ï¼› æˆæƒä¸­å¿ƒ(oauth2 server) èµ„æºæœåŠ¡å™¨æ‰˜ç®¡äº†å—ä¿æŠ¤çš„ç”¨æˆ·è´¦å·ä¿¡æ¯ï¼Œè€ŒæˆæƒæœåŠ¡å™¨éªŒè¯ç”¨æˆ·èº«ä»½ç„¶åä¸ºå®¢æˆ·ç«¯æ´¾å‘èµ„æºè®¿é—®ä»¤ç‰Œã€‚ åœ¨ä¸Šè¿°åº”ç”¨åœºæ™¯ä¸­ï¼ŒGithub æ—¢æ˜¯æˆæƒæœåŠ¡å™¨ä¹Ÿæ˜¯èµ„æºæœåŠ¡å™¨ï¼Œä¸ªäººä¿¡æ¯å’Œä»“åº“ä¿¡æ¯å³ä¸ºèµ„æºï¼ˆResourceï¼‰ã€‚è€Œåœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œä¸åŒçš„æœåŠ¡å™¨åº”ç”¨å¾€å¾€ç‹¬ç«‹éƒ¨ç½²ï¼ŒååŒä¿æŠ¤ç”¨æˆ·è´¦æˆ·ä¿¡æ¯èµ„æºã€‚ å®¢æˆ·ç«¯ ( oauth2 client ) æ‰§è¡ŒæˆæƒæœåŠ¡æµç¨‹çš„åå°ç¨‹åº, è¯¥éƒ¨åˆ†ä¸€èˆ¬è¦ç”±ç¬¬ä¸‰æ–¹ç‹¬ç«‹å¼€å‘ï¼› æœ‰çš„èµ„æºæä¾›å•†ï¼Œä¼šæä¾›sdkç­‰ä¾›ç”¨æˆ·è¿›è¡Œå®¢æˆ·ç«¯çš„å¼€å‘ï¼› ç”¨æˆ·ç»ˆç«¯(æµè§ˆå™¨â€¦) è°ƒç”¨å®¢æˆ·ç«¯æ‰§è¡Œæˆæƒè¿‡ç¨‹çš„åœ°æ–¹ï¼Œä¸€èˆ¬ä¸ºæµè§ˆå™¨ã€‚ã€‚ã€‚ ä»¤ç‰Œä¸å¯†ç ä»¤ç‰Œï¼ˆtokenï¼‰ä¸å¯†ç ï¼ˆpasswordï¼‰çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½å¯ä»¥è¿›å…¥ç³»ç»Ÿï¼Œä½†æ˜¯æœ‰ä¸‰ç‚¹å·®å¼‚ã€‚ ï¼ˆ1ï¼‰ä»¤ç‰Œæ˜¯çŸ­æœŸçš„ï¼Œåˆ°æœŸä¼šè‡ªåŠ¨å¤±æ•ˆï¼Œç”¨æˆ·è‡ªå·±æ— æ³•ä¿®æ”¹ã€‚å¯†ç ä¸€èˆ¬é•¿æœŸæœ‰æ•ˆï¼Œç”¨æˆ·ä¸ä¿®æ”¹ï¼Œå°±ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚ ï¼ˆ2ï¼‰ä»¤ç‰Œå¯ä»¥è¢«æ•°æ®æ‰€æœ‰è€…æ’¤é”€ï¼Œä¼šç«‹å³å¤±æ•ˆã€‚ä»¥ä¸Šä¾‹è€Œè¨€ï¼Œå±‹ä¸»å¯ä»¥éšæ—¶å–æ¶ˆå¿«é€’å‘˜çš„ä»¤ç‰Œã€‚å¯†ç ä¸€èˆ¬ä¸å…è®¸è¢«ä»–äººæ’¤é”€ã€‚ ï¼ˆ3ï¼‰ä»¤ç‰Œæœ‰æƒé™èŒƒå›´ï¼ˆscopeï¼‰ï¼Œæ¯”å¦‚åªèƒ½è¿›å°åŒºçš„äºŒå·é—¨ã€‚å¯¹äºç½‘ç»œæœåŠ¡æ¥è¯´ï¼Œåªè¯»ä»¤ç‰Œå°±æ¯”è¯»å†™ä»¤ç‰Œæ›´å®‰å…¨ã€‚å¯†ç ä¸€èˆ¬æ˜¯å®Œæ•´æƒé™ã€‚ ä¸Šé¢è¿™äº›è®¾è®¡ï¼Œä¿è¯äº†ä»¤ç‰Œæ—¢å¯ä»¥è®©ç¬¬ä¸‰æ–¹åº”ç”¨è·å¾—æƒé™ï¼ŒåŒæ—¶åˆéšæ—¶å¯æ§ï¼Œä¸ä¼šå±åŠç³»ç»Ÿå®‰å…¨ã€‚è¿™å°±æ˜¯ OAuth 2.0 çš„ä¼˜ç‚¹ã€‚ æ³¨æ„ï¼Œåªè¦çŸ¥é“äº†ä»¤ç‰Œï¼Œå°±èƒ½è¿›å…¥ç³»ç»Ÿã€‚ç³»ç»Ÿä¸€èˆ¬ä¸ä¼šå†æ¬¡ç¡®è®¤èº«ä»½ï¼Œæ‰€ä»¥ä»¤ç‰Œå¿…é¡»ä¿å¯†ï¼Œæ³„æ¼ä»¤ç‰Œä¸æ³„æ¼å¯†ç çš„åæœæ˜¯ä¸€æ ·çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»¤ç‰Œçš„æœ‰æ•ˆæœŸï¼Œä¸€èˆ¬éƒ½è®¾ç½®å¾—å¾ˆçŸ­çš„åŸå› ã€‚ OAuth2.0 çš„æˆæƒæ¨¡å¼ä¸ä½¿ç”¨OAuth 2.0 è§„å®šäº†å››ç§è·å¾—ä»¤ç‰Œçš„æµç¨‹ã€‚ä¸‹é¢å°±æ˜¯è¿™å››ç§æˆæƒæ–¹å¼ã€‚ Auth2.0çš„å››ç§æˆæƒæ¨¡å¼ â€‹ æˆæƒç æ¨¡å¼ï¼ˆAuthorization Codeï¼‰(æ”¯æŒrefresh token) â€‹ éšè—æ¨¡å¼ï¼ˆImplicitï¼‰(ä¸æ”¯æŒrefresh token) â€‹ å¯†ç æ¨¡å¼ï¼ˆResource Owner Password Credentialsï¼‰ (æ”¯æŒrefresh token) â€‹ å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆClient Credentialsï¼‰ (ä¸æ”¯æŒrefresh token) æ³¨æ„ï¼Œä¸ç®¡å“ªä¸€ç§æˆæƒæ–¹å¼ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨ç”³è¯·ä»¤ç‰Œä¹‹å‰ï¼Œéƒ½å¿…é¡»å…ˆåˆ°ç³»ç»Ÿå¤‡æ¡ˆï¼Œè¯´æ˜è‡ªå·±çš„èº«ä»½ï¼Œç„¶åä¼šæ‹¿åˆ°ä¸¤ä¸ªèº«ä»½è¯†åˆ«ç ï¼šå®¢æˆ·ç«¯ IDï¼ˆclient IDï¼‰å’Œå®¢æˆ·ç«¯å¯†é’¥ï¼ˆclient secretï¼‰ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢ä»¤ç‰Œè¢«æ»¥ç”¨ï¼Œæ²¡æœ‰å¤‡æ¡ˆè¿‡çš„ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæ˜¯ä¸ä¼šæ‹¿åˆ°ä»¤ç‰Œçš„ã€‚ æˆæƒç æ¨¡å¼æˆæƒç ï¼ˆauthorization codeï¼‰æ–¹å¼ï¼ŒæŒ‡çš„æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨å…ˆç”³è¯·ä¸€ä¸ªæˆæƒç ï¼Œç„¶åå†ç”¨è¯¥ç è·å–ä»¤ç‰Œã€‚ è¿™ç§æ–¹å¼æ˜¯æœ€å¸¸ç”¨çš„æµç¨‹ï¼Œå®‰å…¨æ€§ä¹Ÿæœ€é«˜ï¼Œå®ƒé€‚ç”¨äºé‚£äº›æœ‰åç«¯çš„ Web åº”ç”¨ã€‚æˆæƒç é€šè¿‡å‰ç«¯ä¼ é€ï¼Œä»¤ç‰Œåˆ™æ˜¯å‚¨å­˜åœ¨åç«¯ï¼Œè€Œä¸”æ‰€æœ‰ä¸èµ„æºæœåŠ¡å™¨çš„é€šä¿¡éƒ½åœ¨åç«¯å®Œæˆã€‚è¿™æ ·çš„å‰åç«¯åˆ†ç¦»ï¼Œå¯ä»¥é¿å…ä»¤ç‰Œæ³„æ¼ã€‚ ç¬¬ä¸€æ­¥ï¼ŒA ç½‘ç«™æä¾›ä¸€ä¸ªé“¾æ¥ï¼Œç”¨æˆ·ç‚¹å‡»åå°±ä¼šè·³è½¬åˆ° B ç½‘ç«™ï¼Œæˆæƒç”¨æˆ·æ•°æ®ç»™ A ç½‘ç«™ä½¿ç”¨ã€‚ ç¬¬äºŒæ­¥ï¼Œç”¨æˆ·è·³è½¬åï¼ŒB ç½‘ç«™ä¼šè¦æ±‚ç”¨æˆ·ç™»å½•ï¼Œç„¶åè¯¢é—®æ˜¯å¦åŒæ„ç»™äºˆ A ç½‘ç«™æˆæƒã€‚ç”¨æˆ·è¡¨ç¤ºåŒæ„ï¼Œè¿™æ—¶ B ç½‘ç«™å°±ä¼šè·³å›redirect_uriå‚æ•°æŒ‡å®šçš„ç½‘å€ã€‚è·³è½¬æ—¶ï¼Œä¼šä¼ å›ä¸€ä¸ªæˆæƒç ã€‚ ç¬¬ä¸‰æ­¥ï¼ŒA ç½‘ç«™æ‹¿åˆ°æˆæƒç ä»¥åï¼Œå°±å¯ä»¥åœ¨åç«¯ï¼Œå‘ B ç½‘ç«™è¯·æ±‚ä»¤ç‰Œã€‚ ç¬¬å››æ­¥ï¼ŒB ç½‘ç«™æ”¶åˆ°è¯·æ±‚ä»¥åï¼Œå°±ä¼šé¢å‘ä»¤ç‰Œã€‚å…·ä½“åšæ³•æ˜¯å‘redirect_uriæŒ‡å®šçš„ç½‘å€ï¼Œå‘é€ä¸€æ®µ JSON æ•°æ®åŒ…å«äº†ä»¤ç‰Œçš„è¯¦ç»†å†…å®¹ã€‚ éšè—æ¨¡å¼æœ‰äº› Web åº”ç”¨æ˜¯çº¯å‰ç«¯åº”ç”¨ï¼Œæ²¡æœ‰åç«¯ã€‚è¿™æ—¶å°±ä¸èƒ½ç”¨ä¸Šé¢çš„æ–¹å¼äº†ï¼Œå¿…é¡»å°†ä»¤ç‰Œå‚¨å­˜åœ¨å‰ç«¯ã€‚ ç¬¬ä¸€æ­¥ï¼ŒA ç½‘ç«™æä¾›ä¸€ä¸ªé“¾æ¥ï¼Œè¦æ±‚ç”¨æˆ·è·³è½¬åˆ° B ç½‘ç«™ï¼Œæˆæƒç”¨æˆ·æ•°æ®ç»™ A ç½‘ç«™ä½¿ç”¨ã€‚ ç¬¬äºŒæ­¥ï¼Œç”¨æˆ·è·³è½¬åˆ° B ç½‘ç«™ï¼Œç™»å½•ååŒæ„ç»™äºˆ A ç½‘ç«™æˆæƒã€‚è¿™æ—¶ï¼ŒB ç½‘ç«™å°±ä¼šè·³å›redirect_uriå‚æ•°æŒ‡å®šçš„è·³è½¬ç½‘å€ï¼Œå¹¶ä¸”æŠŠä»¤ç‰Œä½œä¸º URL å‚æ•°ï¼Œä¼ ç»™ A ç½‘ç«™ã€‚ è¿™ç§æ–¹å¼æŠŠä»¤ç‰Œç›´æ¥ä¼ ç»™å‰ç«¯ï¼Œæ˜¯å¾ˆä¸å®‰å…¨çš„ã€‚å› æ­¤ï¼Œåªèƒ½ç”¨äºä¸€äº›å®‰å…¨è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼Œå¹¶ä¸”ä»¤ç‰Œçš„æœ‰æ•ˆæœŸå¿…é¡»éå¸¸çŸ­ï¼Œé€šå¸¸å°±æ˜¯ä¼šè¯æœŸé—´ï¼ˆsessionï¼‰æœ‰æ•ˆï¼Œæµè§ˆå™¨å…³æ‰ï¼Œä»¤ç‰Œå°±å¤±æ•ˆäº†ã€‚ å¯†ç æ¨¡å¼å¦‚æœä½ é«˜åº¦ä¿¡ä»»æŸä¸ªåº”ç”¨ï¼Œä¹Ÿå…è®¸ç”¨æˆ·æŠŠç”¨æˆ·åå’Œå¯†ç ï¼Œç›´æ¥å‘Šè¯‰è¯¥åº”ç”¨ã€‚è¯¥åº”ç”¨å°±ä½¿ç”¨ä½ çš„å¯†ç ï¼Œç”³è¯·ä»¤ç‰Œï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºâ€å¯†ç å¼â€ï¼ˆpasswordï¼‰ã€‚ ç¬¬ä¸€æ­¥ï¼ŒA ç½‘ç«™è¦æ±‚ç”¨æˆ·æä¾› B ç½‘ç«™çš„ç”¨æˆ·åå’Œå¯†ç ã€‚æ‹¿åˆ°ä»¥åï¼ŒA å°±ç›´æ¥å‘ B è¯·æ±‚ä»¤ç‰Œã€‚ ç¬¬äºŒæ­¥ï¼ŒB ç½‘ç«™éªŒè¯èº«ä»½é€šè¿‡åï¼Œç›´æ¥ç»™å‡ºä»¤ç‰Œã€‚æ³¨æ„ï¼Œè¿™æ—¶ä¸éœ€è¦è·³è½¬ï¼Œè€Œæ˜¯æŠŠä»¤ç‰Œæ”¾åœ¨ JSON æ•°æ®é‡Œé¢ï¼Œä½œä¸º HTTP å›åº”ï¼ŒA å› æ­¤æ‹¿åˆ°ä»¤ç‰Œã€‚ è¿™ç§æ–¹å¼éœ€è¦ç”¨æˆ·ç»™å‡ºè‡ªå·±çš„ç”¨æˆ·å/å¯†ç ï¼Œæ˜¾ç„¶é£é™©å¾ˆå¤§ï¼Œå› æ­¤åªé€‚ç”¨äºå…¶ä»–æˆæƒæ–¹å¼éƒ½æ— æ³•é‡‡ç”¨çš„æƒ…å†µï¼Œè€Œä¸”å¿…é¡»æ˜¯ç”¨æˆ·é«˜åº¦ä¿¡ä»»çš„åº”ç”¨ã€‚ å®¢æˆ·ç«¯æ¨¡å¼æœ€åä¸€ç§æ–¹å¼æ˜¯å‡­è¯å¼ï¼ˆclient credentialsï¼‰ï¼Œé€‚ç”¨äºæ²¡æœ‰å‰ç«¯çš„å‘½ä»¤è¡Œåº”ç”¨ï¼Œå³åœ¨å‘½ä»¤è¡Œä¸‹è¯·æ±‚ä»¤ç‰Œã€‚ ç¬¬ä¸€æ­¥ï¼ŒA åº”ç”¨åœ¨å‘½ä»¤è¡Œå‘ B å‘å‡ºè¯·æ±‚ã€‚ ç¬¬äºŒæ­¥ï¼ŒB ç½‘ç«™éªŒè¯é€šè¿‡ä»¥åï¼Œç›´æ¥è¿”å›ä»¤ç‰Œã€‚ è¿™ç§æ–¹å¼ç»™å‡ºçš„ä»¤ç‰Œï¼Œæ˜¯é’ˆå¯¹ç¬¬ä¸‰æ–¹åº”ç”¨çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç”¨æˆ·çš„ï¼Œå³æœ‰å¯èƒ½å¤šä¸ªç”¨æˆ·å…±äº«åŒä¸€ä¸ªä»¤ç‰Œã€‚ ä»¤ç‰Œçš„ä½¿ç”¨A ç½‘ç«™æ‹¿åˆ°ä»¤ç‰Œä»¥åï¼Œå°±å¯ä»¥å‘ B ç½‘ç«™çš„ API è¯·æ±‚æ•°æ®äº†ã€‚ æ­¤æ—¶ï¼Œæ¯ä¸ªå‘åˆ° API çš„è¯·æ±‚ï¼Œéƒ½å¿…é¡»å¸¦æœ‰ä»¤ç‰Œã€‚å…·ä½“åšæ³•æ˜¯åœ¨è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼ŒåŠ ä¸Šä¸€ä¸ªAuthorizationå­—æ®µï¼Œä»¤ç‰Œå°±æ”¾åœ¨è¿™ä¸ªå­—æ®µé‡Œé¢ã€‚ 123&gt; curl -H "Authorization: Bearer ACCESS_TOKEN" \&gt; "https://api.b.com"&gt; ä¸Šé¢å‘½ä»¤ä¸­ï¼ŒACCESS_TOKENå°±æ˜¯æ‹¿åˆ°çš„ä»¤ç‰Œã€‚ æ›´æ–°ä»¤ç‰Œä»¤ç‰Œçš„æœ‰æ•ˆæœŸåˆ°äº†ï¼Œå¦‚æœè®©ç”¨æˆ·é‡æ–°èµ°ä¸€éä¸Šé¢çš„æµç¨‹ï¼Œå†ç”³è¯·ä¸€ä¸ªæ–°çš„ä»¤ç‰Œï¼Œå¾ˆå¯èƒ½ä½“éªŒä¸å¥½ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰å¿…è¦ã€‚OAuth 2.0 å…è®¸ç”¨æˆ·è‡ªåŠ¨æ›´æ–°ä»¤ç‰Œã€‚ å…·ä½“æ–¹æ³•æ˜¯ï¼ŒB ç½‘ç«™é¢å‘ä»¤ç‰Œçš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§é¢å‘ä¸¤ä¸ªä»¤ç‰Œï¼Œä¸€ä¸ªç”¨äºè·å–æ•°æ®ï¼Œå¦ä¸€ä¸ªç”¨äºè·å–æ–°çš„ä»¤ç‰Œï¼ˆrefresh token å­—æ®µï¼‰ã€‚ä»¤ç‰Œåˆ°æœŸå‰ï¼Œç”¨æˆ·ä½¿ç”¨ refresh token å‘ä¸€ä¸ªè¯·æ±‚ï¼Œå»æ›´æ–°ä»¤ç‰Œã€‚ 123456&gt; https://b.com/oauth/token?&gt; grant_type=refresh_token&amp;&gt; client_id=CLIENT_ID&amp;&gt; client_secret=CLIENT_SECRET&amp;&gt; refresh_token=REFRESH_TOKEN&gt; ä¸Šé¢ URL ä¸­ï¼Œgrant_typeå‚æ•°ä¸ºrefresh_tokenè¡¨ç¤ºè¦æ±‚æ›´æ–°ä»¤ç‰Œï¼Œclient_idå‚æ•°å’Œclient_secretå‚æ•°ç”¨äºç¡®è®¤èº«ä»½ï¼Œrefresh_tokenå‚æ•°å°±æ˜¯ç”¨äºæ›´æ–°ä»¤ç‰Œçš„ä»¤ç‰Œã€‚ ç¬¬ä¸‰æ–¹æˆæƒä¾‹å­ä¸€ã€åœºæ™¯ä¸¾ä¾‹ä¸¾ä¾‹æ¥è¯´ï¼ŒA ç½‘ç«™å…è®¸ä½¿ç”¨Bç½‘ç«™è´¦å·ç™»å½•ï¼ŒèƒŒåå°±æ˜¯ä¸‹é¢çš„æµç¨‹ã€‚ A ç½‘ç«™è®©ç”¨æˆ·è·³è½¬åˆ°Bç½‘ç«™ã€‚ Bè¦æ±‚ç”¨æˆ·ç™»å½•ï¼Œç„¶åè¯¢é—®â€A ç½‘ç«™è¦æ±‚è·å¾— xx æƒé™ï¼Œä½ æ˜¯å¦åŒæ„ï¼Ÿâ€ ç”¨æˆ·åŒæ„ï¼ŒBå°±ä¼šé‡å®šå‘å› A ç½‘ç«™ï¼ŒåŒæ—¶å‘å›ä¸€ä¸ªæˆæƒç ã€‚ A ç½‘ç«™ä½¿ç”¨æˆæƒç ï¼Œå‘ B è¯·æ±‚ä»¤ç‰Œã€‚ Bç½‘ç«™è¿”å›ä»¤ç‰Œ. A ç½‘ç«™ä½¿ç”¨ä»¤ç‰Œï¼Œå‘Bèµ„æºæœåŠ¡å™¨è¯·æ±‚ç”¨æˆ·æ•°æ®ã€‚ äºŒã€æˆæƒæµç¨‹ Authrization Requestå®¢æˆ·ç«¯å‘ç”¨æˆ·è¯·æ±‚å¯¹èµ„æºæœåŠ¡å™¨çš„authorization grantã€‚ Authorization Grantï¼ˆGetï¼‰å¦‚æœç”¨æˆ·æˆæƒè¯¥æ¬¡è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°ä¸€ä¸ªauthorization grantã€‚ Authorization Grantï¼ˆPostï¼‰å®¢æˆ·ç«¯å‘æˆæƒæœåŠ¡å™¨å‘é€å®ƒè‡ªå·±çš„å®¢æˆ·ç«¯èº«ä»½æ ‡è¯†å’Œä¸Šä¸€æ­¥ä¸­çš„authorization grantï¼Œè¯·æ±‚è®¿é—®ä»¤ç‰Œã€‚ Access Tokenï¼ˆGetï¼‰å¦‚æœå®¢æˆ·ç«¯èº«ä»½è¢«è®¤è¯ï¼Œå¹¶ä¸”authorization grantä¹Ÿè¢«éªŒè¯é€šè¿‡ï¼ŒæˆæƒæœåŠ¡å™¨å°†ä¸ºå®¢æˆ·ç«¯æ´¾å‘access tokenã€‚æˆæƒé˜¶æ®µè‡³æ­¤å…¨éƒ¨ç»“æŸã€‚ Access Tokenï¼ˆPost &amp;&amp; Validateï¼‰å®¢æˆ·ç«¯å‘èµ„æºæœåŠ¡å™¨å‘é€access tokenç”¨äºéªŒè¯å¹¶è¯·æ±‚èµ„æºä¿¡æ¯ã€‚ Protected Resourceï¼ˆGetï¼‰å¦‚æœaccess tokenéªŒè¯é€šè¿‡ï¼Œèµ„æºæœåŠ¡å™¨å°†å‘å®¢æˆ·ç«¯è¿”å›èµ„æºä¿¡æ¯ã€‚ ä¸‰ã€è±†ç“£æˆæƒæµç¨‹ User Authorization Request é¦–å…ˆï¼Œå®¢æˆ·ç«¯æ„é€ äº†ä¸€ä¸ªç”¨äºè¯·æ±‚authorization codeçš„URLå¹¶å¼•å¯¼User-agentè·³è½¬è®¿é—®ã€‚ 123456https://authorization-server.com/auth ?response_type=code &amp;client_id=29352915982374239857 &amp;redirect_uri=https%3A%2F%2Fexample-client.com%2Fcallback &amp;scope=create+delete &amp;state=xcoiv98y2kd22vusuye3kch response_type=codeæ­¤å‚æ•°å’Œå‚æ•°å€¼ç”¨äºæç¤ºæˆæƒæœåŠ¡å™¨å½“å‰å®¢æˆ·ç«¯æ­£åœ¨è¿›è¡ŒAuthorization Codeæˆæƒæµç¨‹ã€‚ client_idå®¢æˆ·ç«¯èº«ä»½æ ‡è¯†ã€‚ redirect_uriæ ‡è¯†æˆæƒæœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚åè¿”å›ç»™User-agentçš„è·³è½¬è®¿é—®åœ°å€ã€‚ scopeæŒ‡å®šå®¢æˆ·ç«¯è¯·æ±‚çš„è®¿é—®çº§åˆ«ã€‚ stateç”±å®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºå­—ç¬¦ä¸²ï¼Œæ­¥éª¤2ä¸­ç”¨æˆ·è¿›è¡Œæˆæƒå®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ä¹Ÿä¼šæºå¸¦æ­¤å­—ç¬¦ä¸²ç”¨äºæ¯”è¾ƒï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢CSRFæ”»å‡»ã€‚ User Authorizes Applcation å½“ç”¨æˆ·ç‚¹å‡»ä¸Šæ–‡ä¸­çš„ç¤ºä¾‹é“¾æ¥æ—¶ï¼Œç”¨æˆ·å¿…é¡»å·²ç»åœ¨æˆæƒæœåŠ¡ä¸­è¿›è¡Œç™»å½•ï¼ˆå¦åˆ™å°†ä¼šè·³è½¬åˆ°ç™»å½•ç•Œé¢ï¼Œä¸è¿‡ OAuth 2 å¹¶ä¸å…³å¿ƒè®¤è¯è¿‡ç¨‹ï¼‰ï¼Œç„¶åæˆæƒæœåŠ¡ä¼šæç¤ºç”¨æˆ·æˆæƒæˆ–æ‹’ç»åº”ç”¨ç¨‹åºè®¿é—®å…¶å¸æˆ·ã€‚ä»¥ä¸‹æ˜¯æˆæƒåº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ï¼š Authorization Code Grant å¦‚æœç”¨æˆ·ç¡®è®¤æˆæƒï¼ŒæˆæƒæœåŠ¡å™¨å°†é‡å®šå‘User-agentè‡³ä¹‹å‰å®¢æˆ·ç«¯æä¾›çš„æŒ‡å‘å®¢æˆ·ç«¯çš„redirect_uriåœ°å€ï¼Œå¹¶é™„å¸¦codeå’Œstateå‚æ•°ï¼ˆç”±ä¹‹å‰å®¢æˆ·ç«¯æä¾›ï¼‰ï¼Œäºæ˜¯å®¢æˆ·ç«¯ä¾¿èƒ½ç›´æ¥è¯»å–åˆ°authorization codeå€¼ã€‚ 123https://example-client.com/redirect ?code=g0ZGZmNjVmOWIjNTk2NTk4ZTYyZGI3 &amp;state=xcoiv98y2kd22vusuye3kch stateå€¼å°†ä¸å®¢æˆ·ç«¯åœ¨è¯·æ±‚ä¸­æœ€åˆè®¾ç½®çš„å€¼ç›¸åŒã€‚å®¢æˆ·ç«¯å°†æ£€æŸ¥é‡å®šå‘ä¸­çš„çŠ¶æ€å€¼æ˜¯å¦ä¸æœ€åˆè®¾ç½®çš„çŠ¶æ€å€¼ç›¸åŒ¹é…ã€‚è¿™å¯ä»¥é˜²æ­¢CSRFå’Œå…¶ä»–ç›¸å…³æ”»å‡»ã€‚ codeæ˜¯æˆæƒæœåŠ¡å™¨ç”Ÿæˆçš„authorization codeå€¼ã€‚codeç›¸å¯¹è¾ƒçŸ­ï¼Œé€šå¸¸æŒç»­1åˆ°10åˆ†é’Ÿï¼Œå…·ä½“å–å†³äºæˆæƒæœåŠ¡å™¨è®¾ç½®ã€‚ Access Token Request ç°åœ¨å®¢æˆ·ç«¯å·²ç»æ‹¥æœ‰äº†æœåŠ¡å™¨æ´¾å‘çš„authorization codeï¼Œæ¥ä¸‹æ¥ä¾¿å¯ä»¥ä½¿ç”¨authorization codeå’Œå…¶ä»–å‚æ•°å‘æœåŠ¡å™¨è¯·æ±‚access tokenï¼ˆPOSTæ–¹å¼ï¼‰ã€‚å…¶ä»–ç›¸å…³å‚æ•°å¦‚ä¸‹ï¼š grant_type=authorization_code - è¿™å‘Šè¯‰æœåŠ¡å™¨å½“å‰å®¢æˆ·ç«¯æ­£åœ¨ä½¿ç”¨Authorization Codeæˆæƒæµç¨‹ã€‚ code - åº”ç”¨ç¨‹åºåŒ…å«å®ƒåœ¨é‡å®šå‘ä¸­ç»™å‡ºçš„æˆæƒç ã€‚ redirect_uri - ä¸è¯·æ±‚authorization codeæ—¶ä½¿ç”¨çš„redirect_uriç›¸åŒã€‚æŸäº›èµ„æºï¼ˆAPIï¼‰ä¸éœ€è¦æ­¤å‚æ•°ã€‚ client_id - å®¢æˆ·ç«¯æ ‡è¯†ã€‚ client_secret - åº”ç”¨ç¨‹åºçš„å®¢æˆ·ç«¯å¯†é’¥ã€‚è¿™ç¡®ä¿äº†è·å–access tokençš„è¯·æ±‚åªèƒ½ä»å®¢æˆ·ç«¯å‘å‡ºï¼Œè€Œä¸èƒ½ä»å¯èƒ½æˆªè·authorization codeçš„æ”»å‡»è€…å‘å‡ºã€‚ Access Token Grant æœåŠ¡å™¨å°†ä¼šéªŒè¯ç¬¬4æ­¥ä¸­çš„è¯·æ±‚å‚æ•°ï¼Œå½“éªŒè¯é€šè¿‡åï¼ˆæ ¡éªŒauthorization codeæ˜¯å¦è¿‡æœŸï¼Œclient idå’Œclient secretæ˜¯å¦åŒ¹é…ç­‰ï¼‰ï¼ŒæœåŠ¡å™¨å°†å‘å®¢æˆ·ç«¯è¿”å›access tokenã€‚ 1234567&#123; &quot;access_token&quot;:&quot;MTQ0NjJkZmQ5OTM2NDE1ZTZjNGZmZjI3&quot;, &quot;token_type&quot;:&quot;bearer&quot;, &quot;expires_in&quot;:3600, &quot;refresh_token&quot;:&quot;IwOGYzYTlmM2YxOTQ5MGE3YmNmMDFkNTVk&quot;, &quot;scope&quot;:&quot;create delete&quot;&#125; è‡³æ­¤ï¼Œæˆæƒæµç¨‹å…¨éƒ¨ç»“æŸã€‚ç›´åˆ°access token è¿‡æœŸæˆ–å¤±æ•ˆä¹‹å‰ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡èµ„æºæœåŠ¡å™¨APIè®¿é—®ç”¨æˆ·çš„å¸æˆ·ï¼Œå¹¶å…·å¤‡scopeä¸­ç»™å®šçš„æ“ä½œæƒé™ã€‚ Ory Hydra OAuth2.0 æ¡†æ¶ORY Hydraè§£å†³äº†èº«ä»½éªŒè¯å’Œæˆæƒé—®é¢˜ï¼Œæ˜¯OAuth 2.0å’ŒOpenID Connectæä¾›å•†ã€‚ ä»€ä¹ˆæ˜¯ORY HydraORY Hydraæ˜¯OAuth 2.0å’ŒOpenID Connect Providerã€‚å› æ­¤ï¼Œå®ƒèƒ½å¤Ÿå‘å‡ºè®¿é—®ï¼Œåˆ·æ–°å’ŒIDä»¤ç‰Œã€‚ä¸å…¶ä»–é¡¹ç›®ç›¸åï¼ŒORY Hydraä¸æä¾›ç”¨æˆ·ç®¡ç†ï¼ˆç™»å½•ï¼Œæ³¨é”€ï¼Œé…ç½®æ–‡ä»¶ç®¡ç†ï¼Œæ³¨å†Œï¼‰ï¼Œè€Œæ˜¯ä½¿ç”¨åŸºäºé‡å®šå‘çš„æµå’ŒREST APIå°†ç”¨æˆ·èº«ä»½éªŒè¯ï¼ˆç™»å½•ï¼‰å§”æ´¾ç»™æ‚¨å®ç°çš„æœåŠ¡ï¼Œæ§åˆ¶ã€‚è¿™å…è®¸æ‚¨æ„å»ºé€‚åˆæ‚¨çš„ç”¨æˆ·ç®¡ç†ï¼Œä½¿ç”¨æ‚¨å–œæ¬¢çš„å‰ç«¯æŠ€æœ¯ï¼Œä»¥åŠæ‚¨çš„ç”¨ä¾‹æ‰€éœ€çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼ˆä¾‹å¦‚åŸºäºä»¤ç‰Œçš„2FAï¼ŒSMS 2FAï¼‰ã€‚ å› æ­¤ï¼ŒORY Hydraæ˜¯æœ€çµæ´»çš„OAuth 2.0å’ŒOpenID Connectæä¾›å•†ï¼Œä¸ºæ‚¨æä¾›äº†å®ç°ä¸šåŠ¡é€»è¾‘çš„æå¤§è‡ªç”±ï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥ä»OAuth 2.0å’ŒOpenID Connectä¸­è·å¾—æ‰€æœ‰å¥½å¤„ã€‚ é™¤äº†OAuth 2.0åŠŸèƒ½ä¹‹å¤–ï¼ŒORY Hydraè¿˜ä¸ºåŠ å¯†å¯†é’¥æä¾›å®‰å…¨å­˜å‚¨ï¼ˆä¾‹å¦‚ï¼Œç”¨äºç­¾ç½²JSON Webä»¤ç‰Œï¼‰ï¼Œå¹¶ä¸”èƒ½å¤Ÿç®¡ç†OAuth 2.0å®¢æˆ·ç«¯ã€‚ ORY Hydraæ˜¯OpenID Connectè®¤è¯ï¼ˆå¾…å®šï¼‰ï¼Œå¹¶å®ç°äº†OpenID Foundationè§„å®šçš„æ‰€æœ‰è¦æ±‚ã€‚å› æ­¤ï¼Œå®ƒæ­£ç¡®åœ°å®ç°äº†IETFå’ŒOpenID Foundationæ‰€é¢„æœŸçš„ä¸åŒOAuth 2.0å’ŒOpenID Connectæµç¨‹ã€‚ ORY Hydra ä»‹ç»Hydraæ˜¯OAuth 2.0æˆæƒæ¡†æ¶å’ŒOpenID Connect Core 1.0çš„æœåŠ¡å™¨å®ç°ã€‚ç°æœ‰çš„OAuth2å®ç°é€šå¸¸ä½œä¸ºåº“æˆ–SDKã€‚ åœ¨ä¸äº†è§£æ•´ä¸ªè§„èŒƒçš„æƒ…å†µä¸‹å®ç°å’Œä½¿ç”¨OAuth2å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œå¹¶ä¸”å³ä½¿åœ¨ä½¿ç”¨SDKæ—¶ä¹Ÿå®¹æ˜“å‡ºé”™ã€‚Hydraçš„ä¸»è¦ç›®æ ‡æ˜¯ä½¿OAuth 2.0å’ŒOpenID Connect 1.0çš„è®¾ç½®æ›´è½»æ¾ï¼Œæ›´æ˜“äºä½¿ç”¨ã€‚ Hydraå®ç°OAuth2å’ŒOpenID Connect 1.0ä¸­æè¿°çš„æµç¨‹ï¼Œè€Œä¸å¼ºåˆ¶æ‚¨ä½¿ç”¨â€œHydraç”¨æˆ·ç®¡ç†â€æˆ–æŸäº›æ¨¡æ¿å¼•æ“æˆ–é¢„å®šä¹‰çš„å‰ç«¯ã€‚ç›¸åï¼Œå®ƒä¾èµ–äºHTTPé‡å®šå‘å’ŒåŠ å¯†æ–¹æ³•æ¥éªŒè¯ç”¨æˆ·åŒæ„ï¼Œå…è®¸æ‚¨å°†Hydraä¸ä»»ä½•èº«ä»½éªŒè¯ç«¯ç‚¹ä¸€èµ·ä½¿ç”¨ã€‚ ORY Hydra ä¸ç®¡ç†ç”¨æˆ·è¦ç†è§£çš„ç¬¬ä¸€ä¸ªé‡è¦æ¦‚å¿µæ˜¯ORY Hydraæ˜¯OAuth 2.0æˆæƒå’ŒOpenID ConnectæœåŠ¡å™¨ã€‚æœ‰äº›äººå°†è¿™äº›åŠŸèƒ½è¯¯è®¤ä¸ºå­˜å‚¨ç”¨æˆ·æ•°æ®å¹¶å°†æ‚¨ç™»å½•çš„ç³»ç»Ÿã€‚äº‹å®å¹¶éå¦‚æ­¤ã€‚ç›¸åï¼Œæ­¤ç±»æœåŠ¡å™¨è´Ÿè´£å°†ç”¨æˆ·å‡­æ®ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·åå’Œå¯†ç ï¼‰â€œè½¬æ¢â€ä¸ºOAuth 2.0è®¿é—®å’Œåˆ·æ–°ä»¤ç‰Œä»¥åŠOpenID Connect IDä»¤ç‰Œã€‚å®ƒåŸºæœ¬ä¸Šå°±åƒæ‚¨ä½¿ç”¨ä¼šè¯æ•°æ®å­˜å‚¨cookieï¼Œä½†æ›´çµæ´»ï¼Œå®ƒä¹Ÿé€‚ç”¨äºç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºã€‚ ORY Hydraä¸å­˜å‚¨ç”¨æˆ·é…ç½®æ–‡ä»¶ï¼Œç”¨æˆ·åï¼Œå¯†ç ã€‚æ­¤åŠŸèƒ½å–å†³äºæ‚¨ã€‚ORY Hydraä½¿ç”¨æˆ‘ä»¬ç§°ä¹‹ä¸ºç”¨æˆ·ç™»å½•å’ŒåŒæ„æµçš„ä¸œè¥¿ã€‚æ­¤æµä½¿ç”¨HTTPé‡å®šå‘å°†ä»»ä½•ä¼ å…¥çš„æˆæƒè¯·æ±‚ï¼ˆâ€œè¯·ç»™æˆ‘ä¸€ä¸ªè®¿é—®ä»¤ç‰Œã€‚â€ï¼‰è½¬å‘ç»™ç™»å½•æä¾›è€…å’ŒåŒæ„æä¾›è€…ã€‚è¿™äº›åº”ç”¨ç¨‹åºæ˜¯æ‚¨å®ç°çš„ã€‚å®ƒå¯ä»¥æ˜¯æ–°åº”ç”¨ç¨‹åºæˆ–æ‚¨ç°æœ‰çš„ç™»å½•ç³»ç»Ÿã€‚ä»è¾ƒé«˜çš„å±‚é¢æ¥çœ‹ï¼Œè¿™äº›æä¾›å•†å¯å½’çº³ä¸ºï¼š ç™»å½•æä¾›è€…è´Ÿè´£é€šè¿‡éªŒè¯ä»–æˆ–å¥¹çš„å‡­è¯ï¼ˆä¾‹å¦‚ç”¨æˆ·å+å¯†ç ï¼‰æ¥éªŒè¯ç”¨æˆ·ï¼ˆâ€œç™»å½•â€ï¼‰ã€‚ åŒæ„æä¾›å•†è´Ÿè´£å…è®¸OAuth 2.0åº”ç”¨ç¨‹åºä»£è¡¨ç”¨æˆ·è·å–ä»¤ç‰Œï¼ˆâ€œæ‚¨æ˜¯å¦å¸Œæœ›å…è®¸foobar-appè®¿é—®æ‚¨çš„æ‰€æœ‰ä¸ªäººæ¶ˆæ¯å’Œå›¾åƒï¼Ÿâ€ã€‚ Ory Hydra OAuth 2.0æˆæƒæµç¨‹ï¼š å¼€å‘äººå‘˜åœ¨æˆæƒæœåŠ¡å™¨ï¼ˆORY Hydraï¼‰ä¸Šæ³¨å†ŒOAuth 2.0å®¢æˆ·ç«¯ï¼Œç›®çš„æ˜¯ä»£è¡¨ç”¨æˆ·è·å–ä¿¡æ¯ã€‚ åº”ç”¨ç¨‹åºUIè¦æ±‚ç”¨æˆ·æˆæƒåº”ç”¨ç¨‹åºä»£è¡¨ä»–/å¥¹è®¿é—®ä¿¡æ¯/æ•°æ®ã€‚ ç”¨æˆ·è¢«é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨ã€‚ æˆæƒæœåŠ¡å™¨ç¡®è®¤ç”¨æˆ·çš„èº«ä»½ï¼Œå¹¶è¦æ±‚ç”¨æˆ·æˆäºˆOAuth 2.0å®¢æˆ·ç«¯æŸäº›æƒé™ã€‚ æˆæƒæœåŠ¡å™¨å‘å‡ºOAuth 2.0å®¢æˆ·ç«¯ç”¨äºä»£è¡¨ç”¨æˆ·è®¿é—®èµ„æºçš„ä»¤ç‰Œã€‚ Ory Hydra OAuth 2.0 ç™»å½•è®¤è¯ç½‘ç»œæµç¨‹å›¾â€‹ æˆ‘ä»¬çš„OAuth2 å®ç° è§’è‰²ä»‹ç» ä¸‰æ–¹å¹³å° (ä»»ä½•æƒ³è¦æ‹¿åˆ°å…¶ä»–å¹³å°æˆæƒçš„åº”ç”¨) èµ„æºæœåŠ¡å™¨ (æˆ‘ä»¬æ•°æ®æä¾›ç«¯) æˆæƒæœåŠ¡å™¨ (OAuth2.0 + IDP), ç»Ÿä¸€æˆæƒä¸­å¿ƒå’Œèº«ä»½è®¤è¯ä¸­å¿ƒï¼› Account Service (åŸºäºæ™®é€šç”¨æˆ·çš„æ³¨å†Œï¼Œç™»å½•ï¼Œå’Œä¿®æ”¹ç­‰æ¥å£ï¼› å¦å¤–æä¾›ä¸€ä¸ªå…¬å…±çš„OAuth å®¢æˆ·ç«¯ï¼Œä¸‰æ–¹å¹³å°å¯é€šè¿‡client_id å’Œ secret æ¥ä½¿ç”¨è¯¥å…¬å…±å®¢æˆ·ç«¯ï¼Œç”¨æ¥è·å–æˆæƒ) èµ„æºæ‰€æœ‰è€…(ç»ˆç«¯ç”¨æˆ·) ä¸‰æ–¹å¹³å°æ¥å…¥æ–¹æ³• å…ˆç”³è¯· client_id, å’Œ secret ï¼Œ ä¹‹åæ‰å¯ä»¥ä½¿ç”¨æˆæƒæœåŠ¡ï¼› å¼€å‘è·³è½¬æ¥å£ï¼Œ è¯¥æ¥å£ç”¨æ¥æ¥æ”¶ç»ˆç«¯ç”¨æˆ·æ”¶åˆ°çš„codeç ï¼Œ ç”¨æ¥è·å–access_tokenç­‰ ä¸‰æ–¹å¹³å°æˆæƒæµç¨‹(å‚è€ƒä¸Šå›¾) è°ƒç”¨Account Service è·å–æˆæƒå¹³å°åœ°å€å¹¶è¯·æ±‚ï¼› ç”¨æˆ·éªŒè¯èº«ä»½é€šè¿‡ï¼Œå¹¶åŒæ„æˆæƒï¼› é€šè¿‡è·³è½¬(éœ€æå‰å¼€å‘å¥½è·³è½¬æ¥å£)ï¼Œæ‹¿åˆ°æˆæƒå¾—åˆ°çš„codeï¼› è°ƒç”¨Account Service (ä½¿ç”¨æˆæƒcode)ï¼Œ è·å–access_token ç­‰ï¼› ä¹‹åä¾¿å¯ä½¿ç”¨access_token, è°ƒç”¨èµ„æºæœåŠ¡å™¨æˆæƒèŒƒå›´å†…çš„æ•°æ®ï¼›]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangå·¥å…·åŒ…</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>Orm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[go-micro æ¡†æ¶ä½¿ç”¨]]></title>
    <url>%2F2019%2F05%2F22%2F11.Golang%2FGolang%E5%B7%A5%E5%85%B7%E5%8C%85%2Fgo-micro%20%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[Microä»‹ç»ä»€ä¹ˆæ˜¯MicroMicroæ˜¯ä¸€ä¸ªç€çœ¼äºåˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘çš„å¾®æœåŠ¡ç”Ÿæ€ç³»ç»Ÿã€‚ Microç”±å¼€æºçš„åº“ä¸å·¥å…·ç»„æˆï¼Œæ—¨åœ¨è¾…åŠ©å¾®æœåŠ¡å¼€å‘ã€‚ Microå¼€æºåº“ go-micro - åŸºäºGoè¯­è¨€çš„å¯æ’æ‹”RPCå¾®æœåŠ¡å¼€å‘æ¡†æ¶ï¼›åŒ…å«æœåŠ¡å‘ç°ã€RPCå®¢æˆ·/æœåŠ¡ç«¯ã€å¹¿æ’­/è®¢é˜…æœºåˆ¶ç­‰ç­‰ã€‚ go-plugins - go-microçš„æ’ä»¶, å…¶åŒ…å«etcdã€kubernetesã€natsã€rabbitmqã€grpcç­‰ç­‰ã€‚ micro - å¾®æœåŠ¡å·¥å…·é›†åŒ…å«ä¼ ç»Ÿçš„å…¥å£ç‚¹ï¼ˆentry pointï¼‰ï¼›API ç½‘å…³ã€CLIã€Slack Botã€ä»£ç†åŠWeb UIã€‚ æ–‡æ¡£ä½ç½®: https://micro.mu/docs/ ä¸‹é¢ä¸»è¦ä»‹ç»ä½¿ç”¨go-micro å¯¹service çš„ç¼–å†™æ³¨å†Œå’Œå¯åŠ¨æµç¨‹ï¼Œå…³äºmicroçš„å·¥å…·ç®±çš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢æä¾›çš„æ–‡æ¡£åœ°å€ ä½¿ç”¨GO-Microç¼–å†™æœåŠ¡ç«¯ç¯å¢ƒå‡†å¤‡1234brew install protobuf # ä¸‹è½½protocå·¥å…·go get github.com/micro/go-micro # å®‰è£…go-microgo get github.com/golang/protobuf/&#123;proto,protoc-gen-go&#125; go get github.com/micro/&#123;protoc-gen-micro,micro&#125; go-micro Serviceæ¥å£å…ˆçœ‹ä¸€ä¸‹go-microçš„service interfaceï¼Œæ˜¯æ„å»ºmicroæœåŠ¡æ‰€éœ€çš„ä¸»è¦ç»„ä»¶ã€‚å®ƒæŠŠæ‰€æœ‰Go-Microrçš„åŸºç¡€åŒ…æ‰“åŒ…æˆå•ä¸€ç»„ä»¶æ¥å£ã€‚ æ¥ä¸‹æ¥å¯¹äºæœåŠ¡çš„å¼€å‘éƒ½å°†ä¸»è¦å›´ç»•service æ¥å£æ¥è¿›è¡Œ 12345678type Service interface &#123; Init(...Option) Options() Options Client() client.Client Server() server.Server Run() error String() string&#125; ç¼–å†™.protoæ–‡ä»¶ï¼Œå®šä¹‰Service çš„Apiæˆ‘ä»¬ä½¿ç”¨protobufæ–‡ä»¶æ¥å®šä¹‰æœåŠ¡çš„APIæ¥å£ã€‚ä½¿ç”¨protobufå¯ä»¥éå¸¸æ–¹ä¾¿å»ä¸¥æ ¼å®šä¹‰APIï¼Œæä¾›æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯åŒè¾¹å…·ä½“ä¸€è‡´çš„ç±»å‹ã€‚ ä¸‹é¢æ˜¯å®šä¹‰çš„ç¤ºä¾‹ greeter.proto 12345678910111213syntax = "proto3";service Greeter &#123; rpc Hello(HelloRequest) returns (HelloResponse) &#123;&#125;&#125;message HelloRequest &#123; string name = 1;&#125;message HelloResponse &#123; string greeting = 2;&#125; æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæœåŠ¡å«åšGreeterçš„å¤„ç†å™¨ï¼Œå®ƒæœ‰ä¸€ä¸ªæ¥æ”¶HelloRequestå¹¶è¿”å›HelloResponseçš„Helloæ–¹æ³•ã€‚ .protoæ–‡ä»¶çš„è¯¦ç»†å®šä¹‰æ–¹æ³•å¯ä»¥å‚è€ƒ: https://www.jianshu.com/p/ea656dc9b037 ç”ŸæˆAPIæ¥å£æˆ‘ä»¬éœ€è¦ä¸‹é¢è¿™ä¸ªå·¥å…·æ¥ç”Ÿæˆprotobufä»£ç æ–‡ä»¶ï¼Œå®ƒä»¬è´Ÿè´£ç”Ÿæˆå®šä¹‰çš„goä»£ç å®ç°ã€‚ 1protoc --proto_path=$GOPATH/src:. --micro_out=. --go_out=. greeter.proto ç”Ÿæˆçš„ç±»ç°åœ¨å¯ä»¥å¼•å…¥handlerä¸­ï¼Œåœ¨æœåŠ¡æˆ–å®¢æˆ·ç«¯æ¥åˆ›å»ºè¯·æ±‚äº†ã€‚ ä¸‹é¢æ˜¯éƒ¨åˆ†ç”Ÿæˆçš„ä»£ç  handlerçš„å¼€å‘ï¼Œå°†ä¼šç›´æ¥é¥®ç”¨ç”Ÿæˆçš„Request å’ŒResponse ç­‰å¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051type HelloRequest struct &#123; Name string `protobuf:"bytes,1,opt,name=name" json:"name,omitempty"`&#125;type HelloResponse struct &#123; Greeting string `protobuf:"bytes,2,opt,name=greeting" json:"greeting,omitempty"`&#125;// Greeter service å®¢æˆ·ç«¯çš„APItype GreeterClient interface &#123; Hello(ctx context.Context, in *HelloRequest, opts ...client.CallOption) (*HelloResponse, error)&#125;type greeterClient struct &#123; c client.Client serviceName string&#125;func NewGreeterClient(serviceName string, c client.Client) GreeterClient &#123; if c == nil &#123; c = client.NewClient() &#125; if len(serviceName) == 0 &#123; serviceName = "greeter" &#125; return &amp;greeterClient&#123; c: c, serviceName: serviceName, &#125;&#125;func (c *greeterClient) Hello(ctx context.Context, in *HelloRequest, opts ...client.CallOption) (*HelloResponse, error) &#123; req := c.c.NewRequest(c.serviceName, "Greeter.Hello", in) out := new(HelloResponse) err := c.c.Call(ctx, req, out, opts...) if err != nil &#123; return nil, err &#125; return out, nil&#125;// Greeter service æœåŠ¡ç«¯type GreeterHandler interface &#123; Hello(context.Context, *HelloRequest, *HelloResponse) error&#125;func RegisterGreeterHandler(s server.Server, hdlr GreeterHandler) &#123; s.Handle(s.NewHandler(&amp;Greeter&#123;hdlr&#125;))&#125; å®ç°handlerå¤„ç†å™¨æœåŠ¡ç«¯éœ€è¦æ³¨å†Œhandlersï¼Œè¿™æ ·æ‰èƒ½æä¾›æœåŠ¡å¹¶æ¥æ”¶è¯·æ±‚ã€‚å¤„ç†å™¨ç›¸å½“äºæ˜¯ä¸€ä¸ªæ‹¥æœ‰å…¬å…±æ–¹æ³•çš„å…¬å…±ç±»ï¼Œå®ƒéœ€è¦ç¬¦åˆç­¾åfunc(ctx context.Context, req interface{}, rsp interface{}) error é€šè¿‡ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼ŒGreeter interfaceçš„ç­¾åçš„çœ‹ä¸Šå»å°±æ˜¯è¿™æ ·ï¼š 123type GreeterHandler interface &#123; Hello(context.Context, *HelloRequest, *HelloResponse) error&#125; Greeterå¤„ç†å™¨å®ç°ï¼š 12345678import proto "github.com/micro/examples/service/proto"type Greeter struct&#123;&#125;func (g *Greeter) Hello(ctx context.Context, req *proto.HelloRequest, rsp *proto.HelloResponse) error &#123; rsp.Greeting = "Hello " + req.Name return nil&#125; æœåŠ¡å¯åŠ¨ åˆ›å»ºServiceæœåŠ¡ å¯ä»¥ä½¿ç”¨micro.NewServiceåˆ›å»ºæœåŠ¡ 12import "github.com/micro/go-micro"service := micro.NewService() åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ç›¸å…³é€‰é¡¹ 1234service := micro.NewService( micro.Name("greeter"), micro.Version("latest"),) æ‰€æœ‰çš„å¯é€‰å‚æ•°å‚è€ƒï¼šé…ç½®é¡¹ Go Microä¹Ÿæä¾›é€šè¿‡å‘½ä»¤è¡Œå‚æ•°micro.Flagsä¼ é€’é…ç½®å‚æ•°ï¼š 12345678910111213import ( "github.com/micro/cli" "github.com/micro/go-micro")service := micro.NewService( micro.Flags( cli.StringFlag&#123; Name: "environment", Usage: "The environment", &#125;, )) åˆå§‹åŒ–æœåŠ¡ åˆå§‹åŒ–æœåŠ¡æ—¶å€™ï¼Œå¯ä»¥è§£æå‘½ä»¤è¡Œæ ‡è¯†å‚æ•°ï¼Œå¢åŠ æ ‡è¯†å‚æ•°å¯ä»¥ä½¿ç”¨micro.Actioné€‰é¡¹ï¼š 12345678service.Init( micro.Action(func(c *cli.Context) &#123; env := c.StringFlag("environment") if len(env) &gt; 0 &#123; fmt.Println("Environment set to", env) &#125; &#125;),) Go Microæä¾›é¢„ç½®çš„æ ‡è¯†ï¼Œservice.Initæ‰§è¡Œæ—¶å°±ä¼šè®¾ç½®å¹¶è§£æè¿™äº›å‚æ•°ã€‚æ‰€æœ‰çš„æ ‡è¯†å‚è€ƒ. æ³¨å†ŒæœåŠ¡ å¤„ç†å™¨ä¼šä¸æœåŠ¡ä¸€èµ·è¢«æ³¨å†Œï¼Œå°±åƒhttpå¤„ç†å™¨ä¸€æ ·ã€‚ 12345service := micro.NewService( micro.Name("greeter"),)proto.RegisterGreeterHandler(service.Server(), new(Greeter)) è¿è¡ŒæœåŠ¡ Service æœåŠ¡å¯ä»¥è°ƒç”¨server.Runè¿è¡Œèµ·æ¥ã€‚è¿™ä¸€æ­¥ä¼šè®©æœåŠ¡ç»‘åˆ°é…ç½®ä¸­çš„åœ°å€ï¼ˆé»˜è®¤éµå¾ªRFC1918ï¼Œåˆ†é…éšæœºçš„ç«¯å£ï¼‰æ¥æ”¶è¯·æ±‚ã€‚ å¦å¤–ï¼Œè¿™ä¸€æ­¥ä¼šåœ¨æœåŠ¡å¯åŠ¨æ—¶å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œï¼Œå¹¶åœ¨æœåŠ¡æ¥æ”¶åˆ°å…³é—­ä¿¡å·æ—¶å¸è½½ã€‚ 123if err := service.Run(); err != nil &#123; log.Fatal(err)&#125; ä¹‹åå¯ä»¥é€šè¿‡ go run greeter.go æ³¨: å¦‚æœéœ€è¦æ›´æ”¹registerä¸º consulï¼Œ æ›´æ”¹ç¯å¢ƒå˜é‡ export MICRO_REGISTRY=consul å®Œæˆçš„æœåŠ¡greeter.go 123456789101112131415161718192021222324252627282930313233package mainimport ( "log" "github.com/micro/go-micro" proto "github.com/micro/examples/service/proto" "golang.org/x/net/context")type Greeter struct&#123;&#125;func (g *Greeter) Hello(ctx context.Context, req *proto.HelloRequest, rsp *proto.HelloResponse) error &#123; rsp.Greeting = "Hello " + req.Name return nil&#125;func main() &#123; service := micro.NewService( micro.Name("greeter"), micro.Version("latest"), ) service.Init() proto.RegisterGreeterHandler(service.Server(), new(Greeter)) if err := service.Run(); err != nil &#123; log.Fatal(err) &#125;&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦ä¿è¯æœåŠ¡å‘ç°æœºåˆ¶è¿è¡Œèµ·æ¥ï¼Œè¿™æ ·æœåŠ¡æ‰èƒ½æ³¨å†Œï¼Œå…¶å®ƒæœåŠ¡æˆ–å®¢æˆ·ç«¯æ‰èƒ½å‘ç°å®ƒã€‚ å¯¹æœåŠ¡ç«¯è¿›è¡Œæµ‹è¯•ä½¿ç”¨å‘½ä»¤ 1micro call SrvName funcName args ä½¿ç”¨ç¤ºä¾‹ 1micro call go.micro.srv.demo Demo.Call "&#123;\"name\": \"John\"&#125;" ä½¿ç”¨GO-Microç¼–å†™å®¢æˆ·ç«¯ClientåŒ…ç”¨äºæŸ¥è¯¢æœåŠ¡ï¼Œå½“åˆ›å»ºæœåŠ¡æ—¶ï¼Œä¹ŸåŒ…å«äº†ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯åŒ¹é…æœåŠ¡æ‰€ä½¿ç”¨çš„åˆå§‹åŒ–åŒ…ã€‚ æŸ¥è¯¢ä¸Šé¢çš„æœåŠ¡å¾ˆç®€å•ï¼š 12345678910111213// åˆ›å»ºgreateå®¢æˆ·ç«¯ï¼Œè¿™éœ€è¦ä¼ å…¥æœåŠ¡åä¸æœåŠ¡çš„å®¢æˆ·ç«¯æ–¹æ³•æ„å»ºçš„å®¢æˆ·ç«¯å¯¹è±¡greeter := proto.NewGreeterClient("greeter", service.Client())// åœ¨Greeter handlerä¸Šè¯·æ±‚è°ƒç”¨Helloæ–¹æ³•rsp, err := greeter.Hello(context.TODO(), &amp;proto.HelloRequest&#123; Name: "John",&#125;)if err != nil &#123; fmt.Println(err) return&#125;fmt.Println(rsp.Greeter) proto.NewGreeterClient éœ€è¦æœåŠ¡åä¸å®¢æˆ·ç«¯å®ä¾‹æ¥è¯·æ±‚æœåŠ¡ã€‚]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangå·¥å…·åŒ…</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>Micro</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Go-xorm ä½¿ç”¨]]></title>
    <url>%2F2019%2F05%2F20%2F11.Golang%2FGolang%E5%B7%A5%E5%85%B7%E5%8C%85%2Fxorm%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[Xorm ä½¿ç”¨åˆ›å»ºå¼•æ“ åˆ›å»ºå¼•æ“ driverName, dataSourceNameå’Œdatabase/sqlæ¥å£ç›¸åŒ ç¬¬ä¸€ç§æ–¹æ³• 1234567891011import ( _ "github.com/go-sql-driver/mysql" "github.com/go-xorm/xorm")var engine *xorm.Enginefunc main() &#123; var err error engine, err = xorm.NewEngine("mysql", "root:123@/test?charset=utf8")&#125; ç¬¬äºŒç§æ–¹æ³• 1234567891011import ( _ "github.com/mattn/go-sqlite3" "github.com/go-xorm/xorm")var engine *xorm.Enginefunc main() &#123; var err error engine, err = xorm.NewEngine("sqlite3", "./test.db")&#125; åˆ›å»ºEngineç»„(æ“ä½œé›†ç¾¤) 123456dataSourceNameSlice := []string&#123;masterDataSourceName, slave1DataSourceName, slave2DataSourceName&#125;engineGroup, err := xorm.NewEngineGroup(driverName, dataSourceNameSlice)masterEngine, err := xorm.NewEngine(driverName, masterDataSourceName)slave1Engine, err := xorm.NewEngine(driverName, slave1DataSourceName)slave2Engine, err := xorm.NewEngine(driverName, slave2DataSourceName)engineGroup, err := xorm.NewEngineGroup(masterEngine, []*Engine&#123;slave1Engine, slave2Engine&#125;) æ‰€æœ‰ä½¿ç”¨ engine éƒ½å¯ä»¥ç®€å•çš„ç”¨ engineGroup æ¥æ›¿æ¢ã€‚ åŒæ­¥ç»“æ„ä½“åˆ°æ•°æ®åº“è¡¨ å®šä¹‰ä¸€ä¸ªå’Œè¡¨åŒæ­¥çš„ç»“æ„ä½“ï¼Œå¹¶ä¸”è‡ªåŠ¨åŒæ­¥ç»“æ„ä½“åˆ°æ•°æ®åº“ 1234567891011type User struct &#123; Id int64 Name string Salt string Age int Passwd string `xorm:"varchar(200)"` Created time.Time `xorm:"created"` Updated time.Time `xorm:"updated"`&#125;err := engine.Sync2(new(User)) CURDæ“ä½œInsert æ“ä½œ Insert æ’å…¥ä¸€æ¡æˆ–è€…å¤šæ¡è®°å½• 12345678910111213affected, err := engine.Insert(&amp;user)// INSERT INTO struct () values ()affected, err := engine.Insert(&amp;user1, &amp;user2)// INSERT INTO struct1 () values ()// INSERT INTO struct2 () values ()affected, err := engine.Insert(&amp;users)// INSERT INTO struct () values (),(),()affected, err := engine.Insert(&amp;user1, &amp;users)// INSERT INTO struct1 () values ()// INSERT INTO struct2 () values (),(),() Deleteæ“ä½œ Delete åˆ é™¤è®°å½•ï¼Œéœ€è¦æ³¨æ„ï¼Œåˆ é™¤å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªæ¡ä»¶ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è¦æ¸…ç©ºæ•°æ®åº“å¯ä»¥ç”¨EmptyTable 12345affected, err := engine.Where(...).Delete(&amp;user)// DELETE FROM user Where ...affected, err := engine.ID(2).Delete(&amp;user)// DELETE FROM user Where id = ? update æ›´æ–°æ“ä½œ Update æ›´æ–°æ•°æ®ï¼Œé™¤éä½¿ç”¨Cols,AllColså‡½æ•°æŒ‡æ˜ï¼Œé»˜è®¤åªæ›´æ–°éç©ºå’Œé0çš„å­—æ®µ 1234567891011121314151617181920affected, err := engine.ID(1).Update(&amp;user)// UPDATE user SET ... Where id = ?affected, err := engine.Update(&amp;user, &amp;User&#123;Name:name&#125;)// UPDATE user SET ... Where name = ?var ids = []int64&#123;1, 2, 3&#125;affected, err := engine.In(ids).Update(&amp;user)// UPDATE user SET ... Where id IN (?, ?, ?)// force update indicated columns by Colsaffected, err := engine.ID(1).Cols("age").Update(&amp;User&#123;Name:name, Age: 12&#125;)// UPDATE user SET age = ?, updated=? Where id = ?// force NOT update indicated columns by Omitaffected, err := engine.ID(1).Omit("name").Update(&amp;User&#123;Name:name, Age: 12&#125;)// UPDATE user SET age = ?, updated=? Where id = ?affected, err := engine.ID(1).AllCols().Update(&amp;user)// UPDATE user SET name=?,age=?,salt=?,passwd=?,updated=? Where id = ? queryæ“ä½œ Query æœ€åŸå§‹çš„ä¹Ÿæ”¯æŒSQLè¯­å¥æŸ¥è¯¢ï¼Œè¿”å›çš„ç»“æœç±»å‹ä¸º []map[string]byteã€‚QueryString è¿”å› []map[string]string, QueryInterface è¿”å› []map[string]interface{}. 12345678results, err := engine.Query("select * from user")results, err := engine.Where("a = 1").Query()results, err := engine.QueryString("select * from user")results, err := engine.Where("a = 1").QueryString()results, err := engine.QueryInterface("select * from user")results, err := engine.Where("a = 1").QueryInterface() Get æ“ä½œ Get æŸ¥è¯¢å•æ¡è®°å½• 12345678910111213141516171819202122has, err := engine.Get(&amp;user)// SELECT * FROM user LIMIT 1has, err := engine.Where(&quot;name = ?&quot;, name).Desc(&quot;id&quot;).Get(&amp;user)// SELECT * FROM user WHERE name = ? ORDER BY id DESC LIMIT 1var name stringhas, err := engine.Table(&amp;user).Where(&quot;id = ?&quot;, id).Cols(&quot;name&quot;).Get(&amp;name)// SELECT name FROM user WHERE id = ?var id int64has, err := engine.Table(&amp;user).Where(&quot;name = ?&quot;, name).Cols(&quot;id&quot;).Get(&amp;id)has, err := engine.SQL(&quot;select id from user&quot;).Get(&amp;id)// SELECT id FROM user WHERE name = ?var valuesMap = make(map[string]string)has, err := engine.Table(&amp;user).Where(&quot;id = ?&quot;, id).Get(&amp;valuesMap)// SELECT * FROM user WHERE id = ?var valuesSlice = make([]interface&#123;&#125;, len(cols))has, err := engine.Table(&amp;user).Where(&quot;id = ?&quot;, id).Cols(cols...).Get(&amp;valuesSlice)// SELECT col1, col2, col3 FROM user WHERE id = ? Findæ“ä½œ(æŸ¥è¯¢å¤šæ¡è®°å½•) Find æŸ¥è¯¢å¤šæ¡è®°å½•ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨Joinå’Œextendsæ¥ç»„åˆä½¿ç”¨ 1234567891011121314151617181920var users []Usererr := engine.Where("name = ?", name).And("age &gt; 10").Limit(10, 0).Find(&amp;users)// SELECT * FROM user WHERE name = ? AND age &gt; 10 limit 10 offset 0type Detail struct &#123; Id int64 UserId int64 `xorm:"index"`&#125;type UserDetail struct &#123; User `xorm:"extends"` Detail `xorm:"extends"`&#125;var users []UserDetailerr := engine.Table("user").Select("user.*, detail.*") Join("INNER", "detail", "detail.user_id = user.id"). Where("user.name = ?", name).Limit(10, 0). Find(&amp;users)// SELECT user.*, detail.* FROM user INNER JOIN detail WHERE user.name = ? limit 10 offset 0 è®°å½•Exist åˆ¤æ–­ Exist æ£€æµ‹è®°å½•æ˜¯å¦å­˜åœ¨ 12345678910111213141516171819has, err := testEngine.Exist(new(RecordExist))// SELECT * FROM record_exist LIMIT 1has, err = testEngine.Exist(&amp;RecordExist&#123; Name: &quot;test1&quot;, &#125;)// SELECT * FROM record_exist WHERE name = ? LIMIT 1has, err = testEngine.Where(&quot;name = ?&quot;, &quot;test1&quot;).Exist(&amp;RecordExist&#123;&#125;)// SELECT * FROM record_exist WHERE name = ? LIMIT 1has, err = testEngine.SQL(&quot;select * from record_exist where name = ?&quot;, &quot;test1&quot;).Exist()// select * from record_exist where name = ?has, err = testEngine.Table(&quot;record_exist&quot;).Exist()// SELECT * FROM record_exist LIMIT 1has, err = testEngine.Table(&quot;record_exist&quot;).Where(&quot;name = ?&quot;, &quot;test1&quot;).Exist()// SELECT * FROM record_exist WHERE name = ? LIMIT 1 æ‰§è¡ŒåŸç”Ÿsqlè¯­å¥ Exec æ‰§è¡Œä¸€ä¸ªSQLè¯­å¥ 1affected, err := engine.Exec("update user set age = ? where name = ?", age, name) æ•°æ®åº“éå† Iterate å’Œ Rows æ ¹æ®æ¡ä»¶éå†æ•°æ®åº“ï¼Œå¯ä»¥æœ‰ä¸¤ç§æ–¹å¼: Iterate and Rows 1234567891011121314151617181920err := engine.Iterate(&amp;User&#123;Name:name&#125;, func(idx int, bean interface&#123;&#125;) error &#123; user := bean.(*User) return nil&#125;)// SELECT * FROM usererr := engine.BufferSize(100).Iterate(&amp;User&#123;Name:name&#125;, func(idx int, bean interface&#123;&#125;) error &#123; user := bean.(*User) return nil&#125;)// SELECT * FROM user Limit 0, 100// SELECT * FROM user Limit 101, 100rows, err := engine.Rows(&amp;User&#123;Name:name&#125;)// SELECT * FROM userdefer rows.Close()bean := new(Struct)for rows.Next() &#123; err = rows.Scan(bean)&#125; ç»Ÿè®¡æ“ä½œ Count è·å–è®°å½•æ¡æ•° 12counts, err := engine.Count(&amp;user)// SELECT count(*) AS total FROM user Sum æ±‚å’Œå‡½æ•° 1234567891011agesFloat64, err := engine.Sum(&amp;user, "age")// SELECT sum(age) AS total FROM useragesInt64, err := engine.SumInt(&amp;user, "age")// SELECT sum(age) AS total FROM usersumFloat64Slice, err := engine.Sums(&amp;user, "age", "score")// SELECT sum(age), sum(score) FROM usersumInt64Slice, err := engine.SumsInt(&amp;user, "age", "score")// SELECT sum(age), sum(score) FROM user æ¡ä»¶ç¼–è¾‘å™¨ æ¡ä»¶ç¼–è¾‘å™¨ 12err := engine.Where(builder.NotIn("a", 1, 2).And(builder.In("b", "c", "d", "e"))).Find(&amp;users)// SELECT id, name ... FROM user WHERE a NOT IN (?, ?) AND b IN (?, ?, ?) äº‹åŠ¡æ“ä½œ åœ¨ä¸€ä¸ªGoç¨‹ä¸­å¤šæ¬¡æ“ä½œæ•°æ®åº“ï¼Œä½†æ²¡æœ‰äº‹åŠ¡ 123456789101112131415161718session := engine.NewSession()defer session.Close()user1 := Userinfo&#123;Username: "xiaoxiao", Departname: "dev", Alias: "lunny", Created: time.Now()&#125;if _, err := session.Insert(&amp;user1); err != nil &#123; return err&#125;user2 := Userinfo&#123;Username: "yyy"&#125;if _, err := session.Where("id = ?", 2).Update(&amp;user2); err != nil &#123; return err&#125;if _, err := session.Exec("delete from userinfo where username = ?", user2.Username); err != nil &#123; return err&#125;return nil åœ¨ä¸€ä¸ªGoç¨‹ä¸­æœ‰äº‹åŠ¡ 12345678910111213141516171819202122232425session := engine.NewSession()defer session.Close()// add Begin() before any actionif err := session.Begin(); err != nil &#123; // if returned then will rollback automatically return err&#125;user1 := Userinfo&#123;Username: "xiaoxiao", Departname: "dev", Alias: "lunny", Created: time.Now()&#125;if _, err := session.Insert(&amp;user1); err != nil &#123; return err&#125;user2 := Userinfo&#123;Username: "yyy"&#125;if _, err := session.Where("id = ?", 2).Update(&amp;user2); err != nil &#123; return err&#125;if _, err := session.Exec("delete from userinfo where username = ?", user2.Username); err != nil &#123; return err&#125;// add Commit() after all actionsreturn session.Commit() äº‹ç‰©çš„ç®€å†™æ–¹æ³• 12345678910111213141516res, err := engine.Transaction(func(session *xorm.Session) (interface&#123;&#125;, error) &#123; user1 := Userinfo&#123;Username: "xiaoxiao", Departname: "dev", Alias: "lunny", Created: time.Now()&#125; if _, err := session.Insert(&amp;user1); err != nil &#123; return nil, err &#125; user2 := Userinfo&#123;Username: "yyy"&#125; if _, err := session.Where("id = ?", 2).Update(&amp;user2); err != nil &#123; return nil, err &#125; if _, err := session.Exec("delete from userinfo where username = ?", user2.Username); err != nil &#123; return nil, err &#125; return nil, nil&#125;) ä¸Šä¸‹æ–‡ç¼“å­˜ ä¸Šä¸‹æ–‡ç¼“å­˜ï¼Œå¦‚æœå¯ç”¨ï¼Œé‚£ä¹ˆé’ˆå¯¹å•ä¸ªå¯¹è±¡çš„æŸ¥è¯¢å°†ä¼šè¢«ç¼“å­˜åˆ°ç³»ç»Ÿä¸­ï¼Œå¯ä»¥è¢«ä¸‹ä¸€ä¸ªæŸ¥è¯¢ä½¿ç”¨ã€‚ 123456789101112131415161718192021222324sess := engine.NewSession()defer sess.Close()var context = xorm.NewMemoryContextCache()var c2 ContextGetStructhas, err := sess.ID(1).ContextCache(context).Get(&amp;c2)assert.NoError(t, err)assert.True(t, has)assert.EqualValues(t, 1, c2.Id)assert.EqualValues(t, "1", c2.Name)sql, args := sess.LastSQL()assert.True(t, len(sql) &gt; 0)assert.True(t, len(args) &gt; 0)var c3 ContextGetStructhas, err = sess.ID(1).ContextCache(context).Get(&amp;c3)assert.NoError(t, err)assert.True(t, has)assert.EqualValues(t, 1, c3.Id)assert.EqualValues(t, "1", c3.Name)sql, args = sess.LastSQL()assert.True(t, len(sql) == 0)assert.True(t, len(args) == 0)]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangå·¥å…·åŒ…</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>Orm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[swaggerä»æºç ç”Ÿæˆspec]]></title>
    <url>%2F2019%2F04%2F29%2F11.Golang%2FGolang%E5%B7%A5%E5%85%B7%E5%8C%85%2Fswagger%E4%BB%8E%E6%BA%90%E7%A0%81%E7%94%9F%E6%88%90spec%2F</url>
    <content type="text"><![CDATA[ä»æºç ç”Ÿæˆspecæ–‡æ¡£spec ç”Ÿæˆå‘½ä»¤12345678910111213141516171819Usage: swagger [OPTIONS] generate spec [spec-OPTIONS]generate a swagger spec document from a go applicationApplication Options: -q, --quiet silence logs -o, --output=LOG-FILE redirect logs to fileHelp Options: -h, --help Show this help message[spec command options] -b, --base-path= the base path to use (default: .) -t, --tags= build tags -m, --scan-models includes models that were annotated with &apos;swagger:model&apos; --compact when present, doesn&apos;t prettify the json -o, --output= the file to write to -i, --input= the file to use as input specç”Ÿæˆæ–¹æ³•ç”ŸæˆåŒ…çš„spec1swagger generate spec -o ./swagger.json å¦‚æœä¸æä¾›ä¸€ä¸ªmianæ–‡ä»¶ç»™swaggerï¼Œ swagger å°†éå†åŒ…ä¸­çš„å·¦å³æ–‡ä»¶ä»¥åŠæ–‡ä»¶çš„ä¾èµ–å¹¶ç”Ÿæˆspec å¦‚æœæƒ³è¦æä¾›ç»™swaggerä¸€ä¸ªmainæ–‡ä»¶ï¼Œå¯ä»¥åœ¨mainæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹æ³¨é‡Š: 1//go:generate swagger generate spec å®ƒä½¿ç”¨goå·¥å…·åŠ è½½å™¨åŠ è½½åº”ç”¨ç¨‹åºï¼Œç„¶åæ‰«æä»£ç åº“ä½¿ç”¨çš„æ‰€æœ‰è½¯ä»¶åŒ…ã€‚è¿™æ„å‘³ç€å¯¹äºå¯è¢«å‘ç°çš„ä¸œè¥¿ï¼Œå®ƒéœ€è¦é€šè¿‡ä¸»åŒ…è§¦å‘çš„ä»£ç è·¯å¾„æ¥è®¿é—®ã€‚ åˆå¹¶ymlæ–‡ä»¶å®šä¹‰çš„spec1swagger generate spec -i ./swagger.yml -o ./swagger.json ç”Ÿæˆyamlæ ¼å¼çš„specæ–‡ä»¶1swagger generate spec -o ./swagger.yml Specç”Ÿæˆè§„åˆ™swagger:metaé…ç½® åŒ…specæ–‡ä»¶çš„ä¸€äº›åŸæ•°æ®ï¼Œ è¯­æ³• 1swagger:meta å¯é…ç½®çš„å±æ€§å¦‚ä¸‹ Annotation Format Terms Of Service allows for either a url or a free text definition describing the terms of services for the API Consumes a list of default (global) mime type values, one per line, for the content the API receives. List of supported mime types Produces a list of default (global) mime type values, one per line, for the content the API sends. List of supported mime types Schemes a list of default schemes the API accept (possible values: http, https, ws, wss) https is preferred as default when configured Version the current version of the API Host the host from where the spec is served Base path the default base path for this API Contact the name of for the person to contact concerning the API eg. John Doe &#106;&#111;&#x68;&#110;&#64;&#98;&#x6c;&#x6f;&#x67;&#115;&#x2e;&#99;&#111;&#x6d; http://john.blogs.com License the name of the license followed by the URL of the license eg. MIT http://opensource.org/license/MIT Security a dictionary of key: []string{scopes} SecurityDefinitions list of supported authorization types https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#securityDefinitionsObject Extensions list of extensions to Swagger Schema. The field name MUST begin with x-, for example, x-internal-id. The value can be null, a primitive, an array or an object. ç¤ºä¾‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// Package classification Petstore API.//// the purpose of this application is to provide an application// that is using plain go code to define an API//// This should demonstrate all the possible comment annotations// that are available to turn go code into a fully compliant swagger 2.0 spec//// Terms Of Service://// there are no TOS at this moment, use at your own risk we take no responsibility//// Schemes: http, https// Host: localhost// BasePath: /v2// Version: 0.0.1// License: MIT http://opensource.org/licenses/MIT// Contact: John Doe&lt;john.doe@example.com&gt; http://john.doe.com//// Consumes:// - application/json// - application/xml//// Produces:// - application/json// - application/xml//// Security:// - api_key://// SecurityDefinitions:// api_key:// type: apiKey// name: KEY// in: header// oauth2:// type: oauth2// authorizationUrl: /oauth2/auth// tokenUrl: /oauth2/token// in: header// scopes:// bar: foo// flow: accessCode//// Extensions:// x-meta-value: value// x-meta-array:// - value1// - value2// x-meta-array-obj:// - name: obj// value: field//// swagger:metapackage classification swagger:routeè·¯å¾„é…ç½®çš„æ–¹æ³•ï¼Œ æ­¤æ“ä½œè·å–ä¸€ä¸ªå”¯ä¸€IDï¼Œç”¨äºåé¢è¯¥æ–¹æ³•çš„åç§° è¯­æ³• 1swagger:route [method] [path pattern] [?tag1 tag2 tag3] [operation id] å±æ€§ Annotation Format Consumes a list of operation specific mime type values, one per line, for the content the API receives Produces a list of operation specific mime type values, one per line, for the content the API sends Schemes a list of operation specific schemes the API accept (possible values: http, https, ws, wss) https is preferred as default when configured Security a dictionary of key: []string{scopes} Responses a dictionary of status code to named response ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930// ServeAPI serves the API for this record storefunc ServeAPI(host, basePath string, schemes []string) error &#123; // swagger:route GET /pets pets users listPets // // Lists pets filtered by some parameters. // // This will show all available pets by default. // You can get the pets that are out of stock // // Consumes: // - application/json // - application/x-protobuf // // Produces: // - application/json // - application/x-protobuf // // Schemes: http, https, ws, wss // // Security: // api_key: // oauth: read, write // // Responses: // default: genericError // 200: someResponse // 422: validationError mountItem(&quot;GET&quot;, basePath+&quot;/pets&quot;, nil)&#125; swagger:parameterså‚æ•°æ³¨é‡Šç»“æ„è¿æ¥åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œã€‚ ç”Ÿæˆçš„swagger specä¸­çš„å‚æ•°å¯ä»¥ç”±å¤šä¸ªç»“æ„ç»„æˆã€‚ è¯­æ³• 1swagger:parameters [operationid1 operationid2] å‚æ•° Annotation Format In where to find the parameter Collection Format when a slice the formatter for the collection when serialized on the request Maximum specifies the maximum a number or integer value can have Minimum specifies the minimum a number or integer value can have Multiple of specifies a value a number or integer value must be a multiple of Minimum length the minimum length for a string value Maximum length the maximum length for a string value Pattern a regular expression a string value needs to match Minimum items the minimum number of items a slice needs to have Maximum items the maximum number of items a slice can have Unique when set to true the slice can only contain unique items Required when set to true this value needs to be present in the request Example an example value, parsed as the fieldâ€™s type (objects and slices are parsed as JSON) å¯¹äºsliceå±æ€§ï¼Œè¿˜éœ€è¦å®šä¹‰ä¸€äº›é¡¹ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªåµŒå¥—é›†åˆï¼Œç”¨äºæŒ‡ç¤ºåµŒå¥—çº§åˆ«ï¼Œå€¼æ˜¯ä¸€ä¸ªåŸºäº0çš„ç´¢å¼• Annotation Format Items.n.Maximum specifies the maximum a number or integer value can have at the level n Items.n.Minimum specifies the minimum a number or integer value can have at the level n Items.n.Multiple of specifies a value a number or integer value must be a multiple of Items.n.Minimum length the minimum length for a string value at the level n Items.n.Maximum length the maximum length for a string value at the level n Items.n.Pattern a regular expression a string value needs to match at the level n Items.n.Minimum items the minimum number of items a slice needs to have at the level n Items.n.Maximum items the maximum number of items a slice can have at the level n Items.n.Unique when set to true the slice can only contain unique items at the level n ç¤ºä¾‹ï¼š 12345678910111213141516171819// swagger:parameters listBars addBarstype BarSliceParam struct &#123; // a BarSlice has bars which are strings // // min items: 3 // max items: 10 // unique: true // items.minItems: 4 // items.maxItems: 9 // items.items.minItems: 5 // items.items.maxItems: 8 // items.items.items.minLength: 3 // items.items.items.maxLength: 10 // items.items.items.pattern: \w+ // collection format: pipe // in: query // example: [[[&quot;bar_000&quot;]]] BarSlice [][][]string `json:&quot;bar_slice&quot;`&#125; swagger:operationæ“ä½œæ³¨é‡Šå°†è·¯å¾„é“¾æ¥åˆ°æ–¹æ³• è¯­æ³• 1swagger:operation [method] [path pattern] [?tag1 tag2 tag3] [operation id] å‚æ•° Field Name Type Description tags [string] A list of tags for API documentation control. Tags can be used for logical grouping of operations by resources or any other qualifier. summary string A short summary of what the operation does. For maximum readability in the swagger-ui, this field SHOULD be less than 120 characters. description string A verbose explanation of the operation behavior. GFM syntax can be used for rich text representation. externalDocs External Documentation Object Additional external documentation for this operation. operationId string Unique string used to identify the operation. The id MUST be unique among all operations described in the API. Tools and libraries MAY use the operationId to uniquely identify an operation, therefore, it is recommended to follow common programming naming conventions. consumes [string] A list of MIME types the operation can consume. This overrides the consumesdefinition at the Swagger Object. An empty value MAY be used to clear the global definition. Value MUST be as described under Mime Types. produces [string] A list of MIME types the operation can produce. This overrides the producesdefinition at the Swagger Object. An empty value MAY be used to clear the global definition. Value MUST be as described under Mime Types. parameters [Parameter Object | Reference Object] A list of parameters that are applicable for this operation. If a parameter is already defined at the Path Item, the new definition will override it, but can never remove it. The list MUST NOT include duplicated parameters. A unique parameter is defined by a combination of a name and location. The list can use the Reference Object to link to parameters that are defined at the Swagger Objectâ€™s parameters. There can be one â€œbodyâ€ parameter at most. responses Responses Object Required. The list of possible responses as they are returned from executing this operation. schemes [string] The transfer protocol for the operation. Values MUST be from the list: &quot;http&quot;, &quot;https&quot;, &quot;ws&quot;, &quot;wss&quot;. The value overrides the Swagger Object schemesdefinition. deprecated boolean Declares this operation to be deprecated. Usage of the declared operation should be refrained. Default value is false. security [Security Requirement Object] A declaration of which security schemes are applied for this operation. The list of values describes alternative security schemes that can be used (that is, there is a logical OR between the security requirements). This definition overrides any declared top-level security. To remove a top-level security declaration, an empty array can be used. ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344// ServeAPI serves the API for this record storefunc ServeAPI(host, basePath string, schemes []string) (err error) &#123; // swagger:operation GET /pets getPet // // Returns all pets from the system that the user has access to // // Could be any pet // // --- // produces: // - application/json // - application/xml // - text/xml // - text/html // parameters: // - name: tags // in: query // description: tags to filter by // required: false // type: array // items: // type: string // collectionFormat: csv // - name: limit // in: query // description: maximum number of results to return // required: false // type: integer // format: int32 // responses: // '200': // description: pet response // schema: // type: array // items: // "$ref": "#/definitions/pet" // default: // description: unexpected error // schema: // "$ref": "#/definitions/errorModel" mountItem("GET", basePath+"/pets", nil) return&#125; swagger:responseè¯»å–ç”¨swagger:responseä¿®é¥°çš„ç»“æ„ï¼Œ å¹¶ä½¿ç”¨è¯¥ä¿¡æ¯å¡«å……ç›¸åº”çš„æ ‡é¢˜å’Œæ¨¡å¼ swaggerï¼šrouteå¯ä»¥æŒ‡å®šçŠ¶æ€ä»£ç çš„å“åº”åç§°ï¼Œç„¶ååŒ¹é…çš„å“åº”å°†ç”¨äºswaggerå®šä¹‰ä¸­çš„è¯¥æ“ä½œã€‚ è¯­æ³• 1swagger:response [?response name] å±æ€§ Annotation Description In where to find the field Collection Format when a slice the formatter for the collection when serialized on the request Maximum specifies the maximum a number or integer value can have Minimum specifies the minimum a number or integer value can have Multiple of specifies a value a number or integer value must be a multiple of Minimum length the minimum length for a string value Maximum length the maximum length for a string value Pattern a regular expression a string value needs to match Minimum items the minimum number of items a slice needs to have Maximum items the maximum number of items a slice can have Unique when set to true the slice can only contain unique items Example an example value, parsed as the fieldâ€™s type (objects and slices are parsed as JSON) å¯¹äºåˆ‡ç‰‡å±æ€§ï¼Œè¿˜æœ‰è¦å®šä¹‰çš„é¡¹ç›®ã€‚è¿™å¯èƒ½æ˜¯åµŒå¥—é›†åˆï¼Œç”¨äºæŒ‡ç¤ºåµŒå¥—çº§åˆ«ï¼Œè¯¥å€¼æ˜¯åŸºäº0çš„ç´¢å¼•ï¼Œå› æ­¤items.minLengthä¸items.0.minLengthç›¸åŒ Annotation Format Items.n.Maximum specifies the maximum a number or integer value can have at the level n Items.n.Minimum specifies the minimum a number or integer value can have at the level n Items.n.Multiple of specifies a value a number or integer value must be a multiple of Items.n.Minimum length the minimum length for a string value at the level n Items.n.Maximum length the maximum length for a string value at the level n Items.n.Pattern a regular expression a string value needs to match at the level n Items.n.Minimum items the minimum number of items a slice needs to have at the level n Items.n.Maximum items the maximum number of items a slice can have at the level n Items.n.Unique when set to true the slice can only contain unique items at the level n ç¤ºä¾‹ 123456789101112131415// A ValidationError is an error that is used when the required input fails validation.// swagger:response validationErrortype ValidationError struct &#123; // The error message // in: body Body struct &#123; // The validation message // // Required: true // Example: Expected type int Message string // An optional field name to which this validation applies FieldName string &#125;&#125; swagger:momdelå®šä¹‰ç»“æ„æ•°æ® è¯­æ³• 1swagger:model [?model name] å±æ€§ Annotation Description Maximum specifies the maximum a number or integer value can have Minimum specifies the minimum a number or integer value can have Multiple of specifies a value a number or integer value must be a multiple of Minimum length the minimum length for a string value Maximum length the maximum length for a string value Pattern a regular expression a string value needs to match Minimum items the minimum number of items a slice needs to have Maximum items the maximum number of items a slice can have Unique when set to true the slice can only contain unique items Required when set to true this value needs to be set on the schema Read Only when set to true this value will be marked as read-only and is not required in request bodies Example an example value, parsed as the fieldâ€™s type (objects and slices are parsed as JSON) å¯¹äºåˆ‡ç‰‡å±æ€§ï¼Œè¿˜æœ‰è¦å®šä¹‰çš„é¡¹ç›®ã€‚è¿™å¯èƒ½æ˜¯åµŒå¥—é›†åˆï¼Œç”¨äºæŒ‡ç¤ºåµŒå¥—çº§åˆ«ï¼Œè¯¥å€¼æ˜¯åŸºäº0çš„ç´¢å¼•ï¼Œå› æ­¤items.minLengthä¸items.0.minLengthç›¸åŒ Annotation Format Items.n.Maximum specifies the maximum a number or integer value can have at the level n Items.n.Minimum specifies the minimum a number or integer value can have at the level n Items.n.Multiple of specifies a value a number or integer value must be a multiple of Items.n.Minimum length the minimum length for a string value at the level n Items.n.Maximum length the maximum length for a string value at the level n Items.n.Pattern a regular expression a string value needs to match at the level n Items.n.Minimum items the minimum number of items a slice needs to have at the level n Items.n.Maximum items the maximum number of items a slice can have at the level n Items.n.Unique when set to true the slice can only contain unique items at the level n ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829// User represents the user for this application//// A user is the security principal for this application.// It&apos;s also used as one of main axes for reporting.//// A user can have friends with whom they can share what they like.//// swagger:modeltype User struct &#123; // the id for this user // // required: true // min: 1 ID int64 `json:&quot;id&quot;` // the name for this user // required: true // min length: 3 Name string `json:&quot;name&quot;` // the email address for this user // // required: true // example: user@provider.net Email strfmt.Email `json:&quot;login&quot;` // the friends for this user Friends []User `json:&quot;friends&quot;`&#125; swagger:allOfå°†åµŒå…¥ç±»å‹æ ‡è®°ä¸ºallOfçš„æˆå‘˜ è¯­æ³• 1swagger:allOf ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435// A SimpleOne is a model with a few simple fieldstype SimpleOne struct &#123; ID int64 `json:"id"` Name string `json:"name"` Age int32 `json:"age"`&#125;// A Something struct is used by other structstype Something struct &#123; DID int64 `json:"did"` Cat string `json:"cat"`&#125;// Notable is a model in a transitive package.// it's used for embedding in another model//// swagger:model withNotestype Notable struct &#123; Notes string `json:"notes"` Extra string `json:"extra"`&#125;// An AllOfModel is composed out of embedded structs but it should build// an allOf propertytype AllOfModel struct &#123; // swagger:allOf SimpleOne // swagger:allOf mods.Notable Something // not annotated with anything, so should be included CreatedAt strfmt.DateTime `json:"createdAt"`&#125; swagger:strfmtstrfmtæ ‡æ³¨åç§°çš„ç±»å‹ä¸ºå­—ç¬¦ä¸²æ ¼å¼ã€‚è¯¥åç§°æ˜¯å¿…éœ€çš„ï¼Œå°†ç”¨ä½œæ­¤ç‰¹å®šå­—ç¬¦ä¸²æ ¼å¼çš„æ ¼å¼åç§°ã€‚ è¯­æ³• 1swagger:strfmt [name] å­—ç¬¦ä¸²æ ¼å¼åŒ…å« uuid, uuid3, uuid4, uuid5 email uri (absolute) hostname ipv4 ipv6 credit card isbn, isbn10, isbn13 social security number hexcolor rgbcolor date date-time duration password custom string formats ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031323334353637func init() &#123; eml := Email("") Default.Add("email", &amp;eml, govalidator.IsEmail)&#125;// Email represents the email string format as specified by the json schema spec//// swagger:strfmt emailtype Email string// MarshalText turns this instance into textfunc (e Email) MarshalText() ([]byte, error) &#123; return []byte(string(e)), nil&#125;// UnmarshalText hydrates this instance from textfunc (e *Email) UnmarshalText(data []byte) error &#123; // validation is performed later on *e = Email(string(data)) return nil&#125;func (b *Email) Scan(raw interface&#123;&#125;) error &#123; switch v := raw.(type) &#123; case []byte: *b = Email(string(v)) case string: *b = Email(v) default: return fmt.Errorf("cannot sql.Scan() strfmt.Email from: %#v", v) &#125; return nil&#125;func (b Email) Value() (driver.Value, error) &#123; return driver.Value(string(b)), nil&#125; swagger:discriminatedå°†åµŒå…¥ç±»å‹æ ‡è®°ä¸ºallOfçš„æˆå‘˜å¹¶è®¾ç½®x-classå€¼ã€‚åœ¨æ¥å£å®šä¹‰ä¸Šï¼Œå¯¹å…è®¸swaggerï¼šnameçš„æ–¹æ³•æœ‰å¦ä¸€ä¸ªæ³¨é‡Š è¯­æ³• 1swagger:allOf org.example.something.TypeName ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031323334// TeslaCar is a tesla car//// swagger:modeltype TeslaCar interface &#123; // The model of tesla car // // discriminator: true // swagger:name model Model() string // AutoPilot returns true when it supports autopilot // swagger:name autoPilot AutoPilot() bool&#125;// The ModelS version of the tesla car//// swagger:model modelStype ModelS struct &#123; // swagger:allOf com.tesla.models.ModelS TeslaCar // The edition of this Model S Edition string `json:"edition"`&#125;// The ModelX version of the tesla car//// swagger:model modelXtype ModelX struct &#123; // swagger:allOf com.tesla.models.ModelX TeslaCar // The number of doors on this Model X Doors int32 `json:"doors"`&#125; swagger:ignoreå°†ç»“æ„æ ‡è®°ä¸ºä»Swaggerè§„èŒƒè¾“å‡ºä¸­æ˜¾å¼å¿½ç•¥ è¯­æ³• 1swagger:ignore åœ¨çº¿swagger editor æ–‡æ¡£ç¼–è¾‘å™¨å¯åŠ¨æ–¹å¼ é•œåƒæ‹‰å– docker pull swaggerapi/swagger-editor é•œåƒè¿è¡Œ docker run â€“rm -p 80:8080 swaggerapi/swagger-editor]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangå·¥å…·åŒ…</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ godoc ç”Ÿæˆæ–‡æ¡£]]></title>
    <url>%2F2019%2F04%2F29%2F11.Golang%2FGolang%E5%B7%A5%E5%85%B7%E5%8C%85%2F%E4%BD%BF%E7%94%A8%20godoc%20%E7%94%9F%E6%88%90%E6%96%87%E6%A1%A3%2F</url>
    <content type="text"><![CDATA[ä»£ç æ³¨é‡Šè§„èŒƒgodoc æ”¯æŒpackageã€constã€ var å’Œfunc è¿™äº›ä»£ç ç”Ÿæˆæ–‡æ¡£ï¼Œè€Œä¸”åªä¼šå¯¹é¦–å­—æ¯å¤§å†™è‡ªåŠ¨ç”Ÿæˆï¼Œè€Œå°å†™çš„ç§æœ‰æ–¹æ³•ä¸ä¼šè¢«ç”Ÿæˆåˆ°æ–‡æ¡£ï¼Œä¸‹é¢ä»‹ç»ä¸‹å„ç§æ³¨é‡Šçš„ä½¿ç”¨æ–¹å¼ Package åœ¨package name ä»£ç ä¸Šé¢ï¼Œç´§æŒ¨ç€ä»£ç è¿›è¡Œæ³¨é‡Š æ³¨é‡Šå†…å®¹ä¸­é—´ä¸èƒ½æœ‰ç©ºè¡Œ å¦‚æœä¸€ä¸ªåŒ…ä¸­æœ‰å¤šä¸ªåŒ…æ³¨é‡Šï¼Œå°±ä¼šæŠŠå¤šä¸ªåŒ…çš„æ³¨é‡Šæ”¾åœ¨ä¸€èµ·ï¼Œå¹¶æŒ‰ç…§æ–‡ä»¶åçš„é¦–å­—æ¯é¡ºåºæ’åº æ³¨é‡Šçš„æ ¼å¼ä¸º package name [summery] ï¼ˆsummeryå¯ä»¥æ˜¯å¤šè¡Œï¼‰ æ³¨é‡Šæœ€å‰é¢ä¸€å¥è¯ä¼šæ¨¡å—çš„summaryä¼šå‡ºç°åœ¨package indexä¸­ï¼Œç¬¬ä¸€å¥è¯ä»¥åŠä¹‹åçš„å†…å®¹ä¼šå‡ºç°åœ¨OverViewä¸­ æ³¨é‡Šä»£ç  1234/*A web framework includes app server, logger, panicer, util and so on. */ package document æ–‡æ¡£ç”Ÿæˆæ•ˆæœ å¸¸é‡ã€å˜é‡å’Œå‡½æ•° ç´§æŒ¨ç€å®šä¹‰ä»£ç ï¼Œåœ¨å¸¸é‡ã€å˜é‡å’Œå‡½æ•°ä¸Šé¢è¿›è¡Œæ³¨é‡Š æ³¨é‡Šæ ¼å¼ä¸º: FunctionName Summary ï¼ˆSummaryå¯ä»¥æ˜¯å¤šè¡Œï¼‰ æƒ³åœˆèµ·æ¥è¯´æ˜å‚æ•°å¯ä»¥åŠ ç¼©è¿›ï¼Œ è¿›è¡Œé¢„æ ¼å¼åŒ– æ³¨é‡Šæœ€å‰é¢ä¸€å¥è¯ä¼šå‡ºç°åœ¨package indexä¸­ï¼Œç¬¬ä¸€å¥è¯ä»¥åŠä¹‹åçš„å†…å®¹ä¼šå‡ºç°åœ¨OverViewä¸­ å¸¸é‡çš„summaryä¼šæ”¾åˆ°[ Constants ] é‡Œï¼Œ å˜é‡çš„summaryä¼šæ”¾åˆ°[ Variables ] é‡Œï¼Œ å‡½æ•°çš„summaryä¼šæ”¾åˆ° [ func ] ä¸­ æ³¨é‡Šä»£ç  1234567// Marshaler is the interface implemented by objects that/*can marshal themselves into valid JSON.*/ type Marshaler interface &#123; MarshalJSON() ([]byte, error)&#125; æ–‡æ¡£ç”Ÿæˆæ•ˆæœ BUG godocä¼šå…ˆæŸ¥æ‰¾:[ç©ºæ ¼]BUG ç„¶åæ˜¾ç¤ºåœ¨Packageè¯´æ˜æ–‡æ¡£æœ€ä¸‹é¢ å¦‚æœä»£ç ä¸­æœ‰bugï¼Œå¯ä»¥ç”¨BUGæ³¨é‡Š, å®ƒä¼šè¢«è¯†åˆ«ä¸ºä¸€ä¸ª bugï¼Œå¯ä»¥åœ¨æ–‡æ¡£ä¸­çš„ã€ŒBugsã€ä¸­çœ‹åˆ°ã€‚ æ³¨é‡Šä»£ç  1BUG(who): xxx Deprecated é€šè¿‡Deprecatedæ³¨é‡Šçš„å†…å®¹å°†ä¸ä¼šä½“ç°åœ¨godocä¸­ï¼Œä½†æ˜¯è¿˜æ˜¯æŒºæœ‰ç”¨çš„ï¼ŒGolandå¯ä»¥è¯†åˆ«å®ƒå¹¶ä½œå‡ºæç¤ºã€‚ æ³¨é‡Šä»£ç 1// Deprecated: xxx è¿”å›å€¼Outputæ ‡ç­¾ åœ¨å‡½æ•°ä½“ä¸­å¦‚æœå®šä¹‰äº†Outputæ ‡ç­¾ï¼Œä¼šåœ¨æ–‡æ¡£é¡µé¢ä¸Šå±•ç¤ºè¾“å‡ºå†…å®¹ å¦‚æœæ²¡æœ‰å®šä¹‰å°†ä¸ä¼šå±•ç¤º( éå¿…é¡» ) ä¸€èˆ¬ä¸ºæµ‹è¯•ä»£ç ä½¿ç”¨ï¼Œç”¨æ¥å±•ç¤ºæ–¹æ³•çš„è¾“å‡ºç»“æœ æ³¨é‡Šä»£ç  123456func ExamplePeel() &#123; fmt.Println("Hello Banana") // Output: // Hello Banana&#125; ä½¿ç”¨doc.goä¹¦å†™æ³¨é‡Š å¦‚æœåŒ…æ³¨é‡Šè¶…è¿‡3è¡Œï¼Œå¯ä»¥æŠŠæ³¨é‡Šéƒ½è¿ç§»åˆ°doc.goæ–‡ä»¶ä¸­ï¼ˆå¯ä»¥åœ¨å½“å‰ç›®å½•æ–°å»ºä¸€ä¸ªdoc.goæ–‡ä»¶ï¼‰ã€‚ å¤šè¡Œæ³¨é‡Šè‡ªç„¶éœ€è¦æ”¯æŒä¸€äº›å¤æ‚çš„æ ¼å¼ï¼Œå¦‚æœå•è¡Œä¸­é¦–å­—æ¯æ˜¯å¤§å†™ï¼Œå¹¶ä¸”ç»“å°¾æ²¡æœ‰æ ‡ç‚¹ç¬¦å·æ˜¯æ ‡é¢˜(æ ‡é¢˜å­—ä½“ä¼šåŠ ç²—å˜è“ï¼Œä¸­æ–‡åŠ ç²—å˜è“éœ€è¦åŠ ä¸Šä¸€ä¸ªå¤§å†™å­—æ¯) é¦–å­—æ¯æ˜¯å°å†™ï¼Œæˆ–è€…ç»“æœåˆæ ‡ç‚¹ç¬¦å·çš„æ˜¯æ®µè½ æœ‰ç¼©è¿›æ˜¯é¢„æ ¼å¼åŒ–ï¼Œ åœ¨æœ‰é¢„æ ¼å¼åŒ–çš„æ³¨é‡Šæ®µä¸­ï¼Œä¸ä¼šæœ‰æ ‡é¢˜ç‰¹å¾ example_PackageName_test.go çš„æ³¨é‡Šè§„åˆ™ åŒ…ç¤ºä¾‹ä»£ç æ³¨é‡Šéå¸¸é‡è¦ï¼Œé¡¹ç›®çš„ä½¿ç”¨æ–¹æ³•å°±æ˜¯é€šè¿‡æ¯ä¸ªåŒ…ä¾‹å­æ­å»ºèµ·æ¥çš„, æ–‡ä»¶å¿…é¡»æ”¾åœ¨å½“å‰åŒ…ä¸‹ ç¤ºä¾‹æ–‡ä»¶éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œåç§°æ ¼å¼ä¸º example_Packagename_test.go. ä¸åŠ exampleå‰ç¼€ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸åŠ å‰ç¼€é€šå¸¸æ˜¯å•å…ƒæµ‹è¯•çš„æ–‡ä»¶å‘½åè§„åˆ™ï¼Œ åŒ…åçš„æ ¼å¼ä¸º å½“å‰åŒ…å + _test. åŒ…ä¸­å‡½æ•°åç§°çš„æ ¼å¼ä¸ºExampleFuncName[_tag]ã€‚ä¸åŠ å‡½æ•°åçš„è¯æ˜¯åŒ…çº§åˆ«çš„ç¤ºä¾‹ã€‚åŠ å‡½æ•°åçš„è¯æ˜¯å‡½æ•°çº§åˆ«çš„ç¤ºä¾‹ã€‚ å‡½æ•°çš„æ³¨é‡Šä¼šå±•ç¤ºåœ¨é¡µé¢ä¸Š å‡½æ•°ç»“æœåŠ ä¸Š // Output: æ³¨é‡Šï¼Œå¯ä»¥è¯´æ˜å‡½æ•°çš„è¿”å›å€¼ï¼Œå¹¶å±•ç¤ºåœ¨æ–‡æ¡£ä¸Š åŒ…çº§åˆ«çš„ç¤ºä¾‹å‡½æ•°åç§°è§„åˆ™ Example ä»£ç ç¤ºä¾‹ 123func Example() &#123; logger.Info(&quot;hello, world.&quot;)&#125; æ–‡æ¡£å±•ç¤ºç»“æœ å‡½æ•°çº§åˆ«ç¤ºä¾‹å‡½æ•°åç§°è§„åˆ™ ExampleFuncName ä»£ç ç¤ºä¾‹ 123456func ExampleNewLogger() &#123; w := os.Stdout flag := log.Llongfile l := logger.NewWriterLogger(w, flag, 3) l.Info(&quot;hello, world&quot;)&#125; æ–‡æ¡£å±•ç¤ºç»“æœ Outputè¾“å‡ºæ³¨é‡Šæ ¼å¼ OutPut: xxxxxxx ä»£ç ç¤ºä¾‹ 1234567891011121314// æ­¤å‡½æ•°å°†è¢«å±•ç¤ºåœ¨OverViewåŒºåŸŸ, å¹¶å±•ç¤ºnoOutputæ ‡ç­¾func Example_noOutput() &#123; fmt.Println("Hello OverView") // (Output: )éå¿…é¡», å­˜åœ¨æ—¶å°†ä¼šå±•ç¤ºè¾“å‡ºç»“æœ&#125;// æ­¤å‡½æ•°å°†è¢«å±•ç¤ºåœ¨FunctionåŒºåŸŸ// Peelå¿…é¡»æ˜¯bananaåŒ…å®ç°çš„æ–¹æ³•func ExamplePeel() &#123; fmt.Println("Hello Banana") // Output: // Hello Banana&#125; æœ¬åœ°è¿è¡Œgodoc æ–‡æ¡£1godoc -http=:6060]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangå·¥å…·åŒ…</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[swagger spec çš„ç¼–å†™è§„èŒƒ]]></title>
    <url>%2F2019%2F04%2F29%2F11.Golang%2FGolang%E5%B7%A5%E5%85%B7%E5%8C%85%2Fswagger%20spec%20%E7%9A%84%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83%2F</url>
    <content type="text"><![CDATA[ä¸€ã€Swaggerç®€ä»‹ä»€ä¹ˆæ˜¯swaggerSwaggeræ˜¯ä¸€ä¸ªç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„APIè¡¨è¾¾å·¥å…·ã€‚å®ƒå…·æœ‰åœ°çƒä¸Šæœ€å¤§çš„APIå·¥å…·ç”Ÿæ€ç³»ç»Ÿï¼Œæ•°ä»¥åƒè®¡çš„å¼€å‘äººå‘˜ï¼Œä½¿ç”¨å‡ ä¹æ‰€æœ‰çš„ç°ä»£ç¼–ç¨‹è¯­è¨€ï¼Œéƒ½åœ¨æ”¯æŒå’Œä½¿ç”¨Swaggerã€‚ä½¿ç”¨Swaggerç”ŸæˆAPIï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°äº¤äº’å¼æ–‡æ¡£ï¼Œè‡ªåŠ¨ç”Ÿæˆä»£ç çš„SDKä»¥åŠAPIçš„å‘ç°ç‰¹æ€§ç­‰ã€‚ Go swaggeræ–‡æ¡£é…ç½®æ–‡ä»¶ç¤ºä¾‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748swagger: "2.0"info: description: From the todo list tutorial on goswagger.io title: A Todo list application version: 1.0.0consumes: - application/io.goswagger.examples.todo-list.v1+jsonproduces:- application/io.goswagger.examples.todo-list.v1+jsonschemes:- httpdefinitions: item: type: object required: - description properties: id: type: integer format: int64 readOnly: true description: type: string minLength: 1 completed: type: booleanpaths: /: get: tags: - todos parameters: - name: since in: query type: integer format: int64 - name: limit in: query type: integer format: int32 default: 20 responses: 200: description: list the todo operations schema: type: array items: $ref: "#/definitions/item" Go-swagger ç¯å¢ƒå®‰è£… å®‰è£…ä¾èµ– 1234567891011121314151617go get github.com/go-openapi/errorsgo get github.com/go-openapi/loadsgo get github.com/go-openapi/runtimego get github.com/go-openapi/specgo get github.com/go-openapi/strfmtgo get github.com/go-openapi/swaggo get github.com/go-openapi/validatego get github.com/jessevdk/go-flagsgo get golang.org/x/net/context å®‰è£…swagger 1go get -u github.com/go-swagger/go-swagger/cmd/swagger è¯­è¨€é€‰æ‹©: JSON vs YAMLæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨JSONæˆ–è€…YAMLçš„è¯­è¨€æ ¼å¼æ¥ç¼–å†™APIæ–‡æ¡£ã€‚ä½†æ˜¯ä¸ªäººå»ºè®®ä½¿ç”¨YAMLæ¥å†™ï¼ŒåŸå› æ˜¯å®ƒæ›´ç®€å•ã€‚ä¸€å›¾èƒœåƒè¨€ï¼Œå…ˆçœ‹ç”¨JSONå†™çš„æ–‡æ¡£ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142&#123; "swagger": "2.0", "info": &#123; "version": "1.0.0", "title": "Simple API", "description": "A simple API to learn how to write OpenAPI Specification" &#125;, "schemes": [ "https" ], "host": "simple.api", "basePath": "/openapi101", "paths": &#123; "/persons": &#123; "get": &#123; "summary": "Gets some persons", "description": "Returns a list containing all persons.", "responses": &#123; "200": &#123; "description": "A list of Person", "schema": &#123; "type": "array", "items": &#123; "properties": &#123; "firstName": &#123; "type": "string" &#125;, "lastName": &#123; "type": "string" &#125;, "username": &#123; "type": "string" &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125;&#125; å†æ¥çœ‹çœ‹åŒä¸€ä»½APIæ–‡æ¡£çš„YAMLå®ç°ï¼š 1234567891011121314151617181920212223242526272829303132swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. responses: 200: description: A list of Person schema: type: array items: required: - username properties: firstName: type: string lastName: type: string username: type: string å¯¹äºæ™®é€šäººæ¥è¯´ï¼Œä¼¼ä¹ç”¨YAMLæ›´èƒ½å¤Ÿç®€åŒ–ä¹¦å†™å’Œé˜…è¯»ã€‚è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰éæ­¤å³å½¼çš„é€‰æ‹©é—®é¢˜ï¼Œå› ä¸ºï¼š å‡ ä¹æ‰€ç”¨æ”¯æŒOpenAPIè§„èŒƒçš„å·¥å…·éƒ½æ”¯æŒYAML æœ‰å¾ˆå¤šçš„å·¥å…·å¯ä»¥å®ç°YAML-JSONä¹‹é—´çš„è½¬æ¢ æ‰€ä»¥ï¼Œç”¨è‡ªå·±å–œæ¬¢çš„æ–¹å¼ä¹¦å†™å³å¯ã€‚ï¼ˆåé¢çš„ç¤ºä¾‹æ–‡æ¡£ä¹Ÿéƒ½æ˜¯ç”¨YAMLæ¥å†™çš„ã€‚å¼ºçƒˆæ¨èä½¿ç”¨YAMLã€‚ï¼‰ äºŒã€åŸºæœ¬çš„swagger apiå®šä¹‰æ–¹æ³•2.1 æœ€ç®€å•çš„ä¾‹å­æˆ‘ä»¬ä»ä¸€ä¸ªæœ€ç®€å•ï¼ˆå‡ ä¹æ²¡æœ‰ä¸œè¥¿ï¼‰çš„APIæ–‡æ¡£å¼€å§‹ï¼š 12345678910111213swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: &#123;&#125; è¿™ä¸ªæ–‡æ¡£çš„å†…å®¹åˆ†æˆå››éƒ¨åˆ†ï¼Œä¸‹é¢åˆ†åˆ«æ¥è¯´æ˜ã€‚ 2.1.1 OpenAPIè§„èŒƒçš„ç‰ˆæœ¬å·é¦–å…ˆæˆ‘ä»¬è¦é€šè¿‡ä¸€ä¸ªswaggerå±æ€§æ¥å£°æ˜OpenAPIè§„èŒƒçš„ç‰ˆæœ¬ã€‚ 1swagger: "2.0" ä½ æ²¡çœ‹é”™ï¼Œæ˜¯swaggerï¼Œä¸Šé¢å·²ç»ä»‹ç»äº†ï¼ŒOpenAPIè§„èŒƒæ˜¯åŸºäºSwaggerçš„ï¼Œåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå±æ€§å¯èƒ½ä¼šæ¢æˆåˆ«çš„ã€‚ ç›®å‰è¿™ä¸ªå±æ€§çš„å€¼ï¼Œæš‚æ—¶åªèƒ½å¡«å†™ä¸º2.0ã€‚ 2.1.2 APIæè¿°ä¿¡æ¯ç„¶åæˆ‘ä»¬éœ€è¦è¯´æ˜ä¸€ä¸‹APIæ–‡æ¡£çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚APIæ–‡æ¡£ç‰ˆæœ¬ï¼ˆæ³¨æ„ä¸åŒäºä¸Šé¢çš„è§„èŒƒç‰ˆæœ¬ï¼‰ã€APIæ–‡æ¡£åç§°å·²ç»å¯é€‰çš„æè¿°ä¿¡æ¯ã€‚ 1234info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specification 2.1.3 APIçš„URLä½œä¸ºweb APIï¼Œä¸€ä¸ªå¾ˆé‡è¦çš„ä¿¡æ¯å°±æ˜¯ç”¨æ¥ç»™æ¶ˆè´¹è€…ä½¿ç”¨çš„æ ¹URLï¼Œå¯ä»¥ç”¨åè®®ï¼ˆhttpæˆ–è€…httpsï¼‰ã€ä¸»æœºåã€æ ¹è·¯å¾„æ¥æè¿°ï¼š 1234schemes: - httpshost: simple.apibasePath: /openapi101 è¿™è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¶ˆè´¹è€…æŠŠhttps://simple.api/open101ä½œä¸ºæ ¹èŠ‚ç‚¹æ¥è®¿é—®å„ç§APIã€‚å› ä¸ºå’Œå…·ä½“ç¯å¢ƒæœ‰å…³ï¼Œä¸æ¶‰åŠAPIæè¿°çš„æ ¹æœ¬å†…å®¹ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†ä¿¡æ¯æ˜¯å¯é€‰çš„ã€‚ 2.1.4 APIçš„æ“ä½œï¼ˆoperationï¼‰è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰å†™APIçš„æ“ä½œï¼Œç”¨ä¸€ä¸ªYAMLçš„ç©ºå¯¹è±¡{}å…ˆå ä¸ªä½ç½®ã€‚ 2.2 å®šä¹‰ä¸€ä¸ªAPIæ“ä½œå¦‚æœæˆ‘ä»¬è¦å±•ç¤ºä¸€ç»„ç”¨æˆ·ä¿¡æ¯ï¼Œå¯ä»¥è¿™æ ·æè¿°ï¼š 1234567891011121314151617181920212223242526272829303132swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. responses: 200: description: A list of Person schema: type: array items: required: - username properties: firstName: type: string lastName: type: string username: type: string 2.2.1 æ·»åŠ ä¸€ä¸ªè·¯å¾„ï¼ˆpathï¼‰æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª/personsçš„è·¯å¾„ï¼Œç”¨æ¥è®¿é—®ä¸€ç»„ç”¨æˆ·ä¿¡æ¯ï¼š 12paths: /persons: 2.2.2 åœ¨è·¯å¾„ä¸­æ·»åŠ ä¸€ä¸ªHTTPæ–¹æ³•åœ¨æ¯ä¸ªè·¯å¾„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä»»æ„çš„HTTPåŠ¨è¯æ¥æ“ä½œæ‰€éœ€è¦çš„èµ„æºã€‚ æ¯”å¦‚éœ€è¦å±•ç¤ºä¸€ç»„ç”¨æˆ·ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨/personsè·¯å¾„ä¸­æ·»åŠ getæ–¹æ³•ï¼ŒåŒæ—¶è¿˜å¯ä»¥å¡«å†™ä¸€äº›ç®€å•çš„æè¿°ä¿¡æ¯ï¼ˆsummaryï¼‰æˆ–è€…è¯´æ˜è¯¥æ–¹æ³•çš„ä¸€æ®µé•¿ç¯‡å¤§è®ºï¼ˆdescriptionï¼‰ã€‚ 123get: summary: Gets some persons description: Returns a list containing all persons. è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬è°ƒ get https://simple.api/open101/personsæ–¹æ³•å°±èƒ½è·å–ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯åˆ—è¡¨äº†ã€‚ 2.2.3 å®šä¹‰å“åº”ï¼ˆresponseï¼‰ç±»å‹å¯¹äºæ¯ä¸ªæ–¹æ³•ï¼ˆæˆ–æ“ä½œï¼‰ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åœ¨å“åº”(responses)ä¸­æ·»åŠ ä»»æ„çš„HTTPçŠ¶æ€ç ï¼ˆæ¯”å¦‚200 OK æˆ–è€… 404 Not Foundç­‰ï¼‰ã€‚è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬æ·»åŠ ä¸Š200çš„å“åº”ï¼š 123responses: 200: description: A list of Person 2.2.4 å®šä¹‰å“åº”å†…å®¹get /personsè¿™ä¸ªæ¥å£è¿”å›ä¸€ç»„ç”¨æˆ·ä¿¡æ¯ï¼Œæˆ‘ä»¬é€šè¿‡å“åº”æ¶ˆæ¯ä¸­çš„æ¨¡å¼ï¼ˆschemaï¼‰å±æ€§æ¥æè¿°æ¸…æ¥šå…·ä½“çš„è¿”å›å†…å®¹ã€‚ ä¸€ç»„ç”¨æˆ·ä¿¡æ¯å°±æ˜¯ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯å¯¹è±¡çš„æ•°ç»„ï¼ˆarrayï¼‰ï¼Œæ¯ä¸€ä¸ªæ•°ç»„å…ƒç´ åˆ™æ˜¯ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯å¯¹è±¡ï¼ˆobjectï¼‰ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸‰ä¸ªstringç±»å‹çš„å±æ€§ï¼šå§“æ°ã€åå­—ã€ç”¨æˆ·åï¼Œå…¶ä¸­ç”¨æˆ·åå¿…é¡»æä¾›ï¼ˆrequiredï¼‰ã€‚ 123456789101112schema: type: array items: required: - username properties: firstName: type: string lastName: type: string username: type: string 2.3 å®šä¹‰è¯·æ±‚å‚æ•°ï¼ˆquery parametersï¼‰ç”¨æˆ·å¤ªå¤šï¼Œæˆ‘ä»¬ä¸æƒ³ä¸€è‚¡è„‘å…¨éƒ¨è¾“å‡ºå‡ºæ¥ã€‚è¿™ä¸ªæ—¶å€™ï¼Œåˆ†é¡µè¾“å‡ºæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ è¯·æ±‚å‚æ•°æ¥å®ç°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging.#START############################################################################ parameters: - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer# END ############################################################################ responses: 200: description: A list of Person schema: type: array items: required: - username properties: firstName: type: string lastName: type: string username: type: string 2.3.1 åœ¨getæ–¹æ³•ä¸­å¢åŠ è¯·æ±‚å‚æ•°é¦–å…ˆæˆ‘ä»¬åœ¨ get æ–¹æ³•ä¸­å¢åŠ ä¸€ä¸ªå‚æ•°å±æ€§ï¼š 12345678paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging.#START############################################################################ parameters:# END ############################################################################ 2.3.2 æ·»åŠ åˆ†é¡µå‚æ•°åœ¨å‚æ•°åˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ ä¸¤ä¸ªåå­—ï¼ˆnameï¼‰åˆ†åˆ«å«åšpageSizeå’ŒpageNumberçš„æ•´å‹ï¼ˆintegerï¼‰å‚æ•°ï¼Œå¹¶ä½œç®€å•æè¿°ï¼š 123456789101112 parameters:#START############################################################################ - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer# END ############################################################################## responses: è¿™æ ·ä¸€æ¥ï¼Œæ¶ˆè´¹è€…å°±å¯ä»¥é€šè¿‡ get /persons?pageSize=20&amp;pageNumber=2 æ¥è®¿é—®ç¬¬2é¡µçš„ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸è¶…è¿‡20æ¡ï¼‰äº†ã€‚ 2.4 å®šä¹‰è·¯å¾„å‚æ•°ï¼ˆpath parameterï¼‰æœ‰æ—¶å€™æˆ‘ä»¬æƒ³è¦æ ¹æ®ç”¨æˆ·åæ¥æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦å¢åŠ ä¸€ä¸ªæ¥å£æ“ä½œï¼Œæ¯”å¦‚å¯ä»¥æ·»åŠ ä¸€ä¸ªç±»ä¼¼ /persons/{username} çš„æ“ä½œæ¥è·å–ç”¨æˆ·ä¿¡æ¯ã€‚æ³¨æ„ï¼Œ{username} æ˜¯åœ¨è¯·æ±‚è·¯å¾„ä¸­çš„å‚æ•°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. parameters: - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer responses: 200: description: A list of Person schema: type: array items: required: - username properties: firstName: type: string lastName: type: string username: type: string#START############################################################################ /persons/&#123;username&#125;: get: summary: Gets a person description: Returns a single person for its username parameters: - name: username in: path required: true description: The person's username type: string responses: 200: description: A Person schema: required: - username properties: firstName: type: string lastName: type: string username: type: string 404: description: The Person does not exists.# END ############################################################################ 2.4.1 æ·»åŠ ä¸€ä¸ª get /persons/{username} æ“ä½œé¦–å…ˆæˆ‘ä»¬åœ¨ /persons è·¯å¾„åé¢ï¼Œå¢åŠ ä¸€ä¸ª /persons/{username} çš„è·¯å¾„ï¼Œå¹¶å®šä¹‰ä¸€ä¸ª get ï¼ˆæ“ä½œï¼‰æ–¹æ³•ã€‚ 12345678910111213141516171819202122swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: /persons: username: type: string#START############################################################################ /persons/&#123;username&#125;: get: summary: Gets a person description: Returns a single person for its username# END ############################################################################ 2.4.2 å®šä¹‰è·¯å¾„å‚æ•° usernameå› ä¸º {username} æ˜¯è·¯å¾„å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåƒè¯·æ±‚å‚æ•°ä¸€æ ·å°†å®ƒæ·»åŠ åˆ° parameters å±æ€§ä¸­ï¼Œæ³¨æ„åç§°åº”è¯¥åŒä¸Šé¢å¤§æ‹¬å·ï¼ˆ { } ï¼‰ é‡Œé¢çš„åç§°ä¸€è‡´ã€‚å¹¶é€šè¿‡ in è¿™ä¸ªå±æ€§ï¼Œæ¥è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªè·¯å¾„ï¼ˆpathï¼‰å‚æ•°ã€‚ 123456parameters: - name: username in: path required: true description: The person's username type: string å®šä¹‰è·¯å¾„å‚æ•°æ—¶å¾ˆå®¹æ˜“å‡ºç°çš„é—®é¢˜å°±æ˜¯å¿˜è®°ï¼šrequired: trueï¼ŒSwaggerçš„è‡ªåŠ¨å®ŒæˆåŠŸèƒ½ä¸­æ²¡æœ‰åŒ…å«è¿™ä¸ªå±æ€§å®šä¹‰ã€‚ å¦‚æœæ²¡æœ‰å†™ require å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯ falseï¼Œä¹Ÿå°±æ˜¯è¯´ username å‚æ•°æ—¶å¯é€‰çš„ã€‚å¯äº‹å®ä¸Šï¼Œä½œä¸ºè·¯å¾„å‚æ•°ï¼Œå®ƒæ˜¯å¿…éœ€çš„ã€‚ 2.4.3 å®šä¹‰å“åº”æ¶ˆæ¯åˆ«å¿˜äº†è·å–å•ä¸ªç”¨æˆ·ä¿¡æ¯ä¹Ÿéœ€è¦å¡«å†™ 200 å“åº”æ¶ˆæ¯ï¼Œå“åº”æ¶ˆæ¯ä½“çš„å†…å®¹å°±æ˜¯ä¹‹å‰æè¿°è¿‡çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼‰ï¼š 12345678910111213responses: 200: description: A Person schema: required: - username properties: firstName: type: string lastName: type: string username: type: string å½“ç„¶ï¼ŒAPIçš„æä¾›è€…ä¼šå¯¹ username è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæŸ¥æ— æ­¤äººï¼Œåº”è¯¥è¿”å› 404 çš„å¼‚å¸¸çŠ¶æ€ã€‚æ‰€ä»¥æˆ‘ä»¬å†åŠ ä¸Š 404 çŠ¶æ€çš„å“åº”ï¼š 12404: description: The Person does not exists. 2.5 å®šä¹‰æ¶ˆæ¯ä½“å‚æ•°ï¼ˆbody parameterï¼‰å½“æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæä¾› post /persons çš„APIæ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. parameters: - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer responses: 200: description: A list of Person schema: type: array items: required: - username properties: firstName: type: string lastName: type: string username: type: string#START############################################################################ post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body description: The person to create. schema: required: - username properties: firstName: type: string lastName: type: string username: type: string responses: 204: description: Persons succesfully created. 400: description: Persons couldn't have been created.# END ############################################################################ /persons/&#123;username&#125;: get: summary: Gets a person description: Returns a single person for its username. parameters: - name: username in: path required: true description: The person's username type: string responses: 200: description: A Person schema: required: - username properties: firstName: type: string lastName: type: string username: type: string 404: description: The Person does not exists. 2.5.1 æ·»åŠ ä¸€ä¸ª post /persons æ“ä½œé¦–å…ˆåœ¨ /persons è·¯å¾„ä¸‹å»·åŠ ä¸€ä¸ª post æ“ä½œï¼š 12345paths: /persons: post: summary: Creates a person description: Adds a new person to the persons list. 2.5.2 å®šä¹‰æ¶ˆæ¯ä½“å‚æ•°æ¥ä¸‹æ¥æˆ‘ä»¬ç»™ post æ–¹æ³•æ·»åŠ å‚æ•°ï¼Œé€šè¿‡ in å±æ€§æ˜¾å¼è¯´æ˜å‚æ•°æ˜¯åœ¨ body ä¸­çš„ã€‚å‚æ•°çš„å®šä¹‰å‚è€ƒ get /persons/{username} çš„ 200 å“åº”æ¶ˆæ¯ä½“å‚æ•°ï¼Œä¹Ÿå°±æ˜¯åŒ…å«ç”¨æˆ·çš„å§“æ°ã€åå­—ã€ç”¨æˆ·åã€‚ 1234567891011121314parameters: - name: person in: body description: The person to create. schema: required: - username properties: firstName: type: string lastName: type: string username: type: string 2.5.3 å®šä¹‰å“åº”æ¶ˆæ¯æœ€åä¸è¦å¿˜è®°å®šä¹‰ post æ“ä½œçš„å“åº”æ¶ˆæ¯ã€‚ 12345responses: 204: description: Persons succesfully created. 400: description: Persons couldn't have been created. ä¸‰ã€æ–‡æ¡£ç˜¦èº«ç°åœ¨æˆ‘ä»¬å·²ç»å­¦ä¼šäº†ç¼–å†™APIæ–‡æ¡£çš„åŸºæœ¬æ–¹æ³•ã€‚ä¸è¿‡ä¸Šé¢çš„ä¾‹å­ä¸­å­˜åœ¨ä¸€äº›é‡å¤ï¼Œè¿™å¯¹äºç¨‹åºå‘˜çš„å—…è§‰æ¥è¯´ï¼Œå°±æ˜¯ä»£ç çš„â€œåå‘³é“â€ã€‚è¿™ä¸€ç« æˆ‘ä»¬ä¸€èµ·å­¦ä¹ å¦‚ä½•é€šè¿‡æŠ½å–å¯é‡ç”¨çš„å®šä¹‰ï¼ˆdefinitionsï¼‰æ¥ç®€åŒ–APIæ–‡æ¡£ã€‚ 3.1 ç®€åŒ–æ•°æ®æ¨¡å‹æˆ‘ä»¬è®¤çœŸè§‚å¯Ÿç¬¬2ç« æœ€åè¾“å‡ºçš„APIæ–‡æ¡£ï¼Œå¾ˆå®¹æ˜“å‘ç° Person çš„å®šä¹‰å‡ºç°äº†ä¸‰æ¬¡ï¼Œéå¸¸çš„ä¸ DRYâ˜¹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. parameters: - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer responses: 200: description: A list of Person schema: type: array items:#START ç¬¬1æ¬¡å®šä¹‰################################################################### required: - username properties: firstName: type: string lastName: type: string username: type: string# END ç¬¬1æ¬¡å®šä¹‰################################################################### post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body description: The person to create. schema:#START ç¬¬2æ¬¡å®šä¹‰################################################################### required: - username properties: firstName: type: string lastName: type: string username: type: string# END ç¬¬2æ¬¡å®šä¹‰################################################################### responses: 204: description: Persons succesfully created. 400: description: Persons couldn't have been created. /persons/&#123;username&#125;: get: summary: Gets a person description: Returns a single person for its username. parameters: - name: username in: path required: true description: The person's username type: string responses: 200: description: A Person schema:#START ç¬¬3æ¬¡å®šä¹‰################################################################### required: - username properties: firstName: type: string lastName: type: string username: type: string# END ç¬¬3æ¬¡å®šä¹‰################################################################### 404: description: The Person does not exists. ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡å¯é‡ç”¨çš„å®šä¹‰ ï¼ˆdefinitionï¼‰æ¥é‡æ„è¿™ä¸ªæ–‡æ¡£ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. parameters: - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer responses: 200: description: A list of Person schema:#START############################################################################ $ref: "#/definitions/Persons"# END ############################################################################ post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body description: The person to create. schema:#START############################################################################ $ref: "#/definitions/Person"# END ############################################################################ responses: 204: description: Persons succesfully created. 400: description: Persons couldn't have been created. /persons/&#123;username&#125;: get: summary: Gets a person description: Returns a single person for its username. parameters: - name: username in: path required: true description: The person's username type: string responses: 200: description: A Person schema:#START############################################################################ $ref: "#/definitions/Person"# END ############################################################################ 404: description: The Person does not exists.#START æ–°å¢å®šä¹‰####################################################################definitions: Person: required: - username properties: firstName: type: string lastName: type: string username: type: string Persons: type: array items: $ref: "#/definitions/Person"# END æ–°å¢å®šä¹‰#################################################################### æ–‡æ¡£ç®€åŒ–äº†å¾ˆå¤šã€‚è¿™å¾—ç›ŠäºOpenAPIè§„èŒƒä¸­å…³äºå®šä¹‰ï¼ˆdefinitionï¼‰çš„ç« èŠ‚ä¸­å…è®¸æˆ‘ä»¬â€œä¸€å¤„å®šä¹‰ï¼Œå¤„å¤„ä½¿ç”¨â€ã€‚ 3.1.1 æ·»åŠ å®šä¹‰ ï¼ˆdefinitionsï¼‰é¡¹æˆ‘ä»¬é¦–å…ˆåœ¨APIæ–‡æ¡£çš„å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå®šä¹‰ ï¼ˆdefinitionsï¼‰é¡¹ï¼ˆå…¶å®å®ƒä¹Ÿå¯ä»¥æ”¾åœ¨æ–‡æ¡£çš„ä»»æ„ä½ç½®ï¼Œåªä¸è¿‡å¤§å®¶ä¹ æƒ¯æ”¾åœ¨æ–‡æ¡£æœ«å°¾ï¼‰ï¼š 12345 404: description: The Person does not exists.#START############################################################################definitions:# END ############################################################################ 3.1.2 å¢åŠ ä¸€ä¸ªå¯é‡ç”¨çš„ï¼ˆå¯¹è±¡ï¼‰å®šä¹‰ç„¶åæˆ‘ä»¬å¢åŠ ä¸€ä¸ª Person å¯¹è±¡çš„å®šä¹‰ï¼š 12345678910111213definitions:#START############################################################################ Person: required: - username properties: firstName: type: string lastName: type: string username: type: string# END ############################################################################ 3.1.3 å¼•ç”¨ä¸€ä¸ªå®šä¹‰æ¥å¢åŠ å¦ä¸€ä¸ªå®šä¹‰åœ¨å®šä¹‰é¡¹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³å¼•ç”¨åˆšæ‰å®šä¹‰å¥½çš„ Person æ¥å¢åŠ å¦ä¸€ä¸ªå®šä¹‰ï¼ŒPersonsã€‚Persons æ˜¯ä¸€ä¸ª Person å¯¹è±¡çš„æ•°ç»„ã€‚ä¸ä¹‹å‰ç›´æ¥å®šä¹‰çš„ä¸åŒä¹‹å¤„æ˜¯ï¼Œæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªå¼•ç”¨ï¼ˆreferenceï¼‰å±æ€§ï¼Œä¹Ÿå°±æ˜¯ $ref æ¥å¼•ç”¨ Person ã€‚ 1234Persons: type: array items: $ref: "#/definitions/Person" 3.1.4 åœ¨å“åº”æ¶ˆæ¯ä¸­ä½¿ç”¨å®šä¹‰ä¸€æ—¦å®šä¹‰å¥½äº† Person ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåŸæ¥åœ¨å“åº”æ¶ˆæ¯ä¸­ç›¸åº”çš„å®šä¹‰å­—æ®µæ›¿æ¢æ‰ã€‚ 3.1.4.1 get/personsåŸæ¥ï¼š 12345678910111213responses: 200: description: A list of Person schema: type: array items: required: - username properties: firstName: type: string lastName: type: string ç°åœ¨ï¼š 12345responses: 200: description: A list of Person schema: $ref: "#/definitions/Persons" 3.1.4.2 get/persons/{username}åŸæ¥ï¼š 12345678910111213responses: 200: description: A Person schema: required: - username properties: firstName: type: string lastName: type: string username: type: string ç°åœ¨ï¼š 12345responses: 200: description: A Person schema: $ref: "#/definitions/Person" 3.1.5 åœ¨å‚æ•°ä¸­ä½¿ç”¨å®šä¹‰ä¸ä»…ä»…åœ¨æ¶ˆæ¯ä¸­å¯ä»¥ä½¿ç”¨å®šä¹‰ï¼Œåœ¨å‚æ•°ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ 3.1.5.1 post /personsåŸæ¥ï¼š 1234567891011121314151617post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body description: The person to create. schema: required: - username properties: firstName: type: string lastName: type: string username: type: string ç°åœ¨ï¼š 123456789post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body description: The person to create. schema: $ref: "#/definitions/Person" 3.2 ç®€åŒ–å“åº”æ¶ˆæ¯æˆ‘ä»¬çœ‹åˆ°äº†å¼•ç”¨ ï¼ˆ$refï¼‰çš„ä½œç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æŠŠå®ƒç”¨åˆ°å“åº”æ¶ˆæ¯çš„å®šä¹‰ä¸­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. parameters: - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer responses: 200: description: A list of Person schema: $ref: "#/definitions/Persons"#START############################################################################ 500: $ref: "#/responses/Standard500ErrorResponse"# END ############################################################################ post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body description: The person to create. schema: $ref: "#/definitions/Person" responses: 204: description: Persons succesfully created. 400: description: Persons couldn't have been created.#START############################################################################ 500: $ref: "#/responses/Standard500ErrorResponse"# END ############################################################################ /persons/&#123;username&#125;: get: summary: Gets a person description: Returns a single person for its username. parameters: - name: username in: path required: true description: The person's username type: string responses: 200: description: A Person schema: $ref: "#/definitions/Person" 404: description: The Person does not exists.#START############################################################################ 500: $ref: "#/responses/Standard500ErrorResponse"# END ############################################################################definitions: Person: required: - username properties: firstName: type: string lastName: type: string username: type: string Persons: type: array items: $ref: "#/definitions/Person"#START############################################################################ Error: properties: code: type: string message: type: stringresponses: Standard500ErrorResponse: description: An unexpected error occured. schema: $ref: "#/definitions/Error"# END ############################################################################ 3.2.1 å®šä¹‰å¯é‡ç”¨çš„HTTP 500 å“åº”å‘ç”ŸHTTP 500é”™è¯¯æ—¶ï¼Œå‡å¦‚æˆ‘ä»¬å¸Œæœ›æ¯ä¸€ä¸ªAPIæ“ä½œéƒ½è¿”å›ä¸€ä¸ªå¸¦æœ‰é”™è¯¯ç ï¼ˆerror codeï¼‰å’Œæè¿°ä¿¡æ¯ï¼ˆmessageï¼‰çš„å“åº”ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. parameters: - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer responses: 200: description: A list of Person schema: $ref: "#/definitions/Persons"#START############################################################################ 500: description: An unexpected error occured. schema: properties: code: type: string message: type: string# END ############################################################################ post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body description: The person to create. schema: $ref: "#/definitions/Person" responses: 204: description: Persons succesfully created. 400: description: Persons couldn't have been created.#START############################################################################ 500: description: An unexpected error occured. schema: properties: code: type: string message: type: string# END ############################################################################ /persons/&#123;username&#125;: get: summary: Gets a person description: Returns a single person for its username. parameters: - name: username in: path required: true description: The person's username type: string responses: 200: description: A Person schema: $ref: "#/definitions/Person" 404: description: The Person does not exists.#START############################################################################ 500: description: An unexpected error occured. schema: properties: code: type: string message: type: string# END ############################################################################ 3.2.2 å¢åŠ ä¸€ä¸ªErrorå®šä¹‰æŒ‰ç…§â€œä¸€å¤„å®šä¹‰ã€å¤„å¤„å¼•ç”¨â€çš„åŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®šä¹‰é¡¹ä¸­å¢åŠ  Error çš„å®šä¹‰ï¼š 1234567891011121314151617181920212223definitions: Person: required: - username properties: firstName: type: string lastName: type: string username: type: string Persons: type: array items: $ref: "#/definitions/Person"#START############################################################################ Error: properties: code: type: string message: type: string# END ############################################################################ è€Œä¸”æˆ‘ä»¬ä¹Ÿå­¦ä¼šäº†ä½¿ç”¨å¼•ç”¨ï¼ˆ$refï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. parameters: - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer responses: 200: description: A list of Person schema: $ref: "#/definitions/Persons" 500: description: An unexpected error occured. schema:#START############################################################################ $ref: "#/definitions/Error"# END ############################################################################ post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body description: The person to create. schema: $ref: "#/definitions/Person" responses: 204: description: Persons succesfully created. 400: description: Persons couldn't have been created. 500: description: An unexpected error occured. schema:#START############################################################################ $ref: "#/definitions/Error" # END ############################################################################ /persons/&#123;username&#125;: get: summary: Gets a person description: Returns a single person for its username. parameters: - name: username in: path required: true description: The person's username type: string responses: 200: description: A Person schema: $ref: "#/definitions/Person" 404: description: The Person does not exists. 500: description: An unexpected error occured. schema:#START############################################################################ $ref: "#/definitions/Error"# END ############################################################################ 3.2.3 å®šä¹‰ä¸€ä¸ªå¯é‡ç”¨çš„å“åº”æ¶ˆæ¯ä¸Šé¢çš„æ–‡æ¡£ä¸­ï¼Œè¿˜æ˜¯æœ‰ä¸€äº›é‡å¤çš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®OpenAPIè§„èŒƒä¸­çš„responsesç« èŠ‚çš„æè¿°ï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªå¯é‡ç”¨çš„å“åº”æ¶ˆæ¯ï¼Œæ¥è¿›ä¸€æ­¥ç®€åŒ–æ–‡æ¡£ã€‚ 12345678910111213141516171819202122232425262728definitions: Person: required: - username properties: firstName: type: string lastName: type: string username: type: string Persons: type: array items: $ref: "#/definitions/Person" Error: properties: code: type: string message: type: string#START############################################################################responses: Standard500ErrorResponse: description: An unexpected error occured. schema: $ref: "#/definitions/Error"# END ############################################################################ æ³¨æ„ï¼šå“åº”æ¶ˆæ¯ä¸­å¼•ç”¨äº† Error çš„å®šä¹‰ã€‚ 3.2.4 ä½¿ç”¨å·²å®šä¹‰çš„å“åº”æ¶ˆæ¯æˆ‘ä»¬è¿˜æ˜¯é€šè¿‡å¼•ç”¨ï¼ˆ$refï¼‰æ¥ä½¿ç”¨ä¸€ä¸ªå·²ç»å®šä¹‰å¥½çš„å“åº”æ¶ˆæ¯ï¼Œæ¯”å¦‚ï¼š 3.2.4.1 get /users123456789 responses: 200: description: A list of Person schema: $ref: "#/definitions/Persons"#START############################################################################ 500: $ref: "#/responses/Standard500ErrorResponse"# END ############################################################################ 3.2.4.2 post/users123456789 responses: 204: description: Persons succesfully created. 400: description: Persons couldn't have been created.#START############################################################################ 500: $ref: "#/responses/Standard500ErrorResponse"# END ############################################################################ 3.2.4.3 get/users/{username}1234567891011 responses: 200: description: A Person schema: $ref: "#/definitions/Person" 404: description: The Person does not exists.#START############################################################################ 500: $ref: "#/responses/Standard500ErrorResponse"# END ############################################################################ 3.3 ç®€åŒ–å‚æ•°å®šä¹‰ç±»ä¼¼æ•°æ®æ¨¡å‹ã€å“åº”æ¶ˆæ¯çš„ç®€åŒ–ï¼Œå‚æ•°å®šä¹‰çš„ç®€åŒ–ä¹Ÿå¾ˆå®¹æ˜“ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149swagger: "2.0"info: version: 1.0.0 title: Simple API description: A simple API to learn how to write OpenAPI Specificationschemes: - httpshost: simple.apibasePath: /openapi101paths: /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging.#START############################################################################ parameters: - $ref: "#/parameters/pageSize" - $ref: "#/parameters/pageNumber"# END ############################################################################ responses: 200: description: A list of Person schema: $ref: "#/definitions/Persons" 500: $ref: "#/responses/Standard500ErrorResponse" post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body description: The person to create. schema: $ref: "#/definitions/Person" responses: 204: description: Person succesfully created. 400: description: Person couldn't have been created. 500: $ref: "#/responses/Standard500ErrorResponse" /persons/&#123;username&#125;:#START############################################################################ parameters: - $ref: "#/parameters/username"# END ############################################################################ get: summary: Gets a person description: Returns a single person for its username. responses: 200: description: A Person schema: $ref: "#/definitions/Person" 404: $ref: "#/responses/PersonDoesNotExistResponse" 500: $ref: "#/responses/Standard500ErrorResponse" delete: summary: Deletes a person description: Delete a single person identified via its username responses: 204: description: Person successfully deleted. 404: $ref: "#/responses/PersonDoesNotExistResponse" 500: $ref: "#/responses/Standard500ErrorResponse" /persons/&#123;username&#125;/friends:#START############################################################################ parameters: - $ref: "#/parameters/username"# END ############################################################################ get: summary: Gets a person's friends description: Returns a list containing all persons. The list supports paging.#START############################################################################ parameters: - $ref: "#/parameters/pageSize" - $ref: "#/parameters/pageNumber"# END ############################################################################ responses: 200: description: A person's friends list schema: $ref: "#/definitions/Persons" 404: $ref: "#/responses/PersonDoesNotExistResponse" 500: $ref: "#/responses/Standard500ErrorResponse"definitions: Person: required: - username properties: firstName: type: string lastName: type: string username: type: string Persons: type: array items: $ref: "#/definitions/Person" Error: required: - code - message properties: code: type: string message: type: stringresponses: Standard500ErrorResponse: description: An unexpected error occured. schema: $ref: "#/definitions/Error" PersonDoesNotExistResponse: description: Person does not exist.#START############################################################################parameters: username: name: username in: path required: true description: The person's username type: string pageSize: name: pageSize in: query description: Number of persons returned type: integer pageNumber: name: pageNumber in: query description: Page number type: integer# END ############################################################################ 3.3.1 è·¯å¾„å‚æ•°åªå®šä¹‰ä¸€æ¬¡å¦‚æœæˆ‘ä»¬ç°åœ¨æƒ³è¦åˆ é™¤ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œå°±éœ€è¦å¢åŠ ä¸€ä¸ª delete /persons/{username} çš„æ“ä½œï¼Œå¯ä»¥è¿™æ ·ï¼š 123456789101112131415161718192021222324252627282930313233343536373839 /persons/&#123;username&#125;: get: summary: Gets a person description: Returns a single person for its username. parameters:#START############################################################################ - name: username in: path required: true description: The person's username type: string# END ############################################################################ responses: 200: description: A Person schema: $ref: "#/definitions/Person" 404: $ref: "#/responses/PersonDoesNotExistResponse" 500: $ref: "#/responses/Standard500ErrorResponse" delete: summary: Deletes a person description: Delete a single person identified via its username parameters:#START############################################################################ - name: username in: path required: true description: The person's username type: string# END ############################################################################ responses: 204: description: Person successfully deleted. 404: $ref: "#/responses/PersonDoesNotExistResponse" 500: $ref: "#/responses/Standard500ErrorResponse" ä½†æ˜¯ä¸Šé¢ä¸¤æ¬¡å¯¹å‚æ•° username çš„å®šä¹‰ï¼Œå´è®©äººæœ‰ç‚¹éš¾å—ã€‚å¥½æ¶ˆæ¯æ˜¯æˆ‘ä»¬å¯ä»¥å®šä¹‰è·¯å¾„çº§åˆ«çš„å‚æ•°ï¼ˆä¹‹å‰éƒ½æ˜¯å®šä¹‰åœ¨æ“ä½œçº§åˆ«ã€‚ï¼‰ 12345678910111213141516171819202122232425262728293031#START############################################################################ /persons/&#123;username&#125;: parameters: - name: username in: path required: true description: The person's username type: string# END ############################################################################ get: summary: Gets a person description: Returns a single person for its username. responses: 200: description: A Person schema: $ref: "#/definitions/Person" 404: $ref: "#/responses/PersonDoesNotExistResponse" 500: $ref: "#/responses/Standard500ErrorResponse" delete: summary: Deletes a person description: Delete a single person identified via its username responses: 204: description: Person successfully deleted. 404: $ref: "#/responses/PersonDoesNotExistResponse" 500: $ref: "#/responses/Standard500ErrorResponse" 3.3.2 å®šä¹‰å¯é‡ç”¨çš„å‚æ•°å¦‚æœæˆ‘ä»¬æƒ³æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾è¯¥ç”¨æˆ·çš„æœ‹å‹åœˆï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ª get /persons/{username}/friends çš„æ“ä½œã€‚æ ¹æ®å‰é¢æ‰€å­¦çš„å†…å®¹ï¼Œç¬¬ä¸€ååº”åº”è¯¥è¿™æ ·å†™ï¼š 12345678910111213141516171819202122232425262728/persons/&#123;username&#125;/friends: parameters: - name: username in: path required: true description: The person's username type: string get: summary: Gets a person's friends description: Returns a list containing all persons. The list supports paging. parameters: - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer responses: 200: description: A person's friends list schema: $ref: "#/definitions/Persons" 404: $ref: "#/responses/PersonDoesNotExistResponse" 500: $ref: "#/responses/Standard500ErrorResponse" å¯ä»¥çœ‹åˆ°ï¼Œå…³äº username ã€pageSize ã€pageNumber çš„å®šä¹‰è·Ÿå‰é¢çš„ /person/{username} ã€ get /persons ä¸­çš„å®šä¹‰é‡å¤ã€‚å¦‚ä½•æ¶ˆé™¤é‡å¤å‘¢ï¼Ÿ 3.3.2.1 å®šä¹‰å¯é‡ç”¨çš„å‚æ•°æ ¹æ®3.1å’Œ3.2ä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒOpenAPIè§„èŒƒï¼Œèæ±‡è´¯é€šã€‚ 1234567891011121314151617parameters: username: name: username in: path required: true description: The person's username type: string pageSize: name: pageSize in: query description: Number of persons returned type: integer pageNumber: name: pageNumber in: query description: Page number type: integer 3.3.2.2 ä½¿ç”¨å®šä¹‰å‚æ•°å€ŸåŠ©ä¸‡èƒ½çš„å¼•ç”¨ï¼ˆ$refï¼‰ï¼Œè¿™éƒ½æ˜¯å°èœä¸€ç¢Ÿã€‚æ¯”å¦‚ï¼š 3.3.2.2.1 get /personsåŸæ¥ï¼š 123456789101112131415 /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. parameters:#START############################################################################ - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer# END ############################################################################ ç°åœ¨ï¼š 123456789 /persons: get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. parameters:#START############################################################################ - $ref: "#/parameters/pageSize" - $ref: "#/parameters/pageNumber"# END ############################################################################ 3.3.2.2.2 get å’Œ delete /persons/{username}åŸæ¥ï¼š 123456789 /persons/&#123;username&#125;: parameters:#START############################################################################ - name: username in: path required: true description: The person's username type: string# END ############################################################################ ç°åœ¨ï¼š 12345 /persons/&#123;username&#125;: parameters:#START############################################################################ - $ref: "#/parameters/username"# END ############################################################################ 3.3.2.2.3 get /persons/{username}/friendsåŸæ¥ï¼š 1234567891011121314151617181920212223 /persons/&#123;username&#125;/friends: parameters:#START############################################################################ - name: username in: path required: true description: The person's username type: string# END ############################################################################ get: summary: Gets a person's friends description: Returns a list containing all persons. The list supports paging. parameters:#START############################################################################ - name: pageSize in: query description: Number of persons returned type: integer - name: pageNumber in: query description: Page number type: integer# END ############################################################################ ç°åœ¨ï¼š 12345678910111213 /persons/&#123;username&#125;/friends: parameters:#START############################################################################ - $ref: "#/parameters/username"# END ############################################################################ get: summary: Gets a person's friends description: Returns a list containing all persons. The list supports paging. parameters:#START############################################################################ - $ref: "#/parameters/pageSize" - $ref: "#/parameters/pageNumber"# END ############################################################################ å››ã€æ·±å…¥äº†è§£ä¸€ä¸‹é€šè¿‡å‰é¢çš„ç»ƒä¹ ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸€ç¯‡ç»“æ„æ¸…æ™°ã€å†…å®¹ç²¾ç‚¼çš„APIæ–‡æ¡£äº†ã€‚å¯æ˜¯OpenAPIè§„èŒƒè¿˜ç»™æˆ‘ä»¬æä¾›äº†æ›´å¤šçš„ä¾¿åˆ©å’ŒæƒŠå–œï¼Œç­‰ç€æˆ‘ä»¬å»äº†è§£å’ŒæŒæ¡ã€‚è¿™ä¸€ç« ä¸»è¦ä»‹ç»ç”¨äºå®šä¹‰å±æ€§å’Œæ•°æ®æ¨¡å‹çš„é«˜çº§æ–¹æ³•ã€‚ 4.1 ç§äººå®šåˆ¶ Primitive data types in the Swagger Specification are based on the types supported by the JSON-Schema Draft 4. Models are described using the Schema Object which is a subset of JSON Schema Draft 4. 4.1.1 å­—ç¬¦ä¸²ï¼ˆStringsï¼‰é•¿åº¦å’Œæ ¼å¼å½“å®šä¹‰ä¸ªå­—ç¬¦ä¸²å±æ€§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶å®ƒçš„é•¿åº¦åŠæ ¼å¼ï¼š å±æ€§ ç±»å‹ æè¿° minLength number å­—ç¬¦ä¸²æœ€å°é•¿åº¦ maxLength number å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ pattern string æ­£åˆ™è¡¨è¾¾å¼ ï¼Œå¦‚æœä½ æš‚æ—¶è¿˜ä¸ç†Ÿæ‚‰æ­£åˆ™è¡¨è¾¾å¼ å¦‚æœæˆ‘ä»¬è§„å®šç”¨æˆ·åæ˜¯é•¿åº¦ä»‹äº8~64ï¼Œè€Œä¸”åªèƒ½ç”±å°å†™å­—æ¯å’Œæ•°å­—æ¥æ„æˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š 12345username: type: string pattern: "[a-z0-9]&#123;8,64&#125;" minLength: 8 maxLength: 64 4.1.2 æ—¥æœŸå’Œæ—¶é—´æ—¥æœŸå’Œæ—¶é—´çš„å¤„ç†å‚è€ƒ RFC 3339ï¼Œæˆ‘ä»¬å”¯ä¸€è¦åšçš„å°±æ˜¯å†™å¯¹æ ¼å¼ï¼š æ ¼å¼ å±æ€§åŒ…å«å†…å®¹ å±æ€§ç¤ºä¾‹ date ISO8601 full-date 2016-04-01 dateTime ISO8601 date-time 2016-04-16T16:06:05Z å¦‚æœæˆ‘ä»¬åœ¨ Person çš„å®šä¹‰ä¸­å¢åŠ  ç”Ÿæ—¥ å’Œ ä¸Šæ¬¡ç™»å½•æ—¶é—´ æ—¶é—´æˆ³ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š 123456dateOfBirth: type: string format: datelastTimeOnline: type: string format: dateTime 4.1.3 æ•°å­—ç±»å‹å’ŒèŒƒå›´å½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ•°å­—ç±»å‹çš„å±æ€§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥[è§„å®š]å®ƒæ˜¯ä¸€ä¸ªæ•´å‹ã€é•¿å‹ã€æµ®ç‚¹å‹æˆ–è€…åŒæµ®ç‚¹å‹ã€‚ åç§° ç±»å‹ æ ¼å¼ integer integer int32 long integer int64 float number float double number double å’Œå­—ç¬¦ä¸²ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰æ•°å­—å±æ€§çš„èŒƒå›´ï¼Œæ¯”å¦‚ï¼š å±æ€§ ç±»å‹ æè¿° minimum number æœ€å°å€¼ maximum number æœ€å¤§å€¼ exclusiveMinimum boolean æ•°å€¼å¿…é¡» &gt; æœ€å°å€¼ exclusiveMaximum boolean æ•°å€¼å¿…é¡» &lt; æœ€å¤§å€¼ multipleOf number æ•°å€¼å¿…é¡»æ˜¯multipleOfçš„æ•´æ•°å€ å¦‚æœæˆ‘ä»¬è§„å®š pageSize å¿…é¡»æ˜¯æ•´æ•°ï¼Œå¿…é¡» &gt; 0 ä¸” &lt;=100ï¼Œè¿˜å¿…é¡»æ˜¯ 10 çš„æ•´æ•°å€ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š 1234567891011pageSize: name: pageSize in: query description: Number of persons returned type: integer format: int32 minimum: 0 exclusiveMinimum: true maximum: 100 exclusiveMaximum: false multipleOf: 10 4.1.4 æšä¸¾ç±»å‹æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰æšä¸¾ç±»å‹ï¼Œæ¯”å¦‚å®šä¹‰ Error æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š 123456code: type: string enum: - DBERR - NTERR - UNERR code çš„å€¼åªèƒ½ä»ä¸‰ä¸ªæšä¸¾å€¼ä¸­é€‰æ‹©ã€‚ 4.1.5 æ•°å€¼çš„å¤§å°å’Œå”¯ä¸€æ€§æ•°å­—çš„å¤§å°å’Œå”¯ä¸€æ€§é€šè¿‡ä¸‹é¢è¿™äº›å±æ€§æ¥å®šä¹‰ï¼š å±æ€§ ç±»å‹ æè¿° minItems number æ•°å€¼ä¸­çš„æœ€å°å…ƒç´ ä¸ªæ•° maxItem number æ•°å€¼ä¸­çš„æœ€å¤§å…ƒç´ ä¸ªæ•° uniqueItems boolean æ ‡ç¤ºæ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å¦å”¯ä¸€ æ¯”å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç”¨æˆ·æ•°ç»„ Personsï¼Œå¸Œæœ›è¿”å›çš„ç”¨æˆ·ä¿¡æ¯æ¡æ•°ä»‹äº10~100ä¹‹é—´ï¼Œè€Œä¸”ä¸èƒ½æœ‰é‡å¤çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š 123456789Persons: properties: items: type: array minItems: 10 maxItems: 100 uniqueItems: true items: $ref: "#/definitions/Person" 4.1.6 äºŒè¿›åˆ¶æ•°æ®å¯ä»¥ç”¨ string ç±»å‹æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®ï¼š æ ¼å¼ å±æ€§åŒ…å« byte Base64ç¼–ç å­—ç¬¦ binary ä»»æ„åè¿›åˆ¶çš„æ•°æ®åºåˆ— æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·ä¿¡æ¯ä¸­å¢åŠ ä¸€ä¸ªå¤´åƒå±æ€§ï¼ˆavatarBase64PNGï¼‰ç”¨base64ç¼–ç çš„PNGå›¾ç‰‡æ¥è¡¨ç¤ºï¼Œå¯ä»¥è¿™æ ·å†™ï¼š 123avatarBase64PNG: type: string format: byte 4.2 é«˜çº§æ•°æ®å®šä¹‰4.2.1 è¯»å†™æ“ä½œåŒä¸€å®šä¹‰çš„æ•°æ®æœ‰æ—¶å€™æˆ‘ä»¬è¯»å–èµ„æºä¿¡æ¯çš„å†…å®¹ä¼šæ¯”æˆ‘ä»¬å†™å…¥èµ„æºä¿¡æ¯çš„å†…å®¹ï¼ˆå±æ€§ï¼‰æ›´å¤šï¼Œè¿™å¾ˆå¸¸è§ã€‚æ˜¯ä¸æ˜¯æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ä¸“é—¨ä¸ºè¯»å–èµ„æºå’Œå†™å…¥èµ„æºåˆ†åˆ«å®šä¹‰ä¸åŒçš„æ•°æ®æ¨¡å‹å‘¢ï¼Ÿå¹¸è¿çš„æ˜¯ï¼ŒOpenAPIè§„èŒƒä¸­æä¾›äº† readOnlyå­—æ®µæ¥å¸®æˆ‘ä»¬è§£å†³æ•´é—®é¢˜ã€‚æ¯”å¦‚ï¼š 1234lastTimeOnline: type: string format: dateTime readOnly: true ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸Šæ¬¡åœ¨çº¿æ—¶é—´ï¼ˆlastTimeOnline ï¼‰æ˜¯ Person çš„ä¸€ä¸ªå±æ€§ï¼Œæˆ‘ä»¬è·å–ç”¨æˆ·ä¿¡æ¯æ—¶éœ€è¦è¿™ä¸ªå±æ€§ã€‚ä½†æ˜¯å¾ˆæ˜æ˜¾ï¼Œåœ¨åˆ›å»ºç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠè¿™ä¸ªå±æ€§ post åˆ°æœåŠ¡å™¨ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ ‡è®°ä¸º readOnlyã€‚ 4.2.2 ç»„åˆå®šä¹‰ç¡®ä¿ä¸€è‡´æ€§ä¸€è‡´æ€§è®¾è®¡æ˜¯åœ¨ç¼–å†™APIæ–‡æ¡£æ—¶éœ€è¦é‡ç‚¹è€ƒè™‘çš„é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨è·å–ä¸€ç»„ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œéœ€è¦åŒæ—¶è·å–é¡µé¢ä¿¡æ¯ï¼ˆ totalItems, totalPage, pageSize, currentPageï¼‰ç­‰ï¼Œè€Œä¸”è¿™äº›ä¿¡æ¯å¿…é¡»åœ¨æ ¹èŠ‚ç‚¹ä¸Šã€‚ æ€ä¹ˆåŠå‘¢ï¼Ÿé¦–å…ˆæƒ³åˆ°çš„åšæ³•å°±æ˜¯ï¼š 1234567891011121314PagedPersonsV1: properties: items: type: array items: $ref: "#/definitions/Person" totalItems: type: integer totalPages: type: integer pageSize: type: integer currentPage: type: integer å¦‚æœå…¶ä»–APIæ“ä½œä¹Ÿéœ€è¦è¿™äº›é¡µé¢ä¿¡æ¯ï¼Œé‚£å°±æ„å‘³ç€è¿™äº›å±æ€§å¿…é¡»ä¸€éåˆä¸€éçš„å®šä¹‰ã€‚ä¸ä»…é‡å¤ä½“åŠ›åŠ³åŠ¨ï¼Œè€Œä¸”è¿˜å¾ˆå±é™©ï¼šæ¯”å¦‚å¿˜è®°äº†å…¶ä¸­çš„ä¸€ä¸¤ä¸ªå±æ€§ï¼Œæˆ–è€…éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„å±æ€§è¿›æ¥ï¼Œé‚£å°±æ˜¯éœ°å¼¹å¼çš„ä¿®æ”¹ï¼Œæƒ³æƒ³éƒ½å¾ˆæ‚²å£®ã€‚ ç¨å¾®å¥½ä¸€ç‚¹çš„åšæ³•ï¼Œå°±æ˜¯æ ¹æ®å‰é¢å­¦ä¹ çš„å†…å®¹ï¼ŒæŠŠè¿™å‡ ä¸ªå±æ€§æŠ½å–å‡ºæ¥ï¼Œå»ºç«‹ä¸€ä¸ª Paging æ¨¡å‹ï¼Œâ€œä¸€å¤„å®šä¹‰ã€å¤„å¤„ä½¿ç”¨â€ï¼š 12345678910111213141516171819PagedPersonsV2: properties: items: type: array items: $ref: "#/definitions/Person" paging: $ref: "#/definitions/Paging"Paging: properties: totalItems: type: integer totalPages: type: integer pageSize: type: integer currentPage: type: integer ä½†æ˜¯ï¼Œé¡µé¢å±æ€§éƒ½ä¸å†ä½äº æ ¹èŠ‚ç‚¹ï¼ä¸æˆ‘ä»¬å‰é¢è®¾å®šçš„è¦æ±‚ä¸ä¸€æ ·äº†ã€‚æ€ä¹ˆç ´ï¼Ÿ JSON Schema v4 propertyä¸­å®šä¹‰çš„allOfï¼Œèƒ½å¸®æˆ‘ä»¬è§£å›´ï¼š 1234PagedPersons: allOf: - $ref: "#/definitions/Persons" - $ref: "#/definitions/Paging" ä¸Šé¢è¿™ä¸ªä¾‹å­è¡¨ç¤ºï¼ŒPagedPersons æ ¹èŠ‚ç‚¹ä¸‹ï¼Œå…·æœ‰å°† Persons å’Œ Paging å±•å¼€ åçš„å…¨éƒ¨å±æ€§ã€‚ allOfåŒæ ·å¯ä»¥ä½¿ç”¨è¡Œå†…çš„æ•°æ®å®šä¹‰ï¼Œæ¯”å¦‚ï¼š 1234567891011PagedCollectingItems: allOf: - properties: items: type: array minItems: 10 maxItems: 100 uniqueItems: true items: $ref: "#/definitions/CollectingItem" - $ref: "#/definitions/Paging" 4.2.3 æ•°æ®æ¨¡å‹çš„ç»§æ‰¿ï¼ˆTODOï¼‰ç›®å‰å„å·¥å…·æ”¯æŒç¨‹åº¦ä¸é«˜ï¼Œå¾…ç»­ äº”ã€ è¾“å…¥è¾“å‡ºæ¨¡å‹è¿™ä¸€ç« ä¸»è¦ä»‹ç»å¦‚ä½•å®šä¹‰é«˜åº¦ç²¾ç¡®åŒ–çš„å‚æ•°å’Œå“åº”æ¶ˆæ¯ç­‰ã€‚ 5.1 é«˜çº§å‚æ•°å®šä¹‰5.1.1 å¿…å¸¦å‚æ•°å’Œå¯é€‰å‚æ•°æˆ‘ä»¬å·²ç»çŸ¥é“ä½¿ç”¨å…³é”®å­—requiredæ¥å®šä¹‰ä¸€ä¸ªå¿…å¸¦å‚æ•°ã€‚ 5.1.1.1 å®šä¹‰å¿…å¸¦å‚æ•°å’Œå¯é€‰å‚æ•°åœ¨ä¸€ä¸ªå‚æ•°ä¸­ï¼Œrequiredæ˜¯ä¸€ä¸ª boolean å‹çš„å¯é€‰å€¼ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯ false ã€‚ æ¯”å¦‚åœ¨æŸä¸ªæ“ä½œä¸­ï¼Œusername æ˜¯å¿…å¡«å‚æ•°ï¼š 12345678 username: name: username in: path#START############################################################################ required: true# END ############################################################################ description: The person's username type: string 5.1.1.2 å®šä¹‰å¿…å¸¦å±æ€§å’Œå¯é€‰å±æ€§æ ¹æ®å®šä¹‰ï¼Œrequiredæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­åŒ…å«å„å¿…å¸¦å‚æ•°åã€‚å¦‚æœæŸä¸ªå‚æ•°åœ¨è¿™å¼ åˆ—è¡¨ä¸­æ‰¾ä¸åˆ°ï¼Œé‚£å°±è¯´æ˜å®ƒä¸æ˜¯å¿…å¸¦å‚æ•°ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰requiredï¼Œå°±è¯´æ˜æ‰€æœ‰å‚æ•°éƒ½æ˜¯å¯é€‰ã€‚å¦‚æœrequiredå®šä¹‰åœ¨ä¸€ä¸ªHTTPè¯·æ±‚ä¸Šï¼Œè¿™è¯´æ˜æ‰€æœ‰çš„è¯·æ±‚å‚æ•°éƒ½æ˜¯å¿…å¡«ã€‚ åœ¨ POST ã€persons ä¸­æœ‰ Person çš„å®šä¹‰ï¼Œåœ¨è¿™é‡Œ username è¿™ä¸ªå±æ€§æ˜¯å¿…å¸¦çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šå®ƒä¸ºrequiredï¼Œå…¶ä»–éå¿…å¸¦å­—æ®µåˆ™ä¸æŒ‡å®šï¼š 12345678910111213141516171819202122232425262728 Person:#START############################################################################ required: - username# END ############################################################################ properties: firstName: type: string lastName: type: string username: type: string pattern: '[a-z0-9]&#123;8,64&#125;' minLength: 8 maxLength: 64 dateOfBirth: type: string format: date lastTimeOnline: type: string format: date-time readOnly: true avatarBase64PNG: type: string format: byte default: data:image/png;base64,iâ€¦â€¦ spokenLanguages: $ref: '#/definitions/SpokenLanguages' 5.1.2 å¸¦é»˜è®¤å€¼çš„å‚æ•°é€šè¿‡å…³é”®å­—defaultï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå‚æ•°çš„é»˜è®¤å€¼ã€‚å½“è¿™ä¸ªå‚æ•°ä¸å¯å¾—ï¼ˆè¯·æ±‚æœªå¸¦æˆ–è€…æœåŠ¡å™¨æœªè¿”å›ï¼‰æ—¶ï¼Œè¿™ä¸ªå‚æ•°å°±å–é»˜è®¤å€¼ã€‚å› æ­¤è®¾å®šäº†æŸä¸ªå‚æ•°çš„é»˜è®¤å€¼åï¼Œå®ƒæ˜¯å¦requiredå°±æ²¡æ„ä¹‰äº†ã€‚ 5.1.2.1 å®šä¹‰å‚æ•°çš„é»˜è®¤å€¼æˆ‘ä»¬å®šä¹‰å‚æ•° pageSize çš„é»˜è®¤å€¼ä¸º 20 ï¼Œé‚£ä¹ˆå¦‚æœè¯·æ±‚æ—¶æ²¡æœ‰å¡«å†™ pageSize ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šé»˜è®¤è¿”å› 20 ä¸ªå…ƒç´ ã€‚ 1234567891011121314 pageSize: name: pageSize in: query description: Number of persons returned type: integer format: int32 minimum: 0 exclusiveMinimum: true maximum: 100 exclusiveMaximum: false multipleOf: 10#START############################################################################ default: 20# END ############################################################################ 5.1.2.2 å®šä¹‰å±æ€§çš„é»˜è®¤å€¼æˆ‘ä»¬åœ¨å®šä¹‰ Person å¯¹è±¡æ—¶ï¼Œå¸Œæœ›ç»™æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªé»˜è®¤å¤´åƒï¼Œä¹Ÿå°±æ˜¯è¦ç»™ avatarBase64PNG å±æ€§ä¸€ä¸ªé»˜è®¤å€¼ã€‚ é»˜è®¤å¤´åƒ: â€¦ 12345678910111213141516171819202122232425262728 Person: required: - username properties: firstName: type: string lastName: type: string username: type: string pattern: '[a-z0-9]&#123;8,64&#125;' minLength: 8 maxLength: 64 dateOfBirth: type: string format: date lastTimeOnline: type: string format: date-time readOnly: true avatarBase64PNG: type: string format: byte#START############################################################################ default: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAâ€¦â€¦rkJggg==# END ############################################################################ spokenLanguages: $ref: '#/definitions/SpokenLanguages' 5.1.3 å¸¦ç©ºå€¼çš„å‚æ•°åœ¨ GET /persons æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ ä¸€ä¸ªå‚æ•°æ¥è¿‡æ»¤â€œæ˜¯å¦é€šè¿‡å®åè®¤è¯â€çš„ç”¨æˆ·ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé¦–å…ˆæƒ³åˆ°çš„æ˜¯è¿™æ ·ï¼šGET /persons?page=2&amp;includeVerifiedUsers=true ï¼Œé—®é¢˜æ˜¯ includeVerifiedUsers è¯­ä¹‰å·²ç»å¦‚æ­¤æ¸…æ™°ï¼Œè€Œè®© â€œ=trueâ€æ˜¾å¾—å¾ˆå¤šä½™ã€‚æˆ‘ä»¬èƒ½ä¸èƒ½ç›´æ¥ç”¨ï¼šGET /persons?page=2&amp;includeVerifiedUsers å‘¢ï¼Ÿ è¦åšåˆ°è¿™ç§å†™æ³•ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…³é”®å­— allowEmptyValueã€‚æˆ‘ä»¬å®šä¹‰ includeVerifiedUsers æ—¶å…è®¸å®ƒä¸ºç©ºã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¯·æ±‚ GET /persons?page=2&amp;includeVerifiedUsers åˆ™è¡¨ç¤ºéœ€è¦è¿‡æ»¤â€œå®åè®¤è¯â€ç”¨æˆ·ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥è¯·æ±‚ GET /persons?page=2 åˆ™è¡¨ç¤ºä¸è¿‡æ»¤ï¼š 12345678 includeNonVerifiedUsers: name: includeNonVerifiedUsers in: query type: boolean default: false#START############################################################################ allowEmptyValue: true# END ############################################################################ 5.1.4 å‚æ•°ç»„è®¾è®¡APIçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°åœ¨ GET è¯·æ±‚ä¸­éœ€è¦æºå¸¦ä¸€ç»„è¯·æ±‚å‚æ•°çš„æƒ…å†µã€‚å¦‚ä½•åœ¨APIæ–‡æ¡£ç« å‘ˆç°å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦è®¾å®šå‚æ•°ç±»å‹ï¼ˆtypeï¼‰ ä¸ºarrayï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ ç»„åˆæ ¼å¼ï¼ˆcollectionFormatï¼‰å°±è¡Œäº†ã€‚ COLLECTIONFORMAT æè¿° csv (default value) Comma separated valuesï¼ˆé€—å·åˆ†éš”ï¼‰ foo,bar ssv Space separated valuesï¼ˆç©ºæ ¼åˆ†éš”ï¼‰ foo bar tsv Tab separated valuesï¼ˆåæ–œæ åˆ†éš”ï¼‰ foo\tbar pipes Pipes separated valuesï¼ˆç«–çº¿åˆ†éš”ï¼‰ `foo\ bar` multi å•å±æ€§å¯ä»¥å–å¤šä¸ªå€¼ï¼Œæ¯”å¦‚ foo=bar&amp;foo=baz. åªé€‚ç”¨äºæŸ¥è¯¢å‚æ•°å’Œè¡¨å•å‚æ•°ã€‚ æ¯”å¦‚æˆ‘ä»¬æƒ³æ ¹æ®å¤šç§å‚æ•°ï¼ˆusername ï¼Œ firstname ï¼Œ lastname ï¼Œ lastTimeOnline ï¼‰ç­‰æ¥å¯¹ Person è¿›è¡Œå¸¦æ’åºçš„æŸ¥è¯¢ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¿™æ ·çš„APIè¯·æ±‚ï¼š GET /persons?sort=-lastTimeOnline|+firtname|+lastname ã€‚ç”¨äºæ’åºçš„å‚æ•°æ˜¯ sort ï¼Œ+è¡¨ç¤ºå‡åºï¼Œ-è¡¨ç¤ºé™åºã€‚ ç›¸åº”çš„APIæ–‡æ¡£ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š 1234567891011sortPersons: name: sort in: query type: array uniqueItems: true minItems: 1 maxItems: 3 collectionFormat: pipes items: type: string pattern: '[-+](username|lastTimeOnline|firstname|lastname)' ç°åœ¨æˆ‘ä»¬å°±èƒ½æå®š GET /persons?sort=-lastTimeOnline|+firtname|+lastname è¿™ç§è¯·æ±‚äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šæ’åºçš„é»˜è®¤å€¼ï¼Œé”¦ä¸Šæ·»èŠ±ã€‚ 12345678910111213141516 sortPersons: name: sort in: query type: array uniqueItems: true minItems: 1 maxItems: 3 collectionFormat: pipes items: type: string pattern: '[-+](username|lastTimeOnline|firstname|lastname)'#START############################################################################ default: - -lastTimeOnline - +username# END ############################################################################ 5.1.5 æ¶ˆæ¯å¤´ï¼ˆHeaderï¼‰å‚æ•°å‚æ•°ï¼ŒæŒ‰ç…§ä½ç½®æ¥åˆ†ï¼Œä¸ä»…ä»…åŒ…å«è·¯å¾„å‚æ•°ã€è¯·æ±‚å‚æ•°å’Œæ¶ˆæ¯ä½“å‚æ•°ï¼Œè¿˜åŒ…æ‹¬æ¶ˆæ¯å¤´å‚æ•°å’Œè¡¨å•å‚æ•°ç­‰ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨HTTPè¯·æ±‚çš„æ¶ˆæ¯å¤´ä¸ŠåŠ ä¸€ä¸ª User-Agent ï¼ˆç”¨äºè·Ÿè¸ªã€è°ƒè¯•æˆ–è€…å…¶ä»–ï¼‰ï¼Œå¯ä»¥è¿™æ ·å®šä¹‰å®ƒï¼š 12345userAgent: name: User-Agent type: string in: header required: true ç„¶ååƒä½¿ç”¨å…¶ä»–å‚æ•°ä¸€æ ·ä½¿ç”¨å®ƒï¼š 1234paths: /persons: parameters: - $ref: '#/parameters/userAgent' 5.1.6 è¡¨å•å‚æ•°æœ‰äº› js-less-browser çš„è€æµè§ˆå™¨ä¸æ”¯æŒ POST JSONæ•°æ®ï¼Œæ¯”å¦‚åœ¨åˆ›å»ºç”¨æˆ·æ—¶ï¼Œåªèƒ½å¤Ÿä»¥è¿™æ ·ä¸ªæ ¼å¼è¯·æ±‚ï¼š 123POST /js-less-personsusername=apihandyman&amp;firstname=API&amp;lastname=Handyman æ²¡æœ‰é—®é¢˜ï¼Œä¸è¢œå“¥å¯ä»¥æå®šã€‚æˆ‘ä»¬åªéœ€è¦æŠŠå„ä¸ªå±æ€§çš„inå…³é”®å­—å®šä¹‰ä¸ºformDataï¼Œç„¶åè®¾ç½®consumesçš„åª’ä½“ç±»å‹ä¸ºapplication/x-www-form-urlencodedå³å¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536 post: summary: Creates a person description: For JS-less partners#START############################################################################ consumes: - application/x-www-form-urlencoded# END ############################################################################ produces: - text/html parameters: - name: username#START############################################################################ in: formData# END ############################################################################ required: true pattern: '[a-z0-9]&#123;8,64&#125;' minLength: 8 maxLength: 64 type: string - name: firstname#START############################################################################ in: formData# END ############################################################################ type: string - name: lastname in: formData type: string - name: dateOfBirth#START############################################################################ in: formData# END ############################################################################ type: string format: date responses: '204': description: Person succesfully created. 5.1.7 æ–‡ä»¶å‚æ•°å½“æˆ‘ä»¬è¦å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œè¾“å…¥ç±»å‹æ˜¯ æ–‡ä»¶ æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ï¼š ä½¿ç”¨ multipart/form-data åª’ä½“ç±»å‹ï¼› è®¾ç½®å‚æ•°çš„ inå…³é”®å­—ä¸º formDataï¼› è®¾ç½®å‚æ•°çš„ç±»å‹ï¼ˆtypeï¼‰ä¸º fileã€‚ æ¯”å¦‚ï¼š 123456789101112131415161718/images: parameters: - $ref: '#/parameters/userAgent' post: summary: Uploads an image consumes: - multipart/form-data parameters: - name: image in: formData type: file responses: '200': description: Image's ID schema: properties: imageId: type: string æœ‰æ—¶å€™æˆ‘ä»¬æƒ³é™å®šè¾“å…¥æ–‡ä»¶çš„ç±»å‹ï¼ˆåç¼€ï¼‰ï¼Œå¾ˆä¸å¹¸çš„æ˜¯ï¼Œæ ¹æ®ç°åœ¨V2.0çš„è§„èŒƒæš‚æ—¶è¿˜åšä¸åˆ°â˜¹ The spec doesnâ€™t allow specifying a content type for specific form data parameters. Itâ€™s a limitation of the spec. Ron Ratovsky comment in Swagger UI 609 issue 5.1.8 å‚æ•°çš„åª’ä½“ç±»å‹ä¸€ä¸ªAPIå¯ä»¥æ¶ˆè´¹å„ç§ä¸åŒçš„åª’ä½“ç±»å‹ï¼Œæ¯”å¦‚è¯´æœ€å¸¸è§çš„æ˜¯ application/json ç±»å‹çš„æ•°æ®ï¼Œå½“ç„¶è¿™ä¸æ˜¯APIå”¯ä¸€æ”¯æŒçš„ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ–‡æ¡£çš„æ ¹èŠ‚ç‚¹ æˆ–è€…ä¸€ä¸ªæ“ä½œçš„æ ¹èŠ‚ç‚¹ ä¸‹æ·»åŠ å…³é”®å­— consumesï¼Œæ¥å®šä¹‰è¿™ä¸ªæ“ä½œèƒ½å¤Ÿæ¶ˆè´¹çš„åª’ä½“ç±»å‹ã€‚ æ¯”å¦‚æˆ‘ä»¬çš„APIå…¨éƒ¨éƒ½æ¥å—JSONå’ŒYAMLçš„æ•°æ®ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨æ–‡æ¡£çš„æ ¹èŠ‚ç‚¹ä¸‹æ·»åŠ ï¼š 123consumes: - application/json - application/x-yaml å¦‚æœæŸä¸ªæ“ä½œï¼ˆæ¯”å¦‚ä¸Šä¼ å›¾ç‰‡çš„æ“ä½œï¼‰å¾ˆç‰¹æ®Šï¼Œå®ƒå¯ä»¥é€šè¿‡è‡ªå·±æ·»åŠ  consumesæ¥è¦†ç›–å…¨å±€è®¾ç½®ï¼š 1234567891011121314151617181920 /images: parameters: - $ref: '#/parameters/userAgent' post: summary: Uploads an image#START############################################################################ consumes: - multipart/form-data# END ############################################################################ parameters: - name: image in: formData type: file responses: '200': description: Image's ID schema: properties: imageId: type: string 5.2 é«˜çº§å“åº”æ¶ˆæ¯å®šä¹‰5.2.1 ä¸å¸¦æ¶ˆæ¯ä½“çš„å“åº”æ¶ˆæ¯ä¸å¸¦æ¶ˆæ¯ä½“çš„å“åº”å¾ˆå¸¸è§ï¼Œæ¯”å¦‚HTTP 204 çŠ¶æ€å“åº”æœ¬èº«å°±è¡¨ç¤ºæœåŠ¡å™¨è¿”å›ä¸å¸¦ä»»ä½•æ¶ˆæ¯å†…å®¹çš„æˆåŠŸæ¶ˆæ¯ã€‚ è¦å®šä¹‰ä¸€ä¸ªä¸å¸¦æ¶ˆæ¯ä½“çš„å“åº”å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å†™å“åº”çŠ¶æ€å’Œæè¿°å°±è¡Œäº†ï¼š 123456789101112131415 post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body required: true description: The person to create. schema: $ref: '#/definitions/Person' responses:#START############################################################################ '204': description: Person succesfully created.# END ############################################################################ 5.2.2 å“åº”æ¶ˆæ¯ä¸­çš„å¿…å¸¦å‚æ•°å’Œå¯é€‰å‚æ•°ä¸è¯·æ±‚æ¶ˆæ¯ä¸­ç±»ä¼¼ï¼Œæˆ‘ä»¬ä½¿ç”¨requiredå‚æ•°æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚è¯·æ±‚ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œ æœåŠ¡å™¨å¿…é¡»è¿”å›usernameï¼Œå¯ä»¥è¿™æ ·å†™ï¼š 12345678910111213141516171819202122 Person:#START############################################################################ required: - username# END ############################################################################ properties: firstName: type: string lastName: type: string username: type: string pattern: '[a-z0-9]&#123;8,64&#125;' minLength: 8 maxLength: 64 dateOfBirth: type: string format: date lastTimeOnline: type: string format: date-time readOnly: true 5.2.3 å“åº”æ¶ˆæ¯å¤´APIçš„è¿”å›ç»“æœä¸ä»…ä»…ä½“ç°ä¸‹HTTPçŠ¶æ€å’Œå“åº”æ¶ˆæ¯ä½“ï¼Œè¿˜å¯ä»¥åœ¨å“åº”æ¶ˆæ¯å¤´ä¸Šåšæ–‡ç« ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥é™å®šä¸€ä¸ªAPIçš„ä½¿ç”¨æ¬¡æ•°å’Œä½¿ç”¨æ—¶é—´æ®µï¼Œåœ¨å“åº”æ¶ˆæ¯å¤´ä¸­ï¼Œå¢åŠ ä¸€ä¸ªå±æ€§X-Rate-Limit-Remaining æ¥è¡¨ç¤ºAPIå¯è°ƒç”¨çš„å‰©ä½™æ¬¡æ•°ï¼Œå¢åŠ å¦ä¸€ä¸ªå±æ€§ X-Rate-Limit-Reset æ¥è¡¨ç¤ºAPIçš„æœ‰æ•ˆæˆªæ­¢æ—¶é—´ã€‚ 123456789101112131415161718192021 post: summary: Creates a person description: Adds a new person to the persons list. parameters: - name: person in: body required: true description: The person to create. schema: $ref: '#/definitions/Person' responses: '204': description: Person succesfully created. headers:#START############################################################################ X-Rate-Limit-Remaining: type: integer X-Rate-Limit-Reset: type: string format: date-time# END ############################################################################ ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼Œå¯¹äºè¿™ç§å“åº”æ¶ˆæ¯å¤´çš„ä¿®æ”¹ï¼Œç›®å‰2.0è§„èŒƒæš‚æ—¶è¿˜ä¸æ”¯æŒâ€œä¸€æ¬¡å®šä¹‰ã€å¤„å¤„ä½¿ç”¨â€â˜¹ 5.2.4 é»˜è®¤å“åº”æ¶ˆæ¯æˆ‘ä»¬åœ¨å®šä¹‰å“åº”æ¶ˆæ¯æ—¶ï¼Œé€šå¸¸ä¼šåˆ—ä¸¾ä¸åŒçš„HTTPçŠ¶æ€ç»“æœã€‚å¦‚æœæœ‰äº›çŠ¶æ€ä¸åœ¨æˆ‘ä»¬APIæ–‡æ¡£çš„å®šä¹‰èŒƒå›´ï¼ˆæ¯”å¦‚æœåŠ¡å™¨éœ€è¦è¿”å› 993 çš„çŠ¶æ€ï¼‰ï¼Œè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿè¿™æ—¶éœ€è¦é€šè¿‡å…³é”®å­—defaultæ¥å®šä¹‰ä¸€ä¸ªé»˜è®¤å“åº”æ¶ˆæ¯ï¼Œç”¨äºå„ç§å®šä¹‰ä¹‹å¤–çš„çŠ¶æ€å“åº”ï¼Œæ¯”å¦‚ï¼š 1234567891011121314151617181920 delete: summary: Deletes a person description: Delete a single person identified via its username responses: '204': description: Person successfully deleted. headers: X-Rate-Limit-Remaining: type: integer X-Rate-Limit-Reset: type: string format: date-time '404': $ref: '#/responses/PersonDoesNotExistResponse' '500': $ref: '#/responses/Standard500ErrorResponse'#START############################################################################ default: $ref: '#/responses/TotallyUnexpectedResponse'# END ############################################################################ ç›®å‰è¿™ä¸ªé…ç½®ä¹Ÿä¸æ”¯æŒâ€œä¸€æ¬¡å®šä¹‰ï¼Œå¤„å¤„ä½¿ç”¨â€ ã€‚â˜¹ 5.2.5 å“åº”æ¶ˆæ¯çš„åª’ä½“ç±»å‹ä¸è¯·æ±‚æ¶ˆæ¯ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰å“åº”æ¶ˆæ¯æ‰€æ”¯æŒçš„åª’ä½“ç±»å‹ï¼Œä¸åŒçš„æ˜¯æˆ‘ä»¬è¦ç”¨åˆ°å…³é”®å­— producesï¼ˆä¸è¯·æ±‚æ¶ˆæ¯ä¸­çš„consumesç›¸å¯¹ï¼Œç”±æ­¤å¯è§ï¼ŒAPIæ–‡æ¡£æè¿°çš„ä¸»ä½“æ˜¯æœåŠ¡æä¾›è€…ï¼‰ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–‡æ¡£çš„æ ¹è·¯å¾„ä¸‹å…¨å±€è®¾ç½®ï¼š 123produces: - application/json - application/x-yaml ä¹Ÿå¯ä»¥åœ¨æŸä¸ªæ“ä½œçš„æ ¹è·¯å¾„ä¸‹è¦†ç›–è®¾ç½®ï¼š 123456789101112131415161718192021222324252627282930313233343536373839 /images/&#123;imageId&#125;: parameters: - $ref: '#/parameters/userAgent' get: summary: Gets an image parameters: - name: imageId in: path required: true type: string#START############################################################################ produces: - image/png - image/gif - image/jpeg - application/json - application/x-yaml# END ############################################################################ responses: '200': description: The image headers: X-Rate-Limit-Remaining: type: integer X-Rate-Limit-Reset: type: string format: date-time '404': description: Image do not exists headers: X-Rate-Limit-Remaining: type: integer X-Rate-Limit-Reset: type: string format: date-time '500': $ref: '#/responses/Standard500ErrorResponse' default: $ref: '#/responses/TotallyUnexpectedResponse' 5.3 å®šä¹‰æŸä¸ªå‚æ•°åªå­˜åœ¨äºå“åº”æ¶ˆæ¯ä¸­å¦‚å‰ç« èŠ‚4.2.1ä¸­å·²ç»æåˆ°çš„ï¼Œå®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­æŸä¸ªå±æ€§æˆ‘ä»¬åªå¸Œæœ›åœ¨å“åº”æ¶ˆæ¯ä¸­æºå¸¦ï¼Œè€Œä¸å¸Œæœ›åœ¨è¯·æ±‚æ¶ˆæ¯ä¸­æºå¸¦ï¼Œåº”è¯¥ç”¨readOnlyå…³é”®å­—æ¥è¡¨ç¤ºã€‚è€ƒè™‘åˆ°å†…å®¹çš„å®Œæ•´æ€§ï¼Œè¿™é‡Œå†ä»‹ç»ä¸€ä¸‹ã€‚ æ¯”å¦‚ Person å¯¹è±¡ä¸­çš„ lastTimeOnline è¿™ä¸ªå±æ€§ï¼Œæ³¨å†Œç”¨æˆ·æ—¶æˆ‘ä»¬ä¸éœ€è¦å¡«å†™ï¼Œä½†æ˜¯åœ¨è·å–ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œéœ€è¦æä¾›ç»™æœåŠ¡æ¶ˆè´¹è€…ï¼š 12345678910111213141516171819202122 Person: required: - username properties: firstName: type: string lastName: type: string username: type: string pattern: '[a-z0-9]&#123;8,64&#125;' minLength: 8 maxLength: 64 dateOfBirth: type: string format: date lastTimeOnline: type: string format: date-time#START############################################################################ readOnly: true# END ############################################################################ å…­ã€ ä¸è¦è®©APIè£¸å¥”è¿™ä¸€ç« ä¸»è¦ä»‹ç»APIæ–‡æ¡£ä¸­å¦‚ä½•æè¿°å®‰å…¨ç›¸å…³çš„å†…å®¹ã€‚ 6.1 å®šä¹‰å®‰å…¨å®‰å…¨ç›¸å…³å†…å®¹çš„å®šä¹‰ä¸€èˆ¬æ”¾åœ¨APIæ–‡æ¡£æ ¹ç›®å½•ä¸‹çš„securityDefinition ä¸­ï¼Œå®ƒåŒ…æ‹¬ä¸€ç»„å…·ä½“çš„å‘½åå®‰å…¨é¡¹ï¼Œæ¯ä¸€ä¸ªå‘½åå®‰å…¨å®šä¹‰å¯èƒ½åŒ…æ‹¬ä¸‹é¢ä¸‰ç§å®‰å…¨ç±»å‹ä¹‹ä¸€ï¼šbasicï¼ŒapiKey ï¼Œoauth2ã€‚ 6.1.1 åŸºç¡€é‰´æƒï¼ˆBasic Authenticationï¼‰è¦å®šä¹‰ä¸€ä¸ªåŸºç¡€ï¼ˆbasicï¼‰ é‰´æƒï¼Œæˆ‘ä»¬åªéœ€è¦å°†typeè®¾ç½®ä¸º basic å³å¯ï¼š 1234567securityDefinitions: UserSecurity: type: basic AdminSecurity: type: basic MediaSecurity: type: basic è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸‰ç§å®‰å…¨è¯´æ˜ï¼ˆUserSecurityï¼ŒAdminSecurityï¼Œ MediaSecurityï¼‰ï¼Œéƒ½å±äºåŸºç¡€é‰´æƒã€‚ 6.1.2 APIç§˜é’¥é‰´æƒï¼ˆAPI Keyï¼‰è¦å®šä¹‰ä¸€ä¸ªAPIç§˜é’¥é‰´æƒï¼Œæˆ‘ä»¬éœ€è¦ï¼š è®¾ç½®typeä¸º apiKey é€šè¿‡å…³é”®å­—inæŒ‡ç¤ºapiç§˜é’¥æ‰€åœ¨ä½ç½®ã€‚é€šå¸¸apiç§˜é’¥ä¼šæ”¾åœ¨æ¶ˆæ¯å¤´ã€è¯·æ±‚å‚æ•°æˆ–è€…æ¶ˆæ¯ä½“ä¸­ ç»™å®‰å…¨é¡¹å‘½ä¸ªåå­— 12345678910111213securityDefinitions: UserSecurity: type: apiKey in: header name: SIMPLE-API-KEY AdminSecurity: type: apiKey in: header name: ADMIN-API-KEY MediaSecurity: type: apiKey in: query name: MEDIA-API-KEY åœ¨è¿™ä¸ªä¾‹å­ä¸­,æˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªapiKeyç±»å‹çš„å®‰å…¨é¡¹ï¼š UserSecurity å®šä¹‰äº†ä¸€ä¸ªåä¸ºSIMPLE-API-KEY çš„å‚æ•°åœ¨æ¶ˆæ¯å¤´ï¼ˆheaderï¼‰ AdminSecurity å®šä¹‰äº†ä¸€ä¸ªåä¸º ADMIN-API-KEY çš„å‚æ•°åœ¨æ¶ˆæ¯å¤´ ï¼ˆheaderï¼‰ MediaSecurity å®šä¹‰äº†ä¸€ä¸ªåä¸ºMEDIA-API-KEYçš„å‚æ•°åœ¨è¯·æ±‚å‚æ•°ä¸­ 6.1.3 Oauth2é‰´æƒ6.1.3.1 æµç¨‹ï¼ˆFlowï¼‰å’ŒURLå½“æˆ‘ä»¬å®šä¹‰ä¸ª Oauth2 ç±»å‹çš„å®‰å…¨é¡¹ä¸Šï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå®šä¹‰Oauth2 çš„æµç¨‹ï¼ˆflowï¼‰å’Œå¹¶æ ¹æ®é€‰å®šçš„æµç¨‹é…ç½®ç›¸åº”çš„é‰´æƒåœ°å€ï¼ˆauthorizationUrlï¼‰å’Œ/æˆ–ä»¤ç‰Œåœ°å€ï¼ˆtokenUrlï¼‰ã€‚ æµç¨‹ æ‰€éœ€è¦çš„URL implicit authorizationUrlï¼ˆé‰´æƒåœ°å€ï¼‰ password tokenUrlï¼ˆä»¤ç‰Œåœ°å€ï¼‰ application tokenUrl accessCode authorizationUrl and tokenUrl æ¯”å¦‚ï¼š 123456securityDefinitions: OauthSecurity: type: oauth2 flow: accessCode authorizationUrl: 'https://oauth.simple.api/authorization' tokenUrl: 'https://oauth.simple.api/token' åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª Oauth2 çš„å®‰å…¨é¡¹ï¼Œé…ç½®çš„æµç¨‹æ˜¯ accessCode æ–¹å¼ï¼ŒåŒæ—¶é…ç½®äº†é‰´æƒåœ°å€å’Œä»¤ç‰Œåœ°å€ã€‚ 6.1.3.2 ä½œç”¨èŒƒå›´ï¼ˆscopeï¼‰æˆ‘ä»¬å€ŸåŠ©å…³é”®å­—scopeså¹¶é€šè¿‡å“ˆå¸Œé”®å€¼å¯¹æ¥è¿˜å¯ä»¥é…ç½® Oauth2 å®‰å…¨é¡¹çš„ä½œç”¨èŒƒå›´ï¼ˆscopeï¼‰ï¼Œé”®å€¼å¯¹çš„é”®è¡¨ç¤ºä½œç”¨èŒƒå›´åç§°ï¼›å€¼æ˜¯å®ƒçš„ç›¸å…³æè¿°ï¼Œæ¯”å¦‚ï¼š 12345678910securityDefinitions: OauthSecurity: type: oauth2 flow: accessCode authorizationUrl: 'https://oauth.simple.api/authorization' tokenUrl: 'https://oauth.simple.api/token' scopes: admin: Admin scope user: User scope media: Media scope åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç»™ OauthSecurity å®‰å…¨é¡¹æ·»åŠ äº†ä¸‰ä¸ªä½œç”¨èŒƒå›´ï¼ˆadmin ï¼Œuser ï¼Œmediaï¼‰ã€‚ 6.2 ä½¿ç”¨å®‰å…¨å®šä¹‰ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨securityDefinition ä¸­å®šä¹‰å¥½äº†å®‰å…¨é¡¹ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å°†å°†å®ƒä»¬åº”ç”¨åˆ°æ–‡æ¡£ä¸­äº†ã€‚ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡securityå…³é”®å­—ï¼ŒæŠŠå®‰å…¨é¡¹æ·»åŠ è¿›å»ã€‚ 6.2.1 åŸºç¡€é‰´æƒ6.2.1.1 APIçº§åˆ«12345678910111213securityDefinitions: UserSecurity: type: basic AdminSecurity: type: basic MediaSecurity: type: basic#START############################################################################security: - UserSecurity: [] # END ############################################################################paths: /persons: åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨APIæ–‡æ¡£çš„æ ¹è·¯å¾„ä¸‹ç›´æ¥ä½¿ç”¨äº†å®‰å…¨é¡¹ UserSecurityï¼Œå®ƒçš„ä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ªAPIæ–‡æ¡£ã€‚ 6.2.1.2 æ“ä½œçº§åˆ«æ¯”å¦‚æˆ‘ä»¬åœ¨æ·»åŠ æˆ–è€…ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œéœ€è¦è¿›è¡Œç®¡ç†å‘˜é‰´æƒï¼Œå¯ä»¥åœ¨ POST /persons æ“ä½œä¸­å¢åŠ å®‰å…¨é¡¹ï¼š 1234567 post: summary: Creates a person description: Adds a new person to the persons list.#START############################################################################ security: - AdminSecurity: []# END ############################################################################ è€Œåœ¨ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œéœ€è¦è¿›è¡Œåª’ä½“æ“ä½œé‰´æƒï¼Œå¯ä»¥åœ¨ POST /images æ“ä½œä¸­å¢åŠ å®‰å…¨é¡¹ï¼š 123456789 /images: parameters: - $ref: '#/parameters/userAgent' post: summary: Uploads an image#START############################################################################ security: - MediaSecurity: []# END ############################################################################ 6.2.2 APIç§˜é’¥é‰´æƒä½¿ç”¨æ–¹å¼å’ŒåŸºç¡€é‰´æƒä¸€æ ·ï¼Œå¯ä»¥åœ¨APIçº§åˆ«å’Œæ“ä½œçº§åˆ«ä½¿ç”¨ï¼š 123456789101112131415161718192021222324securityDefinitions: UserSecurity: type: apiKey in: header name: SIMPLE-API-KEY AdminSecurity: type: apiKey in: header name: ADMIN-API-KEY MediaSecurity: type: apiKey in: query name: media-api-key#START############################################################################security: - UserSecurity: [] # END ############################################################################paths: /persons: post: summary: Creates a person description: Adds a new person to the persons list. security: - AdminSecurity: [] 6.2.3 Oauth2é‰´æƒOauth2 é‰´æƒçš„ä½¿ç”¨å’Œä¸Šé¢çš„ä¸¤ç§é‰´æƒæ–¹å¼åŸºæœ¬ç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºæˆ‘ä»¬å¯ä»¥æŒ‡å®šå®ƒçš„å“ªä¸€ä¸ªä½œç”¨èŒƒå›´ï¼ˆscopeï¼‰ã€‚ æ¯”å¦‚APIçº§åˆ«çš„é‰´æƒï¼š 1234567891011121314151617securityDefinitions: OauthSecurity: type: oauth2 flow: accessCode authorizationUrl: 'https://oauth.simple.api/authorization' tokenUrl: 'https://oauth.simple.api/token' scopes: admin: Admin scope user: User scope media: Media scope#START############################################################################security: - OauthSecurity: - user# END ############################################################################paths: /persons: æ“ä½œçº§åˆ«çš„é‰´æƒï¼š 123456post: summary: Creates a person description: Adds a new person to the persons list. security: - OauthSecurity: - admin åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½œç”¨èŒƒå›´ admin å°†è¦†ç›–å…¨å±€é…ç½®çš„ä½œç”¨èŒƒå›´ user ã€‚ 6.3 ä½¿ç”¨å¤šç§å®‰å…¨é…ç½®OpenAPIè§„èŒƒå¹¶æ²¡æœ‰é™å®šæˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸€ç§å®‰å…¨é¡¹ã€‚ä¸‹é¢çš„ä¾‹å­å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨å¤šç§å®‰å…¨é…ç½®ã€‚ 6.3.1 å®‰å…¨å®šä¹‰123456789101112131415securityDefinitions: OauthSecurity: type: oauth2 flow: accessCode authorizationUrl: 'https://oauth.simple.api/authorization' tokenUrl: 'https://oauth.simple.api/token' scopes: admin: Admin scope user: User scope MediaSecurity: type: apiKey in: query name: media-api-key LegacySecurity: type: basic è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸‰ç§é‰´æƒæ–¹å¼ã€‚ 6.3.2 å…¨å±€å®‰å…¨é…ç½®1234security: - OauthSecurity: - user - LegacySecurity: [] è¿™ä¸ªé…ç½®çš„æ„æ€æ˜¯ç”¨æˆ·å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä¸­çš„ä»»æ„ä¸€ç§æ¥è®¿é—®æˆ‘ä»¬æä¾›çš„APIæ¥å£ã€‚ 6.3.3 è¦†ç›–å…¨å±€é…ç½®1234567post: summary: Creates a person description: Adds a new person to the persons list. security: - OauthSecurity: - admin - LegacySecurity: [] åœ¨ POST /persons æ“ä½œä¸­ï¼ŒOauthSecurity çš„ä½œç”¨èŒƒå›´è¢«è¦†å†™ä¸ºadminã€‚æ­¤æ—¶ç”¨æˆ·å¯ä»¥é€šè¿‡admin çš„Oauth2*æˆ–è€… *legacySecurity æ¥é‰´æƒä½¿ç”¨è¿™ä¸ªæ“ä½œã€‚ 1234567/images: parameters: - $ref: '#/parameters/userAgent' post: summary: Uploads an image security: - MediaSecurity: [] åœ¨ POST/images æ“ä½œä¸­ï¼Œç”¨MediaSecurity æ•´ä½“è¦†å†™äº†å…¨å±€å®‰å…¨é¡¹ï¼Œç”¨æˆ·åªèƒ½é€šè¿‡ MediaSecurity é‰´æƒä½¿ç”¨è¿™ä¸ªæ“ä½œã€‚ ä¸ƒã€ è®©æ–‡æ¡£çš„å¯è¯»æ€§æ›´å¥½7.1 åˆ†ç±»æ ‡ç­¾ï¼ˆTagsï¼‰é€šè¿‡å…³é”®å­—tagsæˆ‘ä»¬å¯ä»¥å¯¹æ–‡æ¡£ä¸­æ¥å£è¿›è¡Œå½’ç±»ï¼Œtagsçš„æœ¬è´¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ã€‚tagså®šä¹‰åœ¨æ–‡æ¡£çš„æ ¹è·¯å¾„ä¸‹ã€‚ 7.1.1 å•æ ‡ç­¾æ¯”å¦‚è¯´ GET /persons å±äºç”¨æˆ·ï¼ˆPersonï¼‰ è¿™ä¸ªåˆ†ç±»çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç»™å®ƒè´´ä¸ªæ ‡ç­¾ï¼š 123456789101112paths: /persons: parameters: - $ref: '#/parameters/userAgent' get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. operationId: searchUsers#START############################################################################ tags: - Persons# END ############################################################################ 7.1.2 å¤šæ ‡ç­¾ä¸€ä¸ªæ“ä½œä¹Ÿå¯ä»¥åŒæ—¶è´´å‡ ä¸ªæ ‡ç­¾ï¼Œæ¯”å¦‚ï¼š 1234567891011/js-less-consumer-persons: parameters: - $ref: '#/parameters/userAgent' post: summary: Creates a person description: For JS-less partners operationId: createUserJS deprecated: true tags: - JSLess - Persons è´´ä¸Šæ ‡ç­¾åï¼Œåœ¨Swagger Editorå’ŒSwagger UIä¸­èƒ½å¤Ÿè‡ªåŠ¨å½’ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ ‡ç­¾æ¥ç­›é€‰æ¥å£ï¼Œè¯•è¯•å§ï¼Ÿ 7.2 æ— å¤„ä¸åœ¨çš„æè¿°æ–‡å­—ï¼ˆDescriptionsï¼‰descriptionè¿™ä¸ªå±æ€§å‡ ä¹æ˜¯æ— å¤„ä¸åœ¨ï¼Œä¸ºäº†æé«˜æ–‡æ¡£çš„å¯è¯»æ€§ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨å¿…è¦çš„åœ°æ–¹éƒ½åŠ ä¸Šæè¿°æ–‡å­—ã€‚ 7.2.1 å®‰å…¨é¡¹çš„æè¿°123456789101112131415161718securityDefinitions: OauthSecurity: description: New Oauth security system. Do not use MediaSecurity or LegacySecurity. type: oauth2 flow: accessCode authorizationUrl: 'https://oauth.simple.api/authorization' tokenUrl: 'https://oauth.simple.api/token' scopes: admin: Admin scope user: User scope MediaSecurity: description: Specific media security for backward compatibility. Use OauthSecurity instead. type: apiKey in: query name: media-api-key LegacySecurity: description: Legacy security system for backward compatibility. Use OauthSecurity instead. type: basic 7.2.2 æ¨¡å¼ï¼ˆSchemaï¼‰çš„æè¿°æ¯ä¸€ç§æ¨¡å¼ï¼ˆSchemaï¼‰ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ ‡é¢˜ï¼ˆtitleï¼‰å’Œä¸€æ®µæè¿°ï¼Œæ¯”å¦‚ï¼š 1234definitions: Person: title: Human description: A person which can be the user itself or one of his friend 7.2.3 å±æ€§çš„æè¿°æ¯”å¦‚ï¼š 1234properties: firstName: description: first name type: string 7.2.4 å‚æ•°çš„æè¿°123456789101112131415161718192021paths: /persons: post: parameters: - name: person in: body required: true description: The person to create. schema: $ref: '#/definitions/Person'parameters: username: name: username in: path required: true description: The person's username type: string pageSize: name: pageSize in: query description: Number of persons returned 7.2.5 æ“ä½œçš„æ¦‚è¿°ï¼ˆsummaryï¼‰ã€æè¿°å’Œæ“ä½œIDï¼ˆoperationIdï¼‰ä¸€ä¸ªæ“ä½œï¼ˆOperationï¼‰é€šå¸¸éƒ½ä¼šåŒ…å«æ¦‚è¿°å’Œæè¿°ä¿¡æ¯ã€‚è€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªå…³é”®å­—operationIdï¼Œè¿™ä¸ªå…³é”®å­—é€šå¸¸ç”¨æ¥æŒ‡ç¤ºæœåŠ¡æä¾›è€…å¯¹è¿™ä¸ªæ“ä½œçš„å¤„ç†å‡½æ•°çš„å‡½æ•°åã€‚æ¯”å¦‚ï¼š 12345678paths: /persons: parameters: - $ref: '#/parameters/userAgent' get: summary: Gets some persons description: Returns a list containing all persons. The list supports paging. operationId: searchUsers 7.2.6 å“åº”æ¶ˆæ¯çš„æè¿°12345678910111213paths: /persons: parameters: - $ref: '#/parameters/userAgent' get: â€¦â€¦ â€¦â€¦ responses: '200': description: A list of Personresponses: Standard500ErrorResponse: description: An unexpected error occured. 7.2.7 å“åº”æ¶ˆæ¯å¤´çš„æè¿°12345678headers: X-Rate-Limit-Remaining: description: How many calls consumer can do type: integer X-Rate-Limit-Reset: description: When rate limit will be reset type: string format: date-time 7.2.8 æ ‡ç­¾çš„æè¿°æˆ‘ä»¬åœ¨APIæ–‡æ¡£çš„æ ¹è·¯å¾„ä¸‹æ·»åŠ äº†tagsçš„å®šä¹‰ï¼Œå¯¹äºå…¶ä¸­çš„æ¯ä¸€ä¸ªæ ‡ç­¾ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ·»åŠ æè¿°ä¿¡æ¯ï¼š 123tags: - name: Persons description: Everything you need to handle users and friends 7.3 åœ¨æè¿°ä¸­ä½¿ç”¨Markdownè¯­æ³•åœ¨ç»å¤§éƒ¨åˆ†çš„descriptionä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨GFMï¼ˆGithub Flavored Markdownï¼‰è¯­æ³•ã€‚ 7.3.1 å¤šè¡Œæè¿°ä½¿ç”¨ç¬¦å· | ç„¶ååœ¨æ–°è¡Œä¸­æ‰“ä¸€ä¸ªtabï¼ˆæ³¨æ„ï¼šYAMLçš„tabæ˜¯ä¸¤ä¸ªç©ºæ ¼ ï¼‰ï¼Œå°±å¯ä»¥ç¼–è¾‘å¤šè¡Œæè¿°ï¼Œæ¯”å¦‚ï¼š 123456789'/persons/&#123;username&#125;/collecting-items': parameters: - $ref: '#/parameters/username' - $ref: '#/parameters/userAgent' get: summary: Gets a person's collecting items list description: | Returns a list containing all items this person is looking for. The list supports paging. 7.3.2 ç®€å•ä½¿ç”¨GFMæ¯”å¦‚æˆ‘ä»¬è¦å¼ºè°ƒï¼Œå¯ä»¥è¿™æ ·å†™ï¼š 1234externalDocs: description: | **Complete** documentation describing how to use this API url: http://doc.simple.api/ 7.3.3 å¸¦ä¿¡æ¯ç»„çš„æè¿°12345678910111213141516171819CollectingItem: discriminator: itemType required: - itemType properties: itemType: description: | An item can be of different type: type | definition -----|----------- Vinyl| #/definitions/Vinyl VHS | #/definitions/VHS AudioCassette | #/definitions/AudioCassette type: string enum: - AudioCassette - Vinyl - VHS 7.3.4 å¸¦ä»£ç çš„æè¿°1234567891011121314151617181920212223242526272829303132333435363738swagger: '2.0'info: version: 1.1.0 title: Simple API description: | A simple API to learn how to write OpenAPI Specification. This file uses almost every single aspect of the [Open API Specification](https://openapis.org/). This API will use JSON. JSON looks like this: ```JSON &#123; "key": "value", "anotherKey": "anotherValue" &#125;### 7.4 ç¤ºä¾‹æ•°æ®ï¼ˆExamplesï¼‰æˆ‘ä»¬å·²ç»çŸ¥é“äº†ç”¨Schemaæ¥æè¿°å‚æ•°å’Œå±æ€§ï¼Œæœ‰çš„æ—¶å€™ï¼Œç”¨ç¤ºä¾‹æ•°æ®æ›´æœ‰è¡¨ç°äº†ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…³é”®å­—`example`æ¥ç»™åŸå­å±æ€§æˆ–è€…å¯¹è±¡æ·»åŠ ç¤ºä¾‹æ•°æ®ã€‚#### 7.4.1 åŸå­å±æ€§çš„ç¤ºä¾‹æ•°æ®```YAML properties: firstName: description: first name type: string#START############################################################################ example: John# END ############################################################################ lastTimeOnline: description: The last time this person was connected to the service as a type: string format: date-time readOnly: true#START############################################################################ example: 2016-06-10T12:36:58.014Z# END ############################################################################ 7.4.2 å¯¹è±¡å±æ€§çš„ç¤ºä¾‹æ•°æ®123456789101112131415161718192021222324252627 Persons: title: Humans description: A list of users or friends required: - items properties: items: description: Array containg the list type: array minItems: 10 maxItems: 100 uniqueItems: true items: $ref: '#/definitions/Person'#START############################################################################ example: - firstname: Robert lastname": Doe username": robdo dateOfBirth: 1970-01-28 lastTimeOnline: 2016-04-10T14:36:58.014Z - firstname: Jane lastname: Doe username: jdoe123 dateOfBirth: 1980-05-12 lastTimeOnline: 2016-05-12T19:23:59.014Z# END ############################################################################ 7.4.3 å®šä¹‰çš„ç¤ºä¾‹æ•°æ®è·Ÿæ™®é€šå±æ€§ä¸€æ ·ï¼Œå®šä¹‰çš„å¯¹è±¡ä¹Ÿèƒ½æ·»åŠ ç¤ºä¾‹æ•°æ®ï¼š 1234567891011121314151617 MultilingualErrorMessage: title: MultiLingualMultiDeviceErrorMessage description: An multilingual error message (hashmap) with a long and a short description additionalProperties: $ref: '#/definitions/ErrorMessage' properties: defaultLanguage: $ref: '#/definitions/ErrorMessage'#START############################################################################ example: defaultLanguage: longMessage: We're deeply sorry but an error occured shortMessage: Error fr: longMessage: Nous sommes dÃƒÂ©solÃƒÂ© mais une erreur est survenu shortMessage: Erreur# END ############################################################################ 7.4.4 å“åº”æ¶ˆæ¯çš„ç¤ºä¾‹æ•°æ®æˆ‘ä»¬ç”šè‡³å¯ä»¥æ·»åŠ å“åº”æ¶ˆæ¯çº§åˆ«çš„ç¤ºä¾‹æ•°æ®ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546 '/persons/&#123;username&#125;/collecting-items': â€¦â€¦ get: â€¦â€¦ responses: '200':#START############################################################################ examples: application/json: &#123; "totalItems": 10, "totalPage": 4, "pageSize": 3, "currentPage": 2, "items": [ &#123; "itemType": "Vinyl", "maxPrice": 20, "imageId": "98096838-04eb-4bac-b32e-cd5b7196de71", "albumName": "Captain Future Original Soundtrack", "artist": "Yuji Ohno" &#125;, &#123; "itemType": "VHS", "maxPrice": 10, "imageId": "b74469bc-e6a1-4a90-858a-88ef94079356", "movieTitle": "Star Crash", "director": "Luigi Cozzi" &#125;, &#123; "itemType": "AudioCassette", "maxPrice": 10, "imageId": "b74469bc-e6a1-4a90-858a-88ef94079356", "albumName": "Star Wars", "artist": "John Williams" &#125; ] &#125;# END ############################################################################ '404': $ref: '#/responses/PersonDoesNotExistResponse' '500': $ref: '#/responses/Standard500ErrorResponse' default: $ref: '#/responses/TotallyUnexpectedResponse' 7.4.5 ç¤ºä¾‹æ•°æ®çš„ä¼˜å…ˆçº§å¦‚æœæˆ‘ä»¬åœ¨å„ä¸ªçº§åˆ«ï¼ˆæ¯”å¦‚å‚æ•°ã€å¯¹è±¡ã€å®šä¹‰ã€å“åº”æ¶ˆæ¯ï¼‰éƒ½æ·»åŠ äº†ç¤ºä¾‹æ•°æ®ã€‚æ”¯æŒOpenAPIè§„èŒƒçš„å„è§£æå·¥å…·éƒ½æ˜¯ä»¥ æœ€é«˜çº§åˆ« çš„å®šä¹‰ä¸ºå‡†ã€‚ 7.5 æ ‡è®°ä¸ºå¼ƒç”¨æˆ‘ä»¬å¯ä»¥é€šè¿‡å…³é”®å­—deprecatedç½®ä¸º true æ¥æ ‡è®°æ¥å£çš„å¼ƒç”¨çŠ¶æ€ï¼Œæ¯”å¦‚ï¼š 12345678/js-less-consumer-persons: parameters: - $ref: '#/parameters/userAgent' post: summary: Creates a person description: For JS-less partners operationId: createUserJS deprecated: true 7.6 é“¾æ¥åˆ°å¤–éƒ¨æ–‡æ¡£ä¸€èˆ¬æ¥è¯´ï¼Œé¡¹ç›®ä¸­ä¸å…‰åªæœ‰ä¸€ç¯‡APIæ–‡æ¡£ï¼Œè¿˜åº”è¯¥æœ‰äº›æè¿°application keyï¼Œæµ‹è¯•ç”¨ä¾‹ï¼Œæ“ä½œé“¾ä»¥åŠå…¶ä»–å†…å®¹çš„æ–‡æ¡£ï¼Œè¿™äº›æ–‡æ¡£ä¸€èˆ¬æ˜¯å•ç‹¬æˆç¯‡çš„ã€‚å¦‚æœåœ¨æè¿°æŸä¸ªæ¥å£æ—¶ï¼Œæˆ‘ä»¬æƒ³é“¾æ¥è¿™äº›æ–‡æ¡£ï¼Œå¯ä»¥é€šè¿‡å…³é”®å­—externalDocæ¥æ·»åŠ ï¼Œä¾‹å¦‚ï¼š 12345678910111213externalDocs: description: Complete documentation describing how to use this API url: http://doc.simple.api/ /images: parameters: - $ref: '#/parameters/userAgent' post: summary: Uploads an image description: Upload an image, will return an image id. operationId: storeImage externalDocs: description: How to upload media url: http://doc.simple.api/media/upload å…«ã€ åˆ†è€Œæ²»ä¹‹æ ¹æ®å‰é¢å‡ å¼ çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥è½»æ¾çš„æ„å»ºä¸€ä¸ªå¤æ‚çš„APIæ–‡æ¡£äº†ã€‚å¯æ˜¯ä½œä¸ºä¸€ä¸ªå­¦è¿‡ Clean Code çš„ç¨‹åºå‘˜ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›æ‰€æœ‰çš„æ¥å£ã€å®šä¹‰éƒ½åœ¨ä¸€ä¸ªå¤§è€Œå…¨çš„ä¸Šå¸æ–‡ä»¶é‡Œã€‚è¿™ä¸€ç« æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ æ‹†åˆ†æ–‡ä»¶ã€‚ 8.1 JSONæŒ‡é’ˆæˆ‘ä»¬åœ¨ç¬¬2ç« å·²ç»çŸ¥é“äº†æ€ä¹ˆå®šä¹‰ä¸€ä¸ªå¯é‡ç”¨çš„å¯¹è±¡ï¼Œå·²ç»å¦‚ä½•ä½¿ç”¨å®šä¹‰ï¼Œé‡æ¸©ä¸€ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233 /persons/&#123;username&#125;: get: summary: Gets a person description: Returns a single person for its username. parameters: - name: username in: path required: true description: The person's username type: string responses: 200: description: A Person schema: $ref: "#/definitions/Person" 404: description: The Person does not exists.definitions: Person: required: - username properties: firstName: type: string lastName: type: string username: type: string Persons: type: array items: $ref: "#/definitions/Person" åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬è¿™æ ·å†™ï¼š$ref: â€œ#/definitions/Personâ€ ï¼Œ$refå°±æ˜¯JSONæŒ‡é’ˆï¼ˆå‚è§å®šä¹‰RFC6901ï¼‰ã€‚ä¾‹å­ä¸­çš„è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å½“å‰æ–‡æ¡£æ ¹è·¯å¾„ï¼ˆ#ï¼‰ä¸‹çš„definitions ä¸‹çš„ Personã€‚ JSONæŒ‡é’ˆä¸ä»…å¯ä»¥æŒ‡å‘å½“å‰æ–‡ä»¶ï¼Œè¿˜å¯ä»¥æŒ‡å‘å…¶ä»–æ–‡ä»¶ã€‚ 8.2 åŸºç¡€æ‹†åˆ†8.2.1 å¼•ç”¨æœ¬åœ°æ–‡ä»¶è¿˜æ˜¯ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åœ¨å½“å‰æ–‡æ¡£çš„åŒä¸€ç›®å½•ä¸‹ï¼Œæ–°å»ºçš„ä¸€ä¸ªæ–‡ä»¶å« person.yamlï¼Œç„¶åæŠŠPerson çš„å®šä¹‰æ‹†å‡ºæ¥ï¼Œæ”¾åœ¨å…¶ä¸­ã€‚ 12345678910Person: required: - username properties: firstName: type: string lastName: type: string username: type: string åœ¨å½“å‰æ–‡æ¡£ä¸­æŠŠå¼•ç”¨ Person å®šä¹‰çš„åœ°æ–¹ä¿®æ”¹ä¸ºï¼š 1$ref: "person.yaml#/Person" 8.2.2 ç¼–è¾‘å™¨æŠ¥é”™æŠŠä¸Šé¢çš„ä»£ç æ”¾åˆ°Swagger Editorä¸­ç¼–è¾‘ï¼Œç¼–è¾‘å™¨é¢„è§ˆä¸­å¯èƒ½ä¼šæŠ¥é”™ï¼š æç¤ºæ‰¾ä¸åˆ°person.yamlæ–‡ä»¶ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šæ­£ç¡®çš„ç¼–è¾‘å™¨çš„æŒ‡é’ˆè§£æåŸºç¡€è·¯å¾„ï¼ˆPointer Resolution Base Pathï¼‰ ã€‚ è§£å†³çš„åŠæ³•æ˜¯ï¼šè¿›å…¥ç¼–è¾‘å™¨çš„ Preferences -&gt; Preferences èœå•ï¼Œä¿®æ”¹Pointer Resolution Base Pathä¸ºï¼š è€ƒè™‘åˆ°ç¼“å­˜çš„åŸå› ï¼Œå¦‚æœé”™è¯¯ä¾ç„¶å­˜åœ¨ï¼Œè¯·åˆ·æ–°æµè§ˆå™¨ã€‚ 8.2.3 æ–‡ä»¶å¤¹å¦‚æœå¼•ç”¨å­æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š 1$ref: "folder/person.yaml#/Person" å¦‚æœå¼•ç”¨ä¸Šçº§æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š 1234Persons: type: array items: $ref: "../folder/person.yaml#/Person" 8.2.4 å¼•ç”¨è¿œç¨‹æ–‡ä»¶å¦‚æœæˆ‘ä»¬æƒ³å¼•ç”¨ä¸€ä¸ªè¿œç¨‹æ–‡ä»¶ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå¯ä»¥è¿™æ ·å†™ï¼š 1$ref: https://myserver.com/mypath/myfile.yaml#/example ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæœåŠ¡å™¨å¿…é¡»æä¾›è·¨åŸŸï¼ˆCORSï¼‰è®¿é—®æœåŠ¡ã€‚ å¦‚æœè¦é€šè¿‡æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„8080ç«¯å£å¼•ç”¨æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š 1$ref: "http://localhost:8080/folder/person.yaml#/Person" è€ƒè™‘ä¸¤ç§æ¯”è¾ƒç‰¹åˆ«çš„æƒ…å†µï¼š 8.2.4.1 è¿œç«¯æ–‡ä»¶å¼•ç”¨â€æœ¬åœ°æ–‡ä»¶â€æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¼•ç”¨äº†ï¼š 1$ref: "http://localhost:8080/another-folder/persons.yaml#/Persons" è¿™ä¸ªè¿œç«¯æ–‡ä»¶ã€‚ä½†æ˜¯persons.yamlåˆå¼•ç”¨äº†ä¸å®ƒåœ¨åŒä¸€ç›®å½•ä¸‹çš„person.yamlæ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™è¯­æ³•åˆ†æå™¨ä¼šåœ¨localhost:8080ä¸Šé¢æ‰¾person.yamlæ–‡ä»¶ï¼Œè€Œä¸ä¼šæŸ¥æ‰¾æˆ‘ä»¬æœ¬åœ°çš„person.yamlã€‚ 8.2.4.2 è¿œç«¯æ–‡ä»¶å¼•ç”¨ â€æ›´â€œè¿œç«¯æ–‡ä»¶å¦‚æœç†è§£äº†8.2.4.1è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°±çŸ¥é“ä¸ç®¡æ€ä¹ˆå¼•ç”¨ï¼Œéƒ½æ˜¯åœ¨ç›¸å¯¹äºè¢«å¼•ç”¨çš„æ–‡ä»¶ä¸‹æ¥è¿›è¡ŒæŸ¥æ‰¾çš„ã€‚ 8.2.5 æ•´ç†ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å¤šä¸ªå®šä¹‰æ¯”å¦‚æˆ‘ä»¬åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œéœ€è¦æŠŠå®šä¹‰åˆ†æˆå‡ ç±»ï¼Œå¯ä»¥è¿™æ ·åšï¼š 1234567891011121314151617SomeDefinitions: Person: required: - username properties: firstName: type: string lastName: type: string username: type: stringOtherDefinitions: Persons: type: array items: $ref: "#/SomeDefinitions/Person" Personå½’å±äºSomeDefinitionsè¿™ä¸€ç±»ï¼ŒPersonså½’å±äºOtherDefinitionsè¿™ä¸€ç±»ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨å¼•ç”¨è¿™ä¸¤ä¸ªå®šä¹‰æ—¶ï¼Œåˆ†åˆ«åº”è¯¥è¿™æ ·ä¹¦å†™ï¼š 12$ref: "definitions.yaml#/OtherDefinitions/Persons"$ref: "definitions.yaml#/SomeDefinitions/Person" æœ‰ç‚¹åƒå‘½åç©ºé—´çš„æ¦‚å¿µã€‚ 8.3 å®æˆ˜åˆ‡åˆ†çš„æ€è·¯ ç»“æ„åŒ–åˆ‡åˆ†æ€è·¯ï¼š å…ˆæŠŠAPIæ–‡æ¡£çš„å¤´éƒ¨infoåˆ‡ä¸‹æ¥ï¼Œæ”¾åœ¨info.yamlï¼Œç„¶ååˆ†åˆ«åˆ‡åˆ† paths.yamlï¼Œdefinitions.yamlï¼Œresponses.yamlï¼Œparameters.yamlç­‰æ–‡ä»¶ï¼Œæœ€ååˆå¹¶åˆ°main.yamlï¼› åˆ†å±‚åˆ‡åˆ†æ€è·¯ï¼šåˆ†åˆ«æŒ‰ç…§åŠŸèƒ½å’Œå±‚æ¬¡ï¼Œå°†æ–‡ä»¶åˆ‡åˆ†ä¸ºbase.yamlæˆ–common.yamlï¼Œç„¶åæ˜¯å„ä¸ªæ¨¡å—çš„xxx-paths.yamlï¼Œç„¶åæ˜¯å„ä¸ªå®šä¹‰çš„xxx-definitions.yamlã€‚ å…¶ä»–æ€è·¯â€¦â€¦ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡æ€ä¹ˆåˆ‡åˆ†ï¼Œæœ‰ä¸€ä¸ªåŸåˆ™å¿…é¡»è°¨è®°ï¼š **åˆ‡åˆ†å‡ºæ¥çš„å­æ–‡æ¡£ï¼Œå¿…é¡»éµå¾ªOpenAPIè§„èŒƒï¼Œèƒ½å¤Ÿé€šè¿‡ç¼–è¾‘å™¨çš„æ ¡éªŒï¼Œä¸ç„¶åˆ‡åˆ†å¾—å†æ¼‚äº®ä¹Ÿæ˜¯å¾’åŠ³ã€‚]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangå·¥å…·åŒ…</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fabric ç¤ºä¾‹åº”ç”¨æ­å»º]]></title>
    <url>%2F2019%2F04%2F12%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2FHyperledger%20fabric%2F3.Fabric%20%E7%A4%BA%E4%BE%8B%E5%BA%94%E7%94%A8%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[ç”ŸæˆMSPèº«ä»½æ–‡ä»¶é…ç½®crypto-configæ–‡ä»¶crypto-config.yamlæ–‡ä»¶ï¼š 1234567891011121314151617181920212223242526272829OrdererOrgs: - Name: Orderer Domain: example.com Specs: - Hostname: ordererPeerOrgs: - Name: Org1 Domain: org1.example.com CA: Hostname: ca # implicitly ca.org1.example.com Template: Count: 2 SANS: - "localhost" Users: Count: 1 - Name: Org2 Domain: org2.example.com CA: Hostname: ca Template: Count: 2 SANS: - "localhost" Users: Count: 1 ç”ŸæˆMSPæ–‡ä»¶1cryptogen generate --config=./crypto-config.yaml # ç”Ÿæˆmspæ–‡ä»¶ ç”Ÿæˆåˆ›ä¸–åŒºå—å’Œchanneläº‹åŠ¡åˆ›ä¸–åŒºå—ä¸­ï¼ŒåŒ…å«äº†ç»„ç»‡å’Œè”ç›Ÿçš„é…ç½®ä¿¡æ¯ç­‰ é…ç½®configtx.yamlæ–‡ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758Profiles: TwoOrgsOrdererGenesis: Orderer: &lt;&lt;: *OrdererDefaults Organizations: - *OrdererOrg Consortiums: SampleConsortium: Organizations: - *Org1 - *Org2 TwoOrgsChannel: Consortium: SampleConsortium Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 - *Org2Organizations: - &amp;OrdererOrg Name: OrdererMSP ID: OrdererMSP MSPDir: crypto-config/ordererOrganizations/example.com/msp - &amp;Org1 Name: Org1MSP ID: Org1MSP MSPDir: crypto-config/peerOrganizations/org1.example.com/msp AnchorPeers: - Host: peer0.org1.example.com Port: 7051 - &amp;Org2 Name: Org2MSP ID: Org2MSP MSPDir: crypto-config/peerOrganizations/org2.example.com/msp AnchorPeers: - Host: peer0.org2.example.com Port: 7051Orderer: &amp;OrdererDefaults OrdererType: solo Addresses: - orderer.example.com:7050 BatchTimeout: 2s BatchSize: MaxMessageCount: 10 AbsoluteMaxBytes: 98 MB PreferredMaxBytes: 512 KB Kafka: Brokers: - 127.0.0.1:9092 Organizations:Application: &amp;ApplicationDefaults Organizations: ç”Ÿæˆåˆ›ä¸–åŒºå—1configtxgen -profile TwoOrgsOrdererGenesis -channelID order-channel -outputBlock genesis.block ç”Ÿæˆchannelé…ç½®äº‹åŠ¡1export CHANNEL_NAME=mychannel &amp;&amp; configtxgen -profile TwoOrgsChannel -outputCreateChannelTx channel.tx -channelID $CHANNEL_NAME ç”ŸæˆAnchor peer é…ç½®äº‹åŠ¡12export CHANNEL_NAME=mychannel &amp;&amp; configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSPexport CHANNEL_NAME=mychannel &amp;&amp; configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP å¯åŠ¨ç½‘ç»œé…ç½®docker-composeæ–‡ä»¶å®Œæˆä¸¤ä¸ªcaï¼Œ ä¸¤ä¸ªç»„ç»‡(æ¯ä¸ªç»„ç»‡2ä¸ªèŠ‚ç‚¹)ï¼Œä¸€ä¸ªorderèŠ‚ç‚¹å’Œä¸€ä¸ªclièŠ‚ç‚¹çš„é…ç½® clièŠ‚ç‚¹å¯ä»¥å¸®åŠ©åˆå§‹åŒ–channelå’Œé“¾ç çš„å®‰è£…å’Œåˆå§‹åŒ–ç­‰å·¥ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162version: '2'services: ca.org1.example.com: image: hyperledger/fabric-ca environment: - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server - FABRIC_CA_SERVER_CA_NAME=ca.org1.example.com - FABRIC_CA_SERVER_CA_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem - FABRIC_CA_SERVER_CA_KEYFILE=/etc/hyperledger/fabric-ca-server-config/0e729224e8b3f31784c8a93c5b8ef6f4c1c91d9e6e577c45c33163609fe40011_sk - FABRIC_CA_SERVER_TLS_ENABLED=true - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/0e729224e8b3f31784c8a93c5b8ef6f4c1c91d9e6e577c45c33163609fe40011_sk ports: - "7054:7054" command: sh -c 'fabric-ca-server start -b admin:adminpw -d' volumes: - ./channel/crypto-config/peerOrganizations/org1.example.com/ca/:/etc/hyperledger/fabric-ca-server-config container_name: ca.org1.example.com ca.org2.example.com: image: hyperledger/fabric-ca environment: - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server - FABRIC_CA_SERVER_CA_NAME=ca.org2.example.com - FABRIC_CA_SERVER_CA_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org2.example.com-cert.pem - FABRIC_CA_SERVER_CA_KEYFILE=/etc/hyperledger/fabric-ca-server-config/a7d47efa46a6ba07730c850fed2c1375df27360d7227f48cdc2f80e505678005_sk - FABRIC_CA_SERVER_TLS_ENABLED=true - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org2.example.com-cert.pem - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/a7d47efa46a6ba07730c850fed2c1375df27360d7227f48cdc2f80e505678005_sk ports: - "8054:7054" command: sh -c 'fabric-ca-server start -b admin:adminpw -d' volumes: - ./channel/crypto-config/peerOrganizations/org2.example.com/ca/:/etc/hyperledger/fabric-ca-server-config container_name: ca.org2.example.com orderer.example.com: container_name: orderer.example.com image: hyperledger/fabric-orderer environment: - ORDERER_GENERAL_LOGLEVEL=debug - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 - ORDERER_GENERAL_GENESISMETHOD=file - ORDERER_GENERAL_GENESISFILE=/etc/hyperledger/configtx/genesis.block - ORDERER_GENERAL_LOCALMSPID=OrdererMSP - ORDERER_GENERAL_LOCALMSPDIR=/etc/hyperledger/crypto/orderer/msp - ORDERER_GENERAL_TLS_ENABLED=true - ORDERER_GENERAL_TLS_PRIVATEKEY=/etc/hyperledger/crypto/orderer/tls/server.key - ORDERER_GENERAL_TLS_CERTIFICATE=/etc/hyperledger/crypto/orderer/tls/server.crt - ORDERER_GENERAL_TLS_ROOTCAS=[/etc/hyperledger/crypto/orderer/tls/ca.crt, /etc/hyperledger/crypto/peerOrg1/tls/ca.crt, /etc/hyperledger/crypto/peerOrg2/tls/ca.crt] working_dir: /opt/gopath/src/github.com/hyperledger/fabric/orderers command: orderer ports: - 7050:7050 volumes: - ./channel:/etc/hyperledger/configtx - ./channel/crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/:/etc/hyperledger/crypto/orderer - ./channel/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/:/etc/hyperledger/crypto/peerOrg1 - ./channel/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/:/etc/hyperledger/crypto/peerOrg2 peer0.org1.example.com: container_name: peer0.org1.example.com extends: file: base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org1.example.com - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 ports: - 7051:7051 - 7053:7053 volumes: - ./channel/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/:/etc/hyperledger/crypto/peer depends_on: - orderer.example.com peer1.org1.example.com: container_name: peer1.org1.example.com extends: file: base.yaml service: peer-base environment: - CORE_PEER_ID=peer1.org1.example.com - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_ADDRESS=peer1.org1.example.com:7051 ports: - 8051:7051 - 8053:7053 volumes: - ./channel/crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/:/etc/hyperledger/crypto/peer depends_on: - orderer.example.com peer0.org2.example.com: container_name: peer0.org2.example.com extends: file: base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org2.example.com - CORE_PEER_LOCALMSPID=Org2MSP - CORE_PEER_ADDRESS=peer0.org2.example.com:7051 ports: - 9051:7051 - 9053:7053 volumes: - ./channel/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/:/etc/hyperledger/crypto/peer depends_on: - orderer.example.com peer1.org2.example.com: container_name: peer1.org2.example.com extends: file: base.yaml service: peer-base environment: - CORE_PEER_ID=peer1.org2.example.com - CORE_PEER_LOCALMSPID=Org2MSP - CORE_PEER_ADDRESS=peer1.org2.example.com:7051 ports: - 10051:7051 - 10053:7053 volumes: - ./channel/crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/:/etc/hyperledger/crypto/peer depends_on: - orderer.example.com cli: container_name: cli image: hyperledger/fabric-tools tty: true stdin_open: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock #- CORE_LOGGING_LEVEL=DEBUG - FABRIC_LOGGING_SPEC=INFO - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: /bin/bash -c "./scripts/script.sh" volumes: - /var/run/:/host/var/run/ - ./../chaincode/:/opt/gopath/src/github.com/chaincode - ./channel/crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - orderer.example.com - peer0.org1.example.com - peer1.org1.example.com - peer0.org2.example.com - peer1.org2.example.com è¿è¡Œdocker-composeå¯åŠ¨ç½‘ç»œ1docker-compose -f ./docker-compose.yaml up -d æ¥ä¸‹æ¥ä¸€ä¸ªå®‰è£…å¹¶ç¤ºä¾‹å¥½é“¾ç çš„ç½‘ç»œç¯å¢ƒå°±å·²ç»æ­å»ºå¥½äº†ï¼Œ æ¥ä¸‹æ¥æŸ¥çœ‹cliå®¹å™¨ä¸­è¿›è¡Œäº†å“ªäº›æ­¥éª¤å®ç°äº†å¯¹channelçš„åˆ›å»ºå’Œchaincodeçš„å®‰è£…å’Œå®ä¾‹åŒ– cli å®¢æˆ·ç«¯ä¸­æ‰§è¡Œçš„å†…å®¹cli å®¹å™¨ä¸­å¯åŠ¨ç¨‹åºä»£ç ä¸ºï¼Œ åœ¨è„šæœ¬ä¸­ä¼šè¿›è¡Œchannelçš„åˆ›å»ºï¼Œç»„ç»‡èŠ‚ç‚¹åŠ å…¥channelï¼Œé“¾ç çš„å®‰è£…ï¼Œå®ä¾‹åŒ–ç­‰ å¯åŠ¨æ‰§è¡Œè„šæœ¬scripts.sh 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283CHANNEL_NAME="$1"DELAY="$2"LANGUAGE="$3"TIMEOUT="$4": $&#123;CHANNEL_NAME:="mychannel"&#125;: $&#123;DELAY:="3"&#125;: $&#123;LANGUAGE:="golang"&#125;: $&#123;TIMEOUT:="10"&#125;LANGUAGE=`echo "$LANGUAGE" | tr [:upper:] [:lower:]`COUNTER=1MAX_RETRY=5ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pemCC_SRC_PATH="github.com/chaincode/chaincode_example02/go/"if [ "$LANGUAGE" = "node" ]; then CC_SRC_PATH="/opt/gopath/src/github.com/chaincode/chaincode_example02/node/"fiecho "Channel name : "$CHANNEL_NAME# import utils. scripts/utils.shcreateChannel() &#123; setGlobals 0 1 if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then set -x peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx &gt;&amp;log.txt res=$? set +x else set -x peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA &gt;&amp;log.txt res=$? set +x fi cat log.txt verifyResult $res "Channel creation failed" echo "===================== Channel \"$CHANNEL_NAME\" is created successfully ===================== " echo&#125;joinChannel () &#123; for org in 1 2; do for peer in 0 1; do joinChannelWithRetry $peer $org echo "===================== peer$&#123;peer&#125;.org$&#123;org&#125; joined on the channel \"$CHANNEL_NAME\" ===================== " sleep $DELAY echo done done&#125;## Create channelecho "Creating channel..."createChannel## Join all the peers to the channelecho "Having all peers join the channel..."joinChannel## Set the anchor peers for each org in the channelecho "Updating anchor peers for org1..."updateAnchorPeers 0 1echo "Updating anchor peers for org2..."updateAnchorPeers 0 2## Install chaincode on peer0.org1 and peer0.org2echo "Installing chaincode on peer0.org1..."installChaincode 0 1echo "Install chaincode on peer0.org2..."installChaincode 0 2## Install chaincode on peer1.org2echo "Installing chaincode on peer1.org1..."installChaincode 1 1echo "Installing chaincode on peer1.org2..."installChaincode 1 2# Instantiate chaincode on peer0.org2echo "Instantiating chaincode on peer0.org2..."instantiateChaincode 0 2 ä¾èµ–è„šæœ¬utils.sh 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265verifyResult () &#123; if [ $1 -ne 0 ] ; then echo "!!!!!!!!!!!!!!! "$2" !!!!!!!!!!!!!!!!" echo "========= ERROR !!! FAILED to execute End-2-End Scenario ===========" echo exit 1 fi&#125;# Set OrdererOrg.Admin globalssetOrdererGlobals() &#123; CORE_PEER_LOCALMSPID="OrdererMSP" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/users/Admin@example.com/msp&#125;setGlobals () &#123; PEER=$1 ORG=$2 if [ $ORG -eq 1 ] ; then CORE_PEER_LOCALMSPID="Org1MSP" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp if [ $PEER -eq 0 ]; then CORE_PEER_ADDRESS=peer0.org1.example.com:7051 else CORE_PEER_ADDRESS=peer1.org1.example.com:7051 fi elif [ $ORG -eq 2 ] ; then CORE_PEER_LOCALMSPID="Org2MSP" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp if [ $PEER -eq 0 ]; then CORE_PEER_ADDRESS=peer0.org2.example.com:7051 else CORE_PEER_ADDRESS=peer1.org2.example.com:7051 fi elif [ $ORG -eq 3 ] ; then CORE_PEER_LOCALMSPID="Org3MSP" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp if [ $PEER -eq 0 ]; then CORE_PEER_ADDRESS=peer0.org3.example.com:7051 else CORE_PEER_ADDRESS=peer1.org3.example.com:7051 fi else echo "================== ERROR !!! ORG Unknown ==================" fi env |grep CORE&#125;updateAnchorPeers() &#123; PEER=$1 ORG=$2 setGlobals $PEER $ORG if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then set -x peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/$&#123;CORE_PEER_LOCALMSPID&#125;anchors.tx &gt;&amp;log.txt res=$? set +x else set -x peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/$&#123;CORE_PEER_LOCALMSPID&#125;anchors.tx --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA &gt;&amp;log.txt res=$? set +x fi cat log.txt verifyResult $res "Anchor peer update failed" echo "===================== Anchor peers for org \"$CORE_PEER_LOCALMSPID\" on \"$CHANNEL_NAME\" is updated successfully ===================== " sleep $DELAY echo&#125;## Sometimes Join takes time hence RETRY at least for 5 timesjoinChannelWithRetry () &#123; PEER=$1 ORG=$2 setGlobals $PEER $ORG set -x peer channel join -b $CHANNEL_NAME.block &gt;&amp;log.txt res=$? set +x cat log.txt if [ $res -ne 0 -a $COUNTER -lt $MAX_RETRY ]; then COUNTER=` expr $COUNTER + 1` echo "peer$&#123;PEER&#125;.org$&#123;ORG&#125; failed to join the channel, Retry after $DELAY seconds" sleep $DELAY joinChannelWithRetry $PEER $ORG else COUNTER=1 fi verifyResult $res "After $MAX_RETRY attempts, peer$&#123;PEER&#125;.org$&#123;ORG&#125; has failed to Join the Channel"&#125;installChaincode () &#123; PEER=$1 ORG=$2 setGlobals $PEER $ORG VERSION=$&#123;3:-1.0&#125; set -x peer chaincode install -n mycc -v $&#123;VERSION&#125; -l $&#123;LANGUAGE&#125; -p $&#123;CC_SRC_PATH&#125; &gt;&amp;log.txt res=$? set +x cat log.txt verifyResult $res "Chaincode installation on peer$&#123;PEER&#125;.org$&#123;ORG&#125; has Failed" echo "===================== Chaincode is installed on peer$&#123;PEER&#125;.org$&#123;ORG&#125; ===================== " echo&#125;instantiateChaincode () &#123; PEER=$1 ORG=$2 setGlobals $PEER $ORG VERSION=$&#123;3:-1.0&#125; # while 'peer chaincode' command can get the orderer endpoint from the peer (if join was successful), # lets supply it directly as we know it using the "-o" option if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then set -x peer chaincode instantiate -o orderer.example.com:7050 -C $CHANNEL_NAME -n mycc -l $&#123;LANGUAGE&#125; -v $&#123;VERSION&#125; -c '&#123;"Args":["init","a","100","b","200"]&#125;' -P "OR ('Org1MSP.member','Org2MSP.member')" &gt;&amp;log.txt res=$? set +x else set -x peer chaincode instantiate -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C $CHANNEL_NAME -n mycc -l $&#123;LANGUAGE&#125; -v 1.0 -c '&#123;"Args":["init","a","100","b","200"]&#125;' -P "OR ('Org1MSP.member','Org2MSP.member')" &gt;&amp;log.txt res=$? set +x fi cat log.txt verifyResult $res "Chaincode instantiation on peer$&#123;PEER&#125;.org$&#123;ORG&#125; on channel '$CHANNEL_NAME' failed" echo "===================== Chaincode Instantiation on peer$&#123;PEER&#125;.org$&#123;ORG&#125; on channel '$CHANNEL_NAME' is successful ===================== " echo&#125;upgradeChaincode () &#123; PEER=$1 ORG=$2 setGlobals $PEER $ORG set -x peer chaincode upgrade -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C $CHANNEL_NAME -n mycc -v 2.0 -c '&#123;"Args":["init","a","90","b","210"]&#125;' -P "OR ('Org1MSP.peer','Org2MSP.peer','Org3MSP.peer')" res=$? set +x cat log.txt verifyResult $res "Chaincode upgrade on org$&#123;ORG&#125; peer$&#123;PEER&#125; has Failed" echo "===================== Chaincode is upgraded on org$&#123;ORG&#125; peer$&#123;PEER&#125; ===================== " echo&#125;chaincodeQuery () &#123; PEER=$1 ORG=$2 setGlobals $PEER $ORG EXPECTED_RESULT=$3 echo "===================== Querying on peer$&#123;PEER&#125;.org$&#123;ORG&#125; on channel '$CHANNEL_NAME'... ===================== " local rc=1 local starttime=$(date +%s) # continue to poll # we either get a successful response, or reach TIMEOUT while test "$(($(date +%s)-starttime))" -lt "$TIMEOUT" -a $rc -ne 0 do sleep $DELAY echo "Attempting to Query peer$&#123;PEER&#125;.org$&#123;ORG&#125; ...$(($(date +%s)-starttime)) secs" set -x peer chaincode query -C $CHANNEL_NAME -n mycc -c '&#123;"Args":["query","a"]&#125;' &gt;&amp;log.txt res=$? set +x test $res -eq 0 &amp;&amp; VALUE=$(cat log.txt | awk '/Query Result/ &#123;print $NF&#125;') test "$VALUE" = "$EXPECTED_RESULT" &amp;&amp; let rc=0 done echo cat log.txt if test $rc -eq 0 ; then echo "===================== Query on peer$&#123;PEER&#125;.org$&#123;ORG&#125; on channel '$CHANNEL_NAME' is successful ===================== " else echo "!!!!!!!!!!!!!!! Query result on peer$&#123;PEER&#125;.org$&#123;ORG&#125; is INVALID !!!!!!!!!!!!!!!!" echo "================== ERROR !!! FAILED to execute End-2-End Scenario ==================" echo exit 1 fi&#125;# fetchChannelConfig &lt;channel_id&gt; &lt;output_json&gt;# Writes the current channel config for a given channel to a JSON filefetchChannelConfig() &#123; CHANNEL=$1 OUTPUT=$2 setOrdererGlobals echo "Fetching the most recent configuration block for the channel" if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then set -x peer channel fetch config config_block.pb -o orderer.example.com:7050 -c $CHANNEL --cafile $ORDERER_CA set +x else set -x peer channel fetch config config_block.pb -o orderer.example.com:7050 -c $CHANNEL --tls --cafile $ORDERER_CA set +x fi echo "Decoding config block to JSON and isolating config to $&#123;OUTPUT&#125;" set -x configtxlator proto_decode --input config_block.pb --type common.Block | jq .data.data[0].payload.data.config &gt; "$&#123;OUTPUT&#125;" set +x&#125;# signConfigtxAsPeerOrg &lt;org&gt; &lt;configtx.pb&gt;# Set the peerOrg admin of an org and signing the config updatesignConfigtxAsPeerOrg() &#123; PEERORG=$1 TX=$2 setGlobals 0 $PEERORG set -x peer channel signconfigtx -f "$&#123;TX&#125;" set +x&#125;# createConfigUpdate &lt;channel_id&gt; &lt;original_config.json&gt; &lt;modified_config.json&gt; &lt;output.pb&gt;# Takes an original and modified config, and produces the config update tx which transitions between the twocreateConfigUpdate() &#123; CHANNEL=$1 ORIGINAL=$2 MODIFIED=$3 OUTPUT=$4 set -x configtxlator proto_encode --input "$&#123;ORIGINAL&#125;" --type common.Config &gt; original_config.pb configtxlator proto_encode --input "$&#123;MODIFIED&#125;" --type common.Config &gt; modified_config.pb configtxlator compute_update --channel_id "$&#123;CHANNEL&#125;" --original original_config.pb --updated modified_config.pb &gt; config_update.pb configtxlator proto_decode --input config_update.pb --type common.ConfigUpdate &gt; config_update.json echo '&#123;"payload":&#123;"header":&#123;"channel_header":&#123;"channel_id":"'$CHANNEL'", "type":2&#125;&#125;,"data":&#123;"config_update":'$(cat config_update.json)'&#125;&#125;&#125;' | jq . &gt; config_update_in_envelope.json configtxlator proto_encode --input config_update_in_envelope.json --type common.Envelope &gt; "$&#123;OUTPUT&#125;" set +x&#125;chaincodeInvoke () &#123; PEER=$1 ORG=$2 setGlobals $PEER $ORG # while 'peer chaincode' command can get the orderer endpoint from the peer (if join was successful), # lets supply it directly as we know it using the "-o" option if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then set -x peer chaincode invoke -o orderer.example.com:7050 -C $CHANNEL_NAME -n mycc -c '&#123;"Args":["invoke","a","b","10"]&#125;' &gt;&amp;log.txt res=$? set +x else set -x peer chaincode invoke -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C $CHANNEL_NAME -n mycc -c '&#123;"Args":["invoke","a","b","10"]&#125;' &gt;&amp;log.txt res=$? set +x fi cat log.txt verifyResult $res "Invoke execution on peer$&#123;PEER&#125;.org$&#123;ORG&#125; failed " echo "===================== Invoke transaction on peer$&#123;PEER&#125;.org$&#123;ORG&#125; on channel '$CHANNEL_NAME' is successful ===================== " echo&#125; é“¾ä»£ç å†…å®¹é“¾ä»£ç å®ç°çš„ä¸»è¦æ–¹æ³•123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177package mainimport ( "fmt" "strconv" "github.com/hyperledger/fabric/core/chaincode/shim" pb "github.com/hyperledger/fabric/protos/peer")// SimpleChaincode example simple Chaincode implementationtype SimpleChaincode struct &#123;&#125;func (t *SimpleChaincode) Init(stub shim.ChaincodeStubInterface) pb.Response &#123; fmt.Println("ex02 Init") _, args := stub.GetFunctionAndParameters() var A, B string // Entities var Aval, Bval int // Asset holdings var err error if len(args) != 4 &#123; return shim.Error("Incorrect number of arguments. Expecting 4") &#125; // Initialize the chaincode A = args[0] Aval, err = strconv.Atoi(args[1]) if err != nil &#123; return shim.Error("Expecting integer value for asset holding") &#125; B = args[2] Bval, err = strconv.Atoi(args[3]) if err != nil &#123; return shim.Error("Expecting integer value for asset holding") &#125; fmt.Printf("Aval = %d, Bval = %d\n", Aval, Bval) // Write the state to the ledger err = stub.PutState(A, []byte(strconv.Itoa(Aval))) if err != nil &#123; return shim.Error(err.Error()) &#125; err = stub.PutState(B, []byte(strconv.Itoa(Bval))) if err != nil &#123; return shim.Error(err.Error()) &#125; return shim.Success(nil)&#125;func (t *SimpleChaincode) Invoke(stub shim.ChaincodeStubInterface) pb.Response &#123; fmt.Println("ex02 Invoke") function, args := stub.GetFunctionAndParameters() if function == "invoke" &#123; // Make payment of X units from A to B return t.invoke(stub, args) &#125; else if function == "delete" &#123; // Deletes an entity from its state return t.delete(stub, args) &#125; else if function == "query" &#123; // the old "Query" is now implemtned in invoke return t.query(stub, args) &#125; return shim.Error("Invalid invoke function name. Expecting \"invoke\" \"delete\" \"query\"")&#125;// Transaction makes payment of X units from A to Bfunc (t *SimpleChaincode) invoke(stub shim.ChaincodeStubInterface, args []string) pb.Response &#123; var A, B string // Entities var Aval, Bval int // Asset holdings var X int // Transaction value var err error if len(args) != 3 &#123; return shim.Error("Incorrect number of arguments. Expecting 3") &#125; A = args[0] B = args[1] // Get the state from the ledger // TODO: will be nice to have a GetAllState call to ledger Avalbytes, err := stub.GetState(A) if err != nil &#123; return shim.Error("Failed to get state") &#125; if Avalbytes == nil &#123; return shim.Error("Entity not found") &#125; Aval, _ = strconv.Atoi(string(Avalbytes)) Bvalbytes, err := stub.GetState(B) if err != nil &#123; return shim.Error("Failed to get state") &#125; if Bvalbytes == nil &#123; return shim.Error("Entity not found") &#125; Bval, _ = strconv.Atoi(string(Bvalbytes)) // Perform the execution X, err = strconv.Atoi(args[2]) if err != nil &#123; return shim.Error("Invalid transaction amount, expecting a integer value") &#125; Aval = Aval - X Bval = Bval + X fmt.Printf("Aval = %d, Bval = %d\n", Aval, Bval) // Write the state back to the ledger err = stub.PutState(A, []byte(strconv.Itoa(Aval))) if err != nil &#123; return shim.Error(err.Error()) &#125; err = stub.PutState(B, []byte(strconv.Itoa(Bval))) if err != nil &#123; return shim.Error(err.Error()) &#125; return shim.Success(nil)&#125;// Deletes an entity from statefunc (t *SimpleChaincode) delete(stub shim.ChaincodeStubInterface, args []string) pb.Response &#123; if len(args) != 1 &#123; return shim.Error("Incorrect number of arguments. Expecting 1") &#125; A := args[0] // Delete the key from the state in ledger err := stub.DelState(A) if err != nil &#123; return shim.Error("Failed to delete state") &#125; return shim.Success(nil)&#125;// query callback representing the query of a chaincodefunc (t *SimpleChaincode) query(stub shim.ChaincodeStubInterface, args []string) pb.Response &#123; var A string // Entities var err error if len(args) != 1 &#123; return shim.Error("Incorrect number of arguments. Expecting name of the person to query") &#125; A = args[0] // Get the state from the ledger Avalbytes, err := stub.GetState(A) if err != nil &#123; jsonResp := "&#123;\"Error\":\"Failed to get state for " + A + "\"&#125;" return shim.Error(jsonResp) &#125; if Avalbytes == nil &#123; jsonResp := "&#123;\"Error\":\"Nil amount for " + A + "\"&#125;" return shim.Error(jsonResp) &#125; jsonResp := "&#123;\"Name\":\"" + A + "\",\"Amount\":\"" + string(Avalbytes) + "\"&#125;" fmt.Printf("Query Response:%s\n", jsonResp) return shim.Success(Avalbytes)&#125;func main() &#123; err := shim.Start(new(SimpleChaincode)) if err != nil &#123; fmt.Printf("Error starting Simple chaincode: %s", err) &#125;&#125;]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>Hyperledger fabric</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>Fabric</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ca ä¸ MSP çš„ä»‹ç»]]></title>
    <url>%2F2019%2F04%2F03%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2F%E5%8C%BA%E5%9D%97%E9%93%BE%E6%A6%82%E5%BF%B5%2FCa%20%E4%B8%8E%20MSP%20%E7%9A%84%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[å…³äºåŠ å¯†çš„ä»‹ç»å¯¹ç§°åŠ å¯†ï¼ˆå…±äº«å¯†é’¥åŠ å¯†ï¼‰åœ¨å¯¹ç§°åŠ å¯†ç®—æ³•ä¸­ï¼ŒåŠ å¯†ä½¿ç”¨çš„å¯†é’¥å’Œè§£å¯†ä½¿ç”¨çš„å¯†é’¥æ˜¯ç›¸åŒçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ å¯†å’Œè§£å¯†éƒ½æ˜¯ä½¿ç”¨çš„åŒä¸€ä¸ªå¯†é’¥ã€‚å› æ­¤å¯¹ç§°åŠ å¯†ç®—æ³•è¦ä¿è¯å®‰å…¨æ€§çš„è¯ï¼Œå¯†é’¥è¦åšå¥½ä¿å¯†ï¼Œåªèƒ½è®©ä½¿ç”¨çš„äººçŸ¥é“ï¼Œä¸èƒ½å¯¹å¤–å…¬å¼€ã€‚è¿™ä¸ªå’Œä¸Šé¢çš„å…¬é’¥å¯†ç ä½“åˆ¶æœ‰æ‰€ä¸åŒï¼Œå…¬é’¥å¯†ç ä½“åˆ¶ä¸­åŠ å¯†æ˜¯ç”¨å…¬é’¥ï¼Œè§£å¯†ä½¿ç”¨ç§é’¥ï¼Œè€Œå¯¹ç§°åŠ å¯†ç®—æ³•ä¸­ï¼ŒåŠ å¯†å’Œè§£å¯†éƒ½æ˜¯ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ï¼Œä¸åŒºåˆ†å…¬é’¥å’Œç§é’¥ã€‚ éå¯¹ç§°åŠ å¯†ï¼ˆå…¬å¼€å¯†é’¥åŠ å¯† ï¼‰åœ¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸­ï¼ŒåŠ å¯†ä½¿ç”¨çš„å¯†é’¥å’Œè§£å¯†ä½¿ç”¨çš„å¯†é’¥æ˜¯ä¸ç›¸åŒçš„ã€‚ä¹Ÿå°±æ˜¯è¯´åŠ å¯†ä½¿ç”¨çš„å¯†é’¥å’Œè§£å¯†ä½¿ç”¨çš„å¯†é’¥ä¸åŒï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªéå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ æ•°å­—ç­¾åç±»ä¼¼åœ¨çº¸è´¨åˆåŒä¸Šè¿›è¡Œç­¾åä»¥ç¡®è®¤åˆåŒå†…å®¹å’Œè¯æ˜èº«ä»½ï¼Œæ•°å­—ç­¾åæ—¢å¯ä»¥è¯å®æŸæ•°å­—å†…å®¹çš„å®Œæ•´æ€§ï¼Œåˆå¯ä»¥ç¡®è®¤å…¶æ¥æº ä¸€ä¸ªå…¸å‹çš„åœºæ™¯æ˜¯ï¼ŒAlice é€šè¿‡ä¿¡é“å‘ç»™ Bob ä¸€ä¸ªæ–‡ä»¶ï¼ˆä¸€ä»½ä¿¡æ¯ï¼‰ï¼ŒBob å¦‚ä½•è·çŸ¥æ‰€æ”¶åˆ°çš„æ–‡ä»¶å³ä¸º Alice å‘å‡ºçš„åŸå§‹ç‰ˆæœ¬ï¼ŸAlice å¯ä»¥å…ˆå¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ‘˜è¦ï¼Œç„¶åç”¨è‡ªå·±çš„ç§é’¥å¯¹æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼ˆç­¾åï¼‰ï¼Œä¹‹ååŒæ—¶å°†æ–‡ä»¶å’Œç­¾åéƒ½å‘ç»™ Bobã€‚Bob æ”¶åˆ°æ–‡ä»¶å’Œç­¾ååï¼Œç”¨ Alice çš„å…¬é’¥æ¥è§£å¯†ç­¾åï¼Œå¾—åˆ°æ•°å­—æ‘˜è¦ï¼Œä¸å¯¹æ–‡ä»¶è¿›è¡Œæ‘˜è¦åçš„ç»“æœè¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœä¸€è‡´ï¼Œè¯´æ˜è¯¥æ–‡ä»¶ç¡®å®æ˜¯ Alice å‘è¿‡æ¥çš„ï¼ˆå› ä¸ºåˆ«äººæ— æ³•æ‹¥æœ‰ Alice çš„ç§é’¥ï¼‰ï¼Œå¹¶ä¸”æ–‡ä»¶å†…å®¹æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼ˆæ‘˜è¦ç»“æœä¸€è‡´ï¼‰ã€‚ ä»€ä¹ˆæ˜¯RSAç®—æ³•RSAæ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œç°åœ¨ä½¿ç”¨å¾—å¾ˆå¹¿æ³›ã€‚RSAå…¬å¼€å¯†é’¥å¯†ç ä½“åˆ¶ã€‚æ‰€è°“çš„å…¬å¼€å¯†é’¥å¯†ç ä½“åˆ¶å°±æ˜¯ä½¿ç”¨ä¸åŒçš„åŠ å¯†å¯†é’¥ä¸è§£å¯†å¯†é’¥ï¼Œæ˜¯ä¸€ç§â€œç”±å·²çŸ¥åŠ å¯†å¯†é’¥æ¨å¯¼å‡ºè§£å¯†å¯†é’¥åœ¨è®¡ç®—ä¸Šæ˜¯ä¸å¯è¡Œçš„â€å¯†ç ä½“åˆ¶ã€‚ å…¬é’¥åŠ å¯†çš„å†…å®¹å¯ä»¥å¹¶ä¸”åªèƒ½ç”±ç§é’¥è¿›è¡Œè§£å¯†ï¼Œå¹¶ä¸”ç”±ç§é’¥åŠ å¯†çš„å†…å®¹å¯ä»¥å¹¶ä¸”åªèƒ½ç”±å…¬é’¥è¿›è¡Œè§£å¯†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒRSAçš„è¿™ä¸€å¯¹å…¬é’¥ã€ç§é’¥éƒ½å¯ä»¥ç”¨æ¥åŠ å¯†å’Œè§£å¯†ï¼Œå¹¶ä¸”ä¸€æ–¹åŠ å¯†çš„å†…å®¹å¯ä»¥ç”±å¹¶ä¸”åªèƒ½ç”±å¯¹æ–¹è¿›è¡Œè§£å¯†ã€‚ X.509è¯ä¹¦X.509è¯ä¹¦æ ‡å‡† X.509æ˜¯å¸¸è§é€šç”¨çš„è¯ä¹¦æ ¼å¼ï¼Œå®šä¹‰äº†æ•°å­—è¯ä¹¦çš„è§„èŒƒï¼Œä¸“é—¨å®šä¹‰äº†åœ¨ç›®å½•è®¿é—®ä¸­éœ€è¦èº«ä»½è®¤è¯çš„è¯ä¹¦çš„æ ¼å¼ã€‚æ‰€æœ‰çš„è¯ä¹¦éƒ½ç¬¦åˆä¸ºPublic Key Infrastructure (PKI) åˆ¶å®šçš„ ITU-T X509 å›½é™…æ ‡å‡†ã€‚ X.509 DER ç¼–ç (ASCII)çš„åç¼€æ˜¯ï¼š .DER .CER .CRTX.509 PAM ç¼–ç (Base64)çš„åç¼€æ˜¯ï¼š .PEM .CER .CRT X.509 - è¿™æ˜¯ä¸€ç§è¯ä¹¦æ ‡å‡†,ä¸»è¦å®šä¹‰äº†è¯ä¹¦ä¸­åº”è¯¥åŒ…å«å“ªäº›å†…å®¹.å…¶è¯¦æƒ…å¯ä»¥å‚è€ƒRFC5280,SSLä½¿ç”¨çš„å°±æ˜¯è¿™ç§è¯ä¹¦æ ‡å‡†. X.509ç¼–ç æ ¼å¼ åŒæ ·çš„X.509è¯ä¹¦,å¯èƒ½æœ‰ä¸åŒçš„ç¼–ç æ ¼å¼,ç›®å‰æœ‰ä»¥ä¸‹ä¸¤ç§ç¼–ç æ ¼å¼.PEM - Privacy Enhanced Mail,æ‰“å¼€çœ‹æ–‡æœ¬æ ¼å¼,ä»¥â€â€”â€“BEGINâ€¦â€å¼€å¤´, â€œâ€”â€“ENDâ€¦â€ç»“å°¾,å†…å®¹æ˜¯BASE64ç¼–ç .æŸ¥çœ‹PEMæ ¼å¼è¯ä¹¦çš„ä¿¡æ¯:openssl x509 -in certificate.pem -text -nooutApacheå’Œ NIXæœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼.DER - Distinguished Encoding Rules,æ‰“å¼€çœ‹æ˜¯äºŒè¿›åˆ¶æ ¼å¼,ä¸å¯è¯».æŸ¥çœ‹DERæ ¼å¼è¯ä¹¦çš„ä¿¡æ¯:openssl x509 -in certificate.der -inform der -text -nooutJavaå’ŒWindowsæœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼. X.509ç›¸å…³çš„æ–‡ä»¶æ‰©å±•å è¿™æ˜¯æ¯”è¾ƒè¯¯å¯¼äººçš„åœ°æ–¹,è™½ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“æœ‰PEMå’ŒDERè¿™ä¸¤ç§ç¼–ç æ ¼å¼,ä½†æ–‡ä»¶æ‰©å±•åå¹¶ä¸ä¸€å®šå°±å«â€PEMâ€æˆ–è€…â€DERâ€,å¸¸è§çš„æ‰©å±•åé™¤äº†PEMå’ŒDERè¿˜æœ‰ä»¥ä¸‹è¿™äº›,å®ƒä»¬é™¤äº†ç¼–ç æ ¼å¼å¯èƒ½ä¸åŒä¹‹å¤–,å†…å®¹ä¹Ÿæœ‰å·®åˆ«,ä½†å¤§å¤šæ•°éƒ½èƒ½ç›¸äº’è½¬æ¢ç¼–ç æ ¼å¼.CRT - CRTåº”è¯¥æ˜¯certificateçš„ä¸‰ä¸ªå­—æ¯,å…¶å®è¿˜æ˜¯è¯ä¹¦çš„æ„æ€,å¸¸è§äºNIXç³»ç»Ÿ,æœ‰å¯èƒ½æ˜¯PEMç¼–ç ,ä¹Ÿæœ‰å¯èƒ½æ˜¯DERç¼–ç ,å¤§å¤šæ•°åº”è¯¥æ˜¯PEMç¼–ç ,ç›¸ä¿¡ä½ å·²ç»çŸ¥é“æ€ä¹ˆè¾¨åˆ«.CER - è¿˜æ˜¯certificate,è¿˜æ˜¯è¯ä¹¦,å¸¸è§äºWindowsç³»ç»Ÿ,åŒæ ·çš„,å¯èƒ½æ˜¯PEMç¼–ç ,ä¹Ÿå¯èƒ½æ˜¯DERç¼–ç ,å¤§å¤šæ•°åº”è¯¥æ˜¯DERç¼–ç .KEY - é€šå¸¸ç”¨æ¥å­˜æ”¾ä¸€ä¸ªå…¬é’¥æˆ–è€…ç§é’¥,å¹¶éX.509è¯ä¹¦,ç¼–ç åŒæ ·çš„,å¯èƒ½æ˜¯PEM,ä¹Ÿå¯èƒ½æ˜¯DER.æŸ¥çœ‹KEYçš„åŠæ³•:openssl rsa -in mykey.key -text -nooutå¦‚æœæ˜¯DERæ ¼å¼çš„è¯,åŒç†åº”è¯¥è¿™æ ·äº†:openssl rsa -in mykey.key -text -noout -inform derCSR - Certificate Signing Request PFX/P12 - predecessor of PKCS#12,å¯¹nixæœåŠ¡å™¨æ¥è¯´,ä¸€èˆ¬CRTå’ŒKEYæ˜¯åˆ†å¼€å­˜æ”¾åœ¨ä¸åŒæ–‡ä»¶ä¸­çš„,ä½†Windowsçš„IISåˆ™å°†å®ƒä»¬å­˜åœ¨ä¸€ä¸ªPFXæ–‡ä»¶ä¸­,(å› æ­¤è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†è¯ä¹¦åŠç§é’¥)è¿™æ ·ä¼šä¸ä¼šä¸å®‰å…¨ï¼Ÿåº”è¯¥ä¸ä¼š,PFXé€šå¸¸ä¼šæœ‰ä¸€ä¸ªâ€æå–å¯†ç â€,ä½ æƒ³æŠŠé‡Œé¢çš„ä¸œè¥¿è¯»å–å‡ºæ¥çš„è¯,å®ƒå°±è¦æ±‚ä½ æä¾›æå–å¯†ç ,PFXä½¿ç”¨çš„æ—¶DERç¼–ç ,å¦‚ä½•æŠŠPFXè½¬æ¢ä¸ºPEMç¼–ç ï¼Ÿopenssl pkcs12 -in for-iis.pfx -out for-iis.pem -nodesè¿™ä¸ªæ—¶å€™ä¼šæç¤ºä½ è¾“å…¥æå–ä»£ç . for-iis.pemå°±æ˜¯å¯è¯»çš„æ–‡æœ¬.ç”Ÿæˆpfxçš„å‘½ä»¤ç±»ä¼¼è¿™æ ·:openssl pkcs12 -export -out certificate.pfx -inkey privateKey.key -in certificate.crt -certfile CACert.crtå…¶ä¸­CACert.crtæ˜¯CA(æƒå¨è¯ä¹¦é¢å‘æœºæ„)çš„æ ¹è¯ä¹¦,æœ‰çš„è¯ä¹Ÿé€šè¿‡-certfileå‚æ•°ä¸€èµ·å¸¦è¿›å».è¿™ä¹ˆçœ‹æ¥,PFXå…¶å®æ˜¯ä¸ªè¯ä¹¦å¯†é’¥åº“.*JKS** - å³Java Key Storage,è¿™æ˜¯Javaçš„ä¸“åˆ©,è·ŸOpenSSLå…³ç³»ä¸å¤§,åˆ©ç”¨Javaçš„ä¸€ä¸ªå«â€keytoolâ€çš„å·¥å…·,å¯ä»¥å°†PFXè½¬ä¸ºJKS,å½“ç„¶äº†,keytoolä¹Ÿèƒ½ç›´æ¥ç”ŸæˆJKS,ä¸è¿‡åœ¨æ­¤å°±ä¸å¤šè¡¨äº†. è¯ä¹¦ç¼–ç çš„è½¬æ¢ PEMè½¬ä¸ºDER openssl x509 -in cert.crt -outform der -out cert.derDERè½¬ä¸ºPEM openssl x509 -in cert.crt -inform der -outform pem -out cert.pem(æç¤º:è¦è½¬æ¢KEYæ–‡ä»¶ä¹Ÿç±»ä¼¼,åªä¸è¿‡æŠŠx509æ¢æˆrsa,è¦è½¬CSRçš„è¯,æŠŠx509æ¢æˆreqâ€¦) PKCS æ ‡å‡†PKCSæ˜¯ç”±ç¾å›½RSAæ•°æ®å®‰å…¨å…¬å¸åŠå…¶åˆä½œä¼™ä¼´åˆ¶å®šçš„ä¸€ç»„å…¬é’¥å¯†ç å­¦æ ‡å‡†ï¼Œå…¶ä¸­åŒ…æ‹¬è¯ä¹¦ç”³è¯·ã€è¯ä¹¦æ›´æ–°ã€è¯ä¹¦ä½œåºŸè¡¨å‘å¸ƒã€æ‰©å±•è¯ä¹¦å†…å®¹ä»¥åŠæ•°å­—ç­¾åã€æ•°å­—ä¿¡å°çš„æ ¼å¼ç­‰æ–¹é¢çš„ä¸€ç³»åˆ—ç›¸å…³åè®® å¯ä»¥ç†è§£ä¸ºå¯¹æ•°å­—è¯ä¹¦çš„ç‰¹å®šå°è£…å½¢å¼ï¼Œä¸åŒå½¢å¼çš„å°è£…ç”¨åœ¨ä¸åŒçš„ä½¿ç”¨åœºåˆï¼› å¸¸ç”¨PKCSæ ‡å‡† PKCS ç›®å‰å…±å‘å¸ƒè¿‡ 15 ä¸ªæ ‡å‡†ã€‚ å¸¸ç”¨çš„æœ‰ï¼šPKCS#7 Cryptographic Message Syntax Standard ï¼šå®šä¹‰ä¸€ç§é€šç”¨çš„æ¶ˆæ¯è¯­æ³•ï¼ŒåŒ…æ‹¬æ•°å­—ç­¾åå’ŒåŠ å¯†ç­‰ç”¨äºå¢å¼ºçš„åŠ å¯†æœºåˆ¶ï¼ŒPKCS#7ä¸PEMå…¼å®¹ï¼Œæ‰€ä»¥ä¸éœ€å…¶ä»–å¯†ç æ“ä½œï¼Œå°±å¯ä»¥å°†åŠ å¯†çš„æ¶ˆæ¯è½¬æ¢æˆPEMæ¶ˆæ¯ã€‚PKCS#10 Certification Request Standardï¼šæè¿°è¯ä¹¦è¯·æ±‚è¯­æ³•ã€‚PKCS#12 Personal Information Exchange Syntax Standardï¼šæè¿°ä¸ªäººä¿¡æ¯äº¤æ¢è¯­æ³•æ ‡å‡†ã€‚æè¿°äº†å°†ç”¨æˆ·å…¬é’¥ã€ç§é’¥ã€è¯ä¹¦å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯æ‰“åŒ…çš„è¯­æ³•ã€‚ å…³äºCAçš„ä»‹ç»ä»€ä¹ˆæ˜¯è¯ä¹¦â€œè¯ä¹¦â€æ´‹æ–‡ä¹Ÿå«â€œdigital certificateâ€æˆ–â€œpublic key certificateâ€ã€‚ å®ƒæ˜¯ç”¨æ¥è¯æ˜æŸæŸä¸œè¥¿ç¡®å®æ˜¯æŸæŸä¸œè¥¿çš„ä¸œè¥¿ï¼ˆæ˜¯ä¸æ˜¯åƒç»•å£ä»¤ï¼Ÿï¼‰ã€‚é€šä¿—åœ°è¯´ï¼Œè¯ä¹¦å°±å¥½æ¯”ä¾‹å­é‡Œé¢çš„å…¬ç« ã€‚é€šè¿‡å…¬ç« ï¼Œå¯ä»¥è¯æ˜è¯¥ä»‹ç»ä¿¡ç¡®å®æ˜¯å¯¹åº”çš„å…¬å¸å‘å‡ºçš„ã€‚ ç†è®ºä¸Šï¼Œäººäººéƒ½å¯ä»¥æ‰¾ä¸ªè¯ä¹¦å·¥å…·ï¼Œè‡ªå·±åšä¸€ä¸ªè¯ä¹¦ã€‚é‚£å¦‚ä½•é˜²æ­¢åäººè‡ªå·±åˆ¶ä½œè¯ä¹¦å‡ºæ¥éª—äººæï¼Ÿè¯·çœ‹åç»­ CA çš„ä»‹ç»ã€‚ ä»€ä¹ˆæ˜¯CACAæ˜¯Certificate Authorityçš„ç¼©å†™ï¼Œä¹Ÿå«â€œè¯ä¹¦æˆæƒä¸­å¿ƒâ€ã€‚ å®ƒæ˜¯è´Ÿè´£ç®¡ç†å’Œç­¾å‘è¯ä¹¦çš„ç¬¬ä¸‰æ–¹æœºæ„ï¼Œå°±å¥½æ¯”ä¾‹å­é‡Œé¢çš„ä¸­ä»‹â€”â€”C å…¬å¸ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒCAå¿…é¡»æ˜¯æ‰€æœ‰è¡Œä¸šå’Œæ‰€æœ‰å…¬ä¼—éƒ½ä¿¡ä»»çš„ã€è®¤å¯çš„ã€‚å› æ­¤å®ƒå¿…é¡»å…·æœ‰è¶³å¤Ÿçš„æƒå¨æ€§ã€‚å°±å¥½æ¯”Aã€Bä¸¤å…¬å¸éƒ½å¿…é¡»ä¿¡ä»»Cå…¬å¸ï¼Œæ‰ä¼šæ‰¾ C å…¬å¸ä½œä¸ºå…¬ç« çš„ä¸­ä»‹ã€‚ ä»€ä¹ˆæ˜¯CAè¯ä¹¦CA è¯ä¹¦ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯CAé¢å‘çš„è¯ä¹¦ã€‚ å‰é¢å·²ç»è¯´äº†ï¼Œäººäººéƒ½å¯ä»¥æ‰¾å·¥å…·åˆ¶ä½œè¯ä¹¦ã€‚ä½†æ˜¯ä½ ä¸€ä¸ªå°ç ´å­©åˆ¶ä½œå‡ºæ¥çš„è¯ä¹¦æ˜¯æ²¡å•¥ç”¨å¤„çš„ã€‚å› ä¸ºä½ ä¸æ˜¯æƒå¨çš„CAæœºå…³ï¼Œä½ è‡ªå·±æçš„è¯ä¹¦ä¸å…·æœ‰æƒå¨æ€§ã€‚ è¿™å°±å¥½æ¯”ä¸Šè¿°çš„ä¾‹å­é‡Œï¼ŒæŸä¸ªåäººè‡ªå·±åˆ»äº†ä¸€ä¸ªå…¬ç« ï¼Œç›–åˆ°ä»‹ç»ä¿¡ä¸Šã€‚ä½†æ˜¯åˆ«äººä¸€çœ‹ï¼Œä¸æ˜¯å—ä¿¡ä»»çš„ä¸­ä»‹å…¬å¸çš„å…¬ç« ï¼Œå°±ä¸äºˆç†ç¬ã€‚åè›‹çš„é˜´è°‹å°±ä¸èƒ½å¾—é€å•¦ã€‚ ä»€ä¹ˆæ˜¯æ ¹è¯ä¹¦æ™®é€šçš„è¯ä¹¦ä¸€èˆ¬åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·å…¬é’¥ï¼Œä»¥åŠCAç­¾å é‚£ä¹ˆæˆ‘ä»¬è¦éªŒè¯è¿™å¼ è¯ä¹¦å°±éœ€è¦éªŒè¯CAç­¾åçš„çœŸä¼ªã€‚é‚£ä¹ˆå°±éœ€è¦CAå…¬é’¥ã€‚è€ŒCAå…¬é’¥å­˜åœ¨äºå¦å¤–ä¸€å¼ è¯ä¹¦ï¼ˆç§°è¿™å¼ è¯ä¹¦æ˜¯å¯¹æ™®é€šè¯ä¹¦ç­¾åçš„è¯ä¹¦ï¼‰ä¸­ã€‚å› æ­¤åˆéœ€è¦éªŒè¯å¦å¤–ä¸€å¼ è¯ä¹¦ï¼ˆç§°è¿™å¼ è¯ä¹¦æ˜¯å¯¹å¦å¤–ä¸€å¼ è¯ä¹¦ç­¾åçš„è¯ä¹¦ï¼‰çš„çœŸä¼ªã€‚ä¾æ¬¡å¾€ä¸‹å›æº¯ï¼Œå°±å¾—åˆ°ä¸€æ¡è¯ä¹¦é“¾ã€‚é‚£ä¹ˆè¿™å¼ è¯ä¹¦é“¾ä»å“ªé‡Œç»“æŸå‘¢ï¼Ÿå°±æ˜¯åœ¨æ ¹è¯ä¹¦ç»“æŸï¼ˆå³éªŒè¯åˆ°æ ¹è¯ä¹¦ç»“æŸï¼‰ã€‚æ ¹è¯ä¹¦æ˜¯ä¸ªå¾ˆç‰¹åˆ«çš„è¯ä¹¦ï¼Œå®ƒæ˜¯CAä¸­å¿ƒè‡ªå·±ç»™è‡ªå·±ç­¾åçš„è¯ä¹¦ï¼ˆå³è¿™å¼ è¯ä¹¦æ˜¯ç”¨CAå…¬é’¥å¯¹è¿™å¼ è¯ä¹¦è¿›è¡Œç­¾åï¼‰ã€‚ä¿¡ä»»è¿™å¼ è¯ä¹¦ï¼Œå°±ä»£è¡¨ä¿¡ä»»è¿™å¼ è¯ä¹¦ä¸‹çš„è¯ä¹¦é“¾ã€‚ æ‰€æœ‰ç”¨æˆ·åœ¨ä½¿ç”¨è‡ªå·±çš„è¯ä¹¦ä¹‹å‰å¿…é¡»å…ˆä¸‹è½½æ ¹è¯ä¹¦ã€‚ æ‰€è°“æ ¹è¯ä¹¦éªŒè¯å°±æ˜¯ï¼šç”¨æ ¹è¯ä¹¦å…¬é’¥æ¥éªŒè¯è¯¥è¯ä¹¦çš„é¢å‘è€…ç­¾åã€‚æ‰€ä»¥é¦–å…ˆå¿…é¡»è¦æœ‰æ ¹è¯ä¹¦ï¼Œå¹¶ä¸”æ ¹è¯ä¹¦å¿…é¡»åœ¨å—ä¿¡ä»»çš„è¯ä¹¦åˆ—è¡¨ï¼ˆå³ä¿¡ä»»åŸŸï¼‰ã€‚ è¯ä¹¦ç­¾å‘æµç¨‹ å‘æƒå¨è¯ä¹¦é¢å‘æœºæ„ç”³è¯·è¯ä¹¦ï¼Œ æŠŠæœ¬åœ°ç”Ÿæˆçš„ç”³è¯·è¯ä¹¦(åŒ…å«å…¬é’¥)ã€ç»„ç»‡ä¿¡æ¯ã€ä¸ªäººä¿¡æ¯ç­‰ äº¤ç»™æƒå¨è¯ä¹¦é¢å‘æœºæ„,æƒå¨è¯ä¹¦é¢å‘æœºæ„å¯¹æ­¤è¿›è¡Œç­¾å,å®Œæˆ.ï¼ˆä¿ç•™å¥½csr,å½“æƒå¨è¯ä¹¦é¢å‘æœºæ„é¢å‘çš„è¯ä¹¦è¿‡æœŸçš„æ—¶å€™,ä½ è¿˜å¯ä»¥ç”¨åŒæ ·çš„csræ¥ç”³è¯·æ–°çš„è¯ä¹¦,keyä¿æŒä¸å˜.ï¼‰ CA é€šè¿‡çº¿ä¸Šã€çº¿ä¸‹ç­‰å¤šç§æ‰‹æ®µéªŒè¯ç”³è¯·è€…æä¾›ä¿¡æ¯çš„çœŸå®æ€§ï¼Œå¦‚ç»„ç»‡æ˜¯å¦å­˜åœ¨ã€ä¼ä¸šæ˜¯å¦åˆæ³•ï¼Œæ˜¯å¦æ‹¥æœ‰åŸŸåçš„æ‰€æœ‰æƒç­‰ï¼› å¦‚ä¿¡æ¯å®¡æ ¸é€šè¿‡ï¼ŒCA ä¼šå‘ç”³è¯·è€…ç­¾å‘è®¤è¯æ–‡ä»¶-è¯ä¹¦ã€‚è¯ä¹¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼šç”³è¯·è€…å…¬é’¥ã€ç”³è¯·è€…çš„ç»„ç»‡ä¿¡æ¯å’Œä¸ªäººä¿¡æ¯ã€ç­¾å‘æœºæ„ CA çš„ä¿¡æ¯ã€æœ‰æ•ˆæ—¶é—´ã€è¯ä¹¦åºåˆ—å·ç­‰ä¿¡æ¯çš„æ˜æ–‡ï¼ŒåŒæ—¶åŒ…å«ä¸€ä¸ªç­¾åï¼› ç­¾åçš„äº§ç”Ÿç®—æ³•ï¼šé¦–å…ˆï¼Œä½¿ç”¨æ•£åˆ—å‡½æ•°è®¡ç®—å…¬å¼€çš„æ˜æ–‡ä¿¡æ¯çš„ä¿¡æ¯æ‘˜è¦ï¼Œç„¶åï¼Œé‡‡ç”¨ CA çš„ç§é’¥å¯¹ä¿¡æ¯æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œå¯†æ–‡å³ç­¾åï¼› å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯æµç¨‹ å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯ â€‹ å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å°†è‡ªå·±çš„è¯ä¹¦å’Œç”¨è‡ªå·±ç§é’¥åŠ å¯†çš„åŸæ–‡ï¼Œ ä»¥åŠåŸæ–‡çš„æ‘˜è¦ä¸€å¹¶è¿”å›ã€‚ æ•°å­—è¯ä¹¦æœ‰æ•ˆæ€§éªŒè¯â€‹ å®¢æˆ·ç«¯ C è¯»å–è¯ä¹¦ä¸­çš„ç›¸å…³çš„æ˜æ–‡ä¿¡æ¯ï¼Œé‡‡ç”¨ç›¸åŒçš„æ•£åˆ—å‡½æ•°è®¡ç®—å¾—åˆ°ä¿¡æ¯æ‘˜è¦ï¼Œç„¶åï¼Œåˆ©ç”¨å¯¹åº” CA çš„å…¬é’¥è§£å¯†ç­¾åæ•°æ®ï¼Œå¯¹æ¯”è¯ä¹¦çš„ä¿¡æ¯æ‘˜è¦ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™å¯ä»¥ç¡®è®¤è¯ä¹¦çš„åˆæ³•æ€§ï¼Œå³å…¬é’¥åˆæ³•ï¼› â€‹ å®¢æˆ·ç«¯ç„¶åéªŒè¯è¯ä¹¦ç›¸å…³çš„åŸŸåä¿¡æ¯ã€æœ‰æ•ˆæ—¶é—´ç­‰ä¿¡æ¯ï¼› æ ¹è¯ä¹¦éªŒè¯â€‹ å®¢æˆ·ç«¯ä¼šå†…ç½®ä¿¡ä»» CA çš„è¯ä¹¦ä¿¡æ¯(åŒ…å«å…¬é’¥)ï¼Œå¦‚æœCAä¸è¢«ä¿¡ä»»ï¼Œåˆ™æ‰¾ä¸åˆ°å¯¹åº” CA çš„è¯ä¹¦ï¼Œè¯ä¹¦ä¹Ÿä¼šè¢«åˆ¤å®šéæ³•ã€‚ CRLéªŒè¯â€‹ CRLæ˜¯ç»è¿‡CAç­¾åçš„è¯ä¹¦ä½œåºŸåˆ—è¡¨ï¼Œç”¨äºè¯ä¹¦å†»ç»“å’Œæ’¤é”€ã€‚ä¸€èˆ¬æ¥è¯´è¯ä¹¦ä¸­æœ‰CRLåœ°å€ï¼Œä¾›HTTPæˆ–è€…LDAPæ–¹å¼è®¿é—®ï¼Œé€šè¿‡è§£æå¯å¾—åˆ°CRLåœ°å€ï¼Œç„¶åä¸‹è½½CRLè¿›è¡ŒéªŒè¯ã€‚â€‹ å¹¶ä¸”è¯ä¹¦ä¸­æœ‰CRLç”Ÿæ•ˆæ—¥æœŸä»¥åŠä¸‹æ¬¡æ›´æ–°çš„æ—¥æœŸï¼Œå› æ­¤CRLæ˜¯è‡ªåŠ¨æ›´æ–°çš„ï¼Œå› æ­¤ä¼šæœ‰å»¶è¿Ÿæ€§ã€‚â€‹ äºæ˜¯å‘¢ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§æ–¹å¼OSCPè¯ä¹¦çŠ¶æ€åœ¨çº¿æŸ¥è¯¢ï¼Œå¯ä»¥å³æ—¶çš„æŸ¥è¯¢è¯ä¹¦çŠ¶æ€ã€‚ ç”¨httpsæ¥è¯´æ˜CAè®¤è¯çš„æµç¨‹SSL ä»‹ç»SSL SSL - Secure Sockets Layer,ç°åœ¨åº”è¯¥å«â€TLSâ€,ä½†ç”±äºä¹ æƒ¯é—®é¢˜,æˆ‘ä»¬è¿˜æ˜¯å«â€SSLâ€æ¯”è¾ƒå¤š.httpåè®®é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸åŠ å¯†å†…å®¹çš„,è¿™æ ·å°±å¾ˆå¯èƒ½åœ¨å†…å®¹ä¼ æ’­çš„æ—¶å€™è¢«åˆ«äººç›‘å¬åˆ°,å¯¹äºå®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åœºåˆ,å¿…é¡»è¦åŠ å¯†,httpså°±æ˜¯å¸¦åŠ å¯†çš„httpåè®®,è€Œhttpsçš„åŠ å¯†æ˜¯åŸºäºSSLçš„,å®ƒæ‰§è¡Œçš„æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸‹å±‚çš„åŠ å¯†,ä¹Ÿå°±æ˜¯è¯´,åœ¨åŠ å¯†å‰,ä½ çš„æœåŠ¡å™¨ç¨‹åºåœ¨å¹²å˜›,åŠ å¯†åä¹Ÿä¸€æ ·åœ¨å¹²å˜›,ä¸ç”¨åŠ¨,è¿™ä¸ªåŠ å¯†å¯¹ç”¨æˆ·å’Œå¼€å‘è€…æ¥è¯´éƒ½æ˜¯é€æ˜çš„ SSLæ˜¯åŸºäºéå¯¹ç§°åŠ å¯†çš„åŸç†ï¼Œåœ¨è¿™ä¹‹ä¸Šè¿˜è¿›è¡Œäº†å¯¹ç§°åŠ å¯†çš„æ•°æ®ä¼ è¾“ã€‚å½“ä¼ é€æ•°æ®é‡è¿‡å¤§çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº’ç›¸å•†å®šäº†ä¸€ä¸ªå¯¹è¯å¯†é’¥ï¼ˆsession keyï¼‰ï¼Œä½¿ç”¨è¿™ä¸ªå¯¹è¯å¯†é’¥æ¥è¿›è¡Œå¯¹ç§°åŠ å¯†åŠ å¿«è¿ç®—é€Ÿåº¦ï¼Œ æ‰€ä»¥è¯´SSLæ˜¯åŸºäºRSAè¿›è¡Œçš„æ•°æ®ä¼ è¾“ä¸Šçš„ä¼˜åŒ–ï¼Œå¯ä»¥åŠ é€ŸåŠ å¯†è¿ç®—é€Ÿåº¦ã€‚ SSL åº”ç”¨äº†RSA ï¼Œ æ•°å­—ç­¾åï¼Œéå¯¹ç§°åŠ å¯†ç­‰æŠ€æœ¯ï¼Œè§£å†³äº†ç½‘ç»œé€šè®¯è¢«ç›‘å¬ï¼Œä¼ªè£…å’Œç¯¡æ”¹ç­‰é—®é¢˜ï¼Œä¸€èˆ¬ä¼ä¸šçº§åº”ç”¨ï¼Œç°åœ¨ç¦»ä¸å¼€SSLæŠ€æœ¯ï¼› OpenSSL OpenSSL - ç®€å•åœ°è¯´,OpenSSLæ˜¯SSLçš„ä¸€ä¸ªå®ç°,SSLåªæ˜¯ä¸€ç§è§„èŒƒ.ç†è®ºä¸Šæ¥è¯´,SSLè¿™ç§è§„èŒƒæ˜¯å®‰å…¨çš„,ç›®å‰çš„æŠ€æœ¯æ°´å¹³å¾ˆéš¾ç ´è§£,ä½†SSLçš„å®ç°å°±å¯èƒ½æœ‰äº›æ¼æ´,å¦‚è‘—åçš„â€å¿ƒè„å‡ºè¡€â€.OpenSSLè¿˜æä¾›äº†ä¸€å¤§å †å¼ºå¤§çš„å·¥å…·è½¯ä»¶,å¼ºå¤§åˆ°90%æˆ‘ä»¬éƒ½ç”¨ä¸åˆ°. httpé€šä¿¡å­˜åœ¨çš„é—®é¢˜ å®¹æ˜“è¢«ç›‘å¬ httpé€šä¿¡éƒ½æ˜¯æ˜æ–‡ï¼Œæ•°æ®åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ç‚¹éƒ½å¯èƒ½è¢«åŠ«æŒã€‚æ¯”å¦‚ï¼Œå‘é€äº†é“¶è¡Œå¡å·å’Œå¯†ç ï¼ŒhackeråŠ«å–åˆ°æ•°æ®ï¼Œå°±èƒ½çœ‹åˆ°å¡å·å’Œå¯†ç ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ è¢«ä¼ªè£… httpé€šä¿¡æ—¶ï¼Œæ— æ³•ä¿è¯é€šè¡ŒåŒæ–¹æ˜¯åˆæ³•çš„ï¼Œé€šä¿¡æ–¹å¯èƒ½æ˜¯ä¼ªè£…çš„ã€‚æ¯”å¦‚ä½ è¯·æ±‚www.taobao.com,ä½ æ€ä¹ˆçŸ¥é“è¿”å›çš„æ•°æ®å°±æ˜¯æ¥è‡ªæ·˜å®ï¼Œä¸­é—´äººå¯èƒ½è¿”å›æ•°æ®ä¼ªè£…æˆæ·˜å®ã€‚ è¢«ç¯¡æ”¹ hackerä¸­é—´ç¯¡æ”¹æ•°æ®åï¼Œæ¥æ”¶æ–¹å¹¶ä¸çŸ¥é“æ•°æ®å·²ç»è¢«æ›´æ”¹ httpsè§£å†³çš„é—®é¢˜httpså¾ˆå¥½çš„è§£å†³äº†httpçš„ä¸‰ä¸ªç¼ºç‚¹ï¼ˆè¢«ç›‘å¬ã€è¢«ç¯¡æ”¹ã€è¢«ä¼ªè£…ï¼‰ï¼Œhttpsä¸æ˜¯ä¸€ç§æ–°çš„åè®®ï¼Œå®ƒæ˜¯http+SSL(TLS)çš„ç»“åˆä½“ï¼ŒSSLæ˜¯ä¸€ç§ç‹¬ç«‹åè®®ï¼Œæ‰€ä»¥å…¶å®ƒåè®®æ¯”å¦‚smtpç­‰ä¹Ÿå¯ä»¥è·Ÿsslç»“åˆã€‚httpsæ”¹å˜äº†é€šä¿¡æ–¹å¼ï¼Œå®ƒç”±ä»¥å‰çš„httpâ€”â€“&gt;tcpï¼Œæ”¹ä¸ºhttpâ€”â€”&gt;SSLâ€”â€“&gt;tcpï¼›httpsé‡‡ç”¨äº†å…±äº«å¯†é’¥åŠ å¯†+å…¬å¼€å¯†é’¥åŠ å¯†çš„æ–¹å¼ é˜²ç›‘å¬ æ•°æ®æ˜¯åŠ å¯†çš„ï¼Œæ‰€ä»¥ç›‘å¬å¾—åˆ°çš„æ•°æ®æ˜¯å¯†æ–‡ï¼Œhackerçœ‹ä¸æ‡‚ã€‚ é˜²ä¼ªè£… ä¼ªè£…åˆ†ä¸ºå®¢æˆ·ç«¯ä¼ªè£…å’ŒæœåŠ¡å™¨ä¼ªè£…ï¼Œé€šä¿¡åŒæ–¹æºå¸¦è¯ä¹¦ï¼Œè¯ä¹¦ç›¸å½“äºèº«ä»½è¯ï¼Œæœ‰è¯ä¹¦å°±è®¤ä¸ºåˆæ³•ï¼Œæ²¡æœ‰è¯ä¹¦å°±è®¤ä¸ºéæ³•ï¼Œè¯ä¹¦ç”±ç¬¬ä¸‰æ–¹é¢å¸ƒï¼Œå¾ˆéš¾ä¼ªé€  é˜²ç¯¡æ”¹ httpså¯¹æ•°æ®åšäº†æ‘˜è¦ï¼Œç¯¡æ”¹æ•°æ®ä¼šè¢«æ„ŸçŸ¥åˆ°ã€‚hackerå³ä½¿ä»ä¸­æ”¹äº†æ•°æ®ä¹Ÿç™½æ­ã€‚ httpsè®¤è¯çš„è¯¦ç»†æµç¨‹ å®¢æˆ·ç«¯å‘èµ·HTTPSè¯·æ±‚ è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯ç”¨æˆ·åœ¨æµè§ˆå™¨é‡Œè¾“å…¥ä¸€ä¸ªhttpsç½‘å€ï¼Œç„¶åè¿æ¥åˆ°serverçš„443ç«¯å£ã€‚ æœåŠ¡ç«¯çš„é…ç½®** é‡‡ç”¨HTTPSåè®®çš„æœåŠ¡å™¨å¿…é¡»è¦æœ‰ä¸€å¥—æ•°å­—è¯ä¹¦ï¼Œå¯ä»¥è‡ªå·±åˆ¶ä½œï¼Œä¹Ÿå¯ä»¥å‘ç»„ç»‡ç”³è¯·ã€‚åŒºåˆ«å°±æ˜¯è‡ªå·±é¢å‘çš„è¯ä¹¦éœ€è¦å®¢æˆ·ç«¯éªŒè¯é€šè¿‡ï¼Œæ‰å¯ä»¥ç»§ç»­è®¿é—®ï¼Œè€Œä½¿ç”¨å—ä¿¡ä»»çš„å…¬å¸ç”³è¯·çš„è¯ä¹¦åˆ™ä¸ä¼šå¼¹å‡ºæç¤ºé¡µé¢(startsslå°±æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œæœ‰1å¹´çš„å…è´¹æœåŠ¡)ã€‚è¿™å¥—è¯ä¹¦å…¶å®å°±æ˜¯ä¸€å¯¹å…¬é’¥å’Œç§é’¥ã€‚å¦‚æœå¯¹å…¬é’¥å’Œç§é’¥ä¸å¤ªç†è§£ï¼Œå¯ä»¥æƒ³è±¡æˆä¸€æŠŠé’¥åŒ™å’Œä¸€ä¸ªé”å¤´ï¼Œåªæ˜¯å…¨ä¸–ç•Œåªæœ‰ä½ ä¸€ä¸ªäººæœ‰è¿™æŠŠé’¥åŒ™ï¼Œä½ å¯ä»¥æŠŠé”å¤´ç»™åˆ«äººï¼Œåˆ«äººå¯ä»¥ç”¨è¿™ä¸ªé”æŠŠé‡è¦çš„ä¸œè¥¿é”èµ·æ¥ï¼Œç„¶åå‘ç»™ä½ ï¼Œå› ä¸ºåªæœ‰ä½ ä¸€ä¸ªäººæœ‰è¿™æŠŠé’¥åŒ™ï¼Œæ‰€ä»¥åªæœ‰ä½ æ‰èƒ½çœ‹åˆ°è¢«è¿™æŠŠé”é”èµ·æ¥çš„ä¸œè¥¿ã€‚ ä¼ é€è¯ä¹¦ æœåŠ¡ç«¯å°†è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªè¯ä¹¦å…¶å®å°±æ˜¯å…¬é’¥ï¼Œåªæ˜¯åŒ…å«äº†å¾ˆå¤šä¿¡æ¯ï¼Œå¦‚è¯ä¹¦çš„é¢å‘æœºæ„ï¼Œè¿‡æœŸæ—¶é—´ç­‰ç­‰ã€‚ å®¢æˆ·ç«¯è§£æè¯ä¹¦ è¿™éƒ¨åˆ†å·¥ä½œæ˜¯æœ‰å®¢æˆ·ç«¯çš„TLSæ¥å®Œæˆçš„ï¼Œé¦–å…ˆä¼šéªŒè¯å…¬é’¥æ˜¯å¦æœ‰æ•ˆï¼Œæ¯”å¦‚é¢å‘æœºæ„ï¼Œè¿‡æœŸæ—¶é—´ç­‰ç­‰ï¼Œå¦‚æœå‘ç°å¼‚å¸¸ï¼Œåˆ™ä¼šå¼¹å‡ºä¸€ä¸ªè­¦å‘Šæ¡†ï¼Œæç¤ºè¯ä¹¦å­˜åœ¨é—®é¢˜ã€‚å¦‚æœè¯ä¹¦æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå°±ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ã€‚ç„¶åç”¨è¯ä¹¦å¯¹è¯¥éšæœºå€¼è¿›è¡ŒåŠ å¯†ã€‚å°±å¥½åƒä¸Šé¢è¯´çš„ï¼ŒæŠŠéšæœºå€¼ç”¨é”å¤´é”èµ·æ¥ï¼Œè¿™æ ·é™¤éæœ‰é’¥åŒ™ï¼Œä¸ç„¶çœ‹ä¸åˆ°è¢«é”ä½çš„å†…å®¹ã€‚ ä¼ é€åŠ å¯†ä¿¡æ¯ è¿™éƒ¨åˆ†ä¼ é€çš„æ˜¯ç”¨è¯ä¹¦åŠ å¯†åçš„éšæœºå€¼ï¼Œç›®çš„å°±æ˜¯è®©æœåŠ¡ç«¯å¾—åˆ°è¿™ä¸ªéšæœºå€¼ï¼Œä»¥åå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šä¿¡å°±å¯ä»¥é€šè¿‡è¿™ä¸ªéšæœºå€¼æ¥è¿›è¡ŒåŠ å¯†è§£å¯†äº†ã€‚ æœåŠ¡æ®µè§£å¯†ä¿¡æ¯ æœåŠ¡ç«¯ç”¨ç§é’¥è§£å¯†åï¼Œå¾—åˆ°äº†å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„éšæœºå€¼(ç§é’¥)ï¼Œç„¶åæŠŠå†…å®¹é€šè¿‡è¯¥å€¼è¿›è¡Œå¯¹ç§°åŠ å¯†ã€‚æ‰€è°“å¯¹ç§°åŠ å¯†å°±æ˜¯ï¼Œå°†ä¿¡æ¯å’Œç§é’¥é€šè¿‡æŸç§ç®—æ³•æ··åˆåœ¨ä¸€èµ·ï¼Œè¿™æ ·é™¤éçŸ¥é“ç§é’¥ï¼Œä¸ç„¶æ— æ³•è·å–å†…å®¹ï¼Œè€Œæ­£å¥½å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½çŸ¥é“è¿™ä¸ªç§é’¥ï¼Œæ‰€ä»¥åªè¦åŠ å¯†ç®—æ³•å¤Ÿå½ªæ‚ï¼Œç§é’¥å¤Ÿå¤æ‚ï¼Œæ•°æ®å°±å¤Ÿå®‰å…¨ã€‚ ä¼ è¾“åŠ å¯†åçš„ä¿¡æ¯ è¿™éƒ¨åˆ†ä¿¡æ¯æ˜¯æœåŠ¡æ®µç”¨ç§é’¥åŠ å¯†åçš„ä¿¡æ¯ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯è¢«è¿˜åŸã€‚ å®¢æˆ·ç«¯è§£å¯†ä¿¡æ¯ å®¢æˆ·ç«¯ç”¨ä¹‹å‰ç”Ÿæˆçš„ç§é’¥è§£å¯†æœåŠ¡æ®µä¼ è¿‡æ¥çš„ä¿¡æ¯ï¼Œäºæ˜¯è·å–äº†è§£å¯†åçš„å†…å®¹ã€‚æ•´ä¸ªè¿‡ç¨‹ç¬¬ä¸‰æ–¹å³ä½¿ç›‘å¬åˆ°äº†æ•°æ®ï¼Œä¹ŸæŸæ‰‹æ— ç­–ã€‚ æ€»ç»“æ•´ä¸ªè¿‡ç¨‹ï¼š â€‹ 1ï¼‰æœåŠ¡å™¨å‘CAæœºæ„è·å–è¯ä¹¦ï¼ˆå‡è®¾è¿™ä¸ªè¯ä¹¦ä¼ªé€ ä¸äº†ï¼‰ï¼Œå½“æµè§ˆå™¨é¦–æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨è¿”å›è¯ä¹¦ç»™æµè§ˆå™¨ã€‚ï¼ˆè¯ä¹¦åŒ…å«ï¼šå…¬é’¥+ç”³è¯·è€…ä¸é¢å‘è€…çš„ç›¸å…³ä¿¡æ¯+ç­¾åï¼‰ â€‹ 2ï¼‰æµè§ˆå™¨å¾—åˆ°è¯ä¹¦åï¼Œå¼€å§‹éªŒè¯è¯ä¹¦çš„ç›¸å…³ä¿¡æ¯ï¼Œè¯ä¹¦æœ‰æ•ˆï¼ˆæ²¡è¿‡æœŸç­‰ï¼‰ã€‚ï¼ˆéªŒè¯è¿‡ç¨‹ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œè¯¦è§ä¸Šæ–‡ï¼‰ã€‚ â€‹ 3ï¼‰éªŒè¯å®Œè¯ä¹¦åï¼Œå¦‚æœè¯ä¹¦æœ‰æ•ˆï¼Œå®¢æˆ·ç«¯æ˜¯ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œç„¶åç”¨è¯ä¹¦ä¸­çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼ŒåŠ å¯†åï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç”¨ç§é’¥è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°éšæœºæ•°ã€‚ä¹‹ååŒæ–¹ä¾¿å¼€å§‹ç”¨è¯¥éšæœºæ•°ä½œä¸ºé’¥åŒ™ï¼Œå¯¹è¦ä¼ é€’çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€è§£å¯†ã€‚ åç»­çš„é—®é¢˜ æ€æ ·ä¿è¯å…¬å¼€å¯†é’¥çš„æœ‰æ•ˆæ€§ ä½ ä¹Ÿè®¸ä¼šæƒ³åˆ°ï¼Œæ€ä¹ˆä¿è¯å®¢æˆ·ç«¯æ”¶åˆ°çš„å…¬å¼€å¯†é’¥æ˜¯åˆæ³•çš„ï¼Œä¸æ˜¯ä¼ªé€ çš„ï¼Œè¯ä¹¦å¾ˆå¥½çš„å®Œæˆäº†è¿™ä¸ªä»»åŠ¡ã€‚è¯ä¹¦ç”±æƒå¨çš„ç¬¬ä¸‰æ–¹æœºæ„é¢å‘ï¼Œå¹¶ä¸”å¯¹å…¬å¼€å¯†é’¥åšäº†ç­¾åã€‚ httpsçš„ç¼ºç‚¹ httpsä¿è¯äº†é€šä¿¡çš„å®‰å…¨ï¼Œä½†å¸¦æ¥äº†åŠ å¯†è§£å¯†æ¶ˆè€—è®¡ç®—æœºcpuèµ„æºçš„é—®é¢˜ ï¼Œä¸è¿‡ï¼Œæœ‰ä¸“é—¨çš„httpsåŠ è§£å¯†ç¡¬ä»¶æœåŠ¡å™¨ å„å¤§äº’è”ç½‘å…¬å¸ï¼Œç™¾åº¦ã€æ·˜å®ã€æ”¯ä»˜å®ã€çŸ¥ä¹éƒ½ä½¿ç”¨httpsåè®®ï¼Œä¸ºä»€ä¹ˆï¼Ÿ æ”¯ä»˜å®æ¶‰åŠåˆ°é‡‘èï¼Œæ‰€ä»¥å‡ºäºå®‰å…¨è€ƒè™‘é‡‡ç”¨httpsè¿™ä¸ªï¼Œå¯ä»¥ç†è§£ï¼Œä¸ºä»€ä¹ˆç™¾åº¦ã€çŸ¥ä¹ç­‰ä¹Ÿé‡‡ç”¨è¿™ç§æ–¹å¼ï¼Ÿä¸ºäº†é˜²æ­¢è¿è¥å•†åŠ«æŒï¼httpé€šä¿¡æ—¶ï¼Œè¿è¥å•†åœ¨æ•°æ®ä¸­æ’å…¥å„ç§å¹¿å‘Šï¼Œç”¨æˆ·çœ‹åˆ°åï¼Œæ€’ç«å‘åˆ°äº’è”ç½‘å…¬å¸ï¼Œå…¶å®è¿™äº›åäº‹éƒ½æ˜¯è¿è¥å•†(ç§»åŠ¨ã€è”é€šã€ç”µä¿¡)å¹²çš„,ç”¨äº†httpsï¼Œè¿è¥å•†å°±æ²¡æ³•æ’æ’­å¹¿å‘Šç¯¡æ”¹æ•°æ®äº†ã€‚]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>åŒºå—é“¾æ¦‚å¿µ</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>Fabric</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fabric SDK é…ç½®æ–‡ä»¶]]></title>
    <url>%2F2019%2F04%2F02%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2FHyperledger%20fabric%2F2.Fabric%20SDK%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[ä¸€ã€Fabric SDKé…ç½®FabricåŒºå—é“¾ç½‘ç»œåº”ç”¨ç¨‹åºéœ€è¦å¤§é‡çš„å‚æ•°ï¼Œç”¨äºè¿æ¥FabricåŒºå—é“¾ç½‘ç»œã€‚é€šå¸¸å°†FabricåŒºå—é“¾ç½‘ç»œåº”ç”¨ç¨‹åºæ‰€éœ€çš„å‚æ•°æ”¾åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œç®¡ç†ï¼Œé…ç½®æ–‡ä»¶å®šä¹‰Fabric SDK Goçš„é…ç½®å’Œç”¨æˆ·è‡ªå®šä¹‰å‚æ•°ï¼ŒæŒ‡å®šäº†è¿æ¥FabricåŒºå—é“¾ç½‘ç»œæ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚FabricåŒºå—é“¾ç½‘ç»œç»„ä»¶çš„ä¸»æœºåå’Œç«¯å£ç­‰ã€‚Fabric SDK GOä¸ºåº”ç”¨ç¨‹åºæä¾›çš„é…ç½®æ–‡ä»¶é€šå¸¸ä½¿ç”¨yamlæ–‡ä»¶æ ¼å¼ç¼–å†™ï¼Œå¹¶å‘½åä¸ºconfig.yamlï¼Œé…ç½®æ–‡ä»¶ä¼šåœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­è¢«è¯»å–ã€‚Fabric SDK Goç‰ˆæœ¬æä¾›äº†config.yamlæ¨¡æ¿ï¼Œå¼€å‘è€…å¯ä»¥å‚è€ƒfabric-sdk-go/pkg/core/config/testdata/template/config.yamlï¼Œä¹Ÿå¯ä»¥æ ¹æ®fabric-sdk-go/test/fixtures/config/config_e2e.yamlå®ä¾‹è¿›è¡Œæ”¹å†™ã€‚ äºŒã€versionå®šä¹‰versionç”¨äºå®šä¹‰config.yamlæ–‡ä»¶å†…å®¹çš„ç‰ˆæœ¬ï¼ŒFabric SDK Goä¼šä½¿ç”¨versionåŒ¹é…ç›¸åº”çš„è§£æè§„åˆ™ã€‚version: 1.0.0 ä¸‰ã€channelså®šä¹‰channelséƒ¨åˆ†æè¿°å·²ç»å­˜åœ¨çš„é€šé“ä¿¡æ¯ï¼Œæ¯ä¸ªé€šé“åŒ…å«å“ªäº›ordererã€peer ã€‚peeréƒ¨åˆ†å¯ä»¥å®šä¹‰peerèŠ‚ç‚¹çš„è§’è‰²å±æ€§ï¼Œè§’è‰²å¦‚ä¸‹ï¼šendorsingPeerï¼šå¯é€‰ã€‚peerèŠ‚ç‚¹èŠ‚ç‚¹å¿…é¡»å®‰è£…é“¾ç ã€‚peerèŠ‚ç‚¹æ˜¯å¦ä¼šè¢«å‘é€äº¤æ˜“ææ¡ˆè¿›è¡ŒèƒŒä¹¦ã€‚åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬å±æ€§æ¥å†³å®šå‘é€é“¾ç å®‰è£…è¯·æ±‚åˆ°å“ªä¸ªpeerèŠ‚ç‚¹ã€‚é»˜è®¤å€¼ï¼štrueã€‚chaincodeQueryï¼šå¯é€‰ã€‚peerèŠ‚ç‚¹å¿…é¡»å®‰è£…é“¾ç ã€‚peerèŠ‚ç‚¹æ˜¯å¦ä¼šè¢«å‘é€äº¤æ˜“ææ¡ˆåªè¿›è¡ŒæŸ¥è¯¢ã€‚åº”ç”¨ç¨‹åºè¿˜å¯ä»¥ä½¿ç”¨æœ¬å±æ€§æ¥å†³å®šå‘é€é“¾ç å®‰è£…çš„è¯·æ±‚åˆ°å“ªä¸ªpeerèŠ‚ç‚¹ã€‚é»˜è®¤å€¼ï¼štrueã€‚ledgerQueryï¼šå¯é€‰ã€‚æ˜¯å¦å¯ä»¥å‘peerèŠ‚ç‚¹å‘é€ä¸ä¼šè¿›è¡Œé“¾ç æŸ¥è¯¢çš„ææ¡ˆï¼Œå¦‚queryBlockï¼ˆï¼‰ï¼ŒqueryTransactionï¼ˆï¼‰ç­‰ã€‚é»˜è®¤å€¼ï¼štrueã€‚eventSourceï¼šå¯é€‰ã€‚peerèŠ‚ç‚¹æ˜¯å¦ä¸ºSDKäº‹ä»¶ç›‘å¬å™¨æ³¨å†Œçš„ç›®æ ‡ï¼Œæ‰€æœ‰çš„peerèŠ‚ç‚¹éƒ½å¯ä»¥ç”Ÿäº§äº‹ä»¶ï¼Œä½†é€šå¸¸åªéœ€è¦è¿æ¥ä¸€ä¸ªå¯¹äº‹ä»¶è¿›è¡Œç›‘å¬ã€‚é»˜è®¤å€¼ï¼štrueã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102# å¦‚æœåº”ç”¨ç¨‹åºåˆ›å»ºäº†é€šé“ï¼Œä¸éœ€è¦æœ¬éƒ¨åˆ†channels: # å¦‚æœæ²¡æœ‰å®šä¹‰channelé…ç½®æˆ–æ˜¯å®šä¹‰çš„channelæ²¡æœ‰ä¿¡æ¯ï¼Œä½¿ç”¨é»˜è®¤channel # å¦‚æœchannelæ²¡æœ‰å®šä¹‰peersï¼Œä½¿ç”¨é»˜è®¤channelçš„peers # å¦‚æœchannelæ²¡æœ‰å®šä¹‰orderesï¼Œä½¿ç”¨é»˜è®¤channelçš„orderes # å¦‚æœchannelæ²¡æœ‰å®šä¹‰èƒŒä¹¦ç­–ç•¥ï¼Œä½¿ç”¨é»˜è®¤channelçš„èƒŒä¹¦ç­–ç•¥ # å¦‚æœchannelå®šä¹‰äº†èƒŒä¹¦ç­–ç•¥ï¼Œä½†æŸäº›èƒŒä¹¦ç­–ç•¥ç¼ºå¤±ï¼Œç¼ºå¤±çš„èƒŒä¹¦ç­–ç•¥ä¼šè¢«é»˜è®¤channelå¡«å…… _default: # å¯é€‰ï¼Œå‚ä¸ç»„ç»‡çš„peersåˆ—è¡¨ peers: peer1.org1.example.com: endorsingPeer: true chaincodeQuery: true ledgerQuery: true eventSource: true # å¯é€‰ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨ä¸‹åˆ—é€‰é¡¹æ‰§è¡Œé€šé“æ“ä½œï¼Œå¦‚è·å–é€šé“é…ç½® policies: #å¯é€‰ï¼Œè·å–é€šé“é…ç½®åŒºå— queryChannelConfig: #å¯é€‰ï¼ŒæˆåŠŸå“åº”èŠ‚ç‚¹çš„æœ€å°æ•°é‡ minResponses: 1 # å¯é€‰ maxTargets: 1 # å¯é€‰ï¼ŒæŸ¥è¯¢é…ç½®åŒºå—çš„é‡è¯•é€‰é¡¹ retryOpts: # å¯é€‰ï¼Œé‡è¯•æ¬¡æ•° attempts: 5 # å¯é€‰ï¼Œ ç¬¬ä¸€æ¬¡é‡è¯•çš„åé€€é—´éš” initialBackoff: 500ms # å¯é€‰ï¼Œ é‡è¯•çš„æœ€å¤§åé€€é—´éš” maxBackoff: 5s backoffFactor: 2.0 # å¯é€‰ï¼Œè·å–å‘ç°ä¿¡æ¯é€‰é¡¹ discovery: maxTargets: 2 # é‡è¯•é€‰é¡¹ retryOpts: # å¯é€‰ï¼Œé‡è¯•æ¬¡æ•° attempts: 4 initialBackoff: 500ms maxBackoff: 5s backoffFactor: 2.0 # å¯é€‰ï¼Œäº‹ä»¶æœåŠ¡é€‰é¡¹ eventService: # å¯é€‰ resolverStrategyæŒ‡å®šè¿æ¥åˆ°peerèŠ‚ç‚¹æ—¶é€‰æ‹©peerèŠ‚ç‚¹çš„å†³ç­–ç­–ç•¥ # å¯é€‰å€¼:PreferOrgï¼ˆé»˜è®¤ï¼‰, MinBlockHeight, Balanced # PreferOrg: # åŸºäºåŒºå—é«˜åº¦æ»åé˜€å€¼å†³å®šå“ªäº›peerèŠ‚ç‚¹æ˜¯åˆé€‚çš„ï¼Œ è™½ç„¶ä¼šåœ¨å½“å‰ç»„ç»‡ä¸­ä¼˜å…ˆé€‰æ‹©peerèŠ‚ç‚¹ # å¦‚æœå½“å‰ç»„ç»‡ä¸­æ²¡æœ‰åˆé€‚çš„peerèŠ‚ç‚¹ï¼Œä¼šä»å…¶å®ƒç»„ç»‡ä¸­é€‰å– # MinBlockHeight: # æ ¹æ®åŒºå—é«˜åº¦æ»åé˜€å€¼é€‰æ‹©æœ€å¥½çš„peerèŠ‚ç‚¹ï¼Œ # æ‰€æœ‰peerèŠ‚ç‚¹çš„æœ€å¤§åŒºå—é«˜åº¦æ˜¯ç¡®å®šçš„ï¼ŒåŒºå—é«˜åº¦å°äºæœ€å¤§åŒºå—é«˜åº¦ä½†åœ¨æ»åé˜€å€¼èŒƒå›´å†…çš„peerèŠ‚ç‚¹ä¼šè¢«åŠ è½½ï¼Œ # å…¶å®ƒpeerèŠ‚ç‚¹ä¸ä¼šè¢«è€ƒè™‘ã€‚ # Balanced: # ä½¿ç”¨é…ç½®çš„balanceré€‰æ‹©peerèŠ‚ç‚¹ resolverStrategy: PreferOrg # å¯é€‰ balanceræ˜¯é€‰æ‹©è¿æ¥åˆ°peerèŠ‚ç‚¹çš„è´Ÿè½½å‡è¡¡å™¨ # å¯é€‰å€¼: Random (default), RoundRobin balancer: Random # å¯é€‰ï¼ŒblockHeightLagThresholdè®¾ç½®åŒºå—é«˜åº¦æ»åé˜€å€¼ï¼Œç”¨äºé€‰æ‹©è¿æ¥åˆ°çš„peerèŠ‚ç‚¹ # å¦‚æœä¸€ä¸ªpeerèŠ‚ç‚¹æ»åäºæœ€æ–°çš„peerèŠ‚ç‚¹ç»™å®šçš„åŒºå—æ•°ï¼Œä¼šè¢«æ’é™¤åœ¨é€‰æ‹©ä¹‹å¤– # æ³¨æ„ï¼šå½“minBlockHeightResolverModeè®¾ç½®ä¸ºResolveByThresholdæ—¶ï¼Œæœ¬å‚æ•°æ‰å¯ç”¨ # é»˜è®¤: 5 blockHeightLagThreshold: 5 # å¯é€‰ï¼ŒreconnectBlockHeightLagThreshold - å¦‚æœpeerèŠ‚ç‚¹çš„åŒºå—é«˜åº¦è½åäºæŒ‡å®šçš„åŒºå—æ•°é‡ï¼Œ # äº‹ä»¶å®¢æˆ·ç«¯ä¼šä»peerèŠ‚ç‚¹æ–­å¼€ï¼Œé‡æ–°è¿æ¥åˆ°ä¸€ä¸ªæ€§èƒ½æ›´å¥½çš„peerèŠ‚ç‚¹ # å¦‚æœpeerMonitorè®¾ç½®ä¸ºå¯ç”¨ï¼ˆé»˜è®¤ï¼‰ï¼Œæœ¬å‚æ•°æ‰å¯ç”¨ # é»˜è®¤å€¼: 10 # æ³¨æ„ï¼šè®¾ç½®å€¼å¤ªä½ä¼šå¯¼è‡´äº‹ä»¶å®¢æˆ·ç«¯é¢‘ç¹æ–­å¼€æˆ–é‡è¿ï¼Œå½±å“æ€§èƒ½ reconnectBlockHeightLagThreshold: 8 # å¯é€‰ï¼Œ peerMonitorPeriodæ˜¯äº‹ä»¶å®¢æˆ·ç«¯ä»è¿æ¥èŠ‚ç‚¹æ–­å¼€é‡æ–°è¿æ¥åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶é—´ # é»˜è®¤: å¯¹äºBalanced resolverStrategyç¦ç”¨ï¼Œä¸º0; å¯¹äºPreferOrgå’ŒMinBlockHeightä¸º5s peerMonitorPeriod: 6s #å¦‚æœ_defaultæ²¡æœ‰å®šä¹‰ï¼Œå¿…é€‰ï¼›å¦‚æœ_defaultå·²ç»å®šä¹‰ï¼Œå¯é€‰ã€‚ # é€šé“åç§° assetchannel: # å¦‚æœ_default peersæ²¡æœ‰å®šä¹‰ï¼Œå¿…é€‰ï¼›å¦‚æœ_default peerså·²ç»å®šä¹‰ï¼Œå¯é€‰ã€‚ # å‚ä¸ç»„ç»‡çš„peerèŠ‚ç‚¹åˆ—è¡¨ peers: peer0.org1.example.com: # å¯é€‰ã€‚peerèŠ‚ç‚¹æ˜¯å¦ä¼šè¢«å‘é€äº¤æ˜“æè®®åªè¿›è¡ŒæŸ¥è¯¢ã€‚peerèŠ‚ç‚¹å¿…é¡»å®‰è£…é“¾ç ã€‚ # åº”ç”¨ç¨‹åºè¿˜å¯ä»¥ä½¿ç”¨æœ¬å±æ€§æ¥å†³å®šå‘é€é“¾ç å®‰è£…çš„è¯·æ±‚åˆ°å“ªä¸ªpeerèŠ‚ç‚¹ã€‚é»˜è®¤å€¼ï¼štrue endorsingPeer: true # å¯é€‰ã€‚peerèŠ‚ç‚¹å¿…é¡»å®‰è£…é“¾ç ã€‚peerèŠ‚ç‚¹æ˜¯å¦ä¼šè¢«å‘é€äº¤æ˜“ææ¡ˆåªè¿›è¡ŒæŸ¥è¯¢ã€‚ # åº”ç”¨ç¨‹åºè¿˜å¯ä»¥ä½¿ç”¨æœ¬å±æ€§æ¥å†³å®šå‘é€é“¾ç å®‰è£…çš„è¯·æ±‚åˆ°å“ªä¸ªpeerèŠ‚ç‚¹ã€‚é»˜è®¤å€¼ï¼štrue chaincodeQuery: true # å¯é€‰ã€‚æ˜¯å¦å¯ä»¥å‘peerèŠ‚ç‚¹å‘é€ä¸ä¼šè¿›è¡Œé“¾ç æŸ¥è¯¢çš„ææ¡ˆï¼Œå¦‚queryBlockï¼ˆï¼‰ï¼Œ # queryTransactionï¼ˆï¼‰ç­‰ã€‚é»˜è®¤å€¼ï¼štrueã€‚ ledgerQuery: true # å¯é€‰ã€‚peerèŠ‚ç‚¹æ˜¯å¦ä¸ºSDKäº‹ä»¶ç›‘å¬å™¨æ³¨å†Œçš„ç›®æ ‡ï¼Œæ‰€æœ‰çš„peerèŠ‚ç‚¹éƒ½å¯ä»¥ç”Ÿäº§äº‹ä»¶ï¼Œ # ä½†é€šå¸¸åªéœ€è¦è¿æ¥ä¸€ä¸ªå¯¹äº‹ä»¶è¿›è¡Œç›‘å¬ã€‚é»˜è®¤å€¼ï¼štrueã€‚ eventSource: true å››ã€organizationså®šä¹‰organizationsæè¿°peerèŠ‚ç‚¹æ‰€å±çš„ç»„ç»‡(org)ï¼Œè¯ä¹¦é¢å‘æœºæ„ï¼Œä»¥åŠç»„ç»‡çš„MSP IDã€‚ 123456789101112131415161718192021222324252627282930# FabricåŒºå—é“¾ç½‘ç»œä¸­å‚ä¸çš„ç»„ç»‡åˆ—è¡¨organizations: org1: mspid: Org1MSP # ç»„ç»‡çš„MSPå­˜å‚¨ä½ç½®ï¼Œç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹cryptoconfigçš„è·¯å¾„ cryptoPath: peerOrganizations/org1.example.com/users/&#123;username&#125;@org1.example.com/msp peers: - peer0.org1.example.com - peer1.org1.example.com # å¯é€‰ï¼Œè¯ä¹¦é¢å‘æœºæ„ç­¾å‘Ã—Ã—Ã—æ˜ï¼ŒFabric-CAæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¯ä¹¦ç®¡ç†æœºæ„ï¼Œæä¾›REST APIæ”¯æŒåŠ¨æ€è¯ä¹¦ç®¡ç†ï¼Œå¦‚ç™»è®°ã€æ’¤é”€ã€é‡æ–°ç™»è®° # ä¸‹åˆ—éƒ¨åˆ†åªä¸ºFabric-CAæœåŠ¡å™¨è®¾ç½® certificateAuthorities: - ca.org1.example.com org2: mspid: Org2MSP # ç»„ç»‡çš„MSPå­˜å‚¨ä½ç½®ï¼Œç›¸å¯¹äºcryptoconfigçš„ç›¸å¯¹ä½ç½®æˆ–ç»å¯¹è·¯å¾„ cryptoPath: peerOrganizations/org2.example.com/users/&#123;username&#125;@org2.example.com/msp peers: - peer0.org2.example.com certificateAuthorities: - ca.org2.example.com # Ordererç»„ç»‡åç§° ordererorg: # ç»„ç»‡çš„MSPID mspID: OrdererMSP # åŠ è½½ç”¨æˆ·éœ€è¦çš„å¯†é’¥å’Œè¯ä¹¦ï¼Œç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ cryptoPath: ordererOrganizations/example.com/users/&#123;username&#125;@example.com/msp äº”ã€ordererså®šä¹‰ordererså¿…é¡»æŒ‡å®šè¦è¿æ¥çš„Hyperledger FabricåŒºå—é“¾ç½‘ç»œä¸­æ‰€æœ‰orderderèŠ‚ç‚¹çš„ä¸»æœºåå’Œç«¯å£ã€‚ordererså¯¹è±¡å¯ä»¥åŒ…å«å¤šä¸ªorderderèŠ‚ç‚¹ã€‚ 1234567891011121314151617181920# å‘é€äº¤æ˜“è¯·æ±‚æˆ–é€šé“åˆ›å»ºã€æ›´æ–°è¯·æ±‚åˆ°çš„orderersåˆ—è¡¨# å¦‚æœå®šä¹‰äº†è¶…è¿‡ä¸€ä¸ªordererï¼ŒSDKä½¿ç”¨å“ªä¸€ä¸ªordererç”±ä»£ç å®ç°æ—¶æŒ‡å®šorderers: # ordererèŠ‚ç‚¹ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª orderer.example.com: url: orderer.example.com:7050 # ä»¥ä¸‹å±æ€§ç”±gRPCåº“å®šä¹‰ï¼Œä¼šè¢«ä¼ é€’ç»™gRPCå®¢æˆ·ç«¯æ„é€ å‡½æ•° grpcOptions: ssl-target-name-override: orderer.example.com # ä¸‹åˆ—å‚æ•°ç”¨äºè®¾ç½®æœåŠ¡å™¨ä¸Šçš„keepaliveç­–ç•¥ï¼Œä¸å…¼å®¹çš„è®¾ç½®ä¼šå¯¼è‡´è¿æ¥å…³é—­ # å½“keep-alive-timeè¢«è®¾ç½®ä¸º0æˆ–å°äºæ¿€æ´»å®¢æˆ·ç«¯çš„å‚æ•°ï¼Œä¸‹åˆ—å‚æ•°å¤±æ•ˆ keep-alive-time: 0s keep-alive-timeout: 20s keep-alive-permit: false fail-fast: false allow-insecure: false tlsCACerts: # è¯ä¹¦çš„ç»å¯¹è·¯å¾„ path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/ordererOrganizations/example.com/tlsca/tlsca.example.com-cert.pem å…­ã€peerså®šä¹‰peerså¿…é¡»æŒ‡å®šHyperledger FabricåŒºå—é“¾ç½‘ç»œä¸­æ‰€æœ‰peerèŠ‚ç‚¹çš„ä¸»æœºåå’Œç«¯å£ï¼Œå¯èƒ½ä¼šåœ¨å…¶å®ƒåœ°æ–¹å¼•ç”¨ï¼Œå¦‚channelsï¼Œorganizationsç­‰éƒ¨åˆ†ã€‚ 123456789101112131415161718# peersèŠ‚ç‚¹åˆ—è¡¨peers: # peerèŠ‚ç‚¹å®šä¹‰ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª peer0.org1.example.com: # URLç”¨äºå‘é€èƒŒä¹¦å’ŒæŸ¥è¯¢è¯·æ±‚ url: peer0.org1.example.com:7051 grpcOptions: ssl-target-name-override: peer0.org1.example.com keep-alive-time: 0s keep-alive-timeout: 20s keep-alive-permit: false fail-fast: false allow-insecure: false tlsCACerts: # è¯ä¹¦çš„ç»å¯¹è·¯å¾„ path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem ä¸ƒã€certificateAuthoritieså®šä¹‰certificateAuthoritieså¿…é¡»åœ¨Hyperledger FabricåŒºå—é“¾ç½‘ç»œä¸­æŒ‡å®šè¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„ä¸»æœºåå’Œç«¯å£ï¼Œä»¥ä¾¿ç”¨äºæ³¨å†Œç°æœ‰ç”¨æˆ·å’Œæ³¨å†Œæ–°ç”¨æˆ·ã€‚ 12345678910111213141516171819202122# Fabric-CAæ˜¯Hyperledger Fabricæä¾›äº†ç‰¹æ®Šçš„è¯ä¹¦é¢å‘æœºæ„ï¼Œå¯ä»¥é€šè¿‡REST APIç®¡ç†è¯ä¹¦ã€‚# åº”ç”¨ç¨‹åºå¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸€ä¸ªæ ‡å‡†çš„è¯ä¹¦é¢å‘æœºæ„ä»£æ›¿Fabric-CAï¼Œæ­¤æ—¶æœ¬éƒ¨åˆ†ä¸éœ€è¦æŒ‡å®šcertificateAuthorities: # CAæœºæ„ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª ca.org1.example.com: url: https://ca.org1.example.com:7054 tlsCACerts: # Comma-Separated list of paths path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem # å®¢æˆ·ç«¯å’ŒFabric CAè¿›è¡ŒSSLæ¡æ‰‹çš„å¯†é’¥å’Œè¯ä¹¦ client: key: path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/peerOrganizations/tls.example.com/users/User1@tls.example.com/tls/client.key cert: path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/peerOrganizations/tls.example.com/users/User1@tls.example.com/tls/client.crt # Fabric-CAæ”¯æŒé€šè¿‡REST APIè¿›è¡ŒåŠ¨æ€ç”¨æˆ·æ³¨å†Œ registrar: enrollId: admin enrollSecret: adminpw # å¯é€‰ï¼ŒCAæœºæ„åç§° caName: ca.org1.example.com å…«ã€clientclientéƒ¨åˆ†å¿…éœ€å®šä¹‰ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä»£è¡¨è°æ¥å’ŒFabricåŒºå—é“¾ç½‘ç»œæ¥äº¤äº’ï¼Œå¯ä»¥å®šä¹‰è¶…æ—¶é€‰é¡¹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970#å®¢æˆ·ç«¯å®šä¹‰client: # å®¢æˆ·ç«¯æ‰€å±çš„ç»„ç»‡ï¼Œå¿…é¡»æ˜¯organizationså®šä¹‰çš„ç»„ç»‡ organization: org1 #å®šä¹‰æ—¥å¿—æœåŠ¡ logging: level: debug #debugçº§åˆ« # peerã€äº‹ä»¶æœåŠ¡ã€ordererè¶…æ—¶çš„å…¨å±€é…ç½® # æœ¬éƒ¨åˆ†å¦‚æœå¿½ç•¥ï¼Œä½¿ç”¨ä¸‹åˆ—çš„å€¼ä½œä¸ºé»˜è®¤å€¼ peer: timeout: connection: 10s response: 180s discovery: greylistExpiry: 10s eventService: timeout: registrationResponse: 15s orderer: timeout: connection: 15s response: 15s global: timeout: query: 180s execute: 180s resmgmt: 180s cache: connectionIdle: 30s eventServiceIdle: 2m channelConfig: 30m channelMembership: 30s discovery: 10s selection: 10m # MSPæ ¹ç›®å½• cryptoconfig: path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric/AssetExchange/deploy/crypto-config # æŸäº›SDKæ”¯æŒæ’ä»¶åŒ–çš„KVæ•°æ®åº“, é€šè¿‡æŒ‡å®šcredentialStoreå±æ€§å®ç° credentialStore: # å¯é€‰ï¼Œç”¨äºç”¨æˆ·è¯ä¹¦ææ–™å­˜å‚¨ï¼Œå¦‚æœæ‰€æœ‰çš„è¯ä¹¦ææ–™è¢«åµŒå…¥åˆ°é…ç½®æ–‡ä»¶ï¼Œåˆ™ä¸éœ€è¦ path: &quot;/tmp/state-store&quot; # å¯é€‰ï¼ŒæŒ‡å®šGo SDKå®ç°çš„CryptoSuiteå®ç° cryptoStore: # æŒ‡å®šç”¨äºåŠ å¯†å¯†é’¥å­˜å‚¨çš„åº•å±‚KVæ•°æ®åº“ path: /tmp/msp # å®¢æˆ·ç«¯çš„BCCSPæ¨¡å—é…ç½® BCCSP: security: enabled: true default: provider: &quot;SW&quot; hashAlgorithm: &quot;SHA2&quot; softVerify: true level: 256 tlsCerts: # å¯é€‰ï¼Œå½“è¿æ¥åˆ°peersï¼Œorderesæ—¶ä½¿ç”¨ç³»ç»Ÿè¯ä¹¦æ± ï¼Œé»˜è®¤ä¸ºfalse systemCertPool: true # å¯é€‰ï¼Œå®¢æˆ·ç«¯å’Œpeersä¸orderesè¿›è¡ŒTLSæ¡æ‰‹çš„å¯†é’¥å’Œè¯ä¹¦ client: key: path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/peerOrganizations/tls.example.com/users/User1@tls.example.com/tls/client.key cert: path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/peerOrganizations/tls.example.com/users/User1@tls.example.com/tls/client.crt ä¹ã€config.yamlç¤ºä¾‹èµ„äº§äº¤æ˜“å¹³å°åº”ç”¨çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170# Copyright SecureKey Technologies Inc. All Rights Reserved.## SPDX-License-Identifier: Apache-2.0### The network connection profile provides client applications the information about the target# blockchain network that are necessary for the applications to interact with it. These are all# knowledge that must be acquired from out-of-band sources. This file provides such a source.name: &quot;assetchannel&quot;## Describe what the target network is/does.#description: &quot;asset exchange network&quot;#æŒ‡å®šç‰ˆæœ¬version: 1.0.0#å®¢æˆ·ç«¯å®šä¹‰client: # å®¢æˆ·ç«¯æ‰€å±çš„ç»„ç»‡ï¼Œå¿…é¡»æ˜¯organizationså®šä¹‰çš„ç»„ç»‡ organization: org1 #å®šä¹‰æ—¥å¿—æœåŠ¡ logging: level: debug #debugçº§åˆ« # MSPæ ¹ç›®å½• cryptoconfig: path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric/AssetExchange/deploy/crypto-config # æŸäº›SDKæ”¯æŒæ’ä»¶åŒ–çš„KVæ•°æ®åº“, é€šè¿‡æŒ‡å®šcredentialStoreå±æ€§å®ç° credentialStore: # å¯é€‰ï¼Œç”¨äºç”¨æˆ·è¯ä¹¦ææ–™å­˜å‚¨ï¼Œå¦‚æœæ‰€æœ‰çš„è¯ä¹¦ææ–™è¢«åµŒå…¥åˆ°é…ç½®æ–‡ä»¶ï¼Œåˆ™ä¸éœ€è¦ path: &quot;/tmp/state-store&quot; # å¯é€‰ï¼ŒæŒ‡å®šGo SDKå®ç°çš„CryptoSuiteå®ç° cryptoStore: # æŒ‡å®šç”¨äºåŠ å¯†å¯†é’¥å­˜å‚¨çš„åº•å±‚KVæ•°æ®åº“ path: /tmp/msp # å®¢æˆ·ç«¯çš„BCCSPæ¨¡å—é…ç½® BCCSP: security: enabled: true default: provider: &quot;SW&quot; hashAlgorithm: &quot;SHA2&quot; softVerify: true level: 256 tlsCerts: # å¯é€‰ï¼Œå½“è¿æ¥åˆ°peersï¼Œorderesæ—¶ä½¿ç”¨ç³»ç»Ÿè¯ä¹¦æ± ï¼Œé»˜è®¤ä¸ºfalse systemCertPool: true # å¯é€‰ï¼Œå®¢æˆ·ç«¯å’Œpeersä¸orderesè¿›è¡ŒTLSæ¡æ‰‹çš„å¯†é’¥å’Œè¯ä¹¦ client: key: # path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/peerOrganizations/tls.example.com/users/User1@tls.example.com/tls/client.key cert: #path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/peerOrganizations/tls.example.com/users/User1@tls.example.com/tls/client.crt# å¦‚æœåº”ç”¨ç¨‹åºåˆ›å»ºäº†é€šé“ï¼Œä¸éœ€è¦æœ¬éƒ¨åˆ†channels: # å¦‚æœæ²¡æœ‰å®šä¹‰channelé…ç½®æˆ–æ˜¯å®šä¹‰çš„channelæ²¡æœ‰ä¿¡æ¯ï¼Œä½¿ç”¨é»˜è®¤channel # å¦‚æœchannelæ²¡æœ‰å®šä¹‰peersï¼Œä½¿ç”¨é»˜è®¤channelçš„peers # å¦‚æœchannelæ²¡æœ‰å®šä¹‰orderesï¼Œä½¿ç”¨é»˜è®¤channelçš„orderes # å¦‚æœchannelæ²¡æœ‰å®šä¹‰èƒŒä¹¦ç­–ç•¥ï¼Œä½¿ç”¨é»˜è®¤channelçš„èƒŒä¹¦ç­–ç•¥ # å¦‚æœchannelå®šä¹‰äº†èƒŒä¹¦ç­–ç•¥ï¼Œä½†æŸäº›èƒŒä¹¦ç­–ç•¥ç¼ºå¤±ï¼Œç¼ºå¤±çš„èƒŒä¹¦ç­–ç•¥ä¼šè¢«é»˜è®¤channelå¡«å…… #å¦‚æœ_defaultæ²¡æœ‰å®šä¹‰ï¼Œå¿…é€‰ï¼›å¦‚æœ_defaultå·²ç»å®šä¹‰ï¼Œå¯é€‰ã€‚ # é€šé“åç§° assetchannel: # å¦‚æœ_default peersæ²¡æœ‰å®šä¹‰ï¼Œå¿…é€‰ï¼›å¦‚æœ_default peerså·²ç»å®šä¹‰ï¼Œå¯é€‰ã€‚ # å‚ä¸ç»„ç»‡çš„peerèŠ‚ç‚¹åˆ—è¡¨ peers: peer0.org1.example.com: # å¯é€‰ã€‚peerèŠ‚ç‚¹æ˜¯å¦ä¼šè¢«å‘é€äº¤æ˜“æè®®åªè¿›è¡ŒæŸ¥è¯¢ã€‚peerèŠ‚ç‚¹å¿…é¡»å®‰è£…é“¾ç ã€‚ # åº”ç”¨ç¨‹åºè¿˜å¯ä»¥ä½¿ç”¨æœ¬å±æ€§æ¥å†³å®šå‘é€é“¾ç å®‰è£…çš„è¯·æ±‚åˆ°å“ªä¸ªpeerèŠ‚ç‚¹ã€‚é»˜è®¤å€¼ï¼štrue endorsingPeer: true # å¯é€‰ã€‚peerèŠ‚ç‚¹å¿…é¡»å®‰è£…é“¾ç ã€‚peerèŠ‚ç‚¹æ˜¯å¦ä¼šè¢«å‘é€äº¤æ˜“ææ¡ˆåªè¿›è¡ŒæŸ¥è¯¢ã€‚ # åº”ç”¨ç¨‹åºè¿˜å¯ä»¥ä½¿ç”¨æœ¬å±æ€§æ¥å†³å®šå‘é€é“¾ç å®‰è£…çš„è¯·æ±‚åˆ°å“ªä¸ªpeerèŠ‚ç‚¹ã€‚é»˜è®¤å€¼ï¼štrue chaincodeQuery: true # å¯é€‰ã€‚æ˜¯å¦å¯ä»¥å‘peerèŠ‚ç‚¹å‘é€ä¸ä¼šè¿›è¡Œé“¾ç æŸ¥è¯¢çš„ææ¡ˆï¼Œå¦‚queryBlockï¼ˆï¼‰ï¼Œ # queryTransactionï¼ˆï¼‰ç­‰ã€‚é»˜è®¤å€¼ï¼štrueã€‚ ledgerQuery: true # å¯é€‰ã€‚peerèŠ‚ç‚¹æ˜¯å¦ä¸ºSDKäº‹ä»¶ç›‘å¬å™¨æ³¨å†Œçš„ç›®æ ‡ï¼Œæ‰€æœ‰çš„peerèŠ‚ç‚¹éƒ½å¯ä»¥ç”Ÿäº§äº‹ä»¶ï¼Œ # ä½†é€šå¸¸åªéœ€è¦è¿æ¥ä¸€ä¸ªå¯¹äº‹ä»¶è¿›è¡Œç›‘å¬ã€‚é»˜è®¤å€¼ï¼štrueã€‚ eventSource: true # å¯é€‰ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨ä¸‹åˆ—é€‰é¡¹æ‰§è¡Œé€šé“æ“ä½œï¼Œå¦‚è·å–é€šé“é…ç½® policies: #å¯é€‰ï¼Œè·å–é€šé“é…ç½®åŒºå— queryChannelConfig: #å¯é€‰ï¼ŒæˆåŠŸå“åº”èŠ‚ç‚¹çš„æœ€å°æ•°é‡ minResponses: 1 # å¯é€‰ maxTargets: 1 # å¯é€‰ï¼ŒæŸ¥è¯¢é…ç½®åŒºå—çš„é‡è¯•é€‰é¡¹ retryOpts: # å¯é€‰ï¼Œé‡è¯•æ¬¡æ•° attempts: 5 # å¯é€‰ï¼Œ ç¬¬ä¸€æ¬¡é‡è¯•çš„åé€€é—´éš” initialBackoff: 500ms # å¯é€‰ï¼Œ é‡è¯•çš„æœ€å¤§åé€€é—´éš” maxBackoff: 5s backoffFactor: 2.0# FabricåŒºå—é“¾ç½‘ç»œä¸­å‚ä¸çš„ç»„ç»‡åˆ—è¡¨organizations: org1: mspid: Org1MSP # ç»„ç»‡çš„MSPå­˜å‚¨ä½ç½®ï¼Œç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹cryptoconfigçš„è·¯å¾„ cryptoPath: peerOrganizations/org1.example.com/users/&#123;username&#125;@org1.example.com/msp peers: - peer0.org1.example.com - peer1.org1.example.com # å¯é€‰ï¼Œè¯ä¹¦é¢å‘æœºæ„ç­¾å‘Ã—Ã—Ã—æ˜ï¼ŒFabric-CAæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¯ä¹¦ç®¡ç†æœºæ„ï¼Œæä¾›REST APIæ”¯æŒåŠ¨æ€è¯ä¹¦ç®¡ç†ï¼Œå¦‚ç™»è®°ã€æ’¤é”€ã€é‡æ–°ç™»è®° # ä¸‹åˆ—éƒ¨åˆ†åªä¸ºFabric-CAæœåŠ¡å™¨è®¾ç½® certificateAuthorities: #- ca.org1.example.com # Ordererç»„ç»‡åç§° ordererorg: # ç»„ç»‡çš„MSPID mspID: OrdererMSP # åŠ è½½ç”¨æˆ·éœ€è¦çš„å¯†é’¥å’Œè¯ä¹¦ï¼Œç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ cryptoPath: ordererOrganizations/example.com/users/&#123;username&#125;@example.com/msp# å‘é€äº¤æ˜“è¯·æ±‚æˆ–é€šé“åˆ›å»ºã€æ›´æ–°è¯·æ±‚åˆ°çš„orderersåˆ—è¡¨# å¦‚æœå®šä¹‰äº†è¶…è¿‡ä¸€ä¸ªordererï¼ŒSDKä½¿ç”¨å“ªä¸€ä¸ªordererç”±ä»£ç å®ç°æ—¶æŒ‡å®šorderers: # ordererèŠ‚ç‚¹ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª orderer.example.com: url: orderer.example.com:7050 # ä»¥ä¸‹å±æ€§ç”±gRPCåº“å®šä¹‰ï¼Œä¼šè¢«ä¼ é€’ç»™gRPCå®¢æˆ·ç«¯æ„é€ å‡½æ•° grpcOptions: ssl-target-name-override: orderer.example.com # ä¸‹åˆ—å‚æ•°ç”¨äºè®¾ç½®æœåŠ¡å™¨ä¸Šçš„keepaliveç­–ç•¥ï¼Œä¸å…¼å®¹çš„è®¾ç½®ä¼šå¯¼è‡´è¿æ¥å…³é—­ # å½“keep-alive-timeè¢«è®¾ç½®ä¸º0æˆ–å°äºæ¿€æ´»å®¢æˆ·ç«¯çš„å‚æ•°ï¼Œä¸‹åˆ—å‚æ•°å¤±æ•ˆ keep-alive-time: 0s keep-alive-timeout: 20s keep-alive-permit: false fail-fast: false allow-insecure: false tlsCACerts: # è¯ä¹¦çš„ç»å¯¹è·¯å¾„ # path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/ordererOrganizations/example.com/tlsca/tlsca.example.com-cert.pem# peersèŠ‚ç‚¹åˆ—è¡¨peers: # peerèŠ‚ç‚¹å®šä¹‰ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª peer0.org1.example.com: # URLç”¨äºå‘é€èƒŒä¹¦å’ŒæŸ¥è¯¢è¯·æ±‚ url: peer0.org1.example.com:7051 grpcOptions: ssl-target-name-override: peer0.org1.example.com keep-alive-time: 0s keep-alive-timeout: 20s keep-alive-permit: false fail-fast: false allow-insecure: false tlsCACerts: # è¯ä¹¦çš„ç»å¯¹è·¯å¾„ #path: $&#123;GOPATH&#125;/src/github.com/hyperledger/fabric-sdk-go/$&#123;CRYPTOCONFIG_FIXTURES_PATH&#125;/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>Hyperledger fabric</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>Fabric</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fabricç½‘ç»œæ­å»º]]></title>
    <url>%2F2019%2F03%2F21%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2FHyperledger%20fabric%2F1.Fabric%E7%BD%91%E7%BB%9C%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[ç¯å¢ƒæ­å»ºDocker å®‰è£…123curl -fsSl &lt;https://get.docker.com/&gt; | shsystemctl enable dockerservice docker start Docker-compose å®‰è£…1yum -y install epel-release &amp;&amp; yum -y install python-pip &amp;&amp; pip install docker-compose Goå®‰è£…123456789wget https://dl.google.com/go/go1.11.5.linux-amd64.tar.gztar -C /usr/local -zxvf go1.11.5.linux-amd64.tar.gzecho &quot;export GOROOT=/usr/local/go&quot; &gt;&gt; /etc/profileecho &quot;export GOBIN=/opt/prod/go/bin&quot; &gt;&gt; /etc/profileecho &quot;export GOPATH=/opt/prod/go&quot; &gt;&gt; /etc/profileecho &quot;export PATH=/opt/prod/go/bin:$PATH&quot; &gt;&gt; /etc/profileecho &quot;export PATH=/usr/local/go/bin:$PATH&quot; &gt;&gt; /etc/profilesource /etc/profilemkdir /opt/prod/go ä¸‹è½½Fabricç»„ä»¶bootstrap.shæ–‡ä»¶å¯ä»¥é€šè¿‡ç½‘ç»œä¸‹è½½ 12curl -sSL https://raw.githubusercontent.com/hyperledger/fabric/master/scripts/bootstrap.sh | bash 1.4.0 -s # ä¸‹è½½FabricäºŒè¿›åˆ¶æ–‡ä»¶ Image ä»¥åŠç¤ºä¾‹æ–‡ä»¶cp fabric-sample/bin/* $/GOPATH/bin Fabric-sdk-goä¸‹è½½githubåœ°å€: https://github.com/hyperledger/fabric-sdk-go.git sdk ç¼–è¯‘ï¼Œ æœ€å¥½åœ¨å¤–ç½‘è¿›è¡Œç¼–è¯‘ï¼Œç”¨VPNå®¹æ˜“è¶…æ—¶ 12make pupulatemake depend ç½‘ç»œé…ç½®åˆ›å»ºç›®å½•ç»“æ„åˆ›å»ºä¸€ä¸ªç›®å½•ç”¨æ¥å­˜å‚¨Fabricçš„æ‰€æœ‰é…ç½®æ–‡ä»¶ 12mkdir -p /opt/prod/Fabric/network # å­˜å‚¨Fabricæ‰€æœ‰é…ç½®æ–‡ä»¶mkdir -p /opt/prod/Fabric/network/channel-artifacts # å­˜æ”¾åˆ›ä¸–åŒºå—ä»¥åŠé€šé“é…ç½®æ–‡ä»¶ç­‰ ç”ŸæˆMSPåˆ›å»ºMSPé…ç½®ä¿¡æ¯ç¼–è¾‘MSPé…ç½®æ–‡ä»¶ crypto-config.yaml 12345678910111213141516171819202122# æ’åºèŠ‚ç‚¹é…ç½®OrdererOrgs: - Name: Orderer # æ’åºèŠ‚ç‚¹åç§° Domain: myfab.com # æ’åºèŠ‚ç‚¹åŸŸå Specs: - Hostname: orderer # æ’åºèŠ‚ç‚¹HOST PeerOrgs: - Name: Org1 # èŠ‚ç‚¹åç§° Domain: org1.myfab.com # èŠ‚ç‚¹åŸŸå EnableNodeOUs: true #å¦‚æœè®¾ç½®äº†EnableNodeOUsï¼Œå°±åœ¨mspä¸‹ç”Ÿæˆconfig.yamlæ–‡ä»¶ Template: Count: 2 # è¡¨ç¤ºç”Ÿæˆå‡ ä¸ªpeer Users: Count: 3 # è¡¨ç¤ºç”Ÿæˆå‡ ä¸ªuser(admin é™¤å¤–) - Name: Org2 Domain: org2.myfab.com EnableNodeOUs: true Template: Count: 2 Users: Count: 2 Template.Count æŒ‡å®šäº†æ‰€è¦ç”Ÿæˆçš„èŠ‚ç‚¹æ•°é‡ Users.Count æŒ‡å®šäº†éœ€è¦ç”Ÿæˆçš„åˆå§‹åŒ–ç”¨æˆ·æ•°é‡ã€‚ ç”ŸæˆMSPæ–‡ä»¶ç³»ç»Ÿ1cryptogen generate --config=./crypto-config.yaml å°†ä¼šç”Ÿæˆä¸€ä¸ªåä¸ºcrypto-configçš„ç›®å½•ï¼Œé‡Œé¢å­˜å‚¨äº†order å’Œpeer çš„MSPæ–‡ä»¶ç³»ç»Ÿï¼› ä½¿ç”¨è¯¥cryptogenå·¥å…·ä¸ºå„ç§ç½‘ç»œå®ä½“ç”ŸæˆåŠ å¯†ææ–™ï¼ˆx509è¯ä¹¦å’Œç­¾åå¯†é’¥ï¼‰ã€‚è¿™äº›è¯ä¹¦ä»£è¡¨èº«ä»½ï¼Œå®ƒä»¬å…è®¸åœ¨æˆ‘ä»¬çš„å®ä½“è¿›è¡Œé€šä¿¡å’Œäº¤æ˜“æ—¶è¿›è¡Œç­¾å/éªŒè¯èº«ä»½éªŒè¯ã€‚ Cryptogenä½¿ç”¨æ–‡ä»¶ - crypto-config.yamlåŒ…å«ç½‘ç»œæ‹“æ‰‘ï¼Œå¹¶å…è®¸æˆ‘ä»¬ä¸ºç»„ç»‡å’Œå±äºè¿™äº›ç»„ç»‡çš„ç»„ä»¶ç”Ÿæˆä¸€ç»„è¯ä¹¦å’Œå¯†é’¥ã€‚æ¯ä¸ªç»„ç»‡éƒ½é…ç½®äº†ä¸€ä¸ªå”¯ä¸€çš„æ ¹è¯ä¹¦ï¼ˆca-certï¼‰ï¼Œå®ƒå°†ç‰¹å®šç»„ä»¶ï¼ˆåŒè¡Œå’Œè®¢è´­è€…ï¼‰ç»‘å®šåˆ°è¯¥ç»„ç»‡ã€‚ MSPæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223. ## Orderer ç»„ç»‡é…ç½®â”œâ”€â”€ ordererOrganizationsâ”‚ â”‚â”‚ â””â”€â”€ example.comâ”‚ â”‚â”‚ â”œâ”€â”€ ca ## å­˜æ”¾ç»„ç»‡æ ¹è¯ä¹¦ åŠ ç§é’¥ (é‡‡ç”¨ECç®—æ³•) è¯ä¹¦ä¸ºã€è‡ªç­¾åã€‘ï¼Œç»„ç»‡å†…çš„å®ä½“å°†ç»™äºˆè¯¥æ ¹è¯ä¹¦ä½œä¸ºè¯ä¹¦æ ¹â”‚ â”‚â”‚ â”‚ â”œâ”€â”€ 56d9c0c46acdda38a174a5ba3ffc44726a2c027e16bb22b460413acbcb9b3a90_skâ”‚ â”‚ â”‚â”‚ â”‚ â””â”€â”€ ca.example.com-cert.pemâ”‚ â”‚â”‚ â”œâ”€â”€ msp ## å­˜æ”¾è¯¥ç»„ç»‡èº«ä»½ä¿¡æ¯â”‚ â”‚ â”‚â”‚ â”‚ â”œâ”€â”€ admincerts ## ç»„ç»‡ç®¡ç†å‘˜ èº«ä»½éªŒè¯è¯ä¹¦ï¼Œã€è¢«æ ¹è¯ä¹¦ç­¾åã€‘â”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â””â”€â”€ Admin@example.com-cert.pemâ”‚ â”‚ â”‚â”‚ â”‚ â”œâ”€â”€ cacerts ## ç»„ç»‡çš„æ ¹è¯ä¹¦ ã€å’ŒCAç›®å½• é‡Œé¢ä¸€è‡´ã€‘â”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â””â”€â”€ ca.example.com-cert.pemâ”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlscacerts ## ç”¨äºTLSçš„CAè¯ä¹¦ï¼Œ ã€è‡ªç­¾åã€‘â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlsca.example.com-cert.pem â”‚ â”‚â”‚ â”‚â”‚ â”œâ”€â”€ orderers ## å­˜æ”¾æ‰€æœ‰ Orderer çš„èº«ä»½ä¿¡æ¯ â”‚ â”‚ â”‚â”‚ â”‚ â””â”€â”€ orderer.example.com ## ç¬¬ä¸€ä¸ª Orderer çš„ä¿¡æ¯ msp åŠ tlsâ”‚ â”‚ â”‚â”‚ â”‚ â”œâ”€â”€ mspâ”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ admincerts ## ç»„ç»‡ç®¡ç†å‘˜çš„èº«ä»½éªŒè¯è¯ä¹¦ã€‚Peerå°†ç»™äºˆè¿™äº›è¯ä¹¦æ¥ç¡®è®¤äº¤æ˜“ç­¾åæ˜¯å¦ä¸ºç®¡ç†å‘˜ç­¾å ã€å’ŒMSP.admincerts ä¸€è‡´ã€‘â”‚ â”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Admin@example.com-cert.pemâ”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â”œâ”€â”€ cacertsâ”‚ â”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ca.example.com-cert.pem ## å­˜æ”¾ç»„ç»‡æ ¹è¯ä¹¦ï¼Œã€å’ŒCAç›®å½• é‡Œé¢ä¸€è‡´ã€‘â”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â”œâ”€â”€ keystore ## æœ¬èŠ‚ç‚¹çš„èº«ä»½ç§é’¥ï¼Œç”¨æ¥ç­¾åâ”‚ â”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â”‚ â””â”€â”€ 2ec1193fe048848eaa8e20666e26c527b791c4fb127d69cae65095bd31b6c80e_skâ”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â”œâ”€â”€ signcerts ## éªŒè¯æœ¬èŠ‚ç‚¹ç­¾åçš„è¯ä¹¦ï¼Œã€è¢«æ ¹è¯ä¹¦ç­¾åã€‘â”‚ â”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â”‚ â””â”€â”€ orderer.example.com-cert.pemâ”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â””â”€â”€ tlscacerts ## TLSè¿æ¥ç”¨çš„èº«ä»½è¯ä¹¦ï¼Œ ã€å’Œmsp.tlscacerts ä¸€è‡´ã€‘â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlsca.example.com-cert.pemâ”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tls ## tls çš„ç›¸å…³ä¿¡æ¯â”‚ â”‚ â”œâ”€â”€ ca.crt ## ã€ç»„ç»‡çš„æ ¹è¯ä¹¦ã€‘â”‚ â”‚ â”œâ”€â”€ server.crt ## éªŒè¯æœ¬èŠ‚ç‚¹ç­¾åçš„è¯ä¹¦ï¼Œ ã€è¢«æ ¹è¯ä¹¦ç­¾åã€‘â”‚ â”‚ â””â”€â”€ server.key ## æœ¬èŠ‚ç‚¹çš„èº«ä»½ç§é’¥ï¼Œç”¨æ¥ç­¾åâ”‚ â”‚ â”‚ â”œâ”€â”€ tlsca ## å­˜æ”¾tlsç›¸å…³çš„è¯ä¹¦å’Œç§é’¥â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2d66be83c519da67bb36b0972256a3b24357fa7f5b3a61f11405bc8b1f4d7c53_skâ”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlsca.example.com-cert.pemâ”‚ â”‚ â”‚ â””â”€â”€ users ## å­˜æ”¾å±äºè¯¥ç»„ç»‡çš„ç”¨æˆ·çš„å®ä½“â”‚ â”‚ â”‚ â””â”€â”€ Admin@example.com ## ç®¡ç†å‘˜ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬mspè¯ä¹¦å’Œtlsè¯ä¹¦ä¸¤ç±»â”‚ â”‚ â”‚ â”œâ”€â”€ mspâ”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ admincerts ## ç»„ç»‡æ ¹è¯ä¹¦ä½œä¸ºç®¡ç†å‘˜èº«ä»½éªŒè¯è¯ä¹¦ï¼Œã€å’ŒMSP.admincerts ä¸€è‡´ã€‘â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Admin@example.com-cert.pemâ”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ cacerts ## å­˜æ”¾ç»„ç»‡çš„æ ¹è¯ä¹¦ï¼Œã€å’ŒCAç›®å½• é‡Œé¢ä¸€è‡´ã€‘â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ca.example.com-cert.pemâ”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ keystore ## æœ¬ç”¨æˆ·çš„èº«ä»½ç§é’¥ï¼Œç”¨æ¥ç­¾åâ”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ a3c1d7e1bc464faf2e3a205cb76ea231bd3ee7010655d3cd31dc6cb78726c4d0_skâ”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ signcerts ## ç®¡ç†å‘˜ç”¨æˆ·çš„èº«ä»½éªŒè¯è¯ä¹¦ï¼Œè¢«ç»„ç»‡æ ¹è¯ä¹¦ç­¾åã€‚è¦è¢«æŸä¸ªOrdererè®¤å¯ï¼Œåˆ™å¿…é¡»æ”¾åˆ°è¯¥ Orderer çš„msp/admincertsç›®å½•ä¸‹â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Admin@example.com-cert.pemâ”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlscacerts ## TLSè¿æ¥ç”¨çš„èº«ä»½è¯ä¹¦ï¼Œå³ç»„ç»‡TLSè¯ä¹¦ï¼Œã€å’Œmsp.tlscacerts ä¸€è‡´ã€‘â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlsca.example.com-cert.pemâ”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tls ## tls çš„ç›¸å…³ä¿¡æ¯â”‚ â”œâ”€â”€ ca.crtâ”‚ â”œâ”€â”€ client.crt ## ç®¡ç†å‘˜çš„èº«ä»½éªŒè¯è¯ä¹¦ï¼Œã€è¢« ç»„ç»‡æ ¹è¯ä¹¦ç­¾åã€‘â”‚ â””â”€â”€ client.key ## ç®¡ç†å‘˜çš„èº«ä»½ç§é’¥ï¼Œç”¨æ¥ç­¾åâ”‚ â”‚ â”‚ â”‚ ## Peer ç»„ç»‡é…ç½®â””â”€â”€ peerOrganizations â”‚ â”œâ”€â”€ org1.example.com ## ç¬¬ä¸€ä¸ªç»„ç»‡çš„æ‰€æœ‰èº«ä»½è¯ä¹¦ â”‚ â”‚ â”‚ â”œâ”€â”€ ca ## å­˜æ”¾ç»„ç»‡æ ¹è¯ä¹¦åŠç§é’¥ (é‡‡ç”¨ECç®—æ³•) è¯ä¹¦ä¸ºã€è‡ªç­¾åã€‘ï¼Œç»„ç»‡å†…çš„å®ä½“å°†ç»™äºˆè¯¥æ ¹è¯ä¹¦ä½œä¸ºè¯ä¹¦æ ¹ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 496d6a41ae5f66bf120df3eab3a9d2dc4d268b2ab9a22af891d33d323bbdb5c8_sk â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ca.org1.example.com-cert.pem â”‚ â”‚ â”‚ â”œâ”€â”€ msp ## å­˜æ”¾è¯¥ç»„ç»‡èº«ä»½ä¿¡æ¯ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ admincerts ## ç»„ç»‡ç®¡ç†å‘˜ èº«ä»½éªŒè¯è¯ä¹¦ï¼Œã€è¢«æ ¹è¯ä¹¦ç­¾åã€‘ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Admin@org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ cacerts ## ç»„ç»‡çš„æ ¹è¯ä¹¦ ã€å’ŒCAç›®å½• é‡Œé¢ä¸€è‡´ã€‘ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ca.org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ config.yaml ## è®°å½• OrganizationalUnitIdentitifiers ä¿¡æ¯ï¼ŒåŒ…æ‹¬ æ ¹è¯ä¹¦ä½ç½® å’Œ IDä¿¡æ¯ (ä¸»è¦æ˜¯ crypto-config.yaml çš„peeré…ç½®ä¸­é…äº† EnableNodeOUs: true ï¼š å¦‚æœè®¾ç½®äº†EnableNodeOUsï¼Œå°±åœ¨mspä¸‹ç”Ÿæˆconfig.yamlæ–‡ä»¶) â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlscacerts ## ç”¨äºTLSçš„CAè¯ä¹¦ï¼Œ ã€è‡ªç­¾åã€‘ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlsca.org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ peers ## å­˜æ”¾æ‰€æœ‰ Peer çš„èº«ä»½ä¿¡æ¯ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ peer0.org1.example.com ## ç¬¬ä¸€ä¸ªPeerçš„ä¿¡æ¯ msp åŠ tls â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ msp â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ admincerts ## ç»„ç»‡ç®¡ç†å‘˜çš„èº«ä»½éªŒè¯è¯ä¹¦ã€‚Peerå°†ç»™äºˆè¿™äº›è¯ä¹¦æ¥ç¡®è®¤äº¤æ˜“ç­¾åæ˜¯å¦ä¸ºç®¡ç†å‘˜ç­¾å ã€å’ŒMSP.admincerts ä¸€è‡´ã€‘ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Admin@org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ cacerts ## å­˜æ”¾ç»„ç»‡æ ¹è¯ä¹¦ï¼Œã€å’ŒCAç›®å½• é‡Œé¢ä¸€è‡´ã€‘ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ca.org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ config.yaml â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ keystore ## æœ¬èŠ‚ç‚¹çš„èº«ä»½ç§é’¥ï¼Œç”¨æ¥ç­¾å â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ 0f0c2e1835086161f6a10c4bb38c2d89b2cee4e1128cee0fcda4433feb6eb6f8_sk â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ signcerts ## éªŒè¯æœ¬èŠ‚ç‚¹ç­¾åçš„è¯ä¹¦ï¼Œã€è¢«æ ¹è¯ä¹¦ç­¾åã€‘ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ peer0.org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlscacerts ## TLSè¿æ¥ç”¨çš„èº«ä»½è¯ä¹¦ï¼Œ ã€å’Œmsp.tlscacerts ä¸€è‡´ã€‘ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlsca.org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€tls ## tls çš„ç›¸å…³ä¿¡æ¯ â”‚ â”‚ â”‚ â”œâ”€â”€ ca.crt ## ã€ç»„ç»‡çš„æ ¹è¯ä¹¦ã€‘ â”‚ â”‚ â”‚ â”œâ”€â”€ server.crt ## éªŒè¯æœ¬èŠ‚ç‚¹ç­¾åçš„è¯ä¹¦ï¼Œ ã€è¢«æ ¹è¯ä¹¦ç­¾åã€‘ â”‚ â”‚ â”‚ â””â”€â”€ server.key ## æœ¬èŠ‚ç‚¹çš„èº«ä»½ç§é’¥ï¼Œç”¨æ¥ç­¾å â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ peer1.org1.example.com â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ tlsca ## å­˜æ”¾tlsç›¸å…³çš„è¯ä¹¦å’Œç§é’¥ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 3d39ea82dd5343c261b0480bc13d645a3cee13b7e7aa8c54fd2b5162f709671f_sk â”‚ â”‚ â””â”€â”€ tlsca.org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ users ## å­˜æ”¾å±äºè¯¥ç»„ç»‡çš„ç”¨æˆ·çš„å®ä½“ â”‚ â”‚ â”‚ â”œâ”€â”€ Admin@org1.example.com ## ç®¡ç†å‘˜ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬mspè¯ä¹¦å’Œtlsè¯ä¹¦ä¸¤ç±» â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ msp â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ admincerts ## ç»„ç»‡æ ¹è¯ä¹¦ä½œä¸ºç®¡ç†å‘˜èº«ä»½éªŒè¯è¯ä¹¦ï¼Œã€å’ŒMSP.admincerts ä¸€è‡´ã€‘ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Admin@org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ cacerts ## å­˜æ”¾ç»„ç»‡çš„æ ¹è¯ä¹¦ï¼Œã€å’ŒCAç›®å½• é‡Œé¢ä¸€è‡´ã€‘ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ca.org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ keystore ## æœ¬ç”¨æˆ·çš„èº«ä»½ç§é’¥ï¼Œç”¨æ¥ç­¾å â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ 2b933c0740d857284be98ff218bf279261e55eff2b89d973e0a1f435f7c7d28b_sk â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ signcerts ## ç®¡ç†å‘˜ç”¨æˆ·çš„èº«ä»½éªŒè¯è¯ä¹¦ï¼Œè¢«ç»„ç»‡æ ¹è¯ä¹¦ç­¾åã€‚è¦è¢«æŸä¸ªPeerè®¤å¯ï¼Œåˆ™å¿…é¡»æ”¾åˆ°è¯¥Peerçš„msp/admincertsç›®å½•ä¸‹ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Admin@org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlscacerts ## TLSè¿æ¥ç”¨çš„èº«ä»½è¯ä¹¦ï¼Œå³ç»„ç»‡TLSè¯ä¹¦ï¼Œã€å’Œmsp.tlscacerts ä¸€è‡´ã€‘ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tlsca.org1.example.com-cert.pem â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tls ## tls çš„ç›¸å…³ä¿¡æ¯ â”‚ â”‚ â”œâ”€â”€ ca.crt â”‚ â”‚ â”œâ”€â”€ client.crt ## ç®¡ç†å‘˜çš„èº«ä»½éªŒè¯è¯ä¹¦ï¼Œã€è¢« ç»„ç»‡æ ¹è¯ä¹¦ç­¾åã€‘ â”‚ â”‚ â””â”€â”€ client.key ## ç®¡ç†å‘˜çš„èº«ä»½ç§é’¥ï¼Œç”¨æ¥ç­¾å â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ User1@org1.example.com â”‚ â”œâ”€â”€ msp â”‚ â”‚ â”œâ”€â”€ admincerts ## ç»„ç»‡æ ¹è¯ä¹¦ä½œä¸ºç®¡ç†å‘˜èº«ä»½éªŒè¯è¯ä¹¦ â”‚ â”‚ â”‚ â””â”€â”€ User1@org1.example.com-cert.pem â”‚ â”‚ â”œâ”€â”€ cacerts ## å­˜æ”¾ç»„ç»‡çš„æ ¹è¯ä¹¦ï¼Œã€å’ŒCAç›®å½• é‡Œé¢ä¸€è‡´ã€‘ â”‚ â”‚ â”‚ â””â”€â”€ ca.org1.example.com-cert.pem â”‚ â”‚ â”œâ”€â”€ keystore ## ã€å‚è€ƒadminã€‘ â”‚ â”‚ â”‚ â””â”€â”€ 11ebc5afac42348f84a8882f329d18beee079efd4fd5d9b30389dc82053fc0c9_sk â”‚ â”‚ â”œâ”€â”€ signcerts ## ã€å‚è€ƒadminã€‘ â”‚ â”‚ â”‚ â””â”€â”€ User1@org1.example.com-cert.pem â”‚ â”‚ â””â”€â”€ tlscacerts ## ã€å‚è€ƒadminã€‘ â”‚ â”‚ â””â”€â”€ tlsca.org1.example.com-cert.pem â”‚ â””â”€â”€ tls ## ã€å‚è€ƒadminã€‘ â”‚ â”œâ”€â”€ ca.crt â”‚ â”œâ”€â”€ client.crt â”‚ â””â”€â”€ client.key â”‚ â””â”€â”€ org2.example.com ç”ŸæˆOrderåˆ›ä¸–åŒºå—åœ¨ Orderer èŠ‚ç‚¹ä¸Šç»´æŠ¤çš„æœ‰ä¸ª system chain, è¿™ä¸ªåˆ›ä¸–åŒºå—å®é™…ä¸Šæ˜¯è¿™ä¸ª system chain çš„åˆ›ä¸–åŒºå—ã€‚åœ¨ Fabric çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œchainï¼Œchannel åŸºæœ¬ä¸Šå¯ä»¥é€šç”¨ï¼Œä¸‹é¢æœ‰æ—¶ä¼šç§° system chain ä¸º system channelã€‚ åˆ›å»ºsystem chainçš„åˆ›ä¸–åŒºå—åˆ›å»ºåˆ›ä¸–åŒºå—çš„é…ç½®æ–‡ä»¶ configtx.yaml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159## ä¸€äº›åˆ—ç»„ç»‡çš„å®šä¹‰ï¼Œã€è¢«å…¶ä»– éƒ¨åˆ†å¼•ç”¨ã€‘#### ã€æ³¨æ„ã€‘ï¼šæœ¬æ–‡ä»¶ä¸­ &amp;KEY å‡ä¸º *KEY æ‰€å¼•ç”¨ï¼› xxï¼š&amp;KEY å‡ä¸º &lt;&lt;: *KEY æ‰€å¼•ç”¨##Organizations: ## å®šä¹‰Ordererç»„ç»‡ ã€&amp;OrdererOrg è¿™ç±»è¯­æ³•ç±»ä¼¼ Goçš„ä¸­çš„æŒ‡é’ˆåŠå¯¹è±¡åœ°å€ï¼Œ æ­¤å¤„æ˜¯è¢«Profiles ä¸­çš„ - *OrdererOrg æ‰€å¼•ç”¨ï¼Œä»¥ä¸‹å‡ä¸ºç±»ä¼¼åšæ³•ã€‘ - &amp;OrdererOrg Name: OrdererOrg ## Ordererçš„ç»„ç»‡çš„åç§° ID: OrdererMSP ## Orderer ç»„ç»‡çš„ID ï¼ˆIDæ˜¯å¼•ç”¨ç»„ç»‡çš„å…³é”®ï¼‰ MSPDir: crypto-config/ordererOrganizations/example.com/msp ## Ordererçš„ MSP è¯ä¹¦ç›®å½•è·¯å¾„ AdminPrincipal: Role.ADMIN ## ã€å¯é€‰é¡¹ã€‘ ç»„ç»‡ç®¡ç†å‘˜æ‰€éœ€è¦çš„èº«ä»½ï¼Œå¯é€‰é¡¹: Role.ADMIN å’Œ Role.MEMBER ## å®šä¹‰Peerç»„ç»‡ 1 - &amp;Org1 Name: Org1MSP ## ç»„ç»‡åç§° ID: Org1MSP ## ç»„ç»‡ID MSPDir: crypto-config/peerOrganizations/org1.example.com/msp ## Peerçš„MSP è¯ä¹¦ç›®å½•è·¯å¾„ AnchorPeers: ## å®šä¹‰ç»„ç»‡é”šèŠ‚ç‚¹ ç”¨äºè·¨ç»„ç»‡ Gossip é€šä¿¡ - Host: peer0.org1.example.com ## é”šèŠ‚ç‚¹çš„ä¸»æœºå Port: 7051 ## é”šèŠ‚ç‚¹çš„ç«¯å£å· ## å®šä¹‰Peerç»„ç»‡ 2 - &amp;Org2 Name: Org2MSP ID: Org2MSP MSPDir: crypto-config/peerOrganizations/org2.example.com/msp AnchorPeers: - Host: peer0.org2.example.com Port: 7051 ################################################################################## SECTION: Capabilities ã€æ³¨æ„ã€‘ï¼š è¯¥éƒ¨åˆ†æ˜¯ V1.1.0 ç‰ˆæœ¬æå‡ºæ¥çš„ï¼Œ ä¸å¯ä»¥åœ¨æ›´æ—©çš„ç‰ˆæœ¬ä¸­ä½¿ç”¨## - æœ¬èŠ‚å®šä¹‰äº† fabric ç½‘ç»œçš„åŠŸèƒ½. è¿™æ˜¯v1.1.0ä¸­çš„ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œä¸åº”åœ¨v1.0.xçš„peerå’Œorderersä¸­ä½¿ç”¨. # Capabilities å®šä¹‰äº†å­˜åœ¨äºç»“æ„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„åŠŸèƒ½ï¼Œä»¥ä¾¿è¯¥äºŒè¿›åˆ¶æ–‡ä»¶å®‰å…¨åœ°å‚ä¸ç»“æ„ç½‘ç»œ. # ä¾‹å¦‚ï¼Œå¦‚æœæ·»åŠ äº†æ–°çš„MSPç±»å‹ï¼Œåˆ™è¾ƒæ–°çš„äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½ä¼šè¯†åˆ«å¹¶éªŒè¯æ­¤ç±»å‹çš„ç­¾åï¼Œè€Œæ²¡æœ‰æ­¤æ”¯æŒçš„æ—§äºŒè¿›åˆ¶æ–‡ä»¶å°†æ— æ³•éªŒè¯è¿™äº›äº‹åŠ¡. # è¿™å¯èƒ½å¯¼è‡´å…·æœ‰ä¸åŒä¸–ç•ŒçŠ¶æ€çš„ä¸åŒç‰ˆæœ¬çš„ç»“æ„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ç›¸åï¼Œä¸ºé€šé“å®šä¹‰åŠŸèƒ½ä¼šé€šçŸ¥é‚£äº›æ²¡æœ‰æ­¤åŠŸèƒ½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ# å®ƒä»¬å¿…é¡»åœ¨å‡çº§ä¹‹å‰åœæ­¢å¤„ç†äº‹åŠ¡. å¯¹äºv1.0.xï¼Œå¦‚æœå®šä¹‰äº†ä»»ä½•åŠŸèƒ½ï¼ˆåŒ…æ‹¬å…³é—­æ‰€æœ‰åŠŸèƒ½çš„é…ç½®ï¼‰ï¼Œé‚£ä¹ˆv1.0.xçš„peer ä¼šä¸»åŠ¨å´©æºƒ.#################################################################################Capabilities: ## é€šé“åŠŸèƒ½é€‚ç”¨äºorderers and the peersï¼Œå¹¶ä¸”å¿…é¡»å¾—åˆ°ä¸¤è€…çš„æ”¯æŒã€‚ å°†åŠŸèƒ½çš„å€¼è®¾ç½®ä¸ºtrue. Global: &amp;ChannelCapabilities ## V1.1 çš„ Globalæ˜¯ä¸€ä¸ªè¡Œä¸ºæ ‡è®°ï¼Œå·²è¢«ç¡®å®šä¸ºè¿è¡Œv1.0.xçš„æ‰€æœ‰ordererså’Œpeersçš„è¡Œä¸ºï¼Œä½†å…¶ä¿®æ”¹ä¼šå¯¼è‡´ä¸å…¼å®¹ã€‚ ç”¨æˆ·åº”å°†æ­¤æ ‡å¿—è®¾ç½®ä¸ºtrue. V1_1: true ## OrdereråŠŸèƒ½ä»…é€‚ç”¨äºorderersï¼Œå¯ä»¥å®‰å…¨åœ°æ“çºµï¼Œè€Œæ— éœ€æ‹…å¿ƒå‡çº§peersã€‚ å°†åŠŸèƒ½çš„å€¼è®¾ç½®ä¸ºtrue Orderer: &amp;OrdererCapabilities ## Orderer çš„V1.1æ˜¯è¡Œä¸ºçš„ä¸€ä¸ªæ ‡è®°ï¼Œå·²ç»ç¡®å®šä¸ºè¿è¡Œv1.0.xçš„æ‰€æœ‰orderers éƒ½éœ€è¦ï¼Œä½†å…¶ä¿®æ”¹ä¼šå¯¼è‡´ä¸å…¼å®¹ã€‚ ç”¨æˆ·åº”å°†æ­¤æ ‡å¿—è®¾ç½®ä¸ºtrue V1_1: true ## åº”ç”¨ç¨‹åºåŠŸèƒ½ä»…é€‚ç”¨äºPeer ç½‘ç»œï¼Œå¯ä»¥å®‰å…¨åœ°æ“ä½œï¼Œè€Œæ— éœ€æ‹…å¿ƒå‡çº§æˆ–æ›´æ–°orderersã€‚ å°†åŠŸèƒ½çš„å€¼è®¾ç½®ä¸ºtrue Application: &amp;ApplicationCapabilities ## V1.2 for Applicationæ˜¯ä¸€ä¸ªè¡Œä¸ºæ ‡è®°ï¼Œå·²è¢«ç¡®å®šä¸ºè¿è¡Œv1.0.xçš„æ‰€æœ‰peersæ‰€éœ€çš„è¡Œä¸ºï¼Œä½†å…¶ä¿®æ”¹ä¼šå¯¼è‡´ä¸å…¼å®¹ã€‚ ç”¨æˆ·åº”å°†æ­¤æ ‡å¿—è®¾ç½®ä¸ºtrue V1_2: true ################################################################################## SECTION: Application## - åº”ç”¨é€šé“ç›¸å…³é…ç½®ï¼Œä¸»è¦åŒ…æ‹¬ å‚ä¸åº”ç”¨ç½‘ç»œçš„å¯ç”¨ç»„ç»‡ä¿¡æ¯#################################################################################Application: &amp;ApplicationDefaults ## è‡ªå®šä¹‰è¢«å¼•ç”¨çš„åœ°å€ Organizations: ## åŠ å…¥é€šé“çš„ç»„ç»‡ä¿¡æ¯ ################################################################################## SECTION: Orderer## - Orderer ç³»ç»Ÿé€šé“ç›¸å…³é…ç½®ï¼ŒåŒ…æ‹¬ Orderer æœåŠ¡é…ç½®å’Œå‚ä¸Orderer æœåŠ¡çš„å¯ç”¨ç»„ç»‡# # Orderer é»˜è®¤æ˜¯ solo çš„ ä¸”ä¸åŒ…å«ä»»ä½•ç»„ç»‡ ã€ä¸»è¦è¢« Profiles éƒ¨åˆ†å¼•ç”¨ã€‘################################################################################Orderer: &amp;OrdererDefaults ## è‡ªå®šä¹‰è¢«å¼•ç”¨çš„åœ°å€ OrdererType: solo ## Orderer ç±»å‹ï¼ŒåŒ…å« solo å’Œ kafka é›†ç¾¤ Addresses: ## æœåŠ¡åœ°å€ - orderer.example.com:7050 BatchTimeout: 2s ## åŒºå—æ‰“åŒ…çš„æœ€å¤§è¶…æ—¶æ—¶é—´ (åˆ°äº†è¯¥æ—¶é—´å°±æ‰“åŒ…åŒºå—) BatchSize: ## åŒºå—æ‰“åŒ…çš„æœ€å¤§åŒ…å«äº¤æ˜“æ•° MaxMessageCount: 10 ## ä¸€ä¸ªåŒºå—é‡Œæœ€å¤§çš„äº¤æ˜“æ•° AbsoluteMaxBytes: 99 MB ## ä¸€ä¸ªåŒºå—çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ ä»»ä½•æ—¶å€™éƒ½ä¸èƒ½è¶…è¿‡ PreferredMaxBytes: 512 KB ## ä¸€ä¸ªåŒºå—çš„å»ºè®®å­—èŠ‚æ•°ï¼Œå¦‚æœä¸€ä¸ªäº¤æ˜“æ¶ˆæ¯çš„å¤§å°è¶…è¿‡äº†è¿™ä¸ªå€¼, å°±ä¼šè¢«æ”¾å…¥å¦å¤–ä¸€ä¸ªæ›´å¤§çš„åŒºå—ä¸­ MaxChannels: 0 ## ã€å¯é€‰é¡¹ã€‘ è¡¨ç¤ºOrderer å…è®¸çš„æœ€å¤§é€šé“æ•°ï¼Œ é»˜è®¤ 0 è¡¨ç¤ºæ²¡æœ‰æœ€å¤§é€šé“æ•° Kafka: Brokers: ## kafkaçš„ brokens æœåŠ¡åœ°å€ å…è®¸æœ‰å¤šä¸ª - 127.0.0.1:9092 Organizations: ## å‚ä¸ç»´æŠ¤ Orderer çš„ç»„ç»‡ï¼Œé»˜è®¤ä¸ºç©º ################################################################################## Profile ## - ä¸€ç³»åˆ—é€šé“é…ç½®æ¨¡æ¿ï¼ŒåŒ…æ‹¬Orderer ç³»ç»Ÿé€šé“æ¨¡æ¿ å’Œ åº”ç”¨é€šé“ç±»å‹æ¨¡æ¿#################################################################################Profiles: ## Ordererçš„ ç³»ç»Ÿé€šé“æ¨¡æ¿ å¿…é¡»åŒ…æ‹¬ Ordererã€ Consortiums ä¸¤éƒ¨åˆ† TwoOrgsOrdererGenesis: ## Orderer ç³»ç»Ÿçš„é€šé“åŠåˆ›ä¸–å—é…ç½®ã€‚é€šé“ä¸ºé»˜è®¤é…ç½®ï¼Œæ·»åŠ ä¸€ä¸ªOrdererOrg ç»„ç»‡ï¼Œ è”ç›Ÿä¸ºé»˜è®¤çš„ SampleConsortium è”ç›Ÿï¼Œæ·»åŠ äº†ä¸¤ä¸ªç»„ç»‡ ã€è¯¥åç§°å¯ä»¥è‡ªå®šä¹‰ ï¼Ÿï¼Ÿã€‘ Capabilities: &lt;&lt;: *ChannelCapabilities Orderer: ## æŒ‡å®šOrdererç³»ç»Ÿé€šé“è‡ªèº«çš„é…ç½®ä¿¡æ¯ &lt;&lt;: *OrdererDefaults ## å¼•ç”¨ Orderer éƒ¨åˆ†çš„é…ç½® &amp;OrdererDefaults Organizations: - *OrdererOrg ## å±äºOrderer çš„é€šé“ç»„ç»‡ è¯¥å¤„å¼•ç”¨äº† ã€ &amp;OrdererOrg ã€‘ä½ç½®å†…å®¹ Capabilities: &lt;&lt;: *OrdererCapabilities Consortiums: ## Orderer æ‰€æœåŠ¡çš„è”ç›Ÿåˆ—è¡¨ SampleConsortium: ## åˆ›å»ºæ›´å¤šåº”ç”¨é€šé“æ—¶çš„è”ç›Ÿ å¼•ç”¨ TwoOrgsChannel æ‰€ç¤º Organizations: - *Org1 - *Org2 ## åº”ç”¨é€šé“æ¨¡æ¿ å¿…é¡»åŒ…æ‹¬ Applicationã€ Consortium ä¸¤éƒ¨åˆ† TwoOrgsChannel: ## åº”ç”¨é€šé“é…ç½®ã€‚é»˜è®¤é…ç½®çš„åº”ç”¨é€šé“ï¼Œæ·»åŠ äº†ä¸¤ä¸ªç»„ç»‡ã€‚è”ç›Ÿä¸ºSampleConsortium Consortium: SampleConsortium ## é€šé“æ‰€å…³è”çš„è”ç›Ÿåç§° Application: ## æŒ‡å®šå±äºæŸåº”ç”¨é€šé“çš„ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬ å±äºé€šé“çš„ç»„ç»‡ä¿¡æ¯ &lt;&lt;: *ApplicationDefaults Organizations: ## åˆå§‹ åŠ å…¥åº”ç”¨é€šé“çš„ç»„ç»‡ - *Org1 - *Org2 Capabilities: &lt;&lt;: *ApplicationCapabilities åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæœ‰ä¸¤ä¸ª Profileï¼Œ ä¸€ä¸ªæ˜¯ OneOrgOrdererGenesis, ä¸€ä¸ªæ˜¯ OneOrgChannelã€‚ ä¸€ä¸ª Profile ä»£è¡¨äº†ä¸€ç»„é…ç½®, é‡Œé¢åŒ…å«äº†é€šé“ç›¸å…³é…ç½®ï¼ŒOrderer èŠ‚ç‚¹ç›¸å…³é…ç½®ï¼Œè”ç›Ÿæˆå‘˜ç›¸å…³é…ç½®ã€‚é€šé“ç›¸å…³é…ç½®ç¡®å®šäº†ç³»ç»Ÿé€šé“çš„ä¸€äº›æƒé™ç­–ç•¥ï¼ŒOrderer èŠ‚ç‚¹é…ç½®ç¡®å®šäº† Orderer èŠ‚ç‚¹çš„ç±»å‹ï¼ˆæ˜¯ solo è¿˜æ˜¯ kafakaï¼‰ï¼ŒOrderer èŠ‚ç‚¹çš„è®¿é—®åœ°å€ï¼Œè¿˜æœ‰å‡ºå—æ—¶é—´ï¼ŒåŒºå—å¤§å°ï¼ŒåŒºå—å†…å…è®¸åŒ…å«çš„äº¤æ˜“æ•°é‡ç­‰ã€‚è”ç›Ÿé…ç½®ç¡®å®šäº†è”ç›Ÿçš„åç§°å’Œè”ç›Ÿæ‰€åŒ…å«çš„ç»„ç»‡ï¼Œå¯¹ç»„ç»‡æ¥è¯´è¿™é‡Œæœ€ä¸ºå…³é”®çš„æ˜¯ç»„ç»‡çš„ MSP ID å’Œè·¯å¾„ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä¼šè¢«åŒ…å«åˆ° system chain ä¸­ã€‚ ç”Ÿæˆåˆ›ä¸–åŒºå—1configtxgen -profile OneOrgOrdererGenesis -channelID order-channel -outputBlock ./channel-artifacts/genesis.block è¿™ä¸ªå‘½ä»¤éœ€è¦æŒ‡å®šä¸€ä¸ª channelIDï¼Œæ³¨æ„è¿™é‡Œçš„ channelID ä¸ºç³»ç»Ÿé“¾(system chain)çš„ channelIDã€‚ ç”Ÿæˆé€šé“é…ç½®åŒºå—ç°åœ¨æ¥åˆ›å»ºåˆ›ä¸–åŒºå—äº¤æ˜“ï¼Œé€šè¿‡äº¤æ˜“å°†åˆ›ä¸–å—ä¸Šä¼ åˆ°channelä¸Š ç”Ÿæˆchannelé…ç½®äº‹åŠ¡é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥ç”Ÿæˆè¿™æ ·çš„ä¸€ä¸ªäº¤æ˜“ã€‚ 1export CHANNEL_NAME=mychannel &amp;&amp; configtxgen -profile OneOrgChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME è¯¥å‘½ä»¤ä¼šè¯»å–å’Œç”Ÿæˆ Orderer ç›¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œåªæ˜¯ä½¿ç”¨äº† â€œOneOrgChannelâ€ è¿™ä¸ª Profileï¼Œç¡®å®šäº†é€šé“çš„æƒé™ç­–ç•¥ï¼Œåˆ›å»ºé€šé“çš„è”ç›Ÿå’Œç»„ç»‡ä¿¡æ¯ã€‚ åªæ˜¯åˆ›å»ºäº†é€šé“ï¼Œè€Œä¸åˆ›å»ºé”šèŠ‚ç‚¹çš„åŒ–ï¼Œé€šé“åŒºå—æ•°æ®å°±æ— æ³•è·¨ç»„ç»‡ä¼ æ’­ï¼Œæ‰€ä»¥ä¸€èˆ¬è¿˜è¦é€šè¿‡ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºç”¨æ¥æ›´æ–°é”šèŠ‚ç‚¹çš„äº¤æ˜“ã€‚ ä¸ºæ¯ä¸ªç»„ç»‡ç”Ÿæˆé”šèŠ‚ç‚¹é…ç½®äº‹åŠ¡1export CHANNEL_NAME=mychannel &amp;&amp; configtxgen -profile OneOrgChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP ä¸Šé¢çš„å‘½ä»¤ç”Ÿæˆäº†ä¸ºæ¯ä¸ªç»„ç»‡ç”Ÿæˆé”šèŠ‚ç‚¹çš„äº¤æ˜“ã€‚ å¯åŠ¨ç½‘ç»œæ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥é€šè¿‡ordererå‘½ä»¤æˆ– docker å®¹å™¨æ¥å¯åŠ¨ç½‘ç»œäº†ï¼Œorderer å¯åŠ¨çš„æ—¶å€™ä¼šæŸ¥æ‰¾ä¸€ä¸ªåä¸º orderer.yaml çš„é…ç½®æ–‡ä»¶ã€‚è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸æ˜¯å¿…é¡»çš„ï¼Œåœ¨æ‰¾ä¸åˆ°è¿™ä¸ªé…ç½®æ–‡ä»¶æ—¶ï¼Œorderer å‘½ä»¤ä¼šä½¿ç”¨é»˜è®¤é…ç½®ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æˆ–å‘½ä»¤è¡Œå‚æ•°çš„æ–¹å¼å»å¯¹æ¯ä¸ªé…ç½®é¡¹è¿›è¡Œè¦†ç›–ã€‚ é…ç½®å„èŠ‚ç‚¹å¯åŠ¨å‚æ•°é…ç½® yaml_config/docker-compose.yml æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990# Copyright IBM Corp. All Rights Reserved.## SPDX-License-Identifier: Apache-2.0#version: '2'volumes: orderer.example.com: peer0.org1.example.com: peer1.org1.example.com: peer0.org2.example.com: peer1.org2.example.com:networks: byfn:services: ca0: image: hyperledger/fabric-ca:$IMAGE_TAG environment: - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server - FABRIC_CA_SERVER_CA_NAME=ca-org1 - FABRIC_CA_SERVER_TLS_ENABLED=true - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/CA1_PRIVATE_KEY ports: - "7054:7054" command: sh -c 'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/CA1_PRIVATE_KEY -b admin:adminpw -d' volumes: - ./crypto-config/peerOrganizations/org1.example.com/ca/:/etc/hyperledger/fabric-ca-server-config container_name: ca_peerOrg1 networks: - byfn ca1: image: hyperledger/fabric-ca:$IMAGE_TAG environment: - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server - FABRIC_CA_SERVER_CA_NAME=ca-org2 - FABRIC_CA_SERVER_TLS_ENABLED=true - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org2.example.com-cert.pem - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/CA2_PRIVATE_KEY ports: - "8054:7054" command: sh -c 'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org2.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/CA2_PRIVATE_KEY -b admin:adminpw -d' volumes: - ./crypto-config/peerOrganizations/org2.example.com/ca/:/etc/hyperledger/fabric-ca-server-config container_name: ca_peerOrg2 networks: - byfn orderer.example.com: extends: file: base/docker-compose-base.yaml service: orderer.example.com container_name: orderer.example.com networks: - byfn peer0.org1.example.com: container_name: peer0.org1.example.com extends: file: base/docker-compose-base.yaml service: peer0.org1.example.com networks: - byfn peer1.org1.example.com: container_name: peer1.org1.example.com extends: file: base/docker-compose-base.yaml service: peer1.org1.example.com networks: - byfn peer0.org2.example.com: container_name: peer0.org2.example.com extends: file: base/docker-compose-base.yaml service: peer0.org2.example.com networks: - byfn peer1.org2.example.com: container_name: peer1.org2.example.com extends: file: base/docker-compose-base.yaml service: peer1.org2.example.com networks: - byfn å¯åŠ¨ç½‘ç»œèŠ‚ç‚¹1docker-compose -f docker-compose.yml up -d ca.example.com orderer.example.com peer0.org1.example.com couchdb æ³¨æ„: å¦‚æœå¯åŠ¨caï¼Œ ä¹‹ä¸€è¦ä¿®æ”¹yamlæ–‡ä»¶ä¸­å¯¹åº”çš„caç§é’¥åœ°å€ è¿è¡ŒChannel(ç¤ºä¾‹ä¸ºä¸€ä¸ªç»„ç»‡)è¿™ä¸ªé˜¶æ®µæŠŠç½‘ç»œå¯åŠ¨åï¼Œè¿˜æ˜¯å•¥äº‹éƒ½åšä¸äº†ï¼ŒèŠ‚ç‚¹ä¹‹é—´ä¹Ÿæ²¡æœ‰é€šä¿¡ã€‚ å› ä¸ºè¿˜æ²¡æœ‰ç”ŸæˆpeerèŠ‚ç‚¹äº’ç›¸é€šä¿¡çš„channelï¼Œä¹Ÿæ²¡æœ‰å°†èŠ‚ç‚¹åŠ å…¥åˆ°channelä¸­ åˆ›å»ºchannelåˆ›å»ºäº†ä¸€ä¸ªchannelçš„åˆ›ä¸–å—ï¼Œé€»è¾‘ä¸Šå°±ç­‰äºæ˜¯åˆ›å»ºäº†ä¸€ä¸ªchannel 1docker exec -e "CORE_PEER_LOCALMSPID=Org1MSP" -e "CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/msp/users/Admin@org1.example.com/msp" peer0.org1.example.com peer channel create -o orderer.example.com:7050 -c mychannel -f /etc/hyperledger/configtx/channel.tx è¯¥å‘½ä»¤æ˜¯ï¼Œé€šè¿‡Org1å‘orderèŠ‚ç‚¹å‘é€äº‹åŠ¡ï¼ŒorderèŠ‚ç‚¹éªŒè¯é€šè¿‡åï¼Œä¼šç”Ÿæˆmychannelçš„åˆ›ä¸–å— å°†ç»„ç»‡åŠ å…¥åˆ°channelå°†ç»„ç»‡åŠ å…¥åˆ°channel 1docker exec -e "CORE_PEER_LOCALMSPID=Org1MSP" -e "CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/msp/users/Admin@org1.example.com/msp" peer0.org1.example.com peer channel join -b mychannel.block æ›´æ–°é”šèŠ‚ç‚¹1docker exec -e "CORE_PEER_LOCALMSPID=Org1MSP" -e "CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/msp/users/Admin@org1.example.com/msp" peer0.org1.example.com peer channel update -o orderer.example.com:7050 -c mychannel -f /etc/hyperledger/configtx/Org1MSPanchors.tx ç›®å‰ä¸ºæ­¢ä¸€ä¸ªåŸºæœ¬çš„ç½‘ç»œå°±å·²ç»æ­å»ºå¥½äº†ã€‚ä¸‹é¢å†ä»‹ç»ä¸€äº›æ€ä¹ˆæ›´æ–°æˆ‘ä»¬çš„ç½‘ç»œç»„ç»‡å’Œchannelæˆå‘˜ chain code å®‰è£…å’Œä½¿ç”¨chaincode å®‰è£… å°†å³å°†å®‰è£…èŠ‚ç‚¹é…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ 1234CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/mspCORE_PEER_ADDRESS=peer0.org2.example.com:7051CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt å®‰è£…chaincode 1peer chaincode install -n mycc -v 1.0 -p github.com/chaincode/chaincode_example02/go/ å°†chaincodeå®ä¾‹åŒ– ä¸€ä¸ªchannelåªéœ€è¦å®ä¾‹åŒ–ä¸€æ¬¡ 1peer chaincode instantiate -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n mycc -v 1.0 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;, &quot;100&quot;, &quot;b&quot;,&quot;200&quot;]&#125;&apos; -P &quot;AND (&apos;Org1MSP.peer&apos;,&apos;Org2MSP.peer&apos;)&quot; chaincodeä½¿ç”¨ æŸ¥è¯¢ 1peer chaincode query -C $CHANNEL_NAME -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos; è°ƒç”¨ 1peer chaincode invoke -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n mycc --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses peer0.org2.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]&#125;&apos; åˆ›å»ºæ–°ç»„ç»‡å¹¶æ·»åŠ åˆ°channelç”Ÿæˆç»„ç»‡çš„è¯ä¹¦å’Œå¯†é’¥åˆ›å»ºä¸€ä¸ªç›®å½•: org3-artifacts, ç”¨æ¥å­˜å‚¨ç”Ÿæˆorg3æœ€ç»ˆé…ç½®å’Œäº‹åŠ¡çš„é…ç½®æ–‡ä»¶å’Œä¸­é—´äº§ç‰©ç­‰ï¼› è¯¥é˜¶æ®µæ“ä½œéƒ½åœ¨org3-artifactsç›®å½•ä¸‹è¿›è¡Œ åŠ å¯†èµ„æ–™å‡†å¤‡ ç”Ÿæˆç»„ç»‡çš„MSPæ–‡ä»¶ åˆ›å»ºä¸€ä¸ªæ–°orgçš„org3-crypto.yamlæ–‡ä»¶ç”¨æ¥ç”Ÿæˆæ–°ç»„ç»‡çš„MSPèµ„æ–™ org3-crypto.yamlæ–‡ä»¶å†…å®¹ 1234567891011PeerOrgs: # --------------------------------------------------------------------------- # Org3 # --------------------------------------------------------------------------- - Name: Org3 Domain: org3.example.com EnableNodeOUs: true Template: Count: 2 Users: Count: 1 1cryptogen generate --config=./org3-crypto.yaml å¯¼å‡ºMSPæ•°æ® configtx.yamlæ–‡ä»¶å†…å®¹ 1234567891011121314151617Organizations: - &amp;Org3 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org3MSP # ID to load the MSP definition as ID: Org3MSP MSPDir: crypto-config/peerOrganizations/org3.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org3.example.com Port: 11051 1export FABRIC_CFG_PATH=$PWD &amp;&amp; configtxgen -printOrg Org3MSP &gt; ../artifacts/org3.json ä¸Šé¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªJSONæ–‡ä»¶ - org3.jsonå¹¶å°†å…¶è¾“å‡ºåˆ°artifactsã€‚æ­¤æ–‡ä»¶åŒ…å«Org3çš„ç­–ç•¥å®šä¹‰ï¼Œä»¥åŠä»¥base 64æ ¼å¼å‘ˆç°çš„ä¸‰ä¸ªé‡è¦è¯ä¹¦ï¼šç®¡ç†å‘˜ç”¨æˆ·è¯ä¹¦ï¼ˆç¨åå°†å……å½“Org3çš„ç®¡ç†å‘˜ï¼‰ï¼ŒCAæ ¹è¯ä¹¦å’ŒTLSæ ¹ç›®å½•è¯ä¹¦ ç§»åŠ¨order MSPæ•°æ®åˆ°å½“å‰ç›®å½•ä¸‹ å°†Orderer Orgçš„MSPææ–™ç§»æ¤åˆ°Org3 crypto-configç›®å½•ä¸­ã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯Ordererçš„TLSæ ¹è¯ä¹¦ï¼Œå®ƒå°†å…è®¸Org3å®ä½“ä¸ç½‘ç»œè®¢è´­èŠ‚ç‚¹ä¹‹é—´çš„å®‰å…¨é€šä¿¡ã€‚ 1cd ../ &amp;&amp; cp -r crypto-config/ordererOrganizations org3-artifacts/crypto-config/ ç”Ÿæˆé…ç½®æ–‡ä»¶ è¿›å…¥cliåº”ç”¨ 1docker exec -it cli bash è®¾ç½®ç¯å¢ƒå˜é‡ æ¥ä¸‹æ¥æ€¥éœ€è¦ä½¿ç”¨orderç®¡ç†å‘˜çš„èº«ä»½è·å–mychannelçš„åŒºå—æ–‡ä»¶ 12export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pemexport CHANNEL_NAME=mychannel è·å–channelçš„é…ç½®ä¿¡æ¯ 1peer channel fetch config config_block.pb -o orderer.example.com:7050 -c $CHANNEL_NAME --tls --cafile $ORDERER_CA å°†é…ç½®è½¬åŒ–ä¸ºJson 1configtxlator proto_decode --input config_block.pb --type common.Block | jq .data.data[0].payload.data.config &gt; config.json è¿™ç»™æˆ‘ä»¬ç•™ä¸‹äº†ä¸€ä¸ªç²¾ç®€çš„JSONå¯¹è±¡ - config.json å®ƒå°†ä½œä¸ºæˆ‘ä»¬çš„é…ç½®æ›´æ–°çš„åŸºçº¿ã€‚ è·å¾—æ·»åŠ ç»„ç»‡åçš„é…ç½®æ–‡ä»¶ å°†ç»„ç»‡çš„é…ç½®jsonæ–‡ä»¶æ·»åŠ åˆ°channelçš„åº”ç”¨çš„åˆ†ç»„å­—æ®µï¼Œå¹¶è¾“å‡ºåˆ°modified_config.json 1jq -s &apos;.[0] * &#123;&quot;channel_group&quot;:&#123;&quot;groups&quot;:&#123;&quot;Application&quot;:&#123;&quot;groups&quot;: &#123;&quot;Org3MSP&quot;:.[1]&#125;&#125;&#125;&#125;&#125;&apos; config.json ./channel-artifacts/org3.json &gt; modified_config.json ç°åœ¨ï¼Œåœ¨CLIå®¹å™¨ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ„Ÿå…´è¶£çš„JSONæ–‡ä»¶ - config.jsonå’Œmodified_config.jsonã€‚åˆå§‹æ–‡ä»¶ä»…åŒ…å«Org1å’ŒOrg2ææ–™ï¼Œè€Œâ€œmodifiedâ€æ–‡ä»¶åŒ…å«æ‰€æœ‰ä¸‰ä¸ªOrgsã€‚æ­¤æ—¶ï¼Œåªéœ€é‡æ–°ç¼–ç è¿™ä¸¤ä¸ªJSONæ–‡ä»¶å¹¶è®¡ç®—å¢é‡å³å¯ã€‚ å°†config.jsonç¿»è¯‘å›åˆ°config.pb 1configtxlator proto_encode --input config.json --type common.Config --output config.pb å°†modified_config.json ç¼–ç æˆmodified_config.pb: 1configtxlator proto_encode --input modified_config.json --type common.Config --output modified_config.pb è®¡ç®—ä¸¤ä¸ªpbæ–‡ä»¶çš„å¢é‡ å› ä¸ºä¹‹å‰çš„ç»„ç»‡MSPææ–™å·²ç»å­˜åœ¨äºé€šé“çš„åŒºå—ä¸­ï¼Œå› æ­¤åªéœ€è¦è®¡ç®—å’Œä½¿ç”¨ä¸¤ä¸ªæ–‡ä»¶çš„å¢é‡ 1configtxlator compute_update --channel_id $CHANNEL_NAME --original config.pb --updated modified_config.pb --output org3_update.pb å°†å¢é‡å†…å®¹è§£ç ä¸ºjsonæ ¼å¼ 1configtxlator proto_decode --input org3_update.pb --type common.ConfigUpdate | jq . &gt; org3_update.json å°è£…æ¶ˆæ¯ 1echo &apos;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;mychannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&apos;$(cat org3_update.json)&apos;&#125;&#125;&#125;&apos; | jq . &gt; org3_update_in_envelope.json å°†æœ€ç»ˆçš„jsonæ–‡ä»¶è½¬åŒ–ä¸ºpbæ ¼å¼ 1configtxlator proto_encode --input org3_update_in_envelope.json --type common.Envelope --output org3_update_in_envelope.pb ç­¾åå¹¶æäº¤é…ç½®æ›´æ–° å¯¹æ›´æ–°åšç­¾å åœ¨å°†é…ç½®å†™å…¥åˆ†ç±»å¸ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ¥è‡ªå¿…éœ€ç®¡ç†å‘˜ç”¨æˆ·çš„ç­¾åã€‚ æˆ‘ä»¬çš„æ¸ é“åº”ç”¨ç¨‹åºç»„çš„ä¿®æ”¹ç­–ç•¥ï¼ˆmod_policyï¼‰è®¾ç½®ä¸ºé»˜è®¤å€¼â€œMAJORITYâ€ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å¤§å¤šæ•°ç°æœ‰ç»„ç»‡ç®¡ç†å‘˜å¯¹å…¶è¿›è¡Œç­¾åã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°†æ­¤æ›´æ–°åŸå‹ä½œä¸ºOrg1ç®¡ç†å‘˜ç­¾åã€‚è¯·è®°ä½ï¼ŒCLIå®¹å™¨æ˜¯ä½¿ç”¨Org1 MSPæè´¨å¼•å¯¼çš„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å‘å‡º å‘½ä»¤ï¼špeer channel signconfigtx 1peer channel signconfigtx -f org3_update_in_envelope.pb æœ€åä¸€æ­¥æ˜¯åˆ‡æ¢CLIå®¹å™¨çš„æ ‡è¯†ä»¥åæ˜ Org2 Adminç”¨æˆ·ã€‚æˆ‘ä»¬é€šè¿‡å¯¼å‡ºç‰¹å®šäºOrg2 MSPçš„å››ä¸ªç¯å¢ƒå˜é‡æ¥å®ç°æ­¤ç›®çš„ã€‚ é…ç½®Org2ç¯å¢ƒå˜é‡ï¼š 123456789# you can issue all of these commands at onceexport CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/mspexport CORE_PEER_ADDRESS=peer0.org2.example.com:7051 ç­¾ç½² 1peer channel signconfigtx -f org3_update_in_envelope.pb å‘é€æ›´æ–°è¯·æ±‚ 1peer channel update -f org3_update_in_envelope.pb -c $CHANNEL_NAME -o orderer.example.com:7050 --tls --cafile $ORDERER_CA å¦‚æœæ‚¨çš„æ›´æ–°å·²æˆåŠŸæäº¤ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„æ¶ˆæ¯æ‘˜è¦æŒ‡ç¤ºï¼š 12018-02-24 18:56:33.499 UTC [msp/identity] Sign -&gt; DEBU 00f Sign: digest: 3207B24E40DE2FAB87A2E42BC004FEAA1E6FDCA42977CB78C64F05A88E556ABA æ‚¨è¿˜å°†çœ‹åˆ°æˆ‘ä»¬çš„é…ç½®äº‹åŠ¡çš„æäº¤ï¼š 12018-02-24 18:56:33.499 UTC [channelCmd] update -&gt; INFO 010 Successfully submitted channel update æˆåŠŸçš„é¢‘é“æ›´æ–°å‘¼å«å‘é¢‘é“ä¸Šçš„æ‰€æœ‰å¯¹ç­‰ä½“è¿”å›æ–°å— - å—5ã€‚å¦‚æœæ‚¨è¿˜è®°å¾—ï¼Œå—0-2æ˜¯åˆå§‹é€šé“é…ç½®ï¼Œè€Œå—3å’Œ4æ˜¯myccé“¾ä»£ç çš„å®ä¾‹ å°†æ–°çš„èŠ‚ç‚¹ç»„ç»‡åŠ å…¥åˆ°channel é…ç½®é¢†å¯¼è€…çš„é€‰ä¸¾ æ–°çš„å¯¹ç­‰ä½“ä¸èƒ½åˆ©ç”¨gossipï¼Œå› ä¸ºå®ƒä»¬æ— æ³•éªŒè¯å…¶ä»–å¯¹ç­‰ä½“ä»å…¶è‡ªå·±çš„ç»„ç»‡è½¬å‘çš„å—ï¼Œç›´åˆ°å®ƒä»¬è·å¾—å°†è¯¥ç»„ç»‡æ·»åŠ åˆ°è¯¥channelçš„é…ç½®äº‹åŠ¡ã€‚ å› æ­¤ï¼Œæ–°æ·»åŠ çš„å¯¹ç­‰ä½“å¿…é¡»å…·æœ‰ä»¥ä¸‹é…ç½®ä¹‹ä¸€ï¼Œä»¥ä¾¿å®ƒä»¬ä»è®¢è´­æœåŠ¡æ¥æ”¶å—ï¼š è¦ä½¿ç”¨é™æ€é¢†å¯¼æ¨¡å¼ï¼Œè¯·å°†å¯¹ç­‰æ–¹é…ç½®ä¸ºç»„ç»‡é¢†å¯¼è€…ï¼š 12CORE_PEER_GOSSIP_USELEADERELECTION=falseCORE_PEER_GOSSIP_ORGLEADER=true æ³¨æ„ å¯¹äºæ·»åŠ åˆ°é€šé“çš„æ‰€æœ‰æ–°å¯¹ç­‰æ–¹ï¼Œæ­¤é…ç½®å¿…é¡»ç›¸åŒã€‚ è¦åˆ©ç”¨åŠ¨æ€é¢†å¯¼è€…é€‰ä¸¾ï¼Œé…ç½®å¯¹ç­‰æ–¹ä½¿ç”¨é¢†å¯¼è€…é€‰ä¸¾ï¼š 12CORE_PEER_GOSSIP_USELEADERELECTION=trueCORE_PEER_GOSSIP_ORGLEADER=false æ³¨æ„ ç”±äºæ–°æ·»åŠ çš„ç»„ç»‡çš„å¯¹ç­‰æ–¹å°†æ— æ³•å½¢æˆæˆå‘˜èµ„æ ¼è§†å›¾ï¼Œå› æ­¤è¯¥é€‰é¡¹å°†ç±»ä¼¼äºé™æ€é…ç½®ï¼Œå› ä¸ºæ¯ä¸ªå¯¹ç­‰æ–¹å°†å¼€å§‹å®£ç§°è‡ªå·±æ˜¯é¢†å¯¼è€…ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦ä»–ä»¬æ›´æ–°äº†å°†ç»„ç»‡æ·»åŠ åˆ°æ¸ é“çš„é…ç½®äº‹åŠ¡ï¼Œç»„ç»‡ä¸­å°†åªæœ‰ä¸€ä¸ªæ´»è·ƒçš„é¢†å¯¼è€…ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æœ€ç»ˆå¸Œæœ›ç»„ç»‡çš„åŒè¡Œä½¿ç”¨é¢†å¯¼è€…é€‰ä¸¾ï¼Œå»ºè®®ä½¿ç”¨æ­¤é€‰é¡¹ å°†Org3 peeråŠ å…¥channel æ‰“å¼€org3 peer æ­¤æ—¶ï¼Œé€šé“é…ç½®å·²æ›´æ–°ä¸ºåŒ…å«æˆ‘ä»¬çš„æ–°ç»„ç»‡Org3- æ„å‘³ç€ä¸å…¶å…³è”çš„å¯¹ç­‰æ–¹ç°åœ¨å¯ä»¥åŠ å…¥mychannelã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä¸ºOrg3å¯¹ç­‰ä½“å’ŒOrg3ç‰¹å®šçš„CLIå¯åŠ¨å®¹å™¨ã€‚ æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯å¹¶ä»first-networkå¯åŠ¨Org3 docker composeï¼š composeæ–‡ä»¶å†…å®¹: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192version: '2'volumes: peer0.org3.example.com: peer1.org3.example.com:networks: byfn:services: peer0.org3.example.com: container_name: peer0.org3.example.com extends: file: base/peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org3.example.com - CORE_PEER_ADDRESS=peer0.org3.example.com:11051 - CORE_PEER_LISTENADDRESS=0.0.0.0:11051 - CORE_PEER_CHAINCODEADDRESS=peer0.org3.example.com:11052 - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:11052 - CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org3.example.com:12051 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org3.example.com:11051 - CORE_PEER_LOCALMSPID=Org3MSP volumes: - /var/run/:/host/var/run/ - ./org3-artifacts/crypto-config/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/msp:/etc/hyperledger/fabric/msp - ./org3-artifacts/crypto-config/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls:/etc/hyperledger/fabric/tls - peer0.org3.example.com:/var/hyperledger/production ports: - 11051:11051 networks: - byfn peer1.org3.example.com: container_name: peer1.org3.example.com extends: file: base/peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer1.org3.example.com - CORE_PEER_ADDRESS=peer1.org3.example.com:12051 - CORE_PEER_LISTENADDRESS=0.0.0.0:12051 - CORE_PEER_CHAINCODEADDRESS=peer1.org3.example.com:12052 - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:12052 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org3.example.com:11051 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org3.example.com:12051 - CORE_PEER_LOCALMSPID=Org3MSP volumes: - /var/run/:/host/var/run/ - ./org3-artifacts/crypto-config/peerOrganizations/org3.example.com/peers/peer1.org3.example.com/msp:/etc/hyperledger/fabric/msp - ./org3-artifacts/crypto-config/peerOrganizations/org3.example.com/peers/peer1.org3.example.com/tls:/etc/hyperledger/fabric/tls - peer1.org3.example.com:/var/hyperledger/production ports: - 12051:12051 networks: - byfn Org3cli: container_name: Org3cli image: hyperledger/fabric-tools:$IMAGE_TAG tty: true stdin_open: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - FABRIC_LOGGING_SPEC=INFO #- FABRIC_LOGGING_SPEC=DEBUG - CORE_PEER_ID=Org3cli - CORE_PEER_ADDRESS=peer0.org3.example.com:11051 - CORE_PEER_LOCALMSPID=Org3MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: /bin/bash volumes: - /var/run/:/host/var/run/ - ./../chaincode/:/opt/gopath/src/github.com/chaincode - ./org3-artifacts/crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./crypto-config/peerOrganizations/org1.example.com:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com - ./crypto-config/peerOrganizations/org2.example.com:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ depends_on: - peer0.org3.example.com - peer1.org3.example.com networks: - byfn 1docker-compose -f docker-compose-org3.yaml up -d æ­¤æ–°ç»„åˆæ–‡ä»¶å·²é…ç½®ä¸ºè·¨è¶Šæˆ‘ä»¬çš„åˆå§‹ç½‘ç»œï¼Œå› æ­¤ä¸¤ä¸ªå¯¹ç­‰æ–¹å’ŒCLIå®¹å™¨å°†èƒ½å¤Ÿä½¿ç”¨ç°æœ‰å¯¹ç­‰æ–¹å’Œè®¢è´­èŠ‚ç‚¹è¿›è¡Œè§£æã€‚ç°åœ¨è¿è¡Œä¸‰ä¸ªæ–°å®¹å™¨ï¼Œæ‰§è¡Œç‰¹å®šäºOrg3çš„CLIå®¹å™¨ï¼š 1docker exec -it Org3cli bash å°±åƒæˆ‘ä»¬ä½¿ç”¨åˆå§‹CLIå®¹å™¨ä¸€æ ·ï¼Œå¯¼å‡ºä¸¤ä¸ªå…³é”®ç¯å¢ƒå˜é‡ï¼š è®¾ç½®ç¯å¢ƒå˜é‡ å°±åƒæˆ‘ä»¬ä½¿ç”¨åˆå§‹CLIå®¹å™¨ä¸€æ ·ï¼Œå¯¼å‡ºä¸¤ä¸ªå…³é”®ç¯å¢ƒå˜é‡ï¼šORDERER_CAå’ŒCHANNEL_NAMEï¼š 1export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem &amp;&amp; export CHANNEL_NAME=mychannel æ£€æŸ¥ä»¥ç¡®ä¿å·²æ­£ç¡®è®¾ç½®å˜é‡ï¼š 1echo $ORDERER_CA &amp;&amp; echo $CHANNEL_NAME å°†èŠ‚ç‚¹åŠ å…¥åˆ°channel 1peer channel join -b mychannel.block å°†ç¬¬äºŒä¸ªèŠ‚ç‚¹åŠ å…¥åˆ°channel 12export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer1.org3.example.com/tls/ca.crtexport CORE_PEER_ADDRESS=peer1.org3.example.com:7051peer channel join -b mychannel.block å‡çº§chaincodeå¹¶æ›´æ”¹è®¤å¯ç­–ç•¥æ›´æ–°chaincodeçš„è®¤å¯ç­–ç•¥ï¼Œæ·»åŠ org3åˆ°è®¤å¯ç­–ç•¥ä¸­ åœ¨org3 cliå®‰è£…chaincode: 1peer chaincode install -n mycc -v 2.0 -p github.com/chaincode/chaincode_example02/go/ åœ¨org1 å’Œ org2 çš„ cliä¸Šå®‰è£…æ–°ç‰ˆæœ¬chaincode peer0.org2ä¸Šå®‰è£… 1peer chaincode install -n mycc -v 2.0 -p github.com/chaincode/chaincode_example02/go/ è·³åˆ°peer0.org1 123456789export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/mspexport CORE_PEER_ADDRESS=peer0.org1.example.com:7051peer chaincode install -n mycc -v 2.0 -p github.com/chaincode/chaincode_example02/go/ æ›´æ–°è®¤å¯ç­–ç•¥ 1peer chaincode upgrade -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C $CHANNEL_NAME -n mycc -v 2.0 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;,&quot;90&quot;,&quot;b&quot;,&quot;210&quot;]&#125;&apos; -P &quot;OR (&apos;Org1MSP.peer&apos;,&apos;Org2MSP.peer&apos;,&apos;Org3MSP.peer&apos;)&quot;]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>Hyperledger fabric</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>Fabric</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidé€†å‘-é™æ€åˆ†æç ´è§£Apk]]></title>
    <url>%2F2019%2F03%2F01%2F02.python%E7%88%AC%E8%99%AB%2F%E7%88%AC%E8%99%AB%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%2FAndroid%E9%80%86%E5%90%91-%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E7%A0%B4%E8%A7%A3APk%2F</url>
    <content type="text"><![CDATA[è½¬è½½: http://www.520monkey.com/ ä¸€ã€å‰è¨€ä»è¿™ç¯‡æ–‡ç« å¼€å§‹æˆ‘ä»¬å¼€å§‹æˆ‘ä»¬çš„ç ´è§£ä¹‹è·¯ï¼Œä¹‹å‰çš„å‡ ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æ˜¯å¦‚ä½•è®²è§£æ€ä¹ˆåŠ å›ºæˆ‘ä»¬çš„Apkï¼Œé˜²æ­¢è¢«åˆ«äººç ´è§£ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬è¦å¼€å§‹ç ´è§£æˆ‘ä»¬çš„Apk,é’ˆå¯¹äºä¹‹å‰çš„åŠ å¯†æ–¹å¼é‡‡ç”¨ç›¸å¯¹åº”çš„ç ´è§£æŠ€æœ¯ï¼ŒAndroidä¸­çš„ç ´è§£å…¶å®å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºé™æ€åˆ†æå’ŒåŠ¨æ€åˆ†æï¼Œå¯¹äºè¿™ä¸¤ç§æ–¹å¼åˆå¯ä»¥ç»†åˆ†ä¸ºJavaå±‚(smailå’Œdex)å’Œnativeå±‚(so)ã€‚æ‰€ä»¥æˆ‘ä»¬ä»Šå¤©ä¸»è¦æ¥è®²è§£å¦‚ä½•é€šè¿‡é™æ€åˆ†ææ¥ç ´è§£æˆ‘ä»¬çš„apkï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä¼šé€šè¿‡ç ´è§£Javaå±‚å’Œnativeå±‚çš„ä¾‹å­æ¥è®²è§£ã€‚ äºŒã€å‡†å¤‡å·¥ä½œç¬¬ä¸€ã€é¦–å…ˆæ˜¯åŸºæœ¬çŸ¥è¯†ï¼š 1ã€äº†è§£Androidä¸­çš„Apkæ–‡ä»¶çš„ç»“æ„ã€‚ 2ã€äº†è§£Smailè¯­æ³•å’Œdexæ–‡ä»¶æ ¼å¼ 3ã€apkçš„ç­¾åæœºåˆ¶ å…³äºè¿™ä¸‰ä¸ªçŸ¥è¯†ç‚¹ï¼Œè¿™é‡Œå°±ä¸åšè¯¦ç»†ä»‹ç»äº†ï¼Œä¸ç†è§£çš„åŒå­¦å¯ä»¥è‡ªè¡Œç½‘ä¸Šå­¦ä¹ ï¼Œæœ‰å¾ˆå¤šèµ„æ–™è®²è§£çš„ã€‚ ç¬¬äºŒã€å†è€…å°±æ˜¯å‡ ä¸ªé‡è¦çš„å·¥å…· 1ã€apktoolï¼šåç¼–è¯‘çš„åˆ©å™¨ 2ã€dex2jarï¼šå°†dexè½¬åŒ–æˆjar 3ã€jd-guiï¼šå¾ˆå¥½çš„æŸ¥çœ‹jaræ–‡ä»¶çš„å·¥å…· 4ã€IDAï¼šæ”¶è´¹çš„æœ€å…¨ç ´è§£åˆ©å™¨(åˆ†ædexå’Œsoéƒ½å¯ä»¥) é¢å¤–ï¼šä¸Šé¢å››ä¸ªå·¥å…·æ˜¯æœ€åŸºæœ¬çš„ï¼Œä½†æ˜¯ç°åœ¨ç½‘ä¸Šä¹Ÿæœ‰ä¸€äº›æ›´å¥½çš„å·¥å…·ï¼šJEB,GDAç­‰ã€‚ä½†æ˜¯è¿™äº›å·¥å…·å°±æ˜¯ä¸°å¯Œäº†ä¸Šé¢å››ä¸ªå·¥å…·ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬åªè¦ä¸Šé¢çš„å››ä¸ªå·¥å…·å°±è¶³å¤Ÿäº†ã€‚IDAå·¥å…·æˆ‘ä¸“é—¨ç»™äº†ä¸€ä¸ªä¸‹è½½åœ°å€ï¼Œå…¶ä»–çš„å·¥å…·åœ¨æˆ‘ä»¬æä¾›çš„æ¡ˆä¾‹ä¸­ã€‚ ä¸‰ã€æŠ€æœ¯åŸç†å‡†å¤‡å·¥ä½œå®Œäº†ï¼Œä¸‹é¢å°±æ¥çœ‹ä¸€ä¸‹ä»Šå¤©çš„ç ´è§£æ–¹å¼ä»‹ç»ï¼š Androidä¸­çš„ç ´è§£çš„é™æ€åˆ†æè¯´é‡è¦ï¼Œä¹Ÿä¸é‡è¦ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ å› ä¸ºæˆ‘ä»¬åˆ°åé¢ä¼šä»‹ç»åŠ¨æ€åˆ†æï¼Œé‚£æ—¶å€™æˆ‘ä»¬åœ¨ç ´è§£ä¸€ä¸ªApkçš„æ—¶å€™ï¼Œå‘ç°é™æ€åˆ†æçš„æ–¹å¼å‡ ä¹æ¯«æ— ç”¨é€”ï¼Œå› ä¸ºç°åœ¨çš„ç¨‹åºåŠ å›ºçš„è¶Šæ¥è¶Šé«˜çº§ï¼Œé™æ€åˆ†æå‡ ä¹å¤±æ•ˆï¼Œæ‰€ä»¥åŠ¨æ€åˆ†ææ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯è¦æ˜¯è¯´é™æ€åˆ†ææ²¡æœ‰ç”¨ï¼Œé‚£ä¹ˆä¹Ÿé”™äº†ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œåªæœ‰é™æ€åˆ†æèƒ½å¤Ÿå¼€å§‹ç ´è§£ä¹‹é—¨ï¼Œæ²¡æœ‰é™æ€åˆ†æä¹‹åçš„ç»“æœï¼ŒåŠ¨æ€åˆ†ææ˜¯æ— æ³•å¼€å±•çš„ã€‚è¿™ä¸ªä¸‹é¢ä¼šä¸¾ä¾‹è¯´æ˜ã€‚æ‰€ä»¥è¯´åœ¨ç ´è§£çš„è¿‡ç¨‹ä¸­ï¼Œé™æ€åˆ†æå’ŒåŠ¨æ€åˆ†æä¸€å®šä¼šç»“åˆåœ¨ä¸€èµ·çš„ï¼Œåªæœ‰è¿™æ ·æˆ‘ä»¬æ‰ä¼šå‹‡å¾€ç›´å‰ã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•é€šè¿‡é™æ€åˆ†ææ¥ç ´è§£apk. 1. é™æ€åˆ†æçš„æµç¨‹1ã€ä½¿ç”¨apktoolæ¥åç¼–è¯‘apk åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰äº›apkå¾ˆè½»æ˜“çš„è¢«åç¼–è¯‘äº†ï¼Œä½†æ˜¯æœ‰äº›apkæ¯æ¬¡åç¼–è¯‘éƒ½ä¼šæŠ¥å„ç§é”™è¯¯ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºåŠ å›ºäº†å—ã€‚ç°åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šå¯¹apkåŠ å¯†çš„æ–¹å¼ï¼Œç›´æ¥è®©åç¼–è¯‘å°±é€šä¸è¿‡ï¼Œæ¯”å¦‚Androidmanifestæ–‡ä»¶ï¼Œdexæ–‡ä»¶ç­‰ï¼Œå› ä¸ºapktoolä»–éœ€è¦è§£æè¿™äº›é‡è¦çš„èµ„æºï¼Œä¸€æ—¦è¿™äº›æ–‡ä»¶åŠ å¯†äº†é‚£ä¹ˆå°±ä¼šç»ˆæ­¢ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æš‚ä¸”éƒ½è®¤ä¸ºapkéƒ½èƒ½åç¼–è¯‘çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä»Šå¤©æ˜¯ä¸»è¦ä»‹ç»æ€ä¹ˆé€šè¿‡é™æ€åˆ†ææ¥ç ´è§£ï¼Œå…³äºè¿™é‡Œçš„åç¼–è¯‘å¤±è´¥çš„é—®é¢˜ï¼Œæˆ‘åé¢ä¼šåœ¨ç”¨ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»ï¼Œåˆ°æ—¶å€™ä¼šåˆ—ä¸¾ä¸€äº›åç¼–è¯‘é”™è¯¯çš„ä¾‹å­ã€‚ 2ã€å¾—åˆ°ç¨‹åºçš„smailæºç å’ŒAndroidManifest.xmlæ–‡ä»¶ æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªAndroidçš„ç¨‹åºå…¥å£ä¿¡æ¯éƒ½ä¼šåœ¨AndroidManifest.xmlä¸­ï¼Œæ¯”å¦‚Applicationå’Œå…¥å£Activity,æ‰€ä»¥æˆ‘ä»¬è‚¯å®šä¼šå…ˆæ¥åˆ†æè¿™ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ï¼Œå½“ç„¶è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„å‘½ä»¤éœ€è¦è®°ä½ï¼š 1adb shell dumpsys activity top èƒ½å¤Ÿè·å–åˆ°å½“å‰ç¨‹åºçš„Activityä¿¡æ¯ ä¹‹åæˆ‘ä»¬ä¼šåˆ†æsmailä»£ç ï¼Œè¿›è¡Œä»£ç é€»è¾‘çš„ä¿®æ”¹ 3ã€ç›´æ¥è§£å‹apkæ–‡ä»¶å¾—åˆ°classes.dexæ–‡ä»¶ï¼Œç„¶åç”¨dex2jarå·¥å…·å¾—åˆ°jar,ç”¨jd-guiå·¥å…·æŸ¥çœ‹ è¿™é‡Œæˆ‘ä»¬ä¸»è¦å¾ˆå®¹æ˜“çš„æŸ¥çœ‹ä»£ç ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ç¬¬äºŒæ­¥ä¸­å¾—åˆ°äº†smailæºç ï¼Œå°±å¯ä»¥åˆ†æç¨‹åºäº†ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“è™½ç„¶smailè¯­æ³•ä¸æ˜¯å¾ˆå¤æ‚ï¼Œè‡³å°‘æ¯”æ±‡ç¼–ç®€å•ï¼Œä½†æ˜¯æ€ä¹ˆçœ‹ç€éƒ½æ˜¯ä¸æ–¹ä¾¿çš„ï¼Œè¿˜æ˜¯çœ‹javaä»£ç æ¯”è¾ƒæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å€ŸåŠ©jd-guiå·¥å…·æŸ¥çœ‹ä»£ç é€»è¾‘ï¼Œç„¶ååœ¨smailä»£ç ä¸­è¿›è¡Œä¿®æ”¹å³å¯ï¼Œä¸Šé¢è¯´åˆ°çš„JEBå·¥å…·ï¼Œå°±åŠ å¼ºäº†jd-guiå·¥å…·çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥ç›´æ¥å°†smailæºç ç¿»è¯‘æˆjavaä»£ç ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦å…ˆç”¨jd-guiå·¥å…·æŸ¥çœ‹ï¼Œå†å»smailæºç ä¸­ä¿®æ”¹äº†ï¼Œå€ŸåŠ©JEBå³å¯ã€‚ 4ã€åˆ†ænativeå±‚ä»£ç  å¦‚æœç¨‹åºä¸­æœ‰æ¶‰åŠåˆ°nativeå±‚çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨IDAæ‰“å¼€æŒ‡å®šçš„soæ–‡ä»¶ã€‚æˆ‘ä»¬è¿˜æ˜¯éœ€è¦å…ˆçœ‹javaä»£ç ï¼Œæ‰¾åˆ°æŒ‡å®šçš„soæ–‡ä»¶ï¼Œåœ¨ç”¨IDAæ¥é™æ€åˆ†æsoæ–‡ä»¶ã€‚ 2ã€ç”¨åˆ°çš„æŠ€æœ¯ä¸Šé¢ä»‹ç»äº†é™æ€åˆ†æçš„æµç¨‹ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹é™æ€åˆ†æçš„å‡ ä¸ªæŠ€æœ¯ï¼Œæˆ‘ä»¬åœ¨é™æ€åˆ†æç ´è§£Apkçš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦æ‰¾åˆ°çªç ´ç‚¹ï¼Œæ‰¾åˆ°å…³é”®çš„ç±»å’Œæ–¹æ³•ï¼Œå½“ç„¶è¿™é‡Œå°±éœ€è¦ç»éªŒäº†ï¼Œä¸æ˜¯æœ‰æ–¹æ³•å¯å¾ªçš„ã€‚ä½†æ˜¯æˆ‘ä»¬ä¼šå€ŸåŠ©ä¸€äº›æŠ€æœ¯æ¥åŠ å¿«ç ´è§£ã€‚ 1ã€å…¨å±€æŸ¥æ‰¾å…³é”®å­—ç¬¦ä¸²å’Œæ—¥å¿—ä¿¡æ¯ è¿™ä¸ªæŠ€æœ¯å®Œå…¨é çœ¼ï¼Œæˆ‘ä»¬åœ¨è¿è¡Œç¨‹åºä¹‹åï¼Œä¼šçœ‹åˆ°ç¨‹åºä¸­å‡ºç°çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚æ–‡æœ¬æ¡†ï¼ŒæŒ‰é’®ä¸Šçš„æ–‡æœ¬ï¼Œtoastæ˜¾ç¤ºçš„ä¿¡æ¯ç­‰ï¼Œéƒ½å¯èƒ½æ˜¯é‡è¦ä¿¡æ¯ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨jd-guiå·¥å…·ä¸­å…¨å±€æœç´¢è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±ä¼šå¾ˆå¿«çš„å®šä½åˆ°æˆ‘ä»¬æƒ³è¦æ‰¾çš„é€»è¾‘åœ°æ–¹ï¼š å½“ç„¶æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé‡è¦ç‚¹å°±æ˜¯Androidä¸­çš„Logä¿¡æ¯ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªå¤§çš„é¡¹ç›®ä¸­ï¼Œä¼šæœ‰å¤šäººå¼€å‘ï¼Œæ‰€ä»¥æ¯ä¸ªæ¨¡å—æ¯ä¸ªäººå¼€å‘ï¼Œæ¯ä¸ªäººéƒ½ä¼šè°ƒè¯•ä¿¡æ¯ï¼Œæ‰€ä»¥å°±ä¼šæ·»åŠ ä¸€äº›logä¿¡æ¯ï¼Œä½†æ˜¯ä¸æ˜¯æ‰€æœ‰çš„äººéƒ½ä¼šè®°å¾—åœ¨é¡¹ç›®å‘å¸ƒçš„æ—¶å€™å…³é—­é¡¹ç›®ä¸­çš„æ‰€æœ‰logä¿¡æ¯ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘çš„è¿‡ç¨‹ä¸­ä¸å¥½çš„ä¹ æƒ¯ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç¨‹åºè¿è¡Œèµ·æ¥ä¹‹åï¼Œä¼šæ‰“å°ä¸€äº›logä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›ä¿¡æ¯è·å–çªç ´ç‚¹ï¼ŒAndroidä¸­çš„logå¯ä»¥æ ¹æ®ä¸€ä¸ªåº”ç”¨æ¥è¿›è¡Œè¿‡æ»¤çš„ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥é€šè¿‡logä¿¡æ¯ä¸­çš„å­—ç¬¦ä¸²åœ¨jd-guiä¸­è¿›è¡Œå…¨å±€æœç´¢ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ 2ã€ä»£ç çš„æ³¨å…¥æŠ€æœ¯ åœ¨ç¬¬ä¸€ç§æ–¹å¼ä¸­æˆ‘ä»¬é€šè¿‡å…¨å±€æœç´¢ä¸€äº›å…³é”®çš„å­—ç¬¦ä¸²æ¥æ‰¾çªç ´ç‚¹ï¼Œä½†æ˜¯è¿™æ‹›æœ‰æ—¶å€™ä¸å¥½ä½¿ï¼Œæ‰€ä»¥è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦åŠ ä¸€äº›ä»£ç äº†æ¥è§‚å¯Ÿä¿¡æ¯äº†ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•å°±æ˜¯åŠ å…¥æˆ‘ä»¬è‡ªå·±çš„logä»£ç ï¼Œæ¥è¿½è¸ªä»£ç çš„æ‰§è¡Œé€»è¾‘ï¼Œå› ä¸ºè¿™é‡Œè®²çš„æ˜¯é™æ€åˆ†ææŠ€æœ¯ï¼Œæ‰€ä»¥å°±ç”¨ä»£ç æ³¨å…¥æŠ€æœ¯æ¥è·Ÿè¸ªæ‰§è¡Œé€»è¾‘ï¼Œåé¢ä»‹ç»äº†åŠ¨æ€åˆ†ææŠ€æœ¯ä¹‹åï¼Œé‚£å°±ç®€å•äº†ï¼Œæˆ‘ä»¬å¯ä»¥éšæ„çš„æ‰“æ–­ç‚¹æ¥è¿›è¡Œè°ƒè¯•ã€‚è¿™é‡Œçš„æ·»åŠ ä»£ç ï¼Œå°±æ˜¯ä¿®æ”¹smailä»£ç ï¼Œæ·»åŠ æˆ‘ä»¬çš„æ—¥å¿—ä¿¡æ¯å³å¯ï¼Œåœ¨ä¸‹é¢æˆ‘ä»¬ä¼šç”¨ä¾‹å­æ¥è¿›è¡Œè®²è§£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¸€ç§æŠ€æœ¯ã€‚ 3ã€ä½¿ç”¨ç³»ç»Ÿçš„HookæŠ€æœ¯ï¼Œæ³¨å…¥ç ´è§£ç¨‹åºè¿›ç¨‹ï¼Œè·å–å…³é”®æ–¹æ³•çš„æ‰§è¡Œé€»è¾‘ å…³äºAndroidä¸­çš„è¿›ç¨‹æ³¨å…¥å’ŒHookæŠ€æœ¯ï¼Œè¿™é‡Œå°±ä¸åšè¯¦ç»†ä»‹ç»äº†ï¼ŒæŠ€æœ¯ä»‹ç»ï¼š æ³¨å…¥æŠ€æœ¯ï¼šhttp://blog.csdn.net/jiangwei0910410003/article/details/39292117 HookæŠ€æœ¯ï¼šhttp://blog.csdn.net/jiangwei0910410003/article/details/41941393 Xposedä½¿ç”¨ï¼šhttps://blog.csdn.net/xingkong_hdc/article/details/82531505 Xposedä½¿ç”¨ï¼šhttps://www.jianshu.com/p/2d5f8e98d9f6 è¿™ä¸¤ç¯‡æ–‡ç« ä»‹ç»äº†è¿™ä¸¤é¡¹æŠ€æœ¯ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­ä¸ç”¨è¿™ä¸¤ç¯‡æ–‡ç« ä¸­ç”¨åˆ°çš„æ–¹å¼ï¼Œå› ä¸ºè¿™ä¸¤ç¯‡æ–‡ç« åªæ˜¯ä»‹ç»åŸç†ï¼ŒæŠ€æœ¯è¿˜ä¸æ˜¯å¾ˆæˆç†Ÿï¼Œå…³äºè¿™ä¸¤ä¸ªæŠ€æœ¯ï¼Œç½‘ä¸Šæœ‰ä¸¤ä¸ªæ¡†æ¶å¾ˆæˆç†Ÿï¼Œä¹Ÿå¾ˆå®ç”¨ï¼Œå°±æ˜¯äººä»¬ç†ŸçŸ¥çš„ï¼šCydiaå’ŒXposed,å…³äºè¿™ä¸¤ä¸ªæ¡†æ¶çš„è¯ï¼Œç½‘ä¸Šçš„èµ„æ–™å¤ªå¤šäº†ï¼Œè€Œä¸”ç”¨èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ï¼Œè¿™é‡Œå°±ä¸åšå¤ªå¤šçš„è¯¦ç»†ä»‹ç»äº†ã€‚ æˆ‘ä»¬åœ¨å®é™…çš„ç ´è§£çš„è¿‡ç¨‹ä¸­ï¼Œè¿™ç§æ–¹å¼ç”¨çš„æœ‰ç‚¹å°‘ï¼Œå› ä¸ºè¿™ç§æ–¹å¼æ•ˆç‡æœ‰ç‚¹ä½ï¼Œæ‰€ä»¥åªæœ‰åœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹ä¼šä½¿ç”¨ã€‚ 4ã€ä½¿ç”¨IDAæ¥é™æ€åˆ†æsoæ–‡ä»¶ è¿™é‡Œç»ˆäºç”¨åˆ°äº†IDAå·¥å…·äº†ï¼Œæœ¬äººæ˜¯æ„Ÿè§‰è¿™ä¸ªå·¥å…·å¤ªå¼ºå¤§äº†ï¼Œä»–å¯ä»¥æŸ¥çœ‹soä¸­çš„ä»£ç é€»è¾‘ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„çš„å¯èƒ½æ˜¯æ±‡ç¼–æŒ‡ä»¤ï¼Œæ‰€ä»¥è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œç ´è§£soçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»æŒæ¡ä¸€é¡¹æŠ€èƒ½ï¼Œå°±æ˜¯èƒ½çœ‹æ‡‚æ±‡ç¼–æŒ‡ä»¤ï¼Œä¸ç„¶ç”¨IDAæ¥ç ´è§£ç¨‹åºï¼Œä¼šå¾ˆè´¹ç»çš„ï¼Œå…³äºæ±‡ç¼–æŒ‡ä»¤ï¼Œå¤§å­¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ¥è§¦è¿‡äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å½“æ—¶æ„Ÿè§‰è¿™ä¸œè¥¿åˆéš¾ï¼Œè€Œä¸”ç”¨çš„åœ°æ–¹ä¹Ÿå¾ˆå°‘ï¼Œæ‰€ä»¥å°±æ²¡å¤ªåœ¨æ„ï¼Œå…¶å®ä¸ç„¶å‘€ï¼ŒçœŸæ­£æ‡‚æ±‡ç¼–çš„äººæ‰æ˜¯å¥½çš„ç¨‹åºå‘˜ï¼š çœ‹åˆ°äº›æ±‡ç¼–æŒ‡ä»¤ï¼Œå¤´ç«‹é©¬å°±å¤§äº†ï¼Œä¸è¿‡è¿™ä¸ªç”¨å¤šäº†ï¼Œç ´è§£å¤šäº†ï¼Œè¿˜æ˜¯å¯ä»¥çš„ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·¦è¾¹æ ä¸­æœ‰æˆ‘ä»¬çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æŒ‡å®šå‡½æ•°çš„å®šä¹‰çš„åœ°æ–¹è¿›è¡ŒæŸ¥çœ‹å³å¯ã€‚å…¶å®IDAæœ€å¼ºå¤§çš„åœ°æ–¹æ˜¯åœ¨äºä»–åŠ¨æ€è°ƒè¯•soæ–‡ä»¶ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¼šä»‹ç»æ€ä¹ˆåŠ¨æ€è°ƒè¯•soæ–‡ä»¶ã€‚å½“ç„¶IDAå¯ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥æŸ¥çœ‹apkæ–‡ä»¶çš„ï¼š å¯ä»¥æŸ¥çœ‹apkæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©classes.dexæ–‡ä»¶ï¼š ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœåº”ç”¨ç¨‹åºå¤ªå¤§çš„è¯ï¼Œè¿™ä¸ªæ‰“å¼€çš„è¿‡ç¨‹ä¸­ä¼šå¾ˆæ…¢çš„ï¼Œæœ‰å¯èƒ½IDAåœæ­¢å·¥ä½œï¼Œæ‰€ä»¥è¦æ…¢æ…¢ç­‰å•¦ï¼š æ‰“å¼€ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç±»å’Œæ–¹æ³•åï¼Œè¿™é‡Œè¿˜å¯ä»¥æ”¯æŒæœç´¢ç±»åå’Œæ–¹æ³•åCtrl+Fï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹å­—ç¬¦ä¸²å†…å®¹(Shirt+F12): æˆ‘ä»¬å‘ç°IDAä¹Ÿæ˜¯ä¸€ä¸ªåˆ†æJavaä»£ç çš„å¥½æ‰‹ï¼Œæ‰€ä»¥è¯´è¿™ä¸ªå·¥å…·å¤ªå¼ºå¤§äº†å•¦å•¦~~ å››ã€æ¡ˆä¾‹åˆ†æä¸Šé¢è®²è§£äº†é™æ€åˆ†æçš„ç ´è§£æŠ€æœ¯ï¼Œé‚£ä¹ˆä¸‹é¢å°±å¼€å§‹ä½¿ç”¨ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹é™æ€åˆ†æçš„æŠ€æœ¯ã€‚ 1. åç¼–è¯‘apkï¼Œè·å–smailæ–‡ä»¶é¦–å…ˆæˆ‘ä»¬æ‹¿åˆ°æˆ‘ä»¬éœ€è¦ç ´è§£çš„Apk,ä½¿ç”¨apktool.jarå·¥å…·æ¥åç¼–è¯‘ï¼š 1java -jar apktool.jar d xxx.apk è¿™ä¸ªapkå¾ˆæ˜¯å®¹æ˜“å°±è¢«åç¼–è¯‘äº†ï¼Œçœ‹æ¥å¹¶æ²¡æœ‰è¿›è¡Œä»»ä½•çš„åŠ å›ºã€‚é‚£å°±å¥½åŠäº†ï¼Œæˆ‘ä»¬è¿™é‡Œæ¥æ”¹ä¸€ä¸‹ä»–çš„AndroidManifest.xmlä¸­çš„ä¿¡æ¯ï¼Œæ”¹æˆå¯è°ƒå¼æ¨¡å¼ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬åé¢è¿›è¡ŒåŠ¨æ€è°ƒè¯•çš„å‰æï¼Œä¸€ä¸ªæ­£å¼çš„apkï¼Œåœ¨AndroidManifest.xmlä¸­è¿™ä¸ªå€¼æ˜¯falseçš„ã€‚ æˆ‘ä»¬çœ‹çœ‹ä»–çš„AndroidManifest.xmlæ–‡ä»¶ï¼š æˆ‘ä»¬æŠŠè¿™ä¸ªå€¼æ”¹æˆtrue.åœ¨å›ç¼–è¯‘ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åŠ¨æ€è°ƒè¯•è¿™ä¸ªapkäº†ï¼Œæ‰€ä»¥åœ¨è¿™ç‚¹ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé™æ€åˆ†ææ˜¯åŠ¨æ€åˆ†æçš„å‰æï¼Œè¿™ä¸ªå€¼ä¸ä¿®æ”¹çš„è¯ï¼Œæˆ‘ä»¬æ˜¯åŠæ³•è¿›è¡Œåç»­çš„åŠ¨æ€è°ƒè¯•çš„ã€‚ 2. é‡æ–°æ‰“åŒ…apkï¼Œ å¹¶å®‰è£…ä¿®æ”¹æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬è¿›è¡Œå›ç¼–è¯‘ï¼š é¦–å…ˆè¿›å…¥åˆ°apktoolså·¥ä½œç›®å½•ï¼Œ è¿›è¡Œåç¼–è¯‘ï¼š 12345java -jar apktool.jar b -d sq -o debug.apk# sqæ˜¯ä¹‹å‰åç¼–è¯‘çš„ç›®å½•ï¼Œdebug.apkæ˜¯å›ç¼–è¯‘ä¹‹åçš„æ–‡ä»¶# è¿™æ—¶å€™ï¼Œdebug.apkæ˜¯ä¸èƒ½å®‰è£…è¿è¡Œçš„ï¼Œå› ä¸ºæ²¡æœ‰ç­¾åï¼ŒAndroidä¸­æ˜¯ä¸å…è®¸å®‰è£…ä¸€ä¸ªæ²¡æœ‰ç­¾åçš„apk ä¸‹é¢è¿˜è¦ç»§ç»­ç­¾åï¼Œæˆ‘ä»¬ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ç­¾åæ–‡ä»¶å³å¯ç­¾åï¼š 12java -jar .\sign\signapk.jar .\sign\testkey.x509.pem .\sign\testkey.pk8 debug.apk debug.sig.apk# signapk.jarï¼Œ testkey.x509.pem, testkey.pk8 éœ€è¦æå‰ä¸‹è½½ æ³¨ï¼šå…¶å®æˆ‘ä»¬åœ¨ç”¨IDEå·¥å…·å¼€å‘androidé¡¹ç›®çš„æ—¶å€™ï¼Œå·¥å…·å°±æ˜¯ç”¨è¿™ä¸ªç­¾åæ–‡ä»¶è¿›è¡Œç­¾åçš„ï¼Œåªæ˜¯è¿™ä¸ªè¿‡ç¨‹IDEå¸®æˆ‘ä»¬åšäº†ã€‚ åé¢å°±æ˜¯ç›´æ¥å®‰è£…è¿™ä¸ªapk,ç„¶åè¿è¡Œè¿™ä¸ªApkã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬åªéœ€è¦çŸ¥é“åº”ç”¨çš„åŒ…åå’Œå…¥å£Activityåç§°å³å¯ï¼Œè¿™ä¸ªä¿¡æ¯æˆ‘ä»¬åœ¨AndroidManifest.xmlä¸­ä¹Ÿæ˜¯å¯ä»¥è·å–åˆ°çš„ å½“ç„¶æˆ‘ä»¬ç”¨ï¼šadb shell dumpsys activity top å‘½ä»¤ä¹Ÿå¯ä»¥å¾—åˆ°ï¼š 3. é€šè¿‡jd-guiæŸ¥çœ‹ä»£ç ï¼Œä»£ç æ³¨å…¥ï¼Œ Hookä½¿ç”¨ï¼Œ æ¨å¯¼ä»£ç é€»è¾‘å›ç¼–è¯‘ä¹‹åï¼Œæˆ‘ä»¬è¿è¡Œç¨‹åºï¼Œå‘ç°æœ‰é—®é¢˜ï¼Œå°±æ˜¯ç‚¹å‡»ç¨‹åºçš„iconï¼Œæ²¡ååº”ï¼Œè¿è¡Œä¸èµ·æ¥ï¼Œæˆ‘ä»¬åœ¨æŸ¥çœ‹logä¸­çš„å¼‚å¸¸ä¿¡æ¯ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±åˆ¤æ–­ï¼Œä»–å†…éƒ¨è‚¯å®šåšäº†ä»€ä¹ˆæ ¡éªŒå·¥ä½œï¼Œè¿™ä¸ªä¸€èˆ¬å›ç¼–è¯‘ä¹‹åçš„ç¨‹åºè¿è¡Œä¸èµ·æ¥çš„è¯ï¼Œé‚£å°±æ˜¯å†…éƒ¨åšæ ¡éªŒäº†ï¼Œä¸€èˆ¬åšæ ¡éªŒçš„è¯ï¼Œæœ‰ä¸¤ç§ï¼š 1ã€å¯¹dexåšæ ¡éªŒï¼Œé˜²æ­¢ä¿®æ”¹dexçš„ 2ã€å¯¹apkçš„ç­¾ååšæ ¡éªŒï¼Œé˜²æ­¢é‡æ–°æ‰“åŒ… é‚£æˆ‘ä»¬å°±éœ€è¦ä»æ–°çœ‹çœ‹ä»–çš„ä»£ç ï¼Œæ¥çœ‹çœ‹æ˜¯ä¸æ˜¯åšäº†æ ¡éªŒï¼š æˆ‘ä»¬åœ¨åˆ†æä»£ç çš„æ—¶å€™ï¼Œè‚¯å®šå…ˆçœ‹çœ‹ä»–æœ‰æ²¡æœ‰è‡ªå·±å®šä¹‰Application,å¦‚æœæœ‰å®šä¹‰çš„è¯ï¼Œå°±éœ€è¦çœ‹ä»–è‡ªå·±çš„Applicationç±»ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ä»–å®šäº†è‡ªå·±çš„Applicationï¼šcom.shuqi.application.ShuqiApplication æˆ‘ä»¬è§£å‹apk,å¾—åˆ°dex,ç„¶ådex2jarè¿›è¡Œè½¬åŒ–ï¼Œå¾—åˆ°jarï¼Œå†ç”¨jd-guiæŸ¥çœ‹è¿™ä¸ªç±»ï¼š è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ä»–çš„ä»£ç åšæ··æ·†äº†ï¼Œä½†æ˜¯ä¸€äº›ç³»ç»Ÿå›è°ƒæ–¹æ³•è‚¯å®šä¸èƒ½æ··æ·†çš„ï¼Œæ¯”å¦‚onCreateæ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä¸€èˆ¬æ‰¾çš„æ–¹æ³•æ˜¯ï¼š 1ã€é¦–å…ˆçœ‹è¿™ä¸ªç±»æœ‰æ²¡æœ‰é™æ€æ–¹æ³•å’Œé™æ€ä»£ç å—ï¼Œå› ä¸ºè¿™ç±»çš„ä»£ç ä¼šåœ¨å¯¹è±¡åˆå§‹åŒ–ä¹‹å‰è¿è¡Œï¼Œå¯èƒ½åœ¨è¿™é‡ŒåŠ è½½soæ–‡ä»¶ï¼Œæˆ–è€…æ˜¯åŠ å¯†æ ¡éªŒç­‰æ“ä½œ 2ã€å†çœ‹çœ‹è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³• 3ã€æœ€åå†çœ‹ç”Ÿå‘½å‘¨æœŸæ–¹æ³• æˆ‘ä»¬è¿™é‡Œçœ‹åˆ°ä»–çš„æ ¸å¿ƒä»£ç åœ¨onCreateä¸­ï¼Œè°ƒç”¨äº†å¾ˆå¤šç±»çš„æ–¹æ³•ï¼ŒçŒœæƒ³è¿™é‡Œçš„æŸä¸ªæ–¹æ³•åšå·¥ä½œäº†ï¼Ÿ ä¸‹é¢æ¥çœ‹çœ‹æˆ‘ä»¬æ€ä¹ˆæ·»åŠ æˆ‘ä»¬çš„æ—¥å¿—ä¿¡æ¯ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯æ·»åŠ æ—¥å¿—ï¼Œéœ€è¦ä¿®æ”¹smailæ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨å»æŸ¥çœ‹smailæºç ï¼š å…³äºsmailè¯­æ³•ï¼Œæœ¬äººè®¤ä¸ºä¸æ˜¯å¾ˆéš¾ï¼Œæ‰€ä»¥å¤§å®¶è‡ªå·±ç½‘ä¸Šå»æœä¸€äº›èµ„æ–™å­¦ä¹ ä¸€ä¸‹å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹åˆ°è°ƒç”¨äº†è¿™äº›æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨æ¯ä¸ªæ–¹æ³•åŠ ä¸Šæˆ‘ä»¬çš„æ—¥å¿—ä¿¡æ¯ï¼Œè¿™é‡ŒåŠ æ—¥å¿—æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§å°±æ˜¯ç›´æ¥åœ¨è¿™é‡Œè°ƒç”¨ç³»ç»Ÿçš„logæ–¹æ³•ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š 1ã€éœ€è¦å¯¼å…¥åŒ…ï¼Œåœ¨smailä¸­ä¿®æ”¹ 2ã€éœ€è¦å®šä¹‰ä¸€ä¸ªä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯tag,msg,æ‰èƒ½æ­£å¸¸çš„æ‰“å°logå‡ºæ¥ æ˜æ˜¾è¿™ä¸ªæ–¹æ³•æœ‰ç‚¹éº»çƒ¦ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è‡ªå·±å®šä¹‰ä¸€ä¸ªMyLogç±»ï¼Œç„¶ååç¼–è¯‘ï¼Œå¾—åˆ°MyLogçš„smailæ–‡ä»¶ï¼Œæ·»åŠ åˆ°è¿™ä¸ªShuqiApplication.smailçš„rootç›®å½•ä¸‹ï¼Œç„¶ååœ¨ä»£ç ä¸­ç›´æ¥è°ƒç”¨å³å¯ï¼Œè‡³äºä¸ºä½•è¦æ”¾åˆ°rootç›®å½•ä¸‹ï¼Œè¿™æ ·åœ¨ä»£ç ä¸­è°ƒç”¨å°±ä¸éœ€è¦å¯¼å…¥åŒ…äº†ï¼Œæ¯”å¦‚SuqiApplication.smailä¸­çš„ä¸€äº›é™æ€æ–¹æ³•è°ƒç”¨ï¼š ç¼–å†™æ—¥å¿—ç±»MyLogï¼Œè¿™é‡Œå°±ä¸ç²˜è´´ä»£ç äº†ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªé¡¹ç›®ä¹‹åï¼Œåç¼–è¯‘å¾—åˆ°MyLog.smailæ–‡ä»¶ï¼Œæ”¾åˆ°ç›®å½•ä¸­ï¼š æˆ‘ä»¬å¾—åˆ°è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„ï¼ŒæŠŠMyLog.smailçš„åŒ…åä¿¡æ¯åˆ é™¤ï¼Œå› ä¸ºæˆ‘ä»¬æ”¾åˆ°rootç›®å½•ä¸‹çš„ï¼Œæ„å‘³ç€è¿™ä¸ªMyLogç±»æ˜¯æ²¡æœ‰ä»»ä½•åŒ…åçš„ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ï¼Œä¸ç„¶æœ€ååŠ çš„è¯ï¼Œä¹Ÿæ˜¯æŠ¥é”™çš„ã€‚ æˆ‘ä»¬åœ¨ShuqiApplicationçš„onCreateæ–¹æ³•ä¸­æ’å…¥æˆ‘ä»¬çš„æ—¥å¿—æ–¹æ³•ï¼š invoke-static {}, LMyLog;-&gt;print()V ä½†æ˜¯æˆ‘ä»¬åœ¨åŠ ä»£ç çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦æ‰¾å¯¹åœ°æ–¹åŠ ï¼Œæ‰€è°“æ‰¾å¯¹åœ°æ–¹ï¼Œå°±æ˜¯åœ¨ä¸Šä¸ªæ–¹æ³•è°ƒç”¨å®Œä¹‹åæ·»åŠ ï¼Œæ¯”å¦‚ï¼š invoke-virtual,invoke-staticç­‰ï¼Œè€Œä¸”è¿™äº›æŒ‡ä»¤åé¢ä¸èƒ½æœ‰ï¼šmove-result-objectï¼Œå› ä¸ºè¿™ä¸ªæŒ‡ä»¤æ˜¯è·å–æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æ˜¯è¿™ä¹ˆåŠ ä»£ç çš„ï¼š 1ã€åœ¨invoke-static/invoke-virtualæŒ‡ä»¤ä»–çš„è¿”å›ç±»å‹æ˜¯Vä¹‹åå¯ä»¥åŠ å…¥ 2ã€åœ¨invoke-static/invoke-virtualæŒ‡ä»¤è¿”å›ç±»å‹ä¸æ˜¯V,ä¹‹åçš„move-result-objectå‘½ä»¤ä¹‹åå¯ä»¥åŠ å…¥ åŠ å¥½äº†æˆ‘ä»¬çš„æ—¥å¿—ä»£ç ä¹‹åï¼Œä¸‹é¢æˆ‘ä»¬å°±å›ç¼–è¯‘æ‰§è¡Œï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šé‡åˆ°samilè¯­æ³•é”™è¯¯ï¼Œè¿™ä¸ªå°±å¯¹åº”æŒ‡å®šçš„æ–‡ä»¶ä¿®æ”¹å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬å¾—åˆ°å›ç¼–è¯‘çš„apkä¹‹åï¼Œå¯ä»¥åœ¨åç¼–è¯‘ä¸€ä¸‹ï¼Œçœ‹çœ‹ä»–çš„javaä»£ç ï¼š æˆ‘ä»¬çœ‹åˆ°äº†ï¼Œæˆ‘ä»¬æ·»åŠ çš„ä»£ç ï¼Œåœ¨æ¯ä¸ªæ–¹æ³•ä¹‹åæ‰“å°ä¿¡æ¯ã€‚ ä¸‹é¢æˆ‘ä»¬è¿è¡Œç¨‹åºï¼ŒåŒæ—¶å¼€å¯æˆ‘ä»¬çš„logçš„tagï¼šadb logcat -s JW çœ‹åˆ°æˆ‘ä»¬æ‰“å°çš„æ—¥å¿—äº†ï¼Œæˆ‘ä»¬å‘ç°æ‰“å°äº†ä¸‰ä¸ªlog,è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè™½ç„¶æ‰“å°äº†ä¸‰ä¸ªlog,ä½†æ˜¯éƒ½æ˜¯åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­ï¼Œæ‰€ä»¥è¯´ä¸€ä¸ªè¿›ç¨‹ä¸­çš„logçš„è¯ï¼Œåªæ‰“å°äº†ä¸€ä¸ªï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ¤æ–­ï¼Œé—®é¢˜å‡ºç°åœ¨vr.hè¿™ä¸ªæ–¹æ³• æˆ‘ä»¬æŸ¥çœ‹è¿™ä¸ªæ–¹æ³•æºç ï¼š æœç„¶ï¼Œè¿™ä¸ªæ–¹æ³•åšäº†ç­¾åéªŒè¯ï¼Œä¸æ­£ç¡®çš„è¯ï¼Œç›´æ¥é€€å‡ºç¨‹åºã€‚é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨è¦æƒ³æ­£å¸¸çš„è¿è¡Œç¨‹åºçš„è¯ï¼Œå¾ˆç®€å•äº†ï¼Œç›´æ¥æ³¨é‡Šè¿™è¡Œä»£ç ï¼švr.h(this) ç„¶åå›ç¼–è¯‘ï¼Œåœ¨è¿è¡Œï¼Œæœç„¶ä¸æŠ¥é”™äº†ï¼Œè¿™é‡Œå°±ä¸åœ¨æ¼”ç¤ºäº†ï¼š å¥½äº†ï¼Œä¸Šé¢å°±é€šè¿‡æ³¨å…¥ä»£ç ï¼Œæ¥è·Ÿè¸ªé—®é¢˜ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¾ˆå¸¸ç”¨ï¼Œä¹Ÿæ˜¯å¾ˆå®åœ¨çš„ã€‚ 4. é™æ€åˆ†æNativeä»£ç ä¸‹é¢ç»§ç»­æ¥ä»‹ç»ä¸€ä¸‹ï¼Œå¦‚ä½•ä½¿ç”¨IDAæ¥é™æ€åˆ†ænativeä»£ç ï¼Œè¿™é‡Œä¸€å®šè¦ç†Ÿæ‚‰æ±‡ç¼–æŒ‡ä»¤ï¼Œä¸ç„¶çœ‹èµ·æ¥å¾ˆè´¹åŠ²çš„ã€‚ æˆ‘ä»¬åœ¨åç¼–è¯‘ä¹‹åï¼Œçœ‹åˆ°ä»–çš„onCreateæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªåŠ è½½soçš„ä»£ç  çœ‹çœ‹è¿™ä¸ªä»£ç ï¼š è·å–å¯†ç çš„æ–¹æ³•ï¼Œæ˜¯nativeçš„ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹é‚£ä¸ªgetDbPasswordæ–¹æ³•ï¼Œç”¨IDAæ‰“å¼€libpsProcess.soæ–‡ä»¶ï¼š æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„å®ç°ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç›´æ¥çœ‹BL/BLXç­‰ä¿¡æ¯ï¼Œè·³è½¬é€»è¾‘ï¼Œè¿˜æœ‰å°±æ˜¯è¿”å›å€¼ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°çš„æœ€åéƒ¨åˆ†ï¼Œå‘ç°ä¸€ä¸ªé‡ç‚¹ï¼Œå°±æ˜¯ï¼šBL __android_log_print è¿™ä¸ªæ˜¯åœ¨nativeå±‚è°ƒç”¨logçš„å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨å¾€ä¸Šçœ‹ï¼Œå‘ç°ï¼štagæ˜¯System.out.c æˆ‘ä»¬è¿è¡Œç¨‹åºçœ‹èµ·logçœ‹çœ‹ï¼Œä½†æ˜¯æˆ‘ä»¬æ­¤æ—¶ä¹Ÿå¯ä»¥åœ¨javaå±‚æ·»åŠ æ—¥å¿—çš„ï¼šæˆ‘ä»¬å…¨å±€æœç´¢è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨yiè¿™ä¸ªç±»ä¸­è°ƒç”¨çš„ æˆ‘ä»¬ä¿®æ”¹yi.smailä»£ç ï¼š å›ç¼–è¯‘ï¼Œåœ¨è¿è¡Œç¨‹åºï¼Œå¼€å¯logï¼š adb logcat -s JW adb logcat -s System.out.c å‘ç°ï¼Œè¿”å›çš„å¯†ç javaå±‚å’Œnativeå±‚æ˜¯ä¸€æ ·çš„ã€‚è¯´æ˜æˆ‘ä»¬é™æ€åˆ†ænativeè¿˜æ˜¯æœ‰æ•ˆçš„ã€‚ äº”ã€æœªè§£å†³çš„é—®é¢˜1ã€å¦‚ä½•æå®šapktoolå·¥å…·åç¼–è¯‘å‡ºé”™çš„é—®é¢˜ è¿™ä¸ªæˆ‘åœ¨å¼€å§‹çš„æ—¶å€™ä¹Ÿè¯´äº†ï¼Œè¿™é‡Œå‡ºé”™çš„åŸå› å¤§éƒ¨åˆ†æ˜¯apkè¿›è¡ŒåŠ å›ºäº†ï¼Œæ‰€ä»¥åé¢æˆ‘ä¼šä¸“é—¨ä»‹ç»ä¸€ä¸‹å¦‚ä½•è§£å†³è¿™æ ·çš„é—®é¢˜ 2ã€å¦‚ä½•æå®šè®©ä¸€ä¸ªApkå¯ä»¥è°ƒè¯• æˆ‘ä»¬åœ¨ä¸Šé¢çœ‹åˆ°ä¸€ä¸ªapkæƒ³è¦èƒ½è°ƒè¯•çš„è¯ï¼Œéœ€è¦ä¿®æ”¹android:debugçš„å€¼ï¼Œä½†æ˜¯æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä¿®æ”¹å¤±è´¥ï¼Œå¯¼è‡´ç¨‹åºä¸èƒ½è¿è¡Œï¼Œåé¢ä¼šä¸“é—¨ä»‹ç»æœ‰å‡ ç§æ–¹å¼æ¥è®©ä¸€ä¸ªå‘å¸ƒåçš„apkå¯ä»¥è°ƒè¯• å…­ã€æŠ€æœ¯æ€»ç»“è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨é™æ€æ–¹å¼å»ç ´è§£ä¸€ä¸ªapk,æˆ‘ä»¬åœ¨ç ´è§£ä¸€ä¸ªapkçš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯æ”¹ç‚¹ä»£ç ï¼Œç„¶åèƒ½å¤Ÿè¿è¡Œèµ·æ¥ï¼Œè¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œä¸€èˆ¬å°±æ˜¯ï¼š 1ã€æ³¨é‡Šç‰¹å®šåŠŸèƒ½ï¼Œæ¯”å¦‚å¹¿å‘Šå±•ç¤ºç­‰ 2ã€å¾—åˆ°æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ¯”å¦‚è·å–ç”¨æˆ·çš„å¯†ç  3ã€æ·»åŠ æˆ‘ä»¬çš„ä»£ç ï¼Œæ¯”å¦‚åŠ å…¥æˆ‘ä»¬è‡ªå·±çš„ç›‘æµ‹ä»£ç å’Œå¹¿å‘Šç­‰ æˆ‘ä»¬åœ¨é™æ€åˆ†æä»£ç çš„æ—¶å€™ï¼Œéœ€è¦éµå¾ªçš„å¤§ä½“è·¯çº¿ï¼š 1ã€é¦–å…ˆèƒ½å¤Ÿåç¼–è¯‘ï¼Œå¾—åˆ°AndroidManifest.xmlæ–‡ä»¶ï¼Œæ‰¾åˆ°ç¨‹åºå…¥å£ä»£ç  2ã€æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ä»£ç é€»è¾‘ï¼Œä¸€èˆ¬ä¼šç»“åˆç•Œé¢åˆ†æï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³å¾—è®©ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œæˆ‘ä»¬è‚¯å®šæƒ³è¦å¾—åˆ°ç”¨æˆ·ç™»å½•ç•Œé¢Activity,è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨adb shell dumpsys activity topå‘½ä»¤å¾—åˆ°Activityåç§°ï¼Œç„¶åç”¨Eclipseè‡ªå¸¦çš„ç¨‹åºå½“å‰è§†å›¾åˆ†æå·¥å…·ï¼šå¾—åˆ°æ§ä»¶åç§°ï¼Œæˆ–è€…æ˜¯åœ¨ä»£ç ä¸­è·å–layoutå¸ƒå±€æ–‡ä»¶ï¼Œä¸€èˆ¬æ˜¯setContentViewæ–¹æ³•çš„è°ƒç”¨åœ°æ–¹ï¼Œç„¶åç”¨å¸ƒå±€æ–‡ä»¶ç»“åˆä»£ç å¾—åˆ°ç”¨æˆ·ç™»å½•çš„é€»è¾‘ï¼Œè¿›è¡Œä¿®æ”¹ 3ã€åœ¨å…³é”®çš„åœ°æ–¹é€šè¿‡ä»£ç æ³¨å…¥æŠ€æœ¯æ¥è·Ÿè¸ªä»£ç æ‰§è¡Œé€»è¾‘ 4ã€æ³¨æ„æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ¡ä»¶åˆ¤æ–­ç­‰æ¯”è¾ƒæ˜¾çœ¼çš„ä»£ç  5ã€å¯¹äºæœ‰äº›apkä¸­çš„æºç ï¼Œå¯èƒ½ä»–æœ‰è‡ªå·±çš„åŠ å¯†ç®—æ³•ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦è·å–åˆ°è¿™ä¸ªåŠ å¯†æ–¹æ³•ï¼Œå¦‚æœåŠ å¯†æ–¹æ³•æ¯”è¾ƒå¤æ‚çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å¤§æ‰¹çš„æµ‹è¯•æ•°æ®æ¥è·å–è¿™ä¸ªåŠ å¯†æ–¹æ³•çš„é€»è¾‘ï¼Œä¸€èˆ¬æ˜¯è¾“å…¥å’Œè¾“å‡ºä½œä¸ºä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæ¯”å¦‚é˜¿é‡Œå®‰å…¨ç¬¬ä¸€å±Šæ¯”èµ›çš„ç¬¬ä¸€é¢˜å°±å¯ä»¥ç”¨é™æ€åˆ†æçš„æ–¹å¼ç ´è§£ï¼Œå®ƒå†…éƒ¨å°±æ˜¯ä¸€ä¸ªåŠ å¯†ç®—æ³•ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æµ‹è¯•æ•°æ®æ¥ç ´è§£ã€‚ 6ã€å¯¹äºé‚£äº›System.loadLibraryåŠ è½½soæ–‡ä»¶çš„ä»£ç ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°è¿™ä¸ªsoæ–‡ä»¶ï¼Œç„¶åç”¨IDAæ‰“å¼€è¿›è¡Œé™æ€åˆ†æï¼Œå› ä¸ºæœ‰äº›apkä¸­æŠŠåŠ å¯†ç®—æ³•æ”¾åˆ°äº†soä¸­äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æµ‹è¯•æ•°æ®æ¥è·å–åŠ å¯†ç®—æ³•ã€‚ 7ã€é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸ªæ–¹å¼ï¼Œå°±æ˜¯ç°åœ¨å¾ˆå¤šapkä¼šåšä¸€äº›æ ¡éªŒå·¥ä½œï¼Œä¸€èˆ¬åœ¨ä»£ç ä¸­åŒ…å«ï¼šâ€œsignatureâ€å­—ç¬¦ä¸²ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…¨å±€æœç´¢ä¸€ä¸‹ï¼Œä¹Ÿè®¸å¯ä»¥è·å–ä¸€äº›é‡è¦ä¿¡æ¯ã€‚]]></content>
      <categories>
        <category>pythonçˆ¬è™«</category>
        <category>çˆ¬è™«æ‹“å±•åŠŸèƒ½</category>
      </categories>
      <tags>
        <tag>çˆ¬è™«</tag>
        <tag>Androidåç¼–è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidé€†å‘-åŠ¨æ€åˆ†æç ´è§£Apk(Debug)]]></title>
    <url>%2F2019%2F03%2F01%2F02.python%E7%88%AC%E8%99%AB%2F%E7%88%AC%E8%99%AB%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%2FAndroid%E9%80%86%E5%90%91-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E7%A0%B4%E8%A7%A3APk(Debug)%2F</url>
    <content type="text"><![CDATA[è½¬è½½: http://www.520monkey.com/ ä¸€ã€çŸ¥è¯†æ¦‚è¦åˆ†æé¦–å…ˆéœ€è¦è§£é‡Šä¸€ä¸‹ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆè¯´æ˜¯è°ƒè¯•smaliæºç ï¼Œä¸æ˜¯Javaæºç ï¼Œå› ä¸ºæˆ‘ä»¬å¼„è¿‡åç¼–è¯‘çš„äººçŸ¥é“ï¼Œä½¿ç”¨apktoolåç¼–è¯‘apkä¹‹åï¼Œä¼šæœ‰ä¸€ä¸ªsmaliæ–‡ä»¶å¤¹ï¼Œè¿™é‡Œå°±å­˜æ”¾äº†apkå¯¹åº”çš„smaliæºç ï¼Œå…³äºsmaliæºç è¿™é‡Œä¸è§£é‡Šäº†ï¼Œç½‘ä¸Šæœ‰ä»‹ç»ã€‚ äºŒã€æ¡ˆä¾‹åˆ†æå› ä¸ºè¿™ä¸€ç¯‡æ˜¯ä¸€ä¸ªæ•™ç¨‹ç¯‡ï¼Œæ‰€ä»¥ä¸èƒ½å…‰è¯´ï¼Œé‚£æ ·ä¼šå¾ˆæ¯ç‡¥çš„ï¼Œæ‰€ä»¥è¿™é‡Œç”¨ä¸€ä¸ªä¾‹å­æ¥ä»‹ç»ä¸€ä¸‹ï¼š æˆ‘ä»¬å°±ç”¨é˜¿é‡Œ2014å¹´å®‰å…¨æŒ‘æˆ˜èµ›çš„ç¬¬ä¸€é¢˜ï¼šAliCrack_one.apk çœ‹åˆ°è¿™å¼ å›¾äº†ï¼Œé˜¿é‡Œè¿˜æŒºä¼šåˆ¶é€ æ°›å›´çš„ï¼Œé‚£ä¹ˆå…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬è¾“å…¥å¯†ç å°±å¯ä»¥ç ´è§£äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•è·å–è¿™ä¸ªå¯†ç ã€‚ ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨apktoolæ¥ç ´è§£apk1java -jar apktool_2.0.0rc4.jar d -d AliCraceme_1.apk -o out è¿™é‡Œçš„å‘½ä»¤ä¸åšè§£é‡Šäº†ã€‚ ä½†æ˜¯æœ‰ä¸€ä¸ªå‚æ•°å¿…é¡»å¸¦ä¸Šï¼Œé‚£å°±æ˜¯ï¼š-d å› ä¸ºè¿™ä¸ªå‚æ•°ä»£è¡¨æˆ‘ä»¬åç¼–è¯‘å¾—åˆ°çš„smaliæ˜¯javaæ–‡ä»¶ï¼Œè¿™é‡Œè¯´çš„æ–‡ä»¶æ˜¯åç¼€åæ˜¯javaï¼Œå¦‚æœä¸å¸¦è¿™ä¸ªå‚æ•°çš„è¯ï¼Œåç¼€åæ˜¯smaliçš„ï¼Œä½†æ˜¯Eclipseä¸­æ˜¯ä¸ä¼šè¯†åˆ«smaliçš„ï¼Œè€Œæ˜¯è¯†åˆ«javaæ–‡ä»¶çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¸€å®šè¦è®°å¾—åŠ ä¸Šè¿™ä¸ªå‚æ•°ã€‚ åç¼–è¯‘æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªoutç›®å½•ï¼Œå¦‚ä¸‹ï¼š æºç éƒ½æ”¾åœ¨smaliæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬è¿›å…¥æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶ï¼š çœ‹åˆ°äº†ï¼Œè¿™é‡Œå…¨æ˜¯Javaæ–‡ä»¶çš„ï¼Œå…¶å®åªæ˜¯åç¼€åä¸ºjavaäº†ï¼Œå†…å®¹è¿˜æ˜¯smaliçš„ï¼š ç¬¬äºŒæ­¥ã€ä¿®æ”¹AndroidManifest.xmlä¸­çš„debugå±æ€§å’Œåœ¨å…¥å£ä»£ç ä¸­æ·»åŠ waitDebugä¸Šé¢æˆ‘ä»¬åç¼–è¯‘æˆåŠŸäº†ï¼Œä¸‹é¢æˆ‘ä»¬ä¸ºäº†åç»­çš„è°ƒè¯•å·¥ä½œï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦åšä¸¤ä»¶äº‹ï¼š 1ã€‹ä¿®æ”¹AndroidManifest.xmlä¸­çš„android:debuggable=â€trueâ€ å…³äºè¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å‰é¢ä»‹ç»run-aså‘½ä»¤çš„æ—¶å€™ï¼Œä¹Ÿæåˆ°äº†ï¼Œä»–æ ‡è¯†è¿™ä¸ªåº”ç”¨æ˜¯å¦æ˜¯debugç‰ˆæœ¬ï¼Œè¿™ä¸ªå°†ä¼šå½±å“åˆ°è¿™ä¸ªåº”ç”¨æ˜¯å¦å¯ä»¥è¢«è°ƒè¯•ï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»è®¾ç½®æˆtrueã€‚ 2ã€‹åœ¨å…¥å£å¤„æ·»åŠ waitForDebuggerä»£ç è¿›è¡Œè°ƒè¯•ç­‰å¾…ã€‚ è¿™é‡Œè¯´çš„å…¥å£å¤„ï¼Œå°±æ˜¯ç¨‹åºå¯åŠ¨çš„åœ°æ–¹ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸€èˆ¬çš„å…¥å£Activityï¼ŒæŸ¥æ‰¾è¿™ä¸ªActivityçš„è¯ï¼Œæ–¹æ³•å¤ªå¤šäº†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œç›´æ¥ä»ä¸Šé¢å¾—åˆ°çš„AndroidManifest.xmlä¸­æ‰¾åˆ°ï¼Œå› ä¸ºå…¥å£Activityçš„actionå’Œcategoryæ˜¯å›ºå®šçš„ã€‚ å½“ç„¶è¿˜æœ‰å…¶ä»–æ–¹å¼ï¼Œæ¯”å¦‚aaptæŸ¥çœ‹apkçš„å†…å®¹æ–¹å¼ï¼Œæˆ–è€…æ˜¯å®‰è£…apkä¹‹åç”¨ adb dumpsys activity top å‘½ä»¤æŸ¥çœ‹éƒ½æ˜¯å¯ä»¥çš„ã€‚ æ‰¾åˆ°å…¥å£Activityä¹‹åï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ä»–çš„onCreateæ–¹æ³•çš„ç¬¬ä¸€è¡ŒåŠ ä¸ŠwaitForDebuggerä»£ç å³å¯ï¼Œæ‰¾åˆ°å¯¹åº”çš„MainActivityçš„smaliæºç ï¼š ç„¶åæ·»åŠ ä¸€è¡Œä»£ç ï¼š 1invoke-static &#123;&#125;, Landroid/os/Debug;-&gt;waitForDebugger()V è¿™ä¸ªæ˜¯smaliè¯­æ³•çš„ï¼Œå…¶å®å¯¹åº”çš„Javaä»£ç å°±æ˜¯ï¼šandroid.os.Debug.waitForDebugger(); è¿™é‡ŒæŠŠJavaè¯­è¨€ç¿»è¯‘æˆsmaliè¯­æ³•çš„ï¼Œä¸éš¾ï¼Œç½‘ä¸Šæœ‰smaliçš„è¯­æ³•è§£æï¼Œè¿™é‡Œä¸æƒ³å†è§£é‡Šäº†ã€‚ ç¬¬ä¸‰æ­¥ï¼šå›ç¼–è¯‘apkå¹¶ä¸”è¿›è¡Œç­¾åå®‰è£…1java -jar apktool_2.0.0rc4.jar b -d out -o debug.apk è¿˜æ˜¯ä½¿ç”¨apktoolè¿›è¡Œå›ç¼–è¯‘ ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°†å¾—åˆ°debug.apkæ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªapkæ˜¯æ²¡æœ‰ç­¾åçš„ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½å®‰è£…çš„ï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬éœ€è¦åœ¨è¿›è¡Œç­¾åï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Androidä¸­çš„æµ‹è¯•ç¨‹åºçš„ç­¾åæ–‡ä»¶å’Œsign.jarå·¥å…·è¿›è¡Œç­¾åï¼š 1java -jar .\sign\signapk.jar .\sign\testkey.x509.pem .\sign\testkey.pk8 debug.apk debug.sig.apk ç­¾åä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå®‰è£…äº†ã€‚ ç¬¬å››æ­¥ï¼šåœ¨Eclipseä¸­æ–°å»ºä¸€ä¸ªJavaå·¥ç¨‹ï¼Œå¯¼å…¥smaliæºç è¿™é‡Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªJavaå·¥ç¨‹ï¼Œè®°ä½ä¸æ˜¯Androidå·¥ç¨‹ï¼Œå› ä¸ºæˆ‘ä»¬æœ€åè°ƒè¯•å…¶å®æ˜¯å€ŸåŠ©äºJavaçš„è°ƒè¯•å™¨ï¼Œç„¶åå‹¾é€‰æ‰Use default locationé€‰é¡¹ï¼Œé€‰æ‹©æˆ‘ä»¬çš„smaliæºç ç›®å½•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢åç¼–è¯‘ä¹‹åçš„outç›®å½•ï¼Œç‚¹å‡»å®Œæˆ æˆ‘ä»¬å¯¼å…¥æºç ä¹‹åçš„é¡¹ç›®å·¥ç¨‹ç»“æ„ï¼š ä¸»è¦çœ‹MainActivityç±»ï¼š ç¬¬äº”æ­¥ï¼šæ‰¾åˆ°å…³é”®ç‚¹ï¼Œç„¶åæ‰“æ–­ç‚¹è¿™ä¸€æ­¥æˆ‘ä»¬çœ‹åˆ°ï¼Œå…¶å®è¯´çš„æ¯”è¾ƒå¹¿ä¹‰äº†ï¼Œè¿™ä¸ªè¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æäº†ï¼Œæ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å½“æˆ‘ä»¬è¾“å…¥å¯†ç ä¹‹åï¼Œè‚¯å®šè¦ç‚¹å‡»æŒ‰é’®ï¼Œç„¶åè§¦å‘å¯†ç çš„æ ¡éªŒè¿‡ç¨‹ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬çŸ¥é“æ‰¾åˆ°è¿™ä¸ªbuttonçš„å®šä¹‰çš„åœ°æ–¹ï¼Œç„¶åè¿›å…¥ä»–çš„ç‚¹å‡»äº‹ä»¶ä¸­å°±å¯ä»¥äº†ã€‚è¿™é‡Œåˆ†ä¸ºä¸‰æ­¥èµ°ï¼š 1ã€‹ä½¿ç”¨Eclipseè‡ªå¸¦çš„Viewåˆ†æå·¥å…·æ‰¾åˆ°Buttonçš„ResId ç‚¹å‡»ä¹‹åï¼Œéœ€è¦ç­‰å¾…ä¸€ä¼šï¼Œåˆ†æViewä¹‹åçš„ç»“æœï¼š çœ‹åˆ°äº†ï¼Œè¿™é‡Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°æ•´ä¸ªå½“å‰çš„é¡µé¢çš„å…¨éƒ¨å¸ƒå±€ï¼Œå·²ç»æ¯ä¸ªæ§ä»¶çš„å±æ€§å€¼ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°buttonçš„resource-id è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°å®šä¹‰æ˜¯@+id/buttonè¿™ä¸ªå€¼ã€‚ 2ã€‹æˆ‘ä»¬å¾—åˆ°è¿™ä¸ªresIdä¹‹åï¼Œèƒ½å¦åœ¨smaliå·¥ç¨‹ä¸­å…¨å±€æœç´¢è¿™ä¸ªå€¼ï¼Œå°±å¯ä»¥å®šä½åˆ°è¿™ä¸ªbuttonçš„å®šä¹‰çš„åœ°æ–¹å‘¢ï¼Ÿ ç„¶åæˆ‘ä»¬çœ‹çœ‹æœåˆ°çš„ç»“æœï¼š è¿™æ—¶å€™æˆ‘ä»¬å…¶å®æ˜¯åœ¨èµ„æºæ–‡ä»¶ä¸­æœåˆ°äº†è¿™ä¸ªidçš„å®šä¹‰ï¼Œè¿™ä¸ªidå€¼å¯¹åº”çš„æ˜¯0x7F05003Eã€‚ å½“ç„¶é™¤äº†è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ç§æ–¹å¼èƒ½å¿«é€Ÿæ‰¾åˆ°è¿™ä¸ªidå¯¹åº”çš„æ•´å‹å€¼ï¼Œé‚£å°±æ˜¯åœ¨åç¼–è¯‘ä¹‹åçš„values/public.xmlæ–‡ä»¶ä¸­ï¼š è¿™ä¸ªæ–‡ä»¶å¾ˆæœ‰ç”¨çš„ï¼Œä»–æ˜¯çœŸä¸ªapkä¸­æ‰€æœ‰èµ„æºæ–‡ä»¶å®šä¹‰çš„æ˜ å°„å†…å®¹ï¼Œæ¯”å¦‚drawable/string/anim/attr/id ç­‰è¿™äº›èµ„æºæ–‡ä»¶å®šä¹‰çš„å€¼ï¼Œåå­—å’Œæ•´å‹å€¼å¯¹åº”çš„åœ°æ–¹ï¼š è¿™ä¸ªæ–‡ä»¶å¾ˆé‡è¦ï¼Œæ˜¯æˆ‘ä»¬åœ¨å¯»æ‰¾çªç ´å£çš„é‡è¦å…³é”®ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦é€šè¿‡å­—ç¬¦ä¸²å†…å®¹æ¥å®šä½åˆ°å…³é”®ç‚¹ï¼Œè¿™é‡Œå°±å¯ä»¥é€šè¿‡stringçš„å®šä¹‰æ¥æ‰¾åˆ°å¯¹åº”çš„æ•´å‹å€¼å³å¯ã€‚ å½“æˆ‘ä»¬æ‰¾åˆ°äº†buttonå¯¹åº”çš„idå€¼äº†ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªidå€¼åœ¨ä¸€æ¬¡å…¨å±€æœç´¢ä¸€ä¸‹ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼ŒAndroidä¸­ç¼–è¯‘ä¹‹åçš„apkï¼Œåœ¨ä»£ç ä¸­ç”¨åˆ°çš„resIdéƒ½æ˜¯ç”¨ä¸€ä¸ªæ•´å‹å€¼ä»£æ›¿çš„ï¼Œè¿™ä¸ªæ•´å‹å€¼å°±æ˜¯åœ¨Ræ–‡ä»¶ä¸­åšäº†å®šä¹‰ï¼Œå°†èµ„æºçš„idå’Œä¸€ä¸ªå€¼å¯¹åº”èµ·æ¥ï¼Œç„¶åä»£ç é‡Œé¢ä¸€èˆ¬ä½¿ç”¨R.id.buttonè¿™æ ·çš„å€¼ï¼Œåœ¨ç¼–è¯‘å‡ºapkçš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼å°±ä¼šè¢«æ›¿æ¢æˆå¯¹åº”çš„æ•´å‹å€¼ï¼Œæ‰€ä»¥åœ¨å…¨å±€æœç´¢0x7F05003E æœç´¢çš„ç»“æœå¦‚ä¸‹ï¼š çœ‹åˆ°äº†ï¼Œè¿™é‡Œå°±å®šä½åˆ°äº†ä»£ç ä¸­ç”¨åˆ°çš„è¿™ä¸ªbuttonï¼Œæˆ‘ä»¬è¿›å…¥ä»£ç çœ‹çœ‹ï¼š åœ¨è¿™é‡Œï¼Œçœ‹åˆ°äº†ï¼Œä½¿ç”¨äº†findViewByIdçš„æ–¹å¼å®šä¹‰Button,æˆ‘ä»¬åœ¨å¾€ä¸‹é¢ç®€å•åˆ†æä¸€ä¸‹smaliè¯­æ³•ï¼Œä¸‹é¢æ˜¯ç»™buttonæ·»åŠ ä¸€ä¸ªæŒ‰é’®äº‹ä»¶ï¼Œè¿™é‡Œç”¨çš„æ˜¯å†…éƒ¨ç±»MainActivity$1ï¼Œæˆ‘ä»¬åˆ°è¿™ä¸ªç±»çœ‹çœ‹ï¼Œä»–è‚¯å®šå®ç°äº†OnClickListeneræ¥å£ï¼Œé‚£ä¹ˆç›´æ¥æœonClickæ–¹æ³•ï¼š åœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä¸‹ä¸ªæ–­ç‚¹äº†ï¼Œè¿™é‡Œå°±æ˜¯è§¦å‘å¯†ç æ ¡éªŒè¿‡ç¨‹ã€‚ ç¬¬å…­æ­¥ï¼šè¿è¡Œç¨‹åºï¼Œè®¾ç½®è¿œç¨‹è°ƒè¯•å·¥ç¨‹åœ¨ç¬¬äº”æ­¥ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†å…³é”®ç‚¹ï¼Œç„¶åæ‰“ä¸Šæ–­ç‚¹ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥è¿è¡Œç¨‹åºï¼Œç„¶ååœ¨Eclipseä¸­è®¾ç½®è¿œç¨‹è°ƒè¯•çš„å·¥ç¨‹ é¦–å…ˆæˆ‘ä»¬è¿è¡Œç¨‹åºï¼Œå› ä¸ºæˆ‘ä»¬åŠ å…¥äº†waitForDebugçš„ä»£ç ï¼Œæ‰€ä»¥å¯åŠ¨çš„æ—¶å€™ä¼šå‡ºç°ä¸€ä¸ªWait debugçš„å¯¹è¯æ¡†ã€‚ä¸è¿‡ï¼Œæˆ‘æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘çš„æ‰‹æœºæ²¡æœ‰å‡ºç°è¿™ä¸ªå¯¹è¯æ¡†ï¼Œè€Œæ˜¯ä¸€ä¸ªç™½å±ï¼Œä¸è¿‡è¿™ä¸ªä¸å½±å“ï¼Œç¨‹åºè¿è¡Œèµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨Eclipseä¸­è®¾ç½®è¿œç¨‹è°ƒè¯•å·¥ç¨‹ï¼Œé¦–å…ˆæˆ‘ä»¬æ‰¾åˆ°éœ€è¦è°ƒè¯•çš„ç¨‹åºå¯¹åº”è¿œç¨‹è°ƒè¯•æœåŠ¡ç«¯å¯¹åº”çš„ç«¯å£ï¼š è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æœ‰å‡ ä¸ªç‚¹ï¼š 1ã€‹åœ¨ç¨‹åºç­‰å¾…è¿œç¨‹è°ƒè¯•æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå‰é¢ä¼šå‡ºç°ä¸€ä¸ªçº¢è‰²çš„å°èœ˜è›› 2ã€‹åœ¨è°ƒè¯•æœåŠ¡ç«¯è¿™é‡Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸¤ä¸ªç«¯å£å·ï¼š8600/8700ï¼Œè¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä¸ªç«¯å£å·å‘¢ï¼Ÿ é¦–å…ˆåœ¨è¿™é‡Œçš„ç«¯å£å·ï¼Œä»£è¡¨çš„æ˜¯ï¼Œè¿œç¨‹è°ƒè¯•æœåŠ¡å™¨ç«¯çš„ç«¯å£ï¼Œä¸‹é¢åœ¨ç®€å•æ¥çœ‹ä¸€ä¸‹ï¼ŒJavaä¸­çš„è°ƒè¯•ç³»ç»Ÿï¼š è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰ä¸‰ä¸ªè§’è‰²ï¼š 111ã€‹JDB Clientç«¯(è¢«è°ƒè¯•çš„å®¢æˆ·ç«¯)ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæˆ‘ä»¬éœ€è¦ç ´è§£çš„ç¨‹åºå°±æ˜¯å®¢æˆ·ç«¯ï¼Œå¦‚æœä¸€ä¸ªç¨‹åºå¯ä»¥è¢«è°ƒè¯•ï¼Œå½“å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªjdwpçº¿ç¨‹ç”¨æ¥å’Œè¿œç¨‹è°ƒè¯•æœåŠ¡ç«¯è¿›è¡Œé€šä¿¡ è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦ç ´è§£çš„ç¨‹åºå¯åŠ¨äº†JDWPçº¿ç¨‹ï¼Œæ³¨æ„è¿™ä¸ªçº¿ç¨‹ä¹Ÿåªæœ‰å½“ç¨‹åºæ˜¯debugæ¨¡å¼ä¸‹æ‰æœ‰çš„ï¼Œä¹Ÿå°±æ˜¯AndroidManifest.xmlä¸­çš„debugå±æ€§å€¼å¿…é¡»æ˜¯trueçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ä¸€å¼€å§‹ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä¿®æ”¹è¿™ä¸ªå€¼çš„åŸå› ã€‚ 222ã€‹JDWPåè®®(ç”¨äºä¼ è¾“è°ƒè¯•ä¿¡æ¯çš„ï¼Œæ¯”å¦‚è°ƒè¯•çš„è¡Œå·ï¼Œå½“å‰çš„å±€éƒ¨å˜é‡çš„ä¿¡æ¯ç­‰)ï¼Œè¿™ä¸ªå°±å¯ä»¥è¯´æ˜ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œåç¼–è¯‘æˆjavaæ–‡ä»¶ï¼Œå› ä¸ºä¸ºäº†Eclipseå¯¼å…¥èƒ½å¤Ÿè¯†åˆ«çš„Javaæ–‡ä»¶ï¼Œç„¶åä¸ºä»€ä¹ˆèƒ½å¤Ÿè°ƒè¯•å‘¢ï¼Ÿå› ä¸ºsmaliæ–‡ä»¶ä¸­æœ‰ä»£ç çš„è¡Œå·å’Œå±€éƒ¨å˜é‡ç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œè°ƒè¯•çš„ã€‚ 333ã€‹JDB Serverç«¯(è¿œç¨‹è°ƒè¯•çš„æœåŠ¡ç«¯ï¼Œä¸€èˆ¬æ˜¯æœ‰JVMç«¯)ï¼Œå°±æ˜¯å¼€å¯ä¸€ä¸ªJVMç¨‹åºæ¥ç›‘å¬è°ƒè¯•ç«¯ï¼Œè¿™é‡Œå°±å¯ä»¥è®¤ä¸ºæ˜¯æœ¬åœ°çš„PCæœºï¼Œå½“ç„¶è¿™é‡Œå¿…é¡»æœ‰ç«¯å£ç”¨æ¥ç›‘å¬ï¼Œé‚£ä¹ˆä¸Šé¢çš„8600ç«¯å£å°±æ˜¯è¿™ä¸ªä½œç”¨ï¼Œè€Œä¸”è¿™é‡Œç«¯å£æ˜¯ä»8600å¼€å§‹ï¼Œåç»­çš„ç¨‹åºç«¯å£åéƒ½æ˜¯ä¾æ¬¡åŠ 1çš„ï¼Œæ¯”å¦‚å…¶ä»–è°ƒè¯•ç¨‹åºï¼š é‚£ä¹ˆæœ‰äº†8600ç«¯å£ï¼Œä¸ºä»€ä¹ˆè¿˜æœ‰ä¸€ä¸ª8700ç«¯å£å‘¢ï¼Ÿä»–æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ å…¶å®ä»–çš„ä½œç”¨å°±æ˜¯è¿œç¨‹è°ƒè¯•ç«¯å¤‡ç”¨çš„åŸºæœ¬ç«¯å£ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯”å¦‚è¿™é‡Œçš„ç ´è§£ç¨‹åºï¼Œæˆ‘ä»¬ç”¨8600ç«¯å£å¯ä»¥è¿æ¥è°ƒè¯•ï¼Œ8700ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å…¶ä»–ç¨‹åºï¼Œæ¯”å¦‚demo.systemapiä»–çš„8607ç«¯å£å¯ä»¥è¿æ¥è°ƒè¯•ï¼Œ8700ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š æ‰€ä»¥å‘€ï¼Œå¯ä»¥æŠŠ8700ç«¯å£æƒ³è±¡æˆå¤§å®¶éƒ½å¯ä»¥ç”¨äºè¿æ¥è°ƒè¯•çš„ä¸€ä¸ªç«¯å£ï¼Œä¸è¿‡ï¼Œåœ¨å®é™…è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨ç¨‹åºç‹¬æœ‰çš„ç«¯å£å·8600ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹8600å’Œ8700ç«¯å£åœ¨è¿œç¨‹è°ƒè¯•ç«¯(æœ¬åœ°pcæœº)çš„å ç”¨æƒ…å†µï¼š çœ‹åˆ°äº†ï¼Œè¿™é‡Œçš„8600ç«¯å£å’Œ8700ç«¯å£å·éƒ½æ˜¯å¯¹åº”çš„javawç¨‹åºï¼Œå…¶å®javawç¨‹åºå°±æ˜¯å¯åŠ¨ä¸€ä¸ªJVMæ¥è¿›è¡Œç›‘å¬çš„ã€‚ å¥½äº†ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å°±å¼„æ¸…æ¥šäº†ï¼ŒJavaä¸­çš„è°ƒè¯•ç³»ç»Ÿä»¥åŠè¿œç¨‹è°ƒè¯•çš„ç«¯å£å·ã€‚ æ³¨æ„ï¼š å…¶å®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨adb jdwpå‘½ä»¤æŸ¥çœ‹ï¼Œå½“å‰è®¾å¤‡ä¸­å¯ä»¥è¢«è°ƒè¯•çš„ç¨‹åºçš„è¿›ç¨‹å·ä¿¡æ¯ï¼š ä¸‹é¢ç»§ç»­ï¼Œæˆ‘ä»¬çŸ¥é“äº†è¿œç¨‹è°ƒè¯•æœåŠ¡ç«¯çš„ç«¯å£ï¼š8600ï¼Œä»¥åŠipåœ°å€ï¼Œè¿™é‡Œå°±æ˜¯æœ¬åœ°ipï¼šlocalhost/127.0.0.1 æˆ‘ä»¬å¯ä»¥åœ¨Eclipseä¸­æ–°å»ºä¸€ä¸ªè¿œç¨‹è°ƒè¯•é¡¹ç›®ï¼Œå°†æˆ‘ä»¬çš„smaliæºç å·¥ç¨‹å’Œè®¾å¤‡ä¸­éœ€è¦è°ƒè¯•çš„ç¨‹åºå…³è”èµ·æ¥ï¼š å³å‡»è¢«è°ƒè¯•çš„é¡¹ç›®=ã€‹é€‰æ‹©Debug Configurationsï¼š ç„¶åå¼€å§‹è®¾ç½®è°ƒè¯•é¡¹ç›® é€‰æ‹©Romote Java Applicationï¼Œåœ¨Projectä¸­é€‰æ‹©è¢«è°ƒè¯•çš„smalié¡¹ç›®ï¼Œåœ¨Connection Typeä¸­é€‰æ‹©SocketAttachæ–¹å¼ï¼Œå…¶å®è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯Listenerçš„ï¼Œå…³äºè¿™ä¸¤ç§æ–¹å¼å…¶å®å¾ˆå¥½ç†è§£ï¼š #Listneræ–¹å¼ï¼šæ˜¯è°ƒè¯•å®¢æˆ·ç«¯å¯åŠ¨å°±å‡†å¤‡å¥½ä¸€ä¸ªç«¯å£ï¼Œå½“è°ƒè¯•æœåŠ¡ç«¯å‡†å¤‡å¥½äº†ï¼Œå°±è¿æ¥è¿™ä¸ªç«¯å£è¿›è¡Œè°ƒè¯• #Attachæ–¹å¼ï¼šæ˜¯è°ƒè¯•æœåŠ¡ç«¯å¼€å§‹å°±å¯åŠ¨ä¸€ä¸ªç«¯å£ï¼Œç­‰å¾…è°ƒè¯•ç«¯æ¥è¿æ¥è¿™ä¸ªç«¯å£ æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯é€‰æ‹©Attachæ–¹å¼æ¥è¿›è¡Œæ“ä½œçš„ã€‚ å¥½äº†ï¼Œæˆ‘ä»¬è®¾ç½®å®Œè¿œç¨‹è°ƒè¯•çš„å·¥ç¨‹ä¹‹åï¼Œå¼€å§‹è¿è¡Œï¼Œæ“¦å‘ç°ï¼Œè®¾å¤‡ä¸Šçš„ç¨‹åºè¿˜æ˜¯ç™½å±ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿçœ‹çœ‹DDMSä¸­è°ƒè¯•ç¨‹åºçš„çŠ¶æ€ï¼š æ“¦ï¼Œå…³è”åˆ°äº†è¿™ä¸ªè¿›ç¨‹ï¼ŒåŸå› ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬æ˜¯ä¸Šé¢ä½¿ç”¨çš„æ˜¯8700ç«¯å£å·ï¼Œè¿™æ—¶å€™æˆ‘ä»¬é€‰ä¸­äº†è¿™ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥å°±æŠŠsmaliè°ƒè¯•å·¥ç¨‹å…³è”åˆ°äº†è¿™ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥ç ´è§£çš„è¿›ç¨‹æ²¡ååº”äº†ï¼Œæˆ‘ä»¬ç«‹é©¬æ”¹ä¸€ä¸‹ï¼Œç”¨8600ç«¯å£ï¼š å¥½äº†ï¼Œè¿™ä¸‹æˆåŠŸäº†ï¼Œæˆ‘ä»¬çœ‹åˆ°çº¢è‰²çš„å°èœ˜è››å˜æˆç»¿è‰²çš„äº†ï¼Œè¯´æ˜è°ƒè¯•ç«¯å·²ç»è¿æ¥ä¸Šè¿œç¨‹è°ƒè¯•æœåŠ¡ç«¯äº†ã€‚ æ³¨æ„ï¼š æˆ‘ä»¬åœ¨è®¾ç½®è¿œç¨‹è°ƒè¯•é¡¹ç›®çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„ç«¯å£å·çš„è®¾ç½®ï¼Œä¸ç„¶æ²¡æœ‰å°†è°ƒè¯•é¡¹ç›®æºç å’Œè°ƒè¯•ç¨‹åºå…³è”èµ·æ¥ï¼Œæ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæœçš„ ç¬¬ä¸ƒæ­¥ï¼šå¼€å§‹è¿è¡Œè°ƒè¯•ç¨‹åºï¼Œè¿›å…¥è°ƒè¯•ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹æ“ä½œäº†ï¼Œåœ¨ç¨‹åºçš„æ–‡æœ¬æ¡†ä¸­è¾“å…¥ï¼šggggå†…å®¹ï¼Œç‚¹å‡»å¼€å§‹ï¼š å¥½äº†ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æœŸå¾…å·²ä¹…çš„è°ƒè¯•ç•Œé¢å‡ºæ¥äº†ï¼Œåˆ°äº†æˆ‘ä»¬å¼€å§‹çš„æ—¶å€™åŠ çš„æ–­ç‚¹å¤„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è°ƒè¯•äº†ï¼Œä½¿ç”¨F6å•æ­¥è°ƒè¯•ï¼ŒF5å•æ­¥è·³å…¥ï¼ŒF7å•æ­¥è·³å‡ºè¿›è¡Œæ“ä½œï¼š çœ‹åˆ°äº†ï¼Œè¿™é‡Œä½¿ç”¨v3å˜é‡ä¿å­˜äº†æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®çš„åœ°æ–¹ï¼Œå°±æ˜¯è°ƒç”¨MainActivityçš„getTableFromPicæ–¹æ³•ï¼Œè·å–ä¸€ä¸ªStringå­—ç¬¦ä¸²ï¼Œä»å˜é‡çš„å€¼æ¥çœ‹ï¼Œè²Œä¼¼ä¸æ˜¯è§„åˆ™çš„å­—ç¬¦ä¸²å†…å®¹ï¼Œè¿™é‡Œå…ˆä¸ç”¨ç®¡äº†ï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼š è¿™é‡Œåˆé‡åˆ°ä¸€ä¸ªé‡è¦çš„æ–¹æ³•ï¼šgetPwdFromPicï¼Œä»å­—é¢æ„ä¹‰ä¸Šçœ‹ï¼Œåº”è¯¥æ˜¯è·å–æ­£ç¡®çš„å¯†ç ï¼Œç”¨äºåé¢çš„å¯†ç å­—ç¬¦ä¸²æ¯”å¯¹ã€‚ æŸ¥çœ‹ä¸€ä¸‹å¯†ç çš„å†…å®¹ï¼Œè²Œä¼¼ä¹Ÿæ˜¯ä¸€ä¸ªä¸è§„åˆ™çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å’Œä¸Šé¢è·å–çš„tableå­—ç¬¦ä¸²å†…å®¹æ ¼å¼å¾ˆåƒï¼Œæ¥ç€å¾€ä¸‹èµ°ï¼š è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªä¿¡æ¯å°±æ˜¯ï¼Œè°ƒç”¨äº†ç³»ç»Ÿçš„Logæ‰“å°ï¼Œlogçš„tagå°±æ˜¯v6ä¿å­˜çš„å€¼ï¼šlil è¿™æ—¶å€™ï¼Œæˆ‘ä»¬çœ‹åˆ°v3æ˜¯ä¿å­˜çš„æˆ‘ä»¬è¾“å…¥çš„å¯†ç å†…å®¹ï¼Œè¿™é‡Œä½¿ç”¨utf-8è·å–ä»–çš„å­—èŠ‚æ•°ç»„ï¼Œç„¶åä¼ é€’ç»™access$0æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨F5è¿›å…¥è¿™ä¸ªæ–¹æ³•ï¼š åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªbytesToAliSmsCodeæ–¹æ³•ï¼Œä½¿ç”¨F5è¿›å…¥ï¼š é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å…¶å®çœ‹ä¸Šå»è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œå°±æ˜¯æŠŠä¼ é€’è¿›æ¥çš„å­—èŠ‚æ•°ç»„ï¼Œå¾ªç¯éå†ï¼Œå–å‡ºå­—èŠ‚å€¼ï¼Œç„¶åè½¬åŒ–æˆintç±»å‹ï¼Œç„¶ååœ¨è°ƒç”¨ä¸Šé¢è·å–åˆ°çš„tableå­—ç¬¦ä¸²çš„chatAtæ¥è·å–æŒ‡å®šçš„å­—ç¬¦ï¼Œä½¿ç”¨StringBuilderè¿›è¡Œæ‹¼æ¥ï¼Œç„¶åè¿”å›å³å¯ã€‚ æŒ‰F7è·³å‡ºï¼ŒæŸ¥çœ‹ï¼Œæˆ‘ä»¬è¿”å›æ¥åŠ å¯†çš„å†…å®¹æ˜¯ï¼šæ—¥æ—¥æ—¥æ—¥ï¼Œä¹Ÿå°±æ˜¯è¯´gggg=&gt;æ—¥æ—¥æ—¥æ—¥ æœ€åå†å¾€ä¸‹èµ°ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è¿›è¡Œä»£ç æ¯”å¯¹çš„å·¥ä½œäº†ã€‚ é‚£ä¹ˆä¸Šé¢æˆ‘ä»¬å°±åˆ†æå®Œäº†æ‰€æœ‰çš„ä»£ç é€»è¾‘ï¼Œè¿˜ä¸ç®—å¤æ‚ï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹æµç¨‹ï¼š A&gt;è°ƒç”¨MainActivityä¸­çš„getTableFromPicæ–¹æ³•ï¼Œè·å–ä¸€ä¸ªtableå­—ç¬¦ä¸² æˆ‘ä»¬å¯ä»¥è¿›å…¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼š è¿™é‡Œå¯ä»¥å¤§ä½“äº†è§£äº†ï¼Œä»–æ˜¯è¯»å–assetç›®å½•ä¸‹çš„ä¸€ä¸ªlogo.pngå›¾ç‰‡ï¼Œç„¶åè·å–å›¾ç‰‡çš„å­—èŠ‚ç ï¼Œåœ¨è¿›è¡Œæ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»ä¸Šé¢çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œå…¶å®è¿™é‡Œçš„tableå­—ç¬¦ä¸²ç±»ä¼¼äºä¸€ä¸ªå¯†é’¥åº“ã€‚ B&gt;é€šè¿‡MainActivityä¸­çš„getPwdFromPicæ–¹æ³•ï¼Œè·å–æ­£ç¡®çš„å¯†ç å†…å®¹ C&gt;è·å–æˆ‘ä»¬è¾“å…¥å†…å®¹çš„utf-8çš„å­—èŠ‚ç ï¼Œç„¶åè°ƒç”¨access$0æ–¹æ³•ï¼Œè·å–åŠ å¯†ä¹‹åçš„å†…å®¹ D&gt;access$0æ–¹æ³•ä¸­åœ¨è°ƒç”¨bytesToAliSmsCodeæ–¹æ³•ï¼Œè·å–åŠ å¯†ä¹‹åçš„å†…å®¹ è¿™ä¸ªæ–¹æ³•æ˜¯æœ€æ ¸å¿ƒçš„ï¼Œæˆ‘ä»¬é€šè¿‡åˆ†æçŸ¥é“ï¼Œä»–çš„é€»è¾‘æ˜¯ï¼Œé€šè¿‡ä¼ é€’è¿›æ¥çš„å­—èŠ‚æ•°ç»„ï¼Œå¾ªç¯éå†æ•°ç»„ï¼Œæ‹¿åˆ°å­—èŠ‚è½¬åŒ–æˆintç±»å‹ï¼Œç„¶ååœ¨è°ƒç”¨å¯†é’¥åº“å­—ç¬¦ä¸²tableçš„charAtå¾—åˆ°å­—ç¬¦ï¼Œä½¿ç”¨StringBuilderè¿›è¡Œæ‹¼æ¥ã€‚ é€šè¿‡ä¸Šé¢çš„åˆ†æä¹‹åï¼Œæˆ‘ä»¬çŸ¥é“è·å–åŠ å¯†ä¹‹åçš„è¾“å…¥å†…å®¹å’Œæ­£ç¡®çš„å¯†ç å†…å®¹åšæ¯”è¾ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨æœ‰çš„èµ„æºæ˜¯ï¼šå¯†é’¥åº“å­—ç¬¦ä¸²å’Œæ­£ç¡®çš„åŠ å¯†ä¹‹åçš„å¯†ç ï¼Œä»¥åŠåŠ å¯†çš„é€»è¾‘ é‚£ä¹ˆæˆ‘ä»¬çš„ç ´è§£æ€è·¯å…¶å®å¾ˆç®€å•äº†ï¼Œç›¸å½“äºï¼Œæˆ‘ä»¬çŸ¥é“äº†å¯†é’¥åº“å­—ç¬¦ä¸²ï¼Œä¹ŸçŸ¥é“äº†ï¼ŒåŠ å¯†ä¹‹åçš„å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡éå†åŠ å¯†ä¹‹åçš„å­—ç¬¦ä¸²ï¼Œå¾ªç¯éå†ï¼Œè·å–å­—ç¬¦ï¼Œç„¶åå†å»å¯†é’¥åº“æ‰¾åˆ°æŒ‡å®šçš„indexï¼Œç„¶ååœ¨è½¬æˆbyte,ä¿å­˜åˆ°å­—èŠ‚æ•°ç»„ï¼Œç„¶åç”¨utf-8è·å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯æˆ‘ä»¬è¦çš„å¯†ç ã€‚ ä¸‹é¢æˆ‘ä»¬å°±ç”¨ä»£ç æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š ä»£ç é€»è¾‘ï¼Œå¾ˆç®€å•å§ï¼Œå…¶å®è¿™ä¸ªå‡½æ•°ç›¸å½“äºä¸Šé¢åŠ å¯†å‡½æ•°çš„bytesToAliSmsCodeçš„åå‘å®ç°ï¼Œè¿è¡Œç»“æœï¼š OKï¼Œå¾—åˆ°äº†æ­£ç¡®çš„å¯†ç ï¼Œä¸‹é¢æ¥éªŒè¯ä¸€ä¸‹ï¼š å“ˆå“ˆï¼Œä¸è¦å¤ªæ¿€åŠ¨ï¼ŒæˆåŠŸå•¦å•¦~~ã€‚ç ´è§£æˆåŠŸã€‚ è¡¥å……ï¼š åˆšåˆšæˆ‘ä»¬åœ¨æ–­ç‚¹è°ƒè¯•çš„æ—¶å€™ï¼Œçœ‹åˆ°äº†ä»£ç ä¸­ç”¨äº†Logæ¥æ‰“å°æ—¥å¿—ï¼Œtagæ˜¯lilï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ‰“å°è¿™ä¸ªlogçœ‹çœ‹ç»“æœï¼š çœ‹åˆ°äº†ï¼Œè¿™é‡Œtableæ˜¯å¯†é’¥åº“ï¼Œpwæ˜¯æ­£ç¡®çš„åŠ å¯†ä¹‹åçš„å¯†ç ï¼ŒenPasswordæ˜¯æˆ‘ä»¬è¾“å…¥ä¹‹ååŠ å¯†çš„å¯†ç ã€‚ æ‰€ä»¥ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªä¾‹å­ï¼Œå…¶å®æˆ‘ä»¬åœ¨ç ´è§£apkçš„æ—¶å€™ï¼Œæœ‰æ—¶å€™æ—¥å¿—ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ä¿¡æ¯ã€‚ ä¸‰ã€æ€è·¯æ•´ç†1ã€æˆ‘ä»¬é€šè¿‡apktoolå·¥å…·è¿›è¡Œapkçš„åç¼–è¯‘ï¼Œå¾—åˆ°smaliæºç å’ŒAndroidManifest.xmlï¼Œç„¶åä¿®æ”¹AndroidManifest.xmlä¸­çš„debugå±æ€§ä¸ºtrueï¼ŒåŒæ—¶åœ¨å…¥å£å¤„åŠ ä¸ŠwaitForDebugä»£ç ï¼Œè¿›è¡Œdebugç­‰å¾…ï¼Œä¸€èˆ¬å…¥å£éƒ½æ˜¯å…ˆæ‰¾åˆ°å…¥å£Activityï¼Œç„¶ååœ¨onCreateæ–¹æ³•ä¸­çš„ç¬¬ä¸€è¡Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šapktoolå·¥å…·ä¸€å®šè¦åŠ ä¸Š-då‚æ•°ï¼Œè¿™æ ·åç¼–è¯‘å¾—åˆ°çš„æ–‡ä»¶æ˜¯javaæ–‡ä»¶ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿè¢«Eclipseè¯†åˆ«ï¼Œè¿›è¡Œè°ƒè¯•ã€‚ 2ã€ä¿®æ”¹å®ŒæˆAndroidManifest.xmlå’Œæ·»åŠ waitForDebugä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä½¿ç”¨apktoolè¿›è¡Œå›ç¼–è¯‘ï¼Œå›ç¼–è¯‘ä¹‹åå¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ²¡æœ‰ç­¾åçš„apkï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨signapk.jaræ¥è¿›è¡Œç­¾åï¼Œç­¾åæ–‡ä»¶ç›´æ¥ä½¿ç”¨æµ‹è¯•ç¨‹åºçš„ç­¾åæ–‡ä»¶å°±å¯ä»¥ï¼Œæœ€ååœ¨è¿›è¡Œå®‰è£…ã€‚ 3ã€ç„¶åæˆ‘ä»¬å°†åç¼–è¯‘ä¹‹åçš„smaliæºç å¯¼å…¥åˆ°Eclipseå·¥ç¨‹ä¸­ï¼Œæ‰¾åˆ°å…³é”®ç‚¹ï¼Œè¿›è¡Œä¸‹æ–­ç‚¹ï¼Œè¿™é‡Œçš„å…³é”®ç‚¹ï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬å…ˆå¤§è‡´äº†è§£ç¨‹åºè¿è¡Œçš„ç»“æ„ï¼Œç„¶åæ‰¾åˆ°æˆ‘ä»¬éœ€è¦ç ´è§£çš„åœ°æ–¹ï¼Œä½¿ç”¨Viewåˆ†æå·¥å…·ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨jd-guiå·¥å…·ç›´æ¥æŸ¥çœ‹apkæºç (ä½¿ç”¨dex2jarå°†dexæ–‡ä»¶è½¬åŒ–æˆjaræ–‡ä»¶ï¼Œç„¶åç”¨jd-guiè¿›è¡ŒæŸ¥çœ‹)ï¼Œæ‰¾åˆ°ä»£ç çš„å¤§ä½“ä½ç½®ã€‚ç„¶åä¸‹æ–­ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©Eclipseçš„DDMSè‡ªå¸¦çš„Viewåˆ†æå·¥å…·æ‰¾åˆ°å¯¹åº”æ§ä»¶çš„residï¼Œç„¶ååœ¨å…¨å±€æœç´¢è¿™ä¸ªæ§ä»¶çš„residï¼Œæˆ–è€…ç›´æ¥åœ¨values/public.xmlä¸­æŸ¥æ‰¾ï¼Œæœ€ç»ˆå®šä½åˆ°è¿™ä¸ªæ§ä»¶ä½ç½®ï¼Œåœ¨æŸ¥çœ‹ä»–çš„ç‚¹å‡»äº‹ä»¶å³å¯ã€‚ 4ã€è®¾ç½®è¿œç¨‹è°ƒè¯•å·¥ç¨‹ï¼Œé¦–å…ˆè¿è¡Œéœ€è¦è°ƒè¯•ç¨‹åºï¼Œç„¶ååœ¨DDMSä¸­æ‰¾åˆ°å¯¹åº”çš„è°ƒè¯•æœåŠ¡ç«¯çš„ç«¯å£å·ï¼Œç„¶ååœ¨Debug Configurationsä¸­è®¾ç½®è¿œç¨‹è°ƒè¯•é¡¹ç›®ï¼Œè®¾ç½®å¯¹åº”çš„è°ƒè¯•ç«¯å£å’Œipåœ°å€(ä¸€èˆ¬éƒ½æ˜¯æœ¬æœºpc,é‚£å°±æ˜¯localhost)ï¼Œç„¶åçº¢è‰²å°èœ˜è››å˜æˆç»¿è‰²çš„ï¼Œè¡¨ç¤ºæˆ‘ä»¬çš„è¿œç¨‹è°ƒè¯•é¡¹ç›®è¿æ¥å…³è”ä¸Šäº†è°ƒè¯•ç¨‹åºï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€å®šéœ€è¦å…³è”æ­£ç¡®ï¼Œä¸ç„¶æ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæœçš„ï¼Œå…³è”æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥è¿›è¡Œæ“ä½œã€‚ 5ã€æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šè¿›å…¥åˆ°å…³é”®çš„æ–­ç‚¹å¤„ï¼Œé€šè¿‡F6å•æ­¥ï¼ŒF5å•æ­¥è¿›å…¥ï¼ŒF7å•æ­¥è·³å‡ºï¼Œæ¥è¿›è¡Œè°ƒè¯•ï¼Œæ‰¾åˆ°å…³é”®æ–¹æ³•ï¼Œç„¶åé€šè¿‡åˆ†æsmaliè¯­æ³•ï¼Œäº†è§£é€»è¾‘ï¼Œå¦‚æœé€»è¾‘å¤æ‚çš„ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹å…·ä½“çš„ç¯å¢ƒå˜é‡çš„å€¼æ¥è§‚å¯Ÿï¼Œè¿™é‡Œä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œä¹Ÿæ˜¯æœ€å¤æ‚çš„ï¼ŒåŒæ—¶è¿™é‡Œä¹Ÿæ˜¯æ²¡æœ‰è§„ç« å¯å¯»çš„ï¼Œè¿™ä¸ªå’Œæ¯ä¸ªäººçš„é€»è¾‘æ€ç»´ä»¥åŠç ´è§£èƒ½åŠ›æœ‰å…³ç³»ï¼Œåˆ†æå…³é”®çš„åŠ å¯†æ–¹æ³•æ˜¯éœ€è¦åŠŸåº•çš„ï¼Œå½“ç„¶è¿™é‡Œè¿˜éœ€è¦æ³¨æ„ä¸€ä¸ªä¿¡æ¯ï¼Œå°±æ˜¯Logæ—¥å¿—ï¼Œæœ‰æ—¶å€™ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªä¿¡æ¯ã€‚ 6ã€æœ€åä¸€èˆ¬å½“æˆ‘ä»¬çŸ¥é“äº†æ ¸å¿ƒæ–¹æ³•çš„é€»è¾‘ï¼Œè¦æƒ³å¾—åˆ°æ­£ç¡®çš„å¯†ç ï¼Œè¿˜æ˜¯éœ€è¦è‡ªå·±ç”¨è¯­è¨€å»å®ç°é€»è¾‘çš„ï¼Œæ¯”å¦‚æœ¬æ–‡ä¸­çš„åŠ å¯†æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„codeä¸€ä¸‹åŠ å¯†çš„é€†å‘æ–¹æ³•ï¼Œæ‰èƒ½å¾—åˆ°æ­£ç¡®çš„å¯†ç ã€‚ äº”ã€é—ç•™é—®é¢˜1ã€ä½¿ç”¨apktoolå·¥å…·è¿›è¡Œåç¼–è¯‘æœ‰æ—¶å€™å¹¶ä¸æ˜¯é‚£ä¹ˆé¡ºåˆ©ï¼Œæ¯”å¦‚åƒè¿™æ ·çš„æŠ¥é”™ï¼š è¿™ä¸ªä¸€èˆ¬éƒ½æ˜¯apktoolä¸­è§£æå‡ºç°äº†é”™è¯¯ï¼Œå…¶å®è¿™ä¸ªéƒ½æ˜¯ç°åœ¨apkä¸ºäº†æŠµæŠ—apktoolï¼Œåšçš„apkåŠ å›ºç­–ç•¥ï¼Œè¿™ä¸ªåé¢ä¼šå†™ä¸€ç¯‡æ–‡ç« å¦‚ä½•åº”å¯¹è¿™äº›åŠ å›ºç­–ç•¥ï¼Œå¦‚ä½•è¿›è¡Œapkä¿®å¤ï¼Œå…¶å®åŸç†å°±æ˜¯åˆ†æapktoolæºç ï¼Œæ‰¾åˆ°æŒ‡å®šçš„æŠ¥é”™ä½ç½®ï¼Œè¿›è¡Œapktoolä»£ç ä¿®å¤å³å¯ã€‚ 2ã€æœ¬æ–‡ä¸­è¯´åˆ°äº†Javaçš„è°ƒè¯•ç³»ç»Ÿï¼Œä½†æ˜¯ä¸ºäº†ç¯‡å¹…é™åˆ¶ï¼Œæ²¡æœ‰è¯¦ç»†çš„è®²è§£äº†æ•´ä¸ªå†…å®¹ï¼Œåé¢ä¼šå†™ä¸€ç¯‡æ–‡ç« å…·ä½“ä»‹ç»Javaä¸­çš„è°ƒè¯•ç³»ç»Ÿä»¥åŠAndroidçš„è°ƒè¯•ç³»ç»Ÿã€‚ 3ã€æœ‰æ—¶å€™æˆ‘ä»¬è¿˜ä¼šé‡åˆ°å›ç¼–è¯‘æˆåŠŸäº†ï¼Œç„¶åé‡åˆ°è¿è¡Œä¸èµ·æ¥çš„é”™è¯¯ï¼Œè¿™ä¸ªå°±éœ€è¦ä½¿ç”¨é™æ€æ–¹å¼å…ˆå»åˆ†æç¨‹åºå¯åŠ¨çš„é€»è¾‘ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ç¨‹åºåšäº†ä»€ä¹ˆè¿è¡Œé™åˆ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨é™æ€åˆ†æé‚£ç¯‡æ–‡ç« ä¸­ï¼Œæåˆ°äº†åº”ç”¨ä¸ºäº†é˜²æ­¢åç¼–è¯‘åœ¨å›ç¼–è¯‘è¿è¡Œï¼Œåœ¨ç¨‹åºçš„å…¥å£å¤„ä½œäº†ç­¾åæ ¡éªŒï¼Œå¦‚æœæ ¡éªŒå¤±è´¥ï¼Œç›´æ¥killæ‰è‡ªå·±çš„è¿›ç¨‹ï¼Œé€€å‡ºç¨‹åºäº†ï¼Œæ‰€ä»¥è¿™æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä½¿ç”¨é™æ€æ–¹å¼å»åˆ†æapkã€‚ 4ã€å¦‚ä½•åšåˆ°ä¸ä¿®æ”¹AndroidManifest.xmlä¸­çš„debugå±æ€§å°±å¯ä»¥è¿›è¡Œè°ƒè¯•ï¼š 1ã€‹ ä¿®æ”¹boot.img,ä»è€Œæ‰“å¼€ç³»ç»Ÿè°ƒè¯•ï¼Œè¿™æ ·å°±å¯ä»¥çœå»ç»™appæ·»åŠ android:debuggable=â€trueâ€ï¼Œå†é‡æ‰“åŒ…çš„æ­¥éª¤äº†ã€‚2ã€‹ç›´æ¥ä¿®æ”¹ç³»ç»Ÿå±æ€§ï¼Œä½¿ç”¨setpropexå·¥å…·åœ¨å·²ç»rootçš„è®¾å¤‡ä¸Šä¿®æ”¹åªè¯»çš„ç³»ç»Ÿå±æ€§ã€‚ä½¿ç”¨æ­¤å·¥å…·æ¥ä¿®æ”¹ro.secureå’Œro.debuggableçš„å€¼ã€‚ è¿™ä¸ªä¹Ÿä¼šåœ¨åé¢è¯¦ç»†ä»‹ç»è¿™ä¸¤ç§æ–¹æ³• å››ã€æ€»ç»“è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°±ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Eclipseå»åŠ¨æ€è°ƒè¯•åç¼–è¯‘ä¹‹åçš„smaliæºç ï¼Œè¿™ç§æ–¹å¼æ¯”é™æ€æ–¹å¼é«˜æ•ˆå¾ˆå¤šçš„ï¼Œæ¯”å¦‚æœ¬æ–‡ä¸­çš„è¿™ä¸ªä¾‹å­ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨é™æ€æ–¹å¼è¿›è¡Œç ´è§£çš„ï¼Œä½†æ˜¯è‚¯å®šæ•ˆç‡æ²¡æœ‰åŠ¨æ€æ–¹å¼é«˜æ•ˆï¼Œæ‰€ä»¥ä»¥åæˆ‘ä»¬åˆå­¦ä¼šäº†ä¸€ä¸ªæŠ€èƒ½ï¼Œå°±æ˜¯åŠ¨æ€çš„è°ƒè¯•smaliæºç æ¥è·Ÿè¸ªç¨‹åºçš„æ ¸å¿ƒç‚¹ï¼Œä½†æ˜¯ç°åœ¨å¸‚åœºä¸Šçš„å¤§éƒ¨åˆ†åº”ç”¨æ²¡æœ‰è¿™ä¹ˆç®€å•å°±ç ´è§£äº†ï¼Œæ¯”å¦‚æ ¸å¿ƒçš„åŠ å¯†ç®—æ³•æ”¾åˆ°äº†nativeå±‚å»åšï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬å»åŠ¨æ€è°ƒè¯•soæ–‡ä»¶è·Ÿè¸ªï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« çš„å†…å®¹ï¼Œä¹Ÿæœ‰çš„æ—¶å€™ï¼Œapkè¿›è¡ŒåŠ å›ºäº†ï¼Œç›´æ¥åœ¨apktoolè¿›è¡Œåç¼–è¯‘å°±å¤±è´¥äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å…ˆè¿›è¡Œapkä¿®å¤ï¼Œç„¶åæ‰èƒ½åç»­çš„æ“ä½œï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬ä¸‹ä¸‹ç¯‡çš„æ–‡ç« ï¼Œå¦‚ä½•åº”å¯¹apkçš„åŠ å›ºç­–ç•¥ã€‚é€šè¿‡è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŠ¨æ€æ–¹å¼ç ´è§£æ¯”é™æ€æ–¹å¼é«˜æ•ˆçš„å¤šï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨é™æ€æ–¹å¼å…ˆåšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæ‰€ä»¥åœ¨ç ´è§£apkçš„æ—¶å€™ï¼ŒåŠ¨é™ç»“åˆï¼Œæ‰èƒ½åšåˆ°å®Œç¾çš„ç ´è§£ã€‚]]></content>
      <categories>
        <category>pythonçˆ¬è™«</category>
        <category>çˆ¬è™«æ‹“å±•åŠŸèƒ½</category>
      </categories>
      <tags>
        <tag>çˆ¬è™«</tag>
        <tag>Androidåç¼–è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidé€†å‘-åŠ¨æ€åˆ†æç ´è§£Apk(ç ´è§£åŠ å›º)]]></title>
    <url>%2F2019%2F03%2F01%2F02.python%E7%88%AC%E8%99%AB%2F%E7%88%AC%E8%99%AB%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%2FAndroid%E9%80%86%E5%90%91-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E7%A0%B4%E8%A7%A3APk(%E7%A0%B4%E8%A7%A3%E5%8A%A0%E5%9B%BA)%2F</url>
    <content type="text"><![CDATA[è½¬è½½: http://www.520monkey.com/ ä¸€ã€å‰è¨€ä»‹ç»ä¸€ä¸‹å¦‚ä½•åº”å¯¹ç°åœ¨å¸‚åœºä¸­ä¸€äº›åŠ å›ºçš„apkçš„ç ´è§£ä¹‹é“ï¼Œç°åœ¨å¸‚åœºä¸­åŠ å›ºapkçš„æ–¹å¼ä¸€èˆ¬å°±æ˜¯ä¸¤ç§ï¼šä¸€ç§æ˜¯å¯¹æºapkæ•´ä½“åšä¸€ä¸ªåŠ å›ºï¼Œæ”¾åˆ°æŒ‡å®šä½ç½®ï¼Œè¿è¡Œçš„æ—¶å€™åœ¨è§£å¯†åŠ¨æ€åŠ è½½ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯å¯¹soè¿›è¡ŒåŠ å›ºï¼Œåœ¨soåŠ è½½å†…å­˜çš„æ—¶å€™è¿›è¡Œè§£å¯†é‡Šæ”¾ã€‚æˆ‘ä»¬ä»Šå¤©ä¸»è¦çœ‹ç¬¬ä¸€ç§åŠ å›ºæ–¹å¼ï¼Œå°±æ˜¯å¯¹apkæ•´ä½“è¿›è¡ŒåŠ å›ºã€‚ äºŒã€æ¡ˆä¾‹åˆ†ææŒ‰ç…§å›½é™…æƒ¯ä¾‹ï¼Œå’‹ä»¬è¿˜æ˜¯å¾—ç”¨ä¸€ä¸ªæ¡ˆä¾‹æ¥åˆ†æè®²è§£ï¼Œè¿™æ¬¡ä¾ç„¶é‡‡ç”¨çš„æ˜¯é˜¿é‡Œçš„CTFæ¯”èµ›çš„ç¬¬ä¸‰é¢˜ï¼š é¢˜ç›®æ˜¯ï¼šè¦æ±‚è¾“å…¥ä¸€ä¸ªç½‘é¡µçš„urlï¼Œç„¶åä¼šè·³è½¬åˆ°è¿™ä¸ªé¡µé¢ï¼Œä½†æ˜¯å¿…é¡»è¦æ±‚å¼¹å‡ºæŒ‡å®šå†…å®¹çš„Toastæç¤ºï¼Œè¿™ä¸ªå†…å®¹æ˜¯ï¼šç¥¥é¾™ï¼ äº†è§£åˆ°é¢˜ç›®ï¼Œæˆ‘ä»¬å°±æ¥ç®€å•åˆ†æä¸€ä¸‹ï¼Œè¿™é‡Œå¤§è‡´çš„é€»è¾‘åº”è¯¥æ˜¯ï¼Œè¾“å…¥çš„urlä¼šä¼ é€’ç»™ä¸€ä¸ªWebViewæ§ä»¶ï¼Œè¿›è¡Œå±•ç¤ºç½‘é¡µï¼Œå¦‚æœæŒ‰ç…§é¢˜ç›®çš„é€»è¾‘çš„è¯ï¼Œåº”è¯¥æ˜¯ç½‘é¡µä¸­çš„Jsä¼šè°ƒç”¨æœ¬åœ°çš„ä¸€ä¸ªJavaæ–¹æ³•ï¼Œç„¶åå¼¹å‡ºç›¸åº”çš„æç¤ºï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±æ¥å¼€å§‹æ“ä½œäº†ã€‚ æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„ç ´è§£æ­¥éª¤ï¼š ç¬¬ä¸€æ­¥ï¼šè‚¯å®šæ˜¯å…ˆç”¨è§£å‹è½¯ä»¶æå‡ºæ¥ä»–çš„classes.dexæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨dex2jar+jd-guiè¿›è¡ŒæŸ¥çœ‹javaä»£ç  æ“¦ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°è¿™é‡Œåªæœ‰ä¸€ä¸ªApplicationç±»ï¼Œä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªapkå¯èƒ½è¢«åŠ å›ºäº†ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªapkåŠ å›ºï¼Œå¤–é¢è‚¯å®šå¾—å¥—ä¸€ä¸ªå£³ï¼Œè¿™ä¸ªå£³å¿…é¡»æ˜¯è‡ªå®šä¹‰çš„Applicationç±»ï¼Œå› ä¸ºä»–éœ€è¦åšä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œé‚£ä¹ˆä¸€èˆ¬ç°åœ¨åŠ å›ºçš„apkçš„å£³çš„Applicationç±»éƒ½å–œæ¬¢å«StubApplicationã€‚è€Œä¸”ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†ä¸€ä¸ªApplicationç±»ï¼Œæ²¡æœ‰å…¶ä»–ä»»ä½•ç±»äº†ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„å¦‚å¯Activityç±»éƒ½æ²¡æœ‰äº†ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ä¼šå‘ç°ï¼Œå¾ˆè›‹ç–¼ï¼Œæ— å¤„ä¸‹æ‰‹äº†ã€‚ ç¬¬äºŒæ­¥ï¼šæˆ‘ä»¬ä¼šä½¿ç”¨apktoolå·¥å…·è¿›è¡Œapkçš„åç¼–è¯‘ï¼Œå¾—åˆ°apkçš„AndroidManifest.xmlå’Œèµ„æºå†…å®¹ åç¼–è¯‘ä¹‹åï¼Œçœ‹åˆ°ç¨‹åºä¼šæœ‰ä¸€ä¸ªå…¥å£çš„Activityå°±æ˜¯MainActivityç±»ï¼Œæˆ‘ä»¬è®°ä½ä¸€ç‚¹å°±æ˜¯ï¼Œä¸ç®¡æœ€åçš„apkå¦‚ä½•åŠ å›ºï¼Œå³ä½¿æˆ‘ä»¬çœ‹ä¸åˆ°ä»£ç ä¸­çš„å››å¤§ç»„ä»¶çš„å®šä¹‰ï¼Œä½†æ˜¯è‚¯å®šä¼šåœ¨AndroidManifest.xmlä¸­å£°æ˜çš„ï¼Œå› ä¸ºå¦‚æœä¸å£°æ˜çš„è¯ï¼Œè¿è¡Œæ˜¯ä¼šæŠ¥é”™çš„ã€‚é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬ä¹Ÿåˆ†æå®Œäº†è¯¥åˆ†æçš„å†…å®¹ï¼Œè¿˜æ˜¯æ²¡å‘ç°æˆ‘ä»¬çš„å…¥å£Activityç±»ï¼Œè€Œä¸”æˆ‘ä»¬çŸ¥é“ä»–è‚¯å®šæ˜¯æ”¾åœ¨æœ¬åœ°çš„ä¸€ä¸ªåœ°æ–¹ï¼Œå› ä¸ºéœ€è¦è§£å¯†åŠ¨æ€åŠ è½½ï¼Œæ‰€ä»¥ä¸å¯èƒ½æ˜¯æ”¾åœ¨ç½‘ä¸Šçš„ï¼Œè‚¯å®šæ˜¯æœ¬åœ°ï¼Œæ‰€ä»¥è¿™é‡Œå°±æœ‰ä¸€äº›æŠ€å·§äº†ï¼š å½“æˆ‘ä»¬å‘ç°apkä¸­ä¸»è¦çš„ç±»éƒ½æ²¡æœ‰äº†ï¼Œè‚¯å®šæ˜¯apkè¢«åŠ å›ºäº†ï¼ŒåŠ å›ºçš„æºç¨‹åºè‚¯å®šæ˜¯åœ¨æœ¬åœ°ï¼Œä¸€èˆ¬ä¼šæœ‰è¿™ä¹ˆå‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„çš„ï¼š 1ã€åº”ç”¨ç¨‹åºçš„assetç›®å½•ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªç›®å½•æ˜¯ä¸å‚ä¸apkçš„èµ„æºç¼–è¯‘è¿‡ç¨‹çš„ï¼Œæ‰€ä»¥å¾ˆå¤šåŠ å›ºçš„åº”ç”¨å–œæ¬¢æŠŠåŠ å¯†ä¹‹åçš„æºapkæ”¾åˆ°è¿™é‡Œ 2ã€æŠŠæºapkåŠ å¯†æ”¾åˆ°å£³çš„dexæ–‡ä»¶çš„å°¾éƒ¨ï¼Œè¿™ä¸ªè‚¯å®šä¸æ˜¯æˆ‘ä»¬è¿™é‡Œçš„æ¡ˆä¾‹ï¼Œä½†æ˜¯ä¹Ÿæœ‰è¿™æ ·çš„åŠ å›ºæ–¹å¼ï¼Œè¿™ç§åŠ å›ºæ–¹å¼ä¼šå‘ç°ä½¿ç”¨dex2jarå·¥å…·è§£ædexæ˜¯å¤±è´¥çš„ï¼Œæˆ‘ä»¬è¿™æ—¶å€™å°±çŸ¥é“äº†ï¼Œè‚¯å®šå¯¹dexåšäº†æ‰‹è„š 3ã€æŠŠæºapkåŠ å¯†æ”¾åˆ°soæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒéš¾äº†ï¼Œä¸€èˆ¬éƒ½æ˜¯æŠŠæºapkè¿›è¡Œæ‹†åˆ†ï¼Œå­˜åˆ°soæ–‡ä»¶ä¸­ï¼Œåˆ†æéš¾åº¦ä¼šåŠ å¤§çš„ã€‚ ä¸€èˆ¬éƒ½æ˜¯è¿™ä¸‰ä¸ªåœ°æ–¹ï¼Œå…¶å®æˆ‘ä»¬çŸ¥é“è®°ä½ä¸€ç‚¹ï¼šå°±æ˜¯ä¸ç®¡æºapkè¢«æ‹†åˆ†ï¼Œè¢«åŠ å¯†äº†ï¼Œè¢«æ”¾åˆ°å“ªäº†ï¼Œåªè¦æ˜¯åœ¨æœ¬åœ°ï¼Œæˆ‘ä»¬éƒ½æœ‰åŠæ³•å¾—åˆ°ä»–çš„ã€‚ å¥½äº†ï¼ŒæŒ‰ç…§è¿™ä¸Šé¢çš„ä¸‰ä¸ªæ€è·¯æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œè¿™ä¸ªapkä¸­åŠ å›ºçš„æºapkæ”¾åœ¨å“ªäº†ï¼Ÿé€šè¿‡åˆšåˆšçš„dexæ–‡ä»¶åˆ†æï¼Œå‘ç°ç¬¬äºŒç§æ–¹å¼è‚¯å®šä¸å¯èƒ½äº†ï¼Œé‚£ä¹ˆä¼šæ”¾åœ¨assetç›®å½•ä¸­å—ï¼Ÿæˆ‘ä»¬æŸ¥çœ‹assetç›®å½•ï¼š çœ‹åˆ°assetç›®å½•ä¸­çš„ç¡®æœ‰ä¸¤ä¸ªjaræ–‡ä»¶ï¼Œè€Œä¸”æˆ‘ä»¬ç¬¬ä¸€ååº”æ˜¯ä½¿ç”¨jd-guiæ¥æŸ¥çœ‹jarï¼Œå¯æƒœçš„æ˜¯æ‰“å¼€å¤±è´¥ï¼Œæ‰€ä»¥çŒœæƒ³è¿™ä¸ªjaræ˜¯ç»è¿‡å¤„ç†äº†ï¼Œåº”è¯¥æ˜¯åŠ å¯†ï¼Œæ‰€ä»¥è¿™é‡Œå¾ˆæœ‰å¯èƒ½æ˜¯å­˜æ”¾æºapkçš„åœ°æ–¹ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸Šé¢ä¹Ÿè¯´äº†è¿˜æœ‰ç¬¬ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬å»çœ‹çœ‹libsç›®å½•ä¸­çš„soæ–‡ä»¶ï¼š ** æ“¦ï¼Œè¿™é‡Œæœ‰ä¸‰ä¸ªsoæ–‡ä»¶ï¼Œè€Œæˆ‘ä»¬ä¸Šé¢çš„Applicationä¸­åŠ è½½çš„åªæœ‰ä¸€ä¸ªsoæ–‡ä»¶ï¼šlibmobisec.soï¼Œé‚£ä¹ˆå…¶ä»–çš„ä¸¤ä¸ªsoæ–‡ä»¶å¾ˆæœ‰å¯èƒ½æ˜¯æ‹†åˆ†çš„apkæ–‡ä»¶çš„è—èº«ä¹‹å¤„ã€‚ é€šè¿‡ä¸Šé¢çš„åˆ†æä¹‹åï¼Œæˆ‘ä»¬å¤§è‡´çŸ¥é“äº†ä¸¤ä¸ªåœ°æ–¹å¾ˆæœ‰å¯èƒ½æ˜¯æºapkçš„è—èº«åœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯assetç›®å½•ï¼Œä¸€ä¸ªæ˜¯libsç›®å½•ï¼Œé‚£ä¹ˆåˆ†æå®Œäº†ä¹‹åï¼Œæˆ‘ä»¬å‘ç°ç°åœ¨é¢ä¸´ä¸¤ä¸ªé—®é¢˜ï¼š ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šassetç›®å½•ä¸­çš„jaræ–‡ä»¶è¢«å¤„ç†äº†ï¼Œæ‰“ä¸å¼€ï¼Œä¹Ÿä¸çŸ¥é“å¤„ç†é€»è¾‘ ç¬¬äºŒä¸ªé—®é¢˜ï¼šlibsç›®å½•ä¸­çš„ä¸‰ä¸ªsoæ–‡ä»¶ï¼Œå”¯ä¸€åŠ è½½äº†libmobisec.soæ–‡ä»¶äº† é‚£ä¹ˆè¿™é‡Œç°åœ¨çš„å”¯ä¸€å…¥å£å°±æ˜¯è¿™ä¸ªlibmobisec.soæ–‡ä»¶äº†ï¼Œå› ä¸ºä¸Šå±‚çš„ä»£ç æ²¡æœ‰ï¼Œæ²¡æ³•åˆ†æï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹soæ–‡ä»¶ï¼š æ“¦ï¼Œå‘ç°è›‹ç–¼çš„æ˜¯ï¼Œè¿™é‡Œæ²¡æœ‰ç‰¹æ®Šçš„æ–¹æ³•ï¼Œæ¯”å¦‚Java_å¼€å¤´çš„ä»€ä¹ˆï¼Œæ‰€ä»¥çŒœæµ‹è¿™é‡Œåº”è¯¥æ˜¯è‡ªå·±æ³¨å†Œäº†nativeæ–¹æ³•ï¼Œæ··æ·†äº†nativeæ–¹æ³•åç§°ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šå‘ç°æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜ç”¨ç°é˜¶æ®µçš„æŠ€æœ¯æ˜¯æ²¡æ³•è§£å†³äº†ã€‚ ä¸‰ã€è·å–æ­£ç¡®çš„dexå†…å®¹åˆ†æå®Œä¸Šé¢çš„ç ´è§£æµç¨‹ä¹‹åï¼Œå‘ç°ç°åœ¨é¦–è¦çš„ä»»åŠ¡æ˜¯å…ˆå¾—åˆ°æºapkç¨‹åºï¼Œé€šè¿‡åˆ†æçŸ¥é“ï¼Œå¤„ç†çš„æºapkç¨‹åºå¾ˆéš¾æ‰¾åˆ°å’Œåˆ†æï¼Œæ‰€ä»¥è¿™é‡Œå°±è¦å¼•å‡ºä»Šå¤©è¯´çš„å†…å®¹äº†ï¼Œä½¿ç”¨åŠ¨æ€è°ƒè¯•ï¼Œç»™libdvm.soä¸­çš„å‡½æ•°ï¼šdvmDexFileOpenPartial ä¸‹æ–­ç‚¹ï¼Œç„¶åå¾—åˆ°dexæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€å’Œå¤§å°ï¼Œç„¶ådumpå¤„dexæ•°æ®å³å¯ã€‚ é‚£ä¹ˆè¿™é‡Œå°±æœ‰å‡ ä¸ªé—®é¢˜äº†ï¼š ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä½•è¦ç»™dvmDexFileOpenPartial è¿™ä¸ªå‡½æ•°ä¸‹æ–­ç‚¹ï¼Ÿ å› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼Œä¸ç®¡ä¹‹å‰çš„æºç¨‹åºå¦‚ä½•åŠ å›ºï¼Œæ”¾åˆ°å“ªäº†ï¼Œæœ€ç»ˆéƒ½æ˜¯éœ€è¦è¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åè¿è¡Œçš„ï¼Œè€Œä¸”æ˜¯æ²¡æœ‰åŠ å¯†çš„å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦æ‰¾åˆ°è¿™çš„dexçš„å†…å­˜ä½ç½®ï¼ŒæŠŠè¿™éƒ¨åˆ†æ•°æ®æå‡ºæ¥å°±å¯ä»¥äº†ï¼Œç®¡ä»–ä¹‹å‰æ˜¯å¦‚ä½•åŠ å›ºçš„ï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒã€‚é‚£ä¹ˆé—®é¢˜å°±å˜æˆäº†ï¼Œå¦‚ä½•è·å–åŠ è½½åˆ°å†…å­˜ä¸­çš„dexçš„åœ°å€å’Œå¤§å°ï¼Œè¿™ä¸ªå°±è¦ç”¨åˆ°è¿™ä¸ªå‡½æ•°äº†ï¼šdvmDexFileOpenPartial å› ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯æœ€ç»ˆåˆ†ædexæ–‡ä»¶ï¼ŒåŠ è½½åˆ°å†…å­˜ä¸­çš„å‡½æ•°ï¼š int dvmDexFileOpenPartial(const void* addr, int len, DvmDex** ppDvmDex); ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯dexå†…å­˜èµ·å§‹åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯dexå¤§å°ã€‚ ç¬¬äºŒä¸ªé—®é¢˜ï¼šå¦‚ä½•ä½¿ç”¨IDAç»™è¿™ä¸ªå‡½æ•°ä¸‹æ–­ç‚¹ æˆ‘ä»¬åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­è¯´åˆ°äº†ï¼Œåœ¨åŠ¨æ€è°ƒè¯•soï¼Œä¸‹æ–­ç‚¹çš„æ—¶å€™ï¼Œå¿…é¡»çŸ¥é“ä¸€ä¸ªå‡½æ•°åœ¨å†…å­˜ä¸­çš„ç»å¯¹åœ°å€ï¼Œè€Œå‡½æ•°çš„ç»å¯¹åœ°å€æ˜¯ï¼šè¿™ä¸ªå‡½æ•°åœ¨soæ–‡ä»¶ä¸­çš„ç›¸å¯¹åœ°å€+soæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¸­çš„åŸºåœ°å€ï¼Œè¿™é‡Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªå‡½æ•°è‚¯å®šæ˜¯å­˜åœ¨libdvm.soæ–‡ä»¶ä¸­çš„ï¼Œå› ä¸ºä¸€èˆ¬æ¶‰åŠåˆ°dvmæœ‰å…³çš„å‡½æ•°åŠŸèƒ½éƒ½æ˜¯å­˜åœ¨è¿™ä¸ªsoæ–‡ä»¶ä¸­çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªsoæ–‡ä»¶ä¸­æ‰¾åˆ°è¿™ä¸ªå‡½æ•°çš„ç›¸å¯¹åœ°å€ï¼Œè¿è¡Œç¨‹åºä¹‹åï¼Œåœ¨æ‰¾åˆ°libdvm.soçš„åŸºåœ°å€ï¼Œç›¸åŠ å³å¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è·å–åˆ°è¿™ä¸ªlibdvm.soæ–‡ä»¶å‘¢ï¼Ÿè¿™ä¸ªæ–‡ä»¶æ˜¯å­˜æ”¾åœ¨è®¾å¤‡çš„/system/libç›®å½•ä¸‹çš„ï¼š é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨adb pull æŠŠè¿™ä¸ªsoæ–‡ä»¶æå‡ºæ¥å°±å¯ä»¥äº†ã€‚ å¥½äº†ï¼Œè§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œä¸‹é¢å°±å¼€å§‹æ“ä½œäº†ï¼š ç¬¬ä¸€æ­¥ï¼šè¿è¡Œè®¾å¤‡ä¸­çš„android_serverå‘½ä»¤ï¼Œä½¿ç”¨adb forwardè¿›è¡Œç«¯å£è½¬å‘ è¿™é‡Œçš„android_serverå·¥å…·å¯ä»¥å»idaå®‰è£…ç›®å½•ä¸­dbgsrvæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ° ç¬¬äºŒæ­¥ï¼šä½¿ç”¨å‘½ä»¤ä»¥debugæ¨¡å¼å¯åŠ¨apk adb shell am start -D -n com.ali.tg.testapp/.MainActivity å› ä¸ºæˆ‘ä»¬éœ€è¦ç»™libdvm.soä¸‹æ–­ç‚¹ï¼Œè¿™ä¸ªåº“æ˜¯ç³»ç»Ÿåº“ï¼Œæ‰€ä»¥åŠ è½½æ—¶é—´å¾ˆæ—©ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åƒä¹‹å‰ç»™JNI_OnLoadå‡½æ•°ä¸‹æ–­ç‚¹ä¸€æ ·ï¼Œé‡‡ç”¨debuggeræ¨¡å¼è¿è¡Œç¨‹åºï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„AndroidManifest.xmlä¸­ï¼Œå¾—åˆ°åº”ç”¨çš„åŒ…åå’Œå…¥å£Activityï¼š è€Œä¸”è¿™é‡Œçš„android:debuggable=trueï¼Œå¯ä»¥è¿›è¡Œdebugè°ƒè¯•çš„ã€‚ ç¬¬ä¸‰æ­¥ï¼šåŒå¼€IDAï¼Œä¸€ä¸ªç”¨äºé™æ€åˆ†ælibdvm.soï¼Œä¸€ä¸ªç”¨äºåŠ¨æ€è°ƒè¯•libdvm.so é€šè¿‡IDAçš„Debuggerèœå•ï¼Œè¿›è¡Œè¿›ç¨‹é™„åŠ æ“ä½œï¼š ç¬¬å››æ­¥ï¼šä½¿ç”¨jdbå‘½ä»¤å¯åŠ¨è¿æ¥attachè°ƒè¯•å™¨ 1jdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=8700 ä½†æ˜¯è¿™é‡Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯ï¼š è¿™ä¸ªæ˜¯å› ä¸ºï¼Œæˆ‘ä»¬çš„8700ç«¯å£æ²¡æœ‰æŒ‡å®šï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡Eclipseçš„DDMSè¿›è¡Œç«¯å£çš„æŸ¥çœ‹ï¼š çœ‹åˆ°äº†ï¼Œè¿™é‡Œæ˜¯8600ç«¯å£ï¼Œä½†æ˜¯åŸºæœ¬ç«¯å£8700ä¸åœ¨ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼Œä¸€ç§æ˜¯æŠŠä¸Šé¢çš„å‘½ä»¤çš„ç«¯å£æ”¹æˆ8600ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯é€‰ä¸­è¿™ä¸ªåº”ç”¨ï¼Œä½¿å…¶å…·æœ‰8700ç«¯å£ï¼š ç‚¹å‡»è¿™ä¸ªæ¡ç›®å³å¯ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åœ¨è¿è¡Œä¸Šé¢çš„jdbå‘½ä»¤ï¼š å¤„äºç­‰å¾…çŠ¶æ€ã€‚ ç¬¬å››æ­¥ï¼šç»™dvmDexFileOpenPartialå‡½æ•°ä¸‹æ–­ç‚¹ ä½¿ç”¨ä¸€ä¸ªIDAé™æ€åˆ†æå¾—åˆ°è¿™ä¸ªå‡½æ•°çš„ç›¸å¯¹åœ°å€ï¼š43308 åœ¨åŠ¨æ€è°ƒè¯•çš„IDAè§£å¯†ï¼Œä½¿ç”¨Ctrl+Sé”®æ‰¾åˆ°libdvm.soçš„åœ¨å†…å­˜ä¸­çš„åŸºåœ°å€ï¼š41579000 ç„¶åå°†ä¸¤è€…ç›¸åŠ å¾—åˆ°ç»å¯¹åœ°å€ï¼š43308+41579000=415BC308ï¼Œä½¿ç”¨Gé”®ï¼Œè·³è½¬ï¼š è·³è½¬åˆ°dvmDexFileOpenPartialå‡½æ•°å¤„ï¼Œä¸‹æ–­ç‚¹ï¼š ç¬¬äº”æ­¥ï¼šç‚¹å‡»è¿è¡ŒæŒ‰é’®æˆ–è€…F9è¿è¡Œç¨‹åº ä¹‹å‰çš„jdbå‘½ä»¤å°±è¿æ¥ä¸Šäº†ï¼š IDAå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œä¸è¦ç†ä¼šï¼Œä¸€è·¯ç‚¹å‡»å–æ¶ˆæŒ‰é’®å³å¯ è¿è¡Œåˆ°äº†dvmDexFileOpenPartialå‡½æ•°å¤„ï¼š ä½¿ç”¨F8è¿›è¡Œå•æ­¥è°ƒè¯•ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªè¦è¿è¡Œè¿‡äº†PUSHå‘½ä»¤å°±å¯ä»¥äº†ï¼Œè®°å¾—ä¸è¦è¶Šè¿‡ä¸‹é¢çš„BLå‘½ä»¤ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡å¿…è¦èµ°åˆ°é‚£é‡Œï¼Œå½“æ‰§è¡Œäº†PUSHå‘½ä»¤ä¹‹åï¼Œæˆ‘ä»¬å°±æ˜¯ä½¿ç”¨è„šæœ¬æ¥dumpå¤„å†…å­˜ä¸­çš„dexæ•°æ®äº†ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯R0~R4å¯„å­˜å™¨ä¸€èˆ¬æ˜¯ç”¨æ¥å­˜æ”¾ä¸€ä¸ªå‡½æ•°çš„å‚æ•°å€¼çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“dvmDexFileOpenPartialå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯dexå†…å­˜èµ·å§‹åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯dexå¤§å°ï¼š é‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥ä½¿ç”¨è¿™æ ·çš„è„šæœ¬è¿›è¡Œdumpå³å¯ï¼š static main(void){ auto fp, dex_addr, end_addr; fp = fopen(â€œF:\dump.dexâ€, â€œwbâ€); end_addr = r0 + r1; for ( dex_addr = r0; dex_addr &lt; end_addr; dex_addr ++ ) fputc(Byte(dex_addr), fp);} è„šæœ¬ä¸è§£é‡Šäº†ï¼Œéå¸¸ç®€å•ï¼Œè€Œä¸”è¿™ä¸ªæ˜¯å›ºå®šçš„æ ¼å¼ï¼Œä»¥ådumpå†…å­˜ä¸­çš„dexéƒ½æ˜¯è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å°†dumpå‡ºæ¥çš„dexä¿å­˜åˆ°Fç›˜ä¸­ã€‚ ç„¶åè¿™æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨ï¼šShirt+F2 è°ƒå‡ºIDAçš„è„šæœ¬è¿è¡Œç•Œé¢ï¼š ç‚¹å‡»è¿è¡Œï¼Œè¿™é‡Œå¯èƒ½éœ€è¦ç­‰ä¸€ä¼šï¼Œè¿è¡ŒæˆåŠŸä¹‹åï¼Œæˆ‘ä»¬å»Fç›˜å¾—åˆ°dump.dexæ–‡ä»¶ï¼Œå…¶å®è¿™é‡Œæˆ‘ä»¬çš„IDAä½¿å‘½å°±å®Œæˆäº†ï¼Œå› ä¸ºæˆ‘ä»¬å¾—åˆ°äº†å†…å­˜çš„dexæ–‡ä»¶äº†ï¼Œä¸‹é¢å¼€å§‹å°±ç®€å•äº†ï¼Œåªè¦åˆ†ædexæ–‡ä»¶å³å¯ å››ã€åˆ†ææ­£ç¡®çš„dexæ–‡ä»¶å†…å®¹æˆ‘ä»¬æ‹¿åˆ°dump.dexä¹‹åï¼Œä½¿ç”¨dex2jarå·¥å…·è¿›è¡Œåç¼–è¯‘ï¼š å¯æƒœçš„æ˜¯ï¼ŒæŠ¥é”™äº†ï¼Œåç¼–è¯‘å¤±è´¥ï¼Œä¸»è¦æ˜¯æœ‰ä¸€ä¸ªç±»å¯¼è‡´çš„ï¼Œå¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯dumpå‡ºæ¥çš„dexæ–‡ä»¶æœ‰é—®é¢˜ï¼Œæœ€åæˆ‘ç”¨baksmaliå·¥å…·å¾—åˆ°smaliæ–‡ä»¶æ˜¯å¯ä»¥çš„ï¼Œæ‰€ä»¥ä¸æ˜¯dumpå‡ºæ¥çš„é—®é¢˜ï¼Œæˆ‘æœ€åç”¨baksmaliå·¥å…·å°†dexè½¬åŒ–æˆsmaliæºç ï¼š j 1ava -jar baksmali-2.0.3.jar -o C:\classout/ dump.dex å¾—åˆ°çš„smaliæºç ç›®å½•classoutåœ¨Cç›˜ä¸­ï¼š æˆ‘ä»¬å¾—åˆ°äº†æŒ‡å®šçš„smaliæºç äº†ã€‚ é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨é™æ€æ–¹å¼åˆ†æsmaliå³å¯äº†ï¼š é¦–å…ˆæ‰¾åˆ°å…¥å£çš„MainActivityæºç ï¼š è¿™é‡Œä¸è§£é‡Šäº†ï¼Œè‚¯å®šæ˜¯æ‰¾æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ä»£ç å¤„ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªbtn_listenerå˜é‡ï¼Œçœ‹è¿™ä¸ªå˜é‡çš„å®šä¹‰ï¼š æ˜¯MainActivity$1å†…éƒ¨ç±»å®šä¹‰ï¼ŒæŸ¥çœ‹è¿™ä¸ªç±»çš„smaliæºç ï¼Œç›´æ¥æŸ¥çœ‹ä»–çš„onClickæ–¹æ³•ï¼š è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒæŠŠEditTextä¸­çš„å†…å®¹ï¼Œç”¨Intentä¼ é€’ç»™WebViewActivityä¸­ï¼Œä½†æ˜¯è¿™é‡Œçš„intentæ•°æ®çš„keyæ˜¯åŠ å¯†çš„ã€‚ ä¸‹é¢ç»§ç»­çœ‹WebViewActivityè¿™ä¸ªç±»ï¼š æˆ‘ä»¬ç›´æ¥æŸ¥æ‰¾onCreateæ–¹æ³•å³å¯ï¼Œçœ‹åˆ°è¿™é‡Œæ˜¯åˆå§‹åŒ–WebViewï¼Œç„¶åè¿›è¡Œä¸€äº›è®¾ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ª@JavascriptInterface è¿™ä¸ªæ³¨è§£ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨WebViewçš„æ—¶å€™éƒ½çŸ¥é“ï¼Œä»–æ˜¯ç”¨äºJsä¸­èƒ½å¤Ÿè®¿é—®çš„è®¾ç½®äº†è¿™ä¸ªæ³¨è§£çš„æ–¹æ³•ï¼Œæ²¡æœ‰è¿™ä¸ªæ³¨è§£çš„æ–¹æ³•Jsæ˜¯è®¿é—®ä¸äº†çš„ æ³¨æ„ï¼š æˆ‘ä»¬çŸ¥é“è¿™ä¸ªæ³¨è§£æ˜¯åœ¨SDK17åŠ ä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯Android4.2ç‰ˆæœ¬ä¸­ï¼Œé‚£ä¹ˆåœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­æ²¡æœ‰è¿™ä¸ªæ³¨è§£ï¼Œä»»ä½•publicçš„æ–¹æ³•éƒ½å¯ä»¥åœ¨JSä»£ç ä¸­è®¿é—®ï¼Œè€ŒJavaå¯¹è±¡ç»§æ‰¿å…³ç³»ä¼šå¯¼è‡´å¾ˆå¤špublicçš„æ–¹æ³•éƒ½å¯ä»¥åœ¨JSä¸­è®¿é—®ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„æ–¹æ³•å°±æ˜¯ getClass()ã€‚ç„¶åJSå¯ä»¥é€šè¿‡åå°„æ¥è®¿é—®å…¶ä»–ä¸€äº›å†…å®¹ã€‚é‚£ä¹ˆè¿™é‡Œå°±æœ‰è¿™ä¸ªé—®é¢˜äº†ï¼šæ¯”å¦‚ä¸‹é¢çš„ä¸€æ®µJSä»£ç ï¼š function findobj(){ for (var obj in window) { if ("getClass" in window[obj]) { return window[obj] } } } çœ‹åˆ°äº†ï¼Œè¿™æ®µjsä»£ç å¾ˆå±é™©çš„ï¼Œä½¿ç”¨getClassæ–¹æ³•ï¼Œå¾—åˆ°è¿™ä¸ªå¯¹è±¡(javaä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è¿™ä¸ªæ–¹æ³•çš„)ï¼Œç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥å¾—åˆ°ä¸€ä¸ªjavaå¯¹è±¡ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨è¿™ä¸ªå¯¹è±¡ä¸­çš„æ–¹æ³•äº†ã€‚è¿™ä¸ªä¹Ÿç®—æ˜¯WebViewçš„ä¸€ä¸ªæ¼æ´äº†ã€‚ æ‰€ä»¥é€šè¿‡å¼•å…¥ @JavascriptInterfaceæ³¨è§£ï¼Œåˆ™åœ¨JSä¸­åªèƒ½è®¿é—® @JavascriptInterfaceæ³¨è§£çš„å‡½æ•°ã€‚è¿™æ ·å°±å¯ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚ å›å½’åˆ°æ­£é¢˜ï¼Œæˆ‘ä»¬ä¸Šé¢åˆ†æäº†smaliæºç ï¼Œçœ‹åˆ°äº†WebViewçš„ä¸€äº›è®¾ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å¾€ä¸‹é¢çœ‹ï¼š è¿™é‡Œçš„æˆ‘ä»¬çœ‹åˆ°äº†ä¸€äº›é‡è¦çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯addJavascriptInterfaceï¼Œä¸€ä¸ªæ˜¯loadUrlæ–¹æ³•ã€‚ æˆ‘ä»¬çŸ¥é“addjavaascriptInterfaceæ–¹æ³•ä¸€èˆ¬çš„ç”¨æ³•ï¼š mWebView.addJavascriptInterface(new JavaScriptObject(this), â€œjiangweiâ€); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æœ¬åœ°çš„Javaå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»™Jsä¸­ä½¿ç”¨çš„å¯¹è±¡çš„åç§°ã€‚ç„¶åjså¾—åˆ°è¿™ä¸ªå¯¹è±¡çš„åç§°å°±å¯ä»¥è°ƒç”¨æœ¬åœ°çš„Javaå¯¹è±¡ä¸­çš„æ–¹æ³•äº†ã€‚ çœ‹äº†è¿™é‡Œçš„addjavaascriptInterfaceæ–¹æ³•ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œç”¨ ListViewAutoScrollHelpern;-&gt;decrypt_native(Ljava/lang/String;I)Ljava/lang/String; å°†jsä¸­çš„åç§°è¿›è¡Œæ··æ·†åŠ å¯†äº†ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢æ¶æ„çš„ç½‘ç«™æ¥æ‹¦æˆªurlï¼Œç„¶åè°ƒç”¨æˆ‘ä»¬æœ¬åœ°çš„Javaä¸­çš„æ–¹æ³•ã€‚ æ³¨æ„ï¼š è¿™é‡Œåˆå­˜åœ¨ä¸€ä¸ªå…³äºWebViewçš„å®‰å…¨é—®é¢˜ï¼Œå°±æ˜¯è¿™é‡Œçš„jsè®¿é—®çš„å¯¹è±¡çš„åç§°é—®é¢˜ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘çš„ç¨‹åºä¸­æœ‰ä¸€ä¸ªJsäº¤äº’çš„ç±»ï¼Œç±»ä¸­æœ‰ä¸€ä¸ªè·å–è®¾å¤‡é‡è¦ä¿¡æ¯çš„æ–¹æ³•ï¼Œæ¯”å¦‚è¿™é‡Œè·å–è®¾å¤‡çš„imeiæ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬çš„ç¨‹åºæ²¡æœ‰åšè¿™æ ·åç§°çš„æ··æ·†çš„è¯ï¼Œç ´è§£è€…å¾—åˆ°è¿™ä¸ªjsåç§°å’Œæ–¹æ³•åï¼Œç„¶åå°±ä¼ªé€ ä¸€ä¸ªæ¶æ„urlï¼Œæ¥è°ƒç”¨æˆ‘ä»¬ç¨‹åºä¸­çš„è¿™ä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š ç„¶ååœ¨è®¾ç½®jsåç§°ï¼š æˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªæ¶æ„çš„urlé¡µé¢æ¥è®¿é—®è¿™ä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚è¿™ä¸ªæ¶æ„çš„é¡µé¢ä»£ç å¦‚ä¸‹ï¼š è¿è¡Œç¨‹åºï¼š çœ‹åˆ°äº†ï¼Œè¿™é‡Œæ¶æ„çš„é¡µé¢å°±æˆåŠŸçš„è°ƒç”¨äº†ç¨‹åºä¸­çš„ä¸€ä¸ªé‡è¦æ–¹æ³•ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹Jsäº¤äº’ä¸­çš„å¯¹è±¡åç§°åšæ··æ·†æ˜¯å¿…è¦çš„ï¼Œç‰¹åˆ«æ˜¯æœ¬åœ°ä¸€äº›é‡è¦çš„æ–¹æ³•ã€‚ å›å½’åˆ°æ­£é¢˜ï¼Œæˆ‘ä»¬åˆ†æå®Œäº†WebViewçš„ä¸€äº›åˆå§‹åŒ–å’Œè®¾ç½®ä»£ç ï¼Œè€Œä¸”æˆ‘ä»¬çŸ¥é“å¦‚æœè¦è¢«Jsè®¿é—®çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¿…é¡»è¦æœ‰@JavascriptInterfaceæ³¨è§£ å› ä¸ºåœ¨Javaä¸­æ³¨è§£ä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å»æ³¨è§£ç±»çš„æºç çœ‹çœ‹é‚£ä¸ªè¢«Jsè°ƒç”¨çš„æ–¹æ³•ï¼š è¿™é‡Œçœ‹åˆ°äº†æœ‰ä¸€ä¸ªshowToastæ–¹æ³•ï¼Œå±•ç¤ºçš„å†…å®¹ï¼š\u7965\u9f99\uff01 ï¼Œæˆ‘ä»¬åœ¨çº¿è½¬åŒ–ä¸€ä¸‹ï¼š æ“¦ï¼Œè¿™é‡Œå°±æ˜¯é¢˜ç›®è¦æ±‚å±•ç¤ºçš„å†…å®¹ã€‚ å¥½äº†ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å°±åˆ†æå®Œäº†apkçš„é€»è¾‘äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æ•´ç†ä¸€ä¸‹ï¼š 1ã€åœ¨MainActivityä¸­è¾“å…¥ä¸€ä¸ªé¡µé¢çš„urlï¼Œè·³è½¬åˆ°WebViewActivityè¿›è¡Œå±•ç¤º 2ã€WebViewActivityæœ‰Jsäº¤äº’ï¼Œéœ€è¦è°ƒç”¨æœ¬åœ°Javaå¯¹è±¡ä¸­çš„showToastæ–¹æ³•å±•ç¤ºæ¶ˆæ¯ é—®é¢˜ï¼š å› ä¸ºè¿™é‡Œçš„jså¯¹è±¡åç§°è¿›è¡Œäº†åŠ å¯†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è‡ªå·±ç¼–å†™ä¸€ä¸ªç½‘é¡µï¼Œä½†æ˜¯ä¸çŸ¥é“è¿™ä¸ªjså¯¹è±¡åç§°ï¼Œæ— æ³•å®ŒæˆshowToastæ–¹æ³•çš„è°ƒç”¨ äº”ã€ç ´è§£çš„æ–¹æ³•ä¸‹é¢æˆ‘ä»¬å°±æ¥åˆ†æä¸€ä¸‹å¦‚ä½•è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œå…¶å®è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç°æœ‰çš„æ–¹æ³•å¤ªå¤šäº† ç¬¬ä¸€ç§æ–¹æ³•ï¼šä¿®æ”¹smaliæºç ï¼ŒæŠŠä¸Šé¢çš„é‚£ä¸ªjså¯¹è±¡åç§°æ”¹æˆæˆ‘ä»¬è‡ªå·±æƒ³è¦çš„ï¼Œæ¯”å¦‚ï¼šjiangweiï¼Œç„¶ååœ¨è‡ªå·±ç¼–å†™çš„é¡µé¢ä¸­ç›´æ¥è°ƒç”¨ï¼šjiangwei.showToastæ–¹æ³•å³å¯ï¼Œä¸è¿‡è¿™é‡Œéœ€è¦ä¿®æ”¹smaliæºç ï¼Œåœ¨ä½¿ç”¨smaliå·¥å…·å›ç¼–è¯‘æˆdexæ–‡ä»¶ï¼Œåœ¨å¼„åˆ°apkä¸­ï¼Œåœ¨è¿è¡Œã€‚æ–¹æ³•æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æ„Ÿè§‰å¤ªå¤æ‚ï¼Œè¿™é‡Œä¸é‡‡ç”¨ ç¬¬äºŒç§æ–¹æ³•ï¼šåˆ©ç”¨Android4.2ä¸­çš„WebViewçš„æ¼æ´ï¼Œç›´æ¥ä½¿ç”¨å¦‚ä¸‹Jsä»£ç å³å¯ è¿™é‡Œæ ¹æœ¬ä¸éœ€è¦ä»»ä½•jså¯¹è±¡çš„åç§°ï¼Œåªéœ€è¦æ–¹æ³•åå°±å¯ä»¥å®Œæˆè°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ¼æ´è¿˜æ˜¯å¾ˆå±é™©çš„ã€‚ ç¬¬ä¸‰ç§æ–¹æ³•ï¼šæˆ‘ä»¬çœ‹åˆ°äº†é‚£ä¸ªåŠ å¯†æ–¹æ³•ï¼Œæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªç¨‹åºï¼Œæ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå°½ç„¶å¾—åˆ°æ­£ç¡®çš„jså¯¹è±¡åç§°ï¼Œè¿™é‡Œæˆ‘ä»¬å°±é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œå› ä¸ºè¿™ä¸ªæ–¹å¼æœ‰ä¸€ä¸ªæ–°çš„æŠ€èƒ½ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å°±è®²è§£ä¸€ä¸‹äº†ã€‚ é‚£ä¹ˆå¦‚æœç”¨ç¬¬ä¸‰ç§æ–¹æ³•çš„è¯ï¼Œå°±éœ€è¦å†å»åˆ†æé‚£ä¸ªåŠ å¯†æ–¹æ³•é€»è¾‘äº†ï¼š android.support.v4.widget.ListViewAutoScrollHelpernåœ¨è¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬å†å»æŸ¥æ‰¾è¿™ä¸ªsmaliæºç ï¼š è¿™ä¸ªç±»åŠ è½½äº†libtranslate.soåº“ï¼Œè€Œä¸”åŠ å¯†æ–¹æ³•æ˜¯nativeå±‚çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨IDAæŸ¥çœ‹libtranslate.soåº“ï¼š æˆ‘ä»¬æœä¸€ä¸‹Javaå¼€å¤´çš„å‡½æ•°ï¼Œå‘ç°å¹¶æ²¡æœ‰å’Œdecrypt_nativeæ–¹æ³•å¯¹åº”çš„nativeå‡½æ•°ï¼Œè¯´æ˜è¿™é‡Œåšäº†nativeæ–¹æ³•çš„æ³¨å†Œæ··æ·†ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹JNI_OnLoadå‡½æ•°ï¼š è¿™é‡Œæœç„¶æ˜¯è‡ªå·±æ³¨å†Œäº†nativeå‡½æ•°ï¼Œä½†æ˜¯åˆ†æåˆ°è¿™é‡Œï¼Œæˆ‘å°±ä¸å¾€ä¸‹åˆ†æäº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬å…¶å®æ²¡å¿…è¦ææ¸…æ¥šnativeå±‚çš„å‡½æ•°åŠŸèƒ½ï¼Œæˆ‘ä»¬çŸ¥é“äº†Javaå±‚çš„nativeæ–¹æ³•å®šä¹‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªè¿™ä¹ˆä¸ªnativeæ–¹æ³•æ¥è°ƒç”¨libtranslate.soä¸­çš„åŠ å¯†å‡½æ•°åŠŸèƒ½ï¼š æˆ‘ä»¬æ–°å»ºä¸€ä¸ªDemoå·¥ç¨‹ï¼Œä»¿é€ ä¸€ä¸ªListViewAutoScrollHelpernç±»ï¼Œå†…éƒ¨åœ¨å®šä¹‰ä¸€ä¸ªnativeæ–¹æ³•ï¼š ç„¶åæˆ‘ä»¬åœ¨MainActivityä¸­åŠ è½½libtranslate.soï¼š ç„¶åè°ƒç”¨é‚£ä¸ªnativeæ–¹æ³•ï¼Œæ‰“å°ç»“æœï¼š è¿™é‡Œçš„æ–¹æ³•çš„å‚æ•°å¯ä»¥æŸ¥çœ‹smaliæºç ä¸­çš„é‚£ä¸ªæ–¹æ³•å‚æ•°ï¼š ç‚¹å‡»è¿è¡Œï¼Œå‘ç°æœ‰å´©æºƒçš„ï¼Œæˆ‘ä»¬æŸ¥çœ‹logä¿¡æ¯ï¼š æ˜¯libtranslate.soä¸­æœ‰ä¸€ä¸ªPagerTitleStripIcsnç±»æ‰¾ä¸åˆ°ï¼Œè¿™ä¸ªç±»åº”è¯¥ä¹Ÿæœ‰ä¸€ä¸ªnativeæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨æ„é€ è¿™ä¸ªç±»ï¼š å†æ¬¡è¿è¡Œï¼Œè¿˜æ˜¯æŠ¥é”™ï¼ŒåŸå› å·®ä¸å¤šï¼Œè¿˜éœ€è¦åœ¨æ„é€ ä¸€ä¸ªç±»ï¼šTaskStackBuilderJellybeann å¥½äº†ï¼Œå†æ¬¡ç‚¹å‡»è¿è¡Œï¼š OKäº†ï¼ŒæˆåŠŸäº†ï¼Œä»è¿™ä¸ªlogä¿¡æ¯å¯ä»¥çœ‹å‡ºæ¥äº†ï¼Œè§£å¯†ä¹‹åçš„jså¯¹è±¡åç§°æ˜¯ï¼šSmokeyBearï¼Œé‚£ä¹ˆä¸‹é¢å°±ç®€å•äº†ï¼Œæˆ‘ä»¬åœ¨æ„é€ ä¸€ä¸ªurlé¡µé¢ï¼Œç›´æ¥è°ƒç”¨ï¼šSmokeyBear.showToastå³å¯ã€‚ æ³¨æ„ï¼š è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œå¦‚æœçŸ¥é“äº†Javaå±‚çš„nativeæ–¹æ³•çš„å®šä¹‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨è¿™ä¸ªnativeæ–¹æ³•æ¥è·å–nativeå±‚çš„å‡½æ•°åŠŸèƒ½äº†ï¼Œè¿™ä¸ªè¿˜æ˜¯å¾ˆä¸å®‰å…¨çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•é˜²æ­¢è‡ªå·±çš„soè¢«åˆ«äººè°ƒç”¨å‘¢ï¼Ÿå¯ä»¥åœ¨soä¸­çš„nativeå‡½æ•°åšä¸€ä¸ªåº”ç”¨çš„ç­¾åæ ¡éªŒï¼Œåªæœ‰å±äºè‡ªå·±çš„ç­¾ååº”ç”¨æ‰èƒ½è°ƒç”¨ï¼Œå¦åˆ™ç›´æ¥é€€å‡ºã€‚ å…­ï¼Œå¼€å§‹æµ‹è¯•ä¸Šé¢å·²ç»çŸ¥é“äº†jsçš„å¯¹è±¡åç§°ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥æ„é€ è¿™ä¸ªé¡µé¢äº†ï¼š é‚£ä¹ˆè¿™é‡Œåˆæœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œè¿™ä¸ªé¡µé¢æ„é€ å¥½äº†ï¼Ÿæ”¾å“ªå‘¢ï¼Ÿæœ‰çš„åŒå­¦è¯´æˆ‘æœ‰æœåŠ¡å™¨ï¼Œæ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼Œç„¶åè¾“å…¥urlåœ°å€å°±å¯ä»¥äº†ï¼Œçš„ç¡®è¿™ä¸ªæ–¹æ³•æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æœ‰çš„åŒå­¦æ²¡æœ‰æœåŠ¡å™¨æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ä¸ªä¹Ÿæ˜¯æœ‰æ–¹æ³•çš„ï¼Œæˆ‘ä»¬çŸ¥é“WebViewçš„loadUrlæ–¹æ³•æ˜¯å¯ä»¥åŠ è½½æœ¬åœ°çš„é¡µé¢çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªé¡µé¢ä¿å­˜åˆ°æœ¬åœ°ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¸èƒ½å­˜åˆ°SDå¡ä¸­ï¼Œå› ä¸ºè¿™ä¸ªåº”ç”¨æ²¡æœ‰è¯»å–SDçš„æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä»–çš„AndroidManifest.xmlæ–‡ä»¶ï¼š æˆ‘ä»¬åœ¨ä¸é‡æ–°æ‰“åŒ…çš„æƒ…å†µä¸‹ï¼Œæ˜¯æ²¡åŠæ³•åšåˆ°çš„ï¼Œé‚£ä¹ˆæ”¾å“ªå‘¢ï¼Ÿå…¶å®å¾ˆç®€å•äº†ï¼Œæ”¾åœ¨è¿™ä¸ªåº”ç”¨çš„/data/data/com.ali.tg.testapp/ç›®å½•ä¸‹å³å¯ï¼Œå› ä¸ºé™¤äº†SDå¡ä½ç½®ï¼Œè¿™ä¸ªä½ç½®æ˜¯æœ€å¥½çš„äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“WebViewçš„loadUrlæ–¹æ³•åœ¨åŠ è½½æœ¬åœ°çš„é¡µé¢çš„æ ¼å¼æ˜¯ï¼š file:///data/data/com.ali.tg.testapp/crack.html é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥è¾“å…¥å³å¯ æ³¨æ„ï¼š è¿™é‡Œåœ¨è¯´ä¸€ä¸ªå°æŠ€å·§ï¼šå°±æ˜¯æˆ‘ä»¬åœ¨ä¸€ä¸ªæ–‡æœ¬æ¡†ä¸­è¾“å…¥è¿™ä¹ˆå¤šå†…å®¹ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹è›‹ç–¼ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥å€ŸåŠ©äºå‘½ä»¤æ¥å®ç°è¾“å…¥çš„ï¼Œå°±æ˜¯ä½¿ç”¨ï¼šadb shell input text â€æˆ‘ä»¬éœ€è¦è¾“å…¥çš„å†…å®¹â€œã€‚ å…·ä½“ç”¨æ³•å¾ˆç®€å•ï¼Œæ‰“å¼€æˆ‘ä»¬éœ€è¦è¾“å…¥å†…å®¹çš„EditTextï¼Œç‚¹å‡»è°ƒå‡ºç³»ç»Ÿçš„è¾“å…¥æ³•ç•Œé¢ï¼Œç„¶åæ‰§è¡Œä¸Šé¢çš„å‘½ä»¤å³å¯ï¼š ä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯ä»–ä¸è¯†åˆ«åˆ†å·ï¼š ä¸è¿‡æˆ‘ä»¬ç›´æ¥ä¿®æ”¹æˆåˆ†å·ç‚¹å‡»è¿›å…¥ï¼š è¿è¡ŒæˆåŠŸï¼Œçœ‹åˆ°äº†toastçš„å±•ç¤ºã€‚ ä¸ƒã€å†…å®¹æ•´ç†åˆ°è¿™é‡Œæˆ‘ä»¬å°±ç ´è§£æˆåŠŸäº†ï¼Œä¸‹é¢æ¥çœ‹çœ‹æ•´ç†ä¸€ä¸‹æˆ‘ä»¬çš„ç ´è§£æ­¥éª¤ï¼š 1ã€ç ´è§£çš„å¸¸è§„å¥—è·¯ æˆ‘ä»¬æŒ‰ç…§ç ´è§£æƒ¯ä¾‹ï¼Œé¦–å…ˆè§£å‹å‡ºclassses.dexæ–‡ä»¶ï¼Œä½¿ç”¨dex2jarå·¥å…·æŸ¥çœ‹javaä»£ç ï¼Œä½†æ˜¯å‘ç°åªæœ‰ä¸€ä¸ªApplicationç±»ï¼Œæ‰€ä»¥çŒœæµ‹apkè¢«åŠ å£³äº†ï¼Œç„¶åç”¨apktoolæ¥åç¼–è¯‘apkï¼Œå¾—åˆ°ä»–çš„èµ„æºæ–‡ä»¶å’ŒAndroidManifest.xmlå†…å®¹ï¼Œæ‰¾åˆ°äº†åŒ…åå’Œå…¥å£çš„Activityç±»ã€‚ 2ã€åŠ å›ºapkçš„æºç¨‹åºä¸€èˆ¬å­˜æ”¾çš„ä½ç½® çŸ¥é“æ˜¯åŠ å›ºapkäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åˆ†æï¼Œè¿™ä¸ªåŠ å›ºçš„apkè‚¯å®šæ˜¯å­˜æ”¾åœ¨æœ¬åœ°çš„ä¸€ä¸ªåœ°æ–¹ï¼Œä¸€èˆ¬æ˜¯ä¸‰ä¸ªåœ°æ–¹ï¼š 1ã€‹åº”ç”¨çš„assetç›®å½•ä¸­ 2ã€‹åº”ç”¨çš„libsä¸­çš„soæ–‡ä»¶ä¸­ 3ã€‹åº”ç”¨çš„dexæ–‡ä»¶çš„æœ«å°¾ æˆ‘ä»¬åˆ†æäº†ä¸€ä¸‹ä¹‹åï¼Œå‘ç°assetç›®å½•ä¸­çš„ç¡®æœ‰ä¸¤ä¸ªjaræ–‡ä»¶ï¼Œä½†æ˜¯æ‰“ä¸å¼€ï¼ŒçŒœæµ‹æ˜¯è¢«ç»è¿‡å¤„ç†äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ†æå¤„ç†é€»è¾‘ï¼Œä½†æ˜¯è¿™æ—¶å€™æˆ‘ä»¬ä¹Ÿæ²¡æœ‰ä»£ç ï¼Œæ€ä¹ˆåˆ†æå‘¢ï¼Ÿæ‰€ä»¥è¿™æ—¶å€™å°±éœ€è¦å€ŸåŠ©äºdumpå†…å­˜dexæŠ€æœ¯äº†ï¼š ä¸ç®¡æœ€åçš„æºapkæ”¾åœ¨å“ªé‡Œï¼Œæœ€åéƒ½æ˜¯éœ€è¦ç»å†è§£å¯†åŠ¨æ€åŠ è½½åˆ°å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥åˆ†æåº•å±‚åŠ è½½dexæºç ï¼ŒçŸ¥é“æœ‰ä¸€ä¸ªå‡½æ•°ï¼šdvmDexFileOpenPartial è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªé‡è¦å‚æ•°ï¼Œä¸€ä¸ªæ˜¯dexçš„å…¶å®åœ°å€ï¼Œä¸€ä¸ªæ˜¯dexçš„å¤§å°ï¼Œè€Œä¸”çŸ¥é“è¿™ä¸ªå‡½æ•°æ˜¯åœ¨libdvm.soä¸­çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨IDAè¿›è¡ŒåŠ¨æ€è°ƒè¯•è·å–ä¿¡æ¯ 3ã€åŒå¼€IDAå¼€å§‹è·å–å†…å­˜ä¸­çš„dexå†…å®¹ åŒå¼€IDAï¼Œèµ°ä¹‹å‰çš„åŠ¨æ€ç ´è§£soæ–¹å¼æ¥ç»™dvmDexFileOpenPartialå‡½æ•°ä¸‹æ–­ç‚¹ï¼Œè·å–ä¸¤ä¸ªå‚æ•°çš„å€¼ï¼Œç„¶åä½¿ç”¨ä¸€æ®µè„šæœ¬ï¼Œå°†å†…å­˜ä¸­çš„dexæ•°æ®ä¿å­˜åˆ°æœ¬åœ°ç£ç›˜ä¸­ã€‚ 4ã€åˆ†æè·å–åˆ°çš„dexå†…å®¹ å¾—åˆ°äº†å†…å­˜ä¸­çš„dexä¹‹åï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨dex2jarå·¥å…·å»æŸ¥çœ‹æºç ï¼Œä½†æ˜¯å‘ç°ä¿å­˜ï¼Œä»¥ä¸ºæ˜¯dumpå‡ºæ¥çš„dexæ ¼å¼æœ‰é—®é¢˜ï¼Œä½†æ˜¯æœ€åä½¿ç”¨baksmaliå·¥å…·è¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°smaliæºç æ˜¯å¯ä»¥çš„ï¼Œç„¶åæˆ‘ä»¬å°±å¼€å§‹åˆ†æsmaliæºç ã€‚ 5ã€åˆ†ææºç äº†è§£ç ´è§£æ€è·¯ é€šè¿‡åˆ†ææºç å¾—çŸ¥åœ¨WebViewActivityé¡µé¢ä¸­ä¼šåŠ è½½ä¸€ä¸ªé¡µé¢ï¼Œç„¶åé‚£ä¸ªé¡µé¢ä¸­çš„jsä¼šè°ƒç”¨æœ¬åœ°çš„Javaå¯¹è±¡ä¸­çš„ä¸€ä¸ªæ–¹æ³•æ¥å±•ç¤ºtoastä¿¡æ¯ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬é‡åˆ°äº†ä¸ªé—®é¢˜ï¼šJsçš„Javaå¯¹è±¡åç§°è¢«æ··æ·†åŠ å¯†äº†ï¼Œæ‰€ä»¥è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦å»åˆ†æé‚£ä¸ªåŠ å¯†å‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸ªåŠ å¯†å‡½æ•°æ˜¯nativeçš„ï¼Œç„¶åæˆ‘ä»¬å°±æ˜¯ç”¨IDAå»é™æ€åˆ†æäº†è¿™ä¸ªnativeå‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰åˆ†æå®Œæˆï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦ï¼Œå…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦ç»“æœï¼Œä¸éœ€è¦è¿‡ç¨‹ï¼Œç°åœ¨è§£å¯†çš„å†…å®¹æˆ‘ä»¬çŸ¥é“äº†ï¼Œnativeæ–¹æ³•çš„å®šä¹‰ä¹ŸçŸ¥é“äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å»å†™ä¸€ä¸ªç®€å•çš„demoå»è°ƒç”¨è¿™ä¸ªsoçš„nativeæ–¹æ³•å³å¯ï¼Œç»“æœæˆåŠŸäº†ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ­£ç¡®çš„Jså¯¹è±¡åç§°ã€‚ 6ã€äº†è§£WebViewçš„å®‰å…¨æ€§ WebViewçš„æ—©æœŸç‰ˆæœ¬çš„ä¸€ä¸ªæ¼æ´ä¿¡æ¯ï¼Œåœ¨Android4.2ä¹‹å‰çš„ç‰ˆæœ¬WebViewæœ‰ä¸€ä¸ªæ¼æ´ï¼Œå°±æ˜¯å¯ä»¥æ‰§è¡ŒJavaå¯¹è±¡ä¸­æ‰€æœ‰çš„publicæ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨jsä¸­å°±å¯ä»¥è¿™ä¹ˆå¤„ç†äº†ï¼Œå…ˆè·å–geClassæ–¹æ³•è·å–è¿™ä¸ªå¯¹è±¡ï¼Œç„¶ååœ¨è°ƒç”¨è¿™ä¸ªå¯¹è±¡ä¸­çš„ä¸€äº›ç‰¹å®šæ–¹æ³•å³å¯ï¼Œå› ä¸ºJavaä¸­æ‰€æœ‰çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªgetClassæ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯publicçš„ï¼ŒåŒæ—¶èƒ½å¤Ÿè¿”å›å½“å‰å¯¹è±¡ã€‚æ‰€ä»¥åœ¨Android4.2ä¹‹åæœ‰äº†ä¸€ä¸ªæ³¨è§£ï¼š @JavascriptInterface ï¼Œåªæœ‰è¿™ä¸ªæ³¨è§£æ ‡è¯†çš„æ–¹æ³•æ‰èƒ½è¢«Jsä¸­è°ƒç”¨ã€‚ 7ã€è·å–è¾“å…¥çš„æ–°æŠ€èƒ½ éªŒè¯ç»“æœçš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªæŠ€å·§ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨è¾“å…¥å¾ˆé•¿çš„æ–‡æœ¬çš„æ—¶å€™ï¼Œæ¯”è¾ƒç¹çï¼Œå¯ä»¥å€ŸåŠ©adb shell input textå‘½ä»¤æ¥å®ç°ã€‚ å…«ã€æŠ€æœ¯ç‚¹æ¦‚è¦1ã€é€šè¿‡dumpå‡ºå†…å­˜ä¸­çš„dexæ•°æ®ï¼Œå¯ä»¥ä½›æŒ¡æ€ä½›äº†ï¼Œä¸ç®¡apkå¦‚ä½•åŠ å›ºï¼Œæœ€ç»ˆéƒ½æ˜¯éœ€è¦åŠ è½½åˆ°å†…å­˜ä¸­çš„ã€‚ 2ã€äº†è§£åˆ°äº†WebViewçš„å®‰å…¨æ€§çš„ç›¸å…³çŸ¥è¯†ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨WebViewä¸­jså¯¹è±¡åç§°åšä¸€æ¬¡æ··æ·†è¿˜æ˜¯æœ‰å¿…è¦çš„ï¼Œé˜²æ­¢è¢«æ¶æ„ç½‘ç«™è°ƒç”¨æˆ‘ä»¬çš„æœ¬åœ°éšç§æ–¹æ³•ã€‚ 3ã€å¯ä»¥å°è¯•è°ƒç”¨soä¸­çš„nativeæ–¹æ³•ï¼Œåœ¨çŸ¥é“äº†è¿™ä¸ªæ–¹æ³•çš„å®šä¹‰ä¹‹å 4ã€adb shell input text å‘½ä»¤æ¥è¾…åŠ©æˆ‘ä»¬çš„è¾“å…¥ ä¹ã€æ€»ç»“è¿™é‡Œå°±ä»‹ç»äº†Androidä¸­å¦‚ä½•dumpå‡ºé‚£äº›åŠ å›ºçš„apkç¨‹åºï¼Œå…¶å®æ ¸å¿ƒå°±ä¸€ä¸ªï¼šä¸ç®¡ä¸Šå±‚æ€ä¹ˆåŠ å›ºï¼Œæœ€ç»ˆåŠ è½½åˆ°å†…å­˜çš„dexè‚¯å®šä¸æ˜¯åŠ å›ºçš„ï¼Œæ‰€ä»¥è¿™ä¸ªdexå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿™é‡Œä½¿ç”¨äº†IDAæ¥åŠ¨æ€è°ƒè¯•libdvm.soä¸­çš„dvmDexFileOpenPartialå‡½æ•°æ¥è·å–å†…å­˜ä¸­çš„dexå†…å®¹ï¼ŒåŒæ—¶è¿˜å¯ä»¥ä½¿ç”¨gdb+gdbserveræ¥è·å–ï¼Œè¿™ä¸ªæ„Ÿå…´è¶£çš„åŒå­¦è‡ªè¡Œæœç´¢å§ã€‚ç»“åˆäº†ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ï¼Œå°±ç®—å–„å§‹å–„ç»ˆï¼Œä»‹ç»äº†Androidä¸­å¤§ä½“çš„ç ´è§£æ–¹å¼ï¼Œå½“ç„¶è¿™ä¸‰ç§æ–¹å¼ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå› ä¸ºåŠ å›ºå’Œç ´è§£æ˜¯ç›¸ç”Ÿç›¸å…‹çš„ï¼Œæ²¡æœ‰å“ªä¸ªæœ‰ç»å¯¹çš„ä¼˜åŠ¿ï¼Œåªæ˜¯ä¸¤è€…ç›¸äº’è¿›æ­¥ç½¢äº†ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ç ´è§£æ–¹å¼ï¼Œåé¢å¦‚æœé‡åˆ°çš„è¯ï¼Œä¼šåœ¨è¯¦ç»†è¯´æ˜ã€‚]]></content>
      <categories>
        <category>pythonçˆ¬è™«</category>
        <category>çˆ¬è™«æ‹“å±•åŠŸèƒ½</category>
      </categories>
      <tags>
        <tag>çˆ¬è™«</tag>
        <tag>Androidé€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidé€†å‘-åŠ¨æ€åˆ†æç ´è§£Apk(è°ƒè¯•so)]]></title>
    <url>%2F2019%2F03%2F01%2F02.python%E7%88%AC%E8%99%AB%2F%E7%88%AC%E8%99%AB%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%2FAndroid%E9%80%86%E5%90%91-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E7%A0%B4%E8%A7%A3APk(%E8%B0%83%E8%AF%95so)%2F</url>
    <content type="text"><![CDATA[è½¬è½½: http://www.520monkey.com/ ä¸€ã€çŸ¥è¯†å‡†å¤‡**æˆ‘ä»¬åœ¨ä»‹ç»å¦‚ä½•è°ƒè¯•soæ–‡ä»¶çš„æ—¶å€™ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹å‡†å¤‡çŸ¥è¯†ï¼š 1. nativeæ–¹æ³•çš„å®šä¹‰å’Œè°ƒç”¨ä»€ä¹ˆæ˜¯NDKAndroid å¹³å°ä»ä¸€å¼€å°±å·²ç»æ”¯æŒäº†C/C++äº†ã€‚æˆ‘ä»¬çŸ¥é“Androidçš„SDKä¸»è¦æ˜¯åŸºäºJavaçš„ï¼Œæ‰€ä»¥å¯¼è‡´äº†åœ¨ç”¨Android SDKè¿›è¡Œå¼€å‘çš„å·¥ç¨‹å¸ˆä»¬éƒ½å¿…é¡»ä½¿ç”¨Javaè¯­è¨€ã€‚ä¸è¿‡ï¼ŒGoogleä»ä¸€å¼€å§‹å°±è¯´æ˜Androidä¹Ÿæ”¯æŒJNIç¼–ç¨‹æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨å®Œæˆå¯ä»¥é€šè¿‡JNIè°ƒç”¨è‡ªå·±çš„CåŠ¨æ€åº¦ã€‚äºæ˜¯NDKå°±åº”è¿è€Œç”Ÿäº†ã€‚ Android NDK æ˜¯ä¸€å¥—å…è®¸æ‚¨ä½¿ç”¨åŸç”Ÿä»£ç è¯­è¨€(ä¾‹å¦‚Cå’ŒC++) å®ç°éƒ¨åˆ†åº”ç”¨çš„å·¥å…·é›†ã€‚åœ¨å¼€å‘æŸäº›ç±»å‹åº”ç”¨æ—¶ï¼Œè¿™æœ‰åŠ©äºæ‚¨é‡å¤ä½¿ç”¨ä»¥è¿™äº›è¯­è¨€ç¼–å†™çš„ä»£ç åº“ã€‚ Android NDK å°±æ˜¯ä¸€å¥—å·¥å…·é›†åˆï¼Œå…è®¸ä½ ä½¿ç”¨C/C++è¯­è¨€æ¥å®ç°åº”ç”¨ç¨‹åºçš„éƒ¨åˆ†åŠŸèƒ½ã€‚ NDK æ˜¯Native Develop Kitçš„å«ä¹‰ï¼Œä»å«ä¹‰å¾ˆå®¹æ˜“ç†è§£ï¼Œæœ¬åœ°å¼€å‘ã€‚å¤§å®¶éƒ½çŸ¥é“ï¼ŒAndroid å¼€å‘è¯­è¨€æ˜¯Javaï¼Œä¸è¿‡æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼ŒAndroidæ˜¯åŸºäºLinuxçš„ï¼Œå…¶æ ¸å¿ƒåº“å¾ˆå¤šéƒ½æ˜¯C/C++çš„ï¼Œæ¯”å¦‚Webkitç­‰ã€‚é‚£ä¹ˆNDKçš„ä½œç”¨ï¼Œå°±æ˜¯Googleä¸ºäº†æä¾›ç»™å¼€å‘è€…ä¸€ä¸ªåœ¨Javaä¸­è°ƒç”¨C/C++ä»£ç çš„ä¸€ä¸ªå·¥ä½œã€‚NDKæœ¬èº«å…¶å®å°±æ˜¯ä¸€ä¸ªäº¤å‰å·¥ä½œé“¾ï¼ŒåŒ…å«äº†Androidä¸Šçš„ä¸€äº›åº“æ–‡ä»¶ï¼Œç„¶åï¼ŒNDKä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæä¾›äº†ä¸€äº›è„šæœ¬ï¼Œä½¿å¾—æ›´å®¹æ˜“çš„ç¼–è¯‘C/C++ä»£ç ã€‚æ€»ä¹‹ï¼Œåœ¨Androidçš„SDKä¹‹å¤–ï¼Œæœ‰ä¸€ä¸ªå·¥å…·å°±æ˜¯NDKï¼Œç”¨äºè¿›è¡ŒC/C++çš„å¼€å‘ã€‚ä¸€èˆ¬æƒ…å†µï¼Œæ˜¯ç”¨NDKå·¥å…·æŠŠC/C++ç¼–è¯‘ä¸º.coæ–‡ä»¶ï¼Œç„¶ååœ¨Javaä¸­è°ƒç”¨ã€‚ ä»NDKåˆ°.so ä»ä¸Šå›¾è¿™ä¸ªAndroidç³»ç»Ÿæ¡†æ¶æ¥çœ‹ï¼Œæˆ‘ä»¬ä¸Šå±‚é€šè¿‡JNIæ¥è°ƒç”¨NDKå±‚çš„ï¼Œä½¿ç”¨è¿™ä¸ªå·¥å…·å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç¼–å†™å’Œè°ƒè¯•JNIçš„ä»£ç ã€‚å› ä¸ºCè¯­è¨€çš„ä¸è·¨å¹³å°ï¼Œåœ¨Macç³»ç»Ÿçš„ä¸‹ä½¿ç”¨NDKç¼–è¯‘åœ¨Linuxä¸‹èƒ½æ‰§è¡Œçš„å‡½æ•°åº“â€”â€”soæ–‡ä»¶ã€‚å…¶æœ¬è´¨å°±æ˜¯ä¸€å †Cã€C++çš„å¤´æ–‡ä»¶å’Œå®ç°æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªåº“ã€‚ç›®å‰Androidç³»ç»Ÿæ”¯æŒä»¥ä¸‹ä¸ƒç§ä¸ç”¨çš„CPUæ¶æ„ï¼Œæ¯ä¸€ç§å¯¹åº”ç€å„è‡ªçš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ABIï¼š(Application Binary Interface)å®šä¹‰äº†äºŒè¿›åˆ¶æ–‡ä»¶(å°¤å…¶æ˜¯.soæ–‡ä»¶)å¦‚ä½•è¿è¡Œåœ¨ç›¸åº”çš„ç³»ç»Ÿå¹³å°ä¸Šï¼Œä»ä½¿ç”¨çš„æŒ‡ä»¤é›†ï¼Œå†…å­˜å¯¹é½åˆ°å¯ç”¨çš„ç³»ç»Ÿå‡½æ•°åº“ã€‚ ä»€ä¹ˆæ˜¯JNIJavaè°ƒç”¨C/C++åœ¨Javaè¯­è¨€é‡Œé¢æœ¬æ¥å°±æœ‰çš„ï¼Œå¹¶éAndroidè‡ªåˆ›çš„ï¼Œå³JNIã€‚JNIå°±æ˜¯Javaè°ƒç”¨C++çš„è§„èŒƒã€‚å½“ç„¶ï¼Œä¸€èˆ¬çš„Javaç¨‹åºä½¿ç”¨çš„JNIæ ‡å‡†å¯èƒ½å’Œandroidä¸ä¸€æ ·ï¼ŒAndroidçš„JNIæ›´ç®€å•ã€‚ JNIï¼Œå…¨ç§°ä¸ºJava Native Interfaceï¼Œå³Javaæœ¬åœ°æ¥å£ï¼ŒJNIæ˜¯Javaè°ƒç”¨Native è¯­è¨€çš„ä¸€ç§ç‰¹æ€§ã€‚é€šè¿‡JNIå¯ä»¥ä½¿å¾—Javaä¸C/C++æœºå‹äº¤äº’ã€‚å³å¯ä»¥åœ¨Javaä»£ç ä¸­è°ƒç”¨C/C++ç­‰è¯­è¨€çš„ä»£ç æˆ–è€…åœ¨C/C++ä»£ç ä¸­è°ƒç”¨Javaä»£ç ã€‚ç”±äºJNIæ˜¯JVMè§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¯ä»¥å°†æˆ‘ä»¬å†™çš„JNIçš„ç¨‹åºåœ¨ä»»ä½•å®ç°äº†JNIè§„èŒƒçš„Javaè™šæ‹Ÿæœºä¸­è¿è¡Œã€‚åŒæ—¶ï¼Œè¿™ä¸ªç‰¹æ€§ä½¿æˆ‘ä»¬å¯ä»¥å¤ç”¨ä»¥å‰ç”¨C/C++å†™çš„å¤§é‡ä»£ç JNIæ˜¯ä¸€ç§åœ¨Javaè™šæ‹Ÿæœºæœºåˆ¶ä¸‹çš„æ‰§è¡Œä»£ç çš„æ ‡å‡†æœºåˆ¶ã€‚ä»£ç è¢«ç¼–å†™æˆæ±‡ç¼–ç¨‹åºæˆ–è€…C/C++ç¨‹åºï¼Œå¹¶ç»„è£…ä¸ºåŠ¨æ€åº“ã€‚ä¹Ÿå°±å…è®¸éé™æ€ç»‘å®šç”¨æ³•ã€‚è¿™æä¾›äº†ä¸€ä¸ªåœ¨Javaå¹³å°ä¸Šè°ƒç”¨C/C++çš„ä¸€ç§é€”å¾„ï¼Œåä¹‹äº¦ç„¶ã€‚ å®ç°JNIçš„è¿‡ç¨‹ç¬¬1æ­¥ï¼šåœ¨Javaä¸­å…ˆå£°æ˜ä¸€ä¸ªnativeæ–¹æ³• ç¬¬2æ­¥ï¼šç¼–è¯‘Javaæºæ–‡ä»¶javacå¾—åˆ°.classæ–‡ä»¶ ç¬¬3æ­¥ï¼šé€šè¿‡javah -jniå‘½ä»¤å¯¼å‡ºJNIçš„.hå¤´æ–‡ä»¶ ç¬¬4æ­¥ï¼šä½¿ç”¨Javaéœ€è¦äº¤äº’çš„æœ¬åœ°ä»£ç ï¼Œå®ç°åœ¨Javaä¸­å£°æ˜çš„Nativeæ–¹æ³•ï¼ˆå¦‚æœJavaéœ€è¦ä¸C++äº¤äº’ï¼Œé‚£ä¹ˆå°±ç”¨C++å®ç°Javaçš„Nativeæ–¹æ³•ã€‚ï¼‰ ç¬¬5æ­¥ï¼šå°†æœ¬åœ°ä»£ç ç¼–è¯‘æˆåŠ¨æ€åº“(Windowsç³»ç»Ÿä¸‹æ˜¯.dllæ–‡ä»¶ï¼Œå¦‚æœæ˜¯Linuxç³»ç»Ÿä¸‹æ˜¯.soæ–‡ä»¶ï¼Œå¦‚æœæ˜¯Macç³»ç»Ÿä¸‹æ˜¯.jnilib) ç¬¬6æ­¥ï¼šé€šè¿‡Javaå‘½ä»¤æ‰§è¡ŒJavaç¨‹åºï¼Œæœ€ç»ˆå®ç°Javaè°ƒç”¨æœ¬åœ°ä»£ç ã€‚ åœ¨Javaå¼€å‘ä¸­çš„é™æ€ç±»å®šä¹‰æ–¹æ³•12345678public class NDKTools &#123; static &#123; System.loadLibrary("ndkdemotest-jni"); &#125; public static native String getStringFromNDK();&#125; 2. åœ¨pythonä¸­æ€ä¹ˆè°ƒç”¨.soæ–‡ä»¶åœ¨linuxç³»ç»Ÿä¸­å¯ä»¥ä½¿ç”¨pythonçš„ctypesåº“æ¥å¯¼å…¥å¹¶è°ƒç”¨.shé™æ€åº“ 12345from ctypes import cdll cur = cdll.LoadLibrary('./libmax.so') a = cur.``max(1, 2) 3. IDAå·¥å…·çš„ä½¿ç”¨ è¿™é‡Œæœ‰å¤šä¸ªçª—å£ï¼Œä¹Ÿæœ‰å¤šä¸ªè§†å›¾ï¼Œç”¨åˆ°æœ€å¤šçš„å°±æ˜¯ï¼š 1ã€Function Windowå¯¹åº”çš„soå‡½æ•°åŒºåŸŸï¼šè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ctrl+fè¿›è¡Œå‡½æ•°çš„æœç´¢ 2ã€IDA Viewå¯¹åº”çš„soä¸­ä»£ç æŒ‡ä»¤è§†å›¾ï¼šè¿™é‡Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å…·ä½“å‡½æ•°å¯¹åº”çš„armæŒ‡ä»¤ä»£ç  3ã€Hex Viewå¯¹åº”çš„soçš„åå…­è¿›åˆ¶æ•°æ®è§†å›¾ï¼šæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹armæŒ‡ä»¤å¯¹åº”çš„æ•°æ®ç­‰ å½“ç„¶åœ¨IDAä¸­æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ä¸€äº›å¸¸ç”¨çš„å¿«æ·é”®ï¼š 1ã€å¼ºå¤§çš„F5å¿«æ·é”®å¯ä»¥å°†armæŒ‡ä»¤è½¬åŒ–æˆå¯è¯»çš„Cè¯­è¨€ï¼Œå¸®åŠ©åˆ†æ é¦–å…ˆé€‰ä¸­éœ€è¦ç¿»è¯‘æˆCè¯­è¨€çš„å‡½æ•°ï¼Œç„¶åæŒ‰ä¸‹F5ï¼š çœ‹åˆ°äº†ï¼Œç«‹é©¬æ„Ÿè§‰æ¸…çˆ½å¤šäº†ï¼Œè¿™äº›ä»£ç çœ‹èµ·æ¥åº”è¯¥ä¼šå¥½ç‚¹äº†ã€‚ ä¸‹é¢æˆ‘ä»¬è¿˜éœ€è¦åšä¸€æ­¥ï¼Œå°±æ˜¯è¿˜åŸJNIå‡½æ•°æ–¹æ³•åä¸€èˆ¬JNIå‡½æ•°æ–¹æ³•åé¦–å…ˆæ˜¯ä¸€ä¸ªæŒ‡é’ˆåŠ ä¸Šä¸€ä¸ªæ•°å­—ï¼Œæ¯”å¦‚v3+676ã€‚ç„¶åå°†è¿™ä¸ªåœ°å€ä½œä¸ºä¸€ä¸ªæ–¹æ³•æŒ‡é’ˆè¿›è¡Œæ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æŒ‡é’ˆè‡ªå·±ï¼Œæ¯”å¦‚(v3+676)(v3â€¦)ã€‚è¿™å®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬åœ¨JNIé‡Œç»å¸¸ç”¨åˆ°çš„JNIEnvæ–¹æ³•ã€‚å› ä¸ºIdaå¹¶ä¸ä¼šè‡ªåŠ¨çš„å¯¹è¿™äº›æ–¹æ³•è¿›è¡Œè¯†åˆ«ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬å¯¹soæ–‡ä»¶è¿›è¡Œè°ƒè¯•çš„æ—¶å€™ç»å¸¸ä¼šè§åˆ°å´æä¸æ¸…æ¥šè¿™ä¸ªå‡½æ•°ç©¶ç«Ÿåœ¨å¹²ä»€ä¹ˆï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°å®åœ¨æ˜¯å¤ªæŠ½è±¡äº†ã€‚è§£å†³æ–¹æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¦å¯¹JNIEnvæŒ‡é’ˆåšä¸€ä¸ªç±»å‹è½¬æ¢å³å¯ã€‚æ¯”å¦‚è¯´ä¸Šé¢æåˆ°a1å’Œv4æŒ‡é’ˆï¼š æˆ‘ä»¬å¯ä»¥é€‰ä¸­a1å˜é‡ï¼Œç„¶åæŒ‰ä¸€ä¸‹yé”®ï¼š ç„¶åå°†ç±»å‹å£°æ˜ä¸ºï¼šJNIEnv*ã€‚ ç¡®å®šä¹‹åå†æ¥çœ‹ï¼š ä¿®æ”¹ä¹‹åï¼Œæ˜¯ä¸æ˜¯ç¬é—´æ¸…æ™°äº†å¾ˆå¤šï¼Ÿå¦å¤–æœ‰äººï¼ˆ è²Œä¼¼æ˜¯çœ‹é›ªè®ºå›ä¸Šçš„ï¼‰è¿˜æ€»ç»“äº†æ‰€æœ‰JNIEnvæ–¹æ³•å¯¹åº”çš„æ•°å­—ï¼Œåœ°å€ä»¥åŠæ–¹æ³•å£°æ˜ï¼š 2ã€Shirt+F12å¿«æ·é”®ï¼Œé€Ÿåº¦æ‰“å¼€soä¸­æ‰€æœ‰çš„å­—ç¬¦ä¸²å†…å®¹çª—å£ æœ‰æ—¶å€™ï¼Œå­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç ´è§£çš„æ—¶å€™ï¼Œå¯èƒ½å°±æ˜¯å¯†ç ï¼Œæˆ–è€…æ˜¯å¯†ç åº“ä¿¡æ¯ã€‚ 3ã€Ctrl+Så¿«æ·é”®ï¼Œæœ‰ä¸¤ä¸ªç”¨é€”ï¼Œåœ¨æ­£å¸¸æ‰“å¼€soæ–‡ä»¶çš„IDA Viewè§†å›¾çš„æ—¶å€™ï¼Œå¯ä»¥æŸ¥çœ‹soå¯¹åº”çš„Segementä¿¡æ¯ å¯ä»¥å¿«é€Ÿå¾—åˆ°ï¼Œä¸€ä¸ªæ®µçš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ï¼Œä¸è¿‡è¿™ä¸ªä½ç½®æ˜¯ç›¸å¯¹ä½ç½®ï¼Œä¸æ˜¯soæ˜ å°„åˆ°å†…å­˜ä¹‹åçš„ä½ç½®ï¼Œå…³äºsoä¸­çš„æ®µä¿¡æ¯ï¼Œä¸äº†è§£çš„åŒå­¦å¯ä»¥å‚çœ‹è¿™ç¯‡æ–‡ç« ï¼šAndroidä¸­soæ–‡ä»¶æ ¼å¼è¯¦è§£ è¿™ç¯‡æ–‡ç« ä»‹ç»çš„å¾ˆå¾ˆæ¸…æ¥šäº†ï¼Œè¿™é‡Œå°±ä¸åœ¨ä½œä»‹ç»äº†ã€‚ å½“åœ¨è°ƒè¯•é¡µé¢çš„å€™ï¼Œctrl+så¯ä»¥å¿«é€Ÿå®šä½åˆ°æˆ‘ä»¬æƒ³è¦è°ƒè¯•çš„soæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜çš„åœ°å€ï¼š å› ä¸ºä¸€èˆ¬ä¸€ä¸ªç¨‹åºï¼Œè‚¯å®šä¼šåŒ…å«å¤šä¸ªsoæ–‡ä»¶çš„ï¼Œæ¯”å¦‚ç³»ç»Ÿçš„soå°±æœ‰å¥½å¤šçš„ï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨/system/libä¸‹é¢ï¼Œå½“ç„¶ä¹Ÿæœ‰æˆ‘ä»¬è‡ªå·±çš„soï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°è¿™é‡Œçš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®å°±æ˜¯è¿™ä¸ªsoæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¸­ï¼š è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨catå‘½ä»¤æŸ¥çœ‹ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜æ˜ å°„ä¿¡æ¯ï¼šcat /proc/[pid]/maps æˆ‘ä»¬çœ‹åˆ°æ˜ å°„ä¿¡æ¯ä¸­æœ‰å¤šsoæ–‡ä»¶ï¼Œå…¶å®è¿™ä¸ªä¸æ˜¯å¤šä¸ªsoæ–‡ä»¶ï¼Œè€Œæ˜¯soæ–‡ä»¶ä¸­å¯¹åº”çš„ä¸åŒSegementä¿¡æ¯è¢«æ˜ å°„åˆ°å†…å­˜ä¸­çš„ï¼Œä¸€èˆ¬æ˜¯ä»£ç æ®µï¼Œæ•°æ®æ®µç­‰ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è°ƒè¯•ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬åªå…³å¿ƒä»£ç æ®µï¼Œä»£ç æ®µæœ‰ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯å…·æœ‰æ‰§è¡Œæƒé™xï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æƒé™ä¸­æœ‰xçš„é‚£æ®µæ•°æ®å³å¯ã€‚ 4ã€Gå¿«æ·é”®ï¼šåœ¨IDAè°ƒè¯•é¡µé¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Sé”®å¿«é€Ÿè·³è½¬åˆ°æŒ‡å®šçš„å†…å­˜ä½ç½® è¿™é‡Œçš„è·³è½¬åœ°å€ï¼Œæ˜¯å¯ä»¥ç®—å‡ºæ¥çš„ï¼Œæ¯”å¦‚æˆ‘ç°åœ¨æƒ³è·³è½¬åˆ°Aå‡½æ•°ï¼Œç„¶åä¸‹æ–­ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢è¯´åˆ°çš„ctrl+sæŸ¥æ‰¾åˆ°soæ–‡ä»¶çš„å†…å­˜å¼€å§‹çš„åŸºåœ°å€ï¼Œç„¶åå†ç”¨IDA Viewä¸­æŸ¥çœ‹Aå‡½æ•°å¯¹åº”çš„ç›¸å¯¹åœ°å€ï¼Œç›¸åŠ å°±æ˜¯ç»å¯¹åœ°å€ï¼Œç„¶åè·³è½¬åˆ°å³å¯ï¼Œæ¯”å¦‚è¿™é‡Œçš„ï¼š Java_cn_wjdiankong_encryptdemo_MainActivity_isEquals å‡½æ•°çš„IDA Viewä¸­çš„ç›¸å¯¹åœ°å€(ä¹Ÿå°±æ˜¯soæ–‡ä»¶çš„åœ°å€)ï¼šE9C ä¸Šé¢çœ‹åˆ°soæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜çš„åŸºåœ°å€ï¼š74FE4000 é‚£ä¹ˆè·³è½¬åœ°å€å°±æ˜¯ï¼š74FE4000+E9C=74FE4E9C æ³¨æ„ï¼š ä¸€èˆ¬è¿™é‡Œçš„åŸºåœ°å€åªè¦ç¨‹åºæ²¡æœ‰é€€å‡ºï¼Œåœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆä»–çš„å€¼å°±ä¸ä¼šå˜ï¼Œå› ä¸ºç¨‹åºçš„æ•°æ®å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­äº†ï¼ŒåŸºåœ°å€ä¸ä¼šå˜çš„ï¼Œé™¤éç¨‹åºé€€å‡ºï¼Œåˆé‡æ–°è¿è¡ŒæŠŠæ•°æ®åŠ è½½å†…å­˜ä¸­äº†ï¼ŒåŒæ—¶ç›¸å¯¹åœ°å€æ˜¯æ°¸è¿œä¼šå˜çš„ï¼Œåªæœ‰åœ¨ä¿®æ”¹soæ–‡ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶çš„å¤§å°æ”¹å˜äº†ï¼Œå¯èƒ½ç›¸å¯¹åœ°å€ä¼šæ”¹å˜ï¼Œå…¶ä»–æƒ…å†µä¸‹ä¸ä¼šæ”¹å˜ï¼Œç›¸å¯¹åœ°å€å°±æ˜¯æ•°æ®åœ¨æ•´ä¸ªsoæ–‡ä»¶ä¸­çš„ä½ç½®ã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡½æ•°æ˜ å°„åˆ°å†…å­˜ä¸­çš„ç»å¯¹åœ°å€äº†ã€‚ æ³¨æ„ï¼š æœ‰æ—¶å€™æˆ‘ä»¬å‘ç°è·³è½¬åˆ°æŒ‡å®šä½ç½®ä¹‹åï¼Œçœ‹åˆ°çš„å…¨æ˜¯DCBæ•°æ®ï¼Œè¿™æ—¶å€™æˆ‘ä»¬é€‰æ‹©å‡½æ•°åœ°å€ï¼Œç‚¹å‡»Pé”®å°±å¯ä»¥çœ‹åˆ°armæŒ‡ä»¤æºç äº†ï¼š 5ã€è°ƒè¯•å¿«æ·é”®ï¼šF8å•æ­¥è°ƒè¯•ï¼ŒF7å•æ­¥è¿›å…¥è°ƒè¯• ä¸Šé¢æ‰¾åˆ°å‡½æ•°åœ°å€ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹æ–­ç‚¹äº†ï¼Œä¸‹æ–­ç‚¹å¾ˆç®€å•ï¼Œç‚¹å‡»ç­¾åçš„ç»¿è‰²åœˆç‚¹ï¼Œå˜æˆçº¢è‰²æ¡ç›®å³å¯ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ç‚¹å‡»F9å¿«æ·é”®ï¼Œæˆ–è€…æ˜¯ç‚¹å‡»è¿è¡ŒæŒ‰é’®ï¼Œå³å¯è¿è¡Œç¨‹åºï¼š å…¶ä¸­è¿˜æœ‰æš‚åœå’Œç»“æŸæŒ‰é’®ã€‚æˆ‘ä»¬è¿è¡Œä¹‹åï¼Œç„¶ååœ¨ç‚¹å‡»soçš„nativeå‡½æ•°ï¼Œè§¦å‘æ–­ç‚¹é€»è¾‘ï¼š è¿™æ—¶å€™ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿›å…¥è°ƒè¯•ç•Œé¢ï¼Œç‚¹å‡»F8å¯ä»¥å•æ­¥è°ƒè¯•ï¼Œçœ‹åˆ°æœ‰ä¸€ä¸ªPCæŒ‡ç¤ºå™¨ï¼Œå…¶å®åœ¨armä¸­PCæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯„å­˜å™¨ï¼Œç”¨æ¥å­˜å‚¨å½“å‰æŒ‡ä»¤çš„åœ°å€ï¼Œè¿™ä¸ªä¸‹é¢ä¼šä»‹ç»åˆ°ã€‚ å¥½äº†åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¤§è‡´è¯´äº†ä¸€ä¸‹å…³äºIDAåœ¨è°ƒè¯•soæ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦ç”¨åˆ°çš„å¿«æ·é”®ï¼š 1&gt;ã€Shift+F12å¿«é€ŸæŸ¥çœ‹soæ–‡ä»¶ä¸­åŒ…å«çš„å­—ç¬¦ä¸²ä¿¡æ¯ 2&gt;ã€F5å¿«æ·é”®å¯ä»¥å°†armæŒ‡ä»¤è½¬åŒ–æˆå¯è¯»çš„Cä»£ç ï¼Œè¿™é‡ŒåŒæ—¶å¯ä»¥ä½¿ç”¨Yé”®ï¼Œä¿®æ”¹JNIEnvçš„å‡½æ•°æ–¹æ³•å 3&gt;ã€Ctrl+Sæœ‰ä¸¤ä¸ªç”¨é€”ï¼Œåœ¨IDA Viewé¡µé¢ä¸­å¯ä»¥æŸ¥çœ‹soæ–‡ä»¶çš„æ‰€æœ‰æ®µä¿¡æ¯ï¼Œåœ¨è°ƒè¯•é¡µé¢å¯ä»¥æŸ¥çœ‹ç¨‹åºæ‰€æœ‰soæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜çš„åŸºåœ°å€ 4&gt;ã€Gé”®å¯ä»¥åœ¨è°ƒè¯•ç•Œé¢ï¼Œå¿«é€Ÿè·³è½¬åˆ°æŒ‡å®šçš„ç»å¯¹åœ°å€ï¼Œè¿›è¡Œä¸‹æ–­ç‚¹è°ƒè¯•ï¼Œè¿™é‡Œå¦‚æœè·³è½¬åˆ°ç›®çš„åœ°å€ä¹‹åï¼Œå‘ç°æ˜¯DCBæ•°æ®çš„è¯ï¼Œå¯ä»¥åœ¨ä½¿ç”¨Pé”®ï¼Œè¿›è¡Œè½¬åŒ–å³å¯ï¼Œå…³äºDCBæ•°æ®ï¼Œä¸‹é¢ä¼šä»‹ç»çš„ã€‚ 5&gt;ã€F7é”®å¯ä»¥å•æ­¥è¿›å…¥è°ƒè¯•ï¼ŒF8é”®å¯ä»¥å•æ­¥è°ƒè¯• 4.å¸¸ç”¨çš„ARMæŒ‡ä»¤é›†çŸ¥è¯†æˆ‘ä»¬åœ¨ä¸Šé¢çœ‹åˆ°IDAæ‰“å¼€soä¹‹åï¼Œçœ‹åˆ°çš„æ˜¯çº¯ç§çš„æ±‡ç¼–æŒ‡ä»¤ä»£ç ï¼Œæ‰€ä»¥è¿™å°±è¦æ±‚æˆ‘ä»¬å¿…é¡»ä¼šçœ‹æ‡‚æ±‡ç¼–ä»£ç ï¼Œå°±ç±»ä¼¼äºæˆ‘ä»¬åœ¨è°ƒè¯•Javaå±‚ä»£ç çš„æ—¶å€™ä¸€æ ·ï¼Œå¿…é¡»ä¼šsmaliè¯­æ³•ï¼Œåº†å¹¸çš„æ˜¯ï¼Œè¿™ä¸¤ç§è¯­æ³•éƒ½ä¸æ˜¯å¾ˆå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“ä¸€äº›å¤§ä½“çš„è¯­æ³•å’ŒæŒ‡ä»¤å°±å¯ä»¥äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹armæŒ‡ä»¤ä¸­çš„å¯»å€æ–¹å¼ï¼Œå¯„å­˜å™¨ï¼Œå¸¸ç”¨æŒ‡ä»¤ï¼Œçœ‹å®Œè¿™ä¸‰ä¸ªçŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬å°±ä¼šå¯¹armæŒ‡ä»¤æœ‰ä¸€ä¸ªå¤§ä½“çš„äº†è§£ï¼Œå¯¹äºçœ‹armæŒ‡ä»¤ä»£ç ä¹Ÿæ˜¯æœ‰ä¸€ä¸ªå¤§ä½“çš„è®¤çŸ¥äº†ã€‚ 1ã€armæŒ‡ä»¤ä¸­çš„å¯»å€æ–¹å¼ 1&gt;. ç«‹å³æ•°å¯»å€ä¹Ÿå«ç«‹å³å¯»å€ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯»å€æ–¹å¼ï¼Œæ“ä½œæ•°æœ¬èº«åŒ…å«åœ¨æŒ‡ä»¤ä¸­ï¼Œåªè¦å–å‡ºæŒ‡ä»¤ä¹Ÿå°±å–åˆ°äº†æ“ä½œæ•°ã€‚è¿™ä¸ªæ“ä½œæ•°å«åšç«‹å³æ•°ï¼Œå¯¹åº”çš„å¯»å€æ–¹å¼å«åšç«‹å³å¯»å€ã€‚ä¾‹å¦‚ï¼šMOV R0,#64 ï¼›R0 â† 642&gt;. å¯„å­˜å™¨å¯»å€å¯„å­˜å™¨å¯»å€å°±æ˜¯åˆ©ç”¨å¯„å­˜å™¨ä¸­çš„æ•°å€¼ä½œä¸ºæ“ä½œæ•°ï¼Œä¹Ÿç§°ä¸ºå¯„å­˜å™¨ç›´æ¥å¯»å€ã€‚ä¾‹å¦‚ï¼š ADD R0ï¼ŒR1ï¼Œ R2 ï¼›R0 â† R1 + R23&gt;. å¯„å­˜å™¨é—´æ¥å¯»å€å¯„å­˜å™¨é—´æ¥å¯»å€å°±æ˜¯æŠŠå¯„å­˜å™¨ä¸­çš„å€¼ä½œä¸ºåœ°å€ï¼Œå†é€šè¿‡è¿™ä¸ªåœ°å€å»å–å¾—æ“ä½œæ•°ï¼Œæ“ä½œæ•°æœ¬èº«å­˜æ”¾åœ¨å­˜å‚¨å™¨ä¸­ã€‚ä¾‹å¦‚ï¼šLDR R0ï¼Œ[R1] ï¼›R0 â†[R1]4&gt;. å¯„å­˜å™¨åç§»å¯»å€è¿™æ˜¯ARMæŒ‡ä»¤é›†ç‰¹æœ‰çš„å¯»å€æ–¹å¼ï¼Œå®ƒæ˜¯åœ¨å¯„å­˜å™¨å¯»å€å¾—åˆ°æ“ä½œæ•°åå†è¿›è¡Œç§»ä½æ“ä½œï¼Œå¾—åˆ°æœ€ç»ˆçš„æ“ä½œæ•°ã€‚ä¾‹å¦‚ï¼šMOV R0ï¼ŒR2ï¼ŒLSL #3 ï¼›R0 â† R2 * 8 ï¼ŒR2çš„å€¼å·¦ç§»3ä½ï¼Œç»“æœèµ‹ç»™R0ã€‚5&gt;. å¯„å­˜å™¨åŸºå€å˜å€å¯»å€å¯„å­˜å™¨åŸºå€å˜å€å¯»å€åˆç§°ä¸ºåŸºå€å˜å€å¯»å€ï¼Œå®ƒæ˜¯åœ¨å¯„å­˜å™¨é—´æ¥å¯»å€çš„åŸºç¡€ä¸Šæ‰©å±•æ¥çš„ã€‚å®ƒå°†å¯„å­˜å™¨ï¼ˆè¯¥å¯„å­˜å™¨ä¸€èˆ¬ç§°ä½œåŸºå€å¯„å­˜å™¨ï¼‰ä¸­çš„å€¼ä¸æŒ‡ä»¤ä¸­ç»™å‡ºçš„åœ°å€åç§»é‡ç›¸åŠ ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªåœ°å€ï¼Œé€šè¿‡è¿™ä¸ªåœ°å€å–å¾—æ“ä½œæ•°ã€‚ä¾‹å¦‚ï¼šLDR R0ï¼Œ[R1ï¼Œ#4] ï¼›R0 â†[R1 + 4]ï¼Œå°†R1çš„å†…å®¹åŠ ä¸Š4å½¢æˆæ“ä½œæ•°çš„åœ°å€ï¼Œå–å¾—çš„æ“ä½œæ•°å­˜å…¥å¯„å­˜å™¨R0ä¸­ã€‚6&gt;. å¤šå¯„å­˜å™¨å¯»å€è¿™ç§å¯»å€æ–¹å¼å¯ä»¥ä¸€æ¬¡å®Œæˆå¤šä¸ªå¯„å­˜å™¨å€¼çš„ä¼ é€ã€‚ä¾‹å¦‚ï¼šLDMIA R0ï¼Œ{R1ï¼ŒR2ï¼ŒR3ï¼ŒR4} ï¼›R1â†[R0]ï¼ŒR2â†[R0+4]ï¼ŒR3â†[R0+8]ï¼ŒR4â†[R0+12]7&gt;. å †æ ˆå¯»å€å †æ ˆæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼ŒæŒ‰å…ˆè¿›åå‡ºï¼ˆFirst In Last Outï¼ŒFILOï¼‰çš„æ–¹å¼å·¥ä½œï¼Œä½¿ç”¨å †æ ˆæŒ‡é’ˆï¼ˆStack Pointer, SPï¼‰æŒ‡ç¤ºå½“å‰çš„æ“ä½œä½ç½®ï¼Œå †æ ˆæŒ‡é’ˆæ€»æ˜¯æŒ‡å‘æ ˆé¡¶ã€‚å †æ ˆå¯»å€ä¸¾ä¾‹å¦‚ä¸‹ï¼šSTMFD SPï¼ï¼Œï½›R1ï¼R7, LRï½ ï¼›å°†R1ï¼R7, LRå‹å…¥å †æ ˆã€‚æ»¡é€’å‡å †æ ˆã€‚LDMED SPï¼ï¼Œï½›R1ï¼R7, LRï½ ï¼›å°†å †æ ˆä¸­çš„æ•°æ®å–å›åˆ°R1ï¼R7, LRå¯„å­˜å™¨ã€‚ç©ºé€’å‡å †æ ˆã€‚ 2ã€ARMä¸­çš„å¯„å­˜å™¨ R0-R3:ç”¨äºå‡½æ•°å‚æ•°åŠè¿”å›å€¼çš„ä¼ é€’R4-R6, R8, R10-R11:æ²¡æœ‰ç‰¹æ®Šè§„å®šï¼Œå°±æ˜¯æ™®é€šçš„é€šç”¨å¯„å­˜å™¨R7:æ ˆå¸§æŒ‡é’ˆ(Frame Pointer).æŒ‡å‘å‰ä¸€ä¸ªä¿å­˜çš„æ ˆå¸§(stack frame)å’Œé“¾æ¥å¯„å­˜å™¨(link registerï¼Œ lr)åœ¨æ ˆä¸Šçš„åœ°å€ã€‚R9:æ“ä½œç³»ç»Ÿä¿ç•™R12:åˆå«IP(intra-procedure scratch )R13:åˆå«SP(stack pointer)ï¼Œæ˜¯æ ˆé¡¶æŒ‡é’ˆR14:åˆå«LR(link register)ï¼Œå­˜æ”¾å‡½æ•°çš„è¿”å›åœ°å€ã€‚R15:åˆå«PC(program counter)ï¼ŒæŒ‡å‘å½“å‰æŒ‡ä»¤åœ°å€ã€‚ 3ã€ARMä¸­çš„å¸¸ç”¨æŒ‡ä»¤å«ä¹‰ ADD åŠ æŒ‡ä»¤SUB å‡æŒ‡ä»¤STR æŠŠå¯„å­˜å™¨å†…å®¹å­˜åˆ°æ ˆä¸Šå»LDR æŠŠæ ˆä¸Šå†…å®¹è½½å…¥ä¸€å¯„å­˜å™¨ä¸­.W æ˜¯ä¸€ä¸ªå¯é€‰çš„æŒ‡ä»¤å®½åº¦è¯´æ˜ç¬¦ã€‚å®ƒä¸ä¼šå½±å“ä¸ºæ­¤æŒ‡ä»¤çš„è¡Œä¸ºï¼Œå®ƒåªæ˜¯ç¡®ä¿ç”Ÿæˆ 32 ä½æŒ‡ä»¤ã€‚Infocenter.arm.comçš„è¯¦ç»†ä¿¡æ¯BL æ‰§è¡Œå‡½æ•°è°ƒç”¨ï¼Œå¹¶æŠŠä½¿lræŒ‡å‘è°ƒç”¨è€…(caller)çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œå³å‡½æ•°çš„è¿”å›åœ°å€BLX åŒä¸Šï¼Œä½†æ˜¯åœ¨ARMå’ŒthumbæŒ‡ä»¤é›†é—´åˆ‡æ¢ã€‚CMP æŒ‡ä»¤è¿›è¡Œæ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°çš„å¤§å° 4ã€ARMæŒ‡ä»¤ç®€å•ä»£ç æ®µåˆ†æ Cä»£ç ï¼š #include &lt;stdio.h&gt;int func(int a, int b, int c, int d, int e, int f){ â€‹ int g = a + b + c + d + e + f;â€‹ return g;} å¯¹åº”çš„ARMæŒ‡ä»¤ï¼š add r0, r1 å°†å‚æ•°aå’Œå‚æ•°bç›¸åŠ å†æŠŠç»“æœèµ‹å€¼ç»™r0ldr.w r12, [sp] æŠŠæœ€çš„ä¸€ä¸ªå‚æ•°fä»æ ˆä¸Šè£…è½½åˆ°r12å¯„å­˜å™¨add r0, r2 æŠŠå‚æ•°cç´¯åŠ åˆ°r0ä¸Šldr.w r9, [sp, #4] æŠŠå‚æ•°eä»æ ˆä¸Šè£…è½½åˆ°r9å¯„å­˜å™¨add r0, r3 ç´¯åŠ dç´¯åŠ åˆ°r0add r0, r12 ç´¯åŠ å‚æ•°fåˆ°r0add r0, r9 ç´¯åŠ å‚æ•°eåˆ°r0 äºŒã€æ„é€ soæ¡ˆä¾‹å¥½äº†ï¼Œå…³äºARMæŒ‡ä»¤çš„ç›¸å…³çŸ¥è¯†ï¼Œå°±ä»‹ç»è¿™ä¹ˆå¤šäº†ï¼Œä¸è¿‡æˆ‘ä»¬åœ¨è°ƒè¯•åˆ†æçš„æ—¶å€™ï¼Œè‚¯å®šä¸èƒ½åšåˆ°å…¨éƒ¨çš„äº†è§£ï¼Œå› ä¸ºæœ¬èº«ARMæŒ‡ä»¤è¯­æ³•å°±æ¯”è¾ƒå¤æ‚ï¼Œä¸è¿‡å¹¸å¥½å¤§å­¦å­¦ä¹ äº†æ±‡ç¼–è¯­è¨€ï¼Œæ‰€ä»¥ç¨å¾®èƒ½çœ‹æ‡‚ç‚¹ï¼Œå¦‚æœä¸æ‡‚æ±‡ç¼–çš„åŒå­¦é‚£å°±å¯èƒ½éœ€è¦è¡¥ä¹ ä¸€ä¸‹äº†ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ä½¿ç”¨IDAåˆ†æsoæ–‡ä»¶çš„æ—¶å€™ï¼Œä¸ä¼šæ±‡ç¼–çš„è¯ï¼Œé‚£æ˜¯è‚¯å®šè¡Œä¸é€šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦çœ‹æ‡‚æ±‡ç¼–ä»£ç çš„ï¼Œå¦‚æœé‡åˆ°ç‰¹æ®ŠæŒ‡ä»¤ä¸äº†è§£çš„åŒå­¦ï¼Œå¯ä»¥ç½‘ä¸Šæœä¸€ä¸‹å³å¯ã€‚ ä¸Šé¢æˆ‘ä»¬çš„å‡†å¤‡çŸ¥è¯†åšå®Œäº†ï¼Œä¸€ä¸ªæ˜¯IDAå·¥å…·çš„æ—¶å€™ï¼Œä¸€ä¸ªæ˜¯ARMæŒ‡ä»¤çš„äº†è§£ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥å¼€å§‹æ“åˆ€äº†ï¼Œä¸ºäº†æ–¹ä¾¿å¼€å§‹ï¼Œæˆ‘ä»¬å…ˆè‡ªå·±å†™ä¸€ä¸ªç®€å•çš„Android nativeå±‚ä»£ç ï¼Œç„¶åè¿›è¡ŒIDAè¿›è¡Œåˆ†æå³å¯ã€‚ è¿™é‡Œå¯ä»¥ä½¿ç”¨AndroidStudioä¸­è¿›è¡Œæ–°å»ºä¸€ä¸ªç®€å•å·¥ç¨‹ï¼Œç„¶ååˆ›å»ºJNIå³å¯ï¼š è¿™é‡Œé¡ºä¾¿ç®€å•è¯´ä¸€ä¸‹AndroidStudioä¸­å¦‚ä½•è¿›è¡ŒNDKçš„å¼€å‘å§ï¼š ç¬¬ä¸€æ­¥ï¼šåœ¨å·¥ç¨‹ä¸­æ–°å»ºjniç›®å½• ç¬¬äºŒæ­¥ï¼šä½¿ç”¨javahç”Ÿæˆnativeçš„å¤´æ–‡ä»¶ æ³¨æ„ï¼š javahæ‰§è¡Œçš„ç›®å½•ï¼Œå¿…é¡»æ˜¯ç±»åŒ…åè·¯å¾„çš„æœ€ä¸Šå±‚ï¼Œç„¶åæ‰§è¡Œï¼š javah ç±»å…¨å æ³¨æ„æ²¡æœ‰åç¼€åjavaå“¦ ç¬¬ä¸‰æ­¥ï¼šé…ç½®é¡¹ç›®çš„NDKç›®å½• é€‰æ‹©æ¨¡å—çš„è®¾ç½®é€‰çº¿ï¼šOpen Module Settingsï¼š è®¾ç½®NDKç›®å½•å³å¯ ç¬¬å››æ­¥ï¼šcopyå¤´æ–‡ä»¶åˆ°jniç›®å½•ä¸‹ï¼Œç„¶åé…ç½®gradleä¸­çš„ndké€‰é¡¹ è¿™é‡Œåªéœ€è¦è®¾ç½®ç¼–è¯‘ä¹‹åçš„æ¨¡å—åï¼Œå°±æ˜¯soæ–‡ä»¶çš„åç§°ï¼Œéœ€è¦äº§ç”Ÿé‚£å‡ ä¸ªå¹³å°ä¸‹çš„soæ–‡ä»¶ï¼Œè¿˜æœ‰å°±æ˜¯éœ€è¦ç”¨åˆ°çš„libåº“ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬ç”¨åˆ°äº†Androidä¸­æ‰“å°logçš„åº“æ–‡ä»¶ã€‚ ç¬¬äº”æ­¥ï¼šç¼–è¯‘è¿è¡Œï¼Œåœ¨buildç›®å½•ä¸‹ç”ŸæˆæŒ‡å®šçš„soæ–‡ä»¶ï¼Œcopyåˆ°å·¥ç¨‹çš„libsç›®å½•ä¸‹å³å¯ å¥½äº†ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å°±å¿«é€Ÿçš„åœ¨AndroidStudioä¸­æ–°å»ºäº†ä¸€ä¸ªNativeé¡¹ç›®ï¼Œè¿™é‡Œå…³äºnativeé¡¹ç›®çš„ä»£ç ä¸æƒ³è§£é‡Šå¤ªå¤šï¼Œå°±æ˜¯Javaå±‚ ä¼ é€’äº†ç”¨æˆ·è¾“å…¥çš„å¯†ç ï¼Œç„¶ånativeåšäº†æ ¡éªŒè¿‡ç¨‹ï¼ŒæŠŠæ ¡éªŒç»“æœè¿”å›åˆ°Javaå±‚å³å¯ï¼š å…·ä½“çš„æ ¡éªŒè¿‡ç¨‹è¿™é‡Œä¸å†è§£é‡Šäº†ã€‚æˆ‘ä»¬è¿è¡Œé¡¹ç›®ä¹‹åï¼Œå¾—åˆ°apkæ–‡ä»¶ï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹æˆ‘ä»¬çš„ç ´è§£æ—…ç¨‹äº† ä¸‰ã€å¼€å§‹ç ´è§£soæ–‡ä»¶å¼€å§‹ç ´è§£æˆ‘ä»¬ç¼–è¯‘ä¹‹åçš„apkæ–‡ä»¶ ç¬¬ä¸€ã€é¦–å…ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€ç®€å•çš„å‹ç¼©è½¯ä»¶ï¼Œæ‰“å¼€apkæ–‡ä»¶ï¼Œç„¶åè§£å‹å‡ºä»–çš„soæ–‡ä»¶ æˆ‘ä»¬å¾—åˆ°libencrypt.soæ–‡ä»¶ä¹‹åï¼Œä½¿ç”¨IDAæ‰“å¼€å®ƒï¼š æˆ‘ä»¬çŸ¥é“ä¸€èˆ¬soä¸­çš„å‡½æ•°æ–¹æ³•åéƒ½æ˜¯ï¼šJava_ç±»å_æ–¹æ³•å é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬ç›´æ¥æœï¼šJavaå…³é”®å­—å³å¯ï¼Œæˆ–è€…ä½¿ç”¨jd-guiå·¥å…·æ‰¾åˆ°æŒ‡å®šçš„nativeæ–¹æ³• åŒå‡»ï¼Œå³å¯åœ¨å³è¾¹çš„IDA Viewé¡µé¢ä¸­çœ‹åˆ°Java_cn_wjdiankong_encryptdemo_MainActivity_isEquals å‡½æ•°çš„æŒ‡ä»¤ä»£ç ï¼š æˆ‘ä»¬å¯ä»¥ç®€å•çš„åˆ†æä¸€ä¸‹è¿™æ®µæŒ‡ä»¤ä»£ç ï¼š 1&gt;ã€PUSH {r3-r7,lr} æ˜¯ä¿å­˜r3,r4,r5,r6,r7,lr çš„å€¼åˆ°å†…å­˜çš„æ ˆä¸­ï¼Œé‚£ä¹ˆæœ€åå½“æ‰§è¡Œå®ŒæŸæ“ä½œåï¼Œä½ æƒ³è¿”å›åˆ°lræŒ‡å‘çš„åœ°æ–¹æ‰§è¡Œï¼Œå½“ç„¶è¦ç»™pcäº†ï¼Œå› ä¸ºpcä¿ç•™ä¸‹ä¸€æ¡CPUå³å°†æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œåªæœ‰ç»™äº†pcï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤æ‰ä¼šæ‰§è¡Œåˆ°lræŒ‡å‘çš„åœ°æ–¹ pcï¼šç¨‹åºå¯„å­˜å™¨ï¼Œä¿ç•™ä¸‹ä¸€æ¡CPUå³å°†æ‰§è¡Œçš„æŒ‡ä»¤lr: è¿æ¥è¿”å›å¯„å­˜å™¨ï¼Œä¿ç•™å‡½æ•°è¿”å›åï¼Œä¸‹ä¸€æ¡åº”æ‰§è¡Œçš„æŒ‡ä»¤ è¿™ä¸ªå’Œå‡½æ•°æœ€åé¢çš„POP {r3-r7,pc}æ˜¯ç›¸å¯¹åº”çš„ã€‚ 2&gt;ã€ç„¶åæ˜¯è°ƒç”¨äº†strlen,malloc,strcpyç­‰ç³»ç»Ÿå‡½æ•°ï¼Œåœ¨æ¯æ¬¡ä½¿ç”¨BLXå’ŒBLæŒ‡ä»¤è°ƒç”¨è¿™äº›å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å‘ç°äº†ä¸€ä¸ªè§„å¾‹ï¼šå°±æ˜¯åœ¨è°ƒç”¨ä»–ä»¬ä¹‹å‰ä¸€èˆ¬éƒ½æ˜¯ç”±MOVæŒ‡ä»¤ï¼Œç”¨æ¥ä¼ é€’å‚æ•°å€¼çš„ï¼Œæ¯”å¦‚è¿™é‡Œçš„R5é‡Œé¢å­˜å‚¨çš„å°±æ˜¯strlenå‡½æ•°çš„å‚æ•°ï¼ŒR0å°±æ˜¯is_numberå‡½æ•°çš„å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™æ ·åˆ†æä¹‹åï¼Œåœ¨åé¢çš„åŠ¨æ€è°ƒè¯•çš„è¿‡ç¨‹ä¸­å¯ä»¥å¾—åˆ°å‡½æ•°çš„å…¥å£å‚æ•°å€¼ï¼Œè¿™æ ·å°±èƒ½å¾—åˆ°ä¸€äº›é‡è¦ä¿¡æ¯ 3&gt;ã€åœ¨æ¯æ¬¡è°ƒç”¨æœ‰è¿”å›å€¼çš„å‡½æ•°ä¹‹åçš„å‘½ä»¤ï¼Œä¸€èˆ¬éƒ½æ˜¯æ¯”è¾ƒæŒ‡ä»¤ï¼Œæ¯”å¦‚CMPï¼ŒCBZï¼Œæˆ–è€…æ˜¯strcmpç­‰ï¼Œè¿™é‡Œæ˜¯æˆ‘ä»¬ç ´è§£çš„çªç ´ç‚¹ï¼Œå› ä¸ºä¸€èˆ¬åŠ å¯†å†æ€ä¹ˆç‰›é€¼ï¼Œæœ€åæ¯”è¾ƒçš„å‚æ•°è‚¯å®šæ˜¯æ­£ç¡®çš„å¯†ç (æˆ–è€…æ˜¯æ­£ç¡®çš„åŠ å¯†ä¹‹åçš„å¯†ç )å’Œæˆ‘ä»¬è¾“å…¥çš„å¯†ç (æˆ–è€…æ˜¯åŠ å¯†ä¹‹åçš„è¾“å…¥å¯†ç )ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå°±å¯ä»¥å¾—åˆ°æ­£ç¡®å¯†ç ï¼Œæˆ–è€…æ˜¯åŠ å¯†ä¹‹åçš„å¯†ç ï¼š åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±åˆ†æå®Œäº†nativeå±‚çš„å¯†ç æ¯”è¾ƒå‡½æ•°ï¼šJava_cn_wjdiankong_encryptdemo_MainActivity_isEquals å¦‚æœè§‰å¾—ä¸Šé¢çš„ARMæŒ‡ä»¤çœ‹çš„åƒåŠ›ï¼Œå¯ä»¥ä½¿ç”¨F5é”®ï¼ŒæŸ¥çœ‹ä»–çš„Cè¯­è¨€ä»£ç ï¼š æˆ‘ä»¬è¿™é‡Œçœ‹åˆ°å…¶å®æœ‰ä¸¤ä¸ªå‡½æ•°æ˜¯æ ¸å¿ƒç‚¹ï¼š 1&gt;is_numberå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æˆ‘ä»¬çœ‹åå­—åº”è¯¥çŒœåˆ°æ˜¯åˆ¤æ–­æ˜¯ä¸æ˜¯æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨F5é”®ï¼ŒæŸ¥çœ‹ä»–å¯¹åº”çš„Cè¯­è¨€ä»£ç ï¼š è¿™é‡Œç®€å•ä¸€çœ‹ï¼Œä¸»è¦æ˜¯çœ‹returnè¯­å¥å’Œifåˆ¤æ–­è¯­å¥ï¼Œçœ‹åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªå¾ªç¯ï¼Œç„¶åè·å–_BYTEè¿™é‡Œåœ°å€çš„å€¼ï¼Œå¹¶ä¸”è‡ªå¢åŠ ä¸€ï¼Œç„¶åå­˜åˆ°v2ä¸­ï¼Œå¦‚æœv3ä¸ºâ€™\0â€™çš„è¯ï¼Œå°±ç»“æŸå¾ªç¯ï¼Œç„¶ååšä¸€æ¬¡åˆ¤æ–­ï¼Œå°±æ˜¯v2-48æ˜¯å¦å¤§äº9ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬çŸ¥é“48å¯¹åº”çš„æ˜¯ASCIIä¸­çš„æ•°å­—0ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç¡®å®šçš„æ˜¯å°±æ˜¯ï¼šç”¨ä¸€ä¸ªå¾ªç¯éå†_BYTEè¿™é‡Œå­˜çš„å­—ç¬¦ä¸²æ˜¯å¦ä¸ºæ•°å­—ä¸²ã€‚ 2&gt;get_encrypt_strå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æˆ‘ä»¬çœ‹åˆ°åå­—å¯ä»¥çŒœæµ‹ï¼Œä»–æ˜¯è·å–æˆ‘ä»¬è¾“å…¥çš„å¯†ç åŠ å¯†ä¹‹åçš„å€¼ï¼Œå†æ¬¡ä½¿ç”¨F5å¿«æ·é”®æŸ¥çœ‹ï¼š è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªifè¯­å¥ï¼Œç”¨æ¥åˆ¤æ–­ä¼ é€’çš„å‚æ•°æ˜¯å¦ä¸ºNULLï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œç›´æ¥è¿”å›ï¼Œä¸æ˜¯çš„è¯ï¼Œä½¿ç”¨strlenå‡½æ•°è·å–å­—ç¬¦ä¸²çš„é•¿åº¦ä¿å­˜åˆ°v2ä¸­ï¼Œç„¶åä½¿ç”¨mallocç”³è¯·ä¸€å—å †å†…å­˜ï¼Œé¦–æŒ‡é’ˆä¿å­˜åˆ°resultï¼Œå¤§å°æ˜¯v2+1ä¹Ÿå°±æ˜¯ä¼ é€’è¿›æ¥çš„å­—ç¬¦ä¸²é•¿åº¦+1ï¼Œç„¶åå°±å¼€å§‹è¿›å…¥å¾ªç¯ï¼Œé¦–æŒ‡é’ˆresultï¼Œèµ‹å€¼ç»™iæŒ‡é’ˆï¼Œå¼€å§‹å¾ªç¯ï¼Œv3æ˜¯é€šè¿‡v1-1è·å–åˆ°çš„ï¼Œå°±æ˜¯å‡½æ•°ä¼ é€’è¿›æ¥å­—ç¬¦ä¸²çš„åœ°å€ï¼Œé‚£ä¹ˆv6å°±æ˜¯è·å–ä¼ é€’è¿›æ¥å­—ç¬¦ä¸²çš„å­—ç¬¦å€¼ï¼Œç„¶åå‡å»48ï¼Œèµ‹å€¼ç»™v7ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çŒœåˆ°äº†ï¼Œè¿™é‡Œæƒ³åšå­—ç¬¦è½¬åŒ–ï¼ŒæŠŠcharè½¬åŒ–æˆintç±»å‹ï¼Œç»§ç»­å¾€ä¸‹çœ‹ï¼Œå¦‚æœv6==48çš„è¯ï¼Œv7=1ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œå¦‚æœé‡åˆ°å­—ç¬¦â€™0â€™ï¼Œå°±èµ‹å€¼1ï¼Œåœ¨å¾€ä¸‹çœ‹ï¼Œçœ‹åˆ°æˆ‘ä»¬ä¸Šé¢å¾—åˆ°çš„v7å€¼ï¼Œè¢«ç”¨æ¥å–key_srcæ•°ç»„ä¸­çš„å€¼ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬åŒå‡»key_srcå˜é‡ï¼Œå°±è·³è½¬åˆ°äº†ä»–çš„å€¼åœ°æ–¹ï¼Œæœä¸å…¶ç„¶ï¼Œè¿™é‡Œä¿å­˜äº†ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œçœ‹åˆ°ä»–çš„é•¿åº¦æ­£å¥½æ˜¯18ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬åº”è¯¥æ˜ç™½äº†ï¼Œè¿™é‡Œé€šè¿‡ä¼ é€’è¿›æ¥çš„å­—ç¬¦ä¸²ï¼Œå¾ªç¯éå†å­—ç¬¦ä¸²ï¼Œè·å–å­—ç¬¦ï¼Œç„¶åè½¬åŒ–æˆæ•°å­—ï¼Œåœ¨å€’åºè·å–key_srcä¸­çš„å­—ç¬¦ï¼Œä¿å­˜åˆ°resultä¸­ã€‚ç„¶åè¿”å›ã€‚ å¥½äº†ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å°±åˆ†æå®Œäº†è¿™ä¸¤ä¸ªé‡è¦çš„å‡½æ•°çš„åŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯åˆ¤æ–­è¾“å…¥çš„å†…å®¹æ˜¯å¦ä¸ºæ•°å­—å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡è¾“å…¥çš„å†…å®¹è·å–å¯†ç å†…å®¹ï¼Œç„¶åå’Œæ­£ç¡®çš„åŠ å¯†å¯†ç ï¼šssBCqpBssP ä½œæ¯”è¾ƒã€‚ ç¬¬äºŒã€å¼€å§‹ä½¿ç”¨IDAè¿›è¡Œè°ƒè¯•è®¾ç½®é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°±ç”¨åŠ¨æ€è°ƒè¯•æ¥è·Ÿè¸ªä¼ å…¥çš„å­—ç¬¦ä¸²å€¼ï¼Œå’ŒåŠ å¯†ä¹‹åçš„å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æ²¡æœ‰æ‰“å°logçš„å‡½æ•°ï¼Œæ‰€ä»¥å¾ˆéš¾çŸ¥é“å…·ä½“çš„å‚æ•°å’Œå¯„å­˜å™¨çš„å€¼ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å¼€å§‹è°ƒè¯•ï¼Œå¾—çŸ¥æ¯ä¸ªå‡½æ•°æ‰§è¡Œä¹‹åçš„å¯„å­˜å™¨çš„å€¼ï¼Œæˆ‘ä»¬åœ¨ç”¨IDAè¿›è¡Œè°ƒè¯•soçš„æ—¶å€™ï¼Œéœ€è¦ä»¥ä¸‹å‡†å¤‡æ­¥éª¤ï¼š 1ã€åœ¨IDAå®‰è£…ç›®å½•ä¸‹è·å–android_serverå‘½ä»¤æ–‡ä»¶ åœ¨IDAå®‰è£…ç›®å½•\dbgsrv\android_server å…¶å®æ˜¯ä½¿ç”¨gdbå’Œgdbserveræ¥åšåˆ°çš„ï¼Œgdbå’Œgdbserveråœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œå¿…é¡»æ³¨å…¥åˆ°è¢«è°ƒè¯•çš„ç¨‹åºè¿›ç¨‹ä¸­ï¼Œä½†æ˜¯érootè®¾å¤‡çš„è¯ï¼Œæ³¨å…¥åˆ«çš„è¿›ç¨‹ä¸­åªèƒ½å€ŸåŠ©äºrun-asè¿™ä¸ªå‘½ä»¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœè¦è°ƒè¯•ä¸€ä¸ªåº”ç”¨è¿›ç¨‹çš„è¯ï¼Œå¿…é¡»è¦æ³¨å…¥ä»–å†…éƒ¨ï¼Œé‚£ä¹ˆIDAè°ƒè¯•soä¹Ÿæ˜¯è¿™ä¸ªåŸç†ï¼Œä»–éœ€è¦æ³¨å…¥(Attaché™„åŠ )è¿›ç¨‹ï¼Œæ‰èƒ½è¿›è¡Œè°ƒè¯•ï¼Œä½†æ˜¯IDAæ²¡æœ‰è‡ªå·±å¼„äº†ä¸€ä¸ªç±»ä¼¼äºgdbserverè¿™æ ·çš„å·¥å…·ï¼Œé‚£å°±æ˜¯android_serveräº†ï¼Œæ‰€ä»¥ä»–éœ€è¦è¿è¡Œåœ¨è®¾å¤‡ä¸­ï¼Œä¿è¯å’ŒPCç«¯çš„IDAè¿›è¡Œé€šä¿¡ï¼Œæ¯”å¦‚è·å–è®¾å¤‡çš„è¿›ç¨‹ä¿¡æ¯ï¼Œå…·ä½“è¿›ç¨‹çš„soå†…å­˜åœ°å€ï¼Œè°ƒè¯•ä¿¡æ¯ç­‰ã€‚ æ‰€ä»¥æˆ‘ä»¬æŠŠandroid_serverä¿å­˜åˆ°è®¾å¤‡çš„/dataç›®å½•ä¸‹ï¼Œä¿®æ”¹ä¸€ä¸‹ä»–çš„è¿è¡Œæƒé™ï¼Œç„¶åå¿…é¡»åœ¨rootç¯å¢ƒä¸‹è¿è¡Œï¼Œå› ä¸ºä»–è¦åšæ³¨å…¥è¿›ç¨‹æ“ä½œï¼Œå¿…é¡»è¦rootã€‚ æ³¨æ„ï¼š è¿™é‡ŒæŠŠä»–æ”¾åœ¨äº†/dataç›®å½•ä¸‹ï¼Œç„¶åè¿è¡Œ./android_serverï¼Œè¿™é‡Œæç¤ºäº†IDA Android 32-bitï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬åœ¨æ‰“å¼€IDAçš„æ—¶å€™ä¸€å®šè¦æ˜¯32ä½çš„IDAï¼Œä¸æ˜¯64ä½çš„ï¼Œä¸ç„¶ä¿å­˜ï¼ŒIDAåœ¨å®‰è£…ä¹‹åéƒ½æ˜¯æœ‰ä¸¤ä¸ªå¯æ‰§è¡Œçš„ç¨‹åºï¼Œä¸€ä¸ªæ˜¯32ä½ï¼Œä¸€ä¸ªæ˜¯64ä½çš„ï¼Œå¦‚æœæ²¡æ‰“å¼€æ­£ç¡®ä¼šæŠ¥è¿™æ ·çš„é”™è¯¯ï¼š åŒæ ·è¿˜æœ‰ä¸€ç±»é—®é¢˜ï¼š error: only position independent executables (PIE) are supported è¿™ä¸ªä¸»è¦æ˜¯Android5.0ä»¥ä¸Šçš„ç¼–è¯‘é€‰é¡¹é»˜è®¤å¼€å¯äº†pieï¼Œåœ¨5.0ä»¥ä¸‹ç¼–è¯‘çš„åŸç”Ÿåº”ç”¨ä¸èƒ½è¿è¡Œï¼Œæœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼Œä¸€ç§æ˜¯ç”¨Android5.0ä»¥ä¸‹çš„æ‰‹æœºè¿›è¡Œæ“ä½œï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯ç”¨IDA6.6+ç‰ˆæœ¬å³å¯ã€‚ ç„¶åæˆ‘ä»¬å†çœ‹ï¼Œè¿™é‡Œå¼€å§‹ç›‘å¬äº†è®¾å¤‡çš„23946ç«¯å£ï¼Œé‚£ä¹ˆå¦‚æœè¦æƒ³è®©IDAå’Œè¿™ä¸ªandroid_serverè¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆå¿…é¡»è®©PCç«¯çš„IDAä¹Ÿè¿ä¸Šè¿™ä¸ªç«¯å£ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦å€ŸåŠ©äºadbçš„ä¸€ä¸ªå‘½ä»¤äº†ï¼š adb forward tcp:è¿œç«¯è®¾å¤‡ç«¯å£å·(è¿›è¡Œè°ƒè¯•ç¨‹åºç«¯) tcp:æœ¬åœ°è®¾å¤‡ç«¯å£(è¢«è°ƒè¯•ç¨‹åºç«¯) é‚£ä¹ˆè¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠandroid_serverç«¯å£è½¬å‘å‡ºå»ï¼š ç„¶åè¿™æ—¶å€™ï¼Œæˆ‘ä»¬åªè¦åœ¨PCç«¯ä½¿ç”¨IDAè¿æ¥ä¸Š23946è¿™ä¸ªç«¯å£å°±å¯ä»¥äº†ï¼Œè¿™é‡Œé¢æœ‰äººå¥½å¥‡äº†ï¼Œä¸ºä»€ä¹ˆè¿œç¨‹ç«¯çš„ç«¯å£å·ä¹Ÿæ˜¯23946ï¼Œå› ä¸ºåé¢æˆ‘ä»¬åœ¨ä½¿ç”¨IDAè¿›è¡Œè¿æ¥çš„æ—¶å€™ï¼Œå‘ç°IDAä»–æŠŠè¿™ä¸ªç«¯å£è®¾ç½®æ­»äº†ï¼Œå°±æ˜¯23946ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡åŠæ³•è‡ªå®šä¹‰è¿™ä¸ªç«¯å£äº†ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨netstatå‘½ä»¤æŸ¥çœ‹ç«¯å£23946çš„ä½¿ç”¨æƒ…å†µï¼Œçœ‹åˆ°æ˜¯idaåœ¨ä½¿ç”¨è¿™ä¸ªç«¯å£ 2ã€ä¸Šé¢å°±å‡†å¤‡å¥½äº†android_serverï¼Œè¿è¡ŒæˆåŠŸï¼Œä¸‹é¢å°±æ¥ç”¨IDAè¿›è¡Œå°è¯•è¿æ¥ï¼Œè·å–ä¿¡æ¯ï¼Œè¿›è¡Œè¿›ç¨‹é™„åŠ æ³¨å…¥ æˆ‘ä»¬è¿™æ—¶å€™éœ€è¦åœ¨æ‰“å¼€ä¸€ä¸ªIDAï¼Œä¹‹å‰æ‰“å¼€ä¸€ä¸ªIDAæ˜¯ç”¨æ¥åˆ†æsoæ–‡ä»¶çš„ï¼Œä¸€èˆ¬ç”¨äºé™æ€åˆ†æï¼Œæˆ‘ä»¬è¦è°ƒè¯•soçš„è¯ï¼Œéœ€è¦åœ¨æ‰“å¼€ä¸€ä¸ªIDAæ¥è¿›è¡Œï¼Œæ‰€ä»¥è¿™é‡Œä¸€èˆ¬éƒ½æ˜¯éœ€è¦æ‰“å¼€ä¸¤ä¸ªIDAï¼Œä¹Ÿå«ä½œåŒå¼€IDAæ“ä½œã€‚åŠ¨é™ç»“åˆç­–ç•¥ã€‚ è¿™é‡Œè®°å¾—é€‰æ‹©goè¿™ä¸ªé€‰é¡¹ï¼Œå°±æ˜¯ä¸éœ€è¦æ‰“å¼€soæ–‡ä»¶äº†ï¼Œè¿›å…¥æ˜¯ä¸€ä¸ªç©ºç™½é¡µï¼š æˆ‘ä»¬é€‰æ‹©Debuggeré€‰é¡¹ï¼Œé€‰æ‹©Attachï¼Œçœ‹åˆ°æœ‰å¾ˆå¤šdebuggerï¼Œæ‰€ä»¥è¯´IDAå·¥å…·çœŸçš„å¾ˆå¼ºå¤§ï¼Œåšåˆ°å¾ˆå¤šdebuggerçš„å…¼å®¹ï¼Œå¯ä»¥è°ƒè¯•å¾ˆå¤šå¹³å°ä¸‹çš„ç¨‹åºã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©Android debuggerï¼š è¿™é‡Œçœ‹åˆ°ï¼Œç«¯å£æ˜¯å†™æ­»çš„ï¼š23946ï¼Œä¸èƒ½è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥ä¸Šé¢çš„adb forwardè¿›è¡Œç«¯å£è½¬å‘çš„æ—¶å€™å¿…é¡»æ˜¯23946ã€‚è¿™é‡ŒPCæœ¬åœ°æœºå°±æ˜¯è°ƒè¯•ç«¯ï¼Œæ‰€ä»¥hostå°±æ˜¯æœ¬æœºçš„ipåœ°å€ï¼š127.0.0.1ï¼Œç‚¹å‡»ç¡®å®šï¼š è¿™é‡Œå¯ä»¥çœ‹åˆ°è®¾å¤‡ä¸­æ‰€æœ‰çš„è¿›ç¨‹ä¿¡æ¯å°±åˆ—ä¸¾å‡ºæ¥çš„ï¼Œå…¶å®éƒ½æ˜¯android_serverå¹²çš„äº‹ï¼Œè·å–è®¾å¤‡è¿›ç¨‹ä¿¡æ¯ä¼ é€’ç»™IDAè¿›è¡Œå±•ç¤ºã€‚ æ³¨æ„ï¼š å¦‚æœæˆ‘ä»¬å½“åˆæ²¡æœ‰ç”¨rootèº«ä»½å»è¿è¡Œandroid_server: è¿™é‡Œå°±ä¼šIDAæ˜¯ä¸ä¼šåˆ—ä¸¾å‡ºè®¾å¤‡çš„è¿›ç¨‹ä¿¡æ¯ï¼š è¿˜æœ‰ä¸€ä¸ªæ³¨æ„çš„åœ°æ–¹ï¼Œå°±æ˜¯IDAå’Œandroid_serverä¸€å®šè¦ä¿æŒä¸€è‡´ã€‚ æˆ‘ä»¬è¿™é‡Œå¯ä»¥ctrl+Fæœç´¢æˆ‘ä»¬éœ€è¦è°ƒè¯•çš„è¿›ç¨‹ï¼Œå½“ç„¶è¿™é‡Œæˆ‘ä»¬å¿…é¡»è¿è¡Œèµ·æ¥æˆ‘ä»¬éœ€è¦è°ƒè¯•çš„è¿›ç¨‹ï¼Œä¸ç„¶ä¹Ÿæ˜¯æ‰¾ä¸åˆ°è¿™ä¸ªè¿›ç¨‹çš„ åŒå‡»è¿›ç¨‹ï¼Œå³å¯è¿›å…¥è°ƒè¯•é¡µé¢ï¼š è¿™é‡Œä¸ºä»€ä¹ˆä¼šæ–­åœ¨libc.soä¸­å‘¢ï¼Ÿ androidç³»ç»Ÿä¸­libcæ˜¯cå±‚ä¸­æœ€åŸºæœ¬çš„å‡½æ•°åº“ï¼Œlibcä¸­å°è£…äº†ioã€æ–‡ä»¶ã€socketç­‰åŸºæœ¬ç³»ç»Ÿè°ƒç”¨ã€‚æ‰€æœ‰ä¸Šå±‚çš„è°ƒç”¨éƒ½éœ€è¦ç»è¿‡libcå°è£…å±‚ã€‚æ‰€ä»¥libc.soæ˜¯æœ€åŸºæœ¬çš„ï¼Œæ‰€ä»¥ä¼šæ–­åœ¨è¿™é‡Œï¼Œè€Œä¸”æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ä¸€äº›å¸¸ç”¨çš„ç³»ç»Ÿso,æ¯”å¦‚linkerï¼š æˆ‘ä»¬çŸ¥é“ï¼Œè¿™ä¸ªlinkeræ˜¯ç”¨äºåŠ è½½soæ–‡ä»¶çš„æ¨¡å—ï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬åœ¨åˆ†æå¦‚ä½•åœ¨.init_arrayå¤„ä¸‹æ–­ç‚¹ è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯libdvm.soæ–‡ä»¶ï¼Œä»–åŒ…å«äº†DVMä¸­æ‰€æœ‰çš„åº•å±‚åŠ è½½dexçš„ä¸€äº›æ–¹æ³•ï¼š æˆ‘ä»¬åœ¨åé¢åŠ¨æ€è°ƒè¯•éœ€è¦dumpå‡ºåŠ å¯†ä¹‹åçš„dexæ–‡ä»¶ï¼Œå°±éœ€è¦è°ƒè¯•è¿™ä¸ªsoæ–‡ä»¶äº†ã€‚ 3ã€æ‰¾åˆ°å‡½æ•°åœ°å€ï¼Œä¸‹æ–­ç‚¹ï¼Œå¼€å§‹è°ƒè¯• æˆ‘ä»¬ä½¿ç”¨Ctrl+Sæ‰¾åˆ°éœ€è¦è°ƒè¯•soçš„åŸºåœ°å€ï¼š74FE4000 ç„¶åé€šè¿‡å¦å¤–ä¸€ä¸ªIDAæ‰“å¼€soæ–‡ä»¶ï¼ŒæŸ¥çœ‹å‡½æ•°çš„ç›¸å¯¹åœ°å€ï¼šE9C é‚£ä¹ˆå¾—åˆ°äº†å‡½æ•°çš„ç»å¯¹åœ°å€å°±æ˜¯ï¼š74FE4E9Cï¼Œä½¿ç”¨Gé”®å¿«é€Ÿè·³è½¬åˆ°è¿™ä¸ªç»å¯¹åœ°å€ï¼š è·³è½¬åˆ°æŒ‡å®šåœ°å€ä¹‹åï¼Œå¼€å§‹ä¸‹æ–­ç‚¹ï¼Œç‚¹å‡»æœ€å·¦è¾¹çš„ç»¿è‰²åœ†ç‚¹å³å¯ä¸‹æ–­ç‚¹ï¼š ç„¶åç‚¹å‡»å·¦ä¸Šè§’çš„ç»¿è‰²æŒ‰é’®ï¼Œè¿è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨F9é”®è¿è¡Œç¨‹åºï¼š æˆ‘ä»¬ç‚¹å‡»ç¨‹åºä¸­çš„æŒ‰é’®ï¼š è§¦å‘nativeå‡½æ•°çš„è¿è¡Œï¼š çœ‹åˆ°äº†ï¼Œè¿›å…¥è°ƒè¯•é˜¶æ®µäº†ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨F8è¿›è¡Œå•æ­¥è°ƒè¯•ï¼ŒF7è¿›è¡Œå•æ­¥è¿›å…¥è°ƒè¯•ï¼š æˆ‘ä»¬ç‚¹å‡»F8è¿›è¡Œå•æ­¥è°ƒè¯•ï¼Œè¾¾åˆ°is_numberå‡½æ•°è°ƒç”¨å‡ºï¼Œçœ‹åˆ°R0æ˜¯å‡ºå…¥çš„å‚æ•°å€¼ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹R0å¯„å­˜å™¨çš„å†…å®¹ï¼Œç„¶åçœ‹åˆ°æ˜¯123456ï¼Œè¿™ä¸ªå°±æ˜¯Javaå±‚ä¼ å…¥çš„å¯†ç å­—ç¬¦ä¸²ï¼Œæ¥ç€å¾€ä¸‹èµ°ï¼š è¿™é‡ŒæŠŠis_numberå‡½æ•°è¿”å›å€¼ä¿å­˜åˆ°R0å¯„å­˜ä¸­ï¼Œç„¶åè°ƒç”¨CBZæŒ‡ä»¤ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0å°±è·³è½¬åˆ°locret_74FE4EECå¤„ï¼ŒæŸ¥çœ‹R0å¯„å­˜å™¨çš„å€¼ä¸æ˜¯0ï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼š çœ‹åˆ°äº†get_encrypt_strå‡½æ•°çš„è°ƒç”¨ï¼Œå‡½æ•°çš„è¿”å›å€¼ä¿å­˜åœ¨R1å¯„å­˜å™¨ä¸­ï¼ŒæŸ¥çœ‹å†…å®¹ï¼šzytyrTRABäº†ï¼Œé‚£ä¹ˆçœ‹åˆ°ï¼Œä¸Šå±‚ä¼ é€’çš„ï¼š123456=ã€‹zytyrTRABäº†ï¼Œå‰é¢æˆ‘ä»¬é™æ€åˆ†æäº†get_encrypt_strå‡½æ•°çš„é€»è¾‘ï¼Œç»§ç»­å¾€ä¸‹çœ‹ï¼š çœ‹åˆ°äº†ï¼Œè¿™é‡ŒæŠŠä¸Šé¢å¾—åˆ°çš„å­—ç¬¦ä¸²å’ŒssBCqpBssPä½œæ¯”è¾ƒï¼Œé‚£ä¹ˆè¿™é‡ŒssBCqpBssPå°±æ˜¯æ­£ç¡®çš„åŠ å¯†å¯†ç äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨çš„èµ„æºæ˜¯ï¼š æ­£ç¡®çš„åŠ å¯†å¯†ç ï¼šssBCqpBssPï¼ŒåŠ å¯†å¯†é’¥åº“ï¼šzytyrTRA*BniqCPpVsï¼ŒåŠ å¯†é€»è¾‘get_encrypt_str é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªé€†å‘çš„åŠ å¯†æ–¹æ³•ï¼Œå»è§£ææ­£ç¡®çš„åŠ å¯†å¯†ç å¾—åˆ°å€¼å³å¯ï¼Œè¿™é‡Œä¸ºäº†ç»™å¤§å®¶ä¸€ä¸ªç ´è§£çš„æœºä¼šï¼Œè¿™é‡Œå°±ä¸å…¬å¸ƒæ­£ç¡®ç­”æ¡ˆäº†ï¼Œè¿™ä¸ªapkæˆ‘éšåä¼šä¸Šä¼ ï¼Œæ‰‹ç—’çš„åŒå­¦å¯ä»¥å°è¯•ç ´è§£ä¸€ä¸‹ã€‚ ç¬¬ä¸‰ã€æ€»ç»“IDAè°ƒè¯•çš„æµç¨‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±åˆ†æäº†å¦‚ä½•ç ´è§£apkçš„æµç¨‹ï¼Œä¸‹é¢æ¥æ€»ç»“ä¸€ä¸‹ï¼š 1ã€æˆ‘ä»¬é€šè¿‡è§£å‹apkæ–‡ä»¶ï¼Œå¾—åˆ°å¯¹åº”çš„soæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨IDAå·¥å…·æ‰“å¼€so,æ‰¾åˆ°æŒ‡å®šçš„nativeå±‚å‡½æ•° 2ã€é€šè¿‡IDAä¸­çš„ä¸€äº›å¿«æ·é”®ï¼šF5,Ctrl+S,Yç­‰é”®æ¥é™æ€åˆ†æå‡½æ•°çš„armæŒ‡ä»¤ï¼Œå¤§è‡´äº†è§£å‡½æ•°çš„æ‰§è¡Œæµç¨‹ 3ã€å†æ¬¡æ‰“å¼€ä¸€ä¸ªIDAæ¥è¿›è¡Œè°ƒè¯•so 1&gt;å°†IDAç›®å½•ä¸­çš„android_serveræ‹·è´åˆ°è®¾å¤‡çš„æŒ‡å®šç›®å½•ä¸‹ï¼Œä¿®æ”¹android_serverçš„è¿è¡Œæƒé™ï¼Œç”¨Rootèº«ä»½è¿è¡Œandroid_server 2&gt;ä½¿ç”¨adb forwardè¿›è¡Œç«¯å£è½¬å‘ï¼Œè®©è¿œç¨‹è°ƒè¯•ç«¯IDAå¯ä»¥è¿æ¥åˆ°è¢«è°ƒè¯•ç«¯ 3&gt;ä½¿ç”¨IDAè¿æ¥ä¸Šè½¬å‘çš„ç«¯å£ï¼ŒæŸ¥çœ‹è®¾å¤‡çš„æ‰€æœ‰è¿›ç¨‹ï¼Œæ‰¾åˆ°æˆ‘ä»¬éœ€è¦è°ƒè¯•çš„è¿›ç¨‹ã€‚ 4&gt;é€šè¿‡æ‰“å¼€soæ–‡ä»¶ï¼Œæ‰¾åˆ°éœ€è¦è°ƒè¯•çš„å‡½æ•°çš„ç›¸å¯¹åœ°å€ï¼Œç„¶ååœ¨è°ƒè¯•é¡µé¢ä½¿ç”¨Ctrl+Sæ‰¾åˆ°soæ–‡ä»¶çš„åŸºåœ°å€ï¼Œç›¸åŠ ä¹‹åå¾—åˆ°ç»å¯¹åœ°å€ï¼Œä½¿ç”¨Gé”®ï¼Œè·³è½¬åˆ°å‡½æ•°çš„åœ°å€å¤„ï¼Œä¸‹å¥½æ–­ç‚¹ã€‚ç‚¹å‡»è¿è¡Œæˆ–è€…F9é”®ã€‚ 5&gt;è§¦å‘nativeå±‚çš„å‡½æ•°ï¼Œä½¿ç”¨F8å’ŒF7è¿›è¡Œå•æ­¥è°ƒè¯•ï¼ŒæŸ¥çœ‹å…³é”®çš„å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œæ¯”å¦‚å‡½æ•°çš„å‚æ•°ï¼Œå’Œå‡½æ•°çš„è¿”å›å€¼ç­‰ä¿¡æ¯ æ€»ç»“å°±æ˜¯ï¼šåœ¨è°ƒè¯•soçš„æ—¶å€™ï¼Œéœ€è¦åŒå¼€IDAï¼ŒåŠ¨é™ç»“åˆåˆ†æã€‚ å››ã€ä½¿ç”¨IDAæ¥è§£å†³åè°ƒè¯•é—®é¢˜é‚£ä¹ˆåˆ°è¿™é‡Œæˆ‘ä»¬å°±ç»“æŸäº†æˆ‘ä»¬è¿™æœŸçš„ç ´è§£æ—…ç¨‹äº†ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸ºæˆ‘ä»¬çœ‹åˆ°ä¸Šé¢çš„ä¾‹å­å…¶å®æ˜¯æˆ‘è‡ªå·±å…ˆå†™äº†ä¸€ä¸ªapk,ç›®çš„å°±æ˜¯ä¸ºäº†ç»™å¤§å®¶æ¼”ç¤ºï¼Œå¦‚ä½•ä½¿ç”¨IDAæ¥è¿›è¡ŒåŠ¨æ€è°ƒè¯•soï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæ“åˆ€åŠ¨æ‰‹çš„æ¡ˆä¾‹ï¼Œå°±æ˜¯2014å¹´ï¼Œé˜¿é‡Œå®‰å…¨æŒ‘æˆ˜èµ›çš„ç¬¬äºŒé¢˜ï¼šAliCrackme_2ï¼š é˜¿é‡ŒçœŸä¼šåˆ¶é€ æ°›å›´ï¼Œè¿˜è®°å¾—æˆ‘ä»¬ç ´è§£çš„ç¬¬ä¸€é¢˜å—ï¼Œè¿™æ¬¡çœ‹åˆ°äº†ç¬¬äºŒé¢˜ï¼Œå¥½å§ï¼Œä¸‹é¢æ¥çœ‹çœ‹ç ´è§£æµç¨‹å§ï¼š é¦–å…ˆä½¿ç”¨aaptå‘½ä»¤æŸ¥çœ‹ä»–çš„AndroidManifest.xmlæ–‡ä»¶ï¼Œå¾—åˆ°å…¥å£çš„Activityç±»ï¼š ç„¶åä½¿ç”¨dex2jarå’Œjd-guiæŸ¥çœ‹ä»–çš„æºç ç±»ï¼šcom.yaotong.crackme.MainActivityï¼š çœ‹åˆ°ï¼Œä»–çš„åˆ¤æ–­ï¼Œæ˜¯securityCheckæ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªnativeå±‚çš„ï¼Œæ‰€ä»¥è¿™æ—¶å€™æˆ‘ä»¬å»è§£å‹apkæ–‡ä»¶ï¼Œè·å–ä»–çš„soæ–‡ä»¶ï¼Œä½¿ç”¨IDAæ‰“å¼€æŸ¥çœ‹nativeå‡½æ•°çš„ç›¸å¯¹åœ°å€ï¼š11A8 è¿™é‡Œçš„ARMæŒ‡ä»¤ä»£ç ä¸åœ¨åˆ†æäº†ï¼Œå¤§å®¶è‡ªè¡ŒæŸ¥çœ‹å³å¯ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥è°ƒè¯•å³å¯ï¼š åœ¨æ‰“å¼€ä¸€ä¸ªIDAè¿›è¡Œå…³è”è°ƒè¯•ï¼š é€‰æ‹©å¯¹åº”çš„è°ƒè¯•è¿›ç¨‹ï¼Œç„¶åç¡®å®šï¼š ä½¿ç”¨Ctrl+Sé”®æ‰¾åˆ°å¯¹åº”soæ–‡ä»¶çš„åŸºåœ°å€ï¼š74EA9000 å’Œä¸Šé¢å¾—åˆ°çš„ç›¸å¯¹åœ°å€ç›¸åŠ å¾—åˆ°ç»å¯¹åœ°å€ï¼š74EA9000+11A8=74EAA1A8 ä½¿ç”¨Gé”®ç›´æ¥è·³åˆ°è¿™ä¸ªåœ°å€ï¼š ä¸‹ä¸ªæ–­ç‚¹ï¼Œç„¶åç‚¹å‡»F9è¿è¡Œç¨‹åºï¼š æ“¦ï¼ŒIDAé€€å‡ºè°ƒè¯•é¡µé¢äº†ï¼Œæˆ‘ä»¬å†æ¬¡è¿›å…¥è°ƒè¯•é¡µé¢ï¼Œè¿è¡Œï¼Œè¿˜æ˜¯é€€å‡ºè°ƒè¯•é¡µé¢äº†ï¼Œå¥½äº†ï¼Œè¿™ä¸‹è›‹ç–¼äº†ï¼Œæ²¡æ³•è°ƒè¯•äº†ã€‚ è¿™é‡Œå…¶å®æ˜¯é˜¿é‡Œåšäº†åè°ƒè¯•ä¾¦æŸ¥ï¼Œå¦‚æœå‘ç°è‡ªå·±çš„ç¨‹åºè¢«è°ƒè¯•äº†ï¼Œå°±ç›´æ¥é€€å‡ºç¨‹åºï¼Œé‚£ä¹ˆè¿™é‡Œæœ‰é—®é¢˜äº†ï¼Œä¸ºä»€ä¹ˆçŸ¥é“æ˜¯åè°ƒè¯•å‘¢ï¼Ÿè¿™ä¸ªä¸»è¦è¿˜æ˜¯çœ‹åç»­è‡ªå·±çš„ç ´è§£ç»éªŒäº†ï¼Œæ²¡æŠ€æœ¯å¯è¨€ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯é˜¿é‡Œå¦‚ä½•åšåˆ°çš„åè°ƒè¯•ç­–ç•¥çš„ï¼Œè¿™é‡Œé™äºç¯‡å¹…ï¼Œåªæ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹åŸç†ï¼š å‰é¢è¯´åˆ°ï¼ŒIDAæ˜¯ä½¿ç”¨android_serveråœ¨rootç¯å¢ƒä¸‹æ³¨å…¥åˆ°è¢«è°ƒè¯•çš„è¿›ç¨‹ä¸­ï¼Œé‚£ä¹ˆè¿™é‡Œç”¨åˆ°ä¸€ä¸ªæŠ€æœ¯å°±æ˜¯Linuxä¸­çš„ptraceï¼Œå…³äºè¿™ä¸ªè¿™é‡Œä¹Ÿä¸è§£é‡Šäº†ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œçš„å»æœä¸€ä¸‹ptraceçš„ç›¸å…³çŸ¥è¯†ï¼Œé‚£ä¹ˆAndroidä¸­å¦‚æœä¸€ä¸ªè¿›ç¨‹è¢«å¦å¤–ä¸€ä¸ªè¿›ç¨‹ptraceäº†ä¹‹åï¼Œåœ¨ä»–çš„statusæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå­—æ®µï¼šTracerPid å¯ä»¥æ ‡è¯†æ˜¯è¢«å“ªä¸ªè¿›ç¨‹traceäº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æˆ‘ä»¬çš„è¢«è°ƒè¯•çš„è¿›è¡Œä¿¡æ¯ï¼š**statusæ–‡ä»¶åœ¨ï¼š/proc/[pid]/status** çœ‹åˆ°äº†ï¼Œè¿™é‡Œçš„è¿›ç¨‹è¢«9187è¿›ç¨‹traceäº†ï¼Œæˆ‘ä»¬åœ¨ç”¨pså‘½ä»¤çœ‹çœ‹9187æ˜¯å“ªä¸ªè¿›ç¨‹ï¼š æœä¸å…¶ç„¶ï¼Œæ˜¯æˆ‘ä»¬çš„android_serverè¿›ç¨‹ï¼Œå¥½äº†ï¼Œæˆ‘ä»¬çŸ¥é“åŸç†äº†ï¼Œä¹Ÿå¤§è‡´çŒœåˆ°äº†é˜¿é‡Œåœ¨åº•å±‚åšäº†ä¸€ä¸ªå¾ªç¯æ£€æµ‹è¿™ä¸ªå­—æ®µå¦‚æœä¸ä¸º0ï¼Œé‚£ä¹ˆä»£è¡¨è‡ªå·±è¿›ç¨‹åœ¨è¢«äººtraceï¼Œé‚£ä¹ˆå°±ç›´æ¥åœæ­¢é€€å‡ºç¨‹åºï¼Œè¿™ä¸ªåæ£€æµ‹æŠ€æœ¯ç”¨åœ¨å¾ˆå¤šå®‰å…¨é˜²æŠ¤çš„åœ°æ–¹ï¼Œä¹Ÿç®—æ˜¯ä¸€ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹äº†ã€‚ é‚£ä¹ˆä¸‹é¢å°±æ¥çœ‹çœ‹å¦‚ä½•åº”å¯¹è¿™ä¸ªåè°ƒè¯•ï¼Ÿ æˆ‘ä»¬åˆšåˆšçœ‹åˆ°ï¼Œåªè¦ä¸€è¿è¡Œç¨‹åºï¼Œå°±é€€å‡ºäº†è°ƒè¯•ç•Œé¢ï¼Œè¯´æ˜ï¼Œè¿™ä¸ªå¾ªç¯æ£€æµ‹ç¨‹åºæ‰§è¡Œçš„æ—¶æœºéå¸¸æ—©ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨çŸ¥é“çš„æœ€æ—©çš„ä¸¤ä¸ªæ—¶æœºæ˜¯ï¼šä¸€ä¸ªæ˜¯.init_arrayï¼Œä¸€ä¸ªæ˜¯JNI_OnLoad .init_arrayæ˜¯ä¸€ä¸ªsoæœ€å…ˆåŠ è½½çš„ä¸€ä¸ªæ®µä¿¡æ¯ï¼Œæ—¶æœºæœ€æ—©ï¼Œç°åœ¨ä¸€èˆ¬soè§£å¯†æ“ä½œéƒ½æ˜¯åœ¨è¿™é‡Œåšçš„ JNI_OnLoadæ˜¯soè¢«System.loadLibraryè°ƒç”¨çš„æ—¶å€™æ‰§è¡Œï¼Œä»–çš„æ—¶æœºè¦æ—©äºå“ªäº›nativeæ–¹æ³•æ‰§è¡Œï¼Œä½†æ˜¯æ²¡æœ‰.init_arrayæ—¶æœºæ—© é‚£ä¹ˆçŸ¥é“äº†è¿™ä¸¤ä¸ªæ—¶æœºï¼Œä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ˜¯ä¸æ˜¯åœ¨JNI_OnLoadå‡½æ•°ä¸­åšçš„ç­–ç•¥ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆåŠ¨æ€è°ƒè¯•JNI_OnLoadå‡½æ•° æˆ‘ä»¬æ—¢ç„¶çŸ¥é“äº†JNI_OnLoadå‡½æ•°çš„æ—¶æœºï¼Œå¦‚æœé˜¿é‡ŒæŠŠæ£€æµ‹å‡½æ•°æ”¾åœ¨è¿™é‡Œçš„è¯ï¼Œæˆ‘ä»¬ä¸èƒ½ç”¨ä¹‹å‰çš„æ–¹å¼å»è°ƒè¯•äº†ï¼Œå› ä¸ºä¹‹å‰çš„é‚£ç§æ–¹å¼æ—¶æœºå¤ªæ™šäº†ï¼Œåªè¦è¿è¡Œå°±å·²ç»æ‰§è¡Œäº†JNI_OnLoadå‡½æ•°ï¼Œæ‰€ä»¥å°±ä¼šé€€å‡ºè°ƒè¯•é¡µé¢ å¹¸å¥½è¿™é‡ŒIDAæä¾›äº†åœ¨soæ–‡ä»¶loadçš„æ—¶æœºï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨Debug Optionä¸­è®¾ç½®ä¸€ä¸‹å°±å¯ä»¥äº†ï¼š åœ¨è°ƒè¯•é¡µé¢çš„Debugger é€‰æ‹© Debugger Optioné€‰é¡¹ï¼š ç„¶åå‹¾é€‰Suspend on library load/unloadå³å¯ è¿™æ ·è®¾ç½®ä¹‹åï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œå› ä¸ºæˆ‘ä»¬ç¨‹åºå·²ç»å¼€å§‹è¿è¡Œï¼Œå°±åœ¨staticä»£ç å—ä¸­åŠ è½½soæ–‡ä»¶äº†ï¼Œstaticçš„æ—¶æœºéå¸¸æ—©ï¼Œæ‰€ä»¥è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è®©ç¨‹åºåœåœ¨åŠ è½½soæ–‡ä»¶ä¹‹å‰å³å¯ã€‚ é‚£ä¹ˆæˆ‘æƒ³åˆ°çš„å°±æ˜¯æ·»åŠ ä»£ç waitForDebuggerä»£ç äº†ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ç­‰å¾…debugï¼Œæˆ‘ä»¬è¿˜è®°å¾—åœ¨ä¹‹å‰çš„è°ƒè¯•smaliä»£ç çš„æ—¶å€™ï¼Œå°±æ˜¯ç”¨è¿™ç§æ–¹å¼è®©ç¨‹åºåœåœ¨äº†å¯åŠ¨å‡ºï¼Œç„¶åç­‰å¾…æˆ‘ä»¬å»ç”¨jdbè¿›è¡Œattachæ“ä½œã€‚ é‚£ä¹ˆè¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥åœ¨System.loadLibraryæ–¹æ³•ä¹‹å‰åŠ å…¥waitForDebuggerä»£ç å³å¯ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä¸è¿™ä¹ˆå¹²äº†ï¼Œè¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹å¼å°±æ˜¯ç”¨amå‘½ä»¤ï¼Œæœ¬èº«amå‘½ä»¤å¯ä»¥å¯åŠ¨ä¸€ä¸ªç¨‹åºï¼Œå½“ç„¶å¯ä»¥ç”¨debugæ–¹å¼å¯åŠ¨ï¼š adb shell am start -D -n com.yaotong.crackme/.MainActivity è¿™é‡Œä¸€ä¸ªé‡è¦å‚æ•°å°±æ˜¯-D,ç”¨debugæ–¹å¼å¯åŠ¨ è¿è¡Œå®Œä¹‹åï¼Œè®¾å¤‡æ˜¯å‡ºäºä¸€ä¸ªç­‰å¾…Debuggerçš„çŠ¶æ€ï¼š è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨IDAè¿›è¡Œè¿›ç¨‹çš„é™„åŠ ï¼Œç„¶åè¿›å…¥è°ƒè¯•é¡µé¢ï¼ŒåŒæ—¶è®¾ç½®ä¸€ä¸‹Debugger Optioné€‰é¡¹ï¼Œç„¶åå®šä½åˆ°JNI_OnLoadå‡½æ•°çš„ç»å¯¹åœ°å€ã€‚ ä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œæ²¡æœ‰RXæƒé™çš„soæ–‡ä»¶ï¼Œè¯´æ˜soæ–‡ä»¶æ²¡æœ‰åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæƒ³ä¸€æƒ³è¿˜æ˜¯å¯¹çš„ï¼Œä»¥ä¸ºæˆ‘ä»¬ç°åœ¨çš„ç¨‹åºæ˜¯wait Debuggerï¼Œä¹Ÿå°±æ˜¯è¿˜æ²¡æœ‰èµ°System.loadLibraryæ–¹æ³•ï¼Œsoæ–‡ä»¶å½“ç„¶æ²¡æœ‰åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©æˆ‘ä»¬ç¨‹åºè·‘èµ·æ¥ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨jdbå‘½ä»¤å»attachç­‰å¾…çš„ç¨‹åºï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š jdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=8700 å…¶å®è¿™æ¡å‘½ä»¤çš„åŠŸèƒ½ç±»ä¼¼äºï¼Œæˆ‘ä»¬å‰ä¸€ç¯‡è¯´åˆ°ç”¨Eclipseè°ƒè¯•smaliæºç çš„æ—¶å€™ï¼Œåœ¨Eclipseä¸­è®¾ç½®è¿œç¨‹è°ƒè¯•å·¥ç¨‹ä¸€æ ·ï¼Œé€‰æ‹©Attachæ–¹å¼ï¼Œè°ƒè¯•æœºçš„ipåœ°å€å’Œç«¯å£ï¼Œè¿˜è®°å¾—8700ç«¯å£æ˜¯é»˜è®¤çš„ç«¯å£ï¼Œä½†æ˜¯æˆ‘ä»¬è¿è¡Œè¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œå‡ºç°äº†ä¸€ä¸ªé”™è¯¯ï¼š æ“¦ï¼Œæ— æ³•è¿æ¥åˆ°ç›®æ ‡çš„VMï¼Œé‚£ä¹ˆè¿™ç§é—®é¢˜å¤§éƒ¨åˆ†éƒ½å‡ºç°åœ¨è¢«è°ƒè¯•ç¨‹åºä¸å¯è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹apkçš„android:debuggableå±æ€§ï¼š æœä¸å…¶ç„¶ï¼Œè¿™é‡Œæ²¡æœ‰debugå±æ€§ï¼Œæ‰€ä»¥è¿™ä¸ªapkæ˜¯ä¸å¯ä»¥è°ƒè¯•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ è¿™ä¸ªå±æ€§ï¼Œç„¶ååœ¨å›ç¼–è¯‘å³å¯ï¼š å›ç¼–è¯‘ï¼šjava -jar apktool.jar b -d out -o debug.apk ç­¾åapkï¼šjava -jar .\sign\signapk.jar .\sign\testkey.x509.pem .\sign\testkey.pk8 debug.apk debug.sig.apk ç„¶ååœ¨æ¬¡å®‰è£…ï¼Œä½¿ç”¨am å‘½ä»¤å¯åŠ¨ï¼š ç¬¬ä¸€æ­¥ï¼šè¿è¡Œï¼šadb shell am start -D -n com.yaotong.crackme/.MainActivity å‡ºç°Debuggerçš„ç­‰å¾…çŠ¶æ€ ç¬¬äºŒæ­¥ï¼šå¯åŠ¨IDA è¿›è¡Œç›®æ ‡è¿›ç¨‹çš„Attachæ“ä½œ ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œï¼šjdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=8700 ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®Debugger Optioné€‰é¡¹ ç¬¬å››æ­¥ï¼šç‚¹å‡»IDAè¿è¡ŒæŒ‰é’®ï¼Œæˆ–è€…F9å¿«æ·é”®ï¼Œè¿è¡Œ çœ‹åˆ°äº†ï¼Œè¿™æ¬¡jdbæˆåŠŸçš„attachä½äº†ï¼Œdebugæ¶ˆå¤±ï¼Œæ­£å¸¸è¿è¡Œäº†ï¼Œ ä½†æ˜¯åŒæ—¶å¼¹å‡ºäº†ä¸€ä¸ªé€‰æ‹©æç¤ºï¼š è¿™æ—¶å€™ï¼Œä¸ç”¨ç®¡å®ƒï¼Œå…¨éƒ¨é€‰æ‹©å–æ¶ˆæŒ‰é’®ï¼Œç„¶åå°±è¿è¡Œåˆ°äº†linkeræ¨¡å—äº†ï¼š è¿™æ—¶å€™ï¼Œè¯´æ˜soå·²ç»åŠ è½½è¿›æ¥äº†ï¼Œæˆ‘ä»¬å†å»è·å–JNI_OnLoadå‡½æ•°çš„ç»å¯¹åœ°å€ Ctrl+SæŸ¥æ‰¾åˆ°äº†åŸºåœ°å€ï¼š7515A000 ç”¨é™æ€æ–¹å¼IDAæ‰“å¼€soæŸ¥çœ‹ç›¸å¯¹åœ°å€ï¼š1B9C ç›¸åŠ å¾—åˆ°ç»å¯¹åœ°å€ï¼š7515A000+1B9C=7515BB9Cï¼Œç„¶åç‚¹å‡»Sé”®ï¼Œè·³è½¬ï¼š è·³è½¬åˆ°æŒ‡å®šçš„å‡½æ•°ä½ç½®ï¼š è¿™æ—¶å€™å†æ¬¡ç‚¹å‡»è¿è¡Œï¼Œè¿›å…¥äº†JNI_OnLoadå¤„çš„æ–­ç‚¹ï¼š ä¸‹é¢å’‹ä»¬å°±å¼€å§‹å•æ­¥è°ƒè¯•äº†ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ¯æ¬¡åˆ°è¾¾BLX R7è¿™æ¡æŒ‡ä»¤æ‰§è¡Œå®Œä¹‹åï¼Œå°±JNI_OnLoadå°±é€€å‡ºäº†ï¼š ç»è¿‡å¥½å‡ æ¬¡å°è¯•éƒ½æ˜¯ä¸€æ ·çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬å‘ç°è¿™ä¸ªåœ°æ–¹æœ‰é—®é¢˜ï¼Œå¯èƒ½å°±æ˜¯åè°ƒè¯•çš„åœ°æ–¹äº† æˆ‘ä»¬å†æ¬¡è¿›å…¥è°ƒè¯•ï¼Œçœ‹è§BLXè·³è½¬çš„åœ°æ–¹R7å¯„å­˜å™¨ä¸­æ˜¯pthread_createå‡½æ•°ï¼Œè¿™ä¸ªæ˜¯Linuxä¸­æ–°å»ºä¸€ä¸ªçº¿ç¨‹çš„æ–¹æ³• æ‰€ä»¥é˜¿é‡Œçš„åè°ƒè¯•å°±åœ¨è¿™é‡Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œè½®è®­æ“ä½œï¼Œå»è¯»å–/proc/[pid]/statusæ–‡ä»¶ä¸­çš„TrackerPidå­—æ®µå€¼ï¼Œå¦‚æœå‘ç°ä¸ä¸º0ï¼Œå°±è¡¨ç¤ºæœ‰äººåœ¨è°ƒè¯•æœ¬åº”ç”¨ï¼Œåœ¨JNI_OnLoadä¸­ç›´æ¥é€€å‡ºã€‚å…¶å®è¿™é‡Œå¯ä»¥å†è¯¦ç»†è¿›å…¥æŸ¥çœ‹å…·ä½“ä»£ç å®ç°çš„ï¼Œä½†æ˜¯è¿™é‡Œé™äºç¯‡å¹…é—®é¢˜ï¼Œä¸è¯¦ç»†è§£é‡Šäº†ï¼Œåç»­åœ¨å†™ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬è‡ªå·±å¯ä»¥å®ç°è¿™ç§åè°ƒè¯•æœºåˆ¶çš„ã€‚æœ¬æ–‡çš„é‡ç‚¹æ˜¯èƒ½å¤ŸåŠ¨æ€è°ƒè¯•å³å¯ã€‚ é‚£ä¹ˆé—®é¢˜æ‰¾åˆ°äº†ï¼Œæˆ‘ä»¬ç°åœ¨æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªè¦æŠŠBLX R7è¿™æ®µæŒ‡ä»¤å¹²æ‰å³å¯ï¼Œå¦‚æœæ˜¯smaliä»£ç çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ é™¤è¿™è¡Œä»£ç å³å¯ï¼Œä½†æ˜¯soæ–‡ä»¶ä¸ä¸€æ ·ï¼Œä»–æ˜¯æ±‡ç¼–æŒ‡ä»¤ï¼Œå¦‚æœç›´æ¥åˆ é™¤è¿™æ¡æŒ‡ä»¤çš„è¯ï¼Œæ–‡ä»¶ä¼šå‘ç”Ÿé”™ä¹±ï¼Œå› ä¸ºæœ¬èº«soæ–‡ä»¶å°±æœ‰å›ºå®šçš„æ ¼å¼ï¼Œæ¯”å¦‚å¾ˆå¤šSegementçš„å†…å®¹ï¼Œæ¯ä¸ªSegementçš„åç§»å€¼ä¹Ÿæ˜¯æœ‰ä¿å­˜çš„ï¼Œå¦‚æœè¿™æ ·å»åˆ é™¤ä¼šå½±å“è¿™äº›åç§»å€¼ï¼Œä¼šç ´åsoæ–‡ä»¶æ ¼å¼ï¼Œå¯¼è‡´soåŠ è½½å‡ºé”™çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸èƒ½æ‰‹åŠ¨çš„å»åˆ é™¤è¿™æ¡æŒ‡ä»¤ï¼Œæˆ‘ä»¬è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯æŠŠè¿™æ¡æŒ‡ä»¤å˜æˆç©ºæŒ‡ä»¤ï¼Œåœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼ŒnopæŒ‡ä»¤å°±æ˜¯ä¸€ä¸ªç©ºæŒ‡ä»¤ï¼Œä»–ä»€ä¹ˆéƒ½ä¸å¹²ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥æ”¹ä¸€ä¸‹æŒ‡ä»¤å³å¯ï¼Œarmä¸­å¯¹åº”çš„nopæŒ‡ä»¤æ˜¯ï¼š00 00 00 00 é‚£ä¹ˆæˆ‘ä»¬çœ‹åˆ°BLX R7å¯¹åº”çš„æŒ‡ä»¤ä½ç½®ä¸ºï¼š1C58 æŸ¥çœ‹ä»–çš„Hexå†…å®¹æ˜¯ï¼š37 FF 2F E1 æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶è½¯ä»¶è¿›è¡Œå†…å®¹çš„ä¿®æ”¹ï¼Œè¿™é‡Œä½¿ç”¨010Editorå·¥å…·è¿›è¡Œä¿®æ”¹ï¼š è¿™é‡Œç›´æ¥ä¿®æ”¹æˆ00 00 00 00ï¼š è¿™æ—¶å€™ï¼Œä¿å­˜ä¿®æ”¹ä¹‹åçš„soæ–‡ä»¶ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨IDAè¿›è¡Œæ‰“å¼€æŸ¥çœ‹ï¼š å“ˆå“ˆï¼ŒæŒ‡ä»¤è¢«ä¿®æ”¹æˆäº†ï¼šANDEQ R0ï¼ŒR0ï¼ŒR0äº† é‚£ä¹ˆä¿®æ”¹äº†ä¹‹åï¼Œæˆ‘ä»¬åœ¨æ›¿æ¢åŸæ¥çš„soæ–‡ä»¶ï¼Œå†æ¬¡é‡æ–°å›ç¼–è¯‘ï¼Œç­¾åå®‰è£…ï¼Œå†æ¬¡æŒ‰ç…§ä¹‹å‰çš„é€»è¾‘ç»™ä¸»è¦çš„åŠ å¯†å‡½æ•°ä¸‹æ–­ç‚¹ï¼Œè¿™é‡Œä¸éœ€è¦åœ¨ç»™JNI_OnLoadå‡½æ•°ä¸‹æ–­ç‚¹äº†ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ä¿®æ”¹äº†åè°ƒè¯•åŠŸèƒ½äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§è¿™ä¹ˆç®€å•å‡ æ­¥å³å¯ï¼š ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨ç¨‹åº ç¬¬äºŒæ­¥ï¼šä½¿ç”¨IDAè¿›è¡Œè¿›ç¨‹çš„attach ç¬¬ä¸‰æ­¥ï¼šæ‰¾åˆ°Java_com_yaotong_crackme_MainActivity_securityCheckå‡½æ•°çš„ç»å¯¹åœ°å€ ç¬¬å››æ­¥ï¼šæ‰“ä¸Šæ–­ç‚¹ï¼Œç‚¹å‡»è¿è¡Œï¼Œè¿›è¡Œå•æ­¥è°ƒè¯• çœ‹åˆ°äº†å§ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å•æ­¥è°ƒè¯•è¿›æ¥äº†å•¦å•¦ï¼Œè¯´æ˜æˆ‘ä»¬ä¿®æ”¹åè°ƒè¯•æŒ‡ä»¤æˆåŠŸäº†ã€‚ ä¸‹é¢å°±ç»§ç»­F8å•æ­¥è°ƒè¯•ï¼š è°ƒè¯•åˆ°è¿™é‡Œï¼Œå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯CMPæŒ‡ä»¤ä¹‹åï¼ŒBNE æŒ‡ä»¤å°±å¼€å§‹è·³è½¬åˆ°loc_74FAF2D0å¤„äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥çŒœåˆ°äº†ï¼ŒCMPæŒ‡ä»¤æ¯”è¾ƒçš„åº”è¯¥å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å¯†ç å’Œæ­£ç¡®çš„å¯†ç ï¼Œæˆ‘ä»¬å†æ¬¡ä»æ–°è°ƒè¯•ï¼Œçœ‹çœ‹R3å’ŒR1å¯„å­˜å™¨çš„å€¼ çœ‹åˆ°äº†è¿™é‡Œçš„R3å¯„å­˜å™¨çš„å€¼å°±æ˜¯ç”¨å¯„å­˜å™¨å¯»å€æ–¹å¼ï¼Œèµ‹å€¼å­—ç¬¦ä¸²çš„ï¼Œè¿™é‡ŒR2å¯„å­˜å™¨å°±æ˜¯å­˜æ”¾å­—ç¬¦ä¸²çš„åœ°å€ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„å†…å®¹æ˜¯aiyouâ€¦ä½†æ˜¯è¿™é‡Œè‚¯å®šä¸æ˜¯å…¨éƒ¨å­—ç¬¦ä¸²ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡çœ‹åˆ°å­—ç¬¦ä¸²çš„ç»“æŸç¬¦ï¼šâ€™\0â€™ï¼Œæˆ‘ä»¬ç‚¹å‡»R2å¯„å­˜å™¨ï¼Œè¿›å…¥æŸ¥çœ‹å®Œæ•´å†…å®¹ï¼š è¿™é‡Œæ˜¯å…¨éƒ¨å†…å®¹ï¼šaiyou,bucuoo æˆ‘ä»¬ç»§ç»­æŸ¥çœ‹R1å¯„å­˜å™¨çš„å†…å®¹ï¼š è¿™é‡Œä¹Ÿæ˜¯åŒæ ·ç”¨å¯„å­˜å™¨å¯»å€ï¼ŒR0å¯„å­˜å™¨å­˜å‚¨çš„æ˜¯R1ä¸­å­—ç¬¦ä¸²çš„åœ°å€ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™é‡Œçš„å­—ç¬¦ä¸²å†…å®¹æ˜¯ï¼šjiangwei è¿™ä¸ªå°±æ˜¯æˆ‘è¾“å…¥çš„å†…å®¹ï¼Œé‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥è±ç„¶å¼€æœ—äº†ï¼Œå¯†ç æ˜¯ä¸Šé¢çš„ï¼šaiyou,bucuoo æˆ‘ä»¬å†æ¬¡è¾“å…¥è¿™ä¸ªå¯†ç ï¼š å“ˆå“ˆå“ˆï¼Œç ´è§£æˆåŠŸå•¦å•¦~~ äº”ã€æŠ€æœ¯æ€»ç»“åˆ°è¿™é‡Œæˆ‘ä»¬ç®—æ˜¯è®²è§£å®Œäº†å¦‚ä½•ä½¿ç”¨IDAæ¥è°ƒè¯•soä»£ç ï¼Œä»è€Œç ´è§£apkçš„çŸ¥è¯†äº†ï¼Œå› ä¸ºè¿™é‡ŒIDAå·¥å…·æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« ç¯‡å¹…æœ‰ç‚¹é•¿ï¼Œæ‰€ä»¥åŒå­¦ä»¬å¯ä»¥å¤šçœ‹å‡ éï¼Œå°±å·®ä¸å¤šäº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥æ•´ç†ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ä¸­æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹å§ï¼š ç¬¬ä¸€ã€IDAä¸­çš„å¸¸ç”¨å¿«æ·é”®ä½¿ç”¨ 1ã€Shift+F12å¯ä»¥å¿«é€ŸæŸ¥çœ‹soä¸­çš„å¸¸é‡å­—ç¬¦ä¸²å†…å®¹ï¼Œæœ‰æ—¶å€™ï¼Œå­—ç¬¦ä¸²å†…å®¹æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„çªç ´ç‚¹ 2ã€ä½¿ç”¨å¼ºå¤§çš„F5é”®ï¼Œå¯ä»¥æŸ¥çœ‹armæ±‡ç¼–æŒ‡ä»¤å¯¹åº”çš„Cè¯­è¨€ä»£ç ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨Yé”®ï¼Œè¿›è¡ŒJNIEnv*æ–¹æ³•çš„è¿˜åŸ 3ã€ä½¿ç”¨Ctrl+Sé”®ï¼Œå¯ä»¥åœ¨IDA Viewé¡µé¢ä¸­æŸ¥çœ‹soçš„æ‰€æœ‰æ®µä¿¡æ¯ï¼Œåœ¨è°ƒè¯•é¡µé¢å¯ä»¥æŸ¥æ‰¾å¯¹åº”soæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜çš„åŸºåœ°å€ï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨Gé”®ï¼Œè¿›è¡Œåœ°å€çš„è·³è½¬ 4ã€ä½¿ç”¨F8è¿›è¡Œå•æ­¥è°ƒè¯•ï¼ŒF7è¿›è¡Œå•æ­¥è·³å…¥è°ƒè¯•ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨F9è¿è¡Œç¨‹åº ç¬¬äºŒã€ARMæ±‡ç¼–æŒ‡ä»¤ç›¸å…³çŸ¥è¯† 1ã€äº†è§£äº†å‡ ç§å¯»å€æ–¹å¼ï¼Œæœ‰åˆ©äºæˆ‘ä»¬ç®€å•çš„è¯»æ‡‚armæ±‡ç¼–æŒ‡ä»¤ä»£ç  2ã€äº†è§£äº†armä¸­çš„å‡ ç§å¯„å­˜å™¨çš„ä½œç”¨ï¼Œç‰¹åˆ«æ˜¯PCå¯„å­˜å™¨ 3ã€äº†è§£äº†armä¸­å¸¸ç”¨çš„æŒ‡ä»¤ï¼Œæ¯”å¦‚ï¼šMOVï¼ŒADDï¼ŒSUBï¼ŒLDRï¼ŒSTRï¼ŒCMPï¼ŒCBZï¼ŒBLï¼ŒBLX ç¬¬ä¸‰ã€ä½¿ç”¨IDAè¿›è¡Œè°ƒè¯•soçš„æ­¥éª¤ï¼Œè¿™é‡Œåˆ†ä¸¤ç§æƒ…å†µ 1ã€IDAè°ƒè¯•æ— åè°ƒè¯•çš„soä»£ç æ­¥éª¤ï¼š 1ã€‹æŠŠIDAå®‰è£…ç›®å½•ä¸­çš„android_serveræ‹·è´åˆ°è®¾å¤‡çš„æŒ‡å®šç›®å½•ä¸­ï¼Œä¿®æ”¹android_serverçš„æƒé™ï¼Œå¹¶ä¸”ç”¨rootæ–¹å¼è¿è¡Œèµ·æ¥ï¼Œç›‘å¬23946ç«¯å£ 2ã€‹ä½¿ç”¨adb forwardå‘½ä»¤è¿›è¡Œç«¯å£çš„è½¬å‘ï¼Œå°†è®¾å¤‡è¢«è°ƒè¯•ç«¯çš„ç«¯å£è½¬å‘åˆ°è¿œç¨‹è°ƒè¯•ç«¯ä¸­ 3ã€‹åŒå¼€IDAå·¥å…·ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥æ‰“å¼€soæ–‡ä»¶ï¼Œè¿›è¡Œæ–‡ä»¶åˆ†æï¼Œæ¯”å¦‚ç®€å•åˆ†æarmæŒ‡ä»¤ä»£ç ï¼ŒçŸ¥é“å¤§ä½“é€»è¾‘ï¼Œè¿˜æœ‰å°±æ˜¯æ‰¾åˆ°å…·ä½“å‡½æ•°çš„ç›¸å¯¹ä½ç½®ç­‰ä¿¡æ¯ï¼Œè¿˜æœ‰ä¸€ä¸ªIDAæ˜¯ç”¨æ¥è°ƒè¯•soæ–‡ä»¶çš„ï¼Œæˆ‘ä»¬åœ¨Debuggeré€‰é¡¹ä¸­è®¾ç½®Debugger Optionï¼Œç„¶åé™„åŠ éœ€è¦è°ƒè¯•çš„è¿›ç¨‹ 4ã€‹è¿›å…¥è°ƒè¯•é¡µé¢ä¹‹åï¼Œé€šè¿‡Ctrl+Så’ŒGå¿«æ·é”®ï¼Œå®šä½åˆ°éœ€è¦è°ƒè¯•çš„å…³é”®å‡½æ•°ï¼Œè¿›è¡Œä¸‹æ–­ç‚¹ 5ã€‹ç‚¹å‡»è¿è¡Œæˆ–è€…å¿«æ·é”®F9ï¼Œè§¦å‘ç¨‹åºçš„å…³é”®å‡½æ•°ï¼Œç„¶åè¿›å…¥æ–­ç‚¹ï¼Œä½¿ç”¨F8å•æ­¥è°ƒè¯•ï¼ŒF7å•æ­¥è·³å…¥è°ƒè¯•ï¼Œåœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­ä¸»è¦è§‚å¯ŸBLï¼ŒBLXæŒ‡ä»¤ï¼Œä»¥åŠCMPå’ŒCBZç­‰æ¯”è¾ƒæŒ‡ä»¤ï¼Œç„¶ååœ¨æŸ¥çœ‹å…·ä½“çš„å¯„å­˜å™¨çš„å€¼ã€‚ 2ã€IDAè°ƒè¯•æœ‰åè°ƒè¯•çš„soä»£ç æ­¥éª¤ï¼š 1ã€‹æŸ¥çœ‹apkæ˜¯å¦ä¸ºå¯è°ƒå¼çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨aaptå‘½ä»¤æŸ¥çœ‹ä»–çš„AndroidManifest.xmlæ–‡ä»¶ä¸­çš„android:debuggeableå±æ€§æ˜¯å¦ä¸ºtrueï¼Œå¦‚æœä¸æ˜¯debugçŠ¶æ€ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰‹åŠ¨çš„æ·»åŠ è¿™ä¸ªå±æ€§ï¼Œç„¶åå›ç¼–è¯‘ï¼Œåœ¨ç­¾åæ‰“åŒ…ä»æ–°å®‰è£… 2ã€‹ä½¿ç”¨adb shell am start -D -n com.yaotong.crackme/.MainActivity å‘½ä»¤å¯åŠ¨ç¨‹åºï¼Œå‡ºäºwait DebugçŠ¶æ€ 3ã€‹æ‰“å¼€IDAï¼Œè¿›è¡Œè¿›ç¨‹é™„åŠ ï¼Œè¿›å…¥åˆ°è°ƒè¯•é¡µé¢ 4ã€‹ä½¿ç”¨ jdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=8700 å‘½ä»¤attachä¹‹å‰çš„debugçŠ¶æ€ï¼Œè®©ç¨‹åºæ­£å¸¸è¿è¡Œ 5ã€‹è®¾ç½®Debug Optioné€‰é¡¹ï¼Œè®¾ç½®Suspend on library start/exit/Suspend on library load/unload/Suspend on process entry pointé€‰é¡¹ 6ã€‹ç‚¹å‡»è¿è¡ŒæŒ‰é’®æˆ–è€…F9é”®ï¼Œç¨‹åºè¿è¡Œåœæ­¢åœ¨linkeræ¨¡å—ä¸­ï¼Œè¿™æ—¶å€™è¡¨ç¤ºsoæ–‡ä»¶åŠ è½½è¿›æ¥äº†ï¼Œæˆ‘ä»¬é€šè¿‡Ctrl+Så’ŒGé”®è·³è½¬åˆ°JNI_OnLoadå‡½æ•°å‡ºï¼Œè¿›è¡Œä¸‹æ–­ç‚¹ 7ã€‹ç„¶åç»§ç»­è¿è¡Œï¼Œè¿›å…¥JNI_OnLoadæ–­ç‚¹å¤„ï¼Œä½¿ç”¨F8è¿›è¡Œå•æ­¥è°ƒè¯•ï¼ŒF7è¿›è¡Œå•æ­¥è·³å…¥è°ƒè¯•ï¼Œæ‰¾åˆ°åè°ƒè¯•ä»£ç å¤„ 8ã€‹ç„¶åä½¿ç”¨äºŒè¿›åˆ¶è½¯ä»¶ä¿®æ”¹åè°ƒè¯•ä»£ç ä¸ºnopæŒ‡ä»¤ï¼Œå³00å€¼ 9ã€‹ä¿®æ”¹ä¹‹åï¼Œåœ¨æ›¿æ¢åŸæ¥çš„soæ–‡ä»¶ï¼Œè¿›è¡Œå›ç¼–è¯‘ï¼Œä»æ–°ç­¾åæ‰“åŒ…å®‰è£…å³å¯ 10ã€‹æŒ‰ç…§ä¸Šé¢çš„æ— åè°ƒè¯•çš„soä»£ç æ­¥éª¤å³å¯ ç¬¬å››ã€å­¦ä¹ äº†å¦‚ä½•åšåˆ°åè°ƒè¯•æ£€æµ‹ ç°åœ¨å¾ˆå¤šåº”ç”¨é˜²æ­¢åˆ«çš„è¿›ç¨‹è°ƒè¯•æˆ–è€…æ³¨å…¥ï¼Œé€šå¸¸ä¼šç”¨è‡ªæˆ‘æ£€æµ‹è£…ç½®ï¼ŒåŸç†å°±æ˜¯ï¼š å¾ªç¯æ£€æµ‹/proc/[mypid]/statusæ–‡ä»¶ï¼ŒæŸ¥çœ‹ä»–çš„TracerPidå­—æ®µæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸ä¸º0ï¼Œè¡¨ç¤ºè¢«å…¶ä»–è¿›ç¨‹traceäº† é‚£ä¹ˆè¿™æ—¶å€™å°±ç›´æ¥é€€å‡ºç¨‹åºã€‚å› ä¸ºç°åœ¨çš„IDAè°ƒè¯•æ—¶éœ€è¦è¿›ç¨‹çš„æ³¨å…¥ï¼Œè¿›ç¨‹æ³¨å…¥ç°åœ¨éƒ½æ˜¯ä½¿ç”¨Linuxä¸­çš„ptraceæœºåˆ¶ï¼Œé‚£ä¹ˆè¿™é‡Œçš„TracePidå°±å¯ä»¥è®°å½•traceçš„pidï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æˆ‘ä»¬çš„ç¨‹åºè¢«é‚£ä¸ªè¿›ç¨‹æ³¨å…¥äº†ï¼Œæˆ–è€…æ˜¯è¢«ä»–åœ¨è°ƒè¯•ã€‚è¿›è€Œé‡‡å–ä¸€äº›æªæ–½ã€‚ ç¬¬äº”ã€IDAè°ƒè¯•çš„æ•´ä½“åŸç† æˆ‘ä»¬çŸ¥é“äº†ä¸Šé¢çš„IDAè°ƒè¯•æ­¥éª¤ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ä»”ç»†æƒ³ä¸€æƒ³ï¼Œä»–çš„è°ƒè¯•åŸç†å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š é¦–å…ˆä»–å¾—åœ¨è¢«è°ƒè¯•ç«¯å®‰æ”¾ä¸€ä¸ªç¨‹åºï¼Œç”¨äºIDAç«¯å’Œè°ƒè¯•è®¾å¤‡é€šä¿¡ï¼Œè¿™ä¸ªç¨‹åºå°±æ˜¯android_serverï¼Œå› ä¸ºè¦é™„åŠ è¿›ç¨‹ï¼Œæ‰€ä»¥è¿™ä¸ªç¨‹åºå¿…é¡»è¦ç”¨rootèº«ä»½è¿è¡Œï¼Œè¿™ä¸ªç¨‹åºèµ·æ¥ä¹‹åï¼Œå°±ä¼šå¼€å¯ä¸€ä¸ªç«¯å£23946ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨adb forwardè¿›è¡Œç«¯å£è½¬å‘åˆ°è¿œç¨‹è°ƒè¯•ç«¯ï¼Œè¿™æ—¶å€™IDAå°±å¯ä»¥å’Œè°ƒè¯•ç«¯çš„android_serverè¿›è¡Œé€šä¿¡äº†ã€‚åé¢è·å–è®¾å¤‡çš„è¿›ç¨‹åˆ—è¡¨ï¼Œé™„åŠ è¿›ç¨‹ï¼Œä¼ é€’è°ƒè¯•ä¿¡æ¯ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€šä¿¡æœºåˆ¶å®Œæˆå³å¯ã€‚IDAå¯ä»¥è·å–è¢«è°ƒè¯•çš„è¿›ç¨‹çš„å†…å­˜æ•°æ®ï¼Œä¸€èˆ¬æ˜¯åœ¨ /proc/[pid]maps æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨Ctrl+Så¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„soæ–‡ä»¶çš„åŸºåœ°å€ï¼Œå¯ä»¥éå†mapsæ–‡ä»¶å³å¯åšåˆ°ã€‚ ç ´è§£æ³•åˆ™ï¼š**æ—¶åˆ»éœ€è¦æ³¨æ„å…³é”®çš„BL/BLXç­‰è·³è½¬æŒ‡ä»¤ï¼Œåœ¨ä»–ä»¬æ‰§è¡Œå®Œä¹‹åï¼Œè‚¯å®šä¼šæœ‰ä¸€äº›CMP/CBZç­‰æ¯”è¾ƒæŒ‡ä»¤ï¼Œè¿™æ—¶å€™å°±å¯ä»¥æŸ¥çœ‹é‡è¦çš„å¯„å­˜å™¨å†…å®¹æ¥è·å–é‡è¦ä¿¡æ¯ã€‚**]]></content>
      <categories>
        <category>pythonçˆ¬è™«</category>
        <category>çˆ¬è™«æ‹“å±•åŠŸèƒ½</category>
      </categories>
      <tags>
        <tag>çˆ¬è™«</tag>
        <tag>Androidåç¼–è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidåç¼–è¯‘å°è¯•(è£åˆ¤æ–‡ä¹¦appç¤ºä¾‹)]]></title>
    <url>%2F2019%2F02%2F27%2F02.python%E7%88%AC%E8%99%AB%2F%E7%88%AC%E8%99%AB%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%2FAndroid%E5%8F%8D%E7%BC%96%E8%AF%91%E7%88%AC%E8%99%AB((%E8%A3%81%E5%88%A4%E6%96%87%E4%B9%A6app%E7%A4%BA%E4%BE%8B))%2F</url>
    <content type="text"><![CDATA[ä¸€ã€å·¥å…·å‡†å¤‡ fiddler å®‰å“æ¨¡æ‹Ÿå™¨ android studio enjarify jd-gui python3 jdk apktool adb SignApk.jar apkç­¾åå·¥å…· IDA äºŒã€ æŠ“åŒ…æŸ¥çœ‹apkçš„è¯·æ±‚é€»è¾‘1ï¼‰è®¾ç½®fiddlerä¸‹è½½fiddleråï¼Œæ‰“å¼€èœå•æ  Tools=ã€‹Options=ã€‹HTTPSï¼Œ å‹¾é€‰ã€Decrypt HTTPS trafficã€‘é€‰é¡¹ï¼Œå¯¹äºã€Ignore server certificate errors (unsafe)ã€‘é€‰é¡¹å¯ä»¥ä¸å¿…å‹¾é€‰ï¼Œç„¶åç‚¹å‡»ã€Actionsã€‘ç‚¹å‡»ã€Export Root Certificate to Desktopã€‘è¿™æ—¶å€™å°±ä¼šå°†Fiddleræ ¹è¯ä¹¦FiddlerRoot.cerä¿å­˜åˆ°æ¡Œé¢ä¸Šï¼Œè¿™ä¸ªæ ¹è¯ä¹¦åœ¨å¦‚æœå¼€å¯äº†Fiddlerçš„HTTPSè§£å¯†çš„æ—¶å€™ç«ç‹æµè§ˆå™¨è®¿é—®HTTPSåœ°å€æ—¶å€™å‡ºç°ã€æ‚¨çš„è¿æ¥å¹¶ä¸å®‰å…¨ã€‘çš„é”™è¯¯é¡µé¢æ—¶å€™ä½¿ç”¨ã€‚ ç„¶åç‚¹å‡»HTTPSæ ‡ç­¾æ æ—è¾¹çš„Connectionsæ ‡ç­¾ï¼Œ è¿™é‡Œæˆ‘ä»¬è¦è®°å¾—ã€Fiddler listen on portã€‘ä¸­æ˜¾ç¤ºçš„ç«¯å£å·ï¼ˆå…³äºè¿™ä¸ªç«¯å£å·ï¼Œå¦‚æœå½“å‰é»˜è®¤çš„8888ç«¯å£å·å·²ç»è¢«å ç”¨äº†ï¼Œé‚£ä¹ˆéœ€è¦é‡æ–°è®¾ç½®å¦å¤–çš„ç«¯å£å·ï¼‰ï¼Œç„¶åå°†ã€Allow remote computers to connectã€‘å‰é¢çš„å‹¾æ‰“ä¸Šã€‚ç‚¹å‡»ç¡®å®šï¼Œç„¶åé‡æ–°å¯åŠ¨Fiddlerã€‚é‡æ–°å¯åŠ¨åï¼Œæ‰“å¼€Fiddleråï¼Œåœ¨Fiddlerç•Œé¢çš„å³ä¸Šè§’çš„ä¸‰è§’å½¢ä¸Šç‚¹å‡»å°±ä¼šæ˜¾ç¤ºä¸€ä¸ªã€Onlineã€‘å›¾æ ‡ï¼ŒæŠŠé¼ æ ‡æ”¾åˆ°ã€Onlineã€‘å›¾æ ‡ä¸Šï¼Œä¼šæ˜¾ç¤ºå½“å‰æœºå™¨çš„IPåœ°å€ï¼Œ è¯¥åœ°å€ç›´æ¥ç”¨æ¥å’Œåé¢å®‰å“è®¾å¤‡çš„é“¾æ¥ 2ï¼‰ è®¾ç½®å®‰å“è®¾å¤‡ä¸åŒçš„å®‰å“è®¾å¤‡ä¼šæœ‰ä¸€äº›åŒºåˆ«ï¼Œä½†æ˜¯è®¾ç½®çš„æ€è·¯ä¸€æ · ç‚¹å‡»æ¡Œé¢ä¸Šçš„ã€ç³»ç»Ÿåº”ç”¨ã€‘=ã€‹ã€è®¾ç½®ã€‘=ã€‹ã€WLANã€‘ï¼Œ é¼ æ ‡æ”¾åˆ°å½“å‰å·²ç»è¿æ¥çš„ç½‘ç»œä¸Šé•¿æŒ‰ï¼Œ åœ¨å¼¹å‡ºçš„æ¶ˆæ¯çª—å£ä¸­ç‚¹å‡»ã€ä¿®æ”¹ç½‘ç»œã€‘ï¼Œè¾“å…¥ä¸Šé¢æˆ‘ä»¬å¾—åˆ°çš„IPåœ°å€å’Œç«¯å£å·ï¼Œç‚¹å‡»ä¿å­˜ã€‚ ç„¶ååœ¨æ¨¡æ‹Ÿå™¨ä¸­æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ï¼šhttp://ipv4.fiddler:8888 ï¼Œå‡ºç°ä¸‹é¢çš„é¡µé¢è¯´æ˜æˆ‘ä»¬åˆšåˆšè®¾ç½®çš„httpä»£ç†æ­£ç¡®ï¼Œç„¶åç‚¹å‡»çº¢çº¿æ¡†çš„ã€FiddlerRoot certificateã€‘ï¼Œä¸‹è½½Fiddlerçš„æ ¹è¯ä¹¦ï¼š ç„¶åæˆ‘ä»¬æ¥åˆ°æ¡Œé¢ã€ç³»ç»Ÿåº”ç”¨ã€‘=ã€‹ã€è®¾ç½®ã€‘=ã€‹ã€å®‰å…¨ã€‘=ã€‹ã€ä»SDå¡å®‰è£…ã€‘ä¸­æ‰¾åˆ°æˆ‘ä»¬åˆšåˆšä¸‹è½½çš„è¯ä¹¦ï¼š ç‚¹å‡»è¯ä¹¦ï¼Œç„¶åè¾“å…¥è¯ä¹¦åç§°ç‚¹å‡»ã€ç¡®å®šã€‘ å®‰å“è®¾å¤‡è®¾ç½®å®Œæˆï¼Œæ‰“å¼€æµè§ˆå™¨å¯ä»¥æ£€éªŒä¸€ä¸‹fiddlerä¸­æ˜¯å¦å¯ä»¥æ£€æµ‹åˆ°ç½‘ç»œè¯·æ±‚ï¼Œå¦‚æœæ£€æµ‹åˆ°è¯´æ˜é…ç½®æˆåŠŸ 3ï¼‰æ“ä½œapkå¹¶è¿›è¡Œè¯·æ±‚å’ŒæŠ“åŒ…æŠ“åŒ…ç›®çš„ ä¸‹è½½apkï¼Œå¹¶è¿›è¡Œç›¸åº”çš„è¯·æ±‚ï¼ŒæŸ¥æ‰¾æ‰€éœ€æ•°æ®çš„ç½‘ç»œè¯·æ±‚åŒ…å’Œå¿…è¦çš„è¯·æ±‚å‚æ•°ã€ä»¥åŠæ•°æ®ä¹¦å¦è¢«åŠ å¯†ç­‰ æ‰¾åˆ°æ•°æ®åŒ… ä»¥è£åˆ¤æ–‡ä¹¦Apkä¸ºä¾‹ï¼Œ æ‰¾åˆ°æŒ‰å…³é”®å­—æœç´¢æ–‡ä¹¦çš„æ•°æ®ç»“æœ Apkä¸»é¡µ åœ¨æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®å­— â€œé˜¿é‡Œâ€, ç‚¹å‡»æœç´¢æŒ‰é’®ï¼Œåœ¨fiddlerä¸­æ‰¾åˆ°åŒ…å«æ•°æ®çš„è¯·æ±‚ ç¬¬ä¸€ä¸ªä¸»è¦çš„è¯·æ±‚ä¸»è¦æ˜¯ä»æœåŠ¡ç«¯è·å–reqtokenï¼Œè¯¥å‚æ•°ä½œä¸ºåé¢è¯·æ±‚çš„è¡¨å•å‚æ•° ç¬¬äºŒä¸ªä¸»è¦çš„è¯·æ±‚ï¼Œä¾¿æ˜¯ä»æœåŠ¡ç«¯è·å–æœç´¢çš„ç»“æœ ç‚¹å‡»åˆ—è¡¨é¡µçš„itemï¼Œè·å–è¯¦æƒ…å†…å®¹ï¼ŒæŠ“å–æ•°æ®åŒ…ï¼› å¯ä»¥ç¡®å®šè·å–è¯¦æƒ…å†…å®¹çš„æ•°æ®åŒ…ä¸ºçº¢è‰²æ¡†å†…è¯·æ±‚ï¼Œéœ€æºå¸¦è¯¦æƒ…çš„fieldId; ç¡®å®šç ´è§£ç›®æ ‡ ç»¼ä¸Šåˆ†æï¼Œä»æŠ“åŒ…ä¸Šæ¥çœ‹ï¼Œåœ¨è¯·æ±‚ä¸­ä¸ç¡®å®šçš„å‚æ•°ä¸»è¦æœ‰ï¼Œheadersä¸­çš„devidï¼Œsignatureï¼Œnonceï¼Œ timespanå‚æ•°ï¼Œå¹¶ä¸”ç¬¬äºŒæ¬¡å¯¹åˆ—è¡¨é¡µçš„è¯·æ±‚çš„å“åº”æ•°æ®å¹¶ä¸æ˜¯æ˜æ–‡ï¼Œä¹Ÿå°±æ˜¯åŠ å¯†åçš„ç»“æœï¼Œæ‰€ä»¥åªæœ‰ç»è¿‡è§£å¯†åæ‰èƒ½è·å¾—çœŸæ­£çš„ç»“æœ æ¥ä¸‹æ¥å°†è¦å¯¹å…¶apkä»£ç è¿›è¡Œåˆ†æå’Œdebugè°ƒè¯•ï¼Œéœ€è¦å®Œæˆä»¥ä¸‹ä¸¤ä¸ªä»»åŠ¡ï¼š 1.è·å–è¯·æ±‚å‚æ•°çš„ç”Ÿæˆæ–¹å¼ï¼Œdevidï¼Œsignatureï¼Œnonce, timespan 2.è¯¦æƒ…é¡µçš„fieIdIdç”Ÿæˆæ–¹å¼ï¼› 3.åˆ—è¡¨é¡µå’Œè¯¦æƒ…é¡µå“åº”å†…å®¹çš„è§£å¯†æ–¹å¼ ä¸‰ã€åç¼–è¯‘è·å–Javaä»£ç å…³äºapkè·å–é™æ€javaä»£ç ä»¥åŠåˆ†æè¯·å‚è€ƒã€ŠAndroidé€†å‘-é™æ€åˆ†æç ´è§£Apkã€‹ 1ï¼‰é…ç½®ç¯å¢ƒï¼Œapkä¸‹è½½ä½¿ç”¨enjarifyè¿›è¡Œåç¼–è¯‘ï¼Œ éœ€è¦æå‰é…ç½®å¥½python3è¿è¡Œç¯å¢ƒ é…ç½®å¥½python3å¼€å‘ç¯å¢ƒåï¼Œä¸‹è½½å°†è¦è¿›è¡Œåç¼–è¯‘çš„apk 2ï¼‰è¿è¡Œenjarifyè¿›è¡Œåç¼–è¯‘å°†ä¸‹è½½å¥½çš„apkå¯¼å…¥åˆ°åŒenjarifyåŒä¸€çº§ç›®å½•ä¸‹ è¾“å…¥å‘½ä»¤ 1python3 -O -m enjarify.main yourapp.apk åç¼–è¯‘æ•ˆæœï¼Œ åç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶å°±æ˜¯ wenshuapp-enjarify.jar 3ï¼‰JD-GUIæŸ¥çœ‹javaæºç è¿™ä¸€æ­¥ä¸ç”¨è¿‡å¤šä»‹ç»ï¼Œå°†åç¼–è¯‘ç”Ÿæˆçš„jaræ–‡ä»¶å¯¼å…¥è¿›æ¥å°±å¯ä»¥æŸ¥çœ‹å…¶æºç éƒ¨åˆ† å¦‚å›¾å°±æ˜¯é€šè¿‡åç¼–è¯‘å·¥å…·è·å–çš„java class æºä»£ç ï¼Œ å¼€å§‹å¯»æ‰¾æˆ‘ä»¬éœ€è¦åˆ†æçš„ä»£ç  å¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†çš„é€»è¾‘æºç éƒ½åœ¨çº¢è‰²åŒºåŸŸå†… ä¸‹é¢å¼€å§‹åŠ¨æ€è°ƒè¯•ï¼Œé€šè¿‡å’Œæºç å†…å®¹çš„ç»“åˆæ¥åˆ†ææ•´ä¸ªapkè¯·æ±‚å’Œè§£ææ•°æ®çš„é€»è¾‘ enjarifyå·¥å…·ä¸‹è½½åœ°å€ï¼šhttps://github.com/google/enjarify jd-guiå·¥å…·ä¸‹è½½åœ°å€: http://jd.benow.ca/ å››ã€åˆ¶ä½œdebugæ¨¡å¼Apkå…³äºdebugæ¨¡å¼çš„apkåˆ¶ä½œå’Œsmaliçš„åŸºç¡€è¯­æ³•ï¼Œå’Œè°ƒè¯•æ–¹æ³•è¯·å‚è€ƒã€ŠAndroidé€†å‘-åŠ¨æ€åˆ†æç ´è§£Apk(Debug)ã€‹ 1ï¼‰ä½¿ç”¨apktoolæ¥ç ´è§£apk1java -jar apktool/apktool.jar d wenshu/wenshuapp.apk -o wenshu_out è¿™é‡Œçš„å‘½ä»¤ä¸åšè§£é‡Šäº†ã€‚ åç¼–è¯‘æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªoutç›®å½•ï¼Œå¦‚ä¸‹ï¼š æºç éƒ½æ”¾åœ¨smailæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬è¿›å…¥æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶ï¼š 2ï¼‰ä¿®æ”¹AndroidManifest.xmlä¸­çš„debugå±æ€§å’Œåœ¨å…¥å£ä»£ç ä¸­æ·»åŠ waitDebugä¸Šé¢æˆ‘ä»¬åç¼–è¯‘æˆåŠŸäº†ï¼Œä¸‹é¢æˆ‘ä»¬ä¸ºäº†åç»­çš„è°ƒè¯•å·¥ä½œï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦åšä¸¤ä»¶äº‹ï¼š 1ã€‹ä¿®æ”¹AndroidManifest.xmlä¸­çš„android:debuggable=â€trueâ€ å…³äºè¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å‰é¢ä»‹ç»run-aså‘½ä»¤çš„æ—¶å€™ï¼Œä¹Ÿæåˆ°äº†ï¼Œä»–æ ‡è¯†è¿™ä¸ªåº”ç”¨æ˜¯å¦æ˜¯debugç‰ˆæœ¬ï¼Œè¿™ä¸ªå°†ä¼šå½±å“åˆ°è¿™ä¸ªåº”ç”¨æ˜¯å¦å¯ä»¥è¢«è°ƒè¯•ï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»è®¾ç½®æˆtrueã€‚ å½“ç„¶è¿˜æœ‰å…¶ä»–æ–¹å¼ï¼Œæ¯”å¦‚aaptæŸ¥çœ‹apkçš„å†…å®¹æ–¹å¼ï¼Œæˆ–è€…æ˜¯å®‰è£…apkä¹‹åç”¨ adb dumpsys activity top å‘½ä»¤æŸ¥çœ‹éƒ½æ˜¯å¯ä»¥çš„ã€‚ 2ã€‹åœ¨å…¥å£å¤„æ·»åŠ waitForDebuggerä»£ç è¿›è¡Œè°ƒè¯•ç­‰å¾…ã€‚ è¿™é‡Œè¯´çš„å…¥å£å¤„ï¼Œå°±æ˜¯ç¨‹åºå¯åŠ¨çš„åœ°æ–¹ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸€èˆ¬çš„å…¥å£Activityï¼ŒæŸ¥æ‰¾è¿™ä¸ªActivityçš„è¯ï¼Œæ–¹æ³•å¤ªå¤šäº†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œç›´æ¥ä»ä¸Šé¢å¾—åˆ°çš„AndroidManifest.xmlä¸­æ‰¾åˆ°ï¼Œå› ä¸ºå…¥å£Activityçš„actionå’Œcategoryæ˜¯å›ºå®šçš„, å¦‚ä¸Šå›¾ç¬¬äºŒä¸ªçº¢æ¡†ã€‚ æ‰¾åˆ°å…¥å£Activityä¹‹åï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ä»–çš„onCreateæ–¹æ³•çš„ç¬¬ä¸€è¡ŒåŠ ä¸ŠwaitForDebuggerä»£ç å³å¯ï¼Œæ‰¾åˆ°å¯¹åº”çš„MainActivityçš„smaliæºç ï¼Œç„¶åæ·»åŠ ä¸€è¡Œä»£ç ï¼š 1invoke-static&#123;&#125;, Landroid/os/Debug;-&gt;waitForDebugger()V è¿™ä¸ªæ˜¯smaliè¯­æ³•çš„ï¼Œå…¶å®å¯¹åº”çš„Javaä»£ç å°±æ˜¯ï¼šandroid.os.Debug.waitForDebugger(); è¿™é‡ŒæŠŠJavaè¯­è¨€ç¿»è¯‘æˆsmaliè¯­æ³•çš„ï¼Œç½‘ä¸Šæœ‰smaliçš„è¯­æ³•è§£æã€‚ 3ï¼‰å›ç¼–è¯‘apkå¹¶ä¸”è¿›è¡Œç­¾åå®‰è£…1java -jar apktool.jar b out -o wenshu_debug.apk è¿˜æ˜¯ä½¿ç”¨apktoolè¿›è¡Œå›ç¼–è¯‘ ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°†å¾—åˆ°debug.apkæ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªapkæ˜¯æ²¡æœ‰ç­¾åçš„ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½å®‰è£…çš„ï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬éœ€è¦åœ¨è¿›è¡Œç­¾åï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Androidä¸­çš„æµ‹è¯•ç¨‹åºçš„ç­¾åæ–‡ä»¶å’Œsign.jarå·¥å…·è¿›è¡Œç­¾åï¼š 1java -jar signApk/signapk.jar ./signApk/testkey.x509.pem ./signApk/testkey.pk8 wenshu_debug.apk wenshu_debug.sig.apk ç­¾åä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå®‰è£…äº†ã€‚ äº”ã€è¿›è¡Œè°ƒè¯•1) android studioé…ç½®ä¸‹è½½ smalidea ä¸‹è½½åœ°å€: https://bitbucket.org/JesusFreke/smali/downloads/ å®‰è£…smalidea æ‰“å¼€AndroidStudioï¼Œç‚¹å‡»Preferencesâ€¦ | Plugins, é€‰æ‹©Install plugin from disk 2ï¼‰å°†åç¼–è¯‘çš„æ–‡ä»¶å¤¹å¯¼å…¥Android Studioé€‰æ‹©Import Project é€‰æ‹©Create preject from existing sources ä¸€ç›´é€‰æ‹©â€œNextâ€ï¼Œç›´è‡³å¯¼å…¥å·¥ç¨‹å®Œæˆ ç„¶ååœ¨AndroidStudioå·¥ç¨‹ä¸­å³é”®ç‚¹å‡»smaliæ–‡ä»¶å¤¹ï¼Œè®¾å®šMark Directory as -&gt; Sources Root AndroidStudioçš„File -&gt; Project Structure, é…ç½®JDKã€‚ 3ï¼‰é…ç½®é¡¹ç›®è¿œç¨‹è°ƒè¯•åœ¨AndroidStudioé‡Œé¢é…ç½®è¿œç¨‹è°ƒè¯•çš„é€‰é¡¹ï¼Œé€‰æ‹©Run -&gt; Edit Configurationsï¼Œ å¹¶å¢åŠ ä¸€ä¸ªRemoteè°ƒè¯•çš„è°ƒè¯•é€‰é¡¹ï¼Œç«¯å£é€‰æ‹©:8700 4ï¼‰ å°†è¿›ç¨‹å’Œandroid studioä¹‹é—´å»ºç«‹è¿æ¥å¯åŠ¨apk å¯åŠ¨æ¨¡æ‹Ÿå™¨ä¸Šé‡æ–°æ‰“åŒ…å¹¶å®‰è£…å¥½çš„apkï¼Œ apkå°†ä¼šå¡åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ç­‰å¾…æ¥å…¥debug æŸ¥çœ‹è¿›ç¨‹ç«¯å£ä¿¡æ¯ æ‰¾åˆ°apkè¿›ç¨‹çš„ç«¯å£å· 1adb shell ps | grep com.lawyee.wenshuapp å»ºç«‹è¿›ç¨‹å’Œandroid studioä¹‹é—´çš„é“¾æ¥ 1adb forward tcp:5005 jdwp:29685 5) å¼€å§‹è°ƒè¯•å¯åŠ¨ç¨‹åºè°ƒè¯• ç‚¹å‡»ç¨‹åºè°ƒè¯•æŒ‰é’®, æ§åˆ¶å°å¦‚æœæ˜¾ç¤ºconnect æˆåŠŸï¼Œè¡¨ç¤ºæˆåŠŸå¯åŠ¨ å…­ã€å‚æ•°ç ´è§£ä»£ç éƒ½æ˜¯æ··æ·†è¿‡åçš„ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆåŠæ³•ï¼Œè€å¿ƒçš„è°ƒè¯•å§ï¼Œæ‰¾åˆ°æƒ³è¦ç ´è§£çš„å„ä¸ªå‚æ•°çš„ç”Ÿæˆä½ç½®ï¼Œ æ‰¾åˆ°ç”Ÿæˆå‚æ•°çš„ä½ç½® è·å–è¯·æ±‚å‚æ•°ç”Ÿæˆæ–¹æ³•å› ä¸ºå‚æ•°æœ€ç»ˆéƒ½æ˜¯è¦ç»è¿‡ç½‘ç»œè¯·æ±‚å‘åŒ…ï¼Œæ‰€ä»¥å¯ä»¥ä»ç½‘ç»œè¯·æ±‚å‘èµ·å¤„å…¥æ‰‹ï¼Œç„¶ååå‘è¿½æº¯å‚æ•°çš„ç”Ÿæˆè¿‡ç¨‹ æ¯”å¦‚æ–‡ä¹¦appçš„ç½‘ç»œè¯·æ±‚æ‰€åœ¨ä½ç½®ä¸ºcom.lawyee.wenshuapp.util.a.a å¯ä»¥é€šè¿‡è°ƒè¯•æ‰¾åˆ°å‚æ•°ç”Ÿæˆçš„ä½ç½®ï¼Œå†å»ç”Ÿæˆçš„æ–¹æ³•é‡Œé¢å»çœ‹è¯¦ç»†çš„ç”Ÿæˆé€»è¾‘å°±å¥½ï¼Œæ¯ä¸ªå‚æ•°çš„ç”Ÿæˆ å„å‚æ•°å¯¹åº”çš„ç”Ÿæˆæ–¹æ³• timespan å°±æ˜¯å½“å‰çš„datetimeå»æ‰æ‰€æœ‰ç¬¦å·æ ¼å¼ nonceç”Ÿæˆæ–¹æ³• devidç”Ÿæˆæ–¹æ³• signatureç”Ÿæˆæ–¹æ³• è·å–åˆ—è¡¨\è¯¦æƒ…çš„è§£å¯†æ–¹æ³•è·å–è§£å¯†æ–¹æ³• æ‰¾åˆ°è§£å¯†å“åº”æ•°æ®çš„ä½ç½®: æ–¹æ³•: com.lawyee.wenshuapp.util.aa.aï¼Œ ç”¨jd-guiæŸ¥çœ‹ä¸€ä¸‹è¯¥æ–¹æ³•çš„æºç  ä½ç½®: ç²—ç•¥ä¸€çœ‹å¯ä»¥çœ‹å‡ºæ˜¯é€šè¿‡AESè¿›è¡Œçš„è§£å¯†ï¼Œä½†æ˜¯æ–¹æ³•æ¥æ”¶äº†3ä¸ªå‚æ•°ç°åœ¨è¿˜ä¸ç¡®å®šå…¶ç”Ÿæˆæ–¹å¼ï¼Œä¸‹é¢å¯»æ‰¾ä¸‰ä¸ªå‚æ•°çš„ç”Ÿæˆæ–¹æ³• è·å–æ–¹æ³•å…¥å‚ paramString1ï¼šé€šè¿‡ideï¼Œé€šè¿‡è°ƒè¯•çª—å£å¯è·å¾—å…¶ä¸ºè¯·æ±‚çš„å“åº”å€¼ï¼Œå³åŠ å¯†åå¾…è§£å¯†çš„å†…å®¹ paramString2ï¼šä¸ºä»¥ä¸‹å‡½æ•°çš„è¿”å›å€¼ com.lawuee.wenshuapp.vo.DevInfoVO.getIvParameterï¼Œ ä½œä¸ºaesè§£å¯†å‚æ•°iv paramï¼› paramString3ï¼šä¸ºä»¥ä¸‹æ–¹æ³•çš„è¿”å›å€¼ com.lawyee.wenshuapp.config.ApplicationSet.aï¼Œ ä½œä¸ºaesè§£å¯†å‚æ•°keyï¼Œ æ¥æ”¶å‘é€è¯·æ±‚çš„timespanå‚æ•°ä¸ºå…¥å‚ thiså®ä¾‹å±æ€§ æ›´æ–°this.f å±æ€§çš„æ–¹æ³•iï¼Œé€šè¿‡æ–¹æ³•i å‘this.fç»‘å®š20ä¸ªç”Ÿæˆkeyçš„æ–¹æ³•ï¼› this.fæ˜¯ä¸€ä¸ªè§£å¯†æ–¹æ³•çš„é›†åˆï¼Œåœ¨åˆå§‹åŒ–æ—¶æ›´æ–°this.fï¼Œå…¶å†…å®¹ä¸º20ä¸ªè·å–keyçš„æ–¹æ³•ï¼Œåœ¨è§£å¯†çš„æ—¶å€™ï¼Œä¼šé€‰æ‹©å…¶ä¸­ä¸€ä¸ªç”¨æ¥ç”Ÿæˆkeyï¼Œ20ä¸ªæ–¹æ³•å°±ä¸è´´ä¸Šäº† åœ¨è¿™20ä¸ªç”Ÿæˆkeyçš„æ–¹æ³•ä¸­ï¼Œå…¶ä¸­ç”¨åˆ°äº†ä¸‰ä¸ªnativeæ–¹æ³•ï¼Œå¦‚ä¸‹ã€‚ è¿™ä¸‰ä¸ªé™æ€æ–¹æ³•æ¥è‡ªé™æ€åº“ lienutil-lib, ä¸‹é¢éœ€è¦ä»apktoolåç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶ä¸­æ‰¾åˆ°è¯¥é™æ€æ–‡ä»¶ï¼Œå°†å…¶åç¼–è¯‘æˆæ±‡ç¼–ï¼Œç ´è§£è¿™ä¸‰ä¸ªæ–¹æ³• åˆ†æsoæ–‡ä»¶ å…³äºIDAçš„ä½¿ç”¨æ–¹æ³•å‚è€ƒã€ŠAndroidé€†å‘-åŠ¨æ€åˆ†æç ´è§£Apk(è°ƒè¯•so)ã€‹ ç”¨IDAæ‰“å¼€ libenutil.soæ–‡ä»¶ï¼Œ åˆ†åˆ«é€‰ä¸­ä¸‰ä¸ªéœ€è¦åˆ†æçš„æ–¹æ³• æŒ‰F5é”®ï¼Œå°†æ–¹æ³•ç¿»è¯‘æˆcä»£ç ï¼Œ ç„¶åå†ç¿»è¯‘æˆç›®æ ‡æ‰“ç å³å¯ StrToLongæ–¹æ³• StrToLong2æ–¹æ³• StrToLong3æ–¹æ³• ç›®å‰æ‰€æœ‰çš„è¯·æ±‚å‚æ•°å’Œè§£å¯†è¿‡ç¨‹ä¸­æ¶‰åŠçš„æ–¹æ³•éƒ½æ‰¾åˆ°äº†ï¼Œä¸‹é¢å¯ä»¥å®ç°ç ´è§£äº† ä¸ƒã€ç ´è§£ä»£ç ç”Ÿæˆç›´æ¥å°†ä¸Šä¸€æ­¥æ‰¾åˆ°çš„å‚æ•°ç”Ÿæˆæ–¹æ³•ï¼Œå’Œè§£å¯†æ–¹æ³•ç­‰ç¿»è¯‘æˆç›®æ ‡ä»£ç ï¼Œpythonä¸ºä¾‹ è¯·æ±‚å‚æ•°ç”Ÿæˆæ–¹æ³• 123456789101112131415161718192021222324252627282930import hashlibimport datetimeimport randomimport hashlib# ç”Ÿæˆsignaturedef get_signature(timespan, nonce, devid): string_buffer = [timespan, nonce, devid] string_buffer.sort() str_join = "".join(string_buffer) m = hashlib.md5() m.update(str_join.encode()) return m.hexdigest()# ç”Ÿæˆnoncedef get_nonce(): str_array = "abcdefghijklmnopqrstuvwxyz0123456789" nonce = "" for _ in range(4): index_choose = random.randint(0, len(str_array) - 1) nonce = nonce + str_array[index_choose] return nonce# ç”Ÿæˆdeviddef get_uuid(): return uuid.uuid4().replace("-", "")# ç”Ÿæˆtimespandef get_timespan(): return datetime.datetime.now().strftime("%Y%m%d%H%M%S") è§£å¯†æ•°æ®æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182# coding=utf-8from appcrack.f_methods import e, f, g, h, k, l, m, n, o, p, q, r, s, t, u, v, w, x, j # è·å–keyå‚æ•°çš„20çš„æ–¹æ³•ï¼Œæš‚ä¸åˆ—ä¸¾from appcrack.f_methods import i as iifrom Crypto.Cipher import AESimport base64import hashlib# 3ä¸ªnativeæ–¹æ³•çš„pythonå®ç°def str2long(param_str, param_int): v10 = param_int v4 = 0 v5 = param_str if not param_str.strip(): return v4 v6 = len(v5) v4 = v10 if v6 &gt;= 2: v7 = 1 while v7 &lt; v6: v4 += v10 + v7 + ord(v5[v7] % 256 &lt;&lt; (v7 &amp; 7)) - ord(v5[v7]) % 256 v7 += 1 return v4def str2long2(param_str, param_int): v10 = param_int v4 = 0 v5 = param_str if not param_str.strip(): return v4 v6 = len(v5) v4 = v10 if v6 &gt;= 2: v7 = 1 while v7 &lt; v6: v4 += v10 + v7 + ord(v5[v7] % 256 &lt;&lt; (v7 &amp; 15)) - ord(v5[v7]) % 256 v7 += 1 return v4def str2long3(param_str, param_int): v10 = param_int v4 = 0 v5 = param_str if not param_str.strip(): return v4 v6 = len(v5) v4 = v10 if v6 &gt;= 2: v7 = 1 while v7 &lt; v6: v4 += v10 + v7 + ord(v5[v7] % 256 &lt;&lt; (v7 &amp; 15)) + v7 % 4 - ord(v5[v7]) % 256 v7 += 1 return v4# æ•°æ®è§£å¯†iv param(paramString2)å‚æ•°ç”Ÿæˆæ–¹æ³•def get_iv_param(devid): if len(devid.strip()) &lt; 16: return None return devid[len(devid) - 16]# key(paramString3)çš„ç”Ÿæˆæ–¹æ³•def get_key(timespan, token): key_producer_list = [e, f, q, r, s, t, u, v, w, x, g, h, ii, j, k, l, m, n, o, p] i = str2long(token, 1) % 20 return key_producer_list[i](token + timespan)# aesè§£å¯†æ–¹æ³•å®ç°def aes_decrypt(param_str1, param_str2, param_str3): block_size = AES.block_size pkc5Padding = lambda s: s + (block_size - len(s) % block_size) * chr(block_size - len(s) % block_size) \ if (block_size - len(s) % block_size) else s + block_size * chr(16) unpkc5Padding = lambda s: s[:-ord(s[len(s) - 1:])] mode = AES.MODE_CBC localCipher = AES.new(key=param_str2.encode('ascii'), mode=mode, iv=param_str3.encode('utf8')) cryptedStr = base64.b64decode(param_str1) recovery = unpkc5Padding(localCipher.decrypt(cryptedStr)) return recovery.decode('utf-8')# æ•°æ®è§£å¯†æ–¹æ³•æ¥å£def decrypt(devid, token, timespan, context): iv_param = get_iv_param(devid) key = get_key(timespan, token) return aes_decrypt(context, iv_param, key) å¥½äº†ï¼Œç›®å‰appè¯·æ±‚è¿‡ç¨‹ä¸­çš„æ‰€æœ‰å‚æ•°çš„ç”Ÿæˆæ–¹æ³•ï¼Œå’Œå“åº”æ•°æ®çš„è§£å¯†æ–¹æ³•éƒ½å·²ç»æ„å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥éšæ„çš„ç¼–å†™çˆ¬è™«è¿›è¡Œæ•°æ®çˆ¬å–äº†ã€‚]]></content>
      <categories>
        <category>pythonçˆ¬è™«</category>
        <category>çˆ¬è™«æ‹“å±•åŠŸèƒ½</category>
      </categories>
      <tags>
        <tag>çˆ¬è™«</tag>
        <tag>Androidåç¼–è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŒºå—é“¾å¯†ç å­¦]]></title>
    <url>%2F2019%2F01%2F28%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2F%E5%8C%BA%E5%9D%97%E9%93%BE%E6%A6%82%E5%BF%B5%2F2.%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AF%86%E7%A0%81%E5%AD%A6%2F</url>
    <content type="text"><![CDATA[å¯†ç å­¦ç®—æ³•Hashç®—æ³•å®šä¹‰ Hashï¼ˆå“ˆå¸Œæˆ–æ•£åˆ—ï¼‰ç®—æ³•ï¼Œåˆå¸¸è¢«ç§°ä¸ºæŒ‡çº¹ï¼ˆfingerprintï¼‰æˆ–æ‘˜è¦ï¼ˆdigestï¼‰ç®—æ³•ï¼Œæ˜¯éå¸¸åŸºç¡€ä¹Ÿéå¸¸é‡è¦çš„ä¸€ç±»ç®—æ³•ã€‚å¯ä»¥å°†ä»»æ„é•¿åº¦çš„äºŒè¿›åˆ¶æ˜æ–‡ä¸²æ˜ å°„ä¸ºè¾ƒçŸ­çš„ï¼ˆé€šå¸¸æ˜¯å›ºå®šé•¿åº¦çš„ï¼‰äºŒè¿›åˆ¶ä¸²ï¼ˆHash å€¼ï¼‰ï¼Œå¹¶ä¸”ä¸åŒçš„æ˜æ–‡å¾ˆéš¾æ˜ å°„ä¸ºç›¸åŒçš„ Hash å€¼ï¼Œä¸”ç®—æ³•ä¸å¯é€†ï¼Œä¾‹å¦‚: MD5ã€SHA-1ã€SHA-2ã€SHA-256ï¼› æ¯”å¦‚åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œåªéœ€è¦åˆ¤æ–­ä¸¤å­—ç¬¦ä¸²çš„hashå€¼æ˜¯å¦ç›¸ç­‰å°±å¯ä»¥åŸºæœ¬æ–­å®šä¸¤å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼› Hash ç®—æ³•å¹¶ä¸æ˜¯ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œä¸èƒ½ç”¨äºå¯¹ä¿¡æ¯çš„ä¿æŠ¤ã€‚ä½† Hash ç®—æ³•å¯è¢«åº”ç”¨åˆ°å¯¹ç™»å½•å£ä»¤çš„ä¿å­˜ä¸Šã€‚ä¾‹å¦‚ç½‘ç«™ç™»å½•æ—¶éœ€è¦éªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœç½‘ç«™åå°ç›´æ¥ä¿å­˜ç”¨æˆ·çš„å£ä»¤åŸæ–‡ï¼Œä¸€æ—¦å‘ç”Ÿæ•°æ®åº“æ³„éœ²åæœä¸å ªè®¾æƒ³ï¼ˆäº‹å®ä¸Šï¼Œç½‘ç«™æ•°æ®åº“æ³„éœ²äº‹ä»¶åœ¨å›½å†…å¤–éƒ½ä¸å°‘è§ï¼‰ã€‚åˆ©ç”¨ Hash çš„é˜²ç¢°æ’ç‰¹æ€§ï¼Œåå°æ•°æ®åº“å¯ä»¥ä»…ä¿å­˜ç”¨æˆ·å£ä»¤çš„ Hash å€¼ï¼Œè¿™æ ·æ¯æ¬¡é€šè¿‡ Hash å€¼æ¯”å¯¹ï¼Œå³å¯åˆ¤æ–­è¾“å…¥å£ä»¤æ˜¯å¦æ­£ç¡®ã€‚å³ä¾¿æ•°æ®åº“æ³„éœ²äº†ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•è½»æ˜“ä» Hash å€¼è¿˜åŸå›å£ä»¤ã€‚ æ€§è´¨ æ­£å‘å¿«é€Ÿï¼šç»™å®šåŸæ–‡å’Œ Hash ç®—æ³•ï¼Œåœ¨æœ‰é™æ—¶é—´å’Œæœ‰é™èµ„æºå†…èƒ½è®¡ç®—å¾—åˆ° Hash å€¼ï¼› é€†å‘å›°éš¾ï¼šç»™å®šï¼ˆè‹¥å¹²ï¼‰Hash å€¼ï¼Œåœ¨æœ‰é™æ—¶é—´å†…æ— æ³•ï¼ˆåŸºæœ¬ä¸å¯èƒ½ï¼‰é€†æ¨å‡ºåŸæ–‡ï¼› è¾“å…¥æ•æ„Ÿï¼šåŸå§‹è¾“å…¥ä¿¡æ¯å‘ç”Ÿä»»ä½•æ”¹å˜ï¼Œæ–°äº§ç”Ÿçš„ Hash å€¼éƒ½åº”è¯¥å‘ç”Ÿå¾ˆå¤§å˜åŒ–ï¼› ç¢°æ’é¿å…ï¼šå¾ˆéš¾æ‰¾åˆ°ä¸¤æ®µå†…å®¹ä¸åŒçš„æ˜æ–‡ï¼Œä½¿å¾—å®ƒä»¬çš„ Hash å€¼ä¸€è‡´ï¼ˆå³å‘ç”Ÿç¢°æ’ï¼‰ã€‚ å¸¸è§hashç®—æ³• ç›®å‰å¸¸è§çš„ Hash ç®—æ³•åŒ…æ‹¬å›½é™…ä¸Šçš„ Message Digestï¼ˆMDï¼‰ç³»åˆ—å’Œ Secure Hash Algorithmï¼ˆSHAï¼‰ç³»åˆ—ç®—æ³•ï¼Œä»¥åŠå›½å†…çš„ SM3 ç®—æ³•ã€‚ MD ç®—æ³•ä¸»è¦åŒ…æ‹¬ MD4 å’Œ MD5 ä¸¤ä¸ªç®—æ³•ã€‚MD4ï¼ˆRFC 1320ï¼‰æ˜¯ MIT çš„ Ronald L. Rivest åœ¨ 1990 å¹´è®¾è®¡çš„ï¼Œå…¶è¾“å‡ºä¸º 128 ä½ã€‚MD4 å·²è¯æ˜ä¸å¤Ÿå®‰å…¨ã€‚MD5ï¼ˆRFC 1321ï¼‰æ˜¯ Rivest äº 1991 å¹´å¯¹ MD4 çš„æ”¹è¿›ç‰ˆæœ¬ã€‚å®ƒå¯¹è¾“å…¥ä»ä»¥ 512 ä½è¿›è¡Œåˆ†ç»„ï¼Œå…¶è¾“å‡ºæ˜¯ 128 ä½ã€‚MD5 æ¯” MD4 æ›´åŠ å®‰å…¨ï¼Œä½†è¿‡ç¨‹æ›´åŠ å¤æ‚ï¼Œè®¡ç®—é€Ÿåº¦è¦æ…¢ä¸€ç‚¹ã€‚MD5 å·²äº 2004 å¹´è¢«æˆåŠŸç¢°æ’ï¼Œå…¶å®‰å…¨æ€§å·²ä¸è¶³åº”ç”¨äºå•†ä¸šåœºæ™¯ã€‚ã€‚ SHA ç®—æ³•ç”±ç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯é™¢ï¼ˆNational Institute of Standards and Technologyï¼ŒNISTï¼‰å¾é›†åˆ¶å®šã€‚é¦–ä¸ªå®ç° SHA-0 ç®—æ³•äº 1993 å¹´é—®ä¸–ï¼Œ1998 å¹´å³é­ç ´è§£ã€‚éšåçš„ä¿®è®¢ç‰ˆæœ¬ SHA-1 ç®—æ³•åœ¨ 1995 å¹´é¢ä¸–ï¼Œå®ƒçš„è¾“å‡ºä¸ºé•¿åº¦ 160 ä½çš„ Hash å€¼ï¼Œå®‰å…¨æ€§æ›´å¥½ã€‚SHA-1 è®¾è®¡é‡‡ç”¨äº† MD4 ç®—æ³•ç±»ä¼¼åŸç†ã€‚SHA-1 å·²äº 2005 å¹´è¢«æˆåŠŸç¢°æ’ï¼Œæ„å‘³ç€æ— æ³•æ»¡è¶³å•†ç”¨éœ€æ±‚ã€‚ ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼ŒNIST åæ¥åˆ¶å®šå‡ºæ›´å®‰å…¨çš„ SHA-224ã€SHA-256ã€SHA-384ï¼Œå’Œ SHA-512 ç®—æ³•ï¼ˆç»Ÿç§°ä¸º SHA-2 ç®—æ³•ï¼‰ã€‚æ–°ä¸€ä»£çš„ SHA-3 ç›¸å…³ç®—æ³•ä¹Ÿæ­£åœ¨ç ”ç©¶ä¸­ã€‚ ç›®å‰ï¼Œ MD5å’ŒSHA1å·²ç»è¢«ç ´è§£ï¼Œä¸€åŠæ¨èä½¿ç”¨SHA2-256æˆ–æ›´å®‰å…¨çš„ç®—æ³• å¯¹ç§°åŠ å¯†ç®—æ³•å®šä¹‰ å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œé¡¾åæ€ä¹‰ï¼ŒåŠ å¯†å’Œè§£å¯†è¿‡ç¨‹çš„å¯†é’¥æ˜¯ç›¸åŒçš„ã€‚è¯¥ç±»ç®—æ³•çš„ä¼˜ç‚¹æ˜¯åŠ è§£å¯†æ•ˆç‡ï¼Œå’ŒåŠ å¯†å¼ºåº¦å¼ºåº¦éƒ½å¾ˆé«˜ã€‚ ç¼ºç‚¹æ˜¯å‚ä¸æ–¹éœ€è¦æå‰æŒæœ‰å¯†é’¥ï¼Œä¸€æ—¦æœ‰äººæ³„éœ²åˆ™ç³»ç»Ÿå®‰å…¨æ€§è¢«ç ´åï¼›å¦å¤–å¦‚ä½•åœ¨ä¸å®‰å…¨é€šé“ä¸­æå‰åˆ†å‘å¯†é’¥ä¹Ÿæ˜¯ä¸ªé—®é¢˜ï¼Œéœ€è¦å€ŸåŠ©é¢å¤–çš„ Diffieâ€“Hellman åå•†åè®®æˆ–éå¯¹ç§°åŠ å¯†ç®—æ³•æ¥å®ç°ã€‚ å¯¹ç§°å¯†ç ä»å®ç°åŸç†ä¸Šå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šåˆ†ç»„å¯†ç å’Œåºåˆ—å¯†ç ã€‚å‰è€…å°†æ˜æ–‡åˆ‡åˆ†ä¸ºå®šé•¿æ•°æ®å—ä½œä¸ºåŸºæœ¬åŠ å¯†å•ä½ï¼Œåº”ç”¨æœ€ä¸ºå¹¿æ³›ã€‚åè€…åˆ™æ¯æ¬¡åªå¯¹ä¸€ä¸ªå­—èŠ‚æˆ–å­—ç¬¦è¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œä¸”å¯†ç ä¸æ–­å˜åŒ–ï¼Œåªç”¨åœ¨ä¸€äº›ç‰¹å®šé¢†åŸŸï¼ˆå¦‚æ•°å­—åª’ä»‹çš„åŠ å¯†ï¼‰ã€‚ åˆ†ç»„å¯¹ç§°åŠ å¯†ç®—æ³• DESï¼ˆData Encryption Standardï¼‰ï¼šç»å…¸çš„åˆ†ç»„åŠ å¯†ç®—æ³•ï¼Œæœ€æ—©æ˜¯ 1977 å¹´ç¾å›½è”é‚¦ä¿¡æ¯å¤„ç†æ ‡å‡†ï¼ˆFIPSï¼‰é‡‡ç”¨ FIPS-46-3ï¼Œå°† 64 ä½æ˜æ–‡åŠ å¯†ä¸º 64 ä½çš„å¯†æ–‡ã€‚å…¶å¯†é’¥é•¿åº¦ä¸º 64 ä½ï¼ˆåŒ…æ‹¬ 8 ä½æ ¡éªŒç ï¼‰ï¼Œç°åœ¨å·²ç»å¾ˆå®¹æ˜“è¢«æš´åŠ›ç ´è§£ï¼› 3DESï¼šä¸‰é‡ DES æ“ä½œï¼šåŠ å¯† â€“&gt; è§£å¯† â€“&gt; åŠ å¯†ï¼Œå¤„ç†è¿‡ç¨‹å’ŒåŠ å¯†å¼ºåº¦ä¼˜äº DESï¼Œä½†ç°åœ¨ä¹Ÿè¢«è®¤ä¸ºä¸å¤Ÿå®‰å…¨ï¼› AESï¼ˆAdvanced Encryption Standardï¼‰ï¼šç”±ç¾å›½å›½å®¶æ ‡å‡†ç ”ç©¶æ‰€ï¼ˆNISTï¼‰é‡‡ç”¨ï¼Œå–ä»£ DES æˆä¸ºå¯¹ç§°åŠ å¯†å®ç°çš„æ ‡å‡†ï¼Œ1997~2000 å¹´ NIST ä» 15 ä¸ªå€™é€‰ç®—æ³•ä¸­è¯„é€‰ Rijndael ç®—æ³•ï¼ˆç”±æ¯”åˆ©æ—¶å¯†ç å­¦å®¶ Joan Daemon å’Œ Vincent Rijmen å‘æ˜ï¼‰ä½œä¸º AESï¼Œæ ‡å‡†ä¸º FIPS-197ã€‚AES ä¹Ÿæ˜¯åˆ†ç»„ç®—æ³•ï¼Œåˆ†ç»„é•¿åº¦ä¸º 128ã€192ã€256 ä½ä¸‰ç§ã€‚AES çš„ä¼˜åŠ¿åœ¨äºå¤„ç†é€Ÿåº¦å¿«ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥æ•°å­¦åŒ–æè¿°ï¼Œç›®å‰å°šæœªæœ‰æœ‰æ•ˆçš„ç ´è§£æ‰‹æ®µï¼› IDEAï¼ˆInternational Data Encryption Algorithmï¼‰ï¼š1991 å¹´ç”±å¯†ç å­¦å®¶ James Massey ä¸æ¥å­¦å˜‰å…±åŒæå‡ºã€‚è®¾è®¡ç±»ä¼¼äº 3DESï¼Œå¯†é’¥é•¿åº¦å¢åŠ åˆ° 128 ä½ï¼Œå…·æœ‰æ›´å¥½çš„åŠ å¯†å¼ºåº¦ã€‚ åºåˆ—åŠ å¯†ç®—æ³• RC4ç®—æ³•: å¯ä»¥é€šè¿‡â€œä¸€æ¬¡æ€§å¯†ç æœ¬â€çš„å¯¹ç§°åŠ å¯†å¤„ç†ã€‚å³é€šä¿¡åŒæ–¹æ¯æ¬¡ä½¿ç”¨è·Ÿæ˜æ–‡ç­‰é•¿çš„éšæœºå¯†é’¥ä¸²å¯¹æ˜æ–‡è¿›è¡ŒåŠ å¯†å¤„ç†ã€‚åºåˆ—å¯†ç é‡‡ç”¨äº†ç±»ä¼¼çš„æ€æƒ³ï¼Œæ¯æ¬¡é€šè¿‡ä¼ªéšæœºæ•°ç”Ÿæˆå™¨æ¥ç”Ÿæˆä¼ªéšæœºå¯†é’¥ä¸²ã€‚ åŠ è§£å¯†åŸç† ç”¨ç›¸åŒçš„å¯†é’¥å¯¹åŸæ–‡è¿›è¡ŒåŠ å¯†å’Œè§£å¯† åŠ å¯†è¿‡ç¨‹: å¯†é’¥ + åŸæ–‡ =&gt; å¯†æ–‡ è§£å¯†è¿‡ç¨‹: å¯†æ–‡ + å¯†é’¥ =&gt; åŸæ–‡ ç¼ºç‚¹ æ— æ³•ç¡®ä¿å¯†é’¥è¢«å®‰å…¨çš„ä¼ é€’ æ— æ³•ä¿è¯æ•°æ®ä¸ä¼šè¢«ç¯¡æ”¹ éå¯¹ç§°åŠ å¯†å®šä¹‰ éå¯¹ç§°åŠ å¯†æ˜¯ç°ä»£å¯†ç å­¦çš„ä¼Ÿå¤§å‘æ˜ï¼Œå®ƒæœ‰æ•ˆè§£å†³äº†å¯¹ç§°åŠ å¯†éœ€è¦å®‰å…¨åˆ†å‘å¯†é’¥çš„é—®é¢˜ã€‚ é¡¾åæ€ä¹‰ï¼Œéå¯¹ç§°åŠ å¯†ä¸­ï¼ŒåŠ å¯†å¯†é’¥å’Œè§£å¯†å¯†é’¥æ˜¯ä¸åŒçš„ï¼Œåˆ†åˆ«è¢«ç§°ä¸ºå…¬é’¥ï¼ˆPublic Keyï¼‰å’Œç§é’¥ï¼ˆPrivate Keyï¼‰ã€‚ç§é’¥ä¸€èˆ¬é€šè¿‡éšæœºæ•°ç®—æ³•ç”Ÿæˆï¼Œå…¬é’¥å¯ä»¥æ ¹æ®ç§é’¥ç”Ÿæˆã€‚ å…¶ä¸­ï¼Œå…¬é’¥ä¸€èˆ¬æ˜¯å…¬å¼€çš„ï¼Œä»–äººå¯è·å–çš„ï¼›ç§é’¥åˆ™æ˜¯ä¸ªäººæŒæœ‰å¹¶ä¸”è¦ä¸¥å¯†ä¿æŠ¤ï¼Œä¸èƒ½è¢«ä»–äººè·å–ã€‚ éå¯¹ç§°åŠ å¯†ç®—æ³•ä¼˜ç‚¹æ˜¯å…¬ç§é’¥åˆ†å¼€ï¼Œæ— éœ€å®‰å…¨é€šé“æ¥åˆ†å‘å¯†é’¥ã€‚ç¼ºç‚¹æ˜¯å¤„ç†é€Ÿåº¦ï¼ˆç‰¹åˆ«æ˜¯ç”Ÿæˆå¯†é’¥å’Œè§£å¯†è¿‡ç¨‹ï¼‰å¾€å¾€æ¯”è¾ƒæ…¢ï¼Œä¸€èˆ¬æ¯”å¯¹ç§°åŠ è§£å¯†ç®—æ³•æ…¢ 2~3 ä¸ªæ•°é‡çº§ï¼›åŒæ—¶åŠ å¯†å¼ºåº¦ä¹Ÿå¾€å¾€ä¸å¦‚å¯¹ç§°åŠ å¯†ã€‚ éå¯¹ç§°åŠ å¯†ç®—æ³•çš„å®‰å…¨æ€§å¾€å¾€åŸºäºæ•°å­¦é—®é¢˜ï¼ŒåŒ…æ‹¬å¤§æ•°è´¨å› å­åˆ†è§£ã€ç¦»æ•£å¯¹æ•°ã€æ¤­åœ†æ›²çº¿ç­‰ç»å…¸æ•°å­¦éš¾é¢˜ã€‚ ä»£è¡¨ç®—æ³•åŒ…æ‹¬ï¼šRSAã€ElGamalã€æ¤­åœ†æ›²çº¿ï¼ˆElliptic Curve Crytosystemsï¼ŒECCï¼‰ã€SM2 ç­‰ç³»åˆ—ç®—æ³•ã€‚ å¸¸ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³• RSAï¼šç»å…¸çš„å…¬é’¥ç®—æ³•ï¼Œ1978 å¹´ç”± Ron Rivestã€Adi Shamirã€Leonard Adleman å…±åŒæå‡ºï¼Œä¸‰äººäº 2002 å¹´å› æ­¤è·å¾—å›¾çµå¥–ã€‚ç®—æ³•åˆ©ç”¨äº†å¯¹å¤§æ•°è¿›è¡Œè´¨å› å­åˆ†è§£å›°éš¾çš„ç‰¹æ€§ï¼Œä½†ç›®å‰è¿˜æ²¡æœ‰æ•°å­¦è¯æ˜ä¸¤è€…éš¾åº¦ç­‰ä»·ï¼Œæˆ–è®¸å­˜åœ¨æœªçŸ¥ç®—æ³•å¯ä»¥ç»•è¿‡å¤§æ•°åˆ†è§£è€Œè¿›è¡Œè§£å¯†ã€‚ ElGamalï¼šç”± Taher ElGamal è®¾è®¡ï¼Œåˆ©ç”¨äº†æ¨¡è¿ç®—ä¸‹æ±‚ç¦»æ•£å¯¹æ•°å›°éš¾çš„ç‰¹æ€§ï¼Œæ¯” RSA äº§ç”Ÿå¯†é’¥æ›´å¿«ã€‚è¢«åº”ç”¨åœ¨ PGP ç­‰å®‰å…¨å·¥å…·ä¸­ã€‚ æ¤­åœ†æ›²çº¿ç®—æ³•ï¼ˆElliptic Curve Cryptographyï¼ŒECCï¼‰ï¼šåº”ç”¨æœ€å¹¿ä¹Ÿæ˜¯å¼ºåº¦æœ€æ—©çš„ç³»åˆ—ç®—æ³•ï¼ŒåŸºäºå¯¹æ¤­åœ†æ›²çº¿ä¸Šç‰¹å®šç‚¹è¿›è¡Œç‰¹æ®Šä¹˜æ³•é€†è¿ç®—ï¼ˆæ±‚ç¦»æ•£å¯¹æ•°ï¼‰éš¾ä»¥è®¡ç®—çš„ç‰¹æ€§ã€‚æœ€æ—©åœ¨ 1985 å¹´ç”± Neal Koblitz å’Œ Victor Miller åˆ†åˆ«ç‹¬ç«‹æå‡ºã€‚ECC ç³»åˆ—ç®—æ³•å…·æœ‰å¤šç§å›½é™…æ ‡å‡†ï¼ˆåŒ…æ‹¬ ANSI X9.63ã€NIST FIPS 186-2ã€IEEE 1363-2000ã€ISO/IEC 14888-3 ç­‰ï¼‰ï¼Œä¸€èˆ¬è¢«è®¤ä¸ºå…·å¤‡è¾ƒé«˜çš„å®‰å…¨æ€§ï¼Œä½†åŠ è§£å¯†è¿‡ç¨‹æ¯”è¾ƒè´¹æ—¶ã€‚å…¶ä¸­ï¼Œå¯†ç å­¦å®¶ Daniel J.Bernstein äº 2006 å¹´æå‡ºçš„ Curve25519/Ed25519/X25519 ç­‰ç®—æ³•ï¼ˆåˆ†åˆ«è§£å†³åŠ å¯†ã€ç­¾åå’Œå¯†é’¥äº¤æ¢ï¼‰ï¼Œç”±äºå…¶è®¾è®¡å®Œå…¨å…¬å¼€ã€æ€§èƒ½çªå‡ºç­‰ç‰¹ç‚¹ï¼Œè¿‘äº›å¹´å¼•èµ·äº†å¹¿æ³›å…³æ³¨å’Œåº”ç”¨ã€‚ SM2ï¼ˆShangMi 2ï¼‰ï¼šä¸­å›½å›½å®¶å•†ç”¨å¯†ç ç³»åˆ—ç®—æ³•æ ‡å‡†ï¼Œç”±ä¸­å›½å¯†ç ç®¡ç†å±€äº 2010 å¹´ 12 æœˆ 17 æ—¥å‘å¸ƒï¼ŒåŒæ ·åŸºäºæ¤­åœ†æ›²çº¿ç®—æ³•ï¼Œä¸€èˆ¬è®¤ä¸ºå…¶å®‰å…¨å¼ºåº¦ä¼˜äº RSA ç³»åˆ—ç®—æ³•ã€‚ éå¯¹ç§°åŠ å¯†ç®—æ³•é€‚ç”¨äºç­¾ååœºæ™¯æˆ–å¯†é’¥åå•†è¿‡ç¨‹ï¼Œä½†ä¸é€‚äºå¤§é‡æ•°æ®çš„åŠ è§£å¯†ã€‚é™¤äº† SM2 ä¹‹å¤–ï¼Œå¤§éƒ¨åˆ†ç®—æ³•çš„ç­¾åé€Ÿåº¦è¦æ¯”éªŒç­¾é€Ÿåº¦æ…¢ï¼ˆ1~2ä¸ªæ•°é‡çº§ï¼‰ã€‚ RSA ç±»ç®—æ³•è¢«è®¤ä¸ºå·²ç»å¾ˆéš¾æŠµå¾¡ç°ä»£è®¡ç®—è®¾å¤‡çš„ç ´è§£ï¼Œä¸€èˆ¬æ¨èå•†ç”¨åœºæ™¯ä¸‹å¯†é’¥è‡³å°‘ä¸º 2048 ä½ã€‚å¦‚æœé‡‡ç”¨å®‰å…¨å¼ºåº¦æ›´é«˜çš„æ¤­åœ†æ›²çº¿ç®—æ³•ï¼Œ256 ä½å¯†é’¥å³å¯æ»¡è¶³ç»å¤§éƒ¨åˆ†å®‰å…¨éœ€æ±‚ã€‚ æ€§è´¨ å…¬é’¥ç”¨äºåŠ å¯†, ç§é’¥ç”¨äºè§£å¯† å…¬é’¥ç”±ç§é’¥ç”Ÿæˆï¼Œç§é’¥å¯ä»¥æ¨å¯¼å‡ºå…¬é’¥ ä»å…¬é’¥æ— æ³•æ¨å¯¼å‡ºç§é’¥ ä¼˜ç‚¹ è§£å†³äº†å¯†é’¥ä¼ è¾“ä¸­çš„å®‰å…¨æ€§é—®é¢˜ è§£å†³äº†æ•°æ®æºç¡®å®šæ€§çš„é—®é¢˜ ç¼ºç‚¹ æ²¡æœ‰è§£å†³æ•°æ®å¯ä»¥ä¸­é€”è¢«ç¯¡æ”¹çš„é—®é¢˜ æ¶ˆæ¯è®¤è¯ç ä¸æ•°å­—ç­¾åæ¶ˆæ¯è®¤è¯ç å’Œæ•°å­—ç­¾åæŠ€æœ¯é€šè¿‡å¯¹æ¶ˆæ¯çš„æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œå¯ä»¥é˜²æ­¢æ¶ˆæ¯è¢«ç¯¡æ”¹å’Œè®¤è¯èº«ä»½ã€‚ æ¶ˆæ¯è®¤è¯ç å®šä¹‰ æ¶ˆæ¯è®¤è¯ç ï¼ˆHash-based Message Authentication Codeï¼ŒHMACï¼‰ï¼Œåˆ©ç”¨å¯¹ç§°åŠ å¯†ï¼Œå¯¹æ¶ˆæ¯å®Œæ•´æ€§ï¼ˆIntegrityï¼‰è¿›è¡Œä¿æŠ¤ã€‚ åŸºæœ¬è¿‡ç¨‹ä¸ºå¯¹æŸä¸ªæ¶ˆæ¯ï¼Œåˆ©ç”¨æå‰å…±äº«çš„å¯¹ç§°å¯†é’¥å’Œ Hash ç®—æ³•è¿›è¡Œå¤„ç†ï¼Œå¾—åˆ° HMAC å€¼ã€‚è¯¥ HMAC å€¼æŒæœ‰æ–¹å¯ä»¥å‘å¯¹æ–¹è¯æ˜è‡ªå·±æ‹¥æœ‰æŸä¸ªå¯¹ç§°å¯†é’¥ï¼Œå¹¶ä¸”ç¡®ä¿æ‰€ä¼ è¾“æ¶ˆæ¯å†…å®¹æœªè¢«ç¯¡æ”¹ã€‚ å…¸å‹çš„ HMAC ç”Ÿæˆç®—æ³•åŒ…æ‹¬ Kï¼ŒHï¼ŒM ä¸‰ä¸ªå‚æ•°ã€‚K ä¸ºæå‰å…±äº«çš„å¯¹ç§°å¯†é’¥ï¼ŒH ä¸ºæå‰å•†å®šçš„ Hash ç®—æ³•ï¼ˆå¦‚ SHA-256ï¼‰ï¼ŒM ä¸ºè¦ä¼ è¾“çš„æ¶ˆæ¯å†…å®¹ã€‚ä¸‰ä¸ªå‚æ•°ç¼ºå¤±äº†ä»»ä½•ä¸€ä¸ªï¼Œéƒ½æ— æ³•å¾—åˆ°æ­£ç¡®çš„ HMAC å€¼ã€‚ æ¶ˆæ¯è®¤è¯ç å¯ä»¥ç”¨äºç®€å•è¯æ˜èº«ä»½çš„åœºæ™¯ã€‚å¦‚ Aliceã€Bob æå‰å…±äº«äº† K å’Œ Hã€‚Alice éœ€è¦çŸ¥æ™“å¯¹æ–¹æ˜¯å¦ä¸º Bobï¼Œå¯å‘é€ä¸€æ®µæ¶ˆæ¯ M ç»™ Bobã€‚Bob æ”¶åˆ° M åè®¡ç®—å…¶ HMAC å€¼å¹¶è¿”å›ç»™ Aliceï¼ŒAlice æ£€éªŒæ”¶åˆ° HMAC å€¼çš„æ­£ç¡®æ€§å¯ä»¥éªŒè¯å¯¹æ–¹æ˜¯å¦çœŸæ˜¯ Bobã€‚å½“ç„¶ï¼Œæ¶ˆæ¯è®¤è¯ç èµ·ä½œç”¨çš„å‰ææ˜¯ç½‘ç»œä¸­æ²¡æœ‰ä¸­é—´äººæ”»å‡»çš„æƒ…å†µï¼Œå‡è®¾ç½‘ç»œæ˜¯å®‰å…¨çš„ï¼Œå› æ­¤åœ¨å…¬ç½‘ä¸­ï¼Œä¸€åŠä¸ä¼šä½¿ç”¨æ¶ˆæ¯è®¤è¯ç æ¥è¿›è¡Œèº«ä»½éªŒè¯ï¼› æ¶ˆæ¯è®¤è¯ç çš„ä¸»è¦é—®é¢˜æ˜¯éœ€è¦æå‰å…±äº«å¯†é’¥ï¼Œå¹¶ä¸”å½“å¯†é’¥å¯èƒ½è¢«å¤šæ–¹åŒæ—¶æ‹¥æœ‰ï¼ˆç”šè‡³æ³„éœ²ï¼‰çš„åœºæ™¯ä¸‹ï¼Œæ— æ³•è¿½è¸ªæ¶ˆæ¯çš„çœŸå®æ¥æºã€‚å¦‚æœé‡‡ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œåˆ™èƒ½æœ‰æ•ˆçš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå³æ•°å­—ç­¾åã€‚ ç¼ºç‚¹ ä¸èƒ½è§£å†³å¯†é’¥å®‰å…¨ä¼ é€’çš„é—®é¢˜ æ•°å­—ç­¾åå®šä¹‰ ç±»ä¼¼åœ¨çº¸è´¨åˆåŒä¸Šè¿›è¡Œç­¾åä»¥ç¡®è®¤åˆåŒå†…å®¹å’Œè¯æ˜èº«ä»½ï¼Œæ•°å­—ç­¾åæ—¢å¯ä»¥è¯å®æŸæ•°å­—å†…å®¹çš„å®Œæ•´æ€§ï¼Œåˆå¯ä»¥ç¡®è®¤å…¶æ¥æºï¼ˆå³ä¸å¯æŠµèµ–ï¼ŒNon-Repudiationï¼‰ã€‚ ä¸€ä¸ªå…¸å‹çš„åœºæ™¯æ˜¯ï¼ŒAlice é€šè¿‡ä¿¡é“å‘ç»™ Bob ä¸€ä¸ªæ–‡ä»¶ï¼ˆä¸€ä»½ä¿¡æ¯ï¼‰ï¼ŒBob å¦‚ä½•è·çŸ¥æ‰€æ”¶åˆ°çš„æ–‡ä»¶å³ä¸º Alice å‘å‡ºçš„åŸå§‹ç‰ˆæœ¬ï¼ŸAlice å¯ä»¥å…ˆå¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ‘˜è¦ï¼Œç„¶åç”¨è‡ªå·±çš„ç§é’¥å¯¹æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼ˆç­¾åï¼‰ï¼Œä¹‹ååŒæ—¶å°†æ–‡ä»¶å’Œç­¾åéƒ½å‘ç»™ Bobã€‚Bob æ”¶åˆ°æ–‡ä»¶å’Œç­¾ååï¼Œç”¨ Alice çš„å…¬é’¥æ¥è§£å¯†ç­¾åï¼Œå¾—åˆ°æ•°å­—æ‘˜è¦ï¼Œä¸å¯¹æ–‡ä»¶è¿›è¡Œæ‘˜è¦åçš„ç»“æœè¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœä¸€è‡´ï¼Œè¯´æ˜è¯¥æ–‡ä»¶ç¡®å®æ˜¯ Alice å‘è¿‡æ¥çš„ï¼ˆå› ä¸ºåˆ«äººæ— æ³•æ‹¥æœ‰ Alice çš„ç§é’¥ï¼‰ï¼Œå¹¶ä¸”æ–‡ä»¶å†…å®¹æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼ˆæ‘˜è¦ç»“æœä¸€è‡´ï¼‰ã€‚ ç†è®ºä¸Šæ‰€æœ‰çš„éå¯¹ç§°åŠ å¯†ç®—æ³•éƒ½å¯ä»¥ç”¨æ¥å®ç°æ•°å­—ç­¾åï¼Œå®è·µä¸­å¸¸ç”¨ç®—æ³•åŒ…æ‹¬ 1991 å¹´ 8 æœˆ NIST æå‡ºçš„ DSAï¼ˆDigital Signature Algorithmï¼ŒåŸºäº ElGamal ç®—æ³•ï¼‰å’Œå®‰å…¨å¼ºåº¦æ›´é«˜çš„ ECSDAï¼ˆElliptic Curve Digital Signature Algorithmï¼ŒåŸºäºæ¤­åœ†æ›²çº¿ç®—æ³•ï¼‰ç­‰ã€‚ é™¤æ™®é€šçš„æ•°å­—ç­¾ååº”ç”¨åœºæ™¯å¤–ï¼Œé’ˆå¯¹ä¸€äº›ç‰¹å®šçš„å®‰å…¨éœ€æ±‚ï¼Œäº§ç”Ÿäº†ä¸€äº›ç‰¹æ®Šæ•°å­—ç­¾åæŠ€æœ¯ï¼ŒåŒ…æ‹¬ç›²ç­¾åã€å¤šé‡ç­¾åã€ç¾¤ç­¾åã€ç¯ç­¾åç­‰ã€‚ æ•°å­—ç­¾åçš„ç±»å‹ ç›²ç­¾å ç›²ç­¾åï¼ˆBlind Signatureï¼‰ï¼Œ1982 å¹´ç”± David Chaum åœ¨è®ºæ–‡ã€ŠBlind Signatures for Untraceable Paymentã€‹ä¸­æå‡ºã€‚ç­¾åè€…éœ€è¦åœ¨æ— æ³•çœ‹åˆ°åŸå§‹å†…å®¹çš„å‰æä¸‹å¯¹ä¿¡æ¯è¿›è¡Œç­¾åã€‚ ç›²ç­¾åå¯ä»¥å®ç°å¯¹æ‰€ç­¾åå†…å®¹çš„ä¿æŠ¤ï¼Œé˜²æ­¢ç­¾åè€…çœ‹åˆ°åŸå§‹å†…å®¹ï¼›å¦ä¸€æ–¹é¢ï¼Œç›²ç­¾åè¿˜å¯ä»¥å®ç°é˜²æ­¢è¿½è¸ªï¼ˆUnlinkabilityï¼‰ï¼Œç­¾åè€…æ— æ³•å°†ç­¾åå†…å®¹å’Œç­¾åç»“æœè¿›è¡Œå¯¹åº”ã€‚å…¸å‹çš„å®ç°åŒ…æ‹¬ RSA ç›²ç­¾åç®—æ³•ç­‰ã€‚ å¤šé‡ç­¾å å¤šé‡ç­¾åï¼ˆMultiple Signatureï¼‰ï¼Œå³ n ä¸ªç­¾åè€…ä¸­ï¼Œæ”¶é›†åˆ°è‡³å°‘ m ä¸ªï¼ˆn &gt;= m &gt;= 1ï¼‰çš„ç­¾åï¼Œå³è®¤ä¸ºåˆæ³•ã€‚ å…¶ä¸­ï¼Œn æ˜¯æä¾›çš„å…¬é’¥ä¸ªæ•°ï¼Œm æ˜¯éœ€è¦åŒ¹é…å…¬é’¥çš„æœ€å°‘çš„ç­¾åä¸ªæ•°ã€‚ å¤šé‡ç­¾åå¯ä»¥æœ‰æ•ˆåœ°è¢«åº”ç”¨åœ¨å¤šäººæŠ•ç¥¨å…±åŒå†³ç­–çš„åœºæ™¯ä¸­ã€‚ä¾‹å¦‚åŒæ–¹è¿›è¡Œåå•†ï¼Œç¬¬ä¸‰æ–¹ä½œä¸ºå®¡æ ¸æ–¹ã€‚ä¸‰æ–¹ä¸­ä»»ä½•ä¸¤æ–¹è¾¾æˆä¸€è‡´å³å¯å®Œæˆåå•†ã€‚ æ¯”ç‰¹å¸äº¤æ˜“ä¸­å°±æ”¯æŒå¤šé‡ç­¾åï¼Œå¯ä»¥å®ç°å¤šä¸ªäººå…±åŒç®¡ç†æŸä¸ªè´¦æˆ·çš„æ¯”ç‰¹å¸äº¤æ˜“ã€‚ ç¾¤ç­¾å ç¾¤ç­¾åï¼ˆGroup Signatureï¼‰ï¼Œå³æŸä¸ªç¾¤ç»„å†…ä¸€ä¸ªæˆå‘˜å¯ä»¥ä»£è¡¨ç¾¤ç»„è¿›è¡ŒåŒ¿åç­¾åã€‚ç­¾åå¯ä»¥éªŒè¯æ¥è‡ªäºè¯¥ç¾¤ç»„ï¼Œå´æ— æ³•å‡†ç¡®è¿½è¸ªåˆ°ç­¾åçš„æ˜¯å“ªä¸ªæˆå‘˜ã€‚ ç¾¤ç­¾åéœ€è¦å­˜åœ¨ä¸€ä¸ªç¾¤ç®¡ç†å‘˜æ¥æ·»åŠ æ–°çš„ç¾¤æˆå‘˜ï¼Œå› æ­¤å­˜åœ¨ç¾¤ç®¡ç†å‘˜å¯èƒ½è¿½è¸ªåˆ°ç­¾åæˆå‘˜èº«ä»½çš„é£é™©ã€‚ ç¾¤ç­¾åæœ€æ—©åœ¨ 1991 å¹´ç”± David Chaum å’Œ Eugene van Heyst æå‡ºã€‚ ç¯ç­¾å ç¯ç­¾åï¼ˆRing Signatureï¼‰ï¼Œç”± Rivestï¼ŒShamir å’Œ Tauman ä¸‰ä½å¯†ç å­¦å®¶åœ¨ 2001 å¹´é¦–æ¬¡æå‡ºã€‚ç¯ç­¾åå±äºä¸€ç§ç®€åŒ–çš„ç¾¤ç­¾åã€‚ ç­¾åè€…é¦–å…ˆé€‰å®šä¸€ä¸ªä¸´æ—¶çš„ç­¾åè€…é›†åˆï¼Œé›†åˆä¸­åŒ…æ‹¬ç­¾åè€…è‡ªèº«ã€‚ç„¶åç­¾åè€…åˆ©ç”¨è‡ªå·±çš„ç§é’¥å’Œç­¾åé›†åˆä¸­å…¶ä»–äººçš„å…¬é’¥å°±å¯ä»¥ç‹¬ç«‹çš„äº§ç”Ÿç­¾åï¼Œè€Œæ— éœ€ä»–äººçš„å¸®åŠ©ã€‚ç­¾åè€…é›†åˆä¸­çš„å…¶ä»–æˆå‘˜å¯èƒ½å¹¶ä¸çŸ¥é“è‡ªå·±è¢«åŒ…å«åœ¨æœ€ç»ˆçš„ç­¾åä¸­ã€‚ ç¯ç­¾ååœ¨ä¿æŠ¤åŒ¿åæ€§æ–¹é¢ä¹Ÿå…·æœ‰å¾ˆå¤šç”¨é€”ã€‚ ä¼˜ç‚¹ è§£å†³äº†å¯†é’¥ä¼ è¾“ä¸­çš„å®‰å…¨æ€§é—®é¢˜ è§£å†³äº†æ•°æ®ä¸­é€”å¯èƒ½è¢«ç¯¡æ”¹çš„é—®é¢˜ è§£å†³äº†æ•°æ®æºéªŒè¯çš„é—®é¢˜ è¯ä¹¦æˆæƒä¸­å¿ƒ-CAå®šä¹‰ å¯¹äºéå¯¹ç§°åŠ å¯†ç®—æ³•å’Œæ•°å­—ç­¾åæ¥è¯´ï¼Œå¾ˆé‡è¦çš„æ­¥éª¤å°±æ˜¯å…¬é’¥çš„åˆ†å‘ã€‚ç†è®ºä¸Šä»»ä½•äººéƒ½å¯ä»¥è·å–åˆ°å…¬å¼€çš„å…¬é’¥ã€‚ç„¶è€Œè¿™ä¸ªå…¬é’¥æ–‡ä»¶æœ‰æ²¡æœ‰å¯èƒ½æ˜¯ä¼ªé€ çš„å‘¢ï¼Ÿä¼ è¾“è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰å¯èƒ½è¢«ç¯¡æ”¹å‘¢ï¼Ÿä¸€æ—¦å…¬é’¥è‡ªèº«å‡ºäº†é—®é¢˜ï¼Œåˆ™æ•´ä¸ªå»ºç«‹åœ¨å…¶ä¸Šçš„çš„å®‰å…¨æ€§å°†ä¸å¤æˆç«‹ã€‚ æ•°å­—è¯ä¹¦æœºåˆ¶æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå°±åƒæ—¥å¸¸ç”Ÿæ´»ä¸­çš„è¯ä¹¦ä¸€æ ·ï¼Œå¯ä»¥ç¡®ä¿æ‰€è®°å½•ä¿¡æ¯çš„åˆæ³•æ€§ã€‚æ¯”å¦‚è¯æ˜æŸä¸ªå…¬é’¥æ˜¯æŸä¸ªå®ä½“ï¼ˆä¸ªäººæˆ–ç»„ç»‡ï¼‰æ‹¥æœ‰ï¼Œå¹¶ä¸”ç¡®ä¿ä»»ä½•ç¯¡æ”¹éƒ½èƒ½è¢«æ£€æµ‹å‡ºæ¥ï¼Œä»è€Œå®ç°å¯¹ç”¨æˆ·å…¬é’¥çš„å®‰å…¨åˆ†å‘ã€‚ æ ¹æ®æ‰€ä¿æŠ¤å…¬é’¥çš„ç”¨é€”ï¼Œæ•°å­—è¯ä¹¦å¯ä»¥åˆ†ä¸ºåŠ å¯†æ•°å­—è¯ä¹¦ï¼ˆEncryption Certificateï¼‰å’Œç­¾åéªŒè¯æ•°å­—è¯ä¹¦ï¼ˆSignature Certificateï¼‰ã€‚å‰è€…å¾€å¾€ç”¨äºä¿æŠ¤ç”¨äºåŠ å¯†ç”¨é€”çš„å…¬é’¥ï¼›åè€…åˆ™ä¿æŠ¤ç”¨äºç­¾åç”¨é€”çš„å…¬é’¥ã€‚ä¸¤ç§ç±»å‹çš„å…¬é’¥ä¹Ÿå¯ä»¥åŒæ—¶æ”¾åœ¨åŒä¸€è¯ä¹¦ä¸­ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯ä¹¦éœ€è¦ç”±è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCertification Authorityï¼ŒCAï¼‰æ¥è¿›è¡Œç­¾å‘å’ŒèƒŒä¹¦ã€‚æƒå¨çš„å•†ä¸šè¯ä¹¦è®¤è¯æœºæ„åŒ…æ‹¬ DigiCertã€GlobalSignã€VeriSign ç­‰ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªè¡Œæ­å»ºæœ¬åœ° CA ç³»ç»Ÿï¼Œåœ¨ç§æœ‰ç½‘ç»œä¸­è¿›è¡Œä½¿ç”¨ã€‚ CAè§£å†³çš„é—®é¢˜ CAè§£å†³äº†ç”µå­å•†åŠ¡ä¸­å…¬é’¥çš„å¯ä¿¡åº¦çš„é—®é¢˜ è´Ÿè´£è¯æ˜ â€œæˆ‘ç¡®å®æ˜¯æˆ‘â€ CAæ˜¯å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹ï¼Œå…¬é’¥çš„åˆæ³•æ€§æ ¡éªŒ CAè¯ä¹¦çš„å†…å®¹ è¯ä¹¦çš„æŒæœ‰äººçš„å…¬é’¥ è¯ä¹¦æˆæƒä¸­å¿ƒçš„åç§° è¯ä¹¦çš„æœ‰æ•ˆæœŸ è¯ä¹¦æˆæƒä¸­å¿ƒçš„æ•°å­—ç­¾å åŒºå—é“¾çš„å¯†ç å­¦åº”ç”¨åŒºå—é“¾ä½¿ç”¨çš„å¯†ç å­¦å‡½æ•°åŒºå—é“¾æŠ€æœ¯çš„è¿è¡Œä¸­ä½¿ç”¨äº†å¤šé¡¹å¯†ç å­¦å‡½æ•°ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„å‡½æ•°åŒ…æ‹¬ä»¥ä¸‹ç®—æ³• å“ˆå¸Œç®—æ³• æ•°å­—ç­¾å é›¶çŸ¥è¯†è¯æ˜ å“ˆå¸Œç®—æ³•åœ¨åŒºå—é“¾ç³»ç»Ÿä¸­çš„åº”ç”¨å“ˆå¸Œå‡½æ•°çš„ç‰¹æ€§ ç¡®å®šæ€§ï¼šæ— è®ºåœ¨åŒä¸€ä¸ªå“ˆå¸Œå‡½æ•°ä¸­è§£æå¤šå°‘æ¬¡ï¼Œè¾“å…¥åŒä¸€ä¸ªAæ€»æ˜¯èƒ½å¾—åˆ°ç›¸åŒçš„è¾“å‡ºh(A)ã€‚ é«˜æ•ˆè¿ç®—ï¼šè®¡ç®—å“ˆå¸Œå€¼çš„è¿‡ç¨‹æ˜¯é«˜æ•ˆçš„ã€‚ æŠ—åŸåƒæ”»å‡»ï¼ˆéšåŒ¿æ€§ï¼‰ï¼šå¯¹ä¸€ä¸ªç»™å®šçš„è¾“å‡ºç»“æœh(A)ï¼Œæƒ³è¦é€†æ¨å‡ºè¾“å…¥Aï¼Œåœ¨è®¡ç®—ä¸Šæ˜¯ä¸å¯è¡Œçš„ã€‚ æŠ—ç¢°æ’æ€§ï¼ˆæŠ—å¼±ç¢°æ’æ€§ï¼‰ï¼šå¯¹ä»»ä½•ç»™å®šçš„Aå’ŒBï¼Œæ‰¾åˆ°æ»¡è¶³Bâ‰ Aä¸”h(A)=h(B)çš„Bï¼Œåœ¨è®¡ç®—ä¸Šæ˜¯ä¸å¯è¡Œçš„ã€‚ ç»†å¾®å˜åŒ–å½±å“ï¼šä»»ä½•è¾“å…¥ç«¯çš„ç»†å¾®å˜åŒ–éƒ½ä¼šå¯¹å“ˆå¸Œå‡½æ•°çš„è¾“å‡ºç»“æœäº§ç”Ÿå‰§çƒˆå½±å“ã€‚ è°œé¢˜å‹å¥½æ€§ï¼šå¯¹ä»»æ„ç»™å®šçš„Hashç Yå’Œè¾“å…¥å€¼xè€Œè¨€ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³h(k|x)=Yçš„kå€¼åœ¨è®¡ç®—ä¸Šæ˜¯ä¸å¯è¡Œçš„ã€‚ åŒºå—é“¾æ•°æ®ç»“æ„åŒºå—é“¾è´¦æœ¬çš„æ•°æ®ç»“æ„å’Œé“¾è¡¨ç»“æ„æ¯”è¾ƒç±»ä¼¼ï¼Œ åªä¸è¿‡åŒºå—æŒ‡å‘çš„æ˜¯è€åŒºå—å¤´éƒ¨çš„hashå€¼ï¼› åŒºå—é“¾çš„æ„æˆå¦‚ä¸‹å›¾ï¼š åŒºå—é“¾æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå…¶ä¸­çš„æ¯ä¸ªæ–°åŒºå—éƒ½åŒ…å«ä¸€ä¸ªå“ˆå¸ŒæŒ‡é’ˆã€‚æŒ‡é’ˆæŒ‡å‘å‰ä¸€åŒºå—åŠå…¶å«æœ‰çš„æ‰€æœ‰æ•°æ®çš„å“ˆå¸Œå€¼ã€‚å‡è®¾ä¿®æ”¹æŸä¸€ä¸ªåŒºå—å†…å®¹ï¼Œå³ä½¿æ˜¯å¾ˆå¾®å°çš„å˜åŒ–ï¼Œé‚£ä¹Ÿä¼šå¯¹å…¶hashå€¼äº§ç”Ÿå¾ˆå¤§çš„å½±å“ï¼Œå¯¼è‡´åŒºå—ä¸èƒ½å’Œä¸‹ä¸€ä¸ªåŒºå—ç»„æˆé“¾ï¼› å› æ­¤ï¼Œæ¯ä¸€ä¸ªåŒºå—ä¹‹é—´éƒ½æœ‰äº†ä¸å¯ç¯¡æ”¹çš„ç‰¹æ€§ã€‚ æ¢…å…‹è€³æ ‘é»˜å…‹å°”æ ‘ï¼ˆåˆå«å“ˆå¸Œæ ‘ï¼‰æ˜¯ä¸€ç§å…¸å‹çš„äºŒå‰æ ‘ç»“æ„ï¼Œç”±ä¸€ä¸ªæ ¹èŠ‚ç‚¹ã€ä¸€ç»„ä¸­é—´èŠ‚ç‚¹å’Œä¸€ç»„å¶èŠ‚ç‚¹ç»„æˆã€‚é»˜å…‹å°”æ ‘æœ€æ—©ç”± Merkle Ralf åœ¨ 1980 å¹´æå‡ºï¼Œæ›¾å¹¿æ³›ç”¨äºæ–‡ä»¶ç³»ç»Ÿå’Œ P2P ç³»ç»Ÿä¸­ã€‚ å…¶ä¸»è¦ç‰¹ç‚¹ä¸ºï¼š æœ€ä¸‹é¢çš„å¶èŠ‚ç‚¹åŒ…å«å­˜å‚¨æ•°æ®æˆ–å…¶å“ˆå¸Œå€¼ã€‚ éå¶å­èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬ä¸­é—´èŠ‚ç‚¹å’Œæ ¹èŠ‚ç‚¹ï¼‰éƒ½æ˜¯å®ƒçš„ä¸¤ä¸ªå­©å­èŠ‚ç‚¹å†…å®¹çš„å“ˆå¸Œå€¼ã€‚ è¿›ä¸€æ­¥åœ°ï¼Œé»˜å…‹å°”æ ‘å¯ä»¥æ¨å¹¿åˆ°å¤šå‰æ ‘çš„æƒ…å½¢ï¼Œæ­¤æ—¶éå¶å­èŠ‚ç‚¹çš„å†…å®¹ä¸ºå®ƒæ‰€æœ‰çš„å­©å­èŠ‚ç‚¹çš„å†…å®¹çš„å“ˆå¸Œå€¼ã€‚ é»˜å…‹å°”æ ‘é€å±‚è®°å½•å“ˆå¸Œå€¼çš„ç‰¹ç‚¹ï¼Œè®©å®ƒå…·æœ‰äº†ä¸€äº›ç‹¬ç‰¹çš„æ€§è´¨ã€‚ä¾‹å¦‚ï¼Œåº•å±‚æ•°æ®çš„ä»»ä½•å˜åŠ¨ï¼Œéƒ½ä¼šä¼ é€’åˆ°å…¶çˆ¶èŠ‚ç‚¹ï¼Œä¸€å±‚å±‚æ²¿ç€è·¯å¾„ä¸€ç›´åˆ°æ ‘æ ¹ã€‚è¿™æ„å‘³æ ‘æ ¹çš„å€¼å®é™…ä¸Šä»£è¡¨äº†å¯¹åº•å±‚æ‰€æœ‰æ•°æ®çš„â€œæ•°å­—æ‘˜è¦â€ã€‚ é»˜å…‹å°”æ ‘ä¸»è¦åŠŸèƒ½æœ‰: 1. å¿«é€Ÿæ¯”è¾ƒå¤§é‡æ•°æ®ï¼› 2. å¿«é€Ÿå®šä½ä¿®æ”¹ï¼› 3. é›¶çŸ¥è¯†è¯æ˜ï¼› åœ¨åŒºå—é“¾ä¸­æ¯ä¸ªåŒºå—éƒ½æœ‰è‡ªå·±çš„æ¢…å…‹å°”æ ¹ï¼ˆMerkle Rootï¼‰ã€‚ç°åœ¨ï¼Œæ­£å¦‚ä½ å·²çŸ¥é“çš„ï¼Œæ¯ä¸ªåŒºå—é‡Œéƒ½åŒ…å«å¤šç¬”äº¤æ˜“ã€‚å¦‚æœå°†è¿™äº›äº¤æ˜“æŒ‰çº¿æ€§å­˜å‚¨ï¼Œé‚£ä¹ˆåœ¨æ‰€æœ‰äº¤æ˜“ä¸­å¯»æ‰¾ä¸€ç¬”ç‰¹å®šäº¤æ˜“çš„è¿‡ç¨‹ä¼šå˜å¾—æ— æ¯”å†—é•¿ã€‚ è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨æ¢…å…‹å°”æ ‘çš„åŸå› ï¼Œ è®©äº¤æ˜“åœ¨åŒºå—ä¸­å˜å¾—å®¹æ˜“å¯»æ‰¾ï¼Œç”±äºhashçš„å¾®ç»†å˜åŒ–å½±å“çš„ç‰¹æ€§ï¼Œä¹Ÿè®©äº¤æ˜“ä¸èƒ½è¢«ä¿®æ”¹ã€‚ åœ¨æ¢…å…‹å°”æ ‘ä¸­ï¼Œæ‰€æœ‰çš„äº¤æ˜“é€šè¿‡å“ˆå¸Œç®—æ³•éƒ½èƒ½å‘ä¸Šè¿½æº¯è‡³åŒä¸€æ ¹ã€‚è¿™å°±ä½¿å¾—æœç´¢å˜å¾—éå¸¸å®¹æ˜“ã€‚å› æ­¤ï¼Œå¦‚æœæƒ³è¦åœ¨åŒºå—é‡Œé¢æ‰¾åˆ°æŸä¸€ä¸ªæŒ‡å®šçš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡æ¢…å…‹å°”æ ‘é‡Œçš„å“ˆå¸Œå€¼æ¥è¿›è¡Œæœç´¢ï¼Œè€Œä¸éœ€è¦éå†æ‰€æœ‰çš„äº¤æ˜“è¿›è¡Œæœç´¢ã€‚ æ¯”å¦‚ï¼Œå…ˆè¦éªŒè¯çº¢è‰²åœ†åœˆçš„äº¤æ˜“æ•°æ®æ˜¯å¦åœ¨åŒºå—å†…ï¼Œåªéœ€è¦æä¾›è“è‰²åœ†åœˆçš„äº¤æ˜“ï¼Œå°±å¯ä»¥æ ¹æ®æœ€ç»ˆç”Ÿæˆçš„hashå€¼å’Œæ¢…å…‹è€³æ ¹å¯¹æ¯”ï¼Œå¦‚æœç»“æœç›¸åŒï¼Œå°±è¯´æ˜äº¤æ˜“ç¡®å®å±äºè¯¥åŒºå—ï¼Œå¹¶ä¸”æ˜¯æ­£ç¡®çš„ã€‚ æŒ–çŸ¿åŠ å¯†è°œé¢˜è¢«ç”¨æ¥æŒ–æ˜æ–°çš„åŒºå—ï¼Œå› æ­¤å“ˆå¸Œç®—æ³•ä»ç„¶è‡³å…³é‡è¦ã€‚å…¶å·¥ä½œåŸç†æ˜¯è°ƒæ•´éš¾åº¦å€¼çš„è®¾å®šã€‚éšåï¼Œä¸€ä¸ªè¢«å‘½åä¸ºâ€œnonceâ€çš„éšæœºå­—ç¬¦ä¸²è¢«æ·»åŠ åˆ°æ–°åŒºå—çš„å“ˆå¸Œå€¼ä¸Šï¼Œç„¶åè¢«å†æ¬¡å“ˆå¸Œã€‚æ¥ç€ï¼Œå†æ¥æ£€éªŒå…¶æ˜¯å¦ä½äºå·²è®¾å®šçš„éš¾åº¦å€¼æ°´å¹³ã€‚å¦‚æœä½äºï¼Œé‚£ä¹ˆäº§ç”Ÿçš„æ–°åŒºå—ä¼šè¢«æ·»åŠ è‡³é“¾ä¸Šï¼Œè€Œè´Ÿè´£æŒ–çŸ¿çš„çŸ¿å·¥å°±ä¼šè·å¾—å¥–åŠ±ã€‚å¦‚æœæ²¡æœ‰ä½äºï¼Œåˆ™çŸ¿å·¥ç»§ç»­ä¿®æ”¹éšå³å­—ç¬¦ä¸²â€œnouceâ€ï¼Œç›´è‡³ä½äºéš¾åº¦å€¼æ°´å¹³çš„å€¼å‡ºç°ã€‚ æ­£å¦‚ä½ æ‰€è§ï¼Œå“ˆå¸Œç®—æ³•æ˜¯åŒºå—é“¾å’ŒåŠ å¯†ç»æµå­¦ä¸­ä¸€ä¸ªè‡³å…³é‡è¦çš„éƒ¨åˆ†ã€‚ å·¥ä½œé‡è¯æ˜æ¦‚å¿µ å½“çŸ¿å·¥ä»¬é€šè¿‡â€œæŒ–çŸ¿â€æ¥äº§ç”Ÿæ–°åŒºå—å¹¶æ·»åŠ è‡³åŒºå—é“¾ä¸Šæ—¶ï¼Œå…¶ä¸­éªŒè¯åŠæ·»åŠ åŒºå—æ¶‰åŠåˆ°çš„å…±è¯†ç³»ç»Ÿè¢«ç§°ä¸ºâ€œå·¥ä½œé‡è¯æ˜â€ã€‚çŸ¿å·¥ä»¬ä½¿ç”¨åºå¤§çš„è®¡ç®—æœºç®—åŠ›æ¥è§£å†³è¿™é“å¯†ç å­¦è°œé¢˜ï¼Œè€Œéš¾åº¦å€¼å†³å®šäº†è¿™é“é¢˜çš„æ‰€éœ€è¦çš„è®¡ç®—é‡ã€‚è¿™æ˜¯åŒºå—é“¾æŠ€æœ¯ä¸­æœ€å…·å¼€æ‹“æ„ä¹‰çš„æœºåˆ¶ä¹‹ä¸€ã€‚æ—©æœŸçš„å»ä¸­å¿ƒåŒ–ç‚¹å¯¹ç‚¹æ•°å­—è´§å¸ç³»ç»Ÿä¹‹æ‰€ä»¥ä¼šå¤±è´¥ï¼Œæ˜¯ç”±äºâ€œæ‹œå åº­å°†å†›é—®é¢˜â€å¯¼è‡´çš„ï¼Œè€Œå·¥ä½œé‡è¯æ˜çš„å…±è¯†ç³»ç»Ÿä¸ºè¯¥é—®é¢˜æä¾›äº†ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ å·¥ä½œé‡è¯æ˜å®é™…ä¸Šå°±æ˜¯å¯¹hashç®—æ³•æ¶ˆè€—çš„ç®—åŠ›çš„åº”ç”¨ï¼Œè®©æ”»å‡»è€…å¾ˆéš¾å»åœ¨è§„å®šæ—¶é—´é›†ä¸­å¦‚æ­¤å¤§çš„ç®—åŠ›ç¯¡æ”¹æ•°æ®å†…å®¹ï¼› æ‹œå åº­å°†å†›é—®é¢˜ å‡è®¾æœ‰ä¸€ç¾¤æ‹œå åº­å°†å†›æƒ³è¦æ”»æ‰“ä¸€åº§åŸå¸‚ï¼Œä»–ä»¬å°†é¢ä¸´ä¸¤ä¸ªä¸åŒçš„é—®é¢˜ï¼š æ¯ä¸ªå°†å†›åŠå…¶å†›é˜Ÿåœ¨åœ°ç†ä¸Šç›¸è·ç”šè¿œï¼Œå› æ­¤ä¸å¯èƒ½é€šè¿‡ä¸­å¤®æ¥ç»Ÿä¸€æŒ‡æŒ¥ï¼Œè¿™ä½¿å¾—ååŒä½œæˆ˜å˜å¾—å¼‚å¸¸å›°éš¾ã€‚ è¢«æ”»æ‰“çš„åŸå¸‚æ‹¥æœ‰ä¸€åªåºå¤§çš„å†›é˜Ÿï¼Œä»–ä»¬èƒ½è·å¾—èƒœåˆ©çš„å”¯ä¸€æ–¹å¼æ˜¯æ‰€æœ‰äººåœ¨åŒä¸€æ—¶åˆ»ä¸€åŒå‘èµ·è¿›æ”»ã€‚ ä¸ºäº†è®©åˆä½œæˆåŠŸï¼Œä½äºåŸå ¡å·¦è¾¹çš„å†›é˜Ÿæ´¾é£ä¸€ä½ä¿¡ä½¿ï¼Œå‘åŸå ¡å³è¾¹çš„å†›é˜Ÿå‘é€äº†ä¸€åˆ™å†…å®¹ä¸ºâ€œå‘¨ä¸‰æ”»å‡»â€çš„ä¿¡æ¯ï¼Œ å¦‚æœæ‰€æœ‰å†›é˜Ÿéƒ½å‡†å¤‡å¥½äº†ï¼Œ é‚£å°±å¯ä»¥ç¡®å®šå‘¨ä¸‰æ”»å‡»ã€‚ä½†æ˜¯ï¼Œå¦‚æœé‚®ç¼–çš„å†›é˜Ÿæ²¡æœ‰åšå¥½æ”»å‡»å‡†å¤‡ï¼Œå¹¶è®©ä¿¡ä½¿æºå¸¦ä¸€åˆ™å†…å®¹ä¸ºâ€œä¸ï¼Œå‘¨äº”æ”»å‡»â€çš„ä¿¡æ¯è¿”å›ã€‚è€Œä¿¡ä½¿éœ€è¦é€šè¿‡ç©¿è¶Šè¢«æ”»æ‰“çš„åŸå¸‚è¿”å›åˆ°å·¦è¾¹çš„å†›é˜Ÿï¼› é—®é¢˜å°±æ¥äº†ã€‚è¿™ä½ä¿¡ä½¿èº«ä¸Šå¯èƒ½ä¼šå‘ç”Ÿå¾ˆå¤šäº‹æƒ…ã€‚æ¯”å¦‚ï¼Œä»–æœ‰å¯èƒ½è¢«æŠ“è·ã€æ³„éœ²ä¿¡æ¯ã€æˆ–è¢«æ”»æ‰“çš„åŸå¸‚æ€å®³åå°†å…¶æ›¿æ¢äº†ã€‚è¿™å°†å¯¼è‡´å†›é˜Ÿè·å¾—è¢«ç¯¡æ”¹è¿‡çš„ä¿¡æ¯ï¼Œä»è€Œä½¿ä½œæˆ˜è®¡åˆ’æ— æ³•è¾¾æˆä¸€è‡´è€Œå¤±è´¥ã€‚ ä¸Šè¿°ä¾‹å­å¯¹åŒºå—é“¾æœ‰æ˜æ˜¾å€Ÿé‰´æ„ä¹‰ã€‚åŒºå—é“¾æ˜¯ä¸€ä¸ªå·¨å‹ç½‘ç»œï¼Œä½ è¦å¦‚ä½•ä¿¡ä»»ä»–ä»¬å‘¢ï¼Ÿå¦‚æœä½ æƒ³ä»é’±åŒ…é‡Œå‘é€4ä¸ªä»¥å¤ªå¸ç»™æŸäººï¼Œä½ å¦‚ä½•ç¡®è®¤ç½‘ç»œä¸­çš„æŸäººä¸ä¼šç¯¡æ”¹ä¿¡æ¯ï¼Œå°†4ä¸ªä»¥å¤ªå¸æ”¹æˆ40ä¸ªï¼Œ æˆ–è€…æ›´æ”¹äº†å…¶æ¥å—è€…ï¼Ÿä¸­æœ¬èªå‘æ˜äº†å·¥ä½œé‡è¯æ˜æœºåˆ¶æ¥ç»•è¿‡æ‹œå åº­å°†å†›é—®é¢˜ã€‚å…¶è¿è¡ŒåŸç†æ˜¯ï¼šå‡è®¾å·¦è¾¹çš„å†›é˜Ÿæƒ³è¦å‘é€å†…å®¹ä¸ºâ€œå‘¨ä¸‰è¿›æ”»â€çš„ä¿¡æ¯ç»™å³è¾¹çš„å†›é˜Ÿï¼Œä»–ä»¬éœ€è¦æ‰§è¡Œå¦‚ä¸‹æ­¥éª¤ï¼š é¦–å…ˆï¼Œä»–ä»¬ä¼šç»™åˆå§‹æ–‡æœ¬æ·»åŠ ä¸€ä¸ªâ€œnonceâ€ï¼Œè¿™ä¸ªnonceå¯ä»¥æ˜¯ä»»ä½•ä¸€ä¸ªéšæœºåå…­è¿›åˆ¶å€¼ã€‚ å…¶æ¬¡ï¼Œä»–ä»¬å°†æ·»åŠ äº†â€œnonceâ€çš„æ–‡æœ¬è¿›è¡Œå“ˆå¸Œï¼Œå¾—åˆ°ä¸€ä¸ªç»“æœã€‚å‡è®¾è¯´ä»–ä»¬å†³å®šä»…å½“å“ˆå¸Œç»“æœå‰5ä½æ˜¯é›¶çš„æ—¶å€™ï¼Œæ‰è¿›è¡Œä¿¡æ¯å…±äº«ã€‚ å¦‚æœå“ˆå¸Œç»“æœæ»¡è¶³æ¡ä»¶ï¼Œä»–ä»¬å°±ä¼šè®©ä¿¡ä½¿å¸¦ç€æœ‰å“ˆå¸Œç»“æœçš„ä¿¡æ¯å‡ºå‘ã€‚å¦åˆ™ï¼Œä»–ä»¬ä¼šæŒç»­éšæœºæ”¹å˜nonceçš„å€¼ï¼Œç›´åˆ°å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚è¿™ä¸€è¿‡ç¨‹ä¸ä»…å†—é•¿è€—æ—¶ï¼Œä¸”å ç”¨å¤§é‡çš„ç®—åŠ›ã€‚ å¦‚æœæ•ŒäººæŠ“åˆ°äº†ä¿¡ä½¿ï¼Œå¹¶ä¼å›¾ç¯¡æ”¹ä¿¡æ¯ï¼Œé‚£ä¹ˆæ ¹æ®å“ˆå¸Œå‡½æ•°çš„ç‰¹æ€§ï¼Œå“ˆå¸Œç»“æœå°†ä¼šå‰§çƒˆå˜åŒ–ã€‚å¦‚æœåŸå¸‚å³è¾¹çš„å°†å†›çœ‹åˆ°ä¿¡æ¯æ²¡æœ‰ä»¥è§„å®šæ•°é‡çš„0ä½œä¸ºå¼€å¤´ï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¼šå«åœæ”»å‡»ã€‚ å·¥ä½œé‡è¯æ˜çš„æœ¬è´¨ å¯»æ‰¾ä¸€ä¸ªç¬¦åˆå“ˆå¸Œç›®æ ‡çš„nonceå€¼ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å›°éš¾ä¸”è€—æ—¶çš„è¿‡ç¨‹ï¼Œ æƒ³è¦ç¯¡æ”¹éœ€è¦æµªè´¹å¤§é‡çš„ç®—ä¾‹ã€‚ ç„¶è€Œï¼ŒéªŒè¯ç»“æœä¸­æ˜¯å¦æœ‰ä½œæ¶è¡Œä¸ºå´æ˜¯éå¸¸ç®€å•çš„ã€‚ æ•°å­—ç­¾ååœ¨åŒºå—é“¾ç³»ç»Ÿä¸­çš„åº”ç”¨æ¦‚å¿µå‡è®¾Alanæƒ³æŠŠä¿¡æ¯â€œmâ€å‘é€å‡ºå»ï¼ŒAlanæœ‰ä¸€æŠŠç§é’¥Ka-å’Œä¸€æŠŠå…¬é’¥Ka+ã€‚é‚£ä¹ˆï¼Œå½“ä»–æŠŠä¿¡æ¯å‘é€ç»™Tyroneæ—¶ï¼Œä»–ä¼šç”¨ç§é’¥å°†è¯¥æ¡ä¿¡æ¯åŠ å¯†ï¼Œäºæ˜¯ä¿¡æ¯å˜æˆäº†Ka-(m)ã€‚å½“Tyroneæ”¶åˆ°è¿™æ¡ä¿¡æ¯æ—¶ï¼Œä»–å¯ä»¥ä½¿ç”¨Alançš„å…¬é’¥æ¥å–å›ä¿¡æ¯ï¼ŒKa+(Ka-(m))ï¼Œäºæ˜¯ä¾¿å¾—åˆ°äº†åŸå§‹ä¿¡æ¯â€œmâ€; ç­¾åçš„ä½œç”¨å°±æ˜¯ç”¨æ¥ä¿è¯ä¿¡æ¯åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œ ä¹Ÿå¯ä»¥ç”¨æ¥éªŒè¯ä¿¡æ¯ç¡®å®æ˜¯ä»å‘é€è€…å¤„å‘é€å‡ºæ¥ã€‚ æ•°å­—ç­¾åä½¿ç”¨çš„è¿‡ç¨‹ Alanæœ‰ä¸€ç¬”äº¤æ˜“â€œmâ€ï¼Œå¹¶ä¸”TyroneçŸ¥é“ä»–æ­£åœ¨æ¥æ”¶è¯¥ç¬”äº¤æ˜“ã€‚ Alanå¯¹mè¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¾—åˆ°h(m)ã€‚ Alanç”¨è‡ªå·±çš„ç§é’¥å¯¹å“ˆå¸Œç»“æœè¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°Ka-(h(m))ã€‚ Alanå°†åŠ å¯†æ•°æ®å‘é€ç»™Tyroneã€‚ Tyroneä½¿ç”¨Alançš„å…¬é’¥æ¥è§£å¯†ï¼ŒKa+(Ka-(h(m)))ï¼Œå¹¶å¾—åˆ°åŸæ¥çš„å“ˆå¸Œç»“æœh(m)ã€‚ Tyroneç”¨å·²çŸ¥çš„â€œmâ€è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¯ä»¥å¾—åˆ°h(m)ã€‚ å“ˆå¸Œå‡½æ•°çš„ç¡®å®šæ€§ç‰¹å¾å†³å®šäº†å¦‚æœh(m)=h(m)ï¼Œå°±æ„å‘³ç€è¿™ç¬”äº¤æ˜“æ˜¯çœŸå®æœ‰æ•ˆçš„ã€‚ æ•°å­—ç­¾åçš„ç‰¹æ€§ å¯éªŒè¯æ€§ï¼šå¦‚æœåŠ å¯†ä¿¡æ¯èƒ½å¤Ÿç”¨Alançš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œé‚£å°±å¯ä»¥100%ç¡®å®šæ˜¯Alanå‘é€äº†è¯¥æ¡ä¿¡æ¯ã€‚ ä¸å¯ä¼ªé€ æ€§ï¼šå¦‚æœè¯´æœ‰å…¶ä»–äººï¼Œä¾‹å¦‚Bobï¼Œæ‹¦æˆªäº†è¯¥æ¡ä¿¡æ¯ï¼Œå¹¶ç”¨è‡ªå·±çš„ç§é’¥å‘é€äº†ä¸€æ¡è‡ªå·±çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆAlançš„å…¬é’¥å°†æ— æ³•å¯¹å…¶è§£å¯†ã€‚Alançš„å…¬é’¥åªèƒ½ç”¨æ¥è§£å¯†Alanç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†è¿‡çš„ä¿¡æ¯ã€‚ ä¸å¯æŠµèµ–æ€§ï¼šåŒæ ·çš„ï¼Œå¦‚æœAlanå®£ç§°ï¼Œâ€œæˆ‘æ²¡æœ‰å‘é€ä¿¡æ¯ï¼Œæ˜¯Bobå‘çš„â€ï¼Œä½†Tyroneå´èƒ½å¤Ÿç”¨Alançš„å…¬é’¥æ¥è§£å¯†ä¿¡æ¯ï¼Œé‚£å°±è¯æ˜Alanåœ¨æ’’è°ã€‚å¦‚æ­¤ï¼ŒAlanå°±æ— æ³•æ”¶å›ä»–ä¹‹å‰å‘å‡ºçš„ä¿¡æ¯ï¼Œå¹¶å°†å…¶å½’å’äºä»–äººã€‚ é›¶çŸ¥è¯†è¯æ˜æ¦‚å¿µ(ZKP)é›¶çŸ¥è¯†è¯æ˜æ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼Œ è¯æ˜ç€ä¸å‘éªŒè¯ç€æä¾›ä»»ä½•é¢å¤–çš„ä¿¡æ¯çš„å‰æä¸‹ï¼Œ ä½¿éªŒè¯ç€ç›¸ä¿¡æŸä¸ªè®ºæ–­æ˜¯æ­£ç¡®çš„ã€‚ ZKPæ„å‘³ç€Aå¯ä»¥å‘Bè¯æ˜ï¼Œä»–çŸ¥é“ç‰¹å®šçš„ä¿¡æ¯ï¼Œè€Œä¸å¿…å‘Šè¯‰å¯¹æ–¹è‡ªå·±å…·ä½“çŸ¥é“äº›ä»€ä¹ˆï¼Œè¿™å°¤ä¸ºæœ‰ç”¨ï¼Œå› ä¸ºè¿™å°†ä¸ºè¯æ˜è€…æä¾›ä¸€å±‚é¢å¤–çš„éšç§ä¿æŠ¤ã€‚ åœ¨åŒºå—é“¾ç³»ç»Ÿä¸­ï¼Œä¸ºäº†åšåˆ°å®Œå…¨çš„éšç§ï¼Œå¯¹æ•°æ®çš„éªŒè¯å¯ä»¥é€šè¿‡é›¶çŸ¥è¯†è¯æ˜ï¼Œå¯¹äº¤æ˜“çš„è¯¦æƒ…ç­‰å¯ä»¥åšåˆ°å®Œå…¨çš„éšè—ï¼Œé¿å…æ³„éœ²ä¿¡æ¯ï¼› é›¶çŸ¥è¯†è¯æ˜å…·å¤‡çš„æ€§è´¨ å®Œæ•´æ€§ï¼šå¦‚æœé™ˆè¿°å±å®ï¼Œé‚£ä¹ˆè¯šå®çš„éªŒè¯è€…èƒ½è¢«è¯šå®çš„è¯æ˜è€…è¯´æœã€‚ å¯é æ€§ï¼šå¦‚æœè¯æ˜è€…ä¸è¯šå®ï¼Œä»–ä»¬æ— æ³•é€šè¿‡è¯´è°æ¥è¯´æœéªŒè¯è€…ç›¸ä¿¡é™ˆè¿°æ˜¯å¯é çš„ã€‚é›¶çŸ¥è¯†ï¼šå¦‚æœé™ˆè¿°å±å®ï¼Œé‚£ä¹ˆéªŒè¯è€…æ— æ³•å¾—çŸ¥é™ˆè¿°çš„å†…å®¹æ˜¯ä»€ä¹ˆã€‚ ä¸¾ä¸ªæ —å­ï¼Œè¯æ˜è€…ï¼ˆPï¼‰å¯¹éªŒè¯è€…ï¼ˆVï¼‰è¯´ï¼Œä»–çŸ¥é“æ´ç©´åé¢æš—é—¨çš„å¯†ç ï¼Œå¹¶æå‡ºåœ¨ä¸å‘éªŒè¯è€…é€éœ²å¯†ç çš„æƒ…å†µä¸‹è¯æ˜æ­¤äº‹ã€‚é‚£ä¹ˆï¼Œå…¶éªŒè¯è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¯æ˜è€…å¯ä»¥èµ°è·¯å¾„Aæˆ–è€…è·¯å¾„Bï¼Œå‡è®¾ä»–ä»¬ä¸€å¼€å§‹å†³å®šé€šè¿‡è·¯å¾„Aåˆ°è¾¾æš—é—¨ã€‚åŒæ—¶ï¼ŒéªŒè¯è€…Væ¥åˆ°å…¥å£ï¼Œä»–å¯¹è¯æ˜è€…é€‰æ‹©å“ªæ¡è·¯å¾„å¹¶ä¸çŸ¥æƒ…ï¼Œå¹¶å®£ç§°ä»–ä»¬å¸Œæœ›è§åˆ°è¯æ˜è€…åœ¨è·¯å¾„Bå‡ºç°ã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œè¯æ˜è€…ç¡®å®å‡ºç°åœ¨è·¯å¾„Bä¸Šï¼Œä½†ä¸‡ä¸€è¿™ä»…æ˜¯å·§åˆå‘¢ï¼Ÿä¹Ÿæœ‰å¯èƒ½æ˜¯è¯æ˜è€…å‡­è¿æ°”åœ¨å‡ºå‘æ—¶é€‰æ‹©äº†è·¯å¾„Bï¼Œå´å› ä¸çŸ¥é“å¯†ç è¢«å›°åœ¨äº†é—¨å£ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å¤šæ¬¡è¯•éªŒæ¥ç¡®å®šæµ‹è¯•çš„æœ‰æ•ˆæ€§ã€‚å¦‚æœè¯æ˜è€…æ¯æ¬¡éƒ½èƒ½å‡ºç°åœ¨æ­£ç¡®çš„è·¯å¾„ä¸Šï¼Œé‚£ä¹ˆè¯æ˜è€…çš„ç¡®å¯ä»¥åœ¨ä¸å‘éªŒè¯è€…é€éœ²å¯†ç çš„æƒ…å†µä¸‹ï¼Œè¯æ˜è‡ªå·±çŸ¥é“å¯†ç ã€‚ é›¶çŸ¥è¯†è¯æ˜ä½¿ç”¨å®ä¾‹è®¸å¤šåŸºäºåŒºå—é“¾çš„æŠ€æœ¯éƒ½åœ¨ä½¿ç”¨Zk-Snarksã€‚äº‹å®ä¸Šï¼Œä»¥å¤ªåŠåœ¨å¤§éƒ½ä¼šé˜¶æ®µå°±è®¡åˆ’å¼•å…¥Zk-Snarksï¼Œå¹¶ä¸”å°†å…¶åŠ å…¥ä»¥å¤ªåŠçš„åŠŸèƒ½åº“ã€‚Zk-Snarksæ˜¯â€œé›¶çŸ¥è¯†ç®€æ´æ— äº¤äº’çŸ¥è¯†è®¤è¯â€çš„ç®€ç§°ï¼Œæ˜¯ä¸€ç§åœ¨æ— éœ€æ³„éœ²æ•°æ®æœ¬èº«æƒ…å†µä¸‹è¯æ˜æŸäº›æ•°æ®è¿ç®—çš„ä¸€ç§é›¶çŸ¥è¯†è¯æ˜ã€‚ ä»¥ä¸Šå†…å®¹å¯ç”¨æ¥ç”Ÿæˆä¸€ä¸ªè¯æ˜ï¼Œé€šè¿‡å¯¹æ¯ç¬”äº¤æ˜“åˆ›å»ºä¸€ä¸ªç®€å•çš„å¿«ç…§æ¥éªŒè¯å…¶æœ‰æ•ˆæ€§ã€‚è¿™è¶³ä»¥å‘ä¿¡æ¯æ¥æ”¶æ–¹è¯æ˜äº¤æ˜“çš„æœ‰æ•ˆæ€§ï¼Œè€Œæ— éœ€æ³„éœ²äº¤æ˜“çš„å®è´¨å†…å®¹ã€‚ é€šè¿‡é›¶çŸ¥è¯†è¯æ˜ï¼Œè§£å†³äº†åŒºå—é“¾çš„ä¸€äº›å› ä¸ºé—®é¢˜: 1.å®ç°äº†äº¤æ˜“çš„å®Œæ•´æ€§å’Œéšç§æ€§; 2.å®ç°äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§ã€‚ç”±äºæ— éœ€å±•ç¤ºæ•´ä¸ªäº¤æ˜“å†…éƒ¨çš„å·¥ä½œæ–¹å¼ï¼Œå› æ­¤ç³»ç»Ÿéå¸¸æ˜“ç”¨ã€‚]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>åŒºå—é“¾æ¦‚å¿µ</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»¥å¤ªåŠæŠ€æœ¯æ ˆ]]></title>
    <url>%2F2019%2F01%2F28%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2F%E5%8C%BA%E5%9D%97%E9%93%BE%E6%A6%82%E5%BF%B5%2F4.%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%8A%80%E6%9C%AF%E6%A0%88%2F</url>
    <content type="text"><![CDATA[ä»¥å¤ªåŠçš„ä»‹ç»ä»¥å¤ªåŠç®€ä»‹ä»¥å¤ªåŠï¼ˆEthereumï¼‰é¡¹ç›®çš„æœ€åˆç›®æ ‡ï¼Œæ˜¯æ‰“é€ ä¸€ä¸ªè¿è¡Œæ™ºèƒ½åˆçº¦çš„å¹³å°ï¼ˆPlatform for Smart Contractï¼‰ã€‚è¯¥å¹³å°æ”¯æŒå›¾çµå®Œå¤‡çš„åº”ç”¨ï¼ŒæŒ‰ç…§æ™ºèƒ½åˆçº¦çš„çº¦å®šé€»è¾‘è‡ªåŠ¨æ‰§è¡Œï¼Œç†æƒ³æƒ…å†µä¸‹å°†ä¸å­˜åœ¨æ•…éšœåœæœºã€å®¡æŸ¥ã€æ¬ºè¯ˆï¼Œä»¥åŠç¬¬ä¸‰æ–¹å¹²é¢„ç­‰é—®é¢˜ã€‚ ä»¥å¤ªåŠå¹³å°ç›®å‰æ”¯æŒ Golangã€C++ã€Python ç­‰å¤šç§è¯­è¨€å®ç°çš„å®¢æˆ·ç«¯ã€‚ç”±äºæ ¸å¿ƒå®ç°ä¸ŠåŸºäºæ¯”ç‰¹å¸ç½‘ç»œçš„æ ¸å¿ƒæ€æƒ³è¿›è¡Œäº†æ‹“å±•ï¼Œå› æ­¤åœ¨å¾ˆå¤šè®¾è®¡ç‰¹æ€§ä¸Šéƒ½ä¸æ¯”ç‰¹å¸ç½‘ç»œååˆ†ç±»ä¼¼ã€‚ åŸºäºä»¥å¤ªåŠé¡¹ç›®ï¼Œä»¥å¤ªåŠå›¢é˜Ÿç›®å‰è¿è¥äº†ä¸€æ¡å…¬å¼€çš„åŒºå—é“¾å¹³å°â€”â€”ä»¥å¤ªåŠç½‘ç»œã€‚æ™ºèƒ½åˆçº¦å¼€å‘è€…ä½¿ç”¨å®˜æ–¹æä¾›çš„å·¥å…·å’Œä»¥å¤ªåŠä¸“ç”¨åº”ç”¨å¼€å‘è¯­è¨€ Solidityï¼Œå¯ä»¥å¾ˆå®¹æ˜“å¼€å‘å‡ºè¿è¡Œåœ¨ä»¥å¤ªåŠç½‘ç»œä¸Šçš„â€œå»ä¸­å¿ƒåŒ–â€åº”ç”¨ï¼ˆDecentralized Applicationï¼ŒDAppï¼‰ã€‚è¿™äº›åº”ç”¨å°†è¿è¡Œåœ¨ä»¥å¤ªåŠçš„è™šæ‹Ÿæœºï¼ˆEthereum Virtual Machineï¼ŒEVMï¼‰é‡Œã€‚ç”¨æˆ·é€šè¿‡ä»¥å¤ªå¸ï¼ˆEtherï¼‰æ¥è´­ä¹°ç‡ƒæ–™ï¼ˆGasï¼‰ï¼Œç»´æŒæ‰€éƒ¨ç½²åº”ç”¨çš„è¿è¡Œã€‚ ä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸çš„åŒºåˆ«ä»¥å¤ªåŠçš„ç›®çš„æ˜¯åˆ›å»ºä¸€ç§å»ä¸­å¿ƒåŒ–åº”ç”¨çš„åè®®ï¼Œæä¾›ä¸€å¥—å¯¹å¤§é‡å»ä¸­å¿ƒåŒ–åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨çš„æ–°æ–¹æ¡ˆï¼Œç‰¹åˆ«å¼ºè°ƒå¿«é€Ÿå¼€å‘ï¼Œå¯¹å°çš„å’Œå°‘æ•°äººä½¿ç”¨çš„åº”ç”¨ä¹Ÿéå¸¸å®‰å…¨ï¼ˆå°è€Œä½¿ç”¨äººå°‘çš„åº”ç”¨å®¹æ˜“è¢«51%æ”»ç ´ï¼‰ï¼Œä»¥åŠä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´èƒ½å¤Ÿæœ‰æ•ˆçš„äº’åŠ¨ã€‚ä»¥å¤ªåŠç”¨è¿‡å»ºç«‹åœ¨æœ¬è´¨ä¸Šæ˜¯æŠ½è±¡çš„åŸºç¡€å±‚æ¥å®Œæˆè¿™ä¸€å·¥ä½œï¼› ä¸€ä¸ªåŒºå—é“¾å…¶å†…ç½®äº†å›¾çµå®Œå¤‡çš„ç¼–ç¨‹è¯­è¨€ï¼Œå…è®¸ä»»ä½•äººç¼–å†™æ™ºèƒ½åˆçº¦å’Œå»ä¸­å¿ƒåŒ–çš„åº”ç”¨ç¨‹åºï¼Œåœ¨è¿™äº›åº”ç”¨ç¨‹åºä¸­ï¼Œä»–ä»¬å¯ä»¥åˆ›å»ºä»»æ„çš„å±äºä»–ä»¬è‡ªå·±çš„è§„åˆ™ã€äº¤æ˜“æ ¼å¼å’ŒçŠ¶æ€è½¬æ¢å‡½æ•°ã€‚åå­—å¸çš„ä¸€ä¸ªç®€å•ç‰ˆæœ¬åœ¨ä»¥å¤ªåŠå¯ä»¥ç”¨ä¸¤è¡Œä»£ç æ¥ç¼–å†™å®Œæˆï¼Œè€Œå…¶ä»–åè®®å¦‚è´§å¸å’Œä¿¡ç”¨ç³»ç»Ÿåˆ™å¯ä»¥ç”¨ä¸åˆ° 20 è¡Œçš„ä»£ç æ¥æ„å»ºã€‚æ™ºèƒ½åˆçº¦-åŒ…å«ä»·å€¼è€Œä¸”åªæœ‰æ»¡è¶³æŸäº›æ¡ä»¶æ‰èƒ½æ‰“å¼€çš„åŠ å¯†ç®±å­-ä¹Ÿèƒ½åœ¨æˆ‘ä»¬çš„å¹³å°ä¸Šæ„å»ºï¼Œå¹¶ä¸”å› ä¸ºå›¾çµå®Œå¤‡æ€§ã€ä»·å€¼çŸ¥æ™“ï¼ˆvalue-awarenessï¼‰ã€åŒºå—é“¾çŸ¥æ™“ï¼ˆblockchain-awarenessï¼‰å’Œå¤šçŠ¶æ€æ‰€å¢åŠ çš„åŠ›é‡ï¼Œè¿œæ¯”ç‰¹å¸è„šæœ¬æ‰€èƒ½æä¾›çš„åŠŸèƒ½å¼ºå¤§å¾—å¤šï¼› ä»¥å¤ªåŠä¸»è¦ç‰¹ç‚¹ä»¥å¤ªåŠåŒºå—é“¾åº•å±‚ä¹Ÿæ˜¯ä¸€ä¸ªç±»ä¼¼æ¯”ç‰¹å¸ç½‘ç»œçš„ P2P ç½‘ç»œå¹³å°ï¼Œæ™ºèƒ½åˆçº¦è¿è¡Œåœ¨ç½‘ç»œä¸­çš„ä»¥å¤ªåŠè™šæ‹Ÿæœºé‡Œã€‚ç½‘ç»œè‡ªèº«æ˜¯å…¬å¼€å¯æ¥å…¥çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥æ¥å…¥å¹¶å‚ä¸ç½‘ç»œä¸­æ•°æ®çš„ç»´æŠ¤ï¼Œæä¾›è¿è¡Œä»¥å¤ªåŠè™šæ‹Ÿæœºçš„èµ„æºã€‚ è·Ÿæ¯”ç‰¹å¸é¡¹ç›®ç›¸æ¯”ï¼Œä»¥å¤ªåŠåŒºå—é“¾çš„æŠ€æœ¯ç‰¹ç‚¹ä¸»è¦åŒ…æ‹¬ï¼š æ”¯æŒå›¾çµå®Œå¤‡çš„æ™ºèƒ½åˆçº¦ï¼Œè®¾è®¡äº†ç¼–ç¨‹è¯­è¨€ Solidity å’Œè™šæ‹Ÿæœº EVMï¼› é€‰ç”¨äº†å†…å­˜éœ€æ±‚è¾ƒé«˜çš„å“ˆå¸Œå‡½æ•°ï¼Œé¿å…å‡ºç°å¼ºç®—åŠ›çŸ¿æœºã€çŸ¿æ± æ”»å‡»ï¼› å”å—ï¼ˆUncle Blockï¼‰æ¿€åŠ±æœºåˆ¶ï¼Œé™ä½çŸ¿æ± çš„ä¼˜åŠ¿ï¼Œå¹¶å‡å°‘åŒºå—äº§ç”Ÿé—´éš”ï¼ˆ10 åˆ†é’Ÿé™ä½åˆ° 15 ç§’å·¦å³ï¼‰ï¼› é‡‡ç”¨è´¦æˆ·ç³»ç»Ÿå’Œä¸–ç•ŒçŠ¶æ€ï¼Œè€Œä¸æ˜¯ UTXOï¼Œå®¹æ˜“æ”¯æŒæ›´å¤æ‚çš„é€»è¾‘ï¼› é€šè¿‡ Gas é™åˆ¶ä»£ç æ‰§è¡ŒæŒ‡ä»¤æ•°ï¼Œé¿å…å¾ªç¯æ‰§è¡Œæ”»å‡»ï¼› æ”¯æŒ PoW å…±è¯†ç®—æ³•ï¼Œå¹¶è®¡åˆ’æ”¯æŒæ•ˆç‡æ›´é«˜çš„ PoS ç®—æ³•ã€‚ æ­¤å¤–ï¼Œå¼€å‘å›¢é˜Ÿè¿˜è®¡åˆ’é€šè¿‡åˆ†ç‰‡ï¼ˆShardingï¼‰æ–¹å¼æ¥è§£å†³ç½‘ç»œå¯æ‰©å±•æ€§é—®é¢˜ã€‚ è¿™äº›æŠ€æœ¯ç‰¹ç‚¹ï¼Œè§£å†³äº†æ¯”ç‰¹å¸ç½‘ç»œåœ¨è¿è¡Œä¸­è¢«äººè¯Ÿç—…çš„ä¸€äº›é—®é¢˜ï¼Œè®©ä»¥å¤ªåŠç½‘ç»œå…·å¤‡äº†æ›´å¤§çš„åº”ç”¨æ½œåŠ›ã€‚ ä»¥å¤ªåŠçš„æ ¸å¿ƒæ¦‚å¿µæ™ºèƒ½åˆçº¦ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦ æ™ºèƒ½åˆçº¦ï¼ˆSmart Contractï¼‰æ˜¯ä»¥å¤ªåŠä¸­æœ€ä¸ºé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå³ä»¥è®¡ç®—æœºç¨‹åºçš„æ–¹å¼æ¥ç¼”ç»“å’Œè¿è¡Œå„ç§åˆçº¦ã€‚æœ€æ—©åœ¨ä¸Šä¸–çºª 90 å¹´ä»£ï¼ŒNick Szabo ç­‰äººå°±æå‡ºè¿‡ç±»ä¼¼çš„æ¦‚å¿µï¼Œä½†ä¸€ç›´ä¾èµ–å› ä¸ºç¼ºä¹å¯é æ‰§è¡Œæ™ºèƒ½åˆçº¦çš„ç¯å¢ƒï¼Œè€Œè¢«ä½œä¸ºä¸€ç§ç†è®ºè®¾è®¡ã€‚åŒºå—é“¾æŠ€æœ¯çš„å‡ºç°ï¼Œæ°å¥½è¡¥å……äº†è¿™ä¸€ç¼ºé™·ã€‚ ä»¥å¤ªåŠæ”¯æŒé€šè¿‡å›¾çµå®Œå¤‡çš„é«˜çº§è¯­è¨€ï¼ˆåŒ…æ‹¬ Solidityã€Serpentã€Viperï¼‰ç­‰æ¥å¼€å‘æ™ºèƒ½åˆçº¦ã€‚æ™ºèƒ½åˆçº¦ä½œä¸ºè¿è¡Œåœ¨ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEthereum Virual Machineï¼ŒEVMï¼‰ä¸­çš„åº”ç”¨ï¼Œå¯ä»¥æ¥å—æ¥è‡ªå¤–éƒ¨çš„äº¤æ˜“è¯·æ±‚å’Œäº‹ä»¶ï¼Œé€šè¿‡è§¦å‘è¿è¡Œæå‰ç¼–å†™å¥½çš„ä»£ç é€»è¾‘ï¼Œè¿›ä¸€æ­¥ç”Ÿæˆæ–°çš„äº¤æ˜“å’Œäº‹ä»¶ï¼Œå¯ä»¥è¿›ä¸€æ­¥è°ƒç”¨å…¶å®ƒæ™ºèƒ½åˆçº¦ã€‚ æ™ºèƒ½åˆçº¦çš„æ‰§è¡Œç»“æœå¯èƒ½å¯¹ä»¥å¤ªåŠç½‘ç»œä¸Šçš„è´¦æœ¬çŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚è¿™äº›ä¿®æ”¹ç”±äºç»è¿‡äº†ä»¥å¤ªåŠç½‘ç»œä¸­çš„å…±è¯†ï¼Œä¸€æ—¦ç¡®è®¤åæ— æ³•è¢«ä¼ªé€ å’Œç¯¡æ”¹ã€‚ åªèƒ½åˆçº¦ä½œç”¨ æ™ºèƒ½åˆçº¦æ˜¯åœ¨ä»¥å¤ªåŠè™šæ‹Ÿæœºä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†å¸ƒçš„â€œä¸–ç•Œè®¡ç®—æœºâ€ï¼Œè®¡ç®—èƒ½åŠ›ç”±æ‰€æœ‰ä»¥å¤ªåŠèŠ‚ç‚¹æä¾›ã€‚æä¾›è®¡ç®—èƒ½åŠ›çš„ä»»ä½•èŠ‚ç‚¹éƒ½å°†ä»¥Etheræ•°å­—è´§å¸ä½œä¸ºèµ„æºæ”¯ä»˜ã€‚ ä»–ä»¬è¢«å‘½åä¸ºæ™ºèƒ½åˆçº¦ï¼Œå› ä¸ºæ‚¨å¯ä»¥ç¼–å†™æ»¡è¶³è¦æ±‚æ—¶è‡ªåŠ¨æ‰§è¡Œçš„â€œåˆåŒâ€ã€‚ ä¾‹å¦‚ï¼Œæƒ³è±¡ä¸€ä¸‹åœ¨ä»¥å¤ªåŠä¹‹ä¸Šå»ºç«‹ä¸€ä¸ªç±»ä¼¼Kickstarterçš„ä¼—ç­¹æœåŠ¡ã€‚æœ‰äººå¯ä»¥å»ºç«‹ä¸€ä¸ªä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ï¼Œå°†èµ„é‡‘æ±‡é›†åˆ°åˆ«äººèº«ä¸Šã€‚è¿™ä¸ªæ™ºèƒ½åˆçº¦å¯ä»¥å†™æˆè¿™æ ·çš„è¯ï¼šå½“å°†100,000ç¾å…ƒçš„è´§å¸æ·»åŠ åˆ°æ± ä¸­æ—¶ï¼Œå®ƒå°†å…¨éƒ¨å‘é€ç»™æ”¶ä»¶äººã€‚æˆ–è€…ï¼Œå¦‚æœä¸€ä¸ªæœˆå†…æ²¡æœ‰è¾¾åˆ°100,000ç¾å…ƒçš„é—¨æ§›ï¼Œæ‰€æœ‰çš„è´§å¸éƒ½å°†è¢«å‘å›ç»™è´§å¸çš„åŸå§‹æŒæœ‰äººã€‚å½“ç„¶ï¼Œè¿™å°†ä½¿ç”¨ä»¥å¤ªå¸ä»£æ›¿ç¾å…ƒã€‚ è¿™ä¸€åˆ‡éƒ½å°†æ ¹æ®æ™ºèƒ½åˆåŒä»£ç è¿›è¡Œï¼Œæ™ºèƒ½åˆåŒä»£ç å¯è‡ªåŠ¨æ‰§è¡Œäº¤æ˜“ï¼Œè€Œæ— éœ€å¯ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹æŒæœ‰è´§å¸å¹¶ç­¾ç½²äº¤æ˜“ã€‚ä¾‹å¦‚ï¼ŒKickstarteråœ¨5ï¼…çš„ä»˜æ¬¾å¤„ç†è´¹ä¹‹ä¸Šæ”¶å–5ï¼…çš„è´¹ç”¨ï¼Œè¿™æ„å‘³ç€åœ¨$100,000çš„ä¼—ç­¹é¡¹ç›®ä¸­å°†æ”¶å–8000åˆ°10000ç¾å…ƒçš„è´¹ç”¨ã€‚æ™ºèƒ½åˆçº¦ä¸éœ€è¦å‘åƒKickstarterè¿™æ ·çš„ç¬¬ä¸‰æ–¹æ”¯ä»˜è´¹ç”¨ã€‚ æ™ºèƒ½åˆçº¦å¯ä»¥ç”¨äºè®¸å¤šä¸åŒçš„äº‹æƒ…ã€‚å¼€å‘äººå‘˜å¯ä»¥åˆ›å»ºæ™ºèƒ½åˆçº¦ï¼Œä¸ºå…¶ä»–æ™ºèƒ½åˆçº¦æä¾›åŠŸèƒ½ï¼Œç±»ä¼¼äºè½¯ä»¶åº“çš„å·¥ä½œæ–¹å¼ã€‚æˆ–è€…ï¼Œæ™ºèƒ½åˆçº¦å¯ä»¥ç®€å•åœ°ç”¨ä½œåº”ç”¨ç¨‹åºæ¥å­˜å‚¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„ä¿¡æ¯ã€‚ ä¸ºäº†çœŸæ­£æ‰§è¡Œæ™ºèƒ½åˆåŒä»£ç ï¼Œæœ‰äººå¿…é¡»å‘é€è¶³å¤Ÿçš„ä»¥å¤ªç½‘ä»£å¸ä½œä¸ºäº¤æ˜“è´¹ - å¤šå°‘å–å†³äºæ‰€éœ€çš„è®¡ç®—èµ„æºã€‚è¿™ä¸ºä»¥å¤ªåŠèŠ‚ç‚¹å‚ä¸å¹¶æä¾›è®¡ç®—èƒ½åŠ›ä»˜å‡ºäº†ä»£ä»·ã€‚ è´¦æˆ·ACCOUNTè´¦æˆ·ä»‹ç» åœ¨ä¹‹å‰ç« èŠ‚ä¸­ï¼Œç¬”è€…ä»‹ç»è¿‡æ¯”ç‰¹å¸åœ¨è®¾è®¡ä¸­å¹¶æ²¡æœ‰è´¦æˆ·ï¼ˆAccountï¼‰çš„æ¦‚å¿µï¼Œè€Œæ˜¯é‡‡ç”¨äº† UTXO æ¨¡å‹è®°å½•æ•´ä¸ªç³»ç»Ÿçš„çŠ¶æ€ã€‚ä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡äº¤æ˜“å†å²æ¥æ¨ç®—å‡ºç”¨æˆ·çš„ä½™é¢ä¿¡æ¯ã€‚è€Œä»¥å¤ªåŠåˆ™é‡‡ç”¨äº†ä¸åŒçš„åšæ³•ï¼Œç›´æ¥ç”¨è´¦æˆ·æ¥è®°å½•ç³»ç»ŸçŠ¶æ€ã€‚æ¯ä¸ªè´¦æˆ·å­˜å‚¨ä½™é¢ä¿¡æ¯ã€æ™ºèƒ½åˆçº¦ä»£ç å’Œå†…éƒ¨æ•°æ®å­˜å‚¨ç­‰ã€‚ä»¥å¤ªåŠæ”¯æŒåœ¨ä¸åŒçš„è´¦æˆ·ä¹‹é—´è½¬ç§»æ•°æ®ï¼Œä»¥å®ç°æ›´ä¸ºå¤æ‚çš„é€»è¾‘ã€‚ å…·ä½“æ¥çœ‹ï¼Œä»¥å¤ªåŠè´¦æˆ·åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šåˆçº¦è´¦æˆ·ï¼ˆContracts Accountsï¼‰å’Œå¤–éƒ¨è´¦æˆ·ï¼ˆExternally Owned Accountsï¼Œæˆ– EOAï¼‰ã€‚ åˆçº¦è´¦æˆ·ï¼šå­˜å‚¨æ‰§è¡Œçš„æ™ºèƒ½åˆçº¦ä»£ç ï¼Œåªèƒ½è¢«å¤–éƒ¨è´¦æˆ·æ¥è°ƒç”¨æ¿€æ´»ï¼› å¤–éƒ¨è´¦æˆ·ï¼šä»¥å¤ªå¸æ‹¥æœ‰è€…è´¦æˆ·ï¼Œå¯¹åº”åˆ°æŸå…¬é’¥ã€‚è´¦æˆ·åŒ…æ‹¬ nonceã€balanceã€storageRootã€codeHash ç­‰å­—æ®µï¼Œç”±ä¸ªäººæ¥æ§åˆ¶ã€‚ åœ¨ä»¥å¤ªåŠä¸­ï¼Œå…¨ç½‘çš„çŠ¶æ€æ˜¯ç”±è¢«â€œè´¦æˆ·â€çš„å¯¹è±¡ç»„æˆçš„ï¼Œè´¦æˆ·ä¹‹é—´å¯ä»¥ç›´æ¥çš„è¿›è¡Œä»·å€¼å’Œä¿¡æ¯çš„è½¬ç§»ï¼Œä¸€ä¸ªä»¥å¤ªåŠçš„è´¦æˆ·åŒ…å«ä¸‹é¢ 4 ä¸ªå­—æ®µ: éšæœºæ•°, ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨ä»¥ç¡®ä¿æ¯ä¸ªäº¤æ˜“éƒ½åªä¼šè¢«å¤„ç†ä¸€æ¬¡ è´¦æˆ·å½“å‰çš„ä»¥å¤ªå¸é¢åº¦ è´¦æˆ·çš„åˆçº¦ä»£ç , å¦‚æœæœ‰çš„è¯ è¿™ä¸ªè´¦æˆ·çš„ å­˜å‚¨ (é»˜è®¤ç©º) åˆçº¦è´¦æˆ·å¤–éƒ¨è´¦æˆ·ä¹‹é—´å…³ç³» å½“åˆçº¦è´¦æˆ·è¢«è°ƒç”¨æ—¶ï¼Œå­˜å‚¨å…¶ä¸­çš„æ™ºèƒ½åˆçº¦ä¼šåœ¨çŸ¿å·¥å¤„çš„è™šæ‹Ÿæœºä¸­è‡ªåŠ¨æ‰§è¡Œï¼Œå¹¶æ¶ˆè€—ä¸€å®šçš„ç‡ƒæ–™ã€‚ç‡ƒæ–™é€šè¿‡å¤–éƒ¨è´¦æˆ·ä¸­çš„ä»¥å¤ªå¸è¿›è¡Œè´­ä¹°ã€‚ å¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œæœ€åŸºæœ¬çš„åŒºåˆ«åœ¨äºï¼Œç”¨æˆ·æŒæ¡ç€ EOA è´¦å·ï¼Œå› ä¸ºç”¨æˆ·æŒæ¡ç€æ§åˆ¶ EOA è´¦å·çš„ç§é’¥ã€‚è€Œåˆçº¦è´¦å·ç”±å†…éƒ¨ç¨‹åºä»£ç æ¥æ§åˆ¶çš„ï¼Œå½“ç„¶æŒæ§ç§é’¥çš„ EOA è´¦æˆ·å¯ä»¥é€šè¿‡ç¼–å†™ç‰¹å®šçš„ç¨‹åºä»£ç æ¥æŒæ§åˆçº¦è´¦æˆ·ã€‚æµè¡Œçš„æœ¯è¯­â€œæ™ºèƒ½åˆçº¦â€å°±æ˜¯åˆçº¦è´¦å·ä¸­çš„ä»£ç ï¼Œå½“ä¸€ä¸ªäº¤æ˜“è¢«å‘é€åˆ°è¯¥è´¦æˆ·æ—¶ï¼Œåˆçº¦ä¸­çš„ä»£ç å°±ä¼šè¢«æ‰§è¡Œã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æŠŠä»£ç éƒ¨ç½²åˆ°åŒºå—é“¾ä¸­æ¥åˆ›å»ºä¸€ä¸ªæ–°åˆçº¦ï¼Œä¹Ÿå³åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„åˆçº¦è´¦æˆ·ã€‚ åˆçº¦è´¦æˆ·åªæœ‰åœ¨ EOA è´¦æˆ·å‘å‡ºä¸€ä¸ªæŒ‡ä»¤çš„æ—¶å€™æ‰ä¼šå»æ‰§è¡Œä¸€ä¸ªæ“ä½œã€‚æ‰€ä»¥ä¸€ä¸ªåˆçº¦è´¦æˆ·æ˜¯ä¸å¯èƒ½è‡ªå·±å»æ‰§è¡Œä¸€ä¸ªæ“ä½œçš„ï¼Œå¦‚ç”Ÿäº§ä¸€ä¸ªéšæœºæ•°æˆ–æ‰§è¡Œä¸€ä¸ª API è°ƒç”¨ç­‰ï¼Œå®ƒåªæœ‰åœ¨ EOA è´¦æˆ·ä½œå‡ºç¡®è®¤çš„æƒ…å†µä¸‹æ‰ä¼šå»åšè¿™äº›äº‹æƒ…ã€‚è¿™æ˜¯å› ä¸ºä»¥å¤ªåŠè¦æ±‚èŠ‚ç‚¹èƒ½å¤Ÿå¯¹è®¡ç®—çš„ç»“æœæ— è®ºå¯¹é”™éƒ½è¾¾æˆä¸€è‡´ï¼Œè¿™å°±å¯¹æ“ä½œæœ‰äº†ä¸€ä¸ªå¿…å®šä¼šæ‰§è¡Œçš„è¦æ±‚ã€‚ ä»å¤–éƒ¨æ‹¥æœ‰è´¦æˆ·åˆ°åˆçº¦è´¦æˆ·çš„æ¶ˆæ¯ä¼šæ¿€æ´»åˆçº¦è´¦æˆ·çš„ä»£ç ï¼Œå…è®¸å®ƒæ‰§è¡Œå„ç§åŠ¨ä½œã€‚ï¼ˆæ¯”å¦‚è½¬ç§»ä»£å¸ï¼Œå†™å…¥å†…éƒ¨å­˜å‚¨ï¼ŒæŒ–å‡ºä¸€ä¸ªæ–°ä»£å¸ï¼Œæ‰§è¡Œä¸€äº›è¿ç®—ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„åˆçº¦ç­‰ç­‰ï¼‰ã€‚ ä»¥å¤ªå¸ä»¥å¤ªå¸ï¼ˆEtherï¼‰æ˜¯ä»¥å¤ªåŠç½‘ç»œä¸­çš„è´§å¸ã€‚ ä»¥å¤ªå¸ä¸»è¦ç”¨äºè´­ä¹°ç‡ƒæ–™ï¼Œæ”¯ä»˜ç»™çŸ¿å·¥ï¼Œä»¥ç»´æŠ¤ä»¥å¤ªåŠç½‘ç»œè¿è¡Œæ™ºèƒ½åˆçº¦çš„è´¹ç”¨ã€‚ä»¥å¤ªå¸æœ€å°å•ä½æ˜¯ weiï¼Œä¸€ä¸ªä»¥å¤ªå¸ç­‰äº 10^18 ä¸ª weiã€‚ ä»¥å¤ªå¸åŒæ ·å¯ä»¥é€šè¿‡æŒ–çŸ¿æ¥ç”Ÿæˆï¼ŒæˆåŠŸç”Ÿæˆæ–°åŒºå—çš„ä»¥å¤ªåŠçŸ¿å·¥å¯ä»¥è·å¾— 3 ä¸ªä»¥å¤ªå¸çš„å¥–åŠ±ï¼Œä»¥åŠåŒ…å«åœ¨åŒºå—å†…äº¤æ˜“çš„ç‡ƒæ–™è´¹ç”¨ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡äº¤æ˜“å¸‚åœºæ¥ç›´æ¥è´­ä¹°ä»¥å¤ªå¸ã€‚ ç›®å‰æ¯å¹´å¤§çº¦å¯ä»¥é€šè¿‡æŒ–çŸ¿ç”Ÿæˆè¶…è¿‡ä¸€åƒä¸‡ä¸ªä»¥å¤ªå¸ï¼Œå•ä¸ªä»¥å¤ªå¸çš„å¸‚åœºä»·æ ¼ç›®å‰è¶…è¿‡ 300 ç¾é‡‘ã€‚ ç‡ƒæ–™Gasç‡ƒæ–™ï¼ˆGasï¼‰ï¼Œæ§åˆ¶æŸæ¬¡äº¤æ˜“æ‰§è¡ŒæŒ‡ä»¤çš„ä¸Šé™ã€‚æ¯æ‰§è¡Œä¸€æ¡åˆçº¦æŒ‡ä»¤ä¼šæ¶ˆè€—å›ºå®šçš„ç‡ƒæ–™ã€‚å½“æŸä¸ªäº¤æ˜“è¿˜æœªæ‰§è¡Œç»“æŸï¼Œè€Œç‡ƒæ–™æ¶ˆè€—å®Œæ—¶ï¼Œåˆçº¦æ‰§è¡Œç»ˆæ­¢å¹¶å›æ»šçŠ¶æ€ã€‚ Gas å¯ä»¥è·Ÿä»¥å¤ªå¸è¿›è¡Œå…‘æ¢ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥å¤ªå¸çš„ä»·æ ¼æ˜¯æ³¢åŠ¨çš„ï¼Œä½†è¿è¡ŒæŸæ®µæ™ºèƒ½åˆçº¦çš„ç‡ƒæ–™è´¹ç”¨å¯ä»¥æ˜¯å›ºå®šçš„ï¼Œé€šè¿‡è®¾å®š Gas ä»·æ ¼ç­‰è¿›è¡Œè°ƒèŠ‚ã€‚ ä»¥å¤ªåŠè™šæ‹Ÿæœºä»¥å¤ªåŠæ˜¯ä¸€ä¸ªå¯ç¼–ç¨‹çš„åŒºå—é“¾ï¼Œä¸ä»…ä»…æ˜¯ç»™ç”¨æˆ·ä¸€äº›é¢„å®šä¹‰æ“ä½œï¼ˆå¦‚æ¯”ç‰¹å¸åªäº¤æ˜“ï¼‰ï¼Œä»¥å¤ªåŠå…è®¸ç”¨æˆ·åˆ›å»ºå±äºä»–ä»¬è‡ªå·±çš„å¤æ‚çš„æ“ä½œã€‚ä»¥å¤ªåŠä½œä¸ºä¸€ä¸ªå¹³å°ä¸ºä¸åŒçš„åŒºå—é“¾åº”ç”¨æä¾›æœåŠ¡ã€‚ ç‹­ä¹‰æ¥è¯´ï¼Œä»¥å¤ªåŠæ˜¯ä¸€ç³»åˆ—åè®®ï¼Œå…¶æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªä»¥å¤ªåŠè™šæ‹Ÿæœºï¼Œèƒ½æ‰§è¡Œéµå®ˆåè®®çš„ä»»ä½•å¤æ‚çš„ä»£ç ã€‚ä»¥å¤ªåŠè™šæ‹Ÿæœºæ˜¯å›¾çµå®Œå¤‡çš„ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸Šä½¿ç”¨åƒ javascriptï¼Œpython è¿™æ ·çš„å‹å¥½çš„ç¼–ç¨‹è¯­è¨€æ¥åˆ›å»ºåº”ç”¨ã€‚ å’Œä»»ä½•çš„åŒºå—é“¾ä¸€æ ·ï¼Œä»¥å¤ªåŠåŒ…å«äº†ä¸€ä¸ªç‚¹å¯¹ç‚¹çš„ç½‘ç»œåè®®ã€‚è¿™ä»¥å¤ªåŠåŒºå—é“¾æ˜¯è¢«é“¾æ¥ç€è¿™ä¸ªç½‘ç»œçš„å„ä¸ªèŠ‚ç‚¹ç»´æŠ¤å’Œæ›´æ–°çš„ã€‚ç½‘ç»œä¸­çš„å„ä¸ªèŠ‚ç‚¹çš„è™šæ‹Ÿæœºéƒ½æ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤æ¥å…±åŒç»´æŠ¤åŒºå—æ•°æ®åº“ï¼Œå› ä¸ºè¿™ä¸ªåŸå› ï¼Œä»¥å¤ªåŠæœ‰æ—¶å€™è¢«äººç§°ä¸ºâ€œä¸–ç•Œè®¡ç®—æœºâ€ã€‚ ä»¥å¤ªåŠå…¨ç½‘çš„å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—ä¸æ˜¯åªä¸ºäº†æè®¡ç®—æ•ˆç‡ï¼Œè€Œæ˜¯ä¸ºäº†ä¿è¯å…¨ç½‘çš„æ•°æ®ä¸€è‡´æ€§ã€‚å®é™…ä¸Šï¼Œè¿™ä½¿å¾—åœ¨ä»¥å¤ªç½‘ä¸Šçš„ è¿ç®—è¦æ¯”ä¼ ç»Ÿçš„ç”µè„‘æ…¢çš„å¤šï¼Œæˆæœ¬ä¹Ÿæ˜‚è´µå¾—å¤šã€‚å…¨ç½‘ä¸­çš„æ¯ä¸€å°è™šæ‹Ÿæœºçš„è¿è¡Œéƒ½æ˜¯ä¸ºç¡®ä¿å…¨ç½‘æ•°æ®åº“çš„ä¸€è‡´æ€§ã€‚å»ä¸­å¿ƒåŒ–çš„ä¸€è‡´æ€§ç»™å…¨ç½‘æç«¯çš„å®¹é”™èƒ½åŠ›;æŠ—å®¡æŸ¥èƒ½åŠ›å’Œæ°¸ä¸å®•æœºèƒ½åŠ›ç­‰ã€‚ ä»¥å¤ªåŠè´¦æˆ·ä»¥å¤ªåŠçš„åŸºæœ¬å•å…ƒæ˜¯è´¦å·ã€‚æ¯ä¸€ä¸ªè´¦æˆ·éƒ½æœ‰ä¸€ä¸ª 20 ä¸ªå­—èŠ‚é•¿åº¦çš„åœ°å€ ã€‚ä»¥å¤ªåŠåŒºå—é“¾è·Ÿè¸ªæ¯ä¸€ä¸ªè´¦å·çš„çŠ¶æ€ï¼ŒåŒºå—é“¾ä¸Šæ‰€æœ‰çŠ¶æ€çš„è½¬ç§»éƒ½æ˜¯è´¦æˆ·ä¹‹é—´çš„ä»¤ç‰Œï¼ˆä»¤ç‰Œå³ä»¥å¤ªå¸ï¼‰å’Œä¿¡æ¯çš„è½¬ç§»ã€‚ä»¥å¤ªåŠæœ‰ 2 ç§è´¦æˆ·ç±»å‹ï¼š å¤–éƒ¨è´¦å·ï¼Œç®€ç§° EOA,æ˜¯ç”±ç§é’¥æ¥æ§åˆ¶çš„ã€‚ æœ‰ä¸€ä¸ªä»¥å¤ªå¸çš„ä½™é¢ å¯ä»¥å‘é€äº¤æ˜“(ä»¥å¤ªå¸è½¬è´¦æˆ–è€…æ¿€æ´»åˆçº¦ä»£ç ) é€šè¿‡ç§é’¥æ§åˆ¶ æ²¡æœ‰ç›¸å…³è”çš„ä»£ç  åˆçº¦å¸æˆ·,ç”±åˆçº¦ä»£ç æ¥æ§åˆ¶,ä¸”åªèƒ½ç”±ä¸€ä¸ª EOA è´¦å·æ¥æ“ä½œ æœ‰ä¸€ä¸ªä»¥å¤ªå¸ä½™é¢ ç›¸å…³è”çš„ä»£ç  ä»£ç æ‰§è¡Œæ˜¯é€šè¿‡äº¤æ˜“åè€…å…¶ä»–çš„åˆçº¦å‘é€çš„callæ¥æ¿€æ´» å½“è¢«æ‰§è¡Œæ—¶ â€“ è¿è¡Œåœ¨éšæœºå¤æ‚åº¦(å›¾çµå®Œå¤‡æ€§) â€“ åªèƒ½æ“ä½œå…¶æ‹¥æœ‰çš„ç‰¹å®šå­˜å‚¨ï¼Œ ä¾‹å¦‚å¯ä»¥æ‹¥æœ‰å…¶æ°¸ä¹…çš„state â€“ å¯ä»¥callå…¶ä»–åˆçº¦ è¿è¡Œç¯å¢ƒå’Œè¯­è¨€è¿è¡Œç¯å¢ƒä»¥å¤ªåŠé‡‡ç”¨ä»¥å¤ªåŠè™šæ‹Ÿæœºä½œä¸ºæ™ºèƒ½åˆçº¦çš„è¿è¡Œç¯å¢ƒã€‚ä»¥å¤ªåŠè™šæ‹Ÿæœºæ˜¯ä¸€ä¸ªéš”ç¦»çš„è½»é‡çº§è™šæ‹Ÿæœºç¯å¢ƒï¼Œè¿è¡Œåœ¨å…¶ä¸­çš„æ™ºèƒ½åˆçº¦ä»£ç æ— æ³•è®¿é—®æœ¬åœ°ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿæˆ–å…¶å®ƒè¿›ç¨‹ã€‚ å¯¹åŒä¸€ä¸ªæ™ºèƒ½åˆçº¦æ¥è¯´ï¼Œå¾€å¾€éœ€è¦åœ¨å¤šä¸ªä»¥å¤ªåŠè™šæ‹Ÿæœºä¸­åŒæ—¶è¿è¡Œå¤šä»½ï¼Œä»¥ç¡®ä¿æ•´ä¸ªåŒºå—é“¾æ•°æ®çš„ä¸€è‡´æ€§å’Œé«˜åº¦çš„å®¹é”™æ€§ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ä¹Ÿé™åˆ¶äº†æ•´ä¸ªç½‘ç»œçš„å®¹é‡ã€‚ å¼€å‘è¯­è¨€ä»¥å¤ªåŠä¸ºç¼–å†™æ™ºèƒ½åˆçº¦è®¾è®¡äº†å›¾çµå®Œå¤‡çš„é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œé™ä½äº†æ™ºèƒ½åˆçº¦å¼€å‘çš„éš¾åº¦ã€‚ ç›®å‰ Solidity æ˜¯æœ€å¸¸ç”¨çš„ä»¥å¤ªåŠåˆçº¦ç¼–å†™è¯­è¨€ä¹‹ä¸€ã€‚ æ™ºèƒ½åˆçº¦ç¼–å†™å®Œæ¯•åï¼Œç”¨ç¼–è¯‘å™¨ç¼–è¯‘ä¸ºä»¥å¤ªåŠè™šæ‹Ÿæœºä¸“ç”¨çš„äºŒè¿›åˆ¶æ ¼å¼ï¼ˆEVM bytecodeï¼‰ï¼Œç”±å®¢æˆ·ç«¯ä¸Šä¼ åˆ°åŒºå—é“¾å½“ä¸­ï¼Œä¹‹ååœ¨çŸ¿å·¥çš„ä»¥å¤ªåŠè™šæ‹Ÿæœºä¸­æ‰§è¡Œã€‚ æ¶ˆæ¯å’Œäº¤æ˜“ä»¥å¤ªåŠäº¤æ˜“äº¤æ˜“ï¼ˆTransactionï¼‰ï¼Œåœ¨ä»¥å¤ªåŠä¸­æ˜¯æŒ‡ä»ä¸€ä¸ªè´¦æˆ·åˆ°å¦ä¸€ä¸ªè´¦æˆ·çš„æ¶ˆæ¯æ•°æ®ã€‚æ¶ˆæ¯æ•°æ®å¯ä»¥æ˜¯ä»¥å¤ªå¸æˆ–è€…åˆçº¦æ‰§è¡Œå‚æ•°ã€‚ åè¯â€œäº¤æ˜“â€åœ¨ä»¥å¤ªåŠä¸­æ˜¯æŒ‡ç­¾åçš„æ•°æ®åŒ…ï¼Œè¿™ä¸ªæ•°æ®åŒ…ä¸­å­˜å‚¨äº†ä»å¤–éƒ¨è´¦æˆ·å‘é€çš„æ¶ˆæ¯ï¼Œä»¥å¤ªåŠæ˜¯ç”¨äº¤æ˜“ä½œä¸ºæ“ä½œçš„æœ€å°å•ä½ï¼Œäº¤æ˜“åŒ…å«ä»¥ä¸‹å†…å®¹: æ¶ˆæ¯çš„æ¥å—è€… ä¸€ä¸ªå¯ä»¥è¯†åˆ«å‘é€è€…çš„ç­¾å å‘é€æ–¹ç»™æ¥æ”¶æ–¹çš„ä»¥å¤ªå¸æ•°é‡ ä¸€ä¸ªå¯é€‰çš„æ•°æ®å­—æ®µ ä¸€ä¸ª STARTGAS å€¼, è¡¨ç¤ºæ‰§è¡Œè¿™ä¸ªäº¤æ˜“å…è®¸æ¶ˆè€—çš„æœ€å¤§è®¡ç®—æ­¥éª¤ ä¸€ä¸ª GASPRICE å€¼, è¡¨ç¤ºå‘é€æ–¹çš„æ¯ä¸ªè®¡ç®—æ­¥éª¤çš„è´¹ç”¨ å‰é¢ä¸‰ä¸ªæ˜¯æ¯ä¸€ä¸ªåŠ å¯†è´§å¸éƒ½æœ‰çš„æ ‡å‡†å­—æ®µã€‚é»˜è®¤æƒ…å†µä¸‹ç¬¬å››ä¸ªæ•°æ®å­—æ®µæ²¡æœ‰ä»»ä½•åŠŸèƒ½ï¼Œä½†æ˜¯åˆçº¦å¯ä»¥è®¿é—®è¿™é‡Œçš„æ•°æ®ï¼›ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªåˆçº¦æ˜¯åœ¨ä¸€ä¸ªåŒºå—é“¾ä¸Šæä¾›åŸŸåæ³¨å†ŒæœåŠ¡çš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæƒ³æŠŠè¿™æ•°æ®å­—æ®µä¸­çš„æ•°æ®è§£ææˆ 2 ä¸ªå­—æ®µï¼Œç¬¬ä¸€ä¸ªå­—æ®µæ˜¯åŸŸåï¼Œç¬¬äºŒä¸ªå­—æ®µæ˜¯åŸŸåå¯¹åº”çš„ IP åœ°å€ã€‚è¿™ä¸ªåˆçº¦ä¼šä»æ•°æ®å­—æ®µä¸­è¯»å–è¿™äº›å€¼ï¼Œç„¶åé€‚å½“æŠŠå®ƒä»¬ä¿å­˜ä¸‹æ¥ã€‚ è¿™ä¸ª STARTGAS å’Œ GASPRICE å­—æ®µ æ˜¯ä»¥å¤ªåŠçš„é¢„é˜²æ‹’ç»å¼æ”»å‡»ç”¨çš„ï¼Œéå¸¸é‡è¦ã€‚ä¸ºäº†é˜²æ­¢åœ¨ä»£ç ä¸­å‡ºç°æ„å¤–æˆ–æ•Œå¯¹çš„æ— é™å¾ªç¯æˆ–å…¶ä»–è®¡ç®—æµªè´¹ï¼Œæ¯ä¸ªäº¤æ˜“éƒ½éœ€è¦è®¾ç½®ä¸€ä¸ªé™åˆ¶ï¼Œä»¥é™åˆ¶å®ƒçš„è®¡ç®—æ€»æ­¥éª¤æ˜¯ä¸€ä¸ªæ˜ç¡®çš„å€¼ã€‚è¿™è®¡ç®—çš„åŸºæœ¬å•ä½æ˜¯â€œæ±½æ²¹ï¼ˆgasï¼‰â€ï¼› é€šå¸¸ï¼Œä¸€ä¸ªè®¡ç®—æˆæœ¬æ˜¯ä¸€ä¸ª 1 æ»´æ±½æ²¹ï¼Œä½†æ˜¯ä¸€äº›æ“ä½œéœ€è¦æ¶ˆè€—æ›´å¤šçš„æ±½æ²¹ï¼Œå› ä¸ºå®ƒä»¬çš„è®¡ç®—æˆæœ¬æ›´é«˜ã€‚åœ¨äº¤æ˜“æ•°æ®ä¸­æ¯ä¸€ä¸ªå­—èŠ‚éœ€è¦æ¶ˆè€— 5 æ»´æ±½æ²¹ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†è®©æ”»å‡»è€…ä¸ºä»–ä»¬æ‰€æ¶ˆè€—çš„æ¯ä¸€ç§èµ„æºï¼ŒåŒ…æ‹¬è®¡ç®—ï¼Œå¸¦å®½å’Œå­˜å‚¨æ”¯ä»˜è´¹ç”¨ï¼›æ‰€ä»¥æ¶ˆè€—ç½‘ç»œèµ„æºè¶Šå¤šï¼Œåˆ™äº¤æ˜“æˆæœ¬å°±è¶Šå¤§ã€‚ äº¤æ˜“æ¨¡å‹UTXOæ¨¡å‹UTXO æ¨¡å‹ä¸­ï¼Œäº¤æ˜“åªæ˜¯ä»£è¡¨äº† UTXO é›†åˆçš„å˜æ›´ã€‚è€Œè´¦æˆ·å’Œä½™é¢çš„æ¦‚å¿µæ˜¯åœ¨ UTXO é›†åˆä¸Šæ›´é«˜çš„æŠ½è±¡ï¼Œè´¦å·å’Œä½™é¢çš„æ¦‚å¿µåªå­˜åœ¨äºé’±åŒ…ä¸­ã€‚ ä¼˜ç‚¹ï¼š è®¡ç®—æ˜¯åœ¨é“¾å¤–çš„ï¼Œäº¤æ˜“æœ¬èº«æ—¢æ˜¯ç»“æœä¹Ÿæ˜¯è¯æ˜ã€‚èŠ‚ç‚¹åªåšéªŒè¯å³å¯ï¼Œä¸éœ€è¦å¯¹äº¤æ˜“è¿›è¡Œé¢å¤–çš„è®¡ç®—ï¼Œä¹Ÿæ²¡æœ‰é¢å¤–çš„çŠ¶æ€å­˜å‚¨ã€‚äº¤æ˜“æœ¬èº«çš„è¾“å‡º UTXO çš„è®¡ç®—æ˜¯åœ¨é’±åŒ…å®Œæˆçš„ï¼Œè¿™æ ·äº¤æ˜“çš„è®¡ç®—è´Ÿæ‹…å®Œå…¨ç”±é’±åŒ…æ¥æ‰¿æ‹…ï¼Œä¸€å®šç¨‹åº¦ä¸Šå‡å°‘äº†é“¾çš„è´Ÿæ‹…ã€‚ é™¤ Coinbase äº¤æ˜“å¤–ï¼Œäº¤æ˜“çš„ Input å§‹ç»ˆæ˜¯é“¾æ¥åœ¨æŸä¸ª UTXO åé¢ã€‚äº¤æ˜“æ— æ³•è¢«é‡æ”¾ï¼Œå¹¶ä¸”äº¤æ˜“çš„å…ˆåé¡ºåºå’Œä¾èµ–å…³ç³»å®¹æ˜“è¢«éªŒè¯ï¼Œäº¤æ˜“æ˜¯å¦è¢«æ¶ˆè´¹ä¹Ÿå®¹æ˜“è¢«ä¸¾è¯ã€‚ UTXO æ¨¡å‹æ˜¯æ— çŠ¶æ€çš„ï¼Œæ›´å®¹æ˜“å¹¶å‘å¤„ç†ã€‚ å¯¹äº P2SH ç±»å‹çš„äº¤æ˜“ï¼Œå…·æœ‰æ›´å¥½çš„éšç§æ€§ã€‚äº¤æ˜“ä¸­çš„ Input æ˜¯äº’ä¸ç›¸å…³è”çš„ï¼Œå¯ä»¥ä½¿ç”¨ CoinJoin è¿™æ ·çš„æŠ€æœ¯ï¼Œæ¥å¢åŠ ä¸€å®šçš„éšç§æ€§ã€‚ ç¼ºç‚¹ï¼š æ— æ³•å®ç°ä¸€äº›æ¯”è¾ƒå¤æ‚çš„é€»è¾‘ï¼Œå¯ç¼–ç¨‹æ€§å·®ã€‚å¯¹äºå¤æ‚é€»è¾‘ï¼Œæˆ–è€…éœ€è¦çŠ¶æ€ä¿å­˜çš„åˆçº¦ï¼Œå®ç°éš¾åº¦å¤§ï¼Œä¸”çŠ¶æ€ç©ºé—´åˆ©ç”¨ç‡æ¯”è¾ƒä½ã€‚ å½“ Input è¾ƒå¤šæ—¶ï¼Œè§è¯è„šæœ¬ä¹Ÿä¼šå¢å¤šã€‚è€Œç­¾åæœ¬èº«æ˜¯æ¯”è¾ƒæ¶ˆè€— CPU å’Œå­˜å‚¨ç©ºé—´çš„ã€‚ ACCOUNTæ¨¡å‹å‡ºäºæ™ºèƒ½åˆçº¦çš„ä¾¿åˆ©è€ƒè™‘ï¼Œä»¥å¤ªåŠé‡‡ç”¨äº†è´¦æˆ·çš„æ¨¡å‹ï¼ŒçŠ¶æ€å¯ä»¥å®æ—¶çš„ä¿å­˜åˆ°è´¦æˆ·é‡Œï¼Œè€Œæ— éœ€åƒæ¯”ç‰¹å¸çš„ UXTO æ¨¡å‹é‚£æ ·å»å›æº¯æ•´ä¸ªå†å²ã€‚ å¯¹äº Account æ¨¡å‹ï¼ŒAccount æ¨¡å‹ä¿å­˜äº†ä¸–ç•ŒçŠ¶æ€ï¼Œé“¾çš„çŠ¶æ€ä¸€èˆ¬åœ¨åŒºå—ä¸­ä»¥ StateRoot å’Œ ReceiptRoot ç­‰å½¢å¼è¿›è¡Œå…±è¯†ã€‚äº¤æ˜“åªæ˜¯äº‹ä»¶æœ¬èº«ï¼Œä¸åŒ…å«ç»“æœï¼Œäº¤æ˜“çš„å…±è¯†å’ŒçŠ¶æ€çš„å…±è¯†æœ¬è´¨ä¸Šå¯ä»¥éš”ç¦»çš„ã€‚ ä¼˜ç‚¹ï¼š åˆçº¦ä»¥ä»£ç å½¢å¼ä¿å­˜åœ¨ Account ä¸­ï¼Œå¹¶ä¸” Account æ‹¥æœ‰è‡ªèº«çŠ¶æ€ã€‚è¿™ç§æ¨¡å‹å…·æœ‰æ›´å¥½çš„å¯ç¼–ç¨‹æ€§ï¼Œå®¹æ˜“å¼€å‘äººå‘˜ç†è§£ï¼Œåœºæ™¯æ›´å¹¿æ³›ã€‚ æ‰¹é‡äº¤æ˜“çš„æˆæœ¬è¾ƒä½ã€‚è®¾æƒ³çŸ¿æ± å‘çŸ¿å·¥æ”¯ä»˜æ‰‹ç»­è´¹ï¼ŒUTXO ä¸­å› ä¸ºæ¯ä¸ª Input å’Œ Out éƒ½éœ€è¦å•ç‹¬ Witness script æˆ–è€… Locking scriptï¼Œäº¤æ˜“æœ¬èº«ä¼šéå¸¸å¤§ï¼Œç­¾åéªŒè¯å’Œäº¤æ˜“å­˜å‚¨éƒ½éœ€è¦æ¶ˆè€—é“¾ä¸Šå®è´µçš„èµ„æºã€‚è€Œ Account æ¨¡å‹å¯ä»¥é€šè¿‡åˆçº¦çš„æ–¹å¼æå¤§çš„é™ä½æˆæœ¬ã€‚ ç¼ºç‚¹ï¼š Account æ¨¡å‹äº¤æ˜“ä¹‹é—´æ²¡æœ‰ä¾èµ–æ€§ï¼Œéœ€è¦è§£å†³é‡æ”¾é—®é¢˜ã€‚ å¯¹äºå®ç°é—ªç”µç½‘ç»œ/é›·ç”µç½‘ç»œï¼ŒPlasma ç­‰ï¼Œç”¨æˆ·ä¸¾è¯éœ€è¦æ›´å¤æ‚çš„ Proof è¯æ˜æœºåˆ¶ï¼Œå­é“¾å‘ä¸»é“¾è¿›è¡ŒçŠ¶æ€è¿ç§»éœ€è¦æ›´å¤æ‚çš„åè®®ã€‚ UTXOå’ŒACCOUNTåŒºåˆ« è®¡ç®—é—®é¢˜ UTXO äº¤æ˜“æœ¬èº«å¯¹äºåŒºå—é“¾å¹¶æ²¡æœ‰å¤æ‚çš„è®¡ç®—ï¼Œè¿™æ ·ç®€å•çš„è®²å…¶å®å¹¶ä¸å®Œå…¨å‡†ç¡®ï¼ŒåŸå› åˆ†æœ‰ä¸¤ä¸ªï¼Œä¸€æ˜¯ Bitcoin æœ¬èº«çš„äº¤æ˜“å¤šä¸º P2SHï¼Œä¸” Witness script æ˜¯éå›¾çµå®Œå¤‡çš„ï¼Œä¸å­˜åœ¨å¾ªç¯è¯­å¥ã€‚è€Œå¯¹äº Account æ¨¡å‹ï¼Œä¾‹å¦‚ Ethereumï¼Œç”±äºè®¡ç®—å¤šåœ¨é“¾ä¸Šï¼Œä¸”ä¸ºå›¾çµå®Œå¤‡ï¼Œä¸€èˆ¬è®¡ç®—è¾ƒä¸ºå¤æ‚ï¼ŒåŒæ—¶åˆçº¦å®‰å…¨æ€§å°±å®¹æ˜“æˆä¸ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜ã€‚å½“ç„¶æ˜¯å¦å›¾çµå®Œå¤‡å¯¹äºæ˜¯å¦æ˜¯è´¦æˆ·æ¨¡å‹å¹¶æ²¡æœ‰ç›´æ¥å…³è”ã€‚ä½†æ˜¯è´¦æˆ·æ¨¡å‹å¼•å…¥ä¹‹åï¼Œåˆçº¦å¯ä»¥ä½œä¸ºä¸€ä¸ªä¸å—ä»»ä½•äººæ§åˆ¶çš„ç‹¬ç«‹å®ä½“å­˜åœ¨ï¼Œè¿™ä¸€ç‚¹æ„ä¹‰é‡å¤§ã€‚ UTXOæ›´æ˜“å¹¶å‘ åœ¨ UTXO æ¨¡å‹ä¸­ï¼Œä¸–ç•ŒçŠ¶æ€å³ä¸º UTXO çš„é›†åˆï¼ŒèŠ‚ç‚¹ä¸ºäº†æ›´å¿«çš„éªŒè¯äº¤æ˜“ï¼Œéœ€è¦åœ¨å†…å­˜ä¸­å­˜å‚¨æ‰€æœ‰çš„ UTXO çš„ç´¢å¼•ï¼Œå› æ­¤ UTXO æ˜¯éå¸¸æ˜‚è´µçš„ã€‚å¯¹äºé•¿æœŸä¸æ¶ˆè´¹çš„ UTXOï¼Œä¼šä¸€ç›´å ç”¨èŠ‚ç‚¹çš„å†…å­˜ã€‚æ‰€ä»¥å¯¹äºæ­¤ç§æ¨¡å‹ï¼Œç†è®ºä¸Šåº”è¯¥é¼“åŠ±ç”¨æˆ·å‡å°‘ç”Ÿäº§ UTXOï¼Œå¤šæ¶ˆè€— UTXOã€‚ä½†æ˜¯å¦‚æœè¦ä½¿ç”¨ UTXO è¿›è¡Œå¹¶è¡Œäº¤æ˜“åˆ™éœ€è¦æ›´å¤šçš„ UTXO ä½œä¸ºè¾“å…¥ï¼ŒåŒæ—¶è¦äº§ç”Ÿæ›´å¤šçš„ UTXO æ¥ä¿è¯å¹¶å‘æ€§ï¼Œè¿™æœ¬è´¨ä¸Šæ˜¯å¯¹ç½‘ç»œè¿›è¡Œäº†ç²‰å°˜æ”»å‡»ã€‚å¹¶ä¸”ç”±äºäº¤æ˜“æ˜¯åœ¨é’±åŒ…å†…æ„é€ ï¼Œæ‰€ä»¥éœ€è¦é’±åŒ…æ›´å¤æ‚çš„è®¾è®¡ã€‚åè§‚ Account æ¨¡å‹ï¼Œæ¯ä¸ªè´¦æˆ·å¯ä»¥çœ‹æˆæ˜¯å•ç‹¬çš„äº’ä¸å½±å“çš„çŠ¶æ€æœºï¼Œè´¦æˆ·ä¹‹é—´é€šè¿‡æ¶ˆæ¯è¿›è¡Œé€šä¿¡ã€‚æ‰€ä»¥ç†è®ºä¸Šç”¨æˆ·å‘èµ·å¤šç¬”äº¤æ˜“æ—¶ï¼Œå½“è¿™äº›äº¤æ˜“ä¹‹é—´ä¸ä¼šäº’ç›¸è°ƒç”¨åŒä¸€ Account æ—¶ï¼Œäº¤æ˜“æ˜¯å®Œå…¨å¯ä»¥å¹¶å‘æ‰§è¡Œçš„ã€‚ Accountæ¨¡å‹çš„äº¤æ˜“é‡æ”¾ Ethereum ä½¿ç”¨äº†åœ¨ Account ä¸­å¢åŠ  nonce çš„æ–¹å¼ï¼Œæ¯ç¬”äº¤æ˜“å¯¹åº”ä¸€ä¸ª nonceï¼Œnonce æ¯æ¬¡é€’å¢ã€‚è¿™ç§æ–¹å¼è™½ç„¶æ„åœ¨è§£å†³é‡æ”¾çš„é—®é¢˜ï¼Œä½†æ˜¯åŒæ—¶å¼•å…¥äº†é¡ºåºæ€§é—®é¢˜ï¼ŒåŒæ—¶ä½¿å¾—äº¤æ˜“æ— æ³•å¹¶è¡Œã€‚ä¾‹å¦‚åœ¨ Ethereumä¸­ï¼Œç”¨æˆ·å‘é€å¤šç¬”äº¤æ˜“ï¼Œå¦‚æœç¬¬ä¸€ç¬”äº¤æ˜“æ‰“åŒ…å¤±è´¥ï¼Œå°†å¼•èµ·åç»­å¤šç¬”äº¤æ˜“éƒ½æ‰“åŒ…ä¸æˆåŠŸã€‚åœ¨ CITA ä¸­æˆ‘ä»¬ä½¿ç”¨äº†éšæœº nonce çš„æ–¹æ¡ˆï¼Œè¿™æ ·ç”¨æˆ·çš„äº¤æ˜“ä¹‹é—´æ²¡æœ‰é¡ºåºæ€§ä¾èµ–ï¼Œä¸ä¼šå¼•èµ·ä¸²è”æ€§å¤±è´¥ï¼ŒåŒæ—¶ä½¿å¾—äº¤æ˜“æœ‰å¹¶è¡Œå¤„ç†çš„å¯èƒ½ã€‚ å­˜å‚¨é—®é¢˜ å› ä¸º UTXO æ¨¡å‹ä¸­ï¼Œåªèƒ½åœ¨äº¤æ˜“ä¸­ä¿å­˜çŠ¶æ€ã€‚è€Œ Account æ¨¡å‹çš„çŠ¶æ€æ˜¯åœ¨èŠ‚ç‚¹ä¿å­˜ï¼Œåœ¨ Ethereum ä¸­ä½¿ç”¨ MPT çš„æ–¹å¼å­˜å‚¨ï¼ŒBlock ä¸­åªéœ€è¦å…±è¯† StateRoot ç­‰å³å¯ã€‚è¿™æ ·å¯¹äºé“¾ä¸Šæ•°æ®ï¼ŒAccount æ¨¡å‹å®é™…æ›´å°ï¼Œç½‘ç»œä¼ è¾“çš„é‡æ›´å°ï¼ŒåŒæ—¶çŠ¶æ€åœ¨èŠ‚ç‚¹æœ¬åœ°ä½¿ç”¨ MPT æ–¹å¼ä¿å­˜ï¼Œåœ¨ç©ºé—´ä½¿ç”¨ä¸Šä¹Ÿæ›´æœ‰æ•ˆç‡ã€‚ä¾‹å¦‚ A å‘ B è½¬è´¦ï¼Œå¦‚æœåœ¨ UTXO ä¸­å‡è®¾å­˜åœ¨ 2 ä¸ª Input å’Œ2ä¸ª Outputï¼Œåˆ™éœ€è¦ 2 ä¸ª Witness script å’Œ 2 ä¸ª Locking scriptï¼›åœ¨ Account æ¨¡å‹ä¸­åˆ™åªéœ€è¦ä¸€ä¸ªç­¾åï¼Œäº¤æ˜“å†…å®¹åªåŒ…å«é‡‘é¢å³å¯ã€‚åœ¨æœ€æ–°çš„éš”ç¦»è§è¯å®ç°åï¼ŒBitcoin çš„äº¤æ˜“æ•°æ®é‡ä¹Ÿå¤§å¤§å‡å°‘ï¼Œä½†æ˜¯å®é™…ä¸Šå¯¹äºéªŒè¯èŠ‚ç‚¹å’Œå…¨èŠ‚ç‚¹ä»ç„¶éœ€è¦é’ˆå¯¹ Witness script è¿›è¡Œä¼ è¾“å’ŒéªŒè¯ã€‚ è½»èŠ‚ç‚¹è·å–åœ°å€çŠ¶æ€éš¾æ˜“ ä¾‹å¦‚é’±åŒ…ä¸­ï¼Œéœ€è¦å‘å…¨èŠ‚ç‚¹è¯·æ±‚æ‰€æœ‰å…³äºæŸä¸ªåœ°å€çš„æ‰€æœ‰ UTXOï¼Œå…¨èŠ‚ç‚¹å¯ä»¥å‘é€éƒ¨åˆ† UTXOï¼Œé’±åŒ…è¦éªŒè¯è¯¥ç¬” UTXO æ˜¯å¦å·²ç»è¢«æ¶ˆè´¹ï¼Œæœ‰ä¸€å®šçš„éš¾åº¦ï¼Œè€Œä¸”é’±åŒ…å¾ˆéš¾å»è¯æ˜ UTXO æ˜¯å…¨é›†è€Œä¸æ˜¯éƒ¨åˆ†é›†åˆã€‚è€Œå¯¹äº Account æ¨¡å‹åˆ™ç®€å•å¾ˆå¤šï¼Œæ ¹æ®åœ°å€æ‰¾åˆ° State ä¸­å¯¹åº”çŠ¶æ€ï¼Œå½“å‰çŠ¶æ€çš„ State Proof åˆ™å¯ä»¥è¯æ˜åˆçº¦æ•°æ®çš„çœŸä¼ªã€‚å½“ç„¶å¯¹äº UTXO ä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªåŒºå—ä¸­å¯¹ UTXO çš„ root è¿›è¡ŒéªŒè¯ï¼Œè¿™ä¸€ç‚¹ä¸å½“å‰ Bitcoin çš„å®ç°æœ‰å…³ï¼Œå¹¶é UTXO çš„ç‰¹ç‚¹ã€‚ ç»¼ä¸Š â€‹ ç»¼ä¸Šæ¥çœ‹ï¼ŒAccount æ¨¡å‹åœ¨å¯ç¼–ç¨‹æ€§ï¼Œçµæ´»æ€§ç­‰æ–¹é¢æ›´æœ‰ä¼˜åŠ¿ï¼›åœ¨ç®€å•ä¸šåŠ¡å’Œè·¨é“¾ä¸Šï¼ŒUTXO æœ‰å…¶éå¸¸ç‹¬åˆ°å’Œå¼€åˆ›æ€§çš„ä¼˜ç‚¹ã€‚å¯¹äºé€‰æ‹©ä½•ç§æ¨¡å‹ï¼Œè¦ä»å…·ä½“çš„ä¸šåŠ¡åœºæ™¯è¿›è¡Œå‡ºå‘ã€‚ UTXOå’ŒACCOUNTçš„å¯¹æ¯” ä»¥å¤ªåŠæ¶ˆæ¯åˆçº¦å…·æœ‰å‘é€â€æ¶ˆæ¯â€åˆ°å…¶ä»–åˆçº¦çš„èƒ½åŠ›ã€‚æ¶ˆæ¯æ˜¯ä¸€ä¸ªæ°¸ä¸ä¸²è¡Œä¸”åªåœ¨ä»¥å¤ªåŠæ‰§è¡Œç¯å¢ƒä¸­å­˜åœ¨çš„è™šæ‹Ÿå¯¹è±¡ã€‚ä»–ä»¬å¯ä»¥è¢«ç†è§£ä¸ºå‡½æ•°è°ƒç”¨ï¼ˆfunction callsï¼‰ã€‚ ä¸€ä¸ªæ¶ˆæ¯åŒ…æ‹¬ï¼š æ˜ç¡®çš„æ¶ˆæ¯å‘é€è€… æ¶ˆæ¯çš„æ¥æ”¶è€… ä¸€ä¸ªå¯é€‰çš„æ•°æ®åŸŸï¼Œè¿™æ˜¯åˆçº¦å®é™…ä¸Šçš„è¾“å…¥æ•°æ® ä¸€ä¸ªGASLIMITå€¼ï¼Œç”¨æ¥é™åˆ¶è¿™ä¸ªæ¶ˆæ¯å‡ºå‘çš„ä»£ç æ‰§è¡Œå¯ç”¨çš„æœ€å¤§gasæ•°é‡ æ€»çš„æ¥è¯´ï¼Œä¸€ä¸ªæ¶ˆæ¯å°±åƒæ˜¯ä¸€ä¸ªäº¤æ˜“ï¼Œé™¤äº†å®ƒä¸æ˜¯ç”±å¤–éƒ¨è´¦æˆ·ç”Ÿæˆï¼Œè€Œæ˜¯åˆçº¦è´¦æˆ·ç”Ÿæˆã€‚å½“åˆçº¦æ­£åœ¨æ‰§è¡Œçš„ä»£ç ä¸­è¿è¡Œäº†CALL æˆ–è€…DELEGATECALLè¿™ä¸¤ä¸ªå‘½ä»¤æ—¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ¶ˆæ¯ã€‚æ¶ˆæ¯æœ‰çš„æ—¶å€™ä¹Ÿè¢«ç§°ä¸ºâ€å†…éƒ¨äº¤æ˜“â€ã€‚ä¸ä¸€ä¸ªäº¤æ˜“ç±»ä¼¼ï¼Œä¸€ä¸ªæ¶ˆæ¯ä¼šå¼•å¯¼æ¥æ”¶çš„è´¦æˆ·è¿è¡Œå®ƒçš„ä»£ç ã€‚å› æ­¤ï¼Œåˆçº¦è´¦æˆ·å¯ä»¥ä¸å…¶ä»–åˆçº¦è´¦æˆ·å‘ç”Ÿå…³ç³»ï¼Œè¿™ç‚¹å’Œå¤–éƒ¨è´¦æˆ·ä¸€æ ·ã€‚æœ‰è®¸å¤šäººä¼šè¯¯ç”¨äº¤æ˜“è¿™ä¸ªè¯æŒ‡ä»£æ¶ˆæ¯ï¼Œæ‰€ä»¥å¯èƒ½æ¶ˆæ¯è¿™ä¸ªè¯å·²ç»ç”±äºç¤¾åŒºçš„å…±è¯†è€Œæ…¢æ…¢é€€å‡ºå¤§å®¶çš„è§†é‡ï¼Œä¸å†è¢«ä½¿ç”¨ã€‚ ä»¥å¤ªåŠçŠ¶æ€è½¬ç§»å‡½æ•° ä»¥å¤ªåŠçš„çŠ¶æ€è½¬ç§»å‡½æ•° APPLY(S,TX) -&gt; Sâ€™ å¯ä»¥è¢«å®šä¹‰æˆä¸‹é¢çš„: æ£€æŸ¥è¿™ä¸ªäº¤æ˜“æ˜¯ä¸æ˜¯åˆæ³•çš„ ,ç­¾åæ˜¯ä¸æ˜¯åˆæ³•çš„, è¿™éšæœºæ•°æ˜¯ä¸æ˜¯åŒ¹é…è¿™ä¸ªå‘é€è€…çš„è´¦æˆ·ï¼Œå¦‚æœç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œé‚£è¿”å›é”™è¯¯ã€‚ ç”¨ STARTGAS * GASPRICE è®¡ç®—äº¤æ˜“çš„è´¹ç”¨ï¼Œå¹¶ä¸”ä»ç­¾åä¸­ç¡®å®šè¿™ä¸ªå‘é€è€…çš„åœ°å€ã€‚ ä»å‘é€è€…çš„ä½™é¢ä¸­å‡å»è´¹ç”¨ï¼Œå¹¶ä¸”å¢åŠ å‘é€è€…çš„éšæœºå€¼ã€‚å¦‚æœä½™é¢ä¸å¤Ÿï¼Œåˆ™è¿”å›é”™è¯¯ã€‚ åˆå§‹åŒ– GAS = STARTGAS, å¹¶æ ¹æ®è¿™äº¤æ˜“ä¸­çš„å­—èŠ‚æ•°æ‹¿èµ°ä¸€å®šé‡çš„æ±½æ²¹ã€‚ æŠŠäº¤æ˜“çš„å€¼ä»å‘é€çš„è´¦æˆ·è½¬ç§»åˆ°æ¥æ”¶è€…çš„è´¦æˆ·ã€‚å¦‚æœæ¥æ”¶è€…çš„è´¦æˆ·è¿˜ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºä¸€ä¸ªã€‚å¦‚æœè¿™ä¸ªæ¥æ”¶è€…çš„è´¦æˆ·æ˜¯ä¸€ä¸ªåˆçº¦ï¼Œé‚£ä¹ˆå°±è¿è¡Œåˆçº¦çš„ä»£ç ç›´åˆ°å®Œæˆï¼Œæˆ–è€…æŠ¥æ±½æ²¹æ¶ˆè€—å…‰çš„å¼‚å¸¸ã€‚ å¦‚æœå€¼è½¬ç§»å¤±è´¥äº†ï¼Œå› ä¸ºå‘é€è€…æ²¡æœ‰è¶³å¤Ÿå¤šçš„ä½™é¢ï¼Œæˆ–ä»£ç æ‰§è¡Œæ¶ˆè€—å…‰äº†æ±½æ²¹ï¼Œæ¢å¤é™¤äº†æ”¯ä»˜çš„è´¹ç”¨å¤–çš„æ‰€æœ‰çš„çŠ¶æ€ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªè´¹ç”¨æ·»åŠ åˆ°çŸ¿å·¥çš„è´¦æˆ·ä¸Šã€‚ å¦å¤–,æŠŠæ‰€æœ‰å‰©ä¸‹çš„æ±½æ²¹é€€è¿˜ç»™å‘é€è€…ï¼Œç„¶åæŠŠç”¨äºæ”¯ä»˜è´¹ç”¨çš„æ±½æ²¹å‘é€ç»™çŸ¿å·¥ã€‚ä¸¾ä¾‹ï¼Œå‡è®¾åˆçº¦çš„ä»£ç æ˜¯è¿™æ ·çš„:if !self.storage[calldataload(0)]: self.storage[calldataload(0)] = calldataload(32)æ³¨æ„ï¼ŒçœŸå®çš„åˆçº¦ä»£ç æ˜¯ç”¨åº•å±‚çš„ EVM ä»£ç ç¼–å†™çš„ï¼›è¿™ä¸ªåˆ—å­æ˜¯ç”¨ä¸€ä¸ªå« Serpent çš„é«˜çº§è¯­è¨€å†™çš„ã€‚å‡è®¾è¿™ä¸ªåˆçº¦çš„å­˜å‚¨å¼€å§‹æ˜¯ç©ºçš„ï¼Œå¹¶ä¸”å‘é€äº†ä¸€ä¸ªäº¤æ˜“ï¼Œå…¶ä¸­åŒ…å« 10 ä¸ªä»¥å¤ªå¸ï¼Œ2000 ä¸ªæ±½æ²¹ï¼Œæ±½æ²¹ä»·æ ¼æ˜¯ 0.001 æ¯”ç‰¹å¸ï¼Œå’Œ 64 å­—èŠ‚çš„æ•°æ®ï¼Œå…¶ä¸­ 0-31 å­—èŠ‚ä»£è¡¨æ•°å­— 2,32-63 å­—èŠ‚ä»£è¡¨å­—ç¬¦ä¸² CHARLIEã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œè¿™çŠ¶æ€è½¬ç§»å‡½æ•°çš„å¤„ç†å¦‚ä¸‹ï¼š æ£€æŸ¥è€…äº¤æ˜“æ˜¯å¦æœ‰æ•ˆå¹¶ä¸”æ ¼å¼å®Œå¥½ã€‚ æ£€æŸ¥è€…äº¤æ˜“çš„å‘é€è€…æ˜¯å¦è‡³å°‘æœ‰ 2000 * 0.001 = 2 ä»¥å¤ªå¸ã€‚å¦‚æœæœ‰ï¼Œåˆ™ä»å‘é€è€…çš„è´¦æˆ·ä¸­å‡å» 2 ä»¥å¤ªå¸ã€‚ åˆå§‹åŒ– æ±½æ²¹ï¼ˆgasï¼‰= 2000;å‡è®¾è¿™ä¸ªäº¤æ˜“æ˜¯ 170 ä¸ªå­—èŠ‚é•¿åº¦å¹¶ä¸”æ¯ä¸ªå­—èŠ‚çš„è´¹ç”¨æ˜¯ 5ï¼Œé‚£ä¹ˆå‡å» 850ï¼Œæ±½æ²¹è¿˜å‰© 1150ã€‚ ä»å‘é€è€…çš„è´¦æˆ·å‡å» 10 ä¸ªä»¥å¤ªå¸ï¼Œå¹¶ä¸”æ·»åŠ åˆ°åˆçº¦çš„è´¦æˆ·ä¸­ã€‚ è¿è¡Œåˆçº¦çš„ä»£ç . åœ¨è¿™é‡Œä¾‹å­ä¸­:æ£€æŸ¥åˆçº¦çš„å­˜å‚¨çš„ç¬¬ 2 ä¸ªç´¢å¼•æ˜¯å¦å·²ç»è¢«ä½¿ç”¨ï¼Œæ³¨æ„åˆ°å®ƒæ²¡ æœ‰ï¼Œç„¶åå°±æŠŠè¿™æ•°æ®å­˜å‚¨çš„ç¬¬äºŒä¸ªç´¢å¼•çš„å€¼è®¾ç½®ä¸º CHARLIE. å‡è®¾è¿™ä¸ªæ“ä½œæ¶ˆè€—äº† 187 ä¸ªæ±½ æ²¹ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„æ±½æ²¹æ€»é‡æ˜¯ 1150 â€“ 187 = 963 æŠŠ 963 * 0.001 = 0.963 ä»¥å¤ªå¸åŠ åˆ°å‘é€è€…çš„è´¦æˆ·ï¼Œç„¶ååæ­£ç»“æœçŠ¶æ€ã€‚ å¦‚æœäº¤æ˜“çš„æ¥æ”¶ç«¯æ²¡æœ‰åˆçº¦ï¼Œé‚£ä¹ˆè¿™æ€»çš„äº¤æ˜“è´¹ç”¨å°±ç®€å•çš„ç­‰äºæ±½æ²¹çš„ä»·æ ¼ä¹˜ä»¥è¿™ä¸ªäº¤æ˜“çš„å­—èŠ‚é•¿ åº¦ï¼Œä¸äº¤æ˜“ä¸€èµ·å‘é€çš„æ•°æ®å­—æ®µçš„æ•°æ®å°†æ— å…³é‡è¦ã€‚ æ³¨æ„ï¼Œåœ¨æ¢å¤è¿™ä¸ªæ–¹é¢ï¼Œæ¶ˆæ¯å’Œäº¤æ˜“çš„å¤„ç†æ–¹å¼æ˜¯ç›¸åŒçš„ï¼š å¦‚æœä¸€ä¸ªæ¶ˆæ¯æ‰§è¡Œæ¶ˆè€—å…‰äº†æ±½æ²¹ï¼Œé‚£ä¹ˆ è¿™æ¶ˆæ¯çš„æ‰§è¡Œå’Œå…¶ä»–è¢«è§¦å‘çš„æ‰§è¡Œéƒ½ä¼šè¢«æ¢å¤ï¼Œä½†æ˜¯çˆ¶ç±»çš„æ‰§è¡Œä¸ä¼šæ¢å¤ã€‚ Gasçš„è¯¦ç»†ä»‹ç»ä»€ä¹ˆæ˜¯gasä»¥å¤ªåŠåœ¨åŒºå—é“¾ä¸Šå®ç°äº†ä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œè¢«ç§°ä¸ºä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰ã€‚æ¯ä¸ªå‚ä¸åˆ°ç½‘ç»œçš„èŠ‚ç‚¹éƒ½ä¼šè¿è¡Œéƒ½ä¼šè¿è¡ŒEVMä½œä¸ºåŒºå—éªŒè¯åè®®çš„ä¸€éƒ¨åˆ†ã€‚ä»–ä»¬ä¼šéªŒè¯åŒºå—ä¸­æ¶µç›–çš„æ¯ä¸ªäº¤æ˜“å¹¶åœ¨EVMä¸­è¿è¡Œäº¤æ˜“æ‰€è§¦å‘çš„ä»£ç ã€‚æ¯ä¸ªç½‘ç»œä¸­çš„å…¨èŠ‚ç‚¹éƒ½ä¼šè¿›è¡Œç›¸åŒçš„è®¡ç®—å¹¶å‚¨å­˜ç›¸åŒçš„å€¼ã€‚åˆçº¦æ‰§è¡Œä¼šåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸­è¢«å¤šæ¬¡é‡å¤ï¼Œè¿™ä¸ªäº‹å®å¾—ä½¿å¾—åˆçº¦æ‰§è¡Œçš„æ¶ˆè€—å˜å¾—æ˜‚è´µï¼Œæ‰€ä»¥è¿™ä¹Ÿä¿ƒä½¿å¤§å®¶å°†èƒ½åœ¨é“¾ä¸‹è¿›è¡Œçš„è¿ç®—éƒ½ä¸æ”¾åˆ°åŒºå—é“¾ä¸Šè¿›è¡Œã€‚å¯¹äºæ¯ä¸ªè¢«æ‰§è¡Œçš„å‘½ä»¤éƒ½ä¼šæœ‰ä¸€ä¸ªç‰¹å®šçš„æ¶ˆè€—ï¼Œç”¨å•ä½gasè®¡æ•°ã€‚æ¯ä¸ªåˆçº¦å¯ä»¥åˆ©ç”¨çš„å‘½ä»¤éƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„gaså€¼ã€‚è¿™é‡Œåˆ—äº†ä¸€äº›å‘½ä»¤çš„gasæ¶ˆè€—ã€‚ äº¤æ˜“æ¶ˆè€—çš„gasæ¯ç¬”äº¤æ˜“éƒ½è¢«è¦æ±‚åŒ…æ‹¬ä¸€ä¸ªgas limitï¼ˆæˆ–startGasï¼‰å’Œä¸€ä¸ªäº¤æ˜“æ„¿ä¸ºå•ä½gasæ”¯ä»˜çš„è´¹ç”¨ã€‚çŸ¿å·¥å¯ä»¥æœ‰é€‰æ‹©çš„æ‰“åŒ…è¿™äº›äº¤æ˜“å¹¶æ”¶å–è¿™äº›è´¹ç”¨ã€‚åœ¨ç°å®ä¸­ï¼Œä»Šå¤©æ‰€æœ‰çš„äº¤æ˜“æœ€ç»ˆéƒ½æ˜¯ç”±çŸ¿å·¥é€‰æ‹©çš„ï¼Œä½†æ˜¯ç”¨æˆ·æ‰€é€‰æ‹©æ”¯ä»˜çš„äº¤æ˜“è´¹ç”¨å¤šå°‘ä¼šå½±å“åˆ°è¯¥äº¤æ˜“è¢«æ‰“åŒ…æ‰€éœ€ç­‰å¾…çš„æ—¶é•¿ã€‚å¦‚æœè¯¥äº¤æ˜“ç”±äºè®¡ç®—ï¼ŒåŒ…æ‹¬åŸå§‹æ¶ˆæ¯å’Œä¸€äº›è§¦å‘çš„å…¶ä»–æ¶ˆæ¯ï¼Œéœ€è¦ä½¿ç”¨çš„gasæ•°é‡å°äºæˆ–ç­‰äºæ‰€è®¾ç½®çš„gas limitï¼Œé‚£ä¹ˆè¿™ä¸ªäº¤æ˜“ä¼šè¢«å¤„ç†ã€‚å¦‚æœgasæ€»æ¶ˆè€—è¶…è¿‡gas limitï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šè¢«å¤åŸï¼Œä½†äº¤æ˜“æ˜¯æˆç«‹çš„å¹¶ä¸”äº¤æ˜“è´¹ä»»ä¼šè¢«çŸ¿å·¥æ”¶å–ã€‚åŒºå—é“¾ä¼šæ˜¾ç¤ºè¿™ç¬”äº¤æ˜“å®Œæˆå°è¯•ï¼Œä½†å› ä¸ºæ²¡æœ‰æä¾›è¶³å¤Ÿçš„gaså¯¼è‡´æ‰€æœ‰çš„åˆçº¦å‘½ä»¤éƒ½è¢«å¤åŸã€‚æ‰€ä»¥äº¤æ˜“é‡Œæ²¡æœ‰è¢«ä½¿ç”¨çš„è¶…é‡gaséƒ½ä¼šä»¥ä»¥å¤ªå¸çš„å½¢å¼æ‰“å›ç»™äº¤æ˜“å‘èµ·è€…ã€‚å› ä¸ºgasæ¶ˆè€—ä¸€èˆ¬åªæ˜¯ä¸€ä¸ªå¤§è‡´ä¼°ç®—ï¼Œæ‰€ä»¥è®¸å¤šç”¨æˆ·ä¼šè¶…é¢æ”¯ä»˜gasæ¥ä¿è¯ä»–ä»¬çš„äº¤æ˜“ä¼šè¢«æ¥å—ã€‚è¿™æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºå¤šä½™çš„gasä¼šè¢«é€€å›ç»™ä½ ã€‚ åŒºå—çš„gas limitæ˜¯ç”±åœ¨ç½‘ç»œä¸Šçš„çŸ¿å·¥å†³å®šçš„ã€‚ä¸å¯è°ƒæ•´çš„åŒºå—gas limitåè®®ä¸åŒçš„æ˜¯ä¸€ä¸ªé»˜è®¤çš„æŒ–çŸ¿ç­–ç•¥ï¼Œå³å¤§å¤šæ•°å®¢æˆ·ç«¯é»˜è®¤æœ€å°åŒºå—gas limitä¸º4,712,388ã€‚ ä»¥å¤ªåŠä¸Šçš„çŸ¿å·¥éœ€è¦ç”¨ä¸€ä¸ªæŒ–çŸ¿è½¯ä»¶ï¼Œä¾‹å¦‚ethminerã€‚å®ƒä¼šè¿æ¥åˆ°ä¸€ä¸ªgethæˆ–è€…Parityä»¥å¤ªåŠå®¢æˆ·ç«¯ã€‚Gethå’ŒPairtyéƒ½æœ‰è®©çŸ¿å·¥å¯ä»¥æ›´æ”¹é…ç½®çš„é€‰é¡¹ã€‚è¿™é‡Œæ˜¯gethæŒ–çŸ¿å‘½ä»¤è¡Œé€‰é¡¹ä»¥åŠParityçš„é€‰é¡¹ã€‚ ä¼°ç®—äº¤æ˜“æ¶ˆè€—ä¸€ä¸ªäº¤æ˜“çš„äº¤æ˜“è´¹ç”±ä¸¤ä¸ªå› ç´ ç»„æˆï¼š gasUsedï¼šè¯¥äº¤æ˜“æ¶ˆè€—çš„æ€»gasæ•°é‡ gasPriceï¼šè¯¥äº¤æ˜“ä¸­å•ä½gasçš„ä»·æ ¼ï¼ˆç”¨ä»¥å¤ªå¸è®¡ç®—ï¼‰ äº¤æ˜“è´¹ = gasUsed * gasPrice gasUsed æ¯ä¸ªEVMä¸­çš„å‘½ä»¤éƒ½è¢«è®¾ç½®äº†ç›¸åº”çš„gasæ¶ˆè€—å€¼ã€‚gasUsedæ˜¯æ‰€æœ‰è¢«æ‰§è¡Œçš„å‘½ä»¤çš„gasæ¶ˆè€—å€¼æ€»å’Œã€‚ gasPrice ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ„å»ºå’Œç­¾åä¸€ç¬”äº¤æ˜“ï¼Œä½†æ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥å„è‡ªè®¾ç½®è‡ªå·±å¸Œæœ›ä½¿ç”¨çš„gasPriceï¼Œç”šè‡³å¯ä»¥æ˜¯0ã€‚ç„¶è€Œï¼Œä»¥å¤ªåŠå®¢æˆ·ç«¯çš„Frontierç‰ˆæœ¬æœ‰ä¸€ä¸ªé»˜è®¤çš„gasPriceï¼Œå³0.05e12 weiã€‚çŸ¿å·¥ä¸ºäº†æœ€å¤§åŒ–ä»–ä»¬çš„æ”¶ç›Šï¼Œå¦‚æœå¤§é‡çš„äº¤æ˜“éƒ½æ˜¯ä½¿ç”¨é»˜è®¤gasPriceå³0.05e12 weiï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå°±å¾ˆéš¾åˆçŸ¿å·¥å»æ¥å—ä¸€ä¸ªä½gasPriceäº¤æ˜“ï¼Œæ›´åˆ«è¯´0 gasPriceäº¤æ˜“äº†ã€‚ ä»¥å¤ªåŠæŒ–çŸ¿ä»¥å¤ªåŠæŒ–çŸ¿è¿‡ç¨‹ è¿™ä»¥å¤ªåŠçš„åŒºå—é“¾å’Œæ¯”ç‰¹å¸çš„åŒºå—é“¾æœ‰å¾ˆå¤šç›¸ä¼¼çš„åœ°æ–¹ï¼Œä¹Ÿæœ‰å¾ˆå¤šä¸åŒçš„åœ°æ–¹ã€‚è¿™ä¸ªä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸åœ¨åŒºå—é“¾ä½“ç³»ä¸­æœ€é‡è¦çš„ä¸åŒç‚¹æ˜¯ ï¼šä»¥å¤ªåŠçš„åŒºå—åŒæ—¶åŒ…å«äº†äº¤æ˜“åˆ—è¡¨å’Œæœ€è¿‘åŒºå—çš„çŠ¶æ€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ2 ä¸ªå…¶ä»–çš„å€¼ï¼ŒåŒºå—çš„ç¼–å·å’Œéš¾åº¦å€¼ä¹Ÿå­˜åœ¨åœ¨åŒºå—ä¸­ã€‚ä»¥å¤ªåŠä¸­æœ€åŸºæœ¬çš„åŒºå—éªŒè¯ç®—æ³•å¦‚ä¸‹ï¼š æ£€æŸ¥ä¸Šä¸€ä¸ªåŒºå—æ˜¯å¦å­˜åœ¨å’Œå…¶æœ‰æ•ˆæ€§ã€‚ æ£€æµ‹è¿™åŒºå—çš„æ—¶é—´æˆ³ï¼Œæ˜¯ä¸æ˜¯æ¯”ä¸Šä¸€ä¸ªåŒºå—çš„å¤§ï¼Œå¹¶ä¸”å°äº 15 åˆ†é’Ÿ æ£€æŸ¥è¿™åŒºå—ç¼–å·ï¼Œéš¾åº¦å€¼ï¼Œäº¤æ˜“æ ¹ï¼ˆtransaction rootï¼‰ , å”æ ¹ï¼ˆuncle rootï¼‰å’Œæ±½æ²¹é™åˆ¶æ˜¯å¦æœ‰æ•ˆ æ£€æŸ¥è¿™åŒºå—çš„å·¥ä½œè¯æ˜æ˜¯å¦æœ‰æ•ˆ æŠŠ S[0] è®¾ç½®æˆä¸Šä¸€ä¸ªåŒºå—çš„æœ«ç«¯çš„çŠ¶æ€ è®© TX æˆä¸ºè¿™åŒºå—çš„äº¤æ˜“åˆ—è¡¨ï¼Œå¦‚æœæœ‰ n ä¸ªäº¤æ˜“ã€‚åˆ™åš for å¾ªç¯ For i in 0â€¦n-1, è®¾ç½® S[i+1] = APPLY(S[i],TX[i]). å¦‚æœä»»ä½•ä¸€ä¸ªåº”ç”¨å‘ç”Ÿé”™è¯¯ï¼Œæˆ–è¿™åŒºå—ä¸­æ±½æ²¹çš„æ€»çš„æ¶ˆè€—è¾¾åˆ°äº† GASLIMIT, åˆ™è¿”å›ä¸€ä¸ªé”™è¯¯. è®© S_FINAL ç­‰äº S[n], ä½†æ˜¯æŠŠæ”¯ä»˜ç»™çŸ¿å·¥çš„å¥–åŠ±æ·»åŠ åˆ°è¿™åŒºå—é‡Œã€‚ æ£€æŸ¥è¿™ä¸ªçŠ¶æ€ S_FINAL çš„é»˜å…‹å°”æ ‘æ ‘æ ¹æ˜¯ä¸æ˜¯å’ŒåŒºå—å¤´ä¿¡æ¯ä¸­æ‰€æä¾›çš„çŠ¶æ€æ ¹æ˜¯ä¸€æ ·çš„ã€‚å¦‚æœæ˜¯ï¼Œåˆ™åŒºå—æœ‰æ•ˆï¼Œä¸ç„¶åˆ™æ— æ•ˆã€‚ ä¹çœ‹ä¸Šå»ï¼Œè¿™ç§æ–¹æ³•ä¼¼ä¹æ•ˆç‡å¾ˆä½ï¼Œå› ä¸ºå®ƒéœ€è¦å°†æ•´ä¸ªçŠ¶æ€å­˜å‚¨åœ¨æ¯ä¸ªå—ä¸­ï¼Œä½†åœ¨ç°å®ä¸­ï¼Œæ•ˆç‡åº”è¯¥ä¸æ¯”ç‰¹å¸ç›¸å½“ã€‚åŸå› åœ¨äºï¼ŒçŠ¶æ€å­˜å‚¨åœ¨æ ‘ç»“æ„ä¸­ï¼Œå¹¶ä¸”æ¯ä¸ªå—åï¼Œåªéœ€è¦ä¿®æ”¹æ ‘çš„ä¸€å°éƒ¨åˆ†ã€‚æ­¤å¤–ï¼Œç”±äºæ‰€æœ‰çš„çŠ¶æ€ä¿¡æ¯éƒ½æ˜¯æœ€åä¸€ä¸ªåŒºå—çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸éœ€è¦å­˜å‚¨æ•´ä¸ªåŒºå—é“¾çš„å†å²â€”â€”è¿™ä¸€ç­–ç•¥ï¼Œå¦‚æœå®ƒå¯ä»¥åº”ç”¨äºæ¯”ç‰¹å¸ï¼Œé‚£ä¹ˆå®ƒçš„ç£ç›˜ç©ºé—´å°†èŠ‚çœ 5-20 å€ã€‚ ä»¥å¤ªåŠç½‘ç»œä¸­äº¤æ˜“ä¼šè¢«éªŒè¯è¿™ç½‘ç»œçš„èŠ‚ç‚¹æ”¶é›†èµ·æ¥ã€‚è¿™äº›â€œçŸ¿å·¥â€åœ¨ä»¥å¤ªåŠç½‘ç»œä¸­æ”¶é›†ã€ä¼ æ’­ã€éªŒè¯å’Œæ‰§è¡Œäº¤æ˜“ï¼Œç„¶åæ•´ç†å½’æ¡£è¿™äº›äº¤æ˜“ï¼Œæ‰“åŒ…æˆä¸€ä¸ªåŒºå—ï¼Œä¸åˆ«çš„çŸ¿å·¥ç«äº‰å°†åŒºå—æ·»åŠ åˆ°åŒºå—é“¾ä¸­ï¼Œæ·»åŠ æˆåŠŸçš„çŸ¿å·¥å°†æ”¶åˆ°å¥–åŠ±ã€‚é€šè¿‡è¿™æ ·çš„æªæ–½ï¼Œé¼“åŠ±äººä»¬ä¸ºåŒºå—é“¾å…¨ç½‘æä¾›æ›´å¤šçš„ç¡¬ä»¶å’Œç”µåŠ›æ”¯æŒã€‚ å…±è¯†æœºåˆ¶ä»¥å¤ªåŠç›®å‰é‡‡ç”¨äº†åŸºäºæˆç†Ÿçš„ PoW å…±è¯†çš„å˜ç§ç®—æ³• Ethash åè®®ä½œä¸ºå…±è¯†æœºåˆ¶ã€‚ ä¸ºäº†é˜²æ­¢ ASIC çŸ¿æœºçŸ¿æ± çš„ç®—åŠ›æ”»å‡»ï¼Œè·ŸåŸå§‹ PoW çš„è®¡ç®—å¯†é›†å‹ Hash è¿ç®—ä¸åŒï¼ŒEthash åœ¨æ‰§è¡Œæ—¶å€™éœ€è¦æ¶ˆè€—å¤§é‡å†…å­˜ï¼Œåè€Œè·Ÿè®¡ç®—æ•ˆç‡å…³ç³»ä¸å¤§ã€‚è¿™æ„å‘³ç€å¾ˆéš¾åˆ¶é€ å‡ºä¸“é—¨é’ˆå¯¹ Ethash çš„èŠ¯ç‰‡ï¼Œåè€Œæ˜¯é€šç”¨æœºå™¨å¯èƒ½æ›´åŠ æœ‰æ•ˆã€‚ è™½ç„¶ï¼ŒEthash ç›¸å¯¹åŸå§‹çš„ PoW è¿›è¡Œäº†æ”¹è¿›ï¼Œä½†ä»ç„¶éœ€è¦è¿›è¡Œå¤§é‡æ— æ•ˆçš„è¿ç®—ï¼Œè¿™ä¹Ÿä¸ºäººä»¬æ‰€è¯Ÿç—…ã€‚ ç¤¾åŒºå·²ç»æœ‰è®¡åˆ’åœ¨æœªæ¥é‡‡ç”¨æ›´é«˜æ•ˆçš„ Proof-of-Stakeï¼ˆPoSï¼‰ä½œä¸ºå…±è¯†æœºåˆ¶ã€‚ç›¸å¯¹ PoW æœºåˆ¶æ¥è®²ï¼ŒPoS æœºåˆ¶æ— éœ€æ¶ˆè€—å¤§é‡æ— ç”¨çš„ Hash è®¡ç®—ï¼Œä½†å…¶å…±è¯†è¿‡ç¨‹çš„å¤æ‚åº¦è¦æ›´é«˜ä¸€äº›ï¼Œè¿˜æœ‰å¾…è¿›ä¸€æ­¥çš„æ£€éªŒã€‚]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>åŒºå—é“¾æ¦‚å¿µ</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¯”ç‰¹å¸æŠ€æœ¯æ ˆ]]></title>
    <url>%2F2019%2F01%2F28%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2F%E5%8C%BA%E5%9D%97%E9%93%BE%E6%A6%82%E5%BF%B5%2F3.%E6%AF%94%E7%89%B9%E5%B8%81%E6%8A%80%E6%9C%AF%E6%A0%88%2F</url>
    <content type="text"><![CDATA[æ¯”ç‰¹å¸è®¾è®¡åŸç†æ¯”ç‰¹å¸ç½‘ç»œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç‚¹å¯¹ç‚¹ç½‘ç»œï¼Œç½‘ç»œä¸­çš„çŸ¿å·¥é€šè¿‡â€œæŒ–çŸ¿â€æ¥å®Œæˆå¯¹äº¤æ˜“è®°å½•çš„è®°è´¦è¿‡ç¨‹ï¼Œç»´æŠ¤ç½‘ç»œçš„æ­£å¸¸è¿è¡Œã€‚ åŒºå—é“¾ç½‘ç»œæä¾›ä¸€ä¸ªå…¬å…±å¯è§çš„è®°è´¦æœ¬ï¼Œé€šè¿‡å…±è¯†æœºåˆ¶æ‰€æœ‰èŠ‚ç‚¹å…±åŒç»´æŠ¤åŒä¸€ä»½è´¦æœ¬ï¼Œè¯¥è®°è´¦æœ¬å¹¶éè®°å½•æ¯ä¸ªè´¦æˆ·çš„ä½™é¢ï¼Œè€Œæ˜¯ç”¨æ¥è®°å½•å‘ç”Ÿè¿‡çš„äº¤æ˜“çš„å†å²ä¿¡æ¯ã€‚è¯¥è®¾è®¡å¯ä»¥é¿å…é‡æ”¾æ”»å‡»ï¼Œå³æŸä¸ªåˆæ³•äº¤æ˜“è¢«å¤šæ¬¡é‡æ–°å‘é€é€ æˆæ”»å‡»ã€‚ å…¶äº¤æ˜“æ˜¯é€šè¿‡é”€æ¯â€œæœªè¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡ºâ€(å³UTXO)ï¼Œ å’Œåˆ›å»ºæ–°çš„UTXOæ¥å®ç°èµ„é‡‘çš„æµè½¬ï¼› æ¯”ç‰¹å¸å¯ä»¥ç†è§£ä¸º: BTC = UTXO + å…±è¯†æœºåˆ¶ + åŒºå—é“¾è´¦æœ¬ æ¯”ç‰¹å¸äº¤æ˜“æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿâ€”çŠ¶æ€è½¬ç§»ç³»ç»Ÿæ¯”ç‰¹å¸ä¸­æ²¡æœ‰è´¦æˆ·çš„æ¦‚å¿µã€‚å› æ­¤ï¼Œæ¯æ¬¡å‘ç”Ÿäº¤æ˜“ï¼Œç”¨æˆ·éœ€è¦å°†äº¤æ˜“è®°å½•å†™åˆ°æ¯”ç‰¹å¸ç½‘ç»œè´¦æœ¬ä¸­ï¼Œç­‰ç½‘ç»œç¡®è®¤åå³å¯è®¤ä¸ºäº¤æ˜“å®Œæˆã€‚ é™¤äº†æŒ–çŸ¿è·å¾—å¥–åŠ±çš„ coinbase äº¤æ˜“åªæœ‰è¾“å‡ºï¼Œæ­£å¸¸æƒ…å†µä¸‹æ¯ä¸ªäº¤æ˜“éœ€è¦åŒ…æ‹¬è‹¥å¹²è¾“å…¥å’Œè¾“å‡ºï¼Œæœªç»ä½¿ç”¨ï¼ˆå¼•ç”¨ï¼‰çš„äº¤æ˜“çš„è¾“å‡ºï¼ˆUnspent Transaction Outputsï¼ŒUTXOï¼‰å¯ä»¥è¢«æ–°çš„äº¤æ˜“å¼•ç”¨ä½œä¸ºå…¶åˆæ³•çš„è¾“å…¥ã€‚è¢«ä½¿ç”¨è¿‡çš„äº¤æ˜“çš„è¾“å‡ºï¼ˆSpent Transaction Outputsï¼ŒSTXOï¼‰ï¼Œåˆ™æ— æ³•è¢«å¼•ç”¨ä½œä¸ºåˆæ³•è¾“å…¥ã€‚ å› æ­¤ï¼Œæ¯”ç‰¹å¸ç½‘ç»œä¸­ä¸€ç¬”åˆæ³•çš„äº¤æ˜“ï¼Œå¿…é¡»æ˜¯å¼•ç”¨æŸäº›å·²å­˜åœ¨äº¤æ˜“çš„ UTXOï¼ˆå¿…é¡»æ˜¯å±äºä»˜æ¬¾æ–¹æ‰èƒ½åˆæ³•å¼•ç”¨ï¼‰ä½œä¸ºæ–°äº¤æ˜“çš„è¾“å…¥ï¼Œå¹¶ç”Ÿæˆæ–°çš„ UTXOï¼ˆå°†å±äºæ”¶æ¬¾æ–¹ï¼‰ã€‚ é‚£ä¹ˆï¼Œåœ¨äº¤æ˜“è¿‡ç¨‹ä¸­ï¼Œä»˜æ¬¾æ–¹å¦‚ä½•è¯æ˜è‡ªå·±æ‰€å¼•ç”¨çš„ UTXO åˆæ³•ï¼Ÿæ¯”ç‰¹å¸ä¸­é€šè¿‡â€œç­¾åè„šæœ¬â€æ¥å®ç°ï¼Œå¹¶ä¸”æŒ‡å®šâ€œè¾“å‡ºè„šæœ¬â€æ¥é™åˆ¶å°†æ¥èƒ½ä½¿ç”¨æ–° UTXO è€…åªèƒ½ä¸ºæŒ‡å®šæ”¶æ¬¾æ–¹ã€‚å¯¹æ¯ç¬”äº¤æ˜“ï¼Œä»˜æ¬¾æ–¹éœ€è¦è¿›è¡Œç­¾åç¡®è®¤ã€‚å¹¶ä¸”ï¼Œå¯¹æ¯ä¸€ç¬”äº¤æ˜“æ¥è¯´ï¼Œæ€»è¾“å…¥ä¸èƒ½å°äºæ€»è¾“å‡ºã€‚æ€»è¾“å…¥ç›¸æ¯”æ€»è¾“å‡ºå¤šä½™çš„éƒ¨åˆ†ç§°ä¸ºäº¤æ˜“è´¹ç”¨ï¼ˆTransaction Feeï¼‰ï¼Œä¸ºç”ŸæˆåŒ…å«è¯¥äº¤æ˜“åŒºå—çš„çŸ¿å·¥æ‰€è·å¾—ã€‚ç›®å‰è§„å®šæ¯ç¬”äº¤æ˜“çš„äº¤æ˜“è´¹ç”¨ä¸èƒ½å°äº 0.0001 BTCï¼Œäº¤æ˜“è´¹ç”¨è¶Šé«˜ï¼Œè¶Šå¤šçŸ¿å·¥æ„¿æ„åŒ…å«è¯¥äº¤æ˜“ï¼Œä¹Ÿå°±è¶Šæ—©è¢«æ”¾åˆ°ç½‘ç»œä¸­ã€‚äº¤æ˜“è´¹ç”¨åœ¨å¥–åŠ±çŸ¿å·¥çš„åŒæ—¶ï¼Œä¹Ÿé¿å…äº†ç½‘ç»œå—åˆ°å¤§é‡æ”»å‡»ã€‚ äº¤æ˜“ä¸­é‡‘é¢çš„æœ€å°å•ä½æ˜¯â€œèªâ€ï¼Œå³ä¸€äº¿åˆ†ä¹‹ä¸€ï¼ˆ10^-8ï¼‰æ¯”ç‰¹å¸ã€‚ ä¸‹å›¾å±•ç¤ºäº†ä¸€äº›ç®€å•çš„ç¤ºä¾‹äº¤æ˜“ã€‚æ›´ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œäº¤æ˜“çš„è¾“å…¥ã€è¾“å‡ºå¯ä»¥ä¸ºå¤šæ–¹ã€‚ äº¤æ˜“ ç›®çš„ è¾“å…¥ è¾“å‡º ç­¾å å·®é¢ T0 A è½¬ç»™ B ä»–äººå‘ A äº¤æ˜“çš„è¾“å‡º B è´¦æˆ·å¯ä»¥ä½¿ç”¨è¯¥äº¤æ˜“ A ç­¾åç¡®è®¤ è¾“å…¥å‡è¾“å‡ºï¼Œä¸ºäº¤æ˜“æœåŠ¡è´¹ T1 B è½¬ç»™ C T0 çš„è¾“å‡º C è´¦æˆ·å¯ä»¥ä½¿ç”¨è¯¥äº¤æ˜“ B ç­¾åç¡®è®¤ è¾“å…¥å‡è¾“å‡ºï¼Œä¸ºäº¤æ˜“æœåŠ¡è´¹ â€¦ X è½¬ç»™ Y ä»–äººå‘ X äº¤æ˜“çš„è¾“å‡º Y è´¦æˆ·å¯ä»¥ä½¿ç”¨è¯¥äº¤æ˜“ X ç­¾åç¡®è®¤ è¾“å…¥å‡è¾“å‡ºï¼Œä¸ºäº¤æ˜“æœåŠ¡è´¹ éœ€è¦æ³¨æ„ï¼Œåˆšæ”¾è¿›ç½‘ç»œä¸­çš„äº¤æ˜“ï¼ˆæ·±åº¦ä¸º 0ï¼‰å¹¶éæ˜¯å®æ—¶å¾—åˆ°ç¡®è®¤çš„ã€‚è¿›å…¥ç½‘ç»œä¸­çš„äº¤æ˜“å­˜åœ¨è¢«æ¨ç¿»çš„å¯èƒ½æ€§ï¼Œä¸€èˆ¬è¦å†ç”Ÿæˆå‡ ä¸ªæ–°çš„åŒºå—åï¼ˆæ·±åº¦å¤§äº 0ï¼‰æ‰è®¤ä¸ºè¯¥äº¤æ˜“è¢«ç¡®è®¤ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»æ¯”ç‰¹å¸ç½‘ç»œä¸­çš„é‡è¦æ¦‚å¿µå’Œä¸»è¦è®¾è®¡æ€è·¯ã€‚ è´¦æˆ·(åœ°å€)æ¯”ç‰¹å¸é‡‡ç”¨äº†éå¯¹ç§°çš„åŠ å¯†ç®—æ³•ï¼Œç”¨æˆ·è‡ªå·±ä¿ç•™ç§é’¥ï¼Œå¯¹è‡ªå·±å‘å‡ºçš„äº¤æ˜“è¿›è¡Œç­¾åç¡®è®¤ï¼Œå¹¶å…¬å¼€å…¬é’¥ã€‚ æ¯”ç‰¹å¸çš„è´¦æˆ·åœ°å€å…¶å®å°±æ˜¯ç”¨æˆ·å…¬é’¥ç»è¿‡ä¸€ç³»åˆ— Hashï¼ˆHASH160ï¼Œæˆ–å…ˆè¿›è¡Œ SHA256ï¼Œç„¶åè¿›è¡Œ RIPEMD160ï¼‰åŠç¼–ç è¿ç®—åç”Ÿæˆçš„ 160 ä½ï¼ˆ20 å­—èŠ‚ï¼‰çš„å­—ç¬¦ä¸²ã€‚ ä¸€èˆ¬åœ°ï¼Œä¹Ÿå¸¸å¸¸å¯¹è´¦æˆ·åœ°å€ä¸²è¿›è¡Œ Base58Check ç¼–ç ï¼Œå¹¶æ·»åŠ å‰å¯¼å­—èŠ‚ï¼ˆè¡¨æ˜æ”¯æŒå“ªç§è„šæœ¬ï¼‰å’Œ 4 å­—èŠ‚æ ¡éªŒå­—èŠ‚ï¼Œä»¥æé«˜å¯è¯»æ€§å’Œå‡†ç¡®æ€§ã€‚ æ³¨ï¼šè´¦æˆ·å¹¶éç›´æ¥æ˜¯å…¬é’¥å†…å®¹ï¼Œè€Œæ˜¯ Hash åçš„å€¼ï¼Œé¿å…å…¬é’¥è¿‡æ—©å…¬å¼€åå¯¼è‡´è¢«ç ´è§£å‡ºç§é’¥ã€‚ UTXOåŸºæœ¬æ¦‚å¿µåœ¨æ¯”ç‰¹å¸ä¸­ï¼Œä¸€æ¯”äº¤æ˜“â€™â€™åœ¨é»‘ç›’å­é‡Œâ€ å®é™…è¿ä½œçš„æ–¹å¼æ˜¯: èŠ±è´¹ä¸€ç§ä¸œè¥¿çš„é›†åˆï¼Œè¿™ç§ä¸œè¥¿è¢«ç§°ä¸ºâ€œæœªè¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡ºâ€(å³UTXO) ï¼Œ è¿™äº›è¾“å‡ºç”±ä¸€ä¸ªæˆ–å¤šä¸ªä¹‹å‰çš„äº¤æ˜“æ‰€åˆ›é€ ï¼Œå¹¶åœ¨å…¶ååˆ¶é€ å‡ºä¸€æ¯”æˆ–å¤šç¬”æ–°çš„UTXOï¼Œå¯ä»¥åœ¨æœªæ¥çš„äº¤æ˜“ä¸­èŠ±è´¹ã€‚æ¯ä¸€ç¬”UTXOä»–æœ‰é¢é¢ã€æ‰€æœ‰è€…ã€‚ è€Œä¸”ï¼Œä¸€ç¬”äº¤æ˜“è‹¥è¦æœ‰æ•ˆï¼Œå¿…é¡»æ»¡è¶³çš„ä¸¤ä¸ªè§„åˆ™æ˜¯ï¼š 1ï¼‰è¯¥äº¤æ˜“å¿…é¡»åŒ…å«ä¸€ä¸ªæœ‰æ•ˆçš„ç­¾åï¼Œæ¥è‡ªå®ƒæ‰€èŠ±è´¹çš„ UTXO çš„æ‹¥æœ‰è€…ï¼› 2ï¼‰è¢«èŠ±è´¹çš„ UTXO çš„æ€»é¢é¢å¿…é¡»ç­‰äºæˆ–è€…å¤§äºè¯¥äº¤æ˜“äº§ç”Ÿçš„ UTXO çš„æ€»é¢é¢ã€‚ä¸€ä¸ªç”¨æˆ·çš„ä½™é¢å› æ­¤å¹¶ä¸æ˜¯ä½œä¸ºä¸€ä¸ªæ•°å­—å‚¨å­˜èµ·æ¥çš„ï¼›è€Œæ˜¯ç”¨ä»–å æœ‰çš„ UTXO çš„æ€»å’Œè®¡ç®—å‡ºæ¥çš„ã€‚ å¦‚æœä¸€ä¸ªç”¨æˆ·æƒ³è¦å‘é€ä¸€ç¬”äº¤æ˜“ï¼Œå‘é€ X ä¸ªå¸åˆ°ä¸€ä¸ªç‰¹å®šçš„åœ°å€ï¼Œæœ‰æ—¶å€™ï¼Œä»–ä»¬æ‹¥æœ‰çš„ UTXO çš„ä¸€äº›å­é›†ç»„åˆèµ·æ¥é¢å€¼æ°å¥½æ˜¯ Xï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»–ä»¬å¯ä»¥åˆ›é€ ä¸€ä¸ªäº¤æ˜“ï¼šèŠ±è´¹ä»–ä»¬çš„ UTXO å¹¶åˆ›é€ å‡ºä¸€ç¬”æ–°çš„ã€ä»·å€¼ X çš„ UTXO ï¼Œç”±ç›®æ ‡åœ°å€å æœ‰ã€‚å½“è¿™ç§å®Œç¾çš„é…å¯¹ä¸å¯èƒ½çš„æ—¶å€™ï¼Œç”¨æˆ·å°±å¿…é¡»æ‰“åŒ…å…¶å’Œå€¼ å¤§äº X çš„ UTXO è¾“å…¥é›†åˆï¼Œå¹¶æ·»åŠ ä¸€ç¬”æ‹¥æœ‰ç¬¬äºŒä¸ªç›®æ ‡åœ°å€çš„ UTXO ï¼Œç§°ä¸ºâ€œé›¶é’±è¾“å‡ºâ€ï¼Œåˆ†é…å‰©ä¸‹çš„å¸åˆ°ä¸€ä¸ªç”±ä»–ä»¬è‡ªå·±æ§åˆ¶çš„åœ°å€ã€‚ UTXOå…·æœ‰å¦‚ä¸‹æ€§è´¨ UTXOï¼Œ ç”¨æ¯”ç‰¹å¸æ‹¥æœ‰è€…çš„å…¬é’¥(é”å®š)(åŠ å¯†)çš„ä¸€ä¸ªæ•°å­— UTXO == æ¯”ç‰¹å¸ æ¯”ç‰¹å¸ç³»ç»Ÿé‡Œæ²¡æœ‰æ¯”ç‰¹å¸ï¼Œ åªæœ‰UTXO æ¯”ç‰¹å¸ç³»ç»Ÿä¸­æ²¡æœ‰è´¦æˆ·ï¼Œåªæœ‰UTXO(å…¬é’¥é”å®š) æ¯”ç‰¹å¸ç³»ç»Ÿé‡Œæ²¡æœ‰è´¦æˆ·ä½™é¢ï¼Œ åªæœ‰UTXO( è´¦æˆ·ä½™é¢åªæ˜¯æ¯”ç‰¹å¸é’±åŒ…çš„æ¦‚å¿µ ) UTXOå­˜åœ¨å‰èŠ‚ç‚¹çš„æ•°æ®åº“é‡Œ è½¬è´¦å°†æ¶ˆè€—æ‰å±äºä½ è‡ªå·±çš„UTXOï¼Œ åŒæ—¶ç”Ÿæˆæ–°çš„UTXOï¼Œ å¹¶ç”¨æ¥å—è€…çš„å…¬é’¥é”å®šã€‚ äº¤æ˜“çš„åŸç†ä¸€ç¬”äº¤æ˜“åŒ…å«çš„ä¿¡æ¯ äº¤æ˜“çš„è¾“å…¥çš„äº¤æ˜“ IDï¼ˆUTXOï¼‰ äº¤æ˜“çš„é‡‘é¢: å¤šå°‘é’±ï¼Œå’Œè¾“å…¥çš„å·®é¢ä¸ºäº¤æ˜“çš„æœåŠ¡è´¹ æ—¶é—´æˆ³: äº¤æ˜“åˆé€‚èƒ½ç”Ÿæ•ˆ é”å®šè„šæœ¬ï¼ˆç”¨æ¥å—è€…çš„å…¬é’¥å“ˆå¸Œï¼‰- å°†æ¯”ç‰¹å¸åœ°å€é”å®šåˆ°æ¥æ”¶è€… è§£é”è„šæœ¬ï¼ˆå‘é€è€…ç”¨ç§é’¥å¯¹äº¤æ˜“çš„æ•°å­—ç­¾å, å‘é€è€…çš„å…¬é’¥ï¼‰- ç”¨æ¥è¯æ˜æ¯”ç‰¹å¸ç¡®å®å±äºå‘é€è€…ï¼Œå¹¶ä¿è¯å†…å®¹ä¸è¢«ç¯¡æ”¹ äº¤æ˜“çš„ç”Ÿæˆå’ŒéªŒè¯è¿‡ç¨‹ 1ï¼‰é’±åŒ…è½¯ä»¶ç”Ÿæˆäº¤æ˜“ï¼Œå¹¶æƒ³ä¸´è¿‘èŠ‚ç‚¹ä¼ æ’­ 2ï¼‰èŠ‚ç‚¹å¯¹æ”¶åˆ°çš„äº¤æ˜“è¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¸¢å¼ƒä¸åˆæ³•çš„äº¤æ˜“ äº¤æ˜“æ˜¯å¦å·²ç»å¤„ç†è¿‡ äº¤æ˜“çš„sizeè¦å°äºåŒºå—sizeçš„ä¸Šé™ ï¼ˆæ¯”å¦‚æ¯”ç‰¹å¸ä¹‹å‰çš„å¤§å°é™åˆ¶æ˜¯1M ï¼‰ äº¤æ˜“çš„è¾“å…¥UTXOæ˜¯å­˜åœ¨çš„ äº¤æ˜“è¾“å…¥UTXOæ²¡æœ‰è¢«å…¶ä»–äº¤æ˜“å¼•ç”¨-é˜²æ­¢åŒèŠ±ï¼ˆDouble Spendingï¼‰ è¾“å…¥æ€»é‡‘é¢ &gt; è¾“å‡ºçš„æ€»é‡‘é¢ è§£é”è„šæœ¬çš„éªŒè¯ å°†åˆæ ¼çš„äº¤æ˜“åŠ å…¥åˆ°æœ¬åœ°çš„Transactionæ•°æ®åº“ä¸­ï¼Œå¹¶å°†åˆæ³•çš„äº¤æ˜“è½¬ç»™ä¸´è¿‘èŠ‚ç‚¹ 3ï¼‰æ—·å·¥å°†åˆæ ¼çš„äº¤æ˜“æ‰“åŒ…è¿›åŒºå— äº¤æ˜“è„šæœ¬è„šæœ¬ç³»ç»Ÿ å³ä¾¿æ²¡æœ‰ä»»ä½•æ‰©å±•ï¼Œæ¯”ç‰¹å¸çš„åè®®å®é™…ä¸Šå´æ˜¯ä¿ƒè¿›äº†ä¸€ä¸ªå¼±åŒ–ç‰ˆçš„â€æ™ºèƒ½åˆçº¦â€çš„æ¦‚å¿µã€‚ã€‚UTXO åœ¨æ¯”ç‰¹å¸ä¸­ä¸æ˜¯åªè¢«ä¸€ä¸ªå…¬é’¥æŒæœ‰, è€Œæ˜¯è¿˜è¢«åœ¨ä¸€ä¸ªåŸºäºå †æ ˆçš„ç¨‹åºè¯­è¨€ç»„æˆçš„å¤æ‚çš„è„šæœ¬æ‰€æŒæœ‰ç€ã€‚ åœ¨è¿™ä¸ªèŒƒä¾‹ä¸­ï¼Œä¸€ä¸ªäº¤æ˜“æ¶ˆè€—çš„ UTXO å¿…é¡»æä¾›æ»¡è¶³è„šæœ¬çš„æ•°æ®ã€‚å®é™…ä¸Šï¼Œè¿™æœ€åŸºæœ¬çš„å…¬é’¥æ‰€æœ‰æƒæœºåˆ¶ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªè„šæœ¬æ¥å®ç°çš„ï¼šè¿™ä¸ªè„šæœ¬ä½¿ç”¨ä¸€ä¸ªæ¤­åœ†æ›²çº¿ç­¾åä½œä¸ºä¸€ä¸ªè¾“å…¥ï¼ŒéªŒè¯æ‹¥æœ‰è¿™ä¸ª UTXO çš„äº¤æ˜“å’Œåœ°å€ï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œåˆ™è¿”å› 1ï¼Œä¸ç„¶åˆ™è¿”å› 0ã€‚å…¶ä»–ï¼Œæ›´åŠ å¤æ‚çš„è„šæœ¬å­˜åœ¨äºå„ç§å¤æ‚çš„ç”¨ä¾‹ä¸­ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ„é€ ä¸€ä¸ªè„šæœ¬ï¼Œå®ƒè¦æ±‚ä»ç»™å®šçš„ä¸‰ä¸ªç§é’¥ä¸­ï¼Œè‡³å°‘è¦é€‰å…¶ä¸­çš„ 2 ä¸ªæ¥åšç­¾åéªŒè¯ï¼ˆâ€œå¤šé‡ç­¾åâ€ï¼‰ï¼Œè¿™ä¸ªå¯¹å…¬å¸è´¦æœ¬ï¼Œå‚¨è“„è´¦æˆ·ç­‰æ¥è¯´éå¸¸æœ‰ç”¨ã€‚è„šæœ¬ä¹Ÿèƒ½ç”¨æ¥å¯¹è§£å†³è®¡ç®—é—®é¢˜çš„ç”¨æˆ·æ”¯ä»˜æŠ¥é…¬ã€‚äººä»¬ç”šè‡³å¯ä»¥åˆ›å»ºè¿™æ ·çš„è„šæœ¬â€œå¦‚æœä½ èƒ½å¤Ÿæä¾›ä½ å·²ç»å‘é€ä¸€å®šæ•°é¢çš„çš„ç‹—å¸ç»™æˆ‘çš„ç®€åŒ–ç¡®è®¤æ”¯ä»˜è¯æ˜ï¼Œè¿™ä¸€æ¯”ç‰¹å¸å°±æ˜¯ä½ çš„äº†â€ï¼Œæœ¬è´¨ä¸Šï¼Œæ¯”ç‰¹å¸ç³»ç»Ÿå…è®¸ä¸åŒçš„å¯†ç å­¦è´§å¸è¿›è¡Œå»ä¸­å¿ƒåŒ–çš„å…‘æ¢ã€‚ç„¶è€Œï¼Œåœ¨æ¯”ç‰¹å¸ä¸­çš„è„šæœ¬è¯­è¨€æœ‰å‡ ä¸ªé‡è¦çš„é™åˆ¶ï¼š ç¼ºä¹å›¾çµ-å®Œå¤‡ é‚£å°±æ˜¯è¯´ï¼Œè™½ç„¶æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€æ”¯æŒçš„è®¡ç®—æ–¹å¼å¾ˆå¤šï¼Œä½†æ˜¯å®ƒä¸æ˜¯æ‰€æœ‰çš„éƒ½æ”¯æŒã€‚åœ¨ä¸»è¦ç±»åˆ«ä¸­ç¼ºå¤±å¾ªç¯ã€‚ å®ƒè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å¯¹äº¤æ˜“çš„éªŒè¯å‡ºç°æ­»å¾ªç¯ï¼›ç†è®ºä¸Šï¼Œå®ƒçš„è„šæœ¬æ˜¯å¯ä»¥å…‹æœè¿™ä¸ªéšœç¢çš„ï¼Œå› ä¸ºä»»ä½•çš„å¾ªç¯éƒ½å¯ä»¥é€šè¿‡ if è¯­å¥é‡å¤å¤šæ¬¡åº•å±‚ä»£ç æ¥æ¨¡æ‹Ÿï¼Œä½†æ˜¯è¿™æ ·çš„è„šæœ¬è¿è¡Œæ•ˆç‡éå¸¸ä½ä¸‹ã€‚ å€¼çš„ç›²åŒº ä¸€ä¸ª UTXO è„šæœ¬æ²¡æœ‰åŠæ³•æä¾›èµ„é‡‘çš„é¢—ç²’åº¦å¯æ§çš„å‡ºé‡‘æ“ä½œã€‚æ¯”å¦‚, ä¸€ä¸ªé¢„è¨€åˆçº¦ï¼ˆoracle contract ï¼‰çš„å…¶ä¸­ä¸€ä¸ªå¼ºå¤§çš„ç”¨ä¾‹å°±æ˜¯ä¸€ä¸ªå¥—æœŸä¿å€¼çš„åˆçº¦ï¼ŒA å’Œ B éƒ½æŠŠä»·å€¼1000$çš„ BTC æ”¾åˆ°åˆçº¦ä¸­ï¼Œ30 å¤©åï¼Œè¿™ä¸ªåˆçº¦æŠŠä»·å€¼ 1000$çš„ BTC å‘ç»™äº† Aï¼Œå‰©ä¸‹çš„å‘ç»™äº†Bã€‚ è¿™å°±éœ€è¦åˆçº¦è¦ç¡®å®š 1BTC ä»¥ç¾å…ƒè®¡å€¼å¤šå°‘é’±ã€‚ç„¶è€Œï¼Œå› ä¸º UTXO æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œä¸ºå®ç°æ­¤åˆçº¦ï¼Œå”¯ä¸€çš„æ–¹æ³•æ˜¯éå¸¸ä½æ•ˆåœ°é‡‡ç”¨è®¸å¤šæœ‰ä¸åŒé¢å€¼çš„ UTXOï¼ˆä¾‹å¦‚æœ‰ 2^k çš„ UTXOï¼Œå…¶ä¸­ Kå¯ä»¥æœ€å¤§åˆ° 30)å¹¶ä½¿é¢„è¨€åˆçº¦æŒ‘å‡ºæ­£ç¡®çš„ UTXO å‘é€ç»™ A å’Œ Bã€‚ çŠ¶æ€ç¼ºå¤± UTXO è¦ä¹ˆè¢«ä½¿ç”¨äº†ï¼Œè¦ä¹ˆæ²¡æœ‰è¢«ä½¿ç”¨ï¼›è¿™ä¼šä½¿å¾—å¤šé˜¶æ®µçš„åˆçº¦å’Œè„šæœ¬æ²¡æœ‰æœºä¼šä¿æŒä»»ä½•å…¶ä»–çš„å†…éƒ¨çŠ¶æ€ã€‚è¿™ä½¿å¾—åˆ¶ä½œå¤šé˜¶æ®µçš„æœŸæƒåˆçº¦ã€å»ä¸­å¿ƒåŒ–çš„äº¤æ¢åè®®æˆ–ä¸¤é˜¶æ®µåŠ å¯†æ‰¿è¯ºåè®®å˜å¾—å›°éš¾(å¯¹äºå®‰å…¨è®¡ç®—å¥–é‡‘æ¥è¯´æ˜¯å¿…è¦çš„)ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼ŒUTXO åªèƒ½ç”¨äºæ„å»ºç®€å•çš„ã€ä¸€æ¬¡æ€§çš„åˆçº¦ï¼Œè€Œä¸æ˜¯æ›´å¤æ‚çš„â€œæœ‰çŠ¶æ€â€çš„åˆçº¦ï¼Œæ¯”å¦‚å»ä¸­å¿ƒåŒ–çš„ç»„ç»‡ï¼Œå¹¶ä¸”ä½¿å¾—å…ƒåè®®éš¾ä»¥å®ç°ã€‚ åŒºå—é“¾ç›²åŒº UTXO å¯¹æŸäº›åŒºå—é“¾æ•°æ®è§†è€Œä¸è§ï¼Œæ¯”å¦‚éšæœºæ•°å’Œä¹‹å‰çš„åŒºå—çš„å“ˆå¸Œã€‚è¿™ä¸¥é‡é™åˆ¶äº†åšå½©å’Œå…¶ä»–ä¸€äº›ç±»åˆ«çš„åº”ç”¨ï¼Œå› ä¸ºå®ƒå‰¥å¤ºäº†ä¸€ç§æ½œåœ¨çš„æœ‰ä»·å€¼çš„è„šæœ¬è¯­è¨€ï¼šéšæœºæ•°ï¼ä¹Ÿå°±æ˜¯åœ¨æ¯”ç‰¹å¸çš„è„šæœ¬ä¸­æ˜¯æ²¡æœ‰éšæœºæ•°çš„ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†åœ¨åŠ å¯†è´§å¸ä¹‹ä¸Šæ„å»ºé«˜çº§åº”ç”¨ç¨‹åºçš„ä¸‰ç§æ–¹æ³•ï¼šä¸€ï¼Œæ„å»ºä¸€ä¸ªæ–°çš„åŒºå—é“¾ï¼ŒäºŒï¼Œåœ¨æ¯”ç‰¹å¸ä¹‹ä¸Šä½¿ç”¨è„šæœ¬ï¼Œä¸‰ï¼Œåœ¨æ¯”ç‰¹å¸ä¹‹ä¸Šæ„å»ºä¸€ä¸ªå…ƒåè®®ã€‚ æ„å»ºä¸€ä¸ªæ–°çš„åŒºå—é“¾å¯ä»¥æ— é™åˆ¶æ‰©å±•åŠŸèƒ½é›†ï¼Œä½†æ˜¯è¿™æ ·åšéå¸¸æ¶ˆè€—æ—¶é—´ã€‚ä½¿ç”¨è„šæœ¬å¾ˆå®¹æ˜“å®ç°å’Œæ ‡å‡†åŒ–ï¼Œä½†åœ¨å…¶åŠŸèƒ½ä¸Šéå¸¸æœ‰é™ï¼Œè€Œå…ƒåè®®è™½ç„¶å®¹æ˜“ï¼Œä½†åœ¨å¯ä¼¸ç¼©æ€§æ–¹é¢å´å­˜åœ¨ç¼ºé™·ã€‚åœ¨ä»¥å¤ªåŠä¸­ï¼Œæˆ‘ä»¬æ‰“ç®—å»ºç«‹ä¸€ä¸ªæ›¿ä»£æ€§çš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†æ›´å¤§çš„å¼€å‘å’Œæ›´å¼ºå¤§çš„è½»å®¢æˆ·å±æ€§ï¼ŒåŒæ—¶å…è®¸åº”ç”¨ç¨‹åºå…±äº«ä¸€ä¸ªç»æµç¯å¢ƒå’ŒåŒºå—é“¾å®‰å…¨ã€‚ æ¯”ç‰¹å¸çš„é”å®šè„šæœ¬å’Œè§£é”è„šæœ¬è„šæœ¬ï¼ˆScriptï¼‰æ˜¯ä¿éšœäº¤æ˜“å®Œæˆï¼ˆä¸»è¦ç”¨äºæ£€éªŒäº¤æ˜“æ˜¯å¦åˆæ³•ï¼‰çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå½“æ‰€ä¾é™„çš„äº¤æ˜“å‘ç”Ÿæ—¶è¢«è§¦å‘ã€‚é€šè¿‡è„šæœ¬æœºåˆ¶è€Œéå†™æ­»äº¤æ˜“è¿‡ç¨‹ï¼Œæ¯”ç‰¹å¸ç½‘ç»œå®ç°äº†ä¸€å®šçš„å¯æ‰©å±•æ€§ã€‚æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€æ˜¯ä¸€ç§éå›¾çµå®Œå¤‡çš„è¯­è¨€ã€‚ ä¸€èˆ¬æ¯ä¸ªäº¤æ˜“éƒ½ä¼šåŒ…æ‹¬ä¸¤ä¸ªè„šæœ¬ï¼šè´Ÿè´£è¾“å…¥çš„è§£é”è„šæœ¬ï¼ˆscriptSigï¼‰å’Œè´Ÿè´£è¾“å‡ºçš„é”å®šè„šæœ¬ï¼ˆscriptPubKeyï¼‰ã€‚ è¾“å‡ºè„šæœ¬ä¸€èˆ¬ç”±ä»˜æ¬¾æ–¹å¯¹äº¤æ˜“è®¾ç½®é”å®šï¼Œç”¨æ¥å¯¹èƒ½åŠ¨ç”¨è¿™ç¬”äº¤æ˜“çš„è¾“å‡ºï¼ˆä¾‹å¦‚ï¼Œè¦èŠ±è´¹è¯¥äº¤æ˜“çš„è¾“å‡ºï¼‰çš„å¯¹è±¡ï¼ˆæ”¶æ¬¾æ–¹ï¼‰è¿›è¡Œæƒé™æ§åˆ¶ï¼Œä¾‹å¦‚é™åˆ¶å¿…é¡»æ˜¯æŸä¸ªå…¬é’¥çš„æ‹¥æœ‰è€…æ‰èƒ½èŠ±è´¹è¿™ç¬”äº¤æ˜“ã€‚ è®¤é¢†è„šæœ¬åˆ™ç”¨æ¥è¯æ˜è‡ªå·±å¯ä»¥æ»¡è¶³äº¤æ˜“è¾“å‡ºè„šæœ¬çš„é”å®šæ¡ä»¶ï¼Œå³å¯¹æŸä¸ªäº¤æ˜“çš„è¾“å‡ºï¼ˆæ¯”ç‰¹å¸ï¼‰çš„æ‹¥æœ‰æƒã€‚ è¾“å‡ºè„šæœ¬ç›®å‰æ”¯æŒä¸¤ç§ç±»å‹ï¼š P2PKHï¼šPay-To-Public-Key-Hashï¼Œå…è®¸ç”¨æˆ·å°†æ¯”ç‰¹å¸å‘é€åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå…¸å‹çš„æ¯”ç‰¹å¸åœ°å€ä¸Šï¼ˆè¯æ˜æ‹¥æœ‰è¯¥å…¬é’¥ï¼‰ï¼Œå‰å¯¼å­—èŠ‚ä¸€èˆ¬ä¸º 0x00ï¼› P2SHï¼šPay-To-Script-Hashï¼Œæ”¯ä»˜è€…åˆ›å»ºä¸€ä¸ªè¾“å‡ºè„šæœ¬ï¼Œé‡Œè¾¹åŒ…å«å¦ä¸€ä¸ªè„šæœ¬ï¼ˆè®¤é¢†è„šæœ¬ï¼‰çš„å“ˆå¸Œï¼Œä¸€èˆ¬ç”¨äºéœ€è¦å¤šäººç­¾åçš„åœºæ™¯ï¼Œå‰å¯¼å­—èŠ‚ä¸€èˆ¬ä¸º 0x05ï¼› ä»¥ P2PKH ä¸ºä¾‹ï¼Œè¾“å‡ºè„šæœ¬çš„æ ¼å¼ä¸º 1scriptPubKey: OP_DUP OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG å…¶ä¸­ï¼ŒOP_DUP æ˜¯å¤åˆ¶æ ˆé¡¶å…ƒç´ ï¼›OP_HASH160 æ˜¯è®¡ç®— hash å€¼ï¼›OP_EQUALVERIFY åˆ¤æ–­æ ˆé¡¶ä¸¤å…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼›OP_CHECKSIG åˆ¤æ–­ç­¾åæ˜¯å¦åˆæ³•ã€‚è¿™æ¡æŒ‡ä»¤å®é™…ä¸Šä¿è¯äº†åªæœ‰ pubKey çš„æ‹¥æœ‰è€…æ‰èƒ½åˆæ³•å¼•ç”¨è¿™ä¸ªè¾“å‡ºã€‚ å¦å¤–ä¸€ä¸ªäº¤æ˜“å¦‚æœè¦èŠ±è´¹è¿™ä¸ªè¾“å‡ºï¼Œåœ¨å¼•ç”¨è¿™ä¸ªè¾“å‡ºçš„æ—¶å€™ï¼Œéœ€è¦æä¾›è®¤é¢†(è¾“å…¥)è„šæœ¬æ ¼å¼ä¸º 1scriptSig: &lt;sig&gt; &lt;pubKey&gt; å…¶ä¸­ï¼Œ æ˜¯æ‹¿ pubKey å¯¹åº”çš„ç§é’¥å¯¹äº¤æ˜“ï¼ˆå…¨éƒ¨äº¤æ˜“çš„è¾“å‡ºã€è¾“å…¥å’Œè„šæœ¬ï¼‰Hash å€¼è¿›è¡Œç­¾åï¼ŒpubKey çš„ Hash å€¼éœ€è¦ç­‰äº pubKeyHashã€‚ è¿›è¡Œäº¤æ˜“éªŒè¯æ—¶ï¼Œä¼šæŒ‰ç…§å…ˆ scriptSig å scriptPubKey çš„é¡ºåºè¿›è¡Œä¾æ¬¡å…¥æ ˆå¤„ç†ï¼Œå³å®Œæ•´æŒ‡ä»¤ä¸ºï¼š 1&lt;sig&gt; &lt;pubKey&gt; OP_DUP OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG è¯»è€…å¯ä»¥æŒ‰ç…§æ ˆçš„è¿‡ç¨‹æ¥è¿›è¡Œæ¨ç®—ï¼Œç†è§£æ•´ä¸ªè„šæœ¬çš„éªŒè¯è¿‡ç¨‹ã€‚ å¼•å…¥è„šæœ¬æœºåˆ¶å¸¦æ¥äº†çµæ´»æ€§ï¼Œä½†ä¹Ÿå¼•å…¥äº†æ›´å¤šçš„å®‰å…¨é£é™©ã€‚æ¯”ç‰¹å¸è„šæœ¬æ”¯æŒçš„æŒ‡ä»¤é›†ååˆ†ç®€å•ï¼ŒåŸºäºæ ˆçš„å¤„ç†æ–¹å¼ï¼Œå¹¶ä¸”éå›¾çµå®Œå¤‡ï¼Œæ­¤å¤–è¿˜æ·»åŠ äº†é¢å¤–çš„ä¸€äº›é™åˆ¶ï¼ˆå¤§å°é™åˆ¶ç­‰ï¼‰ã€‚ æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€-åŸºäºæ ˆçš„è„šæœ¬è¯­è¨€ æ ˆï¼ˆstackï¼‰- æ“ä½œæ•°æ®çš„ä¸€ç§ç»“æ„ åªèƒ½ä»ä¸€ç«¯æ“ä½œæ•°æ®ï¼Œåè¿›å…ˆå‡ºLIFO å¦‚åŒå­å¼¹åŒ£ï¼Œ å…ˆå‹å¦‚çš„å­å¼¹æœ€åæ‰“å‡º å‹æ ˆï¼ˆPUSHï¼‰ï¼Œ å‡ºæ ˆï¼ˆPOPï¼‰ åŸºäºæ ˆçš„è„šæœ¬è¯­è¨€ å¯¹æ ˆçš„æ“ä½œï¼š OP_DUP é€»è¾‘è¿ç®—ç¬¦ï¼š OP_EQUALIVERIFY åŠ å¯†è¿ç®—ç¬¦ï¼š OP_HASH160, OP_CHECKSIG ç®—æ•°è¿ç®—ç¬¦: OP_ADD, OP_SUB, OP_MUL, OP_DIV äº¤æ˜“éªŒè¯-é”å®šè„šæœ¬å’Œè§£é”è„šæœ¬ é”å®šè„šæœ¬ OP_DUP OP_HASH160 &lt;å‘é€è€…çš„å…¬é’¥å“ˆå¸Œ&gt; OP_EQUALVERIFY OP_CHECKSIG è§£é”è„šæœ¬ &lt;å‘é€è€…çš„ç­¾å&gt; &lt;å‘é€è€…çš„å…¬é’¥&gt; äº¤æ˜“éªŒè¯ è¿è¡Œè§£é”è„šæœ¬ + é”å®šè„šæœ¬ =&gt; True æ¯”ç‰¹å¸åŒºå—åŒºå—çš„åŸºæœ¬ä¿¡æ¯æ¯”ç‰¹å¸ä¸€ä¸ªåŒºå—å¤§å°ä¸èƒ½è¶…è¿‡1MBï¼Œ ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å†…å®¹: åŒºå—å¤§å°ï¼š4 å­—èŠ‚ï¼› åŒºå—å¤´ï¼š80 å­—èŠ‚ï¼š äº¤æ˜“ä¸ªæ•°è®¡æ•°å™¨ï¼š1~9 å­—èŠ‚ï¼› æ‰€æœ‰äº¤æ˜“çš„å…·ä½“å†…å®¹ï¼Œå¯å˜é•¿ï¼ŒåŒ¹é… Merkle æ ‘å¶å­èŠ‚ç‚¹é¡ºåºã€‚ åŒºå—å¤´åŒ…å«ä¿¡æ¯ ç‰ˆæœ¬å·ï¼š4 å­—èŠ‚ï¼› ä¸Šä¸€ä¸ªåŒºå—å¤´çš„ Hash å€¼ï¼šé“¾æ¥åˆ°ä¸Šä¸€ä¸ªåˆæ³•çš„å—ä¸Šï¼Œå¯¹å…¶åŒºå—å¤´è¿›è¡Œä¸¤æ¬¡ SHA256 æ“ä½œï¼Œ32 å­—èŠ‚ï¼› æœ¬åŒºå—æ‰€åŒ…å«çš„æ‰€æœ‰äº¤æ˜“çš„ Merkle æ ‘æ ¹çš„å“ˆå¸Œå€¼ï¼šä¸¤æ¬¡ SHA256 æ“ä½œï¼Œ32 å­—èŠ‚ï¼› æ—¶é—´æˆ³ï¼š4 å­—èŠ‚ï¼› éš¾åº¦æŒ‡æ ‡ï¼š4 å­—èŠ‚ï¼› Nonceï¼š4 å­—èŠ‚ï¼ŒPoW é—®é¢˜çš„ç­”æ¡ˆã€‚ å¯è§ï¼Œè¦å¯¹åŒºå—é“¾çš„å®Œæ•´æ€§è¿›è¡Œæ£€æŸ¥ï¼Œåªéœ€è¦æ£€éªŒå„ä¸ªåŒºå—å¤´éƒ¨ä¿¡æ¯å³å¯ï¼Œæ— éœ€è·å–åˆ°å…·ä½“çš„äº¤æ˜“å†…å®¹ï¼Œè¿™ä¹Ÿæ˜¯ç®€å•äº¤æ˜“éªŒè¯ï¼ˆSimple Payment Verificationï¼ŒSPVï¼‰çš„åŸºæœ¬åŸç†ã€‚å¦å¤–ï¼Œé€šè¿‡å¤´éƒ¨çš„é“¾æ¥ï¼Œæä¾›æ—¶åºå…³ç³»çš„åŒæ—¶åŠ å¤§äº†å¯¹åŒºå—ä¸­æ•°æ®è¿›è¡Œç¯¡æ”¹çš„éš¾åº¦ã€‚ åŒºå—çš„ç”Ÿæˆ æ—·å·¥åœ¨æŒ–çŸ¿å‰è¦ç»„ä»¶åŒºå— å°†coinbaseäº¤æ˜“æ‰“åŒ…è¿›åŒºå— å°†äº¤æ˜“æ± ä¸­é«˜ä¼˜å…ˆçº§çš„äº¤æ˜“æ‰“åŒ…è¿›å»å¿« ä¼˜å…ˆçº§ = äº¤æ˜“çš„é¢åº¦ * UTXOçš„æ·±åº¦ / äº¤æ˜“çš„size åˆ›å»ºå»å¼€çš„å¤´éƒ¨ æŒ–çŸ¿æˆåŠŸåï¼Œå°†è®¡ç®—å‡ºæ¥çš„éšæœºæ•°nonceå¡«å…¥åŒºå—å¤´éƒ¨ï¼Œ å¹¶å‘ä¸´è¿‘èŠ‚ç‚¹ä¼ æ’­ åŒºå—çš„éªŒè¯p2pèŠ‚ç‚¹æ¥å—åˆ°æ–°åŒºå—åï¼Œç«‹å³åšä»¥ä¸‹çš„æ£€æŸ¥ éªŒè¯POWçš„nonceå€¼æ˜¯å¦ç¬¦åˆéš¾åº¦å€¼ æ£€æŸ¥æ—¶é—´æˆ³æ˜¯å¦å°äºå½“å‰æ—¶é—´2å°æ—¶ æ£€æŸ¥Merkleæ ‘æ ¹æ˜¯å¦æ­£ç¡® æ£€æŸ¥åŒºå—sizeè¦å°äºåŒºå—çš„sizeä¸Šé™ ç¬¬ä¸€ç¬”äº¤æ˜“å¿…é¡»æ˜¯coinbaseäº¤æ˜“ éªŒè¯æ¯ä¸ªäº¤æ˜“ é»˜å…‹å°”æ ‘ åœ¨é»˜å…‹å°”æ ‘ä¸­åªè¦æä¾›å°‘æ•°çš„ä»‹ä¸ªèŠ‚ç‚¹å°±å¯ä»¥ç»™å‡º ä¸€ä¸ªåˆ†æ”¯çš„æœ‰æ•ˆæ€§è¯æ˜ï¼Œæ¯”å¦‚éªŒè¯12c5æ˜¯å¦æœ‰æ•ˆï¼Œåªéœ€è¦æä¾›æ ‡è®°ä¸ºè“è‰²çš„å‡ ç‚¹å°±å¯ä»¥è¯æ˜12c5è¿™ä¸ªäº¤æ˜“æ˜¯å¦æœ‰æ•ˆ è¯•å›¾æ”¹å˜é»˜å…‹å°”æ ‘çš„ä»»æ„ä¸€éƒ¨åˆ†éƒ½ä¼šå¯¼è‡´é“¾æ¡ä¸Šåœ¨æŸå¤„æ”¾ç”Ÿä¸ä¸€è‡´çš„æƒ…å†µ æ¯”ç‰¹å¸çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œå³åŒºå—æ˜¯å­˜åœ¨ä¸€ä¸ªå¤šçº§æ•°æ®ç»“æ„ä¸­çš„ ã€‚ä¸€ä¸ªåŒºå—çš„â€œå“ˆå¸Œå€¼â€å®é™…ä¸Šåªæ˜¯è¿™ä¸ªåŒºå—çš„å¤´ä¿¡æ¯çš„å“ˆå¸Œå€¼ï¼Œä¸€ä¸ªå¤§çº¦ 200 ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå…¶ä¸­åŒ…å«äº†æ—¶é—´æˆ³ï¼Œéšæœºæ•°ï¼Œä¸Šä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå’Œä¸€ä¸ªå­˜å‚¨äº†è¿™ä¸ªåŒºå—ä¸­æ‰€æœ‰äº¤æ˜“çš„ç§°ä¹‹ä¸ºé»˜å…‹å°”æ ‘çš„æ•°æ®ç»“æ„çš„æ ¹å“ˆå¸Œã€‚ é»˜å…‹å°”æ ‘æ˜¯ä¸€ç§äºŒå‰æ ‘ï¼ŒåŒ…å«äº†ä¸€ç»„èŠ‚ç‚¹ï¼Œå®ƒä»¬çš„å«æœ‰åŸºç¡€ä¿¡æ¯çš„æ ‘æ ¹æœ‰å¤§é‡çš„å¶å­èŠ‚ç‚¹ï¼Œä¸€ç»„ä¸­é—´èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å®ƒçš„ 2 ä¸ªå­èŠ‚ç‚¹çš„å“ˆå¸Œï¼Œç„¶åï¼Œæœ€ç»ˆçš„ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œä¹Ÿæ˜¯ç”±å®ƒçš„ 2 ä¸ªå­èŠ‚ç‚¹çš„å“ˆå¸Œå½¢æˆï¼Œä»£è¡¨ç€è¿™æ ‘çš„â€œé¡¶ç«¯â€ã€‚ è¿™ä¸ªé»˜å…‹å°”æ ‘çš„ç›®çš„æ˜¯å…è®¸åœ¨ä¸€ä¸ªåŒºå—ä¸­çš„æ•°æ®èƒ½å¤Ÿè¢«é›¶æ•£çš„ä¼ é€’: ä¸€ä¸ªèŠ‚ç‚¹åªèƒ½ä»ä¸€ä¸ªæºæ¥ä¸‹è½½ä¸€ä¸ªåŒºå—çš„å¤´ä¿¡æ¯ï¼Œæ ‘çš„ä¸€å°éƒ¨åˆ†å…³è”ç€å¦ä¸€ä¸ªæº ï¼Œå¹¶ä¸”ä»»ç„¶å¯ä»¥ä¿è¯æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯æ­£ç¡®çš„ã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšè¡Œå¾—é€šï¼Œæ˜¯å› ä¸ºå“ˆå¸Œå€¼éƒ½æ˜¯å‘ä¸Šä¼ å¯¼çš„: å¦‚æœä¸€ä¸ªæ¶æ„çš„ç”¨æˆ·è¯•å›¾åœ¨é»˜å…‹å°”æ ‘çš„åº•éƒ¨æ›¿æ¢ä¸€ä¸ªå‡çš„äº¤æ˜“, è¿™ä¸ªæ›´æ”¹å°†å¯¼è‡´ä¸Šé¢çš„èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œç„¶åä¸Šé¢çš„èŠ‚ç‚¹çš„å˜åŒ–åˆä¼šå¯¼è‡´ä¸Šä¸Šé¢çš„èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œæœ€ç»ˆæ”¹å˜è¿™ä¸ªæ•°æ ¹èŠ‚ç‚¹ï¼Œå› æ­¤ä¹Ÿæ”¹å˜äº†è¿™åŒºå—çš„å“ˆå¸Œï¼Œå¯¼è‡´è¿™ä¸ªåè®®æŠŠå®ƒæ³¨å†Œæˆä¸€ä¸ªå®Œå…¨ä¸åŒçš„åŒºå— (å‡ ä¹å¯ä»¥è‚¯å®šæ˜¯ä¸€ä¸ªæ— æ•ˆçš„å·¥ä½œè¯æ˜).è¿™é»˜å…‹å°”æ ‘åè®®å¯¹æ¯”ç‰¹å¸çš„é•¿æœŸå¯æŒç»­å‘å±•æ˜¯å¿…ä¸å¯å°‘çš„ã€‚æ¯”ç‰¹å¸ç½‘ç»œä¸­çš„ä¸€ä¸ªâ€œå®Œæ•´èŠ‚ç‚¹â€ , æˆªæ­¢åˆ° 2014 å¹´ï¼Œå ç”¨äº†å¤§çº¦ 15G çš„ç£ç›˜ç©ºé—´ï¼Œå¹¶ä¸”æ¯æœˆæ­£åœ¨ä»¥ 10 äº¿å­—èŠ‚çš„é€Ÿåº¦é€’å¢ã€‚ç›®å‰ï¼Œè¿™å¯¹äºç”µè„‘æ¥è¯´æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨æ‰‹æœºä¸Šå´æ˜¯ä¸ç°å®çš„ã€‚åœ¨ä»¥åçš„å°†æ¥ï¼Œåªæœ‰å•†ä¸šçš„å’Œä¸šä½™çˆ±å¥½è€…æ‰èƒ½å‚ä¸ç©æ¯”ç‰¹å¸ã€‚ä¸€ä¸ªç§°ä¹‹ä¸º â€œç®€åŒ–æ”¯ä»˜éªŒè¯ï¼ˆsimplified payment verificationï¼‰â€ (SPV)çš„åè®® å…è®¸å¦ä¸€ç§ç±»å‹çš„èŠ‚ç‚¹å­˜åœ¨ï¼Œè¿™ç§èŠ‚ç‚¹ç§°ä¹‹ä¸º â€œè½»èŠ‚ç‚¹ï¼ˆlight nodesï¼‰â€, å…¶ä¸‹è½½åŒºå—çš„å¤´ä¿¡æ¯,åœ¨è¿™åŒºå—å¤´ä¿¡æ¯ä¸ŠéªŒè¯å·¥ä½œè¯æ˜ï¼Œç„¶ååªä¸‹è½½ä¸ä¹‹äº¤æ˜“ç›¸å…³çš„â€œåˆ†æ”¯â€ ã€‚ è¿™ä½¿å¾—è½»èŠ‚ç‚¹åªè¦ä¸‹è½½æ•´ä¸ªåŒºå—é“¾çš„ä¸€å°éƒ¨åˆ†ï¼Œå°±å¯ä»¥å®‰å…¨åœ°ç¡®å®šä»»ä½•ä¸€ç¬”æ¯”ç‰¹å¸äº¤æ˜“çš„çŠ¶æ€å’Œè´¦æˆ·çš„å½“å‰ä½™é¢ã€‚ æŒ–çŸ¿æŒ–çŸ¿çš„åŸºæœ¬åŸç†äº†è§£æ¯”ç‰¹å¸ï¼Œæœ€åº”è¯¥çŸ¥é“çš„ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯â€œæŒ–çŸ¿â€ã€‚æŒ–çŸ¿æ˜¯å‚ä¸ç»´æŠ¤æ¯”ç‰¹å¸ç½‘ç»œçš„èŠ‚ç‚¹ï¼Œé€šè¿‡ååŠ©ç”Ÿæˆæ–°åŒºå—æ¥è·å–ä¸€å®šé‡æ–°å¢çš„æ¯”ç‰¹å¸çš„è¿‡ç¨‹ã€‚ å½“ç”¨æˆ·å‘æ¯”ç‰¹å¸ç½‘ç»œä¸­å‘å¸ƒäº¤æ˜“åï¼Œéœ€è¦æœ‰äººå°†äº¤æ˜“è¿›è¡Œç¡®è®¤ï¼Œå½¢æˆæ–°çš„åŒºå—ï¼Œä¸²è”åˆ°åŒºå—é“¾ä¸­ã€‚åœ¨ä¸€ä¸ªäº’ç›¸ä¸ä¿¡ä»»çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¯¥ç”±è°æ¥å®Œæˆè¿™ä»¶äº‹æƒ…å‘¢ï¼Ÿæ¯”ç‰¹å¸ç½‘ç»œé‡‡ç”¨äº†â€œæŒ–çŸ¿â€çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ç›®å‰ï¼Œæ¯ 10 åˆ†é’Ÿå·¦å³ç”Ÿæˆä¸€ä¸ªä¸è¶…è¿‡ 1 MB å¤§å°çš„åŒºå—ï¼ˆè®°å½•äº†è¿™ 10 åˆ†é’Ÿå†…å‘ç”Ÿçš„éªŒè¯è¿‡çš„äº¤æ˜“å†…å®¹ï¼‰ï¼Œä¸²è”åˆ°æœ€é•¿çš„é“¾å°¾éƒ¨ï¼Œæ¯ä¸ªåŒºå—çš„æˆåŠŸæäº¤è€…å¯ä»¥å¾—åˆ°ç³»ç»Ÿ 12.5 ä¸ªæ¯”ç‰¹å¸çš„å¥–åŠ±ï¼ˆè¯¥å¥–åŠ±ä½œä¸ºåŒºå—å†…çš„ç¬¬ä¸€ä¸ªäº¤æ˜“ï¼Œä¸€å®šåŒºå—æ•°åæ‰èƒ½ä½¿ç”¨ï¼‰ï¼Œä»¥åŠç”¨æˆ·é™„åŠ åˆ°äº¤æ˜“ä¸Šçš„æ”¯ä»˜æœåŠ¡è´¹ç”¨ã€‚å³ä¾¿æ²¡æœ‰ä»»ä½•ç”¨æˆ·äº¤æ˜“ï¼ŒçŸ¿å·¥ä¹Ÿå¯ä»¥è‡ªè¡Œäº§ç”Ÿåˆæ³•çš„åŒºå—å¹¶è·å¾—å¥–åŠ±ã€‚ æ¯ä¸ªåŒºå—çš„å¥–åŠ±æœ€åˆæ˜¯ 50 ä¸ªæ¯”ç‰¹å¸ï¼Œæ¯éš” 21 ä¸‡ä¸ªåŒºå—è‡ªåŠ¨å‡åŠï¼Œå³ 4 å¹´æ—¶é—´ï¼Œæœ€ç»ˆæ¯”ç‰¹å¸æ€»é‡ç¨³å®šåœ¨ 2100 ä¸‡ä¸ªã€‚å› æ­¤ï¼Œæ¯”ç‰¹å¸æ˜¯ä¸€ç§é€šç¼©çš„è´§å¸ã€‚ æŒ–çŸ¿çš„è¿‡ç¨‹ å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå¯ä¿¡ä»»çš„ä¸­å¤®æœåŠ¡å™¨, é‚£ä¹ˆå®ç°è¿™ä¸ªç³»ç»Ÿæ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…; å°±æŒ‰ç…§éœ€æ±‚æ‰€æè¿°çš„å»ç¼–å†™ä»£ç å³å¯ï¼ŒæŠŠçŠ¶æ€è®°å½•åœ¨ä¸­å¤®æœåŠ¡å™¨çš„ç¡¬ç›˜ä¸Šã€‚ ç„¶è€Œï¼Œä¸æ¯”ç‰¹å¸ä¸€æ ·ï¼Œæˆ‘ä»¬è¯•å›¾å»å»ºç«‹ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„è´§å¸ç³»ç»Ÿ, æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æŠŠçŠ¶æ€è½¬ç§»ç³»ç»Ÿå’Œä¸€è‡´æ€§ç³»ç»Ÿç»“åˆèµ·æ¥ï¼Œä»¥ç¡®ä¿æ¯ä¸ªäººéƒ½åŒæ„è¿™äº¤æ˜“çš„é¡ºåºã€‚ æ¯”ç‰¹å¸çš„å»ä¸­å¿ƒåŒ–çš„ä¸€è‡´æ€§å¤„ç†è¿›ç¨‹è¦æ±‚ç½‘ç»œä¸­çš„èŠ‚ç‚¹è¿ç»­ä¸æ–­çš„å»å°è¯•å¯¹äº¤æ˜“è¿›è¡Œæ‰“åŒ…ï¼Œè¿™äº›è¢«æ‰“æˆçš„åŒ…å°±ç§°ä¸ºâ€œåŒºå—â€ã€‚ è¿™ä¸ªç½‘ç»œä¼šæ•…æ„çš„æ¯éš” 10 åˆ†é’Ÿå·¦å³å°±åˆ›å»ºä¸€ä¸ªåŒºå—, æ¯ä¸€ä¸ªåŒºå—é‡Œéƒ½åŒ…å«ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œä¸€ä¸ªéšæœºæ•°ï¼Œä¸€ä¸ªå¯¹ä¸Šä¸€ä¸ªåŒºå—çš„å¼•ç”¨ ï¼Œå’Œä»ä¸Šä¸€ä¸ªåŒºå—å¼€å§‹çš„æ‰€æœ‰äº¤æ˜“çš„åˆ—è¡¨ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™ä¼šåˆ›å»ºä¸€ä¸ªæŒä¹…çš„ï¼Œä¸æ–­å¢é•¿çš„åŒºå—é“¾ï¼Œè¿™ä¸ªåŒºå—é“¾ä¸æ–­çš„è¢«æ›´æ–°ï¼Œä½¿å…¶å§‹ç»ˆä»£è¡¨ç€æœ€æ–°çš„æ¯”ç‰¹å¸æ€»è´¦çš„çŠ¶æ€ã€‚ éªŒè¯ä¸€ä¸ªåŒºå—æ˜¯å¦æœ‰æ•ˆçš„ç®—æ³•å¦‚ä¸‹: æ£€æŸ¥å…¶å¼•ç”¨çš„ä¸Šä¸€ä¸ªåŒºå—æ˜¯å¦å­˜åœ¨å¹¶ä¸”æœ‰æ•ˆ. æ£€æŸ¥è¿™ä¸ªåŒºå—çš„æ—¶é—´æˆ³æ˜¯å¦å¤§äºä¸Šä¸€ä¸ªåŒºå—çš„æ—¶é—´æˆ³ å¹¶ä¸”å°äº 2 å°æ—¶ä¹‹å†… æ£€æŸ¥è¿™åŒºå—ä¸Šçš„å·¥ä½œè¯æ˜æ˜¯å¦æœ‰æ•ˆ. è®© S[0] æˆä¸ºä¸Šä¸€ä¸ªåŒºå—çš„æœ€æœ«ç«¯çš„çŠ¶æ€. å‡è®¾ TX æ˜¯è¿™ä¸ªåŒºå—çš„äº¤æ˜“åˆ—è¡¨ï¼Œä¸”æœ‰ n ä¸ªäº¤æ˜“ã€‚ åš for å¾ªç¯ï¼ŒæŠŠ i ä» 0 åŠ åˆ°åˆ° n-1ï¼Œ è®¾ç½® S[i+1] = APPLY(S[i],TX[i]) å¦‚æœä»»ä½•ä¸€ä¸ªåº”ç”¨(APPLY)è¿”å›é”™è¯¯ï¼Œåˆ™é€€å‡ºå¹¶ä¸”è¿”å›ã€‚ è¿”å› true,å¹¶ä¸”æŠŠ S[n] è®¾ç½®æˆè¿™ä¸ªåŒºå—æœ€æœ«ç«¯çš„çŠ¶æ€ã€‚ ä»æœ¬è´¨ä¸Šè¯´ï¼ŒåŒºå—ä¸­çš„æ¯ä¸€ä¸ªäº¤æ˜“éƒ½å¿…é¡»æä¾›ä¸€ä¸ªæœ‰æ•ˆçš„çŠ¶æ€ï¼Œä»äº¤æ˜“æ‰§è¡Œå‰çš„æ ‡å‡†çŠ¶æ€åˆ°æ‰§è¡Œåçš„ä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚ æ³¨æ„ï¼ŒçŠ¶æ€å¹¶æ²¡æœ‰ä»¥ä»»ä½•æ–¹å¼ç¼–ç è¿›åŒºå—ä¸­;å®ƒçº¯ç²¹æ˜¯ä¸€ä¸ªè¢«éªŒè¯èŠ‚ç‚¹æ‰€è®°ä½çš„æŠ½è±¡ï¼Œå¹¶ä¸”å®ƒåªèƒ½ç”¨æ¥è¢«ä»åˆ›ä¸–åŒºå—èµ·çš„æ¯ä¸€ä¸ªåŒºå—è¿›è¡Œå®‰å…¨çš„è®¡ç®—ï¼Œç„¶åæŒ‰ç…§é¡ºåºçš„åº”ç”¨åœ¨æ¯ä¸€ä¸ªåŒºå—ä¸­çš„æ¯ä¸€æ¬¡äº¤æ˜“ä¸­ã€‚æ­¤å¤–ï¼Œè¯·æ³¨æ„çŸ¿å·¥æŠŠäº¤æ˜“æ‰“åŒ…è¿›åŒºå—çš„é¡ºåºæ˜¯å¾ˆé‡è¦çš„; å¦‚æœä¸€ä¸ªåŒºå—ä¸­æœ‰ 2 ä¸ªäº¤æ˜“ A å’Œ B,B èŠ±äº†ä¸€ä¸ªç”± A åˆ›å»ºçš„ UTXO, é‚£ä¹ˆå¦‚æœ A æ¯” B æ›´æ—©çš„è¿›å…¥åŒºå—ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒºå—å°†æ˜¯æœ‰æ•ˆçš„ï¼Œä¸ç„¶å°±æ˜¯æ— æ•ˆçš„ã€‚ åœ¨ä¸Šè¿°åˆ—å‡ºçš„éªŒè¯æ¡ä»¶ä¸­ï¼Œâ€œå·¥ä½œè¯æ˜â€ è¿™ä¸€æ˜ç¡®çš„æ¡ä»¶å°±æ˜¯æ¯ä¸€ä¸ªåŒºå—çš„ 2 æ¬¡ SHA256 å“ˆå¸Œå€¼, å®ƒä½œä¸ºä¸€ä¸ª 256 ä½çš„æ•°å­—,å¿…é¡»å°äºä¸€ä¸ªåŠ¨æ€è°ƒæ•´çš„ç›®æ ‡å€¼, æˆªæ­¢åˆ°æœ¬æ–‡å†™ä½œçš„æ—¶é—´ï¼Œè¯¥åŠ¨æ€è°ƒæ•´çš„å€¼çš„å¤§å°å¤§çº¦æ˜¯ 2 çš„ 187 æ¬¡æ–¹ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†è®©åˆ›å»ºåŒºå—çš„ç®—æ³•å˜éš¾, ä»è€Œï¼Œé˜»æ­¢å¹½çµæ”»å‡»è€…ä»å¯¹å®ƒä»¬æœ‰åˆ©çš„è§’åº¦å‡ºæ¥ï¼Œæ¥å¯¹åŒºå—é“¾è¿›è¡Œæ•´ä¸ªçš„æ”¹é€ ã€‚å› ä¸º SHA256 è¢«è®¾è®¡æˆä¸€ä¸ªå®Œå…¨ä¸å¯é¢„æµ‹çš„ä¼ªéšæœºå‡½æ•°, è¿™åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆåŒºå—çš„å”¯ä¸€çš„æ–¹æ³•åªæœ‰æ˜¯ä¸æ–­çš„å°è¯•å’Œå‡ºé”™ï¼Œ ä¸æ–­å¯¹éšæœºæ•°è¿›è¡Œé€’å¢ï¼Œç„¶åæŸ¥çœ‹æ–°çš„å“ˆå¸Œå€¼æ˜¯å¦åŒ¹é…ã€‚ æŒ‰ç…§å½“å‰çš„ç›®æ ‡å€¼ 2 çš„ 187 æ¬¡æ–¹ï¼Œè¿™ä¸ªç½‘ç»œåœ¨æ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„åŒºå—å‰ï¼Œå¿…é¡»è¿›è¡Œ 2 çš„ 69 æ¬¡æ–¹æ¬¡çš„å°è¯•; ä¸€èˆ¬æ¥è¯´,æ¯éš” 2016 ä¸ªåŒºå—ï¼Œè¿™ä¸ªç›®æ ‡å€¼å°±ä¼šè¢«ç½‘ç»œè°ƒæ•´ä¸€æ¬¡ ï¼Œå› æ­¤ç½‘ç»œä¸­å¹³å‡æ¯éš” 10 åˆ†é’Ÿå°±ä¼šæœ‰ä¸€äº›èŠ‚ç‚¹äº§ç”Ÿå‡ºä¸€ä¸ªæ–°çš„åŒºå—ã€‚ä¸ºäº†è¡¥å¿è¿™äº›çŸ¿å·¥çš„è®¡ç®—å·¥ä½œ, æ¯ä¸€ä¸ªåŒºå—çš„çŸ¿å·¥æœ‰æƒè¦æ±‚åŒ…å«ä¸€ç¬”å‘ç»™ä»–ä»¬è‡ªå·±çš„ 12.5BTCï¼ˆä¸çŸ¥é“ä»å“ªæ¥çš„ï¼‰çš„äº¤æ˜“ã€‚å¦å¤–,å¦‚æœä»»ä½•äº¤æ˜“ï¼Œå®ƒçš„æ€»çš„è¾“å…¥çš„é¢å€¼æ¯”æ€»çš„è¾“å‡ºè¦é«˜ï¼Œè¿™ä¸€å·®é¢ä¼šä½œä¸ºâ€œäº¤æ˜“è´¹ç”¨â€è½¬ç»™çŸ¿å·¥ã€‚é¡ºä¾¿æä¸€ä¸‹ï¼Œå¯¹çŸ¿å·¥çš„å¥–åŠ±æ˜¯æ¯”ç‰¹å¸å‘è¡Œçš„å”¯ä¸€é€”å¾„ï¼Œåˆ›ä¸–çŠ¶æ€ä¸­å¹¶æ²¡æœ‰æ¯”ç‰¹å¸ã€‚ è´Ÿåé¦ˆè°ƒè§£æ¯”ç‰¹å¸ç½‘ç»œåœ¨è®¾è®¡ä¸Šï¼Œå¾ˆå¥½çš„ä½“ç°äº†è´Ÿåé¦ˆçš„æ§åˆ¶è®ºåŸºæœ¬åŸç†ã€‚ æ¯”ç‰¹å¸ç½‘ç»œä¸­çŸ¿å·¥è¶Šå¤šï¼Œç³»ç»Ÿå°±è¶Šç¨³å®šï¼Œæ¯”ç‰¹å¸ä»·å€¼å°±è¶Šé«˜ï¼Œä½†æŒ–åˆ°çŸ¿çš„æ¦‚ç‡ä¼šé™ä½ã€‚ åä¹‹ï¼Œç½‘ç»œä¸­çŸ¿å·¥å‡å°‘ï¼Œä¼šè®©ç³»ç»Ÿæ›´å®¹æ˜“å¯¼è‡´è¢«æ”»å‡»ï¼Œæ¯”ç‰¹å¸ä»·å€¼è¶Šä½ï¼Œä½†æŒ–åˆ°çŸ¿çš„æ¦‚ç‡ä¼šæé«˜ã€‚ å› æ­¤ï¼Œæ¯”ç‰¹å¸çš„ä»·æ ¼ç†è®ºä¸Šåº”è¯¥ç¨³å®šåœ¨ä¸€ä¸ªåˆé€‚çš„å€¼ï¼ˆç½‘ç»œç¨³å®šæ€§ä¹Ÿä¼šç¨³å®šåœ¨ç›¸åº”çš„å€¼ï¼‰ï¼Œè¿™ä¸ªä»·æ ¼ä¹˜ä»¥æŒ–åˆ°çŸ¿çš„æ¦‚ç‡ï¼Œæ°å¥½è¾¾åˆ°çŸ¿å·¥çš„æ”¶ç›Šé¢„æœŸã€‚ ä»é•¿è¿œè§’åº¦çœ‹ï¼Œç¡¬ä»¶æˆæœ¬æ˜¯ä¸‹é™çš„ï¼Œä½†æ¯ä¸ªåŒºå—çš„æ¯”ç‰¹å¸å¥–åŠ±æ¯éš” 4 å¹´å‡åŠï¼Œæœ€ç»ˆå°†åœ¨ 2140 å¹´è¾¾åˆ° 2100 ä¸‡æšï¼Œä¹‹åå°†å®Œå…¨ä¾é äº¤æ˜“çš„æœåŠ¡è´¹æ¥é¼“åŠ±çŸ¿å·¥å¯¹ç½‘ç»œçš„ç»´æŠ¤ã€‚ æ³¨ï¼šæ¯”ç‰¹å¸æœ€å°å•ä½æ˜¯â€œèªâ€ï¼Œå³ 10^(-8) æ¯”ç‰¹å¸ï¼Œæ€»â€œèªâ€æ•°ä¸º 2.1E15ã€‚å¯¹äº 64 ä½å¤„ç†å™¨æ¥è¯´ï¼Œé«˜ç²¾åº¦æµ®ç‚¹è®¡æ•°çš„é™åˆ¶å¯¼è‡´å•ä¸ªæ•°å€¼ä¸èƒ½è¶…è¿‡ 2^53 çº¦ç­‰äº 9E15ã€‚ å…±è¯†æœºåˆ¶å…±è¯†æœºåˆ¶ä»‹ç»æ¯”ç‰¹å¸ç½‘ç»œæ˜¯å®Œå…¨å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥åŒ¿åæ¥å…¥ï¼Œå› æ­¤å…±è¯†åè®®çš„ç¨³å®šæ€§å’Œé˜²æ”»å‡»æ€§ååˆ†å…³é”®ã€‚ æ¯”ç‰¹å¸åŒºå—é“¾é‡‡ç”¨äº† Proof of Workï¼ˆPoWï¼‰çš„æœºåˆ¶æ¥å®ç°å…±è¯†ï¼Œè¯¥æœºåˆ¶æœ€æ—©äº 1998 å¹´åœ¨ B-money è®¾è®¡ä¸­æå‡ºã€‚ ç›®å‰ï¼ŒProof of X ç³»åˆ—ä¸­æ¯”è¾ƒå‡ºåçš„ä¸€è‡´æ€§åè®®åŒ…æ‹¬ PoWã€PoS å’Œ DPoS ç­‰ï¼Œéƒ½æ˜¯é€šè¿‡ç»æµæƒ©ç½šæ¥é™åˆ¶æ¶æ„å‚ä¸ã€‚ å·¥ä½œé‡è¯æ˜å·¥ä½œé‡è¯æ˜ï¼Œé€šè¿‡è®¡ç®—æ¥çŒœæµ‹ä¸€ä¸ªæ•°å€¼ï¼ˆnonceï¼‰ï¼Œä½¿å¾—æ‹¼å‡‘ä¸Šäº¤æ˜“æ•°æ®åå†…å®¹çš„ Hash å€¼æ»¡è¶³è§„å®šçš„ä¸Šé™ï¼ˆæ¥æºäº hashcashï¼‰ã€‚ç”±äº Hash éš¾é¢˜åœ¨ç›®å‰è®¡ç®—æ¨¡å‹ä¸‹éœ€è¦å¤§é‡çš„è®¡ç®—ï¼Œè¿™å°±ä¿è¯åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œç³»ç»Ÿä¸­åªèƒ½å‡ºç°å°‘æ•°åˆæ³•ææ¡ˆã€‚åè¿‡æ¥ï¼Œèƒ½å¤Ÿæå‡ºåˆæ³•ææ¡ˆï¼Œä¹Ÿè¯æ˜ææ¡ˆè€…ç¡®å®å·²ç»ä»˜å‡ºäº†ä¸€å®šçš„å·¥ä½œé‡ã€‚ åŒæ—¶ï¼Œè¿™äº›å°‘é‡çš„åˆæ³•ææ¡ˆä¼šåœ¨ç½‘ç»œä¸­è¿›è¡Œå¹¿æ’­ï¼Œæ”¶åˆ°çš„ç”¨æˆ·è¿›è¡ŒéªŒè¯åï¼Œä¼šåŸºäºç”¨æˆ·è®¤ä¸ºçš„æœ€é•¿é“¾åŸºç¡€ä¸Šç»§ç»­éš¾é¢˜çš„è®¡ç®—ã€‚å› æ­¤ï¼Œç³»ç»Ÿä¸­å¯èƒ½å‡ºç°é“¾çš„åˆ†å‰ï¼ˆForkï¼‰ï¼Œä½†æœ€ç»ˆä¼šæœ‰ä¸€æ¡é“¾æˆä¸ºæœ€é•¿çš„é“¾ã€‚ Hash é—®é¢˜å…·æœ‰ä¸å¯é€†çš„ç‰¹ç‚¹ï¼Œå› æ­¤ï¼Œç›®å‰é™¤äº†æš´åŠ›è®¡ç®—å¤–ï¼Œè¿˜æ²¡æœ‰æœ‰æ•ˆçš„ç®—æ³•è¿›è¡Œè§£å†³ã€‚åä¹‹ï¼Œå¦‚æœè·å¾—ç¬¦åˆè¦æ±‚çš„ nonceï¼Œåˆ™è¯´æ˜åœ¨æ¦‚ç‡ä¸Šæ˜¯ä»˜å‡ºäº†å¯¹åº”çš„ç®—åŠ›ã€‚è°çš„ç®—åŠ›å¤šï¼Œè°æœ€å…ˆè§£å†³é—®é¢˜çš„æ¦‚ç‡å°±è¶Šå¤§ã€‚å½“æŒæ¡è¶…è¿‡å…¨ç½‘ä¸€åŠç®—åŠ›æ—¶ï¼Œä»æ¦‚ç‡ä¸Šå°±èƒ½æ§åˆ¶ç½‘ç»œä¸­é“¾çš„èµ°å‘ã€‚è¿™ä¹Ÿæ˜¯æ‰€è°“ 51% æ”»å‡»çš„ç”±æ¥ã€‚ å‚ä¸ PoW è®¡ç®—æ¯”èµ›çš„äººï¼Œå°†ä»˜å‡ºä¸å°çš„ç»æµæˆæœ¬ï¼ˆç¡¬ä»¶ã€ç”µåŠ›ã€ç»´æŠ¤ç­‰ï¼‰ã€‚å½“æ²¡æœ‰æœ€ç»ˆæˆä¸ºé¦–ä¸ªç®—å‡ºåˆæ³• nonce å€¼çš„â€œå¹¸è¿å„¿â€æ—¶ï¼Œè¿™äº›æˆæœ¬éƒ½å°†è¢«æ²‰æ²¡æ‰ã€‚è¿™ä¹Ÿä¿éšœäº†ï¼Œå¦‚æœæœ‰äººå°è¯•æ¶æ„ç ´åï¼Œéœ€è¦ä»˜å‡ºå¤§é‡çš„ç»æµæˆæœ¬ã€‚ä¹Ÿæœ‰è®¾è®¡è¯•å›¾å°†åç®—å‡ºç»“æœè€…çš„ç®—åŠ›æŒ‰ç…§ä¸€å®šæ¯”ä¾‹æŠ˜åˆè¿›ä¸‹ä¸€è½®æ¯”èµ›è€ƒè™‘ã€‚ æƒç›Šè¯æ˜æƒç›Šè¯æ˜ï¼ˆProof of Stakeï¼ŒPoSï¼‰ï¼Œæœ€æ—©åœ¨ 2013 å¹´è¢«æå‡ºï¼Œç±»ä¼¼ç°å®ç”Ÿæ´»ä¸­çš„è‚¡ä¸œæœºåˆ¶ï¼Œæ‹¥æœ‰è‚¡ä»½è¶Šå¤šçš„äººè¶Šå®¹æ˜“è·å–è®°è´¦æƒï¼ˆåŒæ—¶è¶Šå€¾å‘äºç»´æŠ¤ç½‘ç»œçš„æ­£å¸¸å·¥ä½œï¼‰ã€‚ å…¸å‹çš„è¿‡ç¨‹æ˜¯é€šè¿‡ä¿è¯é‡‘ï¼ˆä»£å¸ã€èµ„äº§ã€åå£°ç­‰å…·å¤‡ä»·å€¼å±æ€§çš„ç‰©å“å³å¯ï¼‰æ¥å¯¹èµŒä¸€ä¸ªåˆæ³•çš„å—æˆä¸ºæ–°çš„åŒºå—ï¼Œæ”¶ç›Šä¸ºæŠµæŠ¼èµ„æœ¬çš„åˆ©æ¯å’Œäº¤æ˜“æœåŠ¡è´¹ã€‚æä¾›è¯æ˜çš„ä¿è¯é‡‘ï¼ˆä¾‹å¦‚é€šè¿‡è½¬è´¦è´§å¸è®°å½•ï¼‰è¶Šå¤šï¼Œåˆ™è·å¾—è®°è´¦æƒçš„æ¦‚ç‡å°±è¶Šå¤§ã€‚åˆæ³•è®°è´¦è€…å¯ä»¥è·å¾—æ”¶ç›Šã€‚ PoS è¯•å›¾è§£å†³åœ¨ PoW ä¸­å¤§é‡èµ„æºè¢«æµªè´¹çš„ç¼ºç‚¹ï¼Œå—åˆ°äº†å¹¿æ³›å…³æ³¨ã€‚æ¶æ„å‚ä¸è€…å°†å­˜åœ¨ä¿è¯é‡‘è¢«ç½šæ²¡çš„é£é™©ï¼Œå³æŸå¤±ç»æµåˆ©ç›Šã€‚ ä¸€èˆ¬çš„ï¼Œå¯¹äº PoS æ¥è¯´ï¼Œéœ€è¦æŒæ¡è¶…è¿‡å…¨ç½‘ 1/3 çš„èµ„æºï¼Œæ‰æœ‰å¯èƒ½å·¦å³æœ€ç»ˆçš„ç»“æœã€‚è¿™ä¸ªä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œä¸‰ä¸ªäººæŠ•ç¥¨ï¼Œå‰ä¸¤äººåˆ†åˆ«æ”¯æŒä¸€æ–¹ï¼Œè¿™æ—¶å€™ï¼Œç¬¬ä¸‰æ–¹çš„æŠ•ç¥¨å°†å†³å®šæœ€ç»ˆç»“æœã€‚ PoS ä¹Ÿæœ‰ä¸€äº›æ”¹è¿›çš„ç®—æ³•ï¼ŒåŒ…æ‹¬æˆæƒè‚¡æƒè¯æ˜æœºåˆ¶ï¼ˆDPoSï¼‰ï¼Œå³è‚¡ä¸œä»¬æŠ•ç¥¨é€‰å‡ºä¸€ä¸ªè‘£äº‹ä¼šï¼Œè‘£äº‹ä¼šä¸­æˆå‘˜æ‰æœ‰æƒè¿›è¡Œä»£ç†è®°è´¦ã€‚è¿™äº›ç®—æ³•åœ¨å®è·µä¸­å¾—åˆ°äº†ä¸é”™çš„éªŒè¯ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç†è®ºä¸Šçš„è¯æ˜ã€‚ 2017 å¹´ 8 æœˆï¼Œæ¥è‡ªçˆ±ä¸å ¡å¤§å­¦å’Œåº·æ¶…ç‹„æ ¼å¤§å­¦çš„ Aggelos Kiayias ç­‰å­¦è€…åœ¨è®ºæ–‡ã€ŠOuroboros: A Provably Secure Proof-of-Stake Blockchain Protocolã€‹ä¸­æå‡ºäº† Ouroboros åŒºå—é“¾å…±è¯†åè®®ï¼Œè¯¥åè®®å¯ä»¥è¾¾åˆ°è¯šå®è¡Œä¸ºçš„è¿‘ä¼¼çº³ä»€å‡è¡¡ï¼Œè®¤ä¸ºæ˜¯é¦–ä¸ªå¯è¯å®å®‰å…¨çš„ PoS åè®®ã€‚ éš”ç¦»è§è¯ä»€ä¹ˆæ˜¯éš”ç¦»è§è¯éš”ç¦»è§è¯ï¼Œå³ Segregated Witnessï¼ˆç®€ç§°SegWitï¼‰ï¼Œç”±Pieter Wuilleï¼ˆæ¯”ç‰¹å¸æ ¸å¿ƒå¼€å‘äººå‘˜ã€Blockstreamè”åˆåˆ›å§‹äººï¼‰åœ¨2015å¹´12æœˆé¦–æ¬¡æå‡ºã€‚ è§è¯ï¼ˆWitnessï¼‰ è§è¯ï¼Œåœ¨æ¯”ç‰¹å¸é‡ŒæŒ‡çš„æ˜¯å¯¹äº¤æ˜“åˆæ³•æ€§çš„éªŒè¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒAliceå‘èµ·ä¸€ç¬”äº¤æ˜“ï¼Œç»™Bobæ”¯ä»˜1ä¸ªBTCï¼Œè¯¥ç¬”äº¤æ˜“ä¿¡æ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š a.å…ƒæ•°æ®ï¼šäº¤æ˜“ä¿¡æ¯æ ¼å¼çš„ç‰ˆæœ¬å·ï¼›äº¤æ˜“é”å®šæ—¶é—´ç­‰ b.ä»˜æ¬¾äººï¼šAliceç”¨äºä»˜æ¬¾çš„BTCæ¥æºï¼Œä¸€èˆ¬æ¥æºäºæŸå†å²åŒºå—ä¸ŠæŸç¬”äº¤æ˜“çš„è¾“å‡ºï¼ˆè¯¦ è§UTXOï¼‰ï¼›è¯æ˜Aliceæ‹¥æœ‰è¯¥ç¬”äº¤æ˜“çš„è¾“å‡ºï¼Œå³è§è¯ï¼ˆWitnessï¼‰æ•°æ® c.æ”¶æ¬¾äººï¼šBobçš„æ”¶æ¬¾åœ°å€å’Œé‡‘é¢ å¯è§ï¼Œè§è¯æ•°æ®åŒ…å«åœ¨äº¤æ˜“ä¿¡æ¯é‡Œå¤´ã€‚ éš”ç¦»ï¼ˆSegregatedï¼‰ æŒ‡çš„å°±æ˜¯æŠŠè§è¯æ•°æ®ä»äº¤æ˜“ä¿¡æ¯é‡ŒæŠ½ç¦»å‡ºæ¥ï¼Œå•ç‹¬å­˜æ”¾ã€‚ éš”ç¦»è§è¯çš„æ¥æºä¸ºä»€ä¹ˆè¦æŠŠè§è¯æ•°æ®éš”ç¦»å‡ºæ¥å‘¢ï¼Œæˆ–è€…è¯´è¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°æ¯”ç‰¹å¸é‡Œçš„å¦ä¸€ä¸ªæ¦‚å¿µâ€“æ‰©å®¹ã€‚ æ‰©å®¹ï¼ŒæŒ‡çš„æ˜¯å¢åŠ æ¯”ç‰¹å¸æ¯ç§’çš„äº¤æ˜“é‡ã€‚æ¯”ç‰¹å¸æ¯10åˆ†é’Ÿå·¦å³æŒ–å‡ºä¸€ä¸ªå¤§å°å°äº1MBçš„åŒºå—ï¼Œæ¯ç¬”äº¤æ˜“å¹³å‡250å­—èŠ‚ï¼Œå³æ¯ä¸ªåŒºå—æœ€å¤šæ”¾è¿›4000ç¬”äº¤æ˜“ï¼Œè¿™æ ·ç®—ä¸‹æ¥ï¼Œæ¯”ç‰¹å¸æ¯ç§’å¤„ç†çš„äº¤æ˜“æ•°ä¸è¶…è¿‡7ä¸ªã€‚å¯¹æ¯”å…¶å®ƒäº¤æ˜“å¹³å°ï¼ŒPayPalæ¯ç§’æ•°ç™¾ç¬”ã€Visaæ¯ç§’æ•°åƒç¬”ã€æ”¯ä»˜å®èƒ½è¾¾åˆ°æ¯ç§’æ•°ä¸‡ç¬”ï¼Œå¯è§æ¯”ç‰¹å¸æ˜¯ä¸€ä¸ªéå¸¸ä½æ•ˆçš„äº¤æ˜“ç³»ç»Ÿã€‚å¦‚æœä½¿ç”¨äººæ•°å¢å¤šï¼Œåˆ™ä¼šé€ æˆæ¯”ç‰¹å¸çš„æ‹¥å µã€‚ å¦‚ä½•è§£å†³æ‹¥å µå‘¢ï¼Ÿ æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯ç®€å•çš„å¢åŠ æ¯ä¸ªåŒºå—çš„å¤§å°ï¼Œæ¯”å¦‚å°†åŒºå—å¤§å°å¢åŠ åˆ°8Mï¼›å¦ä¸€ç§å°±æ˜¯éš”ç¦»è§è¯+é—ªç”µç½‘ç»œå•¦ã€‚ æ‰©å®¹æ–¹æ¡ˆä¸€: å¢åŠ åŒºå—å¤§å°å¦‚æœå°†åŒºå—å¤§å°å¢è‡³8Mï¼Œç®€å•æ€è€ƒä¸€ä¸‹ï¼Œæ¯”ç‰¹å¸æ¯ç§’å¤„ç†çš„äº¤æ˜“æ•°ä¼¼ä¹ä¹Ÿå¢åŠ åˆ°åŸæ¥çš„8å€ï¼Œå³56ç¬”æ¯ç§’ã€‚å¦‚æœæ¯ä¸ªåŒºå—1ä¸ªGBï¼Œæ¯”ç‰¹å¸æ¯ç§’å°†å¤„ç†7000ç¬”äº¤æ˜“ï¼Œæ‹¥å µé—®é¢˜ä¸å°±è§£å†³äº†å—ï¼Ÿ ä¸­æœ¬èªå¯æ²¡é‚£ä¹ˆå‚»ï¼Œä¹‹æ‰€ä»¥å°†åŒºå—å¤§å°è®¾å®šä¸º1Mï¼Œæ˜¯æœ‰é‡è¦åŸå› çš„ã€‚æ¯”ç‰¹å¸ç™½çš®ä¹¦çš„æ ‡é¢˜ä¸ºï¼šä¸€ç§ç‚¹å¯¹ç‚¹çš„ç”µå­ç°é‡‘ç³»ç»Ÿï¼Œç›¸æ¯”äºä¼ ç»Ÿè´§å¸ç³»ç»Ÿï¼Œæ¯”ç‰¹å¸çš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ç°äº†ä¸€ç§å»ä¸­å¿ƒè€Œä¸”å®‰å…¨çš„è´§å¸ã€‚å¦‚æœåŒºå—çš„å¤§å°è¿‡å¤§ï¼Œåˆ™ä¼šå±å®³åˆ°æ¯”ç‰¹å¸çš„å®‰å…¨æ¨¡å‹ï¼Œä½œä¸ºä¸€ç§è´§å¸åº”ç”¨ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸èƒ½ä»¤äººæ¥å—çš„ã€‚ ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ POWæœºåˆ¶çš„å®‰å…¨åŸºç¡€ï¼Œæ˜¯å‡è®¾ä¸€ä¸ªäººçš„ç®—åŠ›æ— æ³•è¶…è¿‡å…¨ç½‘ç®—åŠ›çš„50%ã€‚å¦‚æœå¢å¤§åŒºå—ï¼Œå¯èƒ½ä¸€ä¸ªäººçš„ç®—åŠ›è¶…è¿‡å…¨ç½‘çš„1/3ï¼Œå°±å±å®³åˆ°äº†æ¯”ç‰¹å¸çš„å®‰å…¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸ºäº†è¾¾åˆ°æ¯ç§’7000ç¬”çš„äº¤æ˜“é€Ÿåº¦ï¼Œæˆ‘ä»¬æŠŠåŒºå—çš„å¤§å°å¢åŠ åˆ°1GBï¼š a.å‡è®¾1GBçš„åŒºå—ä»äº§ç”Ÿåˆ°å¹¿æ’­åˆ°å…¨ç½‘èŠ‚ç‚¹éœ€è¦10åˆ†é’Ÿï¼› b.æœ‰ä¸€ä¸ªå«Byzantiumçš„èŠ‚ç‚¹ï¼Œæ‹¥æœ‰çš„ç®—åŠ›è¶…è¿‡å…¨ç½‘1/3ï¼› c.å½“ByzantiumèŠ‚ç‚¹æŒ–å‡ºä¸€ä¸ªæ–°åŒºå—æ—¶ï¼Œå‡è®¾è¯¥æ—¶é—´ç‚¹ä¸º0ç§’ï¼Œé‚£ä¹ˆByzantiumèŠ‚ç‚¹ è·å–æ–°åŒºå—çš„æ—¶é—´ç‚¹ä¸º0ç§’ï¼›æ ¹æ®å‡è®¾aï¼Œå…¨ç½‘æœ€åä¸€ä¸ªè·å–æ–°åŒºå—çš„èŠ‚ç‚¹çš„è·å–æ—¶é—´ ä¸º600ç§’ï¼Œå¦‚æœè·å–é€Ÿåº¦æ˜¯çº¿æ€§çš„ï¼Œå…¨ç½‘å…¶å®ƒèŠ‚ç‚¹è·å–æ–°åŒºå—çš„å¹³å‡æ—¶é—´æ˜¯300ç§’ã€‚ d.å› ä¸ºåœ¨æ–°åŒºå—ä¸ŠæŒ–å‘çš„ç®—åŠ›æ‰æ˜¯æœ‰æ•ˆç®—åŠ›ï¼›æ ¹æ®cï¼Œå…¨ç½‘å…¶å®ƒèŠ‚ç‚¹çš„æœ‰æ•ˆç®—åŠ›åªå‰©ä¸‹ ä¸€åŠï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…¨ç½‘å…¶å®ƒèŠ‚ç‚¹çš„æœ‰æ•ˆç®—åŠ›å°äº1/3 e.æ ¹æ®bå’Œdï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒByzantiumèŠ‚ç‚¹ç®—åŠ›è¶…è¿‡å…¨ç½‘å…¶å®ƒèŠ‚ç‚¹ç®—åŠ›ï¼Œå¦‚æœByzantium èŠ‚ç‚¹åœ¨è‡ªå·±æŒ–å‡ºçš„åŒºå—ä¸Šç»§ç»­æŒ–çŸ¿ä¸”ä¸å…¬å¸ƒå¹¿æ’­ï¼Œåˆ™ByzantiumèŠ‚ç‚¹ä¸Šæ²¡å…¬å¸ƒçš„åŒºå— é•¿åº¦ï¼Œä¼šå¤§äºå…¨ç½‘åŒºå—é•¿åº¦ï¼›ä¸€æ—¦ByzantiumèŠ‚ç‚¹å…¬å¸ƒè¿™äº›åŒºå—ï¼Œåˆ™å…¨ç½‘å…¶å®ƒèŠ‚ç‚¹æŒ– å‡ºçš„åŒºå—å…¨éƒ¨ä½œåºŸã€‚ å¯è§ï¼ŒåŒºå—è®¾è®¡è¿‡å¤§ï¼Œä¼šå¨èƒåˆ°æ¯”ç‰¹å¸çš„å®‰å…¨ã€‚æ¢å¥è¯è¯´ï¼Œæ¯”ç‰¹å¸åŒºå—çš„å¤§å°æ˜¯æœ‰ä¸Šé™çš„ï¼Œã€ŠOn Scaling Decentralized Blockchainã€‹è¿™ç¯‡è®ºæ–‡æŒ‡å‡ºï¼Œåœ¨ç›®å‰çš„äº’è”ç½‘ç¯å¢ƒä¸‹ï¼Œå¦‚æœååˆ†é’Ÿäº§ç”Ÿä¸€ä¸ªåŒºå—ï¼ŒåŒºå—çš„å¤§å°æœ€å¥½ä¸èƒ½è¶…è¿‡4MBã€‚è¿™æ ·çœ‹æ¥ï¼Œå¢åŠ åŒºå—å¤§å°è¿™ç§æ‰©å®¹æ–¹æ¡ˆï¼Œæ•ˆæœå°±ååˆ†æœ‰é™äº†ã€‚ æ‰©å®¹æ–¹æ¡ˆäºŒ: éš”ç¦»è§è¯ + é—ªç”µç½‘ç»œéš”ç¦»è§è¯ä¸ºä»€ä¹ˆèƒ½æ‰©å®¹å‘¢ï¼Ÿå…ˆæ¥çœ‹çœ‹æ¯”ç‰¹å¸åŒºå—çš„æ•°æ®ç»“æ„ï¼š æ¯ç¬”äº¤æ˜“å¹³å‡250å­—èŠ‚ï¼Œè§è¯éƒ¨åˆ†çš„æ•°æ®çº¦ä¸º150å­—èŠ‚ï¼Œå…¶ä½™éƒ¨åˆ†100å­—èŠ‚ã€‚å¦‚æœå°†è§è¯æ•°æ®éš”ç¦»å‡ºæ¥ï¼ŒåŸæ¥1MBç©ºé—´çš„åŒºå—å¯ä»¥æ”¾ä¸‹10000ç¬”äº¤æ˜“ï¼ˆåŸæ¥ä¸º4000ç¬”ï¼‰ï¼Œäº¤æ˜“é€Ÿåº¦çº¦æå‡2.5å€ã€‚éš”ç¦»å‡ºæ¥çš„è§è¯æ•°æ®æ”¾åˆ°äº†åŒºå—æœ«å°¾ï¼Œå¤§å°ä¸º1.5åˆ°2MBï¼Œæ‰€ä»¥éš”ç¦»è§è¯çš„æ•´ä¸ªåŒºå—å¤§å°ä¸º2.5åˆ°3MBå·¦å³ã€‚ éš”ç¦»è§è¯çš„æ„ä¹‰: è§£å†³äº†äº¤æ˜“å»¶å±•æ€§é—®é¢˜ï¼› ä¸ºé—ªç”µç½‘ç»œé“ºè·¯ å…¶ä»–ä¼˜åŒ– äº¤æ˜“å»¶å±•æ€§ ä¸­æœ¬èªåœ¨è®¾è®¡æ¯”ç‰¹å¸çš„æ—¶å€™ç›´æ¥æŠŠè¿™ä¸¤ä¸ªä¿¡æ¯ç›´æ¥æ”¾åœ¨äº†åŒºå—å†…ï¼Œæ‰€ä»¥ä¸€ä¸ªåŒºå—å°±æ‰¿è½½ä¸äº†æ›´å¤šçš„äº¤æ˜“ä¿¡æ¯ï¼Œå¦‚æœéš”ç¦»äº†â€œè§è¯ä¿¡æ¯â€ï¼Œé‚£ä¹ˆåŒºå—é“¾åªè®°å½•äº¤æ˜“ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸€ä¸ªåŒºå—å¯æ‰¿è½½çš„äº¤æ˜“æ›´å¤šäº¤æ˜“ã€‚ä¸­æœ¬èªè®¾è®¡æ¯”ç‰¹å¸æ—¶ï¼Œå¹¶æ²¡æœ‰æŠŠä¸¤éƒ¨åˆ†èµ„æ–™åˆ†å¼€å¤„ç†ï¼Œå› æ­¤å¯¼è‡´äº¤æ˜“IDçš„è®¡ç®—æ··åˆäº†äº¤æ˜“å’Œè§è¯ã€‚å› ä¸ºè§è¯æœ¬èº«åŒ…æ‹¬ç­¾åï¼Œè€Œç­¾åä¸å¯èƒ½å¯¹å…¶è‡ªèº«è¿›è¡Œç­¾åï¼Œå› æ­¤è§è¯å¯ä»¥ç”±ä»»ä½•äººåœ¨æœªå¾—åˆ°äº¤æ˜“åŒæ–¹åŒæ„çš„æƒ…å†µä¸‹è¿›è¡Œæ”¹å˜ï¼Œé€ æˆæ‰€è°“çš„äº¤æ˜“å¯å¡‘æ€§ï¼ˆmalleabilityï¼‰ã€‚åœ¨äº¤æ˜“å‘å‡ºåã€ç¡®è®¤å‰ï¼Œäº¤æ˜“IDå¯ä»¥è¢«ä»»æ„æ›´æ”¹ï¼Œå› æ­¤åŸºäºæœªç¡®è®¤äº¤æ˜“çš„äº¤æ˜“æ˜¯ç»å¯¹ä¸å®‰å…¨çš„ã€‚åœ¨2014å¹´å°±æ›¾æœ‰äººåˆ©ç”¨è¿™ä¸ªæ¼æ´å¤§è§„æ¨¡æ”»å‡»æ¯”ç‰¹å¸ç½‘ç»œã€‚ æŒ‡çš„æ˜¯ä¸€ç¬”äº¤æ˜“å‘èµ·åï¼Œäº¤æ˜“æ•°æ®ä¸­çš„è§è¯éƒ¨åˆ†å¯ä»¥è¢«ç¯¡æ”¹ï¼Œè€Œä¸”ç¯¡æ”¹åçš„äº¤æ˜“ä»ç„¶æœ‰æ•ˆã€‚å…·ä½“çš„è¯´ï¼Œè§è¯çš„å®ç°ä¾é ä¸€ç§ç­¾åç®—æ³•ï¼Œæ¯”å¦‚æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼ˆECDSAï¼‰ï¼Œè¿™ç§ç®—æ³•ä¸‹ç­¾åï¼ˆrï¼Œsï¼‰å’Œç­¾åï¼ˆrï¼Œ-sï¼ˆmod nï¼‰ï¼‰éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œæ‰€ä»¥å¯ä»¥æŠŠä¸€ç§æœ‰æ•ˆè§è¯æ•°æ®ç¯¡æ”¹æˆå¦ä¸€ç§æœ‰æ•ˆè§è¯æ•°æ®ï¼Œè¯¥ç¬”äº¤æ˜“ä»ç„¶æ˜¯æœ‰æ•ˆçš„ã€‚æ¯ç¬”äº¤æ˜“æœ‰ä¸ªäº¤æ˜“IDï¼Œäº¤æ˜“IDæ˜¯å¯¹æ•´ä¸ªäº¤æ˜“æ•°æ®çš„Hashå€¼ï¼Œä¸ºè¯¥ç¬”äº¤æ˜“çš„å”¯ä¸€æ ‡è¯†ã€‚é€šè¿‡å¯¹è§è¯æ•°æ®çš„ç¯¡æ”¹ï¼Œå¯ä»¥æ”¹å˜Hashå€¼ï¼Œä»è€Œæ”¹å˜è¯¥ç¬”äº¤æ˜“çš„å”¯ä¸€æ ‡è¯†ã€‚éš”ç¦»è§è¯é€šè¿‡æŠŠè§è¯æ•°æ®éš”ç¦»ç§»å‡ºï¼Œç”Ÿæˆäº¤æ˜“IDæ—¶Hashçš„æ•°æ®ä¸åŒ…æ‹¬è§è¯æ•°æ®ï¼Œå› æ­¤ä¹Ÿå°±æ— æ³•æ”¹å˜äº¤æ˜“IDå€¼ã€‚ ä»æ­¤ä»¥åï¼Œåªæœ‰å‘å‡ºäº¤æ˜“çš„äººæ‰å¯ä»¥æ”¹å˜äº¤æ˜“IDï¼Œæ²¡æœ‰ä»»ä½•ç¬¬ä¸‰æ–¹å¯ä»¥åšåˆ°ã€‚å¦‚æœæ˜¯å¤šé‡ç­¾åäº¤æ˜“ï¼Œå°±åªæœ‰å¤šåç­¾ç½²äººåŒæ„æ‰èƒ½æ”¹å˜äº¤æ˜“IDã€‚è¿™å¯ä»¥ä¿è¯ä¸€è¿ä¸²çš„æœªç¡®è®¤äº¤æ˜“çš„æœ‰æ•ˆæ€§ï¼Œæ˜¯åŒå‘æ”¯ä»˜é€šé“æˆ–é—ªç”µç½‘ç»œæ‰€å¿…é¡»çš„åŠŸèƒ½ã€‚æœ‰äº†åŒå‘æ”¯ä»˜é€šé“æˆ–é—ªç”µç½‘ç»œï¼ŒäºŒäººæˆ–å¤šäººä¹‹é—´å°±å¯ä»¥å®é™…ä¸Šè¿›è¡Œæ— é™æ¬¡äº¤æ˜“ï¼Œè€Œæ— éœ€æŠŠå¤§é‡é›¶ç¢äº¤æ˜“æ”¾åœ¨åŒºå—é“¾ï¼Œå¤§ä¸ºå‡ä½åŒºå—ç©ºé—´å‹åŠ›ã€‚ é—ªç”µç½‘ç»œ é€šè¿‡å¢åŠ åŒºå—å¤§å°æ— æ³•ä»æ ¹æœ¬ä¸Šè§£å†³æ¯”ç‰¹å¸çš„æ‰©å®¹é—®é¢˜ã€‚é—ªç”µç½‘ç»œé€šè¿‡åœ¨æ¯”ç‰¹å¸åŸºç¡€ä¸Šï¼Œæ„å»ºç¬¬äºŒå±‚ç½‘ç»œï¼Œå°†äº¤æ˜“è½¬ç§»åˆ°é“¾ä¸‹çš„æ–¹å¼ï¼Œæ¥å‡è½»å…¬é“¾è´Ÿæ‹…ï¼Œä»¥å®ç°æ‰©å®¹çš„æ•ˆæœã€‚ç›®å‰çœ‹æ¥ï¼Œåœ¨å…¬é“¾åŸºç¡€ä¸Šæ„å»ºåè®®å±‚ç½‘ç»œï¼Œæ˜¯è§£å†³å…¬é“¾æ‹¥å µé—®é¢˜æœ€åˆé€‚ä¹Ÿæ˜¯æœ€æœ‰å‰æ™¯çš„æ–¹æ¡ˆ éš”ç¦»è§è¯æ‰€å¸¦æ¥çš„æ”¹å˜ï¼Œä¸ºé—ªç”µç½‘ç»œçš„å®ç°æä¾›äº†ä¸€äº›ä¾¿åˆ©ï¼Œä¸»è¦æœ‰3ç‚¹ï¼š a.äº¤æ˜“å»¶å±•æ€§çš„è§£å†³ï¼Œè®©äº¤æ˜“æ— æ³•è¢«å¹²æ‰°ï¼Œé—ªç”µç½‘ç»œç™½çš®ä¹¦ä¸­æåˆ°çš„â€œäººè´¨çŠ¶æ€â€ ï¼ˆhostage situationï¼‰ï¼Œå¾—ä»¥é¿å…ï¼› b.åœ¨é€šé“çš„ç”Ÿå‘½å‘¨æœŸä¸Šï¼Œéš”ç¦»è§è¯è®©é—ªç”µç½‘ç»œçš„é€šé“æ°¸ä¹…å¼€å¯æ›´æ–¹ä¾¿å®ç°ï¼› c.è™½ç„¶ä»ç†è®ºä¸Šç³»ç»Ÿæ˜¯å®‰å…¨çš„ï¼Œä½†ç”¨æˆ·è¿˜æ˜¯è¦æŸ¥çœ‹åŒºå—é“¾ä¸­çš„äº¤æ˜“æ˜¯å¦å¹¿æ’­æ’¤å›ï¼Œé˜²æ­¢äº¤æ˜“æ–¹çš„æ¬ºè¯ˆè¡Œä¸ºï¼Œéš”ç¦»è§è¯ä½¿å¾—è¿™é¡¹æ´»åŠ¨å¯ä»¥å¤–åŒ…å‡ºå»ï¼Œåªè¦ç»™æœåŠ¡å™¨ä¼ é€å°‘é‡ä¿¡æ¯ï¼Œ å°±èƒ½ä»£æ›¿ä½ å®Œæˆè¿™ä¸€è¿‡ç¨‹ã€‚ d.æ­¤å¤–ï¼Œéš”ç¦»è§è¯ç»™æ¯”ç‰¹å¸å¸¦æ¥äº†ä¸€äº›ç»†èŠ‚ä¼˜åŒ–ï¼Œæ¯”å¦‚å¢åŠ äº†è„šæœ¬ç‰ˆæœ¬ï¼ˆScript Versionï¼‰ï¼Œä½¿å¾—è„šæœ¬è¯­è¨€å¯ä»¥ä»¥ä¸€ç§å‘åå…¼å®¹çš„æ–¹å¼æ¥å‘å±•ï¼›ç­¾åç®—æ³•å¤æ‚åº¦æœ‰äº†è¾ƒå¤§ä¼˜åŒ–ç­‰ç­‰ã€‚ æ¯”ç‰¹å¸çš„ç¼ºé™·æ¯”ç‰¹å¸çš„ç¼ºé™· äº¤æ˜“ç¡®è®¤æ—¶é—´é•¿ï¼Œååé‡ä½ POWæŒ–çŸ¿æµªè´¹è®¡ç®—èµ„æº ASICçŸ¿æœºå‡ºç°æ˜¯å…¨æ°‘å‚ä¸æ€§é™ä½ï¼Œç®—åŠ›é›†ä¸­ ä¸å®Œå…¨åŒ¿å æ— æ³•å­˜å‚¨å¤ªå¤šçš„æ•°å­—èµ„äº§ ä¸æ”¯æŒå¤æ‚çš„è„šæœ¬è¯­è¨€ ç¼©çŸ­äº¤æ˜“æ—¶é—´çš„æ–¹æ³• ç¼©çŸ­å¹³å‡äº§ç”ŸåŒºå—çš„æ—¶é—´ ä¸­å¿ƒåŒ–æœåŠ¡ ä¿¡ä»»åœ°å€å¤šé‡ç­¾å å¼€æ”¾äº¤æ˜“å’Œè”åˆæœåŠ¡å™¨ POSå’ŒDPOS Segwitä¸é—ªç”µç½‘ç»œ]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>åŒºå—é“¾æ¦‚å¿µ</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¾›åº”é“¾é‡‘èçš„ç—›ç‚¹]]></title>
    <url>%2F2019%2F01%2F19%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2F%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%2F%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%9A%84%E7%97%9B%E7%82%B9%2F</url>
    <content type="text"><![CDATA[ä¾›åº”é“¾çš„ä»‹ç»ä»€ä¹ˆæ˜¯ä¾›åº”é“¾é‡‘èï¼Ÿ ä¾›åº”é“¾é‡‘èæ˜¯æŒ‡å°†ä¾›åº”é“¾ä¸Šçš„æ ¸å¿ƒä¼ä¸šä»¥åŠä¸å…¶ç›¸å…³çš„ä¸Šä¸‹æ¸¸ä¼ä¸šçœ‹åšä¸€ä¸ªæ•´ä½“ï¼Œä»¥æ ¸å¿ƒä¼ä¸šä¸ºä¾æ‰˜ï¼Œä»¥çœŸå®çš„è´¸æ˜“ä¸ºå‰æï¼Œè¿ç”¨è‡ªå¿æ€§è´¸æ˜“èèµ„çš„æ–¹å¼ï¼Œå¯¹ä¾›åº”é“¾ä¸Šä¸‹æ¸¸ä¼ä¸šæä¾›çš„ç»¼åˆæ€§é‡‘èäº§å“æœåŠ¡ã€‚ æ ¹æ®èèµ„æ‹…ä¿å“çš„ä¸åŒï¼Œé‡‘èæœºæ„å°†ä¾›åº”é“¾é‡‘èåˆ†ä¸ºåº”æ”¶è´¦æ¬¾ç±»ã€é¢„ä»˜ç±»å’Œå­˜è´§ç±»èèµ„ï¼Œå…¶ä¸­åº”æ”¶è´¦æ¬¾ç±»çš„è§„æ¨¡å°¤ä¸ºå·¨å¤§ã€‚ ä¾›åº”é“¾é‡‘èç—›ç‚¹1. ä¾›åº”é“¾ä¸Šçš„ä¸­å°ä¼ä¸šèèµ„éš¾ä¾›åº”é“¾ä¸Šçš„ä¸­å°ä¼ä¸šèèµ„éš¾ï¼Œæˆæœ¬é«˜ã€‚ç”±äºé“¶è¡Œä¾èµ–çš„æ˜¯æ ¸å¿ƒä¼ä¸šçš„æ§è´§èƒ½åŠ›å’Œè°ƒèŠ‚é”€å”®èƒ½åŠ›ï¼Œå‡ºäºé£æ§çš„è€ƒè™‘ï¼Œé“¶è¡Œä»…æ„¿æ„å¯¹æ ¸å¿ƒä¼ä¸šæœ‰ ç›´æ¥ï¼Œåº”ä»˜è´¦æ¬¾ä¹‰åŠ¡çš„ä¸Šæ¸¸ä¾›åº”å•†(ä»…é™äºä¸€çº§ä¾›åº”å•†)æä¾›ä¿ç†æœåŠ¡ï¼Œæˆ–è€…å¯¹å…¶ä¸‹æ¸¸ç»é”€å•†ï¼ˆä¸€çº§ç»é”€å•†ï¼‰ï¼Œæä¾›é¢„ä»˜æ¬¾æˆ–è€…å­˜è´§èèµ„ã€‚ è¿™å°±å¯¼è‡´æœ‰å·¨å¤§èèµ„éœ€æ±‚çš„äºŒçº§ã€ä¸‰çº§ç­‰ä¾›åº”å•†/ç»é”€å•†éœ€æ±‚å¾—ä¸åˆ°æ»¡è¶³ï¼Œä¾›åº”é“¾é‡‘èçš„ä¸šåŠ¡é‡å—åˆ°é™åˆ¶ï¼Œè€Œä¸­å°ä¼ä¸šå¾—ä¸åˆ°åŠæ—¶çš„èèµ„æ˜“å¯¼è‡´äº§å“è´¨é‡é—®é¢˜ï¼Œä¼šä¼¤å®³åˆ°æ•´ä¸ªä¾›åº”é“¾ä½“ç³»ã€‚ åŒºå—é“¾è§£å†³æ–¹æ³• æˆ‘ä»¬åœ¨åŒºå—é“¾ä¸Šå‘è¡Œï¼Œè¿è¡Œä¸€ç§æ•°å­—ç¥¨æ®ï¼Œå¯ä»¥åœ¨å…¬å¼€é€æ˜ã€å¤šæ–¹è§è¯çš„æƒ…å†µä¸‹è¿›è¡Œéšæ„çš„æ‹†åˆ†å’Œè½¬ç§»ã€‚ è¿™ç§æ¨¡å¼ç›¸å½“äºæŠŠæ•´ä¸ªå•†ä¸šä½“ç³»ä¸­çš„ä¿¡ç”¨å°†å˜å¾—å¯ä¼ å¯¼ã€å¯è¿½æº¯ï¼Œä¸ºå¤§é‡åŸæœ¬æ— æ³•èèµ„çš„ä¸­å°ä¼ä¸šæä¾›äº†èèµ„æœºä¼šï¼Œæå¤§åœ°æé«˜ç¥¨æ®çš„æµè½¬æ•ˆç‡å’Œçµæ´»æ€§ï¼Œé™ä½ä¸­å°ä¼ä¸šçš„èµ„é‡‘æˆæœ¬ã€‚ æ®ç»Ÿè®¡ï¼Œè¿‡å»ä¼ ç»Ÿçš„ä¾›åº”é“¾é‡‘èå…¬å¸å¤§çº¦ä»…èƒ½ä¸º15%çš„ä¾›åº”é“¾ä¸Šçš„ä¾›åº”å•†ä»¬ï¼ˆä¸­å°ä¼ä¸šï¼‰æä¾›èèµ„æœåŠ¡ï¼Œè€Œé‡‡ç”¨åŒºå—é“¾æŠ€æœ¯ä»¥åï¼Œ85%çš„ä¾›åº”å•†ä»¬éƒ½èƒ½äº«å—åˆ°èèµ„ä¾¿åˆ©ã€‚ 2. è½¬è®©éš¾åº¦è¾ƒå¤§ä½œä¸ºä¾›åº”é“¾é‡‘èçš„ä¸»è¦èèµ„å·¥å…·ï¼Œç°é˜¶æ®µçš„å•†ä¸šæ±‡ç¥¨ã€é“¶è¡Œæ±‡ç¥¨ä½¿ç”¨åœºæ™¯å—é™ï¼Œè½¬è®©éš¾åº¦è¾ƒå¤§ã€‚å•†ä¸šæ±‡ç¥¨çš„ä½¿ç”¨å—é™åˆ¶ä¸ä¼ä¸šçš„ä¿¡èª‰ï¼Œé“¶è¡Œæ±‡ç¥¨è´´ç°çš„åˆ°è´¦æ—¶é—´éš¾ä»¥æŠŠæ§ã€‚åŒæ—¶ï¼Œå¦‚æœè¦æŠŠè¿™äº›æ±‡ç¥¨è¿›è¡Œè½¬è®©ï¼Œéš¾åº¦ä¹Ÿä¸å°ã€‚ å› ä¸ºåœ¨å®é™…é‡‘èæ“ä½œä¸­ï¼Œé“¶è¡Œéå¸¸å…³æ³¨åº”æ”¶è´¦æ¬¾å€ºåˆ¸â€è½¬è®©é€šçŸ¥â€çš„æ³•å¾‹æ•ˆåº”ï¼Œå¦‚æœæ ¸å¿ƒä¼ä¸šæ— æ³•ç­¾å›ï¼Œé“¶è¡Œä¸ä¼šæ„¿æ„æˆä¿¡ã€‚æ®äº†è§£ï¼Œé“¶è¡Œå¯¹äºç­¾ç½²è¿™ä¸ªå€ºåˆ¸â€œè½¬è®©é€šçŸ¥â€çš„æ³•å¾‹æ•ˆåº”å¾ˆè°¨æ…ï¼Œç”šè‡³è¦æ±‚æ ¸å¿ƒä¼ä¸šçš„æ³•äººä»£è¡¨å»é“¶è¡Œå½“é¢ç­¾ç½²ï¼Œæ˜¾ç„¶è¿™ç§æ–¹å¼æ“ä½œéš¾åº¦æ˜¯æå¤§çš„ã€‚ åŒºå—é“¾è§£å†³æ–¹æ¡ˆ: é“¶è¡Œä¸æ ¸å¿ƒä¼ä¸šä¹‹é—´å¯ä»¥æ‰“é€ ä¸€ä¸ªè”ç›Ÿé“¾ï¼Œæä¾›ç»™ä¾›åº”é“¾ä¸Šçš„æ‰€æœ‰æˆå‘˜ä¼ä¸šä½¿ç”¨ï¼Œåˆ©ç”¨åŒºå—é“¾å¤šæ–¹ç­¾åã€ä¸å¯ç¯¡æ”¹çš„ç‰¹ç‚¹ï¼Œä½¿å¾—å€ºæƒè½¬è®©å¾—åˆ°å¤šæ–¹å…±è¯†ï¼Œé™ä½æ“ä½œéš¾åº¦ã€‚ å½“ç„¶ï¼Œç³»ç»Ÿè®¾è®¡è¦èƒ½è¾¾åˆ°å€ºåˆ¸è½¬è®©çš„æ³•å¾‹é€šçŸ¥æ•ˆæœã€‚åŒæ—¶ï¼Œé“¶è¡Œè¿˜å¯ä»¥è¿½æº¯æ¯ä¸ªèŠ‚ç‚¹çš„äº¤æ˜“ï¼Œå‹¾ç”»å‡ºå¯è§†æ€§çš„äº¤æ˜“æµç¨‹å›¾ã€‚ 3. ç³»ç»Ÿéš¾ä»¥è‡ªè¯æ¸…ç™½ä¾›åº”é“¾é‡‘èå¹³å°/æ ¸å¿ƒä¼ä¸šç³»ç»Ÿéš¾ä»¥è‡ªè¯æ¸…ç™½ï¼Œå¯¼è‡´èµ„é‡‘ç«¯é£æ§æˆæœ¬å±…é«˜ä¸ä¸‹ã€‚ ç›®å‰çš„ä¾›åº”é“¾é‡‘èä¸šåŠ¡ä¸­ï¼Œé“¶è¡Œæˆ–å…¶ä»–èµ„é‡‘ç«¯é™¤äº†æ‹…å¿ƒä¼ä¸šçš„è¿˜æ¬¾èƒ½åŠ›å’Œè¿˜æ¬¾æ„æ„¿ä»¥å¤–ï¼Œä¹Ÿå¾ˆæ‹…å¿ƒäº¤æ˜“ä¿¡æ¯æœ¬èº«çš„çœŸå®æ€§ï¼Œè€Œäº¤æ˜“ä¿¡æ¯æ˜¯ç”±æ ¸å¿ƒä¼ä¸šçš„ERPç³»ç»Ÿæ‰€è®°å½•çš„ã€‚ è™½ç„¶ERPç¯¡æ”¹éš¾åº¦å¤§ï¼Œä½†æ˜¯ä¹Ÿå¹¶éç»å¯¹å¯ä¿¡ï¼Œé“¶è¡Œä¾ç„¶æ‹…å¿ƒæ ¸å¿ƒä¼ä¸šå’Œä¾›åº”å•†/ç»é”€å•†å‹¾ç»“ç¯¡æ”¹ä¿¡æ¯ï¼Œå› è€Œéœ€è¦æŠ•å…¥äººåŠ›ç‰©åŠ›å»éªŒè¯äº¤æ˜“çš„çœŸä¼ªï¼Œè¿™å°±å¢åŠ äº†é¢å¤–çš„é£æ§æˆæœ¬ã€‚ åŒºå—é“¾è§£å†³æ–¹æ¡ˆ: åŒºå—é“¾ä½œä¸ºâ€œä¿¡ä»»çš„æœºå™¨â€ï¼Œå…·æœ‰å¯æº¯æºã€å…±è¯†å’Œå»ä¸­å¿ƒåŒ–çš„ç‰¹æ€§ï¼Œä¸”åŒºå—é“¾ä¸Šçš„æ•°æ®éƒ½å¸¦æœ‰æ—¶é—´æˆ³ï¼Œå³ä½¿æŸä¸ªèŠ‚ç‚¹çš„æ•°æ®è¢«ä¿®æ”¹ï¼Œä¹Ÿæ— æ³•åªæ‰‹é®å¤©ï¼Œå› è€ŒåŒºå—é“¾èƒ½å¤Ÿæä¾›ç»å¯¹å¯ä¿¡çš„ç¯å¢ƒï¼Œå‡å°‘èµ„é‡‘ç«¯çš„é£æ§æˆæœ¬ï¼Œè§£å†³é“¶è¡Œå¯¹äºè¢«ä¿¡æ¯ç¯¡æ”¹çš„ç–‘è™‘ã€‚ åŒºå—é“¾ + ä¾›åº”é“¾é‡‘è (åº”æ”¶è´¦æ¬¾)ä¾›åº”é“¾é‡‘èéœ€æ±‚éœ€è¦ä¾›åº”é“¾çš„è¡Œä¸šåœ¨ä¾›åº”é“¾é‡‘èæ–¹é¢ï¼Œå…¸å‹çš„å®¢æˆ·ä¸åªæ˜¯é‡‘èä¼ä¸šï¼Œæ¯”å¦‚è¯´é“¶è¡Œï¼›ä¹ŸåŒ…æ‹¬äº§ä¸šçš„é¾™å¤´ï¼Œæ¯”å¦‚ç‰©æµè¡Œä¸šçš„é¡ºä¸°ã€‚æ ¸å¿ƒä¼ä¸šåªè¦æœ‰ä¸Šä¸‹æ¸¸ï¼Œä¾›åº”å•†å’Œç»é”€å•†éƒ½ä¼šæœ‰å¤æ‚äº¤æ˜“çš„é—®é¢˜ï¼Œè¿™äº›å…¬å¸å…¶å®æ˜¯æœ€éœ€è¦åŒºå—é“¾ä¾›åº”é“¾é‡‘èçš„ã€‚ åŒºå—é“¾é€‚åˆçš„ä¼ä¸š éœ€è¦å¤šæ–¹å‚ä¸çš„å¤æ‚äº¤æ˜“ï¼Œå¹¶ä¸”éœ€è¦æ–¹ä¾¿å¿«é€Ÿçš„äº¤æ˜“ éœ€è¦æ–¹ä¾¿çš„è¿›è¡Œè´¦æœ¬çš„æº¯æº ä¸é€‚åˆåŒºå—é“¾çš„ä¼ä¸šä»¥é“¶è¡Œè´¦æˆ·ä¸ºä¾‹ æœ¬èº«ä¸éœ€è¦å¿«é€Ÿï¼Œæ˜¯é€šè¿‡å„ç§æœºæ„é—´çš„å¯¹è´¦æ¥ç¡®ä¿è´¦æˆ·çš„æ­£ç¡®æ€§ï¼› ä¹Ÿä¸éœ€è¦å¾ˆå¤§çš„æº¯æºï¼Œé™¤éè´¦æˆ·æœ‰é”™ï¼Œé€šè¿‡å¤å¼è®°è´¦æ³•ä¹Ÿå¯ä»¥æº¯æºï¼Œåªæ˜¯æ²¡æœ‰é‚£ä¹ˆæ–¹ä¾¿è€Œå·²ã€‚ åŒºå—é“¾å¯ä»¥è§£å†³ä¾›åº”é“¾é‡‘èçš„é—®é¢˜ ç¥¨æ®çš„æ‹†åˆ†è½¬è®© ç°é˜¶æ®µçš„èèµ„å·¥èµ„æ™®éæ˜¯å•†ä¸šè´´ç°ç¥¨æ®ï¼Œå’Œåº”æ”¶è´¦æ¬¾ä¸åŒçš„æ˜¯ï¼Œåº”æ”¶è´¦æ¬¾æ˜¯æœ‰æ ¸å¿ƒä¼ä¸šæ¥ç­¾å‘çš„ï¼Œå•†ä¸šè´´ç°ç¥¨æ®æ˜¯æœ‰é“¶è¡Œæ¥ç­¾å‘çš„ï¼Œå¹¶ä¸”å•†ä¸šè´´ç°ç¥¨æ®æ˜¯ä¸èƒ½æ‹†åˆ†çš„ã€‚åº”æ”¶è´¦æ¬¾çš„æƒ…å†µæ›´é€‚åˆ1+Nçš„ä¾›åº”é“¾é‡‘èæ¨¡å¼ï¼Œå°±æ˜¯ä¸€ä¸ªæ ¸å¿ƒä¼ä¸šå¸¦æ¥Nä¸ªå°ä¼ä¸šã€‚ ç°åœ¨ï¼Œé€šè¿‡åŒºå—é“¾æŠ€æœ¯ï¼Œè®°å½•æ‹†åˆ†çš„åŠ¨ä½œï¼Œå¹¶é€šè¿‡ç­¾åæŠ€æœ¯ï¼Œèƒ½å¤Ÿå®ç°ç¥¨æ®çš„æ‹†åˆ†ï¼Œå¹¶ä¸”å¯ä»¥è®©äº¤æ˜“æ›´åŠ è¿…é€Ÿã€‚ åº”æ”¶è´¦æ¬¾çš„æº¯æº é€šè¿‡åŒºå—é“¾è´¦æœ¬çš„è®°è´¦åŠŸèƒ½å’Œä¸å¯ç¯¡æ”¹çš„ç‰¹æ€§ï¼Œå¯ä»¥è®©åº”æ”¶è´¦æ¬¾å¯ä»¥å®ç°å¿«é€Ÿçš„æº¯æºåŠŸèƒ½ã€‚ é€šè¿‡åŒºå—é“¾æŠ€æœ¯èƒ½å¤Ÿè®©ä¾›åº”é“¾é‡‘èè¿è¡Œçš„æ›´åŠ å¿«é€Ÿç¥¨æ®å¯æ‹†åˆ†å’Œå¯æº¯æºï¼Œè´·æ¬¾çš„éœ€æ±‚å°±å¯ä»¥æ—ºç››èµ·æ¥ é€šè¿‡åŒºå—é“¾çš„ä¸å¯ç¯¡æ”¹çš„ç‰¹æ€§ï¼Œå¯ä»¥è®©ä¾›åº”é“¾é‡‘èçš„ç¥¨æ®å®ç°å®‰å…¨å¿«é€Ÿçš„æ‹†åˆ†è½¬è®©ï¼Œå¹¶ä¸”å¯æº¯æºï¼Œå¯ä»¥è§£å†³éƒ¨åˆ†ä¾›åº”é“¾çš„å°ä¼ä¸šèèµ„å’Œè½¬è®©éš¾åº¦å¤§çš„é—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯è§£å†³ä¸äº†æ•°æ®æºå¤´å»ä¼ªçš„é—®é¢˜ï¼Œå³è¿˜æ˜¯è§£å†³ä¸äº†ç³»ç»Ÿæ•°æ®æºå¤´çš„æ¸…ç™½ï¼Œè¿™éƒ¨åˆ†ç—›ç‚¹å¯ä»¥ä¾é ç‰©æ–™ç½‘æ¥è§£å†³ã€‚ å¦‚ä½•åº”ç”¨åŒºå—é“¾åˆ‡å…¥ä¾›åº”é“¾é‡‘èåœ¨å¸‚åœºé€‰æ‹©ä¸Šï¼ŒåŒºå—é“¾åˆåˆ›å…¬å¸åº”é€‰æ‹©å¤©èŠ±æ¿è¶³å¤Ÿé«˜çš„ç»†åˆ†é¢†åŸŸï¼Œæ¯”å¦‚å®¶ç”µã€æ±½è½¦é›¶å”®ã€æœè£…ã€è¯å“è¡Œä¸šç­‰ã€‚ åˆ‡å…¥åŒºå—é“¾é‡‘èçš„ä¸¤ç§æ¨¡å¼1. ç›´æ¥ä¸æ ¸å¿ƒä¼ä¸š/å¹³å°åˆä½œç›´æ¥ä¸æ ¸å¿ƒä¼ä¸š/å¹³å°åˆä½œï¼Œä¸ºå…¶æä¾›åŒºå—é“¾åº•å±‚çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨ç§¯ç´¯è¶³å¤Ÿå¤šæ•°æ®ä¹‹åï¼Œé€šè¿‡æ­å»ºè”ç›Ÿé“¾ï¼Œå¯¹æ¥èµ„é‡‘æ–¹æä¾›é‡‘èæœåŠ¡ã€‚(è”ç›Ÿé“¾æ¨¡å¼) ç”±äºåŒºå—é“¾æœ¬èº«ä¸èƒ½è§£å†³é£æ§é—®é¢˜ï¼Œç°é˜¶æ®µä¼ä¸šçº§çš„é£æ§è¿˜æ˜¯éœ€è¦å›´ç»•ç€å¼ºåŠ¿çš„æ ¸å¿ƒä¼ä¸šï¼ŒåŒæ—¶ï¼Œè·å¾—æ ¸å¿ƒä¼ä¸šçš„æ”¯æŒè¿˜å¯ä»¥æœ‰æ•ˆè§£å†³è·å®¢é—®é¢˜ï¼Œå› ä¸ºä¸€å®¶å¤§å‹æ ¸å¿ƒä¼ä¸šä¸€èˆ¬éƒ½ä¼šæœ‰ä¸Šåƒå®¶çš„å„ç±»ä¾›åº”å•†ã€‚ 2. ç¬¬äºŒç§æ–¹å¼æ˜¯ä»ä¾›åº”é“¾ç®¡ç†æœåŠ¡å…¥æ‰‹æ¯”å¦‚æº¯æºã€è¿½è¸ªã€å¯è§†åŒ–ç­‰ï¼Œå°†ä¿¡æ¯æµã€ç‰©æµå’Œèµ„é‡‘æµæ•´åˆåˆ°ä¸€èµ·ï¼Œåœ¨æ­¤åŸºç¡€ä¹‹ä¸Šä»äº‹é‡‘èæœåŠ¡ã€‚(ç§æœ‰é“¾æ¨¡å¼) è¿™ç§æ¨¡å¼ç›¸å½“äºåŒå»çœ‹è¿æ­å»ºèµ·äº†ä¸€ä¸ª åº”ç”¨åœºæ™¯ã€‚ æ‰“é€ ä¾›åº”é“¾é‡‘èäº¤æ˜“æ‰€æ­¥éª¤ å‰æï¼Œ æˆ‘ä»¬éœ€è¦å…ˆæ‰“é€ ä¸€ä¸ªåŒºå—é“¾+ä¾›åº”é“¾é‡‘èçš„è”ç›Ÿï¼Œè”ç›Ÿçš„å‚ä¸è€…åŒ…æ‹¬ä¾›åº”é“¾é‡‘èå¹³å°ï¼Œæ ¸å¿ƒä¼ä¸šã€ä¸“ä¸šçš„é‡‘èä¸­ä»‹æœºæ„ã€èµ„é‡‘æ–¹ã€ä¿ç†æœºæ„ç­‰ã€‚ æ¯ä¸ªå‚ä¸è€…éƒ½éœ€è¦æ‰¿æ‹…ç›¸åº”çš„ä¹‰åŠ¡ï¼Œæ¯”å¦‚å¹³å°è´Ÿè´£æä¾›ä¾›åº”é“¾ä¿¡æ¯ï¼Œå®¢æˆ·ä¿¡æ¯è¿™äº›ç±»ä¼¼æ°´ç”µçš„åŸºç¡€æœåŠ¡ï¼Œè€Œæ ¸å¿ƒä¼ä¸šäº†è§£è¡Œä¸šçŠ¶å†µï¼Œå¯¹ä¾›åº”é“¾ä¸Šçš„ä¼ä¸šå…·æœ‰æŒæ§åŠ›ï¼Œè´Ÿè´£é£é™©æ§åˆ¶ã€‚ ä¸“ä¸šçš„é‡‘èä¸­ä»‹æœºæ„å¯ä»¥å¯¹å¹³å°ä¿¡æ¯è¿›è¡Œæ•´åˆåˆ†æï¼Œæä¾›å®šåˆ¶åŒ–çš„ä¾›åº”é“¾é‡‘èäº§å“ï¼Œæ¯”å¦‚ä¸ªæ€§åŒ–çš„åŒºå—é“¾ç”µå­ç¥¨æ®ã€‚èµ„é‡‘æ–¹åŒ…æ‹¬é“¶è¡Œã€äº’è”ç½‘é‡‘èæœºæ„ç­‰è´Ÿè´£å¯¹æ¥ç›¸åº”é£é™©åå¥½çš„å®¢æˆ·ã€‚ 1. æ•°æ®ä¸Šé“¾å°†ä¾›åº”é“¾è”ç›Ÿé‡Œçš„æ•°æ®æ”¾åˆ°é“¾ä¸Šï¼Œåˆ©ç”¨åŒºå—é“¾çš„ç‰¹æ€§ä½¿å…¶ä¸å¯ç¯¡æ”¹ï¼Œå¹¶æä¾›æ•°æ®çš„ç¡®æƒï¼Œæº¯æºç­‰æœåŠ¡ã€‚ 2. èµ„äº§æ•°å­—åŒ–å°†èµ„äº§æ•°å­—åŒ–ï¼ŒæŠŠä»“å•ã€åˆåŒã€ä»¥åŠè¯¾ä»£è¡¨èèµ„éœ€æ±‚çš„åŒºå—é“¾ç¥¨æ®éƒ½å˜ä¸ºæ•°å­—èµ„äº§ï¼Œä¸”å…·æœ‰å”¯ä¸€ã€ä¸å¯ç¯¡æ”¹ã€ä¸å¯å¤åˆ¶ç­‰ç‰¹ç‚¹ã€‚ 3. æ•°å­—èµ„äº§çš„äº¤æ˜“æ•°å­—èµ„äº§çš„äº¤æ˜“ï¼Œä¾›åº”é“¾é‡‘èå¹³å°å°†è½¬å˜æˆä¸€ä¸ªé‡‘èèµ„äº§äº¤æ˜“æ‰€ï¼Œå°†éæ ‡çš„ä¼ä¸šè´·æ¬¾éœ€æ±‚è½¬å˜ä¸ºæ ‡å‡†åŒ–çš„é‡‘èäº§å“ï¼Œè¿›è¡Œä»£å¸åŒ–ï¼Œå¯¹æ¥æŠ•èèµ„éœ€æ±‚ï¼Œè¿›è¡Œä»·å€¼äº¤æ˜“ã€‚ æœ€ç»ˆï¼ŒåŒºå—é“¾æŠ€æœ¯å°†èƒ½æœ‰æ•ˆåœ°å¢å¼ºä¾›åº”é“¾é‡‘èèµ„äº§çš„æµåŠ¨æ€§ï¼Œè°ƒåŠ¨æ–°å‹çš„èèµ„å·¥å…·å’Œé£æ§ä½“ç³»å¸®åŠ©è¦†ç›–ä¸­å°ä¼ä¸šèèµ„çš„é•¿å°¾å¸‚åœºï¼Œå‚¬ç”Ÿä¾›åº”é“¾é‡‘èæœåŠ¡ã€‚]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>ä¾›åº”é“¾é‡‘è</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>ä¾›åº”é“¾é‡‘è</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¾›åº”é“¾é‡‘èä¸‰ç§æ¨¡å¼]]></title>
    <url>%2F2019%2F01%2F12%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2F%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%2F%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯ä¾›åº”é“¾é‡‘èä¾›åº”é“¾é‡‘èå…¶æœ¬è´¨æ˜¯å¯¹ä¾›åº”é“¾ç»“æ„ç‰¹ç‚¹ã€äº¤æ˜“ç»†èŠ‚çš„æŠŠæ¡ï¼Œå°†æ ¸å¿ƒä¼ä¸šå’Œä¸Šä¸‹æ¸¸ä¼ä¸šè”ç³»åœ¨ä¸€èµ·æä¾›çµæ´»è¿ç”¨çš„é‡‘èäº§å“å’ŒæœåŠ¡çš„ä¸€ç§èèµ„æ¨¡å¼ã€‚ä¹Ÿå°±æ˜¯æŠŠèµ„é‡‘ä½œä¸ºä¾›åº”é“¾çš„ä¸€ä¸ªæº¶å‰‚ï¼Œå¢åŠ å…¶æµåŠ¨æ€§ã€‚ ä¾›åº”é“¾é‡‘èä¿ƒè¿›ä¾›åº”é“¾çš„å‘å±•ä½“ç°åœ¨èµ„é‡‘æ³¨å…¥å’Œä¿¡ç”¨æ³¨å…¥ä¸¤æ–¹é¢ï¼šä¸€æ–¹é¢è§£å†³ç›¸å¯¹å¼±åŠ¿çš„ä¸Šã€ä¸‹æ¸¸é…å¥—ä¸­å°ä¼ä¸šèèµ„éš¾å’Œä¾›åº”é“¾åœ°ä½å¤±è¡¡çš„é—®é¢˜ï¼›å¦ä¸€æ–¹é¢ï¼Œå°†é“¶è¡Œä¿¡ç”¨èå…¥ä¸Šã€ä¸‹æ¸¸é…å¥—ä¼ä¸šï¼Œå®ç°å…¶å•†ä¸šä¿¡ç”¨å¢çº§ï¼Œä¿ƒè¿›é…å¥—ä¼ä¸šä¸æ ¸å¿ƒä¼ä¸šå»ºç«‹èµ·é•¿æœŸæˆ˜ç•¥ååŒå…³ç³»ï¼Œä»è€Œæå‡æ•´ä¸ªä¾›åº”é“¾çš„ç«äº‰èƒ½åŠ›ã€‚ ä¼ ç»Ÿèèµ„æ¨¡å¼ä¸­é“¶è¡Œä¸ä¾›åº”é“¾æˆå‘˜çš„å…³ç³»é“¶è¡Œå›´ç»•æŸä¸€å®¶æ ¸å¿ƒä¼ä¸šï¼Œä»åŸææ–™é‡‡è´­ï¼Œåˆ°æœ€ç»ˆäº§å“ï¼Œæœ€åç”±é”€å”®ç½‘ç»œæŠŠäº§å“é€åˆ°æ¶ˆè´¹è€…æ‰‹ä¸­è¿™ä¸€æ¡ä¾›åº”é“¾ï¼Œå°†ä¾›åº”å•†ã€åˆ¶é€ å•†ã€åˆ†é”€å•†ã€é›¶å”®å•†ç›´åˆ°æœ€ç»ˆç”¨æˆ·è¿æˆä¸€ä¸ªæ•´ä½“ï¼Œå…¨æ–¹ä½çš„ä¸ºé“¾æ¡ä¸Šçš„Nä¸ªä¼ä¸šæä¾›èèµ„æœåŠ¡ï¼Œé€šè¿‡ç›¸å…³ä¼ä¸šçš„èŒèƒ½åˆ†å·¥åˆä½œï¼Œå®ç°æ•´ä¸ªä¾›åº”é“¾çš„ä¸æ–­å¢å€¼ ä¾›åº”é“¾é‡‘èä½¿é“¶è¡Œä»æ–°çš„è§†è§’è¯„ä¼°ä¸­å°ä¼ä¸šçš„ä¿¡ç”¨é£é™©ï¼Œä»ä¸“æ³¨äºå¯¹ä¸­å°ä¼ä¸šæœ¬èº«ä¿¡ç”¨é£é™©çš„è¯„ä¼°ï¼Œè½¬å˜ä¸ºå¯¹æ•´ä¸ªä¾›åº”é“¾åŠå…¶äº¤æ˜“çš„è¯„ä¼°ï¼Œè¿™æ ·æ—¢çœŸæ­£è¯„ä¼°äº†ä¸šåŠ¡çš„çœŸå®é£é™©ï¼ŒåŒæ—¶ä¹Ÿä½¿æ›´å¤šçš„ä¸­å°ä¼ä¸šèƒ½å¤Ÿè¿›å…¥é“¶è¡Œçš„æœåŠ¡èŒƒå›´ã€‚ä¸€æ–¹é¢ï¼Œå°†èµ„é‡‘æœ‰æ•ˆæ³¨å…¥å¤„äºç›¸å¯¹å¼±åŠ¿çš„ä¸Šä¸‹æ¸¸é…å¥—ä¸­å°ä¼ä¸šï¼Œè§£å†³ä¾›åº”é“¾å¤±è¡¡ï¼›å¦ä¸€æ–¹é¢ï¼Œå°†é“¶è¡Œä¿¡ç”¨èå…¥ä¸Šä¸‹æ¸¸ä¼ä¸šçš„è´­é”€è¡Œä¸ºï¼Œå¢å¼ºå…¶å•†ä¸šä¿¡ç”¨ï¼Œæ”¹å–„å…¶è°ˆåˆ¤åœ°ä½ï¼Œä½¿ä¾›åº”é“¾æˆå‘˜æ›´åŠ å¹³ç­‰çš„åå•†å’Œé€æ­¥å»ºç«‹é•¿æœŸæˆ˜ç•¥ååŒå…³ç³»ï¼Œæå‡ä¾›åº”é“¾çš„ç«äº‰èƒ½åŠ›ï¼Œä¿ƒè¿›äº†æ•´ä¸ªä¾›åº”é“¾çš„æŒç»­ç¨³å®šå‘å±•ï¼› ä¾›åº”é“¾é‡‘èçš„ä¸‰ç§æ¨¡å¼ä¸‰ç§åˆ†ç±»ä»‹ç»ä¾›åº”é“¾é‡‘èçš„å®è´¨æ˜¯å¸®åŠ©ä¼ä¸šç›˜æ´»æµåŠ¨èµ„äº§ï¼Œå³åº”æ”¶ã€é¢„ä»˜å’Œå­˜è´§ã€‚å› æ­¤é€šå¸¸å°†äº§å“åˆ†ä¸ºä¸‰ç±»ï¼šåº”æ”¶ç±»ã€é¢„ä»˜ç±»å’Œå­˜è´§ç±»ã€‚ åº”æ”¶ç±» åº”æ”¶ç±»äº§å“å¸®åŠ©ä¸Šæ¸¸ä¼ä¸šå°†åº”æ”¶è´¦æ¬¾è½¬æ¢æˆç°é‡‘æˆ–åº”ä»˜ç¥¨æ®; é¢„ä»˜ç±» é¢„ä»˜ç±»äº§å“åˆ™å¸®åŠ©ä¸‹æ¸¸ä¼ä¸šæ‰©å¤§äº†å•æ¬¡é‡‡è´­é¢ï¼Œæé«˜äº†é‡‡è´­èƒ½åŠ›ï¼Œå°†æœ¬åº”å³æœŸæ”¯å‡ºçš„ç°é‡‘èµ„äº§è½¬æ¢ä¸ºçŸ­æœŸå€Ÿæ¬¾æˆ–åº”ä»˜ç¥¨æ®; å­˜è´§ç±» ç°è´§è´¨æŠ¼æ›´ä¸ºç›´æ¥ï¼Œä»¥ä¼ä¸šçš„å­˜è´§ä½œä¸ºæ‹…ä¿æ–¹å¼ï¼Œæ¢å–æµåŠ¨æ€§æ›´å¼ºçš„ç°é‡‘èµ„äº§ã€‚è™½ç„¶ç°è´§èèµ„é€šå¸¸æ²¡æœ‰æ ¸å¿ƒä¼ä¸šå‚ä¸ï¼Œä½†å› è¯¥ä¸šåŠ¡æ¶‰åŠå¯¹è´§æƒçš„æ§åˆ¶å’Œç‰©æµç›‘ç®¡ä¼ä¸šçš„ç®¡ç†ï¼Œä»ç®¡ç†ä¸Šä¸ä¾›åº”é“¾é‡‘èæµè¡Œçš„é¢„ä»˜æ¬¾æ¸ é“èèµ„ç›¸è¿‘ã€‚ åº”æ”¶è´¦æ¬¾èèµ„ä»¥æœªåˆ°æœŸçš„åº”æ”¶è´¦æ¬¾å‘é‡‘èæœºæ„åŠç†èèµ„çš„è¡Œä¸ºï¼Œç§°ä¸ºåº”æ”¶è´¦æ¬¾èèµ„ï¼Œè¿™ç§æ¨¡å¼ä½¿å¾—ä¼ä¸šå¯ä»¥åŠæ—¶è·å¾—æœºæ„çš„çŸ­æœŸèèµ„ï¼Œä¸ä½†æœ‰åˆ©äºè§£å†³èèµ„ä¼ä¸šçŸ­æœŸèµ„é‡‘çš„éœ€æ±‚ï¼ŒåŠ å¿«ä¸­å°ä¼ä¸šå¥åº·ç¨³å®šçš„å‘å±•å’Œæˆé•¿ï¼Œè€Œä¸”æœ‰åˆ©äºæ•´ä¸ªä¾›åº”é“¾çš„æŒç»­é«˜æ•ˆè¿ä½œã€‚ åº”æ”¶ç±»äº§å“ä¸»è¦åº”ç”¨äºæ ¸å¿ƒä¼ä¸šçš„ä¸Šæ¸¸èèµ„ï¼Œå¦‚æœé”€å”®å·²ç»å®Œæˆï¼Œä½†å°šæœªæ”¶å¦¥è´§æ¬¾ï¼Œåˆ™é€‚ç”¨äº§å“ä¸ºä¿ç†æˆ–åº”æ”¶è´¦æ¬¾è´¨æŠ¼èèµ„;å¦‚èèµ„ç›®çš„æ˜¯ä¸ºäº†å®Œæˆè®¢å•ç”Ÿäº§ï¼Œåˆ™ä¸ºè®¢å•èèµ„ï¼Œæ‹…ä¿æ–¹å¼ä¸ºæœªæ¥åº”æ”¶è´¦æ¬¾è´¨æŠ¼ï¼Œå®è´¨æ˜¯ä¿¡ç”¨èèµ„ã€‚ åº”æ”¶è´¦æ¬¾è´¨æŠ¼èèµ„æ˜¯æ˜¯æŒ‡ä¼ä¸šä¸é“¶è¡Œç­‰é‡‘èæœºæ„ç­¾è®¢åˆåŒã€‚ä»¥åº”æ”¶è´¦æ¬¾ä½œä¸ºè´¨æŠ¼å“ã€‚åœ¨åˆåŒè§„å®šçš„æœŸé™å’Œä¿¡è´·é™é¢æ¡ä»¶ä¸‹ï¼Œé‡‡å–éšç”¨éšæ”¯çš„æ–¹å¼ï¼Œå‘é“¶è¡Œç­‰é‡‘èæœºæ„å–å¾—çŸ­æœŸå€Ÿæ¬¾çš„èèµ„æ–¹å¼ã€‚å…¶ä¸­æ”¾æ¬¾éœ€è¦å‘è´§æ¥å®ç°ç‰©æƒè½¬ç§»ï¼Œä¿ƒä½¿åˆåŒç”Ÿæ•ˆã€‚åŒæ—¶ä¹Ÿéœ€è¦å‘ŠçŸ¥æ ¸å¿ƒä¼ä¸šï¼Œå¾—åˆ°ä¼ä¸šçš„ç¡®æƒã€‚ é£é™©è¦ç‚¹ï¼š åº”åœ¨ã€Šåº”æ”¶è´¦æ¬¾è´¨æŠ¼ç™»è®°å…¬ç¤ºç³»ç»Ÿã€‹å†…ç™»è®°ï¼Œé¿å…é‡å¤è´¨æŠ¼ ä¾›åº”å•†å’ŒåŠ å·¥ä¼ä¸šä¹‹é—´åº”æœ‰é•¿æœŸç¨³å®šè´¸æ˜“å…³ç³» è´§ç‰©åº”æœ‰æ˜ç¡®éªŒæ”¶æ ‡å‡†ï¼Œäº¤å‰²æ ‡å‡†ï¼Œå‡†ç¡®ä»˜æ¬¾ä¾æ® ä¾›åº”å•†å‘è´§åï¼Œé“¶è¡Œæ–¹åº”å®šæœŸã€ä¸å®šæœŸä¸ç”Ÿäº§ä¼ä¸šè¿›è¡Œå¯¹è´¦ æ ¸å¿ƒä¼ä¸šä»˜æ¬¾åº”è½¬å…¥é“¶è¡Œæ–¹ç›‘ç®¡çš„ä¸“ç”¨è´¦æˆ· ä¿ç†å’Œåº”æ”¶è´¦æ¬¾è´¨æŠ¼åŒºåˆ« ä¿ç†ä¸šåŠ¡æ˜¯ä»¥å€ºæƒäººè½¬è®©å…¶åº”æ”¶è´¦æ¬¾ä¸ºå‰æï¼Œé›†åº”æ”¶è´¦æ¬¾å‚¬æ”¶ã€ç®¡ç†ã€åè´¦æ‹…ä¿åŠèèµ„äºä¸€ä½“çš„ç»¼åˆæ€§é‡‘èæœåŠ¡ã€‚ä¸åº”æ”¶è´¦æ¬¾è´¨æŠ¼èèµ„çš„å·®åˆ«æ˜¯ï¼Œä¿ç†æ˜¯ä¸€ç§å€ºæƒçš„è½¬è®©è¡Œä¸ºï¼Œé€‚ç”¨äºã€ŠåˆåŒæ³•ã€‹ï¼Œè€Œåº”æ”¶è´¦æ¬¾è´¨æŠ¼æ˜¯ä¸€ç§ç‰©æƒè½¬è®©è¡Œä¸ºï¼Œé€‚ç”¨äºã€Šç‰©æƒæ³•ã€‹ã€‚é“¶è¡Œæ‹¥æœ‰å¯¹è´§ç‰©ç‰©æƒçš„å¤„ç½®æƒã€‚ ç¥¨æ®æ±  ç¥¨æ®æ± ä¸šåŠ¡æ˜¯é“¶è¡Œä¸€ç§å¸¸è§çš„ä¾›åº”é“¾é‡‘èæœåŠ¡ã€‚ç¥¨æ®æ˜¯ä¾›åº”é“¾é‡‘èä½¿ç”¨æœ€å¤šçš„æ”¯ä»˜å·¥å…·ï¼Œé“¶è¡Œå‘å®¢æˆ·æä¾›çš„ç¥¨æ®æ‰˜ç®¡ã€å§”æ‰˜æ”¶æ¬¾ã€ç¥¨æ®æ± æˆä¿¡ç­‰ä¸€æ½å­ç»“ç®—ã€èèµ„æœåŠ¡ã€‚ç¥¨æ®æ± æˆä¿¡æ˜¯æŒ‡å®¢æˆ·å°†æ”¶åˆ°çš„æ‰€æœ‰æˆ–éƒ¨åˆ†ç¥¨æ®åšæˆè´¨æŠ¼æˆ–è½¬è®©èƒŒä¹¦åï¼Œçº³å…¥é“¶è¡Œæˆä¿¡çš„èµ„äº§æ”¯æŒæ± ï¼Œé“¶è¡Œä»¥ç¥¨æ®æ± ä½™é¢ä¸ºé™å‘å®¢æˆ·æˆä¿¡ã€‚ç”¨äºç¥¨æ®æµè½¬é‡å¤§ã€å¯¹è´¢åŠ¡æˆæœ¬æ§åˆ¶ä¸¥æ ¼çš„ç”Ÿäº§å’Œæµé€šå‹ä¼ä¸šï¼ŒåŒæ ·é€‚ç”¨äºå¯¹è´¢åŠ¡è´¹ç”¨ã€ç»è¥ç»©æ•ˆè¯„ä»·æ•æ„Ÿå¹¶è¿½æ±‚æŠ¥è¡¨ä¼˜åŒ–çš„å¤§å‹ä¼ä¸šã€å›½æœ‰ä¼ä¸šå’Œä¸Šå¸‚å…¬å¸ã€‚ å¯¹å®¢æˆ·è€Œè¨€. ç¥¨æ®æ± ä¸šåŠ¡å°†ç¥¨æ®ä¿ç®¡å’Œç¥¨æ®æ‰˜æ”¶ç­‰å·¥ä½œå…¨éƒ¨å¤–åŒ…ç»™é“¶è¡Œï¼Œå‡å°‘äº†å®¢æˆ·è‡ªå·±ä¿ç®¡å’Œåˆ°æœŸæ‰˜æ”¶ç¥¨æ®çš„å·¥ä½œé‡ã€‚è€Œä¸”ï¼Œç¥¨æ®æ± èèµ„å¯ä»¥å®ç°ç¥¨æ®æ‹†åˆ†ã€ç¥¨æ®åˆå¹¶ã€çŸ­ç¥¨å˜é•¿ç¥¨ç­‰æ•ˆæœï¼Œè§£å†³äº†å®¢æˆ·ç¥¨æ®æ”¶ä»˜è¿‡ç¨‹ä¸­æœŸé™å’Œé‡‘é¢çš„ä¸åŒ¹é…é—®é¢˜ã€‚å¯¹é“¶è¡Œè€Œè¨€ï¼Œé€šè¿‡ç¥¨æ®çš„ä»£ä¿ç®¡æœåŠ¡ï¼Œå¯ä»¥å¸å¼•ç¥¨æ®åˆ°æœŸåè¡ç”Ÿçš„å­˜æ¬¾æ²‰æ·€ã€‚ æœªæ¥æè´§æƒèèµ„æœªæ¥è´§æƒèèµ„ï¼ˆåˆç§°ä¸ºä¿å…‘ä»“èèµ„ï¼‰æ˜¯ä¸‹æ¸¸è´­è´§å•†å‘å¹³å°ç”³è¯·è´·æ¬¾ï¼Œç”¨äºæ”¯ä»˜ä¸Šæ¸¸æ ¸å¿ƒä¾›åº”å•†åœ¨æœªæ¥ä¸€æ®µæ—¶æœŸå†…äº¤ä»˜è´§ç‰©çš„æ¬¾é¡¹ï¼ŒåŒæ—¶ä¾›åº”å•†æ‰¿è¯ºå¯¹æœªè¢«æå–çš„è´§ç‰©è¿›è¡Œå›è´­ï¼Œå¹¶å°†æè´§æƒäº¤ç”±é‡‘èæœºæ„æ§åˆ¶çš„ä¸€ç§èèµ„æ¨¡å¼ã€‚ èèµ„ä¼ä¸šé€šè¿‡ä¿å…‘ä»“ä¸šåŠ¡è·å¾—çš„æ˜¯åˆ†æ‰¹æ”¯ä»˜è´§æ¬¾å¹¶åˆ†æ‰¹æå–è´§ç‰©çš„æƒåˆ©ï¼Œå› è€Œä¸å¿…ä¸€æ¬¡æ€§æ”¯ä»˜å…¨é¢è´§æ¬¾ï¼Œæœ‰æ•ˆç¼“è§£äº†ä¼ä¸šçŸ­æœŸçš„èµ„é‡‘å‹åŠ›ï¼Œå®ç°äº†èèµ„ä¼ä¸šçš„æ æ†é‡‡è´­å’Œä¾›åº”å•†çš„æ‰¹é‡é”€å”®ã€‚ é¢„ä»˜ç±»äº§å“åˆ™ä¸»è¦ç”¨äºæ ¸å¿ƒä¼ä¸šçš„ä¸‹æ¸¸èèµ„ï¼Œå³ä¸»è¦ä¸ºæ ¸å¿ƒä¼ä¸šçš„é”€å”®æ¸ é“èèµ„ï¼ŒåŒ…å«ä¸¤ç§ä¸»è¦ä¸šåŠ¡æ¨¡å¼ï¼š ä¸€æ˜¯ï¼Œé“¶è¡Œç»™æ¸ é“å•†èèµ„ï¼Œé¢„ä»˜é‡‡è´­æ¬¾é¡¹ç»™æ ¸å¿ƒä¼ä¸šï¼Œæ ¸å¿ƒä¼ä¸šå‘è´§ç»™é“¶è¡ŒæŒ‡å®šçš„ä»“å‚¨ç›‘ç®¡ä¼ä¸šï¼Œç„¶åä»“å‚¨ç›‘ç®¡ä¼ä¸šæŒ‰ç…§é“¶è¡ŒæŒ‡ä»¤é€æ­¥æ”¾è´§ç»™å€Ÿæ¬¾çš„æ¸ é“å•†ï¼Œæ­¤å³ä¸ºæ‰€è°“çš„æœªæ¥è´§æƒèèµ„æˆ–è€…å…ˆæ¬¾åè´§èèµ„; äºŒæ˜¯ï¼Œæ ¸å¿ƒä¼ä¸šä¸å†å‘è´§ç»™é“¶è¡ŒæŒ‡å®šçš„ç‰©æµç›‘ç®¡ä¼ä¸šï¼Œè€Œæ˜¯æœ¬èº«æ‰¿æ‹…äº†ç›‘ç®¡èŒèƒ½ï¼ŒæŒ‰ç…§é“¶è¡ŒæŒ‡ä»¤é€æ­¥æ”¾è´§ç»™å€Ÿæ¬¾çš„æ¸ é“å•†ï¼Œæ­¤å³æ‰€è°“çš„ä¿å…‘ä»“ä¸šåŠ¡æ¨¡å¼ã€‚ å…ˆè´§åæ¬¾(æˆ–å…ˆç¥¨åè´§)æ˜¯æŒ‡ä¹°æ–¹ä»é“¶è¡Œå–å¾—æˆä¿¡ï¼Œåœ¨äº¤çº³ä¸€å®šæ¯”ä¾‹ä¿è¯é‡‘çš„å‰æä¸‹ï¼Œå‘å–æ–¹æ”¯ä»˜å…¨é¢è´§æ¬¾;å–æ–¹æŒ‰ç…§è´­é”€åˆåŒä»¥åŠåˆä½œåè®®ä¹¦çš„çº¦å®šå‘è¿è´§ç‰©ï¼Œè´§ç‰©åˆ°è¾¾åè®¾å®šæŠµè´¨æŠ¼ï¼Œä½œä¸ºé“¶è¡ŒæŠ€ä¿¡çš„æ‹…ä¿ã€‚ä¸€äº›çƒ­é”€äº§å“çš„åº“å­˜å¾€å¾€è¾ƒå°‘ï¼Œå› æ­¤ä¼ä¸šçš„èµ„é‡‘éœ€æ±‚é›†ä¸­åœ¨é¢„ä»˜æ¬¾é¢†åŸŸã€‚åŒæ—¶ï¼Œè¯¥äº§å“å› ä¸ºæ¶‰åŠåˆ°å–å®¶åŠæ—¶å‘è´§ã€å‘è´§ä¸è¶³çš„é€€æ¬¾ã€åˆ°è´§é€šçŸ¥åŠåœ¨é€”é£é™©æ§åˆ¶ç­‰ç¯èŠ‚ï¼Œå› æ­¤å®¢æˆ·å¯¹å–å®¶çš„è°ˆåˆ¤åœ°ä½ä¹Ÿæ˜¯æ“ä½œè¯¥äº§å“çš„æ¡ä»¶ä¹‹ä¸€ã€‚ ä¿å…‘ä»“(åˆç§°ä¸ºæ‹…ä¿æè´§æˆä¿¡)æ˜¯åœ¨å®¢æˆ·äº¤çº³ä¸€å®šä¿è¯é‡‘çš„å‰æä¸‹ï¼Œé“¶è¡Œè´·å‡ºé‡‘é¢è´§æ¬¾ä¾›å®¢æˆ·(ä¹°æ–¹)å‘æ ¸å¿ƒä¼ä¸š(å–æ–¹)é‡‡è´­ï¼Œå–æ–¹å‡ºå…·é‡‘é¢æå•ä½œä¸ºæˆä¿¡çš„æŠµè´¨æŠ¼ç‰©ã€‚éšåï¼Œå®¢æˆ·åˆ†æ¬¡å‘é“¶è¡Œæäº¤æè´§ä¿è¯é‡‘ï¼Œé“¶è¡Œå†åˆ†æ¬¡é€šçŸ¥å–æ–¹å‘å®¢æˆ·å‘è´§ã€‚å–æ–¹å°±å‘è´§ä¸è¶³éƒ¨åˆ†çš„ä»·å€¼æ‰¿æ‹…å‘é“¶è¡Œçš„é€€æ¬¾è´£ä»»ã€‚è¯¥äº§å“åˆè¢«ç§°ä¸ºå–æ–¹æ‹…ä¿ä¹°æ–¹ä¿¡è´·æ¨¡å¼ã€‚ ä¿å…‘ä»“æ˜¯åŸºäºç‰¹æ®Šè´¸æ˜“èƒŒæ™¯ï¼Œå¦‚ï¼š1ã€å®¢æˆ·ä¸ºäº†å–å¾—å¤§æ‰¹é‡é‡‡è´­çš„ææ‰£ï¼Œé‡‡å–ä¸€æ¬¡æ€§ä»˜æ¬¾æ–¹å¼ï¼Œè€Œå‚å®¶å› ä¸ºæ’äº§é—®é¢˜æ— æ€¯ä¸€æ¬¡æ€§å‘è´§;2ã€å®¢æˆ·åœ¨æ·¡å­£å‘ä¸Šæ¸¸æ‰“æ¬¾ï¼Œæ”¯æŒä¸Šæ¸¸ç”Ÿäº§æ‰€éœ€çš„æµåŠ¨èµ„é‡‘ï¼Œå¹¶é”å®šä¼˜æƒ çš„ä»·æ ¼ã€‚ç„¶ååœ¨æ—ºå­£åˆ†æ¬¡æè´§ç”¨äºé”€å”®;3ã€å®¢æˆ·å’Œä¸Šæ¸¸éƒ½åœ¨å¼‚åœ°ï¼Œé“¶è¡Œå¯¹åœ¨é€”ç‰©æµå’Œåˆ°è´§åçš„ç›‘æ§ç¼ºä¹æœ‰æ•ˆæ‰‹æ®µã€‚ä¿å…‘ä»“æ˜¯ä¸€é¡¹å¯ä»¥è®©ä¹°æ–¹ã€æ ¸å¿ƒä¼ä¸šå’Œé“¶è¡Œå‡æ”¶ç›Šçš„ä¸šåŠ¡ã€‚ èé€šä»“èèµ„æ‰€è°“èé€šä»“å³å­˜è´§èèµ„ï¼Œæ˜¯ä¼ä¸šä»¥å­˜è´§ä½œä¸ºè´¨æŠ¼å‘é‡‘èæœºæ„åŠç†èèµ„ä¸šåŠ¡çš„è¡Œä¸ºã€‚æ‰€ä»¥èé€šä»“æœåŠ¡ä¸ä»…å¯ä»¥ä¸ºä¼ä¸šæä¾›é«˜æ°´å¹³çš„ç‰©æµæœåŠ¡ï¼Œåˆå¯ä»¥ä¸ºä¸­å°å‹ä¼ä¸šè§£å†³èèµ„é—®é¢˜ï¼Œè§£å†³ä¼ä¸šè¿è¥ä¸­ç°é‡‘æµçš„èµ„é‡‘ç¼ºå£ï¼Œä»¥æé«˜ä¾›åº”é“¾çš„æ•´ä½“ç»©æ•ˆã€‚ å­˜è´§ç±»èèµ„ä¸»è¦åˆ†ä¸ºç°è´§èèµ„å’Œä»“å•èèµ„ä¸¤å¤§ç±»ï¼Œç°è´§è´¨æŠ¼åˆåˆ†ä¸ºé™æ€è´¨æŠ¼å’ŒåŠ¨æ€è´¨æŠ¼ï¼Œä»“å•èèµ„é‡ŒåˆåŒ…å«æ™®é€šä»“å•å’Œæ ‡å‡†ä»“å•ã€‚ é™æ€æŠµè´¨æŠ¼æˆä¿¡æ˜¯æŒ‡å®¢æˆ·ä»¥è‡ªæœ‰æˆ–ç¬¬ä¸‰äººåˆæ³•æ‹¥æœ‰çš„åŠ¨äº§ä¸ºæŠµè´¨æŠ¼ï¼Œé“¶è¡Œå§”æ‰˜ç¬¬ä¸‰æ–¹ç‰©æµå…¬å¸å¯¹å®¢æˆ·æä¾›çš„æŠµè´¨æŠ¼çš„å•†å“å®è¡Œç›‘ç®¡ï¼ŒæŠµè´¨æŠ¼ç‰©ä¸å…è®¸ä»¥è´§æ˜“è´§ï¼Œå®¢æˆ·å¿…é¡»æ‰“æ¬¾èµè´§ã€‚æ­¤é¡¹ä¸šåŠ¡é€‚ç”¨äºé™¤äº†å­˜è´§ä»¥å¤–æ²¡æœ‰å…¶ä»–åˆé€‚çš„æŠµè´¨æŠ¼ç‰©çš„å®¢æˆ·ï¼Œè€Œä¸”å®¢æˆ·çš„è´­é”€æ¨¡å¼ä¸ºæ‰¹é‡è¿›è´§ã€åˆ†æ¬¡é”€å”®ã€‚åˆ©ç”¨è¯¥äº§å“ï¼Œå®¢æˆ·å¾—ä»¥å°†åŸæœ¬ç§¯å‹åœ¨å­˜è´§ä¸Šçš„èµ„é‡‘ç›˜æ´»ï¼Œæ‰©å¤§ç»è¥è§„æ¨¡ã€‚ åŠ¨æ€æŠµè´¨æŠ¼æˆä¿¡æ˜¯é™æ€æŠµè´¨æŠ¼æˆä¿¡çš„å»¶ä¼¸äº§å“â€”â€”å®ƒæ˜¯æŒ‡å®¢æˆ·ä»¥è‡ªæœ‰æˆ–ç¬¬ä¸‰äººåˆæ³•æ‹¥æœ‰çš„åŠ¨äº§ä¸ºæŠµè´¨æŠ¼ï¼Œé“¶è¡Œå¯¹äºå®¢æˆ·æŠµè´¨æŠ¼çš„å•†å“ä»·å€¼è®¾å®šæœ€ä½é™é¢ï¼Œå…è®¸åœ¨é™é¢ä»¥ä¸Šçš„å•†å“å‡ºåº“ï¼Œå®¢æˆ·å¯ä»¥ä»¥è´§æ˜“è´§ã€‚è¯¥äº§å“é€‚ç”¨äºåº“å­˜éšå®šã€è´§ç‰©å“ç±»è¾ƒä¸ºä¸€è‡´ã€æŠµè´¨æŠ¼ç‰©çš„ä»·å€¼æ ¸å®šè¾ƒä¸ºå®¹æ˜“çš„å®¢æˆ·ã€‚åŒæ—¶ï¼Œå¯¹äºä¸€äº›å®¢æˆ·çš„å­˜è´§è¿›å‡ºé¢‡ç¹ï¼Œéš¾ä»¥é‡‡ç”¨é™æ€æŠµè´¨æŠ¼æˆä¿¡çš„æƒ…å†µï¼Œä¹Ÿå¯è¿ç”¨è¿™ç±»äº§å“ã€‚è¯¥äº§å“å¤šç”¨äºç”Ÿäº§å‹å®¢æˆ·ã€‚å¯¹äºå®¢æˆ·è€Œè¨€ï¼Œç”±äºå¯ä»¥ä»¥è´§æ˜“è´§ï¼Œå› æ­¤æŠµè´¨æŠ¼è®¾å®šå¯¹äºç”Ÿäº§ç»è¥æ´»åŠ¨çš„å½±å“ç›¸å¯¹è¾ƒå°ã€‚ç‰¹åˆ«å¯¹äºåº“å­˜ç¨³å®šçš„å®¢æˆ·è€Œè¨€ï¼Œåœ¨åˆç†è®¾å®šæŠµè´¨æŠ¼ä»·å€¼åº•çº¿çš„å‰æä¸‹ï¼Œæˆä¿¡æœŸé—´å†…å‡ ä¹æ— é¡»å¯åŠ¨è¿½åŠ ä¿è¯é‡‘èµè´§çš„æ¢³ç¨‹ï¼Œå› æ­¤å¯¹ç›˜æ´»å­˜è´§çš„ä½œç”¨éå¸¸æ˜æ˜¾ã€‚ ä»“å•è´¨æŠ¼æ˜¯ä»¥ä»“å•ä¸ºæ ‡çš„ç‰©è€Œæˆç«‹çš„ä¸€ç§è´¨æƒã€‚ä»“å•è´¨æŠ¼ä½œä¸ºä¸€ç§æ–°å‹çš„æœåŠ¡é¡¹ç›®ï¼Œä¸ºä»“å‚¨ä¼ä¸šæ‹“å±•æœåŠ¡é¡¹ç›®ã€‚ä»“å•æ˜¯ä¿ç®¡äººæ”¶åˆ°ä»“å‚¨ç‰©åç»™å­˜è´§äººå¼€ä»˜çš„æå–ä»“å‚¨ç‰©çš„å‡­è¯ã€‚ä»“å•é™¤ä½œä¸ºå·²æ”¶å–ä»“å‚¨ç‰©çš„å‡­è¯å’Œæå–ä»“å‚¨ç‰©çš„å‡­è¯å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡èƒŒä¹¦ï¼Œè½¬è®©ä»“å•é¡¹ä¸‹è´§ç‰©çš„æ‰€æœ‰æƒï¼Œæˆ–è€…ç”¨äºå‡ºè´¨ã€‚å­˜è´§äººåœ¨ä»“å•ä¸ŠèƒŒä¹¦å¹¶ç»ä¿ç®¡äººç­¾å­—æˆ–è€…ç›–ç« ï¼Œè½¬è®©ä»“å•å§‹ç”Ÿæ•ˆåŠ›ã€‚å­˜è´§äººä»¥ä»“å•å‡ºè´¨åº”å½“ä¸è´¨æƒäººç­¾è®¢è´¨æŠ¼åˆåŒï¼Œåœ¨ä»“å•ä¸ŠèƒŒä¹¦å¹¶ç»ä¿ç®¡äººç­¾å­—æˆ–è€…ç›–ç« ï¼Œå°†ä»“å•äº¤ä»˜è´¨æƒäººåï¼Œè´¨æŠ¼æƒå§‹ç”Ÿæ•ˆåŠ›ã€‚ æ ‡å‡†ä»“å•è´¨æŠ¼æˆä¿¡æ˜¯æŒ‡å®¢æˆ·ä»¥è‡ªæœ‰æˆ–ç¬¬ä¸‰äººåˆæ³•æ‹¥æœ‰çš„æ ‡å‡†ä»“å•ä¸ºè´¨æŠ¼çš„æˆä¿¡ä¸šåŠ¡ã€‚æ ‡å‡†ä»“å•æ˜¯æŒ‡ç¬¦åˆäº¤æ˜“æ‰€ç»Ÿä¸€è¦æ±‚çš„ã€ç”±æŒ‡å®šäº¤å‰²ä»“åº“åœ¨å®Œæˆå…¥åº“å•†å“éªŒæ”¶ã€ç¡®è®¤åˆæ ¼åç­¾å‘ç»™è´§ä¸»ç”¨å¹²æå–å•†å“çš„ã€å¹¶ç»äº¤æ˜“æ‰€æ³¨å†Œç”Ÿæ•ˆçš„æ ‡å‡†åŒ–æè´§å‡­è¯ã€‚è¯¥äº§å“é€‚ç”¨äºé€šè¿‡æœŸè´§äº¤æ˜“å¸‚åœºè¿›è¡Œé‡‡è´­æˆ–é”€å”®çš„å®¢æˆ·ï¼Œä»¥åŠé€šè¿‡æœŸè´§äº¤æ˜“å¸‚åœºå¥—æœŸä¿å€¼ã€è§„é¿ç»è¥é£é™©çš„å®¢æˆ·ã€‚å¯¹äºå®¢æˆ·è€Œè¨€ï¼Œç›¸æ¯”åŠ¨äº§æŠµè´¨æŠ¼ï¼Œæ ‡å‡†ä»“å•è´¨æŠ¼æ‰‹ç»­ç®€ä¾¿ã€æˆæœ¬è¾ƒä½ã€‚å¯¹é“¶è¡Œè€Œè¨€ï¼Œæˆæœ¬å’Œé£é™©éƒ½è¾ƒä½ã€‚æ­¤å¤–ï¼Œç”±äºæ ‡å‡†ä»“å•çš„æµåŠ¨æ€§å¾ˆå¼ºï¼Œä¹Ÿåˆ©äºé“¶è¡Œåœ¨å®¢æˆ·è¿çº¦æƒ…å†µä¸‹å¯¹è´§æŠ¼ç‰©çš„å¤„ç½®ã€‚ æ™®é€šä»“å•è´¨æŠ¼æˆä¿¡æ˜¯æŒ‡å®¢æˆ·æä¾›ç”±ä»“åº“æˆ–å…¶ä»–ç¬¬ä¸‰æ–¹ç‰©æµå…¬å¸æä¾›çš„éæœŸè´§äº¤å‰²ç”¨ä»“å•ä½œä¸ºè´¨æŠ¼ç‰©ï¼Œå¹¶å¯¹ä»“å•ä½œå‡ºè´¨èƒŒä¹¦ï¼Œé“¶è¡Œæä¾›èèµ„çš„ä¸€ç§é“¶è¡Œäº§å“ã€‚åœ¨æ¶‰åŠè´§æŠ¼çš„èèµ„æ¨¡å¼é‡Œï¼Œç›®å‰æœ€å¤§çš„é—®é¢˜æ˜¯ç›‘ç®¡ä¼ä¸šçš„èŒè´£è¾¹ç•Œã€é£é™©è®¤å®šå’Œæ”¶ç›Šæƒè¡¡é—®é¢˜ã€‚ç›‘ç®¡ä¼ä¸šæ‰¿æ‹…çš„è´£ä»»æ³•å¾‹ç•Œå®šæ¨¡ç³Šï¼Œå½“ç›‘ç®¡ä¼ä¸šè·å–çš„æ”¶ç›Šè¾ƒä½æ—¶ï¼Œæ‰¿æ‹…è¿‡å¤§çš„é£é™©ä¸å…¶å¹¶ä¸åŒ¹é…ã€‚]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>ä¾›åº”é“¾é‡‘è</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>ä¾›åº”é“¾é‡‘è</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŒºå—é“¾ç®€ä»‹]]></title>
    <url>%2F2019%2F01%2F08%2F12.%E5%8C%BA%E5%9D%97%E9%93%BE%2F%E5%8C%BA%E5%9D%97%E9%93%BE%E6%A6%82%E5%BF%B5%2F1.%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[åŒºå—é“¾ä»‹ç»åŒºå—é“¾çš„å†å²ä¸Šä¸–çºª 80 å¹´ä»£å’Œ 90 å¹´ä»£çš„åŒ¿åç”µå­ç°é‡‘åè®®ä¸»è¦ä½¿ç”¨äº†ä¸€ç§è¢«ç§°ä¸ºâ€œä¹”å§†ç›²ç­¾ï¼ˆChaumian Blindingï¼‰â€çš„åŠ å¯†æŠ€æœ¯ï¼Œè¿™ç§æŠ€æœ¯ä¸ºè¿™äº›æ–°è´§å¸æä¾›äº†å¾ˆé«˜çš„éšç§ä¿æŠ¤ï¼Œä½†æ˜¯ç”±äºä»–ä»¬çš„åŸºç¡€åè®®åœ¨å¾ˆå¤§ç¨‹åºä¸Šéœ€è¦ä¾èµ–äºä¸€ä¸ªä¸­å¤®ä¸­ä»‹ï¼Œå› æ­¤æœªèƒ½è·å¾—æ”¯æŒã€‚1998 å¹´ï¼Œæˆ´ä¼Ÿï¼ˆWei Daiï¼‰çš„ b-money é¦–æ¬¡å¼•å…¥äº†é€šè¿‡è§£å†³è®¡ç®—éš¾é¢˜å’Œå»ä¸­å¿ƒåŒ–çš„å…±è¯†æ¥åˆ›é€ è´§å¸çš„æ€æƒ³ï¼Œä½†æ˜¯è¯¥å»ºè®®å¹¶æœªç»™å‡ºå®ç°å»ä¸­å¿ƒåŒ–çš„å…±è¯†çš„å…·ä½“æ–¹æ³•ã€‚2005 å¹´ï¼ŒèŠ¬å°¼ï¼ˆHal Finneyï¼‰å¼•å…¥äº†â€œå¯é‡å¤çš„å·¥ä½œè¯æ˜â€ï¼ˆreusable proofs of workï¼‰æ¦‚å¿µï¼Œå®ƒåŒæ—¶ä½¿ç”¨ b-money çš„æ€æƒ³å’Œ Adam Back æå‡ºçš„è®¡ç®—å›°éš¾çš„å“ˆå¸Œç°é‡‘ï¼ˆHashcashï¼‰éš¾é¢˜æ¥åˆ›é€ å¯†ç å­¦è´§å¸ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ¦‚å¿µå†æ¬¡è¿·å¤±äºç†æƒ³åŒ–ï¼Œå› ä¸ºå®ƒéœ€è¦å¯ä¿¡ä»»çš„è®¡ç®—ä½œä¸ºåç«¯ã€‚åœ¨2009 å¹´ï¼Œä¸€ç§å»ä¸­å¿ƒåŒ–çš„è´§å¸ç”±ä¸­æœ¬èªåœ¨å®è·µä¸­é¦–æ¬¡å¾—åˆ°å®ç°ï¼Œé€šè¿‡ä½¿ç”¨å…¬å…±å¯†é’¥å¯†ç æ¥ç®¡ç†æ‰€æœ‰æƒï¼Œå¹¶è¿‡ä¸€ç§ä¸€è‡´æ€§ç®—æ³•æ¥è·Ÿè¸ªè´§å¸çš„æŒæœ‰è€…ï¼Œè¿™ç§ç®—æ³•è¢«ç§°ä¸ºâ€œå·¥ä½œè¯æ˜â€ã€‚è¿™â€œå·¥ä½œè¯æ˜â€ çš„ç®—æ³•æ˜¯ä¸€ç§çªç ´ï¼Œå› ä¸ºå®ƒåŒæ—¶å†³äº† 2 ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•çš„ã€æœ‰èŠ‚åˆ¶çš„æœ‰æ•ˆçš„å…±è¯†ç®—æ³•ï¼Œå…è®¸ç½‘ç»œä¸­çš„èŠ‚ç‚¹ä¸€èµ·åŒæ„æ¯”ç‰¹å¸æ€»å¸çŠ¶ä¸€ç»„æ›´æ–°ã€‚å…¶æ¬¡ï¼Œå®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå…è®¸ä»»ä½•èŠ‚ç‚¹è‡ªç”±è¿›å…¥å…±è¯†çš„å¤„ç†è¿›ç¨‹ï¼Œä»è€Œè§£å†³äº†è°æ¥å½±å“å…±è¯†çš„æ”¿æ²»éš¾é¢˜ï¼ŒåŒæ—¶é˜»æ­¢å¥³å·«æ”»å‡»ã€‚ è¿™å‚ä¸å…±è¯†æŠ•ç¥¨çš„èŠ‚ç‚¹çš„æŠ•ç¥¨æƒæ¯”é‡æ˜¯ç›´æ¥å’ŒèŠ‚ç‚¹å®ƒä»¬è‡ªå·±çš„ç®—åŠ›æŒ‚é’©çš„ã€‚ è¿™å°±æ˜¯æ¯”ç‰¹å¸ï¼Œå…¶æ ¸å¿ƒæ€æƒ³å°±æ˜¯å»ºç«‹ä¸€ä¸ªå…±è¯†æœºåˆ¶ï¼Œä¸ä¼šç”±æŸä¸€ä¸ªæœåŠ¡ä¸­å¿ƒä½œä¸ºè®¡ç®—åç«¯ã€‚ åŒºå—é“¾çš„åŸºæœ¬æ¦‚å¿µåŒºå—é“¾æ˜¯ä¸€ç§åˆ†å¸ƒå¼è´¦æœ¬ï¼Œç”±ä¸å¯æ›´æ”¹çš„æ•°å­—è®°å½•æ•°æ®åŒ…æ„æˆã€‚è¿™äº›æ•°æ®åŒ…è¢«ç§°ä½œä¸ºåŒºå—ã€‚ç„¶åä½¿ç”¨åŠ å¯†ç­¾åå‘¢å°†æ¯ä¸ªåŒºå— â€œé“¾æ¥â€ åˆ°ä¸‹ä¸€ä¸ªåŒºå—ã€‚è¿™æ ·å°±ä½¿åŒºå—é“¾åƒåˆ†ç±»è´¦æœ¬ä¸€æ ·è¢«ä½¿ç”¨ï¼Œå¯ä»¥æœ‰å…·æœ‰é€‚å½“æƒé™çš„ä»»ä½•äººå…±äº«å’Œè®¿é—®ã€‚ åœ¨åŒºå—ä¸­ï¼Œæˆ‘ä»¬ä¼šå†™å…¥å¦‚ä¸‹ä¿¡æ¯ è°åœ¨è½¬è´¦ç»™è° äº¤æ˜“é‡‘é¢ ç­¾åç­‰å…¶ä»–ä¿¡æ¯ åŒºå—çš„é“¾æ¥æ–¹å¼ â€‹ å‡è®¾æˆ‘ä»¬æœ‰ 3 ä¸ªåŒºå—ï¼ŒåŒ…å«å¦‚ä¸‹ä¿¡æ¯ï¼š åŒºå— 1 åŒ…å«çš„ä¿¡æ¯ä¸º I1ï¼ŒI1 çš„å“ˆå¸Œå€¼ä¸º H1ã€‚ åŒºå— 2 åŒ…å«çš„ä¿¡æ¯ä¸º I2 ï¼ŒI2 çš„å“ˆå¸Œå€¼ä¸º H2ã€‚ åŒºå— 3 åŒ…å«çš„ä¿¡æ¯ä¸º I3 ï¼ŒI3 çš„å“ˆå¸Œå€¼ä¸º H3ã€‚ H2 æ˜¯ç”± H1 å’Œ I2 ç»“åˆèµ·æ¥ç®—å‡ºçš„ã€‚åŒæ ·åœ°ï¼ŒH3 æ˜¯ç”± H2 å’Œ I3 ç»“åˆèµ·æ¥ç®—å‡ºçš„ï¼Œä¾æ­¤ç±»æ¨ã€‚ åˆ†å¸ƒå¼å»ä¸­å¿ƒåŒ–åˆ†ç±»è´¦åŒºå—é“¾æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å»ä¸­å¿ƒåŒ–åˆ†ç±»è´¦ï¼Œç”¨æ¥å­˜å‚¨äº¤æ˜“ä¿¡æ¯ç­‰æ•°æ®ï¼Œè¿™äº›æ•°æ®ä¸ºæ•´ä¸ªåŒºå—é“¾ç½‘ç»œä¸­çš„èŠ‚ç‚¹æ‰€å…±äº«ã€‚ åˆ†ç±»è´¦åˆ†ç±»è´¦æ˜¯æ‰¿è½½åŒºå—åˆ—è¡¨çš„ä¸»è¦è®°å½•è½½ä½“ã€‚ å­˜å‚¨æ•°æ®åŒºå—èƒ½å­˜å‚¨æ•°æ®ï¼ˆä¿¡æ¯ï¼‰ã€‚æ­¤å¤„å¯¹æ•°æ®çš„å®šä¹‰å¾ˆå¹¿æ³›ï¼Œå¯ä»¥æ˜¯æˆ‘ä»¬èƒ½æƒ³åˆ°çš„ä»»ä½•æ•°æ®ã€‚æˆ‘ä»¬å°±æ‹¿äº¤æ˜“ä¿¡æ¯è¿™ä¸€æ•°æ®æ¥ä¸¾ä¸ªä¾‹å­ã€‚ åˆ†å¸ƒå¼çš„å»ä¸­å¿ƒåŒ–åˆ†ç±»è´¦æ•°æ®å¤„ç†é€šå¸¸ç”±ä¸€ä¸ªä¸­å¿ƒæœºå™¨è´Ÿè´£ã€‚ä½†æ˜¯åŒºå—é“¾é‡Œæœ‰å¾ˆå¤šæœºå™¨ï¼ˆå› æ­¤å®ƒä¸æ˜¯ä¸­å¿ƒåŒ–çš„ï¼‰ï¼Œä¸”æ‰€æœ‰æœºå™¨éƒ½æ˜¯ç‚¹å¯¹ç‚¹ç›¸äº’è¿æ¥ã€‚å¦å¤–ï¼Œè¿™äº›æœºå™¨ç»´æŠ¤çš„æ˜¯åŒä¸€æœ¬åˆ†ç±»è´¦ã€‚å› æ­¤ï¼ŒåŒºå—é“¾è¢«ç§°ä¸ºåˆ†å¸ƒå¼çš„å»ä¸­å¿ƒåŒ–åˆ†ç±»è´¦ã€‚ æ¢å¥è¯è¯´ï¼Œå› ä¸ºåŒä¸€åŒºå—é“¾ç½‘ç»œä¸­çš„æ‰€æœ‰äººéƒ½å…±äº«åŒä¸€æœ¬åˆ†ç±»è´¦ï¼Œæ‰€ä»¥è¯´åŒºå—é“¾æ˜¯åˆ†å¸ƒå¼çš„ã€‚æ¯ä¸ªäººéƒ½æœ‰æ•´ä¸ªåˆ†ç±»è´¦çš„å‰¯æœ¬ï¼Œä¸€æ—¦æœ‰ä»€ä¹ˆä¸œè¥¿æ·»åŠ è¿›å»ï¼Œå‰¯æœ¬é©¬ä¸Šå°±ä¼šæ›´æ–°ã€‚ ä¸ºæ•´ä¸ªåŒºå—é“¾ç½‘ç»œä¸­çš„èŠ‚ç‚¹æ‰€å…±äº«åœ¨åŒºå—é“¾ç½‘ç»œä¸­ï¼Œæ‰€æœ‰æœºå™¨å…¨éƒ½ç›¸äº’è¿æ¥ã€‚æ¯ä¸ªèŠ‚ç‚¹ï¼ˆæœºå™¨ï¼‰éƒ½æŒæœ‰ç›¸åŒçš„åˆ†ç±»è´¦å‰¯æœ¬ã€‚è¿™å°±æ„å‘³ç€æ•´ä¸ªåŒºå—é“¾ç½‘ç»œä¸­çš„èŠ‚ç‚¹éƒ½å…±äº«ä¸€æœ¬åˆ†ç±»è´¦ã€‚ åŒºå—é“¾æ˜¯å¦‚ä½•ç¡®ä¿å®‰å…¨æ€§çš„åŒºå—é“¾åˆ©ç”¨å¯†ç å­¦æ¥ç”Ÿæˆæ•°å­—ç­¾åï¼Œå¹¶é€šè¿‡æ•°å­—ç­¾åçš„æ–¹å¼é˜²æ­¢æ•°æ®å®Œæ•´æ€§ã€‚ å½“åˆ›å»ºä¸€ä¸ªäº¤æ˜“çš„æ—¶å€™ï¼Œåˆ©ç”¨è‡ªå·±çš„ç§é’¥å¯¹ä¿¡æ¯è¿›è¡ŒåŠ å¯†åˆ›å»ºä¸€ä¸ªæ•°å­—ç­¾å ç„¶åæŠŠäº¤æ˜“(å†…å«ä¿¡æ¯ã€å…¬é’¥ä»¥åŠæ•°å­—ç­¾å)æäº¤åˆ°å…¶ä»–çš„ä¸´è¿‘èŠ‚ç‚¹è¿›è¡Œå®¡æ‰¹ã€‚ åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œç½‘ç»œä¼šåˆ©ç”¨å…¬é’¥æ¥è§£å¯†æ•°å­—ç­¾åï¼Œå¹¶ä»ç­¾åä¸­æå–ä¿¡æ¯ã€‚ å¦‚æœåŸä¿¡æ¯ä¸ä¸Šå›¾æ‰€ç¤ºçš„ç­¾åä¸­æå–å‡ºæ¥çš„ä¿¡æ¯ç›¸åŒ¹é…ï¼Œå°±å¯ä»¥é€šè¿‡å®¡æ‰¹ï¼Œå¦åˆ™å°±æ— æ³•é€šè¿‡ã€‚ å¦‚æœé‡ä¿¡æ¯ä¸åŒ¹é…ï¼Œ å°±å¯èƒ½æ˜¯ä¸€ä¸‹åŸå› : åŸä¿¡æ¯åœ¨ä¸­é€”è¢«æ“æ§äº†ã€‚ ç”Ÿæˆæ•°å­—ç­¾åæ—¶æ‰€ç”¨çš„ç§é’¥ä¸æ‰€æä¾›çš„å…¬é’¥ä¸åŒ¹é…ã€‚ è¿™å°±æ˜¯åŒºå—é“¾ç½‘ç»œå¦‚ä½•èƒ½å¤Ÿé˜²æ­¢ç¯¡æ”¹çš„æ–¹æ³•ï¼Œå› æ­¤åŒºå—é“¾ç›¸å¯¹ä¸Šæ˜¯å®‰å…¨çš„ã€‚ åŒºå—é“¾æŠ€æœ¯çš„åº”ç”¨ åŒºå—é“¾è´§å¸å…‘æ¢ é€šè¿‡ç”µå­åŠ å¯†è´§å¸å¯ä»¥ä½æˆæœ¬çš„å®ç°è´§å¸å…‘æ¢å’Œæ±‡æ¬¾ æ•°æ®å­˜å‚¨ åŒºå—é“¾çš„å®è´¨æ˜¯åˆ†å¸ƒå¼è´¦æœ¬ï¼Œå¹¶ä¸”å…·æœ‰ä¸å¯æ›´æ”¹çš„ç‰¹æ€§ï¼Œå› æ­¤éå¸¸é€‚åˆé‡‘èç§‘æŠ€è¡Œä¸šçš„æ•°æ®å­˜å‚¨ã€‚ä»å¦ä¸€ä¸ªè§’åº¦çœ‹ï¼ŒåŒºå—é“¾ä¹Ÿæ˜¯åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¯ä»¥æ»¡è¶³ä¸ªäººç”¨æˆ·æ•°æ®å­˜å‚¨çš„éœ€è¦ã€‚ åŒºå—é“¾ç‰©è”ç½‘ é€šè¿‡åˆ†éƒ¨ç½²è´¦æœ¬è®°å½•æŸä¸ªè®¾å¤‡ä¸å…¶ä»–è®¾å¤‡ã€webæœåŠ¡ã€æˆ–è€…äººç±»ç”¨æˆ·ä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œå°±å¯ä»¥è·Ÿè¸ªä»–çš„å†å²ã€‚ æŠ•ç¥¨ç³»ç»Ÿ åŒºå—é“¾å¾ˆå¥½çš„è§£å†³äº†æ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹è€Œè¾¾æˆä¿¡ä»»çš„é—®é¢˜ï¼Œå› æ­¤ç‰¹åˆ«é€‚åˆå®ç°å…¬ä¼—æŠ•ç¥¨ç³»ç»Ÿã€‚ é¢„æµ‹å¹³å° é€šå¸¸æƒ…å†µä¸‹ï¼Œç¾¤ä½“çš„æ™ºæ…§å¤§äºå°‘æ•°ä¸ªä½“ã€‚å¯¹æœªæ¥å‘ç”Ÿçš„æ—¶é—´ï¼Œç¾¤ä½“çš„é¢„æµ‹ç»“æœé€šå¸¸ä¼šæ›´åŠ å‡†ç¡®ã€‚åˆ©ç”¨åŒºå—é“¾å…¨åå‚ä¸ã€åªèƒ½åˆçº¦ç­‰ç‰¹æ€§ï¼Œå¯ä»¥åˆ›é€ æ–°å‹çš„é¢„æµ‹å¹³å° æ”¯ä»˜ ã€å€Ÿè´· é€šè¿‡ç”µå­åŠ å¯†è´§å¸å¯ä»¥å®ç°ä½æˆæœ¬çš„è·¨å¢ƒæ”¯ä»˜ä¸ä¸ªäººå€Ÿè´·ã€‚ åŒºå—é“¾æŠ€æœ¯æ ˆ å…±è¯†æœºåˆ¶ ç”¨æ¥ç­›é€‰å’Œç«äº‰å‡ºè®©å“ªä¸ªèŠ‚ç‚¹æ¥è¿›è¡Œè®°è´¦ï¼Œå¹¶å¹¿æ’­ç»™æ‰€æœ‰èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥çš„æœºåˆ¶ï¼› å¯†ç ç®—æ³• ç”¨æ¥è®¡ç®—åŒºå—çš„å“ˆå¸Œå€¼æ¥å…³è”å„ä¸ªåŒºå—ï¼Œ å’Œè®¡ç®—æ¯ä¸ªåŒºå—äº¤æ˜“äº‹åŠ¡çš„å“ˆå¸Œå€¼(æ¢…å…‹å°”æ ¹) ç½‘ç»œè·¯ç”± ç”¨æ¥å‘ç°å„ä¸ªèŠ‚ç‚¹ï¼Œå®ç°èŠ‚ç‚¹ä¹‹é—´çš„ç›¸äº’é€šè®¯ï¼Œå®Œæˆå„èŠ‚ç‚¹æ•°æ®çš„åŒæ­¥ï¼› è„šæœ¬ç³»ç»Ÿ(å¯ä»¥ç±»æ¯”ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦å’Œæ¯”ç‰¹å¸çš„äº¤æ˜“è¿‡ç¨‹) ä¸€èˆ¬ç”¨æ¥é©±åŠ¨æ•°æ®çš„æ”¶å‘ï¼Œå³ä¸€å¥—æ•°æ®çš„æ”¶å‘å’Œå¤„ç†è§„åˆ™ï¼›åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­ä¹Ÿå¯ä»¥é€šè¿‡æ”¹ç¼–è„šæœ¬ç³»ç»Ÿç¨‹åºã€‚æ‹“å±•åŒºå—é“¾ç³»ç»ŸåŠŸèƒ½ï¼Œæ¯”å¦‚ä»¥å¤ªåŠå°±å¯ä»¥æ ¹æ®è‡ªå®šä¹‰åŠŸèƒ½çš„è„šæœ¬ç³»ç»Ÿï¼Œè¿›è€Œå®ç°æ™ºèƒ½åˆçº¦çš„åŠŸèƒ½ï¼› åŒºå—é“¾è´¦æœ¬ ç”¨æ¥è®°å½•æ•°æ®ï¼Œå°†æ•°æ®ä»¥åŒºå—çš„æ–¹å¼è®°å½•ä¸‹æ¥, æ¯ä¸€ä¸ªåŒºå—ä¸€èˆ¬åŒ…å«[1. åŒºå—å¤´ï¼›2.å‰ä¸€åŒºå—å¤´çš„å“ˆå¸Œå€¼ ï¼› 3. æ¢…å…‹è€³æ ¹(äº¤æ˜“äº‹åŠ¡çš„å“ˆå¸Œå€¼) ]ï¼Œ æ ¹æ®ä¸‹å›¾, ä¸€èˆ¬å…­ä¸ªåŒºå—å°±èƒ½ç¡®å®š ä¸€æ¯”äº¤æ˜“æˆåŠŸï¼› ä¸­å¿ƒæœåŠ¡å™¨å’ŒåŒºå—é“¾çš„åŒºåˆ«ç¬¬ä¸‰æ–¹ä»‹å…¥çš„ç¼ºç‚¹ äº¤æ˜“æˆæœ¬é«˜ å¯¹å°é¢äº¤æ˜“ä¸å‹å¥½ è°ƒè§£çº çº·çš„æˆæœ¬è¢«å¹³æ‘Šåˆ°äº¤æ˜“æ‰‹ç»­è´¹ è·¨åœ°åŸŸäº¤æ˜“æ—¶éœ€è¦é¢å¤–è´¹ç”¨ å¯¹å–å®¶ä¸å…¬å¹³ å½“å‘ç”Ÿçº çº·æ—¶é€šå¸¸ä¿æŠ¤ä¹°å®¶çš„åˆ©ç›Š æŸäº›äº§å“å¯ä»¥è½»æ˜“å¤åˆ¶ï¼Œå¦‚æ–‡æ¡£ï¼ŒåŒ…å«æºä»£ç çš„ç¨‹åºç­‰ã€‚å½“äº§ç”Ÿé€€è´§æ—¶å¯¹å–å®¶ä¸åˆ©ï¼› äº¤æ˜“æ—¶é—´é•¿ ç¬¬ä¸‰æ–¹æ ¸å®äº¤æ˜“éœ€è¦æ—¶é—´è¾ƒé•¿ éšç§æš´éœ² å•†å®¶ä¼šå‘å®¢æˆ·ç´¢è¦å®Œå…¨ä¸å¿…è¦çš„ä¸ªäººä¿¡æ¯ å¦‚ä½•å»é™¤ç¬¬ä¸‰æ–¹ ç”µå­åŠ å¯†è´§å¸çš„æ ¸å¿ƒæ€æƒ³ å…¨æ°‘å‚ä¸ è®©å…¨ç½‘å°½å¯èƒ½å¤šçš„èŠ‚ç‚¹å‚ä¸æ ¸å®ï¼Œè®°å½•äº¤æ˜“ ç»™å‚ä¸è§è¯çš„èŠ‚ç‚¹è®²ç†ï¼Œç»´æŒæ•´ä¸ªç³»ç»ŸæŒç»­ è¿è¡Œ ä»»ä½•äººéƒ½å¯ä»¥å‚ä¸æŒ–çŸ¿ï¼Œæ‹¥æœ‰ä»£å¸ï¼Œå‘èµ·äº¤æ˜“ åŒ¿å&amp;å…¬å¼€ äº¤æ˜“çš„åŒæ–¹æ— éœ€é€éœ²ä¸ªäººä¿¡æ¯ äº¤æ˜“ä¿¡æ¯æ˜¯å…¬å¼€ï¼ŒéåŠ å¯†çš„ã€‚æ ¹æ®é’±åŒ…åœ°å€å¯æŸ¥æ‰€æœ‰çš„äº¤æ˜“è®°å½• å»ä¸­å¿ƒåŒ– é‡‡ç”¨p2pç½‘ç»œï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ¥è‡ªäºäº’è”ç½‘ï¼Œè§£å†³äº†ç¬¬ä¸‰æ–¹å•ç‹¬è¿›è¡Œæ•°æ®å¤„ç†çš„é—®é¢˜ åŒºå—é“¾åˆ†ç±»æ ¹æ®ç½‘ç»œèŒƒå›´åˆ†ç±» å…¬æœ‰é“¾ å®Œå…¨å¯¹å¤–å¼€æ”¾ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä»»æ„ä½¿ç”¨ï¼› æ²¡æœ‰æƒé™çš„è®¾å®šï¼Œæœ‰æ²¡æœ‰èº«ä»½çš„è®¤è¯ï¼› æ‰€æœ‰çš„æ•°æ®å‚ä¸å…¶ä¸­çš„ä»»ä½•äººéƒ½å¯ä»¥ä»»æ„æŸ¥çœ‹ï¼Œå®Œå…¨çš„å…¬å¼€é€æ˜ï¼› èŠ‚ç‚¹æ•°é‡ä¸å›ºå®šï¼ŒèŠ‚ç‚¹æ˜¯å¦åœ¨çº¿ä¹Ÿæ— æ³•æ§åˆ¶ï¼Œé€šè¿‡ç½‘ç»œä¸­å¤§å¤šæ•°èŠ‚ç‚¹æ‰¿è®¤çš„é“¾å°±æ˜¯ä¸»é“¾ï¼› å…¬æœ‰é“¾ä¸­å…±è¯†æœºåˆ¶ä¸€èˆ¬æ˜¯å·¥ä½œé‡è¯æ˜ï¼ˆPOWï¼‰å’Œæƒç›Šè¯æ˜ï¼ˆPOSï¼‰; æœ€å…·ä»£è¡¨çš„å°±æ˜¯æ¯”ç‰¹å¸ï¼› ç§æœ‰é“¾ ä¸å¯¹å¤–å¼€å‘ï¼Œä»…ä»…åœ¨ç»„ç»‡å†…éƒ¨ä½¿ç”¨ï¼› é€šå¸¸éœ€è¦æ³¨å†Œï¼Œæˆ–è€…éœ€è¦èº«ä»½è®¤è¯ï¼› æ•°æ®åªå¯¹ç§é“¾ä¸­çš„èŠ‚ç‚¹å¯è§ï¼› èŠ‚ç‚¹çš„æ•°é‡å’ŒèŠ‚ç‚¹çš„çŠ¶æ€é€šå¸¸çš„å¯æ§çš„; å› ä¸ºç§æœ‰é“¾çš„èŠ‚ç‚¹éƒ½æœ‰å¾ˆé«˜çš„ä¿¡ä»»åº¦ï¼Œä¸€èˆ¬ä¸éœ€è¦é€šè¿‡ç«äº‰çš„æ–¹å¼æ¥ç­›é€‰æ•°æ®æ‰“åŒ…è€…ï¼Œå¯ä»¥é‡‡ç”¨æ›´åŠ èŠ‚èƒ½çš„æ–¹å¼è¿›è¡Œç­›é€‰ï¼› æ¯”è¾ƒä»£è¡¨çš„åº”ç”¨å°±æ˜¯ä¼ä¸šçš„ç¥¨æ®ç®¡ç†ï¼Œè´¦åŠ¡å®¡è®¡ï¼Œä¾›åº”é“¾ç®¡ç†ç­‰ç³»ç»Ÿï¼› è”ç›Ÿé“¾ è”ç›Ÿé“¾çš„ç½‘ç»œèŒƒå›´ä»‹äºå…¬æœ‰é“¾å’Œç§æœ‰é“¾ä¹‹é—´ï¼Œ ä»…é™è”ç›Ÿæˆå‘˜ä½¿ç”¨ï¼› å¯ä»¥ç»™ä¸åŒçš„è”ç›Ÿæˆå‘˜è®¾å®šä¸åŒçš„æƒé™ï¼Œæ‰€ä»¥è®°è´¦è§„åˆ™å’Œæ•°æ®æƒé™éƒ½å¯ä»¥ç§äººè®¢åˆ¶ï¼› ä¸€èˆ¬ä¹Ÿæ˜¯å…·æœ‰èº«ä»½è®¤è¯å’Œæƒé™è®¾ç½®çš„ï¼› èŠ‚ç‚¹çš„æ•°é‡å’ŒèŠ‚ç‚¹çš„çŠ¶æ€é€šå¸¸çš„å¯æ§çš„ï¼› è”ç›Ÿé“¾å‡ ä¹ä¸é‡‡ç”¨å·¥ä½œé‡è¯æ˜å…±è¯†æœºåˆ¶è€Œæ˜¯é‡‡ç”¨æƒç›Šè¯æ˜æˆ–PBTFç­‰å…±è¯†ç®—æ³•; ä»£è¡¨çš„åº”ç”¨æœ‰é“¶è¡Œä¹‹é—´çš„æ”¯ä»˜ç»“ç®—ã€ä¼ä¸šä¹‹é—´çš„ç‰©æµã€æ”¿åºœæœºå…³çš„å¯¹å¤–æ•°æ®å…¬å¼€ç³»ç»Ÿç­‰ï¼› æ ¹æ®éƒ¨ç½²ç¯å¢ƒåˆ†ç±» ä¸»é“¾ éƒ¨ç½²åœ¨æ­£å¼ç”Ÿäº§ç¯å¢ƒçš„åŒºå—é“¾ç³»ç»Ÿï¼› æµ‹è¯•é“¾ éƒ¨ç½²åœ¨æµ‹è¯•ç¯å¢ƒï¼Œç”¨æ¥å¼€å‘å’Œæµ‹è¯•Bugçš„åŒºå—é“¾ç³»ç»Ÿï¼› æ ¹æ®å¯¹æ¥ç±»å‹åˆ†ç±» å•é“¾ èƒ½å¤Ÿå•ç‹¬è¿è¡Œçš„åŒºå—é“¾ç³»ç»Ÿéƒ½å¯ä»¥ç§°ä¹‹ä¸º â€œå•é“¾â€ï¼Œä¾‹å¦‚æ¯”ç‰¹å¸ä¸»é“¾ï¼Œæµ‹è¯•é“¾ï¼Œ è¿™äº›åŒºå—é“¾ç³»ç»Ÿæ‹¥æœ‰å®Œå¤‡çš„ç»„ä»¶æ¨¡å—ï¼Œè‡ªç§°ä¸€ä¸ªä½“ç³»ï¼› ä¾§é“¾ åŒºå—é“¾ç³»ç»Ÿä¸ä¾§é“¾ç³»ç»Ÿæœ¬èº«å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é“¾ç³»ç»Ÿï¼Œä¸¤è€…ä¹‹é—´å¯ä»¥æŒ‰ç…§ä¸€å®šçš„åè®®è¿›è¡Œæ•°æ®äº’åŠ¨ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¾§é“¾èƒ½å¤Ÿèµ·åˆ°ä¸€ä¸ªå¯¹ä¸»é“¾è¿›è¡ŒåŠŸèƒ½æ‹“å±•çš„ä½œç”¨ï¼Œå¾ˆå¤šåœ¨ä¸»é“¾ä¸­ä¸æ–¹ä¾¿å®ç°çš„åŠŸèƒ½å¯ä»¥å®ç°åœ¨ä¾§é“¾ä¸­ï¼Œè€Œä¾§é“¾å†é€šè¿‡ä¸ä¸»é“¾çš„æ•°æ®äº¤äº’å¢å¼ºè‡ªå·±çš„å¯é æ€§ï¼› äº’è”é“¾(å¤šé“¾) å°±æ˜¯åŒºå—é“¾ç³»ç»Ÿä¹‹é—´çš„äº’è”ï¼Œé€šè¿‡å„è‡ªçš„ä¼˜åŠ¿ï¼Œå½¼æ­¤äº’è¡¥ï¼Œå¯ä»¥å¤§å¤§å¢å¼ºäº†ç³»ç»Ÿçš„å¯é æ€§ä»¥åŠæ€§èƒ½ï¼› åŒºå—é“¾æŠ€æœ¯ç‰¹ç‚¹ æ•°æ®ä¸å¯ç¯¡æ”¹æ€§ åŒºå—é“¾ç³»ç»Ÿä¸æ˜¯ä¸€ä¸ªä¸­å¿ƒåŒ–è½¯ä»¶è®¾æ–½ï¼Œå› æ­¤æ•°æ®æ²¡æœ‰è¢«æŸä¸€å®¶æœºæ„æ§åˆ¶ï¼Œæ•°æ®è‚¯å®šä¸å¯èƒ½è¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹ï¼› åˆ†å¸ƒå¼å­˜å‚¨ åœ¨åŒºå—é“¾ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿è¡Œçš„èŠ‚ç‚¹éƒ½æ‹¥æœ‰ä¸€ä»½å®Œæ•´çš„æ•°æ®å‰¯æœ¬ï¼Œè¿™æ ·çš„è®¾è®¡ä¸ä»…é¿å…äº†å­˜å‚¨çš„å•èŠ‚ç‚¹æ•…éšœé—®é¢˜ï¼Œè¿˜å¯ä»¥è®©æ¯ä¸ªèŠ‚ç‚¹èƒ½å¤Ÿç‹¬ç«‹çš„éªŒè¯å’Œæ£€ç´¢æ•°æ®ï¼Œå¤§å¤§å¢åŠ äº†æ•´ä¸ªç³»ç»Ÿçš„å¯é æ€§ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®å‰¯æœ¬è¿˜å¯ä»¥äº’ç›¸ä¿æŒåŒæ­¥ï¼Œå¹¶ä½¿ç”¨ç±»ä¼¼æ¢…å…‹å°”æ ‘è¿™æ ·çš„æŠ€æœ¯ç»“æ„ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼› åŒ¿åæ€§ ä½¿ç”¨ä¼ ç»Ÿçš„æœåŠ¡è½¯ä»¶æ—¶ï¼Œé€šå¸¸éƒ½æ˜¯éœ€è¦æ³¨å†Œä¸€ä¸ªç”¨æˆ·åï¼Œç»‘å®šæ‰‹æœºå·ç­‰ï¼Œè¿›è¡Œä¸€äº›è®¤è¯ç­‰ï¼›ä½†æ˜¯åœ¨åŒºå—é“¾ç³»ç»Ÿä¸­ï¼Œç›®å‰å‡ ä¹æ‰€æœ‰çš„åŒºå—é“¾äº§å“éƒ½æ˜¯ä½¿ç”¨æ‰€è°“çš„åœ°å€æ¥è¡¨ç¤ºç”¨æˆ·çš„ï¼Œä¸éœ€è¦æä¾›å…¶ä»–çš„ä»»ä½•èƒ½è¡¨ç¤ºå‡ºç”¨æˆ·èº«ä»½çš„ä¿¡æ¯ï¼Œåœ°å€é€šå¸¸ä¹Ÿæ˜¯é€šè¿‡å…¬å¼€å¯†é’¥ç®—æ³•ç”Ÿæˆçš„å…¬é’¥è½¬æ¢è€Œæ¥çš„ï¼Œè¿™é€šå¸¸å°±æ˜¯ä¸€ä¸²å¦‚ä¹±ç ä¸€èˆ¬çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºå³ä½¿è¿™äº›å…¬é“¾ç³»ç»Ÿæ˜¯å®Œå…¨å…¬å¼€é€æ˜çš„ï¼Œæˆ‘ä»¬å´ä¸çŸ¥é“èƒŒåçš„æ“ä½œè€…æ˜¯è°ï¼› ä»·å€¼ä¼ é€’ ä»¥æ¯”ç‰¹å¸ä¸ºä¾‹ï¼Œæ¯”ç‰¹å¸æ˜¯ä¸€ç§æ•°å­—èµ„äº§ï¼Œä»–æ˜¯ç”±æ¯”ç‰¹å¸è½¯ä»¶ç»„æˆçš„ç½‘ç»œæ‰€ç»´æŠ¤çš„ï¼Œåœ¨è¿™ä¸ªç½‘ç»œä¸­ï¼Œä¸éœ€è¦å…¶ä»–çš„ç¬¬ä¸‰æ–¹ï¼Œè‡ªå·±å¯ä»¥æ ¹æ®è§„åˆ™å‘å‹æ¯”ç‰¹å¸ï¼Œå¹¶ä¸”èƒ½å¤Ÿç¡®ä¿å‘è¡Œçš„æ¯”ç‰¹å¸æ˜¯å…·æœ‰ä»·å€¼çš„(å·¥ä½œé‡è¯æ˜)ï¼Œè€Œè¿™ç§ä»·å€¼çš„è®¤å®šæ˜¯é€šè¿‡ç½‘ç»œä¸­æ‰€æœ‰çš„èŠ‚ç‚¹æ¥è‡ªåŠ¨è¿›è¡ŒéªŒè¯çš„ï¼ŒèŠ‚ç‚¹ä¹‹é—´æ‰“æˆå…¬å¼å°±ç®—è®¤å¯äº†ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯è‡ªæˆä¸€ä¸ªä½“ç³»æ¥è¿è¡Œçš„ï¼Œäººä»¬åœ¨äº¤æ˜“æ¯”ç‰¹å¸çš„æ—¶å€™å°±äº§ç”Ÿäº†ä»·å€¼ä¼ é€’ï¼› åŒºå—é“¾ç³»ç»Ÿæ˜¯å¯ä»¥è‡ªå·±åˆ›é€ ä¿¡ä»»æœºåˆ¶çš„ï¼Œæ— éœ€ç¬¬ä¸‰æ–¹ä¿¡ä»»çš„ç¯å¢ƒä¸­ï¼Œå¤§å¤§ç®€åŒ–äº†å„ç§äº¤æ˜“ä¸ªè¿‡ç¨‹ï¼Œé™ä½äº†äº¤æ˜“çš„æˆæœ¬ï¼› è‡ªåŠ¨ç½‘ç»œå…±è¯† ç”Ÿæ´»ä¸­ä¸€åŠå¾—äº‹æƒ…éƒ½éœ€è¦åŒæ–¹æˆ–è€…å¤šæ–¹è¾¾æˆå…±è¯†ï¼Œæ¯”å¦‚ç­¾è®¢ä¸€ä»½åˆåŒï¼Œéƒ½æ˜¯åœ¨å¤šæ–¹è¾¾æˆå…±è¯†ï¼Œå¹¶ä¸”éœ€è¦åšå„ç§ç¡®è®¤ï¼›æ¯”ç‰¹å¸ä»å‘å‹åˆ°è½¬è´¦äº¤æ˜“ï¼Œéƒ½æ˜¯ç”±ç½‘ç»œä¸­çš„èŠ‚ç‚¹è‡ªåŠ¨åŠé€†è¡Œèº«ä»½è®¤è¯å’Œä¸€ç³»åˆ—çš„æ£€æŸ¥çš„ï¼Œæ£€æŸ¥é€šè¿‡åå°±æ‰“æˆäº†ç½‘ç»œå…±è¯†ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½éµå®ˆä¸€ä»½å…±åŒçš„çº¦å®šå’Œè§„åˆ™ï¼Œåªè¦æ„å‘äº¤æ˜“ç¬¦åˆæ‰€æœ‰çš„çº¦å®šè§„åˆ™å°±èƒ½è¢«ç¡®è®¤ï¼› å¯ç¼–ç¨‹åˆçº¦ æ¯”å¦‚æ¯”ç‰¹å¸ï¼Œåœ¨æ¯”ç‰¹å¸ç³»ç»Ÿä¸­ï¼Œå¹¶ä¸æ˜¯æƒ³é“¶è¡Œè´¦æˆ·ä¸€æ ·ï¼Œå°†é‡‘é¢å­˜å‚¨åœ¨è´¦æˆ·ä¸‹å°±ä»£è¡¨ç”¨æˆ·æ‹¥æœ‰çš„ï¼Œè€Œæ˜¯é€šè¿‡è„šæœ¬è§£é”å’Œé”å®šä¸€æ¯”èµ„äº§ï¼Œç®€å•åœ°è¯´ï¼Œå°±æ˜¯è®©èµ„äº§å…·å¤‡æ›´å¼ºçš„ç¼–ç¨‹å¯æ§èƒ½åŠ›ï¼Œæ¯”å¦‚é…ç½®ç¨‹åºï¼Œè®©ä¸€æ¯”èµ„äº§éœ€è¦å¤šä¸ªäººå…±åŒç­¾åæ‰èƒ½è¢«è½¬ç§»æˆ–è€…éœ€è¦è¾¾åˆ°æŸä¸ªæ¡ä»¶çš„æ—¶å€™æ‰èƒ½è¢«ä½¿ç”¨ï¼Œè¿™å°±æ˜¯ç¼–ç¨‹åˆçº¦çš„æ€æƒ³ã€‚åŒºå—é“¾ç³»ç»Ÿå…·æœ‰æ•°æ®ä¸å¯ç¯¡æ”¹ï¼Œä»·å€¼ä¼ é€’ç­‰èƒ½åŠ›ï¼ŒåŠ ä¸Šç¼–ç¨‹åˆçº¦ï¼Œå°±èƒ½å®Œæˆå•†ä¸šä¸Šå„ç§çš„éœ€æ±‚ï¼› è½¯åˆ†å‰å’Œç¡¬åˆ†å‰è½¯åˆ†å‰è½¯åˆ†å‰ï¼šæ˜¯æŒ‡åŒºå—é“¾ç½‘ç»œç³»ç»Ÿç‰ˆæœ¬æˆ–åè®®å‡çº§åï¼Œæ—§çš„èŠ‚ç‚¹å¹¶ä¸ä¼šæ„è¯†åˆ°æ¯”ç‰¹å¸ä»£ç å‘ç”Ÿæ”¹å˜ï¼Œå¹¶ç»§ç»­æ¥å—ç”±æ–°èŠ‚ç‚¹åˆ›é€ çš„åŒºå—ï¼Œæ–°è€èŠ‚ç‚¹å§‹ç»ˆè¿˜æ˜¯åœ¨åŒä¸€æ¡é“¾ä¸Šå·¥ä½œã€‚ ç¡¬åˆ†å‰æ˜¯æŒ‡æ¯”ç‰¹å¸åŒºå—æ ¼å¼æˆ–äº¤æ˜“æ ¼å¼ï¼ˆå…±è¯†æœºåˆ¶ï¼‰å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæœªå‡çº§çš„èŠ‚ç‚¹æ‹’ç»éªŒè¯å·²ç»å‡çº§çš„èŠ‚ç‚¹äº§ç”Ÿçš„åŒºå—ï¼Œç„¶åå¤§å®¶å„è‡ªå»¶ç»­è‡ªå·±è®¤ä¸ºæ­£ç¡®çš„é“¾ï¼Œæ‰€ä»¥åˆ†æˆä¸¤æ¡é“¾ã€‚ äº§ç”Ÿä¸¤ä¸ªå¸ç§ï¼Œå¦‚BCC]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
        <category>åŒºå—é“¾æ¦‚å¿µ</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[goroutineåŸç†ä»¥åŠchannelä½¿ç”¨]]></title>
    <url>%2F2019%2F01%2F05%2F11.Golang%2FGolang%E7%89%B9%E6%80%A7%2Fgoroutine%E5%8E%9F%E7%90%86%E5%92%8Cchannel%2F</url>
    <content type="text"><![CDATA[ä¸€ã€goroutineä½œç”¨goroutineçš„æœ¬è´¨æ˜¯åç¨‹ï¼Œæ˜¯å®ç°å¹¶è¡Œè®¡ç®—çš„æ ¸å¿ƒï¼Œå’Œpythonçš„asyncç¼–ç¨‹ç±»ä¼¼ï¼Œä½†æ˜¯åˆä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çš„å»åˆ›å»ºæºç¨‹å¹¶é€šè¿‡å®è·µå¾ªç¯æ¥å¯åŠ¨ã€‚goroutineå¼‚æ­¥æ‰§è¡Œå‡½æ•°ï¼Œåªéœ€ä½¿ç”¨goå…³é”®å­—+å‡½æ•°åå³å¯å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œå‡½æ•°åˆ™ç›´æ¥å¤„äºå¼‚æ­¥æ‰§è¡Œçš„çŠ¶æ€ã€‚ 1go func()//é€šè¿‡goå…³é”®å­—å¯åŠ¨ä¸€ä¸ªåç¨‹æ¥è¿è¡Œå‡½æ•° äºŒã€goroutineçš„åŸç†æºç¨‹æ¦‚å¿µä»‹ç»åç¨‹æ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚åç¨‹è°ƒåº¦åˆ‡æ¢æ—¶ï¼Œå°†å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆä¿å­˜åˆ°å…¶ä»–åœ°æ–¹ï¼Œåœ¨åˆ‡å›æ¥çš„æ—¶å€™ï¼Œæ¢å¤å…ˆå‰ä¿å­˜çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚å› æ­¤ï¼Œåç¨‹èƒ½ä¿ç•™ä¸Šä¸€æ¬¡è°ƒç”¨æ—¶çš„çŠ¶æ€ï¼ˆå³æ‰€æœ‰å±€éƒ¨çŠ¶æ€çš„ä¸€ä¸ªç‰¹å®šç»„åˆï¼‰ï¼Œæ¯æ¬¡è¿‡ç¨‹é‡å…¥æ—¶ï¼Œå°±ç›¸å½“äºè¿›å…¥ä¸Šä¸€æ¬¡è°ƒç”¨çš„çŠ¶æ€ï¼Œæ¢ç§è¯´æ³•ï¼šè¿›å…¥ä¸Šä¸€æ¬¡ç¦»å¼€æ—¶æ‰€å¤„é€»è¾‘æµçš„ä½ç½®ã€‚çº¿ç¨‹å’Œè¿›ç¨‹çš„æ“ä½œæ˜¯ç”±ç¨‹åºè§¦å‘ç³»ç»Ÿæ¥å£ï¼Œæœ€åçš„æ‰§è¡Œè€…æ˜¯ç³»ç»Ÿï¼›åç¨‹çš„æ“ä½œæ‰§è¡Œè€…åˆ™æ˜¯ç”¨æˆ·è‡ªèº«ç¨‹åºï¼Œgoroutineä¹Ÿæ˜¯åç¨‹ã€‚ è°ƒåº¦æ¨¡å‹ç®€ä»‹groutineæ˜¯é€šè¿‡GPMè°ƒåº¦æ¨¡å‹å®ç°ï¼Œä¸‹é¢å°±æ¥è§£é‡Šä¸‹goroutineçš„è°ƒåº¦æ¨¡å‹ã€‚ Goçš„è°ƒåº¦å™¨å†…éƒ¨æœ‰å››ä¸ªé‡è¦çš„ç»“æ„ï¼šMï¼ŒPï¼ŒSï¼ŒSchedï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ˆSchedæœªç»™å‡ºï¼‰M:Mä»£è¡¨å†…æ ¸çº§çº¿ç¨‹ï¼Œä¸€ä¸ªMå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œgoroutineå°±æ˜¯è·‘åœ¨Mä¹‹ä¸Šçš„ï¼›Mæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç»“æ„ï¼Œé‡Œé¢ç»´æŠ¤å°å¯¹è±¡å†…å­˜cacheï¼ˆmcacheï¼‰ã€å½“å‰æ‰§è¡Œçš„goroutineã€éšæœºæ•°å‘ç”Ÿå™¨ç­‰ç­‰éå¸¸å¤šçš„ä¿¡æ¯G:ä»£è¡¨ä¸€ä¸ªgoroutineï¼Œå®ƒæœ‰è‡ªå·±çš„æ ˆï¼Œinstruction pointerå’Œå…¶ä»–ä¿¡æ¯ï¼ˆæ­£åœ¨ç­‰å¾…çš„channelç­‰ç­‰ï¼‰ï¼Œç”¨äºè°ƒåº¦ã€‚P:På…¨ç§°æ˜¯Processorï¼Œå¤„ç†å™¨ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”å°±æ˜¯ç”¨æ¥æ‰§è¡Œgoroutineçš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªgoroutineé˜Ÿåˆ—ï¼Œé‡Œé¢å­˜å‚¨äº†æ‰€æœ‰éœ€è¦å®ƒæ¥æ‰§è¡Œçš„goroutineSchedï¼šä»£è¡¨è°ƒåº¦å™¨ï¼Œå®ƒç»´æŠ¤æœ‰å­˜å‚¨Må’ŒGçš„é˜Ÿåˆ—ä»¥åŠè°ƒåº¦å™¨çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ç­‰ã€‚ è°ƒåº¦å®ç° ä»ä¸Šå›¾ä¸­çœ‹ï¼Œæœ‰2ä¸ªç‰©ç†çº¿ç¨‹Mï¼Œæ¯ä¸€ä¸ªMéƒ½æ‹¥æœ‰ä¸€ä¸ªå¤„ç†å™¨Pï¼Œæ¯ä¸€ä¸ªä¹Ÿéƒ½æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„goroutineã€‚Pçš„æ•°é‡å¯ä»¥é€šè¿‡GOMAXPROCS()æ¥è®¾ç½®ï¼Œå®ƒå…¶å®ä¹Ÿå°±ä»£è¡¨äº†çœŸæ­£çš„å¹¶å‘åº¦ï¼Œå³æœ‰å¤šå°‘ä¸ªgoroutineå¯ä»¥åŒæ—¶è¿è¡Œã€‚å›¾ä¸­ç°è‰²çš„é‚£äº›goroutineå¹¶æ²¡æœ‰è¿è¡Œï¼Œè€Œæ˜¯å‡ºäºreadyçš„å°±ç»ªæ€ï¼Œæ­£åœ¨ç­‰å¾…è¢«è°ƒåº¦ã€‚Pç»´æŠ¤ç€è¿™ä¸ªé˜Ÿåˆ—ï¼ˆç§°ä¹‹ä¸ºrunqueueï¼‰ï¼ŒGoè¯­è¨€é‡Œï¼Œå¯åŠ¨ä¸€ä¸ªgoroutineå¾ˆå®¹æ˜“ï¼šgo function å°±è¡Œï¼Œæ‰€ä»¥æ¯æœ‰ä¸€ä¸ªgoè¯­å¥è¢«æ‰§è¡Œï¼Œrunqueueé˜Ÿåˆ—å°±åœ¨å…¶æœ«å°¾åŠ å…¥ä¸€ä¸ªgoroutineï¼Œåœ¨ä¸‹ä¸€ä¸ªè°ƒåº¦ç‚¹ï¼Œå°±ä»runqueueä¸­å–å‡º å½“ä¸€ä¸ªOSçº¿ç¨‹M0é™·å…¥é˜»å¡æ—¶(ä¾‹å¦‚çˆ¬è™«æˆ–è€…å…¶ä»–çš„ioæ“ä½œï¼Œ è¿™é‡Œå°±å’Œpythonçš„å¤šçº¿ç¨‹ç±»ä¼¼)ï¼ˆå¦‚ä¸‹å›¾)ï¼ŒPè½¬è€Œåœ¨è¿è¡ŒM1ï¼Œå›¾ä¸­çš„M1å¯èƒ½æ˜¯æ­£è¢«åˆ›å»ºï¼Œæˆ–è€…ä»çº¿ç¨‹ç¼“å­˜ä¸­å–å‡ºã€‚ å½“MOè¿”å›æ—¶ï¼Œå®ƒå¿…é¡»å°è¯•å–å¾—ä¸€ä¸ªPæ¥è¿è¡Œgoroutineï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ƒä¼šä»å…¶ä»–çš„OSçº¿ç¨‹é‚£é‡Œæ‹¿ä¸€ä¸ªPè¿‡æ¥ï¼Œå¦‚æœæ²¡æœ‰æ‹¿åˆ°çš„è¯ï¼Œå®ƒå°±æŠŠgoroutineæ”¾åœ¨ä¸€ä¸ªglobal runqueueé‡Œï¼Œç„¶åè‡ªå·±ç¡çœ ï¼ˆæ”¾å…¥çº¿ç¨‹ç¼“å­˜é‡Œï¼‰ã€‚æ‰€æœ‰çš„Pä¹Ÿä¼šå‘¨æœŸæ€§çš„æ£€æŸ¥global runqueueå¹¶è¿è¡Œå…¶ä¸­çš„goroutineï¼Œå¦åˆ™global runqueueä¸Šçš„goroutineæ°¸è¿œæ— æ³•æ‰§è¡Œã€‚ å¦ä¸€ç§æƒ…å†µæ˜¯Pæ‰€åˆ†é…çš„ä»»åŠ¡Gå¾ˆå¿«å°±æ‰§è¡Œå®Œäº†ï¼ˆåˆ†é…ä¸å‡ï¼‰ï¼Œè¿™å°±å¯¼è‡´äº†è¿™ä¸ªå¤„ç†å™¨På¾ˆå¿™ï¼Œä½†æ˜¯å…¶ä»–çš„Pè¿˜æœ‰ä»»åŠ¡ï¼Œæ­¤æ—¶å¦‚æœglobal runqueueæ²¡æœ‰ä»»åŠ¡Gäº†ï¼Œé‚£ä¹ˆPä¸å¾—ä¸ä»å…¶ä»–çš„Pé‡Œæ‹¿ä¸€äº›Gæ¥æ‰§è¡Œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœPä»å…¶ä»–çš„Pé‚£é‡Œè¦æ‹¿ä»»åŠ¡çš„è¯ï¼Œä¸€èˆ¬å°±æ‹¿runqueueçš„ä¸€åŠï¼Œè¿™å°±ç¡®ä¿äº†æ¯ä¸ªOSçº¿ç¨‹éƒ½èƒ½å……åˆ†çš„ä½¿ç”¨ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‰ã€goroutineä½¿ç”¨åŸºæœ¬ä½¿ç”¨è®¾ç½®goroutineè¿è¡Œçš„CPUæ•°é‡ï¼Œæœ€æ–°ç‰ˆæœ¬çš„goå·²ç»é»˜è®¤å·²ç»è®¾ç½®äº†ã€‚ 12num := runtime.NumCPU() //è·å–ä¸»æœºçš„é€»è¾‘CPUä¸ªæ•°runtime.GOMAXPROCS(num) //è®¾ç½®å¯åŒæ—¶æ‰§è¡Œçš„æœ€å¤§CPUæ•°ï¼Œå³è®¾ç½®å¤šå°‘ä¸ªP ä½¿ç”¨ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930package mainimport ( "fmt" "time")func cal(a int , b int ) &#123; c := a+b fmt.Printf("%d + %d = %d\n",a,b,c)&#125;func main() &#123; for i :=0 ; i&lt;10 ;i++&#123; go cal(i,i+1) //å¯åŠ¨10ä¸ªgoroutine æ¥è®¡ç®— &#125; time.Sleep(time.Second * 2) // sleepä½œç”¨æ˜¯ä¸ºäº†ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ&#125; //ç»“æœ//8 + 9 = 17//9 + 10 = 19//4 + 5 = 9//5 + 6 = 11//0 + 1 = 1//1 + 2 = 3//2 + 3 = 5//3 + 4 = 7//7 + 8 = 15//6 + 7 = 13 goroutineå¼‚å¸¸æ•æ‰å½“å¯åŠ¨å¤šä¸ªgoroutineæ—¶ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªgoroutineå¼‚å¸¸äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œé‚£ä¹ˆæ•´ä¸ªç¨‹åºéƒ½ä¼šç»ˆæ­¢ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¼–å†™ç¨‹åºæ—¶å€™æœ€å¥½æ¯ä¸ªgoroutineæ‰€è¿è¡Œçš„å‡½æ•°éƒ½åšå¼‚å¸¸å¤„ç†ï¼Œå¼‚å¸¸å¤„ç†é‡‡ç”¨recover 123456789101112131415161718192021222324252627282930313233343536package mainimport ( "fmt" "time")func addele(a []int ,i int) &#123; defer func() &#123; //åŒ¿åå‡½æ•°æ•è·é”™è¯¯ err := recover() if err != nil &#123; fmt.Println("add ele fail") &#125; &#125;() a[i]=i fmt.Println(a)&#125;func main() &#123; Arry := make([]int,4) for i :=0 ; i&lt;10 ;i++&#123; go addele(Arry,i) &#125; time.Sleep(time.Second * 2)&#125;//ç»“æœadd ele fail[0 0 0 0][0 1 0 0][0 1 2 0][0 1 2 3]add ele failadd ele failadd ele failadd ele failadd ele fail åŒæ­¥çš„goroutineç”±äºgoroutineæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œé‚£å¾ˆæœ‰å¯èƒ½å‡ºç°ä¸»ç¨‹åºé€€å‡ºæ—¶è¿˜æœ‰goroutineæ²¡æœ‰æ‰§è¡Œå®Œï¼Œæ­¤æ—¶goroutineä¹Ÿä¼šè·Ÿç€é€€å‡ºã€‚æ­¤æ—¶å¦‚æœæƒ³ç­‰åˆ°æ‰€æœ‰goroutineä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰é€€å‡ºï¼Œgoæä¾›äº†syncåŒ…å’Œchannelæ¥è§£å†³åŒæ­¥é—®é¢˜ï¼Œå½“ç„¶å¦‚æœä½ èƒ½é¢„æµ‹æ¯ä¸ªgoroutineæ‰§è¡Œçš„æ—¶é—´ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡time.Sleepæ–¹å¼ç­‰å¾…æ‰€æœ‰çš„groutineæ‰§è¡Œå®Œæˆä»¥ååœ¨é€€å‡ºç¨‹åº(å¦‚ä¸Šé¢çš„åˆ—å­)ã€‚ æ–¹æ³•ä¸€ï¼šä½¿ç”¨syncåŒ…åŒæ­¥goroutine è¿™ç§æ–¹æ³•å’Œpythonçš„Thread.join() å¾ˆç±»ä¼¼WaitGroup ç­‰å¾…ä¸€ç»„goroutinueæ‰§è¡Œå®Œæ¯•. ä¸»ç¨‹åºè°ƒç”¨ Add æ·»åŠ ç­‰å¾…çš„goroutinueæ•°é‡. æ¯ä¸ªgoroutinueåœ¨æ‰§è¡Œç»“æŸæ—¶è°ƒç”¨ Done ï¼Œæ­¤æ—¶ç­‰å¾…é˜Ÿåˆ—æ•°é‡å‡1.ï¼Œä¸»ç¨‹åºé€šè¿‡Waité˜»å¡ï¼Œç›´åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸º0. 123456789101112131415161718192021222324252627282930313233package mainimport ( "fmt" "sync")func cal(a int , b int ,n *sync.WaitGroup) &#123; c := a+b fmt.Printf("%d + %d = %d\n",a,b,c) defer n.Done() //goroutinueå®Œæˆå, WaitGroupçš„è®¡æ•°-1&#125;func main() &#123; var go_sync sync.WaitGroup //å£°æ˜ä¸€ä¸ªWaitGroupå˜é‡ for i :=0 ; i&lt;10 ;i++&#123; go_sync.Add(1) // WaitGroupçš„è®¡æ•°åŠ 1 go cal(i,i+1,&amp;go_sync) &#125; go_sync.Wait() //ç­‰å¾…æ‰€æœ‰goroutineæ‰§è¡Œå®Œæ¯•&#125;//ç»“æœ9 + 10 = 192 + 3 = 53 + 4 = 74 + 5 = 95 + 6 = 111 + 2 = 36 + 7 = 137 + 8 = 150 + 1 = 18 + 9 = 17 ç¤ºä¾‹äºŒï¼šé€šè¿‡channelå®ç°goroutineä¹‹é—´çš„åŒæ­¥ã€‚ è¿™ç§æ–¹æ³•ç±»ä¼¼äºpythonçš„Thread.Queue()é€šè®¯ï¼Œæ¥å®ç°å¼‚æ­¥ç¨‹åºå’Œä¸»ç¨‹åºä¹‹é—´çš„æ•°æ®äº¤æ¢å®ç°æ–¹å¼ï¼šé€šè¿‡channelèƒ½åœ¨å¤šä¸ªgroutineä¹‹é—´é€šè®¯ï¼Œå½“ä¸€ä¸ªgoroutineå®Œæˆæ—¶å€™å‘channelå‘é€é€€å‡ºä¿¡å·,ç­‰æ‰€æœ‰goroutineé€€å‡ºæ—¶å€™ï¼Œåˆ©ç”¨forå¾ªç¯channeå»channelä¸­çš„ä¿¡å·ï¼Œè‹¥å–ä¸åˆ°æ•°æ®ä¼šé˜»å¡åŸç†ï¼Œç­‰å¾…æ‰€æœ‰goroutineæ‰§è¡Œå®Œæ¯•ï¼Œä½¿ç”¨è¯¥æ–¹æ³•æœ‰ä¸ªå‰ææ˜¯ä½ å·²ç»çŸ¥é“äº†ä½ å¯åŠ¨äº†å¤šå°‘ä¸ªgoroutineã€‚ 12345678910111213141516171819202122232425package mainimport ( "fmt" "time")func cal(a int , b int ,Exitchan chan bool) &#123; c := a+b fmt.Printf("%d + %d = %d\n",a,b,c) time.Sleep(time.Second*2) Exitchan &lt;- true&#125;func main() &#123; Exitchan := make(chan bool,10) //å£°æ˜å¹¶åˆ†é…ç®¡é“å†…å­˜ for i :=0 ; i&lt;10 ;i++&#123; go cal(i,i+1,Exitchan) &#125; for j :=0; j&lt;10; j++&#123; &lt;- Exitchan //å–ä¿¡å·æ•°æ®ï¼Œå¦‚æœå–ä¸åˆ°åˆ™ä¼šé˜»å¡ &#125; close(Exitchan) // å…³é—­ç®¡é“&#125; goroutineä¹‹é—´çš„é€šè®¯goroutineæœ¬è´¨ä¸Šæ˜¯åç¨‹ï¼Œå¯ä»¥ç†è§£ä¸ºä¸å—å†…æ ¸è°ƒåº¦ï¼Œè€Œå—goè°ƒåº¦å™¨ç®¡ç†çš„çº¿ç¨‹ã€‚goroutineä¹‹é—´å¯ä»¥é€šè¿‡channelè¿›è¡Œé€šä¿¡æˆ–è€…è¯´æ˜¯æ•°æ®å…±äº«ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡æ¥è¿›è¡Œæ•°æ®å…±äº«ã€‚ ç¤ºä¾‹ï¼šä½¿ç”¨channelæ¨¡æ‹Ÿæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…æ¨¡å¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package mainimport ( "fmt" "sync")func Productor(mychan chan int,data int,wait *sync.WaitGroup) &#123; mychan &lt;- data fmt.Println("product dataï¼š",data) wait.Done()&#125;func Consumer(mychan chan int,wait *sync.WaitGroup) &#123; a := &lt;- mychan fmt.Println("consumer dataï¼š",a) wait.Done()&#125;func main() &#123; datachan := make(chan int, 100) //é€šè®¯æ•°æ®ç®¡é“ var wg sync.WaitGroup for i := 0; i &lt; 10; i++ &#123; go Productor(datachan, i,&amp;wg) //ç”Ÿäº§æ•°æ® wg.Add(1) &#125; for j := 0; j &lt; 10; j++ &#123; go Consumer(datachan,&amp;wg) //æ¶ˆè´¹æ•°æ® wg.Add(1) &#125; wg.Wait()&#125;//ç»“æœconsumer dataï¼š 4product dataï¼š 5product dataï¼š 6product dataï¼š 7product dataï¼š 8product dataï¼š 9consumer dataï¼š 1consumer dataï¼š 5consumer dataï¼š 6consumer dataï¼š 7consumer dataï¼š 8consumer dataï¼š 9product dataï¼š 2consumer dataï¼š 2product dataï¼š 3consumer dataï¼š 3product dataï¼š 4consumer dataï¼š 0product dataï¼š 0product dataï¼š 1 å››ã€Golang - channelç®€ä»‹channelä¿—ç§°ç®¡é“ï¼Œç”¨äºæ•°æ®ä¼ é€’æˆ–æ•°æ®å…±äº«ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œä½¿ç”¨goroutine+channelè¿›è¡Œæ•°æ®é€šè®¯ç®€å•é«˜æ•ˆï¼ŒåŒæ—¶ä¹Ÿçº¿ç¨‹å®‰å…¨ï¼Œå¤šä¸ªgoroutineå¯åŒæ—¶ä¿®æ”¹ä¸€ä¸ªchannelï¼Œä¸éœ€è¦åŠ é”ã€‚ channelå¯åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šåªè¯»channelï¼šåªèƒ½è¯»channelé‡Œé¢æ•°æ®ï¼Œä¸å¯å†™å…¥åªå†™channelï¼šåªèƒ½å†™æ•°æ®ï¼Œä¸å¯è¯»ä¸€èˆ¬channelï¼šå¯è¯»å¯å†™ channelä½¿ç”¨å®šä¹‰å’Œå£°æ˜12345678910// å®šä¹‰var readOnlyChan &lt;-chan int // åªè¯»chanvar writeOnlyChan chan&lt;- int // åªå†™chanvar mychan chan int //è¯»å†™channel//å£°æ˜read_only := make (&lt;-chan int,10)//å®šä¹‰åªè¯»çš„channelï¼Œ æœ‰ç¼“å­˜write_only := make (chan&lt;- int,10)//å®šä¹‰åªå†™çš„channelï¼Œ æœ‰ç¼“å­˜read_write := make (chan int,10)//å¯åŒæ—¶è¯»å†™ï¼Œ æœ‰ç¼“å­˜read_write := make (chan int)//å¯åŒæ—¶è¯»å†™ï¼Œ æ— ç¼“å­˜ è¯»å†™æ•°æ®éœ€è¦æ³¨æ„ å¦‚æœæ²¡æœ‰ä½¿ç”¨goroutineï¼Œå¦‚æœæœªå…³é—­channelï¼Œè¯»å–æ•°æ®ä¼šäº§ç”Ÿdeadlockå¼‚å¸¸ ç®¡é“å¦‚æœå…³é—­åå†ç»§ç»­å†™å…¥æ•°æ®ä¼špannic å¦‚æœæ˜¯æœ‰ç¼“å­˜channelï¼Œå½“ç®¡é“ä¸­æ²¡æœ‰æ•°æ®æ—¶å€™å†è¡Œè¯»å–ä¼šè¯»å–åˆ°é»˜è®¤å€¼ï¼Œå¦‚intç±»å‹é»˜è®¤å€¼æ˜¯0 1234ch &lt;- "wd" //å†™æ•°æ®a := &lt;- ch //è¯»å–æ•°æ®a, ok := &lt;-ch //ä¼˜é›…çš„è¯»å–æ•°æ®for v := range ch &#123;&#125; // éå†å·²ç»å…³é—­çš„channel å¾ªç¯ç®¡é“éœ€è¦æ³¨æ„ ä½¿ç”¨rangeå¾ªç¯ç®¡é“ï¼Œå¦‚æœç®¡é“æœªå…³é—­ä¼šå¼•å‘deadlocké”™è¯¯ã€‚ å¦‚æœé‡‡ç”¨for range å¾ªç¯å·²ç»å…³é—­çš„ç®¡é“ï¼Œå½“ç®¡é“æ²¡æœ‰æ•°æ®æ—¶å€™ï¼Œè¯»å–çš„æ•°æ®ä¼šæ˜¯ç®¡é“çš„é»˜è®¤å€¼ï¼Œå¹¶ä¸”å¾ªç¯ä¸ä¼šé€€å‡ºã€‚ 12345678910111213141516171819package mainimport ( "fmt" "time")func main() &#123; mychannel := make(chan int,10) for i := 0;i &lt; 10;i++&#123; mychannel &lt;- i &#125; close(mychannel) //å…³é—­ç®¡é“ fmt.Println("data lenght: ",len(mychannel)) for v := range mychannel &#123; //å¾ªç¯ç®¡é“ fmt.Println(v) &#125; fmt.Printf("data lenght: %d",len(mychannel))&#125; å¸¦ç¼“å†²åŒºchanneå’Œä¸å¸¦ç¼“å†²åŒºchannelå¸¦ç¼“å†²åŒºchannelï¼šå®šä¹‰å£°æ˜æ—¶å€™åˆ¶å®šäº†ç¼“å†²åŒºå¤§å°(é•¿åº¦)ï¼Œå¯ä»¥ä¿å­˜å¤šä¸ªæ•°æ®ã€‚ä¸å¸¦ç¼“å†²åŒºchannelï¼šåªèƒ½å­˜ä¸€ä¸ªæ•°æ®ï¼Œå¹¶ä¸”åªæœ‰å½“è¯¥æ•°æ®è¢«å–å‡ºæ‰èƒ½å­˜ä¸‹ä¸ªæ•°æ® 12ch := make(chan int) //ä¸å¸¦ç¼“å†²åŒºch := make(chan int ,10) //å¸¦ç¼“å†²åŒº ä¸å¸¦ç¼“å†²åŒºç¤ºä¾‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940package mainimport "fmt"func test(c chan int) &#123; for i := 0; i &lt; 10; i++ &#123; fmt.Println("send ", i) c &lt;- i &#125;&#125;func main() &#123; ch := make(chan int) go test(ch) for j := 0; j &lt; 10; j++ &#123; fmt.Println("get ", &lt;-ch) &#125;&#125;//ç»“æœï¼šsend 0send 1get 0get 1send 2send 3get 2get 3send 4send 5get 4get 5send 6send 7get 6get 7send 8send 9get 8get 9 Channelçš„deadlockä¸€ä¸ªæ­»é”çš„ä¾‹å­: 1234func main() &#123; ch := make(chan int) &lt;- ch // é˜»å¡main goroutine, ä¿¡é“chè¢«é”&#125; æ‰§è¡Œè¿™ä¸ªç¨‹åºä½ ä¼šçœ‹åˆ°GoæŠ¥è¿™æ ·çš„é”™è¯¯: 1fatal error: all goroutines are asleep - deadlock! *ä½•è°“æ­»é”? *æ“ä½œç³»ç»Ÿæœ‰è®²è¿‡çš„ï¼Œæ‰€æœ‰çš„çº¿ç¨‹æˆ–è¿›ç¨‹éƒ½åœ¨ç­‰å¾…èµ„æºçš„é‡Šæ”¾ã€‚å¦‚ä¸Šçš„ç¨‹åºä¸­, åªæœ‰ä¸€ä¸ªgoroutine, æ‰€ä»¥å½“ä½ å‘é‡Œé¢åŠ æ•°æ®æˆ–è€…å­˜æ•°æ®çš„è¯ï¼Œéƒ½ä¼šé”æ­»ä¿¡é“ï¼Œ å¹¶ä¸”é˜»å¡å½“å‰ goroutine, ä¹Ÿå°±æ˜¯æ‰€æœ‰çš„goroutine(å…¶å®å°±mainçº¿ä¸€ä¸ª)éƒ½åœ¨ç­‰å¾…ä¿¡é“çš„å¼€æ”¾(æ²¡äººæ‹¿èµ°æ•°æ®ä¿¡é“æ˜¯ä¸ä¼šå¼€æ”¾çš„)ï¼Œä¹Ÿå°±æ˜¯æ­»é”å’¯ã€‚ å…¶å®ï¼Œæ€»ç»“æ¥çœ‹ï¼Œä¸ºä»€ä¹ˆä¼šæ­»é”ï¼Ÿéç¼“å†²ä¿¡é“ä¸Šå¦‚æœå‘ç”Ÿäº†æµå…¥æ— æµå‡ºï¼Œæˆ–è€…æµå‡ºæ— æµå…¥ï¼Œä¹Ÿå°±å¯¼è‡´äº†æ­»é”ã€‚æˆ–è€…è¿™æ ·ç†è§£ Goå¯åŠ¨çš„æ‰€æœ‰goroutineé‡Œçš„éç¼“å†²ä¿¡é“ä¸€å®šè¦ä¸€ä¸ªçº¿é‡Œå­˜æ•°æ®ï¼Œä¸€ä¸ªçº¿é‡Œå–æ•°æ®ï¼Œè¦æˆå¯¹æ‰è¡Œ é‚£ä¹ˆæ­»é”çš„è§£å†³åŠæ³•å‘¢ï¼Ÿæœ€ç®€å•çš„ï¼ŒæŠŠæ²¡å–èµ°çš„æ•°æ®å–èµ°ï¼Œæ²¡æ”¾å…¥çš„æ•°æ®æ”¾å…¥ï¼Œ å› ä¸ºæ— ç¼“å†²ä¿¡é“ä¸èƒ½æ‰¿è½½æ•°æ®ï¼Œé‚£ä¹ˆå°±èµ¶ç´§æ‹¿èµ°ï¼ Goçš„deadlock ä¿¡é“æ•°æ®ä½ ä¹Ÿè®¸å‘ç°ï¼Œä¸Šé¢çš„ä»£ç ä¸€ä¸ªä¸€ä¸ªåœ°å»è¯»å–ä¿¡é“ç®€ç›´å¤ªè´¹äº‹äº†ï¼ŒGoè¯­è¨€å…è®¸æˆ‘ä»¬ä½¿ç”¨rangeæ¥è¯»å–ä¿¡é“: 12345678910func main() &#123; ch := make(chan int, 3) ch &lt;- 1 ch &lt;- 2 ch &lt;- 3 for v := range ch &#123; fmt.Println(v) &#125;&#125; å¦‚æœä½ æ‰§è¡Œäº†ä¸Šé¢çš„ä»£ç ï¼Œä¼šæŠ¥æ­»é”é”™è¯¯çš„ï¼ŒåŸå› æ˜¯rangeä¸ç­‰åˆ°ä¿¡é“å…³é—­æ˜¯ä¸ä¼šç»“æŸè¯»å–çš„ã€‚ä¹Ÿå°±æ˜¯å¦‚æœ ç¼“å†²ä¿¡é“å¹²æ¶¸äº†ï¼Œé‚£ä¹ˆrangeå°±ä¼šé˜»å¡å½“å‰goroutine, æ‰€ä»¥æ­»é”å’¯ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬è¯•ç€é¿å…è¿™ç§æƒ…å†µï¼Œæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ˜¯è¯»åˆ°ä¿¡é“ä¸ºç©ºçš„æ—¶å€™å°±ç»“æŸè¯»å–: 12345678910ch := make(chan int, 3)ch &lt;- 1ch &lt;- 2ch &lt;- 3for v := range ch &#123; fmt.Println(v) if len(ch) &lt;= 0 &#123; // å¦‚æœç°æœ‰æ•°æ®é‡ä¸º0ï¼Œè·³å‡ºå¾ªç¯ break &#125;&#125; ä»¥ä¸Šçš„æ–¹æ³•æ˜¯å¯ä»¥æ­£å¸¸è¾“å‡ºçš„ï¼Œä½†æ˜¯æ³¨æ„æ£€æŸ¥ä¿¡é“å¤§å°çš„æ–¹æ³•ä¸èƒ½åœ¨ä¿¡é“å­˜å–éƒ½åœ¨å‘ç”Ÿçš„æ—¶å€™ç”¨äºå–å‡ºæ‰€æœ‰æ•°æ®ï¼Œè¿™ä¸ªä¾‹å­ æ˜¯å› ä¸ºæˆ‘ä»¬åªåœ¨chä¸­å­˜äº†æ•°æ®ï¼Œç°åœ¨ä¸€ä¸ªä¸€ä¸ªå¾€å¤–å–ï¼Œä¿¡é“å¤§å°æ˜¯é€’å‡çš„ã€‚ å¦ä¸€ä¸ªæ–¹å¼æ˜¯æ˜¾å¼åœ°å…³é—­ä¿¡é“: 1234567891011ch := make(chan int, 3)ch &lt;- 1ch &lt;- 2ch &lt;- 3// æ˜¾å¼åœ°å…³é—­ä¿¡é“close(ch)for v := range ch &#123; fmt.Println(v)&#125; è¢«å…³é—­çš„ä¿¡é“ä¼šç¦æ­¢æ•°æ®æµå…¥, æ˜¯åªè¯»çš„ã€‚æˆ‘ä»¬ä»ç„¶å¯ä»¥ä»å…³é—­çš„ä¿¡é“ä¸­å–å‡ºæ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½å†å†™å…¥æ•°æ®äº†ã€‚ channelå®ç°ä½œä¸šæ± æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªchannelï¼Œä¸€ä¸ªchannelç”¨äºæ¥å—ä»»åŠ¡ï¼Œä¸€ä¸ªchannelç”¨äºä¿æŒç»“æœï¼Œè¿˜æœ‰ä¸ªchannelç”¨äºå†³å®šç¨‹åºé€€å‡ºçš„æ—¶å€™ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package mainimport ( "fmt")func Task(taskch, resch chan int, exitch chan bool) &#123; defer func() &#123; //å¼‚å¸¸å¤„ç† err := recover() if err != nil &#123; fmt.Println("do task errorï¼š", err) return &#125; &#125;() for t := range taskch &#123; // å¤„ç†ä»»åŠ¡ fmt.Println("do task :", t) resch &lt;- t // &#125; exitch &lt;- true //å¤„ç†å®Œå‘é€é€€å‡ºä¿¡å·&#125;func main() &#123; taskch := make(chan int, 20) //ä»»åŠ¡ç®¡é“ resch := make(chan int, 20) //ç»“æœç®¡é“ exitch := make(chan bool, 5) //é€€å‡ºç®¡é“ go func() &#123; for i := 0; i &lt; 10; i++ &#123; taskch &lt;- i &#125; close(taskch) &#125;() for i := 0; i &lt; 5; i++ &#123; //å¯åŠ¨5ä¸ªgoroutineåšä»»åŠ¡ go Task(taskch, resch, exitch) &#125; go func() &#123; //ç­‰5ä¸ªgoroutineç»“æŸ for i := 0; i &lt; 5; i++ &#123; &lt;-exitch &#125; close(resch) //ä»»åŠ¡å¤„ç†å®Œæˆå…³é—­ç»“æœç®¡é“ï¼Œä¸ç„¶rangeæŠ¥é”™ close(exitch) //å…³é—­é€€å‡ºç®¡é“ &#125;() for res := range resch&#123; //æ‰“å°ç»“æœ fmt.Println("task resï¼š",res) &#125;&#125; åªè¯»channelå’Œåªå†™channelä¸€èˆ¬å®šä¹‰åªè¯»å’Œåªå†™çš„ç®¡é“æ„ä¹‰ä¸å¤§ï¼Œæ›´å¤šæ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨å‚æ•°ä¼ é€’æ—¶å€™æŒ‡æ˜ç®¡é“å¯è¯»è¿˜æ˜¯å¯å†™ï¼Œå³ä½¿å½“å‰ç®¡é“æ˜¯å¯è¯»å†™çš„ã€‚ 1234567891011121314151617181920212223242526package mainimport ( "fmt" "time")//åªèƒ½å‘chané‡Œå†™æ•°æ®func send(c chan&lt;- int) &#123; for i := 0; i &lt; 10; i++ &#123; c &lt;- i &#125;&#125;//åªèƒ½å–channelä¸­çš„æ•°æ®func get(c &lt;-chan int) &#123; for i := range c &#123; fmt.Println(i) &#125;&#125;func main() &#123; c := make(chan int) go send(c) go get(c) time.Sleep(time.Second*1)&#125;//ç»“æœ select-caseå®ç°éé˜»å¡channelåŸç†é€šè¿‡select+caseåŠ å…¥ä¸€ç»„ç®¡é“ï¼Œå½“æ»¡è¶³ï¼ˆè¿™é‡Œè¯´çš„æ»¡è¶³æ„æ€æ˜¯æœ‰æ•°æ®å¯è¯»æˆ–è€…å¯å†™)selectä¸­çš„æŸä¸ªcaseæ—¶å€™ï¼Œé‚£ä¹ˆè¯¥caseè¿”å›ï¼Œè‹¥éƒ½ä¸æ»¡è¶³caseï¼Œåˆ™èµ°defaultåˆ†æ”¯ã€‚ 12345678910111213141516171819202122232425262728293031package mainimport ( "fmt")func send(c chan int) &#123; for i :=1 ; i&lt;10 ;i++ &#123; c &lt;-i fmt.Println("send data : ",i) &#125;&#125;func main() &#123; resch := make(chan int,20) strch := make(chan string,10) go send(resch) strch &lt;- "wd" select &#123; case a := &lt;-resch: fmt.Println("get data : ", a) case b := &lt;-strch: fmt.Println("get data : ", b) default: fmt.Println("no channel actvie") &#125;&#125;//ç»“æœï¼šget data : wd channelé¢‘ç‡æ§åˆ¶åœ¨å¯¹channelè¿›è¡Œè¯»å†™çš„æ—¶ï¼Œgoè¿˜æä¾›äº†éå¸¸äººæ€§åŒ–çš„æ“ä½œï¼Œé‚£å°±æ˜¯å¯¹è¯»å†™çš„é¢‘ç‡æ§åˆ¶ï¼Œé€šè¿‡time.Tickeå®ç° ç¤ºä¾‹ï¼š 123456789101112131415161718192021222324package mainimport ( "time" "fmt")func main()&#123; requests:= make(chan int ,5) for i:=1;i&lt;5;i++&#123; requests&lt;-i &#125; close(requests) limiter := time.Tick(time.Second*1) for req:=range requests&#123; &lt;-limiter fmt.Println("requets",req,time.Now()) //æ‰§è¡Œåˆ°è¿™é‡Œï¼Œéœ€è¦éš”1ç§’æ‰ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œtime.Tick(timer)ä¸Šé¢å·²å®šä¹‰ &#125;&#125;//ç»“æœï¼šrequets 1 2018-07-06 10:17:35.98056403 +0800 CST m=+1.004248763requets 2 2018-07-06 10:17:36.978123472 +0800 CST m=+2.001798205requets 3 2018-07-06 10:17:37.980869517 +0800 CST m=+3.004544250requets 4 2018-07-06 10:17:38.976868836 +0800 CST m=+4.000533569]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangç‰¹æ€§</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[beego swagger]]></title>
    <url>%2F2019%2F01%2F02%2F11.Golang%2FGolang%E5%B7%A5%E5%85%B7%E5%8C%85%2Fbeego%20%20swagger%2F</url>
    <content type="text"><![CDATA[beego swager è‡ªåŠ¨åŒ–æ–‡æ¡£é…ç½®é…ç½®åŒºåŸŸ å…¨å±€é…ç½® å…¨å±€é…ç½®æ˜¯å¯¹æ•´ä¸ªé¡¹ç›®apiçš„ä»‹ç»å’Œç‰ˆæœ¬å’Œåç§°ç›¸å…³çš„é…ç½®ï¼Œé…ç½®ä½ç½®åœ¨/routers/router.goï¼Œé…ç½®åœ¨routeræ–‡ä»¶çš„æœ€é¡¶éƒ¨ ç¤ºä¾‹: 12345678// @APIVersion 1.0.0// @Title é¡¹ç›®çš„æ ‡é¢˜// @Description é¡¹ç›®çš„æè¿°.// @Contact xxx@xxx.com// @TermsOfServiceUrl termsOfServiceUrl// @License licence// @LicenseUrl licenceUrlpackage routers å…¨å±€çš„æ³¨é‡Šå¦‚ä¸Šæ‰€ç¤ºï¼Œæ˜¯æ˜¾ç¤ºç»™å…¨å±€åº”ç”¨çš„è®¾ç½®ä¿¡æ¯ï¼Œæœ‰å¦‚ä¸‹è¿™äº›è®¾ç½® @APIVersionï¼š é¡¹ç›®ç‰ˆæœ¬ @Title: é¡¹ç›®æ ‡é¢˜ @Description: é¡¹ç›®æè¿° @Contact: è”ç³»æ–¹å¼ @Licenseï¼šæ”¯æŒè¯ä¹¦ @LicenseUrl: è¯ä¹¦åœ°å€ è·¯ç”±é…ç½® ç›®å‰è‡ªåŠ¨åŒ–æ–‡æ¡£åªæ”¯æŒå¦‚ä¸‹çš„å†™æ³•çš„è§£æï¼Œå…¶ä»–å†™æ³•å‡½æ•°ä¸ä¼šè‡ªåŠ¨è§£æï¼Œå³ namespace+Include çš„å†™æ³•ï¼Œè€Œä¸”åªæ”¯æŒäºŒçº§è§£æï¼Œä¸€çº§ç‰ˆæœ¬å·ï¼ŒäºŒçº§åˆ†åˆ«è¡¨ç¤ºåº”ç”¨æ¨¡å— æ³¨æ„: è¿˜éœ€è¦æ·»åŠ  beego.SetStaticPath(â€œ/swaggerâ€, â€œswaggerâ€) è¿™æ¡è·¯ç”±è§„åˆ™ï¼Œè¿™æ ·æ‰å¯ä»¥è·¯ç”±åˆ°swaggeræ–‡æ¡£ ç¤ºä¾‹: 123456789101112func init() &#123; ns := beego.NewNamespace("/v1", beego.NSNamespace("/demo", beego.NSInclude( &amp;controllers.DemoController&#123;&#125;, ), ), ) beego.AddNamespace(ns) beego.SetStaticPath("/swagger", "swagger")&#125; åº”ç”¨é…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879package controllersimport ( "beego-swagger/models" "fmt" "github.com/astaxie/beego" "strconv" "time")// Controller çš„æ ‡é¢˜type DemoController struct &#123; beego.Controller&#125;func (c *DemoController) URLMapping() &#123; c.Mapping("GetDemo", c.GetDemo) c.Mapping("PostDemo", c.PostDemo)&#125;// @Title getDemo apiçš„æ ‡é¢˜// @Description getDemo apiçš„ä»‹ç»ä¿¡æ¯// Param api å‚æ•°ä¿¡æ¯, åŒ…å«äº”ä¸ªå‚æ•°: 1.å‚æ•°å 2.å‚æ•°ç±»å‹(queryã€pathã€header) 3.å‚æ•°æ•°æ®ç±»å‹ 4.æ˜¯å¦å¿…é¡» 5.æ³¨é‡Š// @Param key path string true è·¯å¾„å‚æ•°key,1-100ä¹‹é—´çš„æ•°å­—// @Param param query string false urlå‚æ•°param// Success æˆåŠŸç›¸åº”æ¶ˆæ¯, æ¥å—ä¸‰ä¸ªå‚æ•°: 1.status code 2.å‚æ•°ç±»å‹ï¼Œå¿…é¡»ç”¨&#123;&#125;æ‹¬èµ·æ¥ 3.å¯¹è±¡çš„å­—ç¬¦ä¸²ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ &#123;object&#125; ç±»å‹ï¼Œé‚£ä¹ˆ bee å·¥å…·åœ¨ç”Ÿæˆ docs çš„æ—¶å€™ä¼šæ‰«æå¯¹åº”çš„å¯¹è±¡ï¼Œè¿™é‡Œå¡«å†™çš„æ˜¯æƒ³å¯¹ä½ é¡¹ç›®çš„ç›®å½•åå’Œå¯¹è±¡// @Success 200 &#123;object&#125; models.SuccessGetResponse// Failure å¤±è´¥ç›¸åº”æ¶ˆæ¯, æ¥å—ä¸¤ä¸ªå‚æ•°: 1.status code 2.é”™è¯¯ä¿¡æ¯// @Failure 400 Invalid email supplied// @Failure 500 get getDemo response error// router è·¯ç”±ä¿¡æ¯, æ¥å—ä¸¤ä¸ªå‚æ•°: 1.è¯·æ±‚çš„è·¯ç”±åœ°å€ 2.æ”¯æŒçš„è¯·æ±‚æ–¹æ³•, æ”¾åœ¨[]ä¸­ï¼Œå¯ä»¥å†™å¤šä¸ªç”¨,éš”å¼€// @router /getdemo/:key [get]func (c *DemoController) GetDemo() &#123; rsp := models.SuccessGetResponse&#123; Time: time.Now().Format("2006-01-02 15:04:05"), &#125; keyParam := c.Ctx.Input.Param(":key") if keyParam == "" &#123; c.Ctx.Output.Status = 400 &#125; else &#123; keyInt, err := strconv.Atoi(keyParam) if err != nil || (1&gt;keyInt || keyInt&gt;100) &#123; c.Ctx.Output.Status = 400 &#125; else &#123; rsp.Message = fmt.Sprintf("receire key: %s, param: %s", keyParam, c.GetString("param")) &#125; &#125; c.Data["json"] = rsp c.ServeJSON()&#125;// @Title postDemo apiçš„æ ‡é¢˜// @Description postDemo apiçš„ä»‹ç»ä¿¡æ¯// Param api å‚æ•°ä¿¡æ¯, åŒ…å«äº”ä¸ªå‚æ•°: 1.å‚æ•°å 2.å‚æ•°ç±»å‹(formDataã€queryã€pathã€bodyã€header) 3.å‚æ•°æ•°æ®ç±»å‹ 4.æ˜¯å¦å¿…é¡» 5.æ³¨é‡Š// @Param form1 formData int true formDataå‚æ•°1,å¿…é¡»æ˜¯å¶æ•°// @Param form2 formData string false formDataå‚æ•°2// @Param X-header header string true headerå‚æ•°// Success æˆåŠŸç›¸åº”æ¶ˆæ¯, æ¥å—ä¸‰ä¸ªå‚æ•°: 1.status code 2.å‚æ•°ç±»å‹ï¼Œå¿…é¡»ç”¨&#123;&#125;æ‹¬èµ·æ¥ 3.å¯¹è±¡çš„å­—ç¬¦ä¸²ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ &#123;object&#125; ç±»å‹ï¼Œé‚£ä¹ˆ bee å·¥å…·åœ¨ç”Ÿæˆ docs çš„æ—¶å€™ä¼šæ‰«æå¯¹åº”çš„å¯¹è±¡ï¼Œè¿™é‡Œå¡«å†™çš„æ˜¯æƒ³å¯¹ä½ é¡¹ç›®çš„ç›®å½•åå’Œå¯¹è±¡// @Success 200 &#123;object&#125; models.SuccessPostResponse// Failure å¤±è´¥ç›¸åº”æ¶ˆæ¯, æ¥å—ä¸¤ä¸ªå‚æ•°: 1.status code 2.é”™è¯¯ä¿¡æ¯// @Failure 400 no enough input// @Failure 500 get postDemo response error// router è·¯ç”±ä¿¡æ¯, æ¥å—ä¸¤ä¸ªå‚æ•°: 1.è¯·æ±‚çš„è·¯ç”±åœ°å€ 2.æ”¯æŒçš„è¯·æ±‚æ–¹æ³•, æ”¾åœ¨[]ä¸­ï¼Œå¯ä»¥å†™å¤šä¸ªç”¨,éš”å¼€// @router /postdemo [post]func (c *DemoController) PostDemo() &#123; rsp := models.SuccessPostResponse&#123; Time: time.Now().Format("2006-01-02 15:04:05"), &#125; form1Param, err := c.GetInt("form1") form2Param := c.GetString("form2") header := c.Ctx.Input.Header("X-header") if form1Param%2 != 0 || err != nil &#123; c.Ctx.Output.Status = 400 &#125; else &#123; rsp.Message = fmt.Sprintf("receire form1: %d, form2: %s, X-header: %s", form1Param, form2Param, header) &#125; c.Data["json"] = rsp c.ServeJSON()&#125; æ³¨é‡Šè§£é‡Š: DemoControllerä¸Šé¢çš„æ³¨é‡Šï¼Œ è¿™ä¸ªæ˜¯è¯¥controlleræ¨¡å—çš„æ ‡é¢˜; @Title è¿™ä¸ª API æ‰€è¡¨è¾¾çš„å«ä¹‰ï¼Œæ˜¯ä¸€ä¸ªæ–‡æœ¬ï¼Œç©ºæ ¼ä¹‹åçš„å†…å®¹å…¨éƒ¨è§£æä¸º title @Description è¿™ä¸ª API è¯¦ç»†çš„æè¿°ï¼Œæ˜¯ä¸€ä¸ªæ–‡æœ¬ï¼Œç©ºæ ¼ä¹‹åçš„å†…å®¹å…¨éƒ¨è§£æä¸º Description @Param å‚æ•°ï¼Œè¡¨ç¤ºéœ€è¦ä¼ é€’åˆ°æœåŠ¡å™¨ç«¯çš„å‚æ•°ï¼Œæœ‰äº”åˆ—å‚æ•°ï¼Œä½¿ç”¨ç©ºæ ¼æˆ–è€… tab åˆ†å‰²ï¼Œäº”ä¸ªåˆ†åˆ«è¡¨ç¤ºçš„å«ä¹‰å¦‚ä¸‹ å‚æ•°å å‚æ•°ç±»å‹ï¼Œå¯ä»¥æœ‰çš„å€¼æ˜¯ formDataã€queryã€pathã€bodyã€headerï¼ŒformData è¡¨ç¤ºæ˜¯ post è¯·æ±‚çš„æ•°æ®ï¼Œquery è¡¨ç¤ºå¸¦åœ¨ url ä¹‹åçš„å‚æ•°ï¼Œpath è¡¨ç¤ºè¯·æ±‚è·¯å¾„ä¸Šå¾—å‚æ•°ï¼Œä¾‹å¦‚ä¸Šé¢ä¾‹å­é‡Œé¢çš„ keyï¼Œbody è¡¨ç¤ºæ˜¯ä¸€ä¸ª raw æ•°æ®è¯·æ±‚ï¼Œheader è¡¨ç¤ºå¸¦åœ¨ header ä¿¡æ¯ä¸­å¾—å‚æ•°ã€‚ å‚æ•°ç±»å‹ æ˜¯å¦å¿…é¡» æ³¨é‡Š @Success æˆåŠŸè¿”å›ç»™å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ status codeã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿”å›çš„ç±»å‹ï¼Œå¿…é¡»ä½¿ç”¨ {} åŒ…å«ï¼Œç¬¬ä¸‰ä¸ªæ˜¯è¿”å›çš„å¯¹è±¡æˆ–è€…å­—ç¬¦ä¸²ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ {object} ç±»å‹ï¼Œé‚£ä¹ˆ bee å·¥å…·åœ¨ç”Ÿæˆ docs çš„æ—¶å€™ä¼šæ‰«æå¯¹åº”çš„å¯¹è±¡ï¼Œè¿™é‡Œå¡«å†™çš„æ˜¯æƒ³å¯¹ä½ é¡¹ç›®çš„ç›®å½•åå’Œå¯¹è±¡ï¼Œä¾‹å¦‚ models.ZDTProduct.ProductList å°±è¡¨ç¤º /models/ZDTProduct ç›®å½•ä¸‹çš„ ProductList å¯¹è±¡ã€‚ @Failure â€‹ å¤±è´¥è¿”å›çš„ä¿¡æ¯ï¼ŒåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤º status codeï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºé”™è¯¯ä¿¡æ¯ @router è·¯ç”±ä¿¡æ¯ï¼ŒåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼Œç¬¬ä¸€ä¸ªæ˜¯è¯·æ±‚çš„è·¯ç”±åœ°å€ï¼Œæ”¯æŒæ­£åˆ™å’Œè‡ªå®šä¹‰è·¯ç”±ï¼Œå’Œä¹‹å‰çš„è·¯ç”±è§„åˆ™ä¸€æ ·ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ”¯æŒçš„è¯·æ±‚æ–¹æ³•,æ”¾åœ¨ [] ä¹‹ä¸­ï¼Œå¦‚æœæœ‰å¤šä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆä½¿ç”¨ , åˆ†éš”ã€‚ æ³¨æ„: æ¯ä¸€è¡Œæ³¨é‡Šå†…çš„æ¯éš”å‚æ•°ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ï¼Œå¹¶ä¸”æœ€å¥½åªç”¨ä¸€ä¸ªç©ºæ ¼ï¼Œä¸ç„¶å¯èƒ½ä¼šäº§ç”Ÿæ˜¾ç¤ºé—®é¢˜ æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç”Ÿæˆå’Œå¯åŠ¨æ­¥éª¤ é¡¹ç›®ä¸ç®¡æ˜¯ä¸æ˜¯ç”¨go-moduleä½œä¸ºåŒ…ç®¡ç†å·¥å…·ï¼Œé¡¹ç›®å¿…é¡»åœ¨ gopath/src ç›®å½• å¼€å¯æ–‡æ¡£å¼€å…³ åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼šEnableDocs = true å¯åŠ¨beegoé¡¹ç›®, å¹¶å¯åŠ¨swaggeræ–‡æ¡£ 12# -gendoc=true è¡¨ç¤ºæ¯æ¬¡è‡ªåŠ¨åŒ–çš„ build æ–‡æ¡£ï¼Œ-downdoc=true å°±ä¼šè‡ªåŠ¨çš„ä¸‹è½½ swagger æ–‡æ¡£æŸ¥çœ‹å™¨bee run -gendoc=true -downdoc=true æŸ¥çœ‹æ–‡æ¡£ åœ°å€: localhost:8080/swagger/ æ–‡æ¡£ç¤ºä¾‹]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangå·¥å…·åŒ…</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>Micro</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Golang reflect interface ç†è§£]]></title>
    <url>%2F2018%2F12%2F22%2F11.Golang%2FGolang%E7%89%B9%E6%80%A7%2F%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%8F%8D%E5%B0%84%E7%9A%84%E6%A6%82%E5%BF%B5%2F</url>
    <content type="text"><![CDATA[ä¸€ã€Golangçš„interface interfaceæ˜¯æ–¹æ³•çš„é›†åˆï¼Œ å…¶æ–¹æ³•ä¸éœ€è¦å®ç° interfaceæ˜¯ä¸€ç§ç±»å‹ï¼Œå¹¶ä¸”æ˜¯æŒ‡é’ˆç±»å‹ interfaceçš„æ›´é‡è¦çš„ä½œç”¨åœ¨äºå¤šæ€å®ç° interfaceå®šä¹‰æ–¹æ³•12345type æ¥å£åç§° interface &#123;method1 (å‚æ•°åˆ—è¡¨) è¿”å›å€¼åˆ—è¡¨method2 (å‚æ•°åˆ—è¡¨) è¿”å›å€¼åˆ—è¡¨...&#125; interfaceä½¿ç”¨ æ¥å£çš„ä½¿ç”¨ä¸ä»…ä»…é’ˆå¯¹ç»“æ„ä½“ï¼Œè‡ªå®šä¹‰ç±»å‹ã€å˜é‡ç­‰ç­‰éƒ½å¯ä»¥å®ç°æ¥å£ã€‚ å¦‚æœä¸€ä¸ªæ¥å£æ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œæˆ‘ä»¬ç§°ä¸ºç©ºæ¥å£ï¼Œç”±äºç©ºæ¥å£æ²¡æœ‰æ–¹æ³•ï¼Œæ‰€ä»¥ä»»ä½•ç±»å‹éƒ½å®ç°äº†ç©ºæ¥å£ã€‚ è¦å®ç°ä¸€ä¸ªæ¥å£ï¼Œå¿…é¡»å®ç°è¯¥æ¥å£é‡Œé¢çš„æ‰€æœ‰æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132package mainimport "fmt"//å®šä¹‰æ¥å£type Skills interface &#123; Running() Getname() string&#125;type Student struct &#123; Name string Age int&#125;// å®ç°æ¥å£func (p Student) Getname() string&#123; //å®ç°Getnameæ–¹æ³• fmt.Println(p.Name ) return p.Name&#125;func (p Student) Running() &#123; // å®ç° Runningæ–¹æ³• fmt.Printf("%s running",p.Name)&#125;func main() &#123; var skill Skills var stu1 Student stu1.Name = "wd" stu1.Age = 22 skill = stu1 skill.Running() //è°ƒç”¨æ¥å£&#125; interfaceåµŒå¥—goè¯­è¨€ä¸­çš„æ¥å£å¯ä»¥åµŒå¥—ï¼Œå¯ä»¥ç†è§£ä¸ºç»§æ‰¿ï¼Œå­æ¥å£æ‹¥æœ‰çˆ¶æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶ä¸”æƒ³è¦ä½¿ç”¨è¯¥å­æ¥å£çš„è¯ï¼Œå¿…é¡»å°†çˆ¶æ¥å£å’Œå­æ¥å£çš„æ‰€æœ‰æ–¹æ³•éƒ½å®ç°ã€‚ 12345678910type Skills interface &#123; Running() Getname() string&#125;type Test interface &#123; sleeping() Skills //ç»§æ‰¿Skills&#125; å¤šæ€çš„æ¦‚å¿µä¸Šé¢æåˆ°äº†ï¼Œgoè¯­è¨€ä¸­interfaceæ˜¯å®ç°å¤šæ€çš„ä¸€ç§å½¢å¼ï¼Œæ‰€å¤šæ€ï¼Œå°±æ˜¯ä¸€ç§äº‹ç‰©çš„å¤šç§å½¢æ€ï¼Œå°±åƒpythonè°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³æ³¨ä¼ å…¥å‚æ•°çš„ç±»å‹ï¼Œæˆ‘ä»¬åªéœ€è¦è®©ä¼ å…¥çš„å‚æ•°å¯ä»¥è¢«æ–¹æ³•ä½¿ç”¨å°±å¯ä»¥ã€‚ åŒä¸€ä¸ªinterfaceï¼Œä¸åŒçš„ç±»å‹å®ç°ï¼Œéƒ½å¯ä»¥è¿›è¡Œè°ƒç”¨ï¼Œå®ƒä»¬éƒ½æŒ‰ç…§ç»Ÿä¸€æ¥å£è¿›è¡Œæ“ä½œã€‚ åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªTeacherç»“æ„ä½“ï¼ŒåŒæ ·å®ç°æ¥å£è¿›è¡Œè¯´æ˜ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package mainimport "fmt"type Skills interface &#123; Running() Getname() string&#125;type Student struct &#123; Name string Age int&#125;type Teacher struct &#123; Name string Salary int&#125;func (p Student) Getname() string&#123; //å®ç°Getnameæ–¹æ³• fmt.Println(p.Name ) return p.Name&#125;func (p Student) Running() &#123; // å®ç° Runningæ–¹æ³• fmt.Printf("%s running",p.Name)&#125;func (p Teacher) Getname() string&#123; //å®ç°Getnameæ–¹æ³• fmt.Println(p.Name ) return p.Name&#125;func (p Teacher) Running() &#123; // å®ç° Runningæ–¹æ³• fmt.Printf("\n%s running",p.Name)&#125;func main() &#123; var skill Skills var stu1 Student var t1 Teacher t1.Name = "wang" stu1.Name = "wd" stu1.Age = 22 skill = stu1 skill.Running() skill = t1 t1.Running()&#125;//wd running//wang running é€šè¿‡interface åˆ¤æ–­ç±»å‹&amp;ç±»å‹è½¬æ¢ç”±äºæ¥å£æ˜¯ä¸€èˆ¬ç±»å‹ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æ¥å£æ—¶å€™å¯èƒ½ä¸çŸ¥é“å®ƒæ˜¯é‚£ä¸ªç±»å‹å®ç°çš„ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹æˆ‘ä»¬æœ‰å¯¹åº”çš„æ–¹æ³•è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå½“ç„¶æ¥å£ç±»å‹ä¹Ÿæœ‰ç±»å‹è½¬æ¢ã€‚ å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªæ–¹å¼æ¥è¿›è¡Œç±»å‹çš„åˆ¤æ–­ã€‚ ç±»å‹è½¬æ¢ç¤ºä¾‹ï¼š 12345var s intvar x interfacex = sy , ok := x.(int) //å°†interface è½¬ä¸ºint,okå¯çœç•¥ ä½†æ˜¯çœç•¥ä»¥åè½¬æ¢å¤±è´¥ä¼šæŠ¥é”™ï¼Œtrueè½¬æ¢æˆåŠŸï¼Œfalseè½¬æ¢å¤±è´¥, å¹¶é‡‡ç”¨é»˜è®¤å€¼ ç±»å‹åˆ¤æ–­ç¤ºä¾‹ï¼š 12345678910111213141516package mainimport "fmt"func main() &#123; var x interface&#123;&#125; s := "WD" x = s y,ok := x.(int) z,ok1 := x.(string) fmt.Println(y,ok) fmt.Println(z,ok1)&#125;//0 false//WD true ç±»å‹åˆ¤æ–­ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435package mainimport "fmt"type Student struct &#123; Name string&#125;func TestType(items ...interface&#123;&#125;) &#123; for k, v := range items &#123; switch v.(type) &#123; case string: fmt.Printf("type is string, %d[%v]\n", k, v) case bool: fmt.Printf("type is bool, %d[%v]\n", k, v) case int: fmt.Printf("type is int, %d[%v]\n", k, v) case float32, float64: fmt.Printf("type is float, %d[%v]\n", k, v) case Student: fmt.Printf("type is Student, %d[%v]\n", k, v) case *Student: fmt.Printf("type is Student, %d[%p]\n", k, v) &#125;&#125;&#125;func main() &#123; var stu StudentTestType("WD", 100, stu,3.3)&#125;//type is string, 0[WD]//type is int, 1[100]//type is Student, 2[&#123;&#125;]//type is float, 3[3.3] interface å’Œ reflectåå°„Golangçš„å˜é‡åŒ…å« type å’Œvalueä¸¤éƒ¨åˆ† type åŒ…æ‹¬ static typeå’Œconcrete type. static typeå°±ç±»ä¼¼pythonçš„ä¸å¯å˜ç±»å‹(å¦‚intã€string)ï¼Œconcrete typeæ˜¯runtimeç³»ç»Ÿçœ‹è§çš„ç±»å‹ ç±»å‹æ–­è¨€èƒ½å¦æˆåŠŸï¼Œå–å†³äºå˜é‡çš„concrete typeï¼Œè€Œä¸æ˜¯static type. Golangçš„é™æ€ç±»å‹å’Œinterfaceç±»å‹ Golangçš„æŒ‡å®šç±»å‹çš„å˜é‡çš„typeæ˜¯é™æ€çš„ï¼ˆä¹Ÿå°±æ˜¯æŒ‡å®šintã€stringè¿™äº›çš„å˜é‡ï¼Œå®ƒçš„typeæ˜¯static typeï¼‰ï¼Œåœ¨åˆ›å»ºå˜é‡çš„æ—¶å€™å°±å·²ç»ç¡®å®š Golangçš„interfaceçš„typeæ˜¯concrete typeã€‚ åœ¨Golangçš„å®ç°ä¸­ï¼Œæ¯ä¸ªinterfaceå˜é‡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”pairï¼Œpairä¸­è®°å½•äº†å®é™…å˜é‡çš„å€¼å’Œç±»å‹(value, type): Golangçš„åå°„ interfaceåŠå…¶pairçš„å­˜åœ¨ï¼Œæ˜¯Golangä¸­å®ç°åå°„çš„å‰æï¼Œç†è§£äº†pairï¼Œå°±æ›´å®¹æ˜“ç†è§£åå°„ã€‚åå°„å°±æ˜¯ç”¨æ¥æ£€æµ‹å­˜å‚¨åœ¨æ¥å£å˜é‡å†…éƒ¨(å€¼valueï¼›ç±»å‹concrete type) pairå¯¹çš„ä¸€ç§æœºåˆ¶ã€‚ valueæ˜¯å®é™…å˜é‡å€¼ï¼Œtypeæ˜¯å®é™…å˜é‡çš„ç±»å‹ã€‚ä¸€ä¸ªinterface{}ç±»å‹çš„å˜é‡åŒ…å«äº†2ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å€¼çš„ç±»å‹ã€å¯¹åº”concrete typeã€‘ï¼Œå¦å¤–ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®é™…çš„å€¼ã€å¯¹åº”valueã€‘ã€‚ äºŒã€åå°„reflectåå°„æ˜¯ç¨‹åºæ‰§è¡Œæ—¶æ£€æŸ¥å…¶æ‰€æ‹¥æœ‰çš„ç»“æ„ã€‚å°¤å…¶æ˜¯ç±»å‹çš„ä¸€ç§èƒ½åŠ›ã€‚è¿™æ˜¯å…ƒç¼–ç¨‹çš„ä¸€ç§å½¢å¼ã€‚å®ƒåŒä¸€æ—¶å€™ä¹Ÿæ˜¯é€ æˆæ··æ·†çš„é‡è¦æ¥æºã€‚ æ¯ä¸€ä¸ªè¯­è¨€çš„åå°„æ¨¡å‹éƒ½ä¸åŒï¼Œ pythonæ¯”è¾ƒç±»ä¼¼åå°„çš„ä¾‹å­å°±æ˜¯ç±»çš„ hasattr æ–¹æ³•ï¼Œ ç”¨æ¥æ£€æµ‹ç±»æ˜¯å¦åŒ…å«æŸä¸ªæ–¹æ³•æˆ–è€…å±æ€§ goè¯­è¨€ä¸­çš„åå°„é€šè¿‡refectåŒ…å®ç°ï¼ŒreflectåŒ…å®ç°äº†è¿è¡Œæ—¶åå°„ï¼Œå…è®¸ç¨‹åºæ“ä½œä»»æ„ç±»å‹çš„å¯¹è±¡ã€‚ reflect.TypeTypeï¼šTypeç±»å‹ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªgoç±»å‹ã€‚ ä¸æ˜¯æ‰€æœ‰goç±»å‹çš„Typeå€¼éƒ½èƒ½ä½¿ç”¨æ‰€æœ‰æ–¹æ³•ã€‚è¯·å‚è§æ¯ä¸ªæ–¹æ³•çš„æ–‡æ¡£è·å–ä½¿ç”¨é™åˆ¶ã€‚åœ¨è°ƒç”¨æœ‰åˆ†ç±»é™å®šçš„æ–¹æ³•æ—¶ï¼Œåº”å…ˆä½¿ç”¨Kindæ–¹æ³•è·çŸ¥ç±»å‹çš„åˆ†ç±»ã€‚è°ƒç”¨è¯¥åˆ†ç±»ä¸æ”¯æŒçš„æ–¹æ³•ä¼šå¯¼è‡´è¿è¡Œæ—¶çš„panicã€‚ è·å–Typeå¯¹è±¡çš„æ–¹æ³•ï¼š 1func TypeOf(i interface&#123;&#125;) Type ç¤ºä¾‹ï¼š 123456789101112package mainimport ( "reflect" "fmt")func main() &#123; str := "wd" res_type := reflect.TypeOf(str) fmt.Println(res_type) //string&#125; reflect.Typeçš„æ–¹æ³•é€šç”¨æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334// é€šç”¨æ–¹æ³•func (t *rtype) String() string // è·å– t ç±»å‹çš„å­—ç¬¦ä¸²æè¿°ï¼Œä¸è¦é€šè¿‡ String æ¥åˆ¤æ–­ä¸¤ç§ç±»å‹æ˜¯å¦ä¸€è‡´ã€‚func (t *rtype) Name() string // è·å– t ç±»å‹åœ¨å…¶åŒ…ä¸­å®šä¹‰çš„åç§°ï¼Œæœªå‘½åç±»å‹åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚func (t *rtype) PkgPath() string // è·å– t ç±»å‹æ‰€åœ¨åŒ…çš„åç§°ï¼Œæœªå‘½åç±»å‹åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚func (t *rtype) Kind() reflect.Kind // è·å– t ç±»å‹çš„ç±»åˆ«ã€‚func (t *rtype) Size() uintptr // è·å– t ç±»å‹çš„å€¼åœ¨åˆ†é…å†…å­˜æ—¶çš„å¤§å°ï¼ŒåŠŸèƒ½å’Œ unsafe.SizeOf ä¸€æ ·ã€‚func (t *rtype) Align() int // è·å– t ç±»å‹çš„å€¼åœ¨åˆ†é…å†…å­˜æ—¶çš„å­—èŠ‚å¯¹é½å€¼ã€‚func (t *rtype) FieldAlign() int // è·å– t ç±»å‹çš„å€¼ä½œä¸ºç»“æ„ä½“å­—æ®µæ—¶çš„å­—èŠ‚å¯¹é½å€¼ã€‚func (t *rtype) NumMethod() int // è·å– t ç±»å‹çš„æ–¹æ³•æ•°é‡ã€‚func (t *rtype) Method() reflect.Method // æ ¹æ®ç´¢å¼•è·å– t ç±»å‹çš„æ–¹æ³•ï¼Œå¦‚æœæ–¹æ³•ä¸å­˜åœ¨ï¼Œåˆ™ panicã€‚// å¦‚æœ t æ˜¯ä¸€ä¸ªå®é™…çš„ç±»å‹ï¼Œåˆ™è¿”å›å€¼çš„ Type å’Œ Func å­—æ®µä¼šåˆ—å‡ºæ¥æ”¶è€…ã€‚// å¦‚æœ t åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ™è¿”å›å€¼çš„ Type ä¸åˆ—å‡ºæ¥æ”¶è€…ï¼ŒFunc ä¸ºç©ºå€¼ã€‚func (t *rtype) MethodByName(string) (reflect.Method, bool) // æ ¹æ®åç§°è·å– t ç±»å‹çš„æ–¹æ³•ã€‚func (t *rtype) Implements(u reflect.Type) bool // åˆ¤æ–­ t ç±»å‹æ˜¯å¦å®ç°äº† u æ¥å£ã€‚func (t *rtype) ConvertibleTo(u reflect.Type) bool // åˆ¤æ–­ t ç±»å‹çš„å€¼å¯å¦è½¬æ¢ä¸º u ç±»å‹ã€‚func (t *rtype) AssignableTo(u reflect.Type) bool // åˆ¤æ–­ t ç±»å‹çš„å€¼å¯å¦èµ‹å€¼ç»™ u ç±»å‹ã€‚func (t *rtype) Comparable() bool // åˆ¤æ–­ t ç±»å‹çš„å€¼å¯å¦è¿›è¡Œæ¯”è¾ƒæ“ä½œ####æ³¨æ„å¯¹äºï¼šæ•°ç»„ã€åˆ‡ç‰‡ã€æ˜ å°„ã€é€šé“ã€æŒ‡é’ˆã€æ¥å£ func (t *rtype) Elem() reflect.Type // è·å–å…ƒç´ ç±»å‹ã€è·å–æŒ‡é’ˆæ‰€æŒ‡å¯¹è±¡ç±»å‹ï¼Œè·å–æ¥å£çš„åŠ¨æ€ç±»å‹ ç¤ºä¾‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839package mainimport ( "fmt" "reflect")type Skills interface &#123; reading() running()&#125;type Student struct &#123; Name string Age int&#125;func (self Student) runing()&#123; fmt.Printf("%s is running\n",self.Name)&#125;func (self Student) reading()&#123; fmt.Printf("%s is reading\n" ,self.Name)&#125;func main() &#123; stu1 := Student&#123;Name:"wd",Age:22&#125; inf := new(Skills) stu_type := reflect.TypeOf(stu1) inf_type := reflect.TypeOf(inf).Elem() // ç‰¹åˆ«è¯´æ˜ï¼Œå¼•ç”¨ç±»å‹éœ€è¦ç”¨Elem()è·å–æŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡ç±»å‹ fmt.Println(stu_type.String()) //main.Student fmt.Println(stu_type.Name()) //Student fmt.Println(stu_type.PkgPath()) //main fmt.Println(stu_type.Kind()) //struct fmt.Println(stu_type.Size()) //24 fmt.Println(inf_type.NumMethod()) //2 fmt.Println(inf_type.Method(0),inf_type.Method(0).Name) // &#123;reading main func() &lt;invalid Value&gt; 0&#125; reading fmt.Println(inf_type.MethodByName("reading")) //&#123;reading main func() &lt;invalid Value&gt; 0&#125; true&#125; å…¶ä»–æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253// æ•°å€¼func (t *rtype) Bits() int // è·å–æ•°å€¼ç±»å‹çš„ä½å®½ï¼Œt å¿…é¡»æ˜¯æ•´å‹ã€æµ®ç‚¹å‹ã€å¤æ•°å‹------------------------------// æ•°ç»„func (t *rtype) Len() int // è·å–æ•°ç»„çš„å…ƒç´ ä¸ªæ•°------------------------------// æ˜ å°„func (t *rtype) Key() reflect.Type // è·å–æ˜ å°„çš„é”®ç±»å‹------------------------------// é€šé“func (t *rtype) ChanDir() reflect.ChanDir // è·å–é€šé“çš„æ–¹å‘------------------------------// ç»“æ„ä½“func (t *rtype) NumField() int // è·å–å­—æ®µæ•°é‡func (t *rtype) Field(int) reflect.StructField // æ ¹æ®ç´¢å¼•è·å–å­—æ®µfunc (t *rtype) FieldByName(string) (reflect.StructField, bool) // æ ¹æ®åç§°è·å–å­—æ®µfunc (t *rtype) FieldByNameFunc(match func(string) bool) (reflect.StructField, bool) // æ ¹æ®æŒ‡å®šçš„åŒ¹é…å‡½æ•° math è·å–å­—æ®µfunc (t *rtype) FieldByIndex(index []int) reflect.StructField // æ ¹æ®ç´¢å¼•é“¾è·å–åµŒå¥—å­—æ®µ------------------------------// å‡½æ•°func (t *rtype) NumIn() int // è·å–å‡½æ•°çš„å‚æ•°æ•°é‡func (t *rtype) In(int) reflect.Type // æ ¹æ®ç´¢å¼•è·å–å‡½æ•°çš„å‚æ•°ä¿¡æ¯func (t *rtype) NumOut() int // è·å–å‡½æ•°çš„è¿”å›å€¼æ•°é‡func (t *rtype) Out(int) reflect.Type // æ ¹æ®ç´¢å¼•è·å–å‡½æ•°çš„è¿”å›å€¼ä¿¡æ¯func (t *rtype) IsVariadic() bool // åˆ¤æ–­å‡½æ•°æ˜¯å¦å…·æœ‰å¯å˜å‚æ•°ã€‚// å¦‚æœæœ‰å¯å˜å‚æ•°ï¼Œåˆ™ t.In(t.NumIn()-1) å°†è¿”å›ä¸€ä¸ªåˆ‡ç‰‡ã€‚ ç¤ºä¾‹ï¼š 12345678910111213141516171819202122232425262728293031package mainimport ( "fmt" "reflect")type Skills interface &#123; reading() running()&#125;type Student struct &#123; Name string Age int&#125;func (self Student) runing()&#123; fmt.Printf("%s is running\n",self.Name)&#125;func (self Student) reading()&#123; fmt.Printf("%s is reading\n" ,self.Name)&#125;func main() &#123; stu1 := Student&#123;Name:"wd",Age:22&#125; stu_type := reflect.TypeOf(stu1) fmt.Println(stu_type.NumField()) //2 fmt.Println(stu_type.Field(0)) //&#123;Name string 0 [0] false&#125; fmt.Println(stu_type.FieldByName("Age")) //&#123;&#123;Age int 16 [1] false&#125; true&#125; reflect.Valueä¸æ˜¯æ‰€æœ‰goç±»å‹å€¼çš„Valueè¡¨ç¤ºéƒ½èƒ½ä½¿ç”¨æ‰€æœ‰æ–¹æ³•ã€‚è¯·å‚è§æ¯ä¸ªæ–¹æ³•çš„æ–‡æ¡£è·å–ä½¿ç”¨é™åˆ¶ã€‚åœ¨è°ƒç”¨æœ‰åˆ†ç±»é™å®šçš„æ–¹æ³•æ—¶ï¼Œåº”å…ˆä½¿ç”¨Kindæ–¹æ³•è·çŸ¥è¯¥å€¼çš„åˆ†ç±»ã€‚è°ƒç”¨è¯¥åˆ†ç±»ä¸æ”¯æŒçš„æ–¹æ³•ä¼šå¯¼è‡´è¿è¡Œæ—¶çš„panicã€‚ Valueä¸ºgoå€¼æä¾›äº†åå°„æ¥å£ï¼Œè·å–Valueå¯¹è±¡æ–¹æ³•ï¼š 1func ValueOf(i interface&#123;&#125;) Value ç¤ºä¾‹ï¼š 123str := "wd"val := reflect.ValueOf(str)//wd reflect.Valueçš„æ–¹æ³•reflect.Value.Kind()ï¼šè·å–å˜é‡ç±»åˆ«ï¼Œè¿”å›å¸¸é‡ 123456789101112package mainimport ("reflect" "fmt")func main() &#123; str := "wd" val := reflect.ValueOf(str).Kind() fmt.Println(val)//string&#125; ç”¨äºè·å–å€¼æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738func (v Value) Int() int64 // è·å–intç±»å‹å€¼ï¼Œå¦‚æœ v å€¼ä¸æ˜¯æœ‰ç¬¦å·æ•´å‹ï¼Œåˆ™ panicã€‚func (v Value) Uint() uint64 // è·å–unitç±»å‹çš„å€¼ï¼Œå¦‚æœ v å€¼ä¸æ˜¯æ— ç¬¦å·æ•´å‹ï¼ˆåŒ…æ‹¬ uintptrï¼‰ï¼Œåˆ™ panicã€‚func (v Value) Float() float64 // è·å–floatç±»å‹çš„å€¼ï¼Œå¦‚æœ v å€¼ä¸æ˜¯æµ®ç‚¹å‹ï¼Œåˆ™ panicã€‚func (v Value) Complex() complex128 // è·å–å¤æ•°ç±»å‹çš„å€¼ï¼Œå¦‚æœ v å€¼ä¸æ˜¯å¤æ•°å‹ï¼Œåˆ™ panicã€‚func (v Value) Bool() bool // è·å–å¸ƒå°”ç±»å‹çš„å€¼ï¼Œå¦‚æœ v å€¼ä¸æ˜¯å¸ƒå°”å‹ï¼Œåˆ™ panicã€‚func (v Value) Len() int // è·å– v å€¼çš„é•¿åº¦ï¼Œv å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„ã€åˆ‡ç‰‡ã€æ˜ å°„ã€é€šé“ã€‚func (v Value) Cap() int // è·å– v å€¼çš„å®¹é‡ï¼Œv å€¼å¿…é¡»æ˜¯æ•°å€¼ã€åˆ‡ç‰‡ã€é€šé“ã€‚func (v Value) Index(i int) reflect.Value // è·å– v å€¼çš„ç¬¬ i ä¸ªå…ƒç´ ï¼Œv å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„ã€åˆ‡ç‰‡ï¼Œi ä¸èƒ½è¶…å‡ºèŒƒå›´ã€‚func (v Value) Bytes() []byte // è·å–å­—èŠ‚ç±»å‹çš„å€¼ï¼Œå¦‚æœ v å€¼ä¸æ˜¯å­—èŠ‚åˆ‡ç‰‡ï¼Œåˆ™ panicã€‚func (v Value) Slice(i, j int) reflect.Value // è·å– v å€¼çš„åˆ‡ç‰‡ï¼Œåˆ‡ç‰‡é•¿åº¦ = j - iï¼Œåˆ‡ç‰‡å®¹é‡ = v.Cap() - iã€‚// v å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€æ•°å€¼ã€åˆ‡ç‰‡ï¼Œå¦‚æœæ˜¯æ•°ç»„åˆ™å¿…é¡»å¯å¯»å€ã€‚i ä¸èƒ½è¶…å‡ºèŒƒå›´ã€‚func (v Value) Slice3(i, j, k int) reflect.Value // è·å– v å€¼çš„åˆ‡ç‰‡ï¼Œåˆ‡ç‰‡é•¿åº¦ = j - iï¼Œåˆ‡ç‰‡å®¹é‡ = k - iã€‚// iã€jã€k ä¸èƒ½è¶…å‡º v çš„å®¹é‡ã€‚i &lt;= j &lt;= kã€‚// v å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€æ•°å€¼ã€åˆ‡ç‰‡ï¼Œå¦‚æœæ˜¯æ•°ç»„åˆ™å¿…é¡»å¯å¯»å€ã€‚i ä¸èƒ½è¶…å‡ºèŒƒå›´ã€‚func (v Value) MapIndex(key Value) reflect.Value // æ ¹æ® key é”®è·å– v å€¼çš„å†…å®¹ï¼Œv å€¼å¿…é¡»æ˜¯æ˜ å°„ã€‚// å¦‚æœæŒ‡å®šçš„å…ƒç´ ä¸å­˜åœ¨ï¼Œæˆ– v å€¼æ˜¯æœªåˆå§‹åŒ–çš„æ˜ å°„ï¼Œåˆ™è¿”å›é›¶å€¼ï¼ˆreflect.ValueOf(nil)ï¼‰func (v Value) MapKeys() []reflect.Value // è·å– v å€¼çš„æ‰€æœ‰é”®çš„æ— åºåˆ—è¡¨ï¼Œv å€¼å¿…é¡»æ˜¯æ˜ å°„ã€‚// å¦‚æœ v å€¼æ˜¯æœªåˆå§‹åŒ–çš„æ˜ å°„ï¼Œåˆ™è¿”å›ç©ºåˆ—è¡¨ã€‚func (v Value) OverflowInt(x int64) bool // åˆ¤æ–­ x æ˜¯å¦è¶…å‡º v å€¼çš„å–å€¼èŒƒå›´ï¼Œv å€¼å¿…é¡»æ˜¯æœ‰ç¬¦å·æ•´å‹ã€‚func (v Value) OverflowUint(x uint64) bool // åˆ¤æ–­ x æ˜¯å¦è¶…å‡º v å€¼çš„å–å€¼èŒƒå›´ï¼Œv å€¼å¿…é¡»æ˜¯æ— ç¬¦å·æ•´å‹ã€‚func (v Value) OverflowFloat(x float64) bool // åˆ¤æ–­ x æ˜¯å¦è¶…å‡º v å€¼çš„å–å€¼èŒƒå›´ï¼Œv å€¼å¿…é¡»æ˜¯æµ®ç‚¹å‹ã€‚func (v Value) OverflowComplex(x complex128) bool // åˆ¤æ–­ x æ˜¯å¦è¶…å‡º v å€¼çš„å–å€¼èŒƒå›´ï¼Œv å€¼å¿…é¡»æ˜¯å¤æ•°å‹ã€‚ è®¾ç½®å€¼æ–¹æ³•ï¼š 12345678910111213141516171819func (v Value) SetInt(x int64) //è®¾ç½®intç±»å‹çš„å€¼func (v Value) SetUint(x uint64) // è®¾ç½®æ— ç¬¦å·æ•´å‹çš„å€¼func (v Value) SetFloat(x float64) // è®¾ç½®æµ®ç‚¹ç±»å‹çš„å€¼func (v Value) SetComplex(x complex128) //è®¾ç½®å¤æ•°ç±»å‹çš„å€¼func (v Value) SetBool(x bool) //è®¾ç½®å¸ƒå°”ç±»å‹çš„å€¼func (v Value) SetString(x string) //è®¾ç½®å­—ç¬¦ä¸²ç±»å‹çš„å€¼func (v Value) SetLen(n int) // è®¾ç½®åˆ‡ç‰‡çš„é•¿åº¦ï¼Œn ä¸èƒ½è¶…å‡ºèŒƒå›´ï¼Œä¸èƒ½ä¸ºè´Ÿæ•°ã€‚func (v Value) SetCap(n int) //è®¾ç½®åˆ‡ç‰‡çš„å®¹é‡func (v Value) SetBytes(x []byte) //è®¾ç½®å­—èŠ‚ç±»å‹çš„å€¼func (v Value) SetMapIndex(key, val reflect.Value) //è®¾ç½®mapçš„keyå’Œvalueï¼Œå‰æå¿…é¡»æ˜¯åˆå§‹åŒ–ä»¥åï¼Œå­˜åœ¨è¦†ç›–ã€ä¸å­˜åœ¨æ·»åŠ  å…¶ä»–æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930##########ç»“æ„ä½“ç›¸å…³ï¼šfunc (v Value) NumField() int // è·å–ç»“æ„ä½“å­—æ®µï¼ˆæˆå‘˜ï¼‰æ•°é‡func (v Value) Field(i int) reflect.Value //æ ¹æ®ç´¢å¼•è·å–ç»“æ„ä½“å­—æ®µfunc (v Value) FieldByIndex(index []int) reflect.Value // æ ¹æ®ç´¢å¼•é“¾è·å–ç»“æ„ä½“åµŒå¥—å­—æ®µfunc (v Value) FieldByName(string) reflect.Value // æ ¹æ®åç§°è·å–ç»“æ„ä½“çš„å­—æ®µï¼Œä¸å­˜åœ¨è¿”å›reflect.ValueOf(nil)func (v Value) FieldByNameFunc(match func(string) bool) Value // æ ¹æ®åŒ¹é…å‡½æ•° match è·å–å­—æ®µ,å¦‚æœæ²¡æœ‰åŒ¹é…çš„å­—æ®µï¼Œåˆ™è¿”å›é›¶å€¼ï¼ˆreflect.ValueOf(nil)ï¼‰########é€šé“ç›¸å…³ï¼šfunc (v Value) Send(x reflect.Value)// å‘é€æ•°æ®ï¼ˆä¼šé˜»å¡ï¼‰ï¼Œv å€¼å¿…é¡»æ˜¯å¯å†™é€šé“ã€‚func (v Value) Recv() (x reflect.Value, ok bool) // æ¥æ”¶æ•°æ®ï¼ˆä¼šé˜»å¡ï¼‰ï¼Œv å€¼å¿…é¡»æ˜¯å¯è¯»é€šé“ã€‚func (v Value) TrySend(x reflect.Value) bool // å°è¯•å‘é€æ•°æ®ï¼ˆä¸ä¼šé˜»å¡ï¼‰ï¼Œv å€¼å¿…é¡»æ˜¯å¯å†™é€šé“ã€‚func (v Value) TryRecv() (x reflect.Value, ok bool) // å°è¯•æ¥æ”¶æ•°æ®ï¼ˆä¸ä¼šé˜»å¡ï¼‰ï¼Œv å€¼å¿…é¡»æ˜¯å¯è¯»é€šé“ã€‚func (v Value) Close() // å…³é—­é€šé“########å‡½æ•°ç›¸å…³func (v Value) Call(in []Value) (r []Value) // é€šè¿‡å‚æ•°åˆ—è¡¨ in è°ƒç”¨ v å€¼æ‰€ä»£è¡¨çš„å‡½æ•°ï¼ˆæˆ–æ–¹æ³•ï¼‰ã€‚å‡½æ•°çš„è¿”å›å€¼å­˜å…¥ r ä¸­è¿”å›ã€‚// è¦ä¼ å…¥å¤šå°‘å‚æ•°å°±åœ¨ in ä¸­å­˜å…¥å¤šå°‘å…ƒç´ ã€‚// Call å³å¯ä»¥è°ƒç”¨å®šå‚å‡½æ•°ï¼ˆå‚æ•°æ•°é‡å›ºå®šï¼‰ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨å˜å‚å‡½æ•°ï¼ˆå‚æ•°æ•°é‡å¯å˜ï¼‰ã€‚func (v Value) CallSlice(in []Value) []Value // è°ƒç”¨å˜å‚å‡½æ•° ç¤ºä¾‹ä¸€ï¼šè·å–å’Œè®¾ç½®æ™®é€šç±»å‹çš„å€¼ 12345678910111213141516package mainimport ( "reflect" "fmt")func main() &#123; str := "wd" age := 11 fmt.Println(reflect.ValueOf(str).String()) //è·å–strçš„å€¼ï¼Œç»“æœwd fmt.Println(reflect.ValueOf(age).Int()) //è·å–ageçš„å€¼ï¼Œç»“æœage str2 := reflect.ValueOf(&amp;str) //è·å–Valueç±»å‹ str2.Elem().SetString("jack") //è®¾ç½®å€¼ fmt.Println(str2.Elem(),age) //jack 11&#125; ç¤ºä¾‹äºŒï¼šç®€å•ç»“æ„ä½“æ“ä½œ 1234567891011121314151617181920212223242526272829303132333435package mainimport ( "fmt" "reflect")type Skills interface &#123; reading() running()&#125;type Student struct &#123; Name string Age int&#125;func (self Student) runing()&#123; fmt.Printf("%s is running\n",self.Name)&#125;func (self Student) reading()&#123; fmt.Printf("%s is reading\n" ,self.Name)&#125;func main() &#123; stu1 := Student&#123;Name:"wd",Age:22&#125; stu_val := reflect.ValueOf(stu1) //è·å–Valueç±»å‹ fmt.Println(stu_val.NumField()) //2 fmt.Println(stu_val.Field(0),stu_val.Field(1)) //wd 22 fmt.Println(stu_val.FieldByName("Age")) //22 stu_val2 := reflect.ValueOf(&amp;stu1).Elem() stu_val2.FieldByName("Age").SetInt(33) //è®¾ç½®å­—æ®µå€¼ ï¼Œç»“æœ33 fmt.Println(stu1.Age) &#125; ç¤ºä¾‹ä¸‰ï¼šé€šè¿‡åå°„è°ƒç”¨ç»“æ„ä½“ä¸­çš„æ–¹æ³•ï¼Œé€šè¿‡reflect.Value.Method(i int).Call()æˆ–è€…reflect.Value.MethodByName(name string).Call()å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445package mainimport ( "fmt" "reflect")type Student struct &#123; Name string Age int&#125;func (this *Student) SetName(name string) &#123; this.Name = name fmt.Printf("set name %s\n",this.Name )&#125;func (this *Student) SetAge(age int) &#123; this.Age = age fmt.Printf("set age %d\n",age )&#125;func (this *Student) String() string &#123; fmt.Printf("this is %s\n",this.Name) return this.Name&#125;func main() &#123; stu1 := &amp;Student&#123;Name:"wd",Age:22&#125; val := reflect.ValueOf(stu1) //è·å–Valueç±»å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨reflect.ValueOf(&amp;stu1).Elem() val.MethodByName("String").Call(nil) //è°ƒç”¨Stringæ–¹æ³• params := make([]reflect.Value, 1) params[0] = reflect.ValueOf(18) val.MethodByName("SetAge").Call(params) //é€šè¿‡åç§°è°ƒç”¨æ–¹æ³• params[0] = reflect.ValueOf("jack") val.Method(1).Call(params) //é€šè¿‡æ–¹æ³•ç´¢å¼•è°ƒç”¨ fmt.Println(stu1.Name,stu1.Age)&#125;//this is wd//set age 18//set name jack//jack 18]]></content>
      <categories>
        <category>Golang</category>
        <category>Golangç‰¹æ€§</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[éšæœºã€æ‰¹é‡æ¢¯åº¦ä¸‹é™]]></title>
    <url>%2F2018%2F12%2F22%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E9%9A%8F%E6%9C%BA%E3%80%81%E6%89%B9%E9%87%8F%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%2F</url>
    <content type="text"><![CDATA[1. éšæœºæ¢¯åº¦ä¸‹é™ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™å½“ä½¿ç”¨ä¼ ç»Ÿçš„æ¢¯åº¦ä¸‹é™çš„æ—¶å€™ï¼Œæ¯ä¸€æ¬¡çš„è¿­ä»£ï¼Œéƒ½ä¼šå»è®¡ç®—æ‰€æœ‰æ ·æœ¬çš„è¯¯å·®æ€»å’Œï¼Œè¿™æ ·å°±é€ æˆäº†å¾ˆå¤§çš„è¿ç®—é‡ï¼Œä»¥åŠä¼šåŠ è½½å¾ˆå¤šçš„æ•°æ®ï¼Œè¿™æ ·å½“æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ç¡¬ä»¶èµ„æºä¹Ÿå¾ˆéš¾æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ä¸€å®šéœ€è¦ä¸€ä¸ªå¤§è§„æ¨¡çš„è®­ç»ƒé›†ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™æ³•æ¥ä»£æ›¿æ‰¹ï¥¾æ¢¯åº¦ä¸‹é™æ³•ã€‚ éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•å•ä¸€å®ä¾‹çš„ä»£ä»·å‡½æ•° $\operatorname { cost } \left( \theta , \left( x ^ { ( i ) } , y ^ { ( i ) } \right) \right) = \frac { 1 } { 2 } \left( h _ { \theta } \left( x ^ { ( i ) } \right) - y ^ { ( i ) } \right) ^ { 2 }$ å‚æ•°ä¼˜åŒ–æ­¥éª¤ é¦–å…ˆå¯¹è®­ç»ƒé›†æ•°æ®è¿›è¡Œéšæœºæ´—ç‰Œï¼Œä½¿è®­ç»ƒé›†æ•°æ®çš„é¡ºåºæ‰“ä¹±ï¼Œç›®çš„æ˜¯é˜²æ­¢ç›¸é‚»æ•°æ®ç›¸ä¼¼å¯¼è‡´ä¼˜åŒ–ç›¸æŠµæ¶ˆ å¾ªç¯éå†æ¯ä¸€ä¸ªå®ä¾‹ï¼Œé€šè¿‡å…¶ä»£ä»·å‡½æ•°çš„å¯¼æ•°æ¥ä¼˜åŒ–å‚æ•°Î¸ for $i = 1 : m {$ $\theta : = \theta _ { j } - \alpha \left( h _ { \theta } \left( x ^ { ( i ) } \right) - y ^ { ( i ) } \right) x _ { j } ^ { ( i ) }$(for $j = 0 : n )$}} éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•åœ¨æ¯ä¸€æ¬¡è®¡ç®—ä¹‹åï¥¥ï¤æ–°å‚æ•° Î¸ ï¼Œè€Œï¥§éœ€è¦é¦–å…ˆå°†æ‰€æœ‰çš„è®­ç»ƒé›†æ±‚å’Œï¼Œåœ¨æ¢¯åº¦ä¸‹é™ç®—æ³•è¿˜æ²¡æœ‰å®Œæˆä¸€æ¬¡è¿­ä»£æ—¶ï¼Œéšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•ï¥¥å·²ç»èµ°å‡ºï¦ºå¾ˆè¿œã€‚ä½†æ˜¯è¿™æ ·çš„ç®—æ³•å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œï¥§æ˜¯æ¯ä¸€æ­¥éƒ½æ˜¯æœç€â€æ­£ç¡®â€çš„æ–¹å‘è¿ˆå‡ºçš„ã€‚å› æ­¤ç®—æ³•è™½ç„¶ä¼šé€æ¸èµ°å‘å…¨å±€æœ€å°å€¼çš„ä½ç½®ï¼Œä½†æ˜¯å¯èƒ½æ— æ³•ç«™åˆ°é‚£ä¸ªæœ€å°å€¼çš„é‚£ä¸€ç‚¹ï¼Œè€Œæ˜¯åœ¨æœ€å°å€¼ç‚¹é™„è¿‘å¾˜å¾Š 2.å°æ‰¹é‡æ¢¯åº¦ä¸‹é™å°æ‰¹ï¥¾æ¢¯åº¦ä¸‹é™ç®—æ³•æ˜¯ä»‹äºæ‰¹ï¥¾æ¢¯åº¦ä¸‹é™ç®—æ³•å’Œéšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•ä¹‹é—´çš„ç®—æ³•ï¼Œæ¯è®¡ç®—å¸¸æ•° b æ¬¡è®­ç»ƒå®ï¦µï¼Œï¥¥ï¤æ–°ä¸€æ¬¡å‚æ•° Î¸ ã€‚ for $i = 1 : m {$ $\theta : = \theta _ { j } - \alpha \frac { 1 } { b } \sum _ { k = i } ^ { i + b - 1 } \left( h _ { \theta } \left( x ^ { ( k ) } \right) - y ^ { ( k ) } \right) x _ { j } ^ { ( k ) }$(for $j = 0 : n )$$i + = 10$ }} é€šå¸¸æˆ‘ä»¬ä¼šä»¤ b åœ¨ 2-100 ä¹‹é—´ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‘ï¥¾åŒ–çš„æ–¹å¼æ¥å¾ªç¯ ä¸ªè®­ç»ƒå®ï¦µï¼Œå¦‚æœæˆ‘ä»¬ç”¨çš„çº¿æ€§ä»£æ•°å‡½æ•°åº“æ¯”è¾ƒå¥½ï¼Œèƒ½å¤Ÿæ”¯æŒå¹³ï¨ˆå¤„ï§¤ï¼Œé‚£ä¹ˆç®—æ³•çš„æ€»ä½“è¡¨ç°å°†ï¥§å—å½±å“ï¼ˆä¸éšæœºæ¢¯åº¦ä¸‹é™ç›¸åŒï¼‰ã€‚ 3.éšæœºæ¢¯åº¦ä¸‹é™æ”¶æ•›åœ¨æ‰¹ï¥¾æ¢¯åº¦ä¸‹é™ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åƒæ™®é€šçš„æ¢¯åº¦ä¸‹é™é‚£æ ·ï¼Œå¯ä»¥ä»¤ä»£ä»·å‡½æ•° J ä¸ºè¿­ä»£æ¬¡æ•°çš„å‡½æ•°ï¼Œç»˜åˆ¶å›¾è¡¨ï¼Œæ ¹æ®å›¾è¡¨æ¥åˆ¤æ–­æ¢¯åº¦ä¸‹é™æ˜¯å¦æ”¶æ•›ã€‚ä½†æ˜¯ï¼Œåœ¨å¤§è§„æ¨¡çš„è®­ç»ƒé›†çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ï¥§ç°å®çš„ï¼Œå› ä¸ºè®¡ç®—ä»£ä»·å¤ªå¤§ï¦ºã€‚ åœ¨éšæœºæ¢¯åº¦ä¸‹é™ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸€æ¬¡ï¤æ–° Î¸ ä¹‹å‰éƒ½è®¡ç®—ä¸€æ¬¡ä»£ä»·ï¼Œç„¶åæ¯ x æ¬¡è¿­ä»£åï¼Œæ±‚å‡ºè¿™ x æ¬¡å¯¹è®­ç»ƒå®ï¦µè®¡ç®—ä»£ä»·çš„å¹³å‡å€¼ï¼Œç„¶åç»˜åˆ¶è¿™äº›å¹³å‡å€¼ä¸ x æ¬¡è¿­ä»£çš„æ¬¡æ•°ä¹‹é—´çš„å‡½æ•°å›¾è¡¨ å½“æˆ‘ä»¬ç»˜åˆ¶è¿™æ ·çš„å›¾è¡¨æ—¶ï¼Œå¯èƒ½ä¼šå¾—åˆ°ä¸€ä¸ªé¢ ç°¸ï¥§å¹³ä½†æ˜¯ï¥§ä¼šæ˜æ˜¾å‡å°‘çš„å‡½æ•°å›¾åƒï¼ˆå¦‚ä¸Šé¢å·¦ä¸‹å›¾ä¸­è“çº¿æ‰€ç¤ºï¼‰ã€‚æˆ‘ä»¬å¯ä»¥å¢åŠ  Î± æ¥ä½¿å¾—å‡½æ•°ï¤åŠ å¹³ç¼“ï¼Œä¹Ÿè®¸ï¥¥èƒ½çœ‹å‡ºä¸‹é™çš„è¶‹åŠ¿ï¦ºï¼ˆå¦‚ä¸Šé¢å·¦ä¸‹å›¾ä¸­çº¢çº¿æ‰€ç¤ºï¼‰ï¼›æˆ–è€…å¯èƒ½å‡½æ•°å›¾è¡¨ä»ç„¶æ˜¯é¢ ç°¸ï¥§å¹³ä¸”ï¥§ä¸‹é™çš„ï¼ˆå¦‚æ´‹çº¢è‰²çº¿æ‰€ç¤ºï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ¨¡å‹æœ¬èº«å¯èƒ½å­˜åœ¨ä¸€äº›é”™è¯¯ æœæˆ‘ä»¬å¾—åˆ°çš„æ›²çº¿å¦‚ä¸Šé¢å³ä¸‹æ–¹æ‰€ç¤ºï¼Œï¥§æ–­åœ°ä¸Šå‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦é€‰æ‹©ä¸€ä¸ªè¾ƒå°çš„å­¦ä¹ ç‡ Î±ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¤å­¦ä¹ ç‡éšç€è¿­ä»£æ¬¡æ•°çš„å¢åŠ è€Œå‡å°ï¼Œï¦µå¦‚ä»¤ï¼š $\alpha = \frac { \text { const } } { \text { iteration Number } + \text { const } 2 }$ éšç€æˆ‘ä»¬ï¥§æ–­åœ°é è¿‘å…¨å±€æœ€å°å€¼ï¼Œé€šè¿‡å‡å°å­¦ä¹ ç‡ï¼Œæˆ‘ä»¬è¿«ä½¿ç®—æ³•æ”¶æ•›è€Œéåœ¨æœ€å°å€¼é™„è¿‘å¾˜å¾Šã€‚ ä½†æ˜¯é€šå¸¸æˆ‘ä»¬ï¥§éœ€è¦è¿™æ ·åšï¥¥èƒ½æœ‰éå¸¸å¥½çš„æ•ˆæœï¦ºï¼Œå¯¹ Î± è¿›ï¨ˆè°ƒæ•´æ‰€è€—è´¹çš„è®¡ç®—é€šå¸¸ï¥§å€¼å¾—]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ¢¯åº¦ä¸‹é™</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¨èç³»ç»Ÿæ¨¡å‹]]></title>
    <url>%2F2018%2F12%2F15%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%2F</url>
    <content type="text"><![CDATA[1. æ¨èç³»ç»Ÿä»‹ç»å¯¹æœºï¨¸å­¦ä¹ æ¥è¯´ï¼Œç‰¹å¾æ˜¯å¾ˆé‡è¦çš„ï¼Œå¾€å¾€æ‰€é€‰çš„ç‰¹å¾å°†ä¼šå†³å®šæˆ‘ä»¬çš„æ¨¡å‹å»ºç«‹çš„å¥½åã€‚å› æ­¤ï¼Œåœ¨æœºï¨¸å­¦ä¹ ä¸­æœ‰ä¸€ç§æ€æƒ³ï¼Œå®ƒé’ˆå¯¹ä¸€äº›é—®é¢˜ï¼Œæœ‰ç®—æ³•å¯ä»¥ä¸ºä½ è‡ªåŠ¨å­¦ä¹ ä¸€å¥—å¥½çš„ç‰¹å¾ã€‚æ¨èç®—æ³•ç®—æ˜¯ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨å­¦ä¹ ç‰¹å¾çš„ç®—æ³•ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„ï¼Œæ¥ä¸‹æ¥ä»æ¨èç®—æ³•æ¥ä»‹ç»æ€ä¹ˆä½¿ç”¨æ¨èç®—æ³•è¿›è¡Œç‰¹å¾è‡ªåŠ¨å­¦ä¹ ï¼Œä»¥åŠæ¨èç³»ç»Ÿçš„æ„å»ºå’Œåº”ç”¨ï¼› ä¸¾ä¸€ä¸ªä¾‹å­ï¼š å‡ä½¿æˆ‘ä»¬æ˜¯ä¸€ä¸ªç”µå½±ä¾›åº”å•†ï¼Œæˆ‘ä»¬æœ‰ 5 éƒ¨ç”µå½±å’Œ 4 ä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬è¦æ±‚ç”¨æˆ·ä¸ºç”µå½±æ‰“åˆ†ã€‚ å‰é¢ä¸‰éƒ¨ç”µå½±æ˜¯çˆ±æƒ…ç‰‡ï¼Œ åä¸¤éƒ¨æ˜¯åŠ¨ä½œç‰‡ï¼Œå¯ä»¥çœ‹å‡ºå‰ä¸¤ä¸ªç”¨æˆ·æ›´åå‘äºçˆ±æƒ…ç‰‡ï¼Œåä¸¤ä¸ªç”¨æˆ·æ›´å€¾å‘äºåŠ¨ä½œç‰‡ã€‚å¹¶ä¸”å¯ä»¥çœ‹åˆ°å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç”¨æˆ·ç»™å¯¹æ‰€æœ‰çš„ç”µå½±éƒ½æ‰“è¿‡åˆ†ï¼Œ å¯èƒ½æ˜¯æ²¡æœ‰çœ‹è¿‡è¯¥ç”µå½±ï¼Œä¹Ÿå¯èƒ½æ˜¯çœ‹è¿‡ç”µå½±åæ²¡æœ‰ç»™ç”µå½±æ‰“åˆ†ã€‚æ‰€ä»¥ï¼Œæ¨èç³»ç»Ÿçš„ç›®æ ‡æ¥äº†ï¼Œå°±æ˜¯ç³»ç»Ÿé€šè¿‡æ„å»ºä¸€ä¸ªç®—æ³•æ¥é¢„æµ‹ä»–ä»¬æ¯ä¸ªäººå¯èƒ½ä¼šç»™ä»–ä»¬æ²¡æ‰“è¿‡åˆ†çš„ç”µå½±æ‰“å¤šå°‘åˆ†ï¼Œå¹¶ä»¥æ­¤æ¥ä½œä¸ºæ¨èçš„ä¾æ®ï¼› ç»™æ•°æ®é›†å¼•å…¥ä¸€äº›æ ‡è®°ï¼Œ ä¸‹é¢å…³äºæ¨èç®—æ³•çš„æ¨å€’ä¾¿åŸºäºè¿™äº›æ ‡è®°: $n_u$ä»£è¡¨ç”¨æˆ·çš„æ•°é‡ $n_m$ä»£è¡¨ç”µå½±çš„æ•°é‡ $r ( i , j )$å¦‚æœç”¨æˆ· j ç»™ç”µå½± i è¯„åˆ†è¿‡åˆ™ r(i, j) = 1 $y^{(i, j)}$ä»£è¡¨ç”¨æˆ· j ç»™ç”µå½±çš„è¯„åˆ† $m_j$ä»£è¡¨ç”¨æˆ· j è¯„è¿‡åˆ†çš„ç”µå½±æ€»æ•° åŸºäºå†…å®¹çš„æ¨èç³»ç»Ÿåœ¨åŸºäºå†…å®¹çš„æ¨èç®—æ³•ä¸­ï¼Œè¢«æ¨èçš„å†…å®¹å¾€å¾€æœ‰ä¸€äº›ç‰¹å¾ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æ ¹æ®è¿™äº›å†…å®¹çš„ç‰¹å¾ï¼Œé€šè¿‡ç‰¹å¾å†…å®¹å’Œè¢«æ¨èäººçš„ç¬¦åˆç¨‹åº¦ï¼Œæ¥è¿›è¡Œæ¨èï¼› ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æ¯éƒ¨ç”µå½±éƒ½æœ‰ä¸¤ä¸ªç‰¹å¾ï¼Œå¦‚ x1 ä»£è¡¨ç”µå½±çš„æµªæ¼«ç¨‹åº¦ï¼Œx2 ä»£è¡¨ç”µå½±çš„åŠ¨ä½œç¨‹åº¦ æ¯éƒ¨ç”µå½±éƒ½æœ‰ä¸€ä¸ªç‰¹å¾å‘ï¥¾ï¼Œå¦‚ $x^{(1)}$ æ˜¯ç¬¬ä¸€éƒ¨ç”µå½±çš„ç‰¹å¾å‘ï¥¾ä¸º[0.9 0]ã€‚ æ¥ä¸‹æ¥æ ¹æ®è¿™äº›ç‰¹å¾æ¥æ„å»ºä¸€ä¸ªæ¨èç®—æ³•ã€‚æ¯”å¦‚ä½¿ç”¨çº¿å‹å›å½’æ¨¡å‹ï¼Œå¯ä»¥ç°é’ˆå¯¹æ¯ä¸€ä¸ªç”¨æˆ·éƒ½è®­ç»ƒä¸€ä¸ªçº¿å‹å›å½’æ¨¡å‹ï¼Œå¦‚$\theta^{(1)}$æ˜¯ç¬¬ä¸€ä¸ªç”¨æˆ·çš„æ¨¡å‹çš„å‚æ•°ã€‚äºæ˜¯ï¼Œæ¨èç®—æ³•å¯ä»¥å½’çº³ä¸º: é¢„æµ‹å‡½æ•° $\theta^{(j)}$æ˜¯ç”¨æˆ· j çš„å‚æ•°å‘é‡ $x^{(i)}$æ˜¯ç”µå½± i çš„ç‰¹å¾å‘é‡ å¯¹äºç”¨æˆ· j å’Œç”µå½± i ï¼Œæˆ‘ä»¬é¢„æµ‹è¯„åˆ†ä¸º: $\left( \theta ^ { ( j ) } \right) ^ { T } x ^ { ( i ) }$ ä»£ä»·å‡½æ•° é’ˆå¯¹ç”¨æˆ· j ï¼Œè¯¥çº¿æ€§å›å½’æ¨¡å‹çš„ä»£ä»·ä¸ºé¢„æµ‹è¯¯å·®çš„å¹³æ–¹å’Œï¼ŒåŠ ä¸Šæ­£åˆ™åŒ–é¡¹ï¼š $\min _ { \theta ( j ) } \frac { 1 } { 2 } \sum _ { i : r ( i , j ) = 1 } \left( \left( \theta ^ { ( j ) } \right) ^ { T } x ^ { ( i ) } - y ^ { ( i , j ) } \right) ^ { 2 } + \frac { \lambda } { 2 } \left( \theta _ { k } ^ { ( j ) } \right) ^ { 2 }$ å…¶ä¸­ i : r( i, j ) è¡¨ç¤ºæˆ‘ä»¬åªè®¡ç®—é‚£äº›ç”¨æˆ· j è¯„è¿‡åˆ†çš„ç”µå½±ã€‚åœ¨ä¸€èˆ¬çš„çº¿æ€§å›å½’æ¨¡å‹ä¸­ï¼Œè¯¯å·®é¡¹å’Œæ­£åˆ™é¡¹åº”è¯¥éƒ½æ˜¯ä¹˜ä»¥ 1/2m ï¼Œåœ¨è¿™ï§©æˆ‘ä»¬å°† m å»æ‰ã€‚å¹¶ä¸”æˆ‘ä»¬ï¥§å¯¹æ–¹å·®é¡¹ Î¸0 è¿›ï¨ˆæ­£åˆ™åŒ–å¤„ï§¤ã€‚ ä¼˜åŒ–ç›®æ ‡ ä¸Šé¢çš„ä»£ä»·å‡½æ•°åªæ˜¯é’ˆå¯¹ä¸€ä¸ªç”¨æˆ·çš„ï¼Œä¸ºï¦ºå­¦ä¹ æ‰€æœ‰ç”¨æˆ·ï¼Œå°†æ‰€æœ‰ç”¨æˆ·çš„ä»£ä»·å‡½æ•°æ±‚å’Œï¼š $\min _ { \theta ^ { ( 1 ) } , \ldots , \theta ^ { ( n ) } } \frac { 1 } { 2 } \sum _ { j = 1 } ^ { n _ { n } } \sum _ { i : r ( i , j ) = 1 } \left( \left( \theta ^ { ( j ) } \right) ^ { T } x ^ { ( i ) } - y ^ { ( i , j ) } \right) ^ { 2 } + \frac { \lambda } { 2 } \sum _ { j = 1 } ^ { n _ { s } } \sum _ { k = 1 } ^ { n } \left( \theta _ { k } ^ { ( j ) } \right) ^ { 2 }$ $\theta _ { k } ^ { ( j ) } : = \theta _ { k } ^ { ( j ) } - \alpha \sum _ { i : r ( i , j ) = 1 } \left( \left( \theta ^ { ( j ) } \right) ^ { T } x ^ { ( i ) } - y ^ { ( i , j ) } \right) x _ { k } ^ { ( i ) } \quad ($ for $k = 0 )$ $\theta _ { k } ^ { ( j ) } : = \theta _ { k } ^ { ( j ) } - \alpha \left( \sum _ { i r r ( i , j ) = 1 } \left( \left( \theta ^ { ( j ) } \right) ^ { T } x ^ { ( i ) } - y ^ { ( i , j ) } \right) x _ { k } ^ { ( i ) } + \lambda \theta _ { k } ^ { ( j ) } \right) \quad ($ for $k \neq 0 )$ ååŒè¿‡æ»¤é€šè¿‡å‚æ•°æ¥å­¦ä¹ ç‰¹å¾ä¸Šé¢çš„ä¾‹å­æ˜¯æˆ‘ä»¬é€šè¿‡æ¯ä¸€ä¸ªå†…å®¹çš„ç‰¹å¾ï¼Œä½¿ç”¨è¿™äº›ç‰¹ç§æ¥è®­ç»ƒæ¯ä¸€ä¸ªç”¨æˆ·çš„å‚æ•°ï¼›åŒæ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®ç”¨æˆ·çš„å‚æ•°ï¼Œæ¥å­¦ä¹ ç”µå½±çš„ç‰¹å¾ï¼›è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å·²æœ‰çš„ç”¨æˆ·ï¼Œæ¥ç»™æ‰€æœ‰æœªè¿›è¡Œç‰¹å¾æå–çš„ç”µå½±è¿›è¡Œç‰¹å¾çš„å»ºç«‹ï¼› ä¼˜åŒ–ç›®æ ‡ $\min _ { x ^ { ( 1 ) } , \ldots , x ^ { ( m ) } } \frac { 1 } { 2 } \sum _ { i = 1 } ^ { n _ { m } } \sum _ { j ï¼š r ( i , j ) = 1 } \left( \left( \theta ^ { ( j ) } \right) ^ { T } x ^ { ( i ) } - y ^ { ( i , j ) } \right) ^ { 2 } + \frac { \lambda } { 2 } \sum _ { i = 1 } ^ { n _ { m } } \sum _ { k = 1 } ^ { n } \left( x _ { k } ^ { ( i ) } \right) ^ { 2 }$ å°†ä¼˜åŒ–Î¸å˜ä¸ºä¼˜åŒ–x ååŒè¿‡æ»¤å¦‚æœåœ¨å»ºç«‹ç³»ç»Ÿçš„æœ€å¼€å§‹ï¼Œæ—¢æ²¡æœ‰ç”¨æˆ·çš„å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰ç”µå½±çš„ç‰¹å¾ï¼Œé‚£ä¹ˆæ—¢ä¸èƒ½é€šè¿‡ç‰¹å¾æ¥å­¦ä¹ å‚æ•°ï¼Œä¹Ÿä¸èƒ½é€šè¿‡å‚æ•°æ¥å­¦ä¹ ç‰¹å¾ï¼Œè¿™ä¸¤ç§æ–¹æ³•éƒ½ï¥§å¯ï¨ˆï¦ºã€‚ååŒè¿‡æ»¤ç®—æ³•å¯ä»¥åŒæ—¶å­¦ä¹ è¿™ä¸¤è€…ã€‚ ååŒè¿‡æ»¤ç®—æ³• å¦‚æœç»™å®šx(1), â€¦., x(nm)ï¼Œé‚£ä¹ˆä¼°è®¡Î¸(1), â€¦.Î¸(nu): å¦‚æœç»™å®šÎ¸(1), â€¦.Î¸(nu)ï¼Œ é‚£ä¹ˆä¼°è®¡x(1), â€¦., x(nm) ä»£ä»·å‡½æ•° $J \left( x ^ { ( 1 ) } , \ldots x ^ { \left( n _ { m } \right) } , \theta ^ { ( 1 ) } , \ldots , \theta ^ { \left( n _ { s } \right) } \right) = \frac { 1 } { 2 } \sum _ { ( i : j ) : r ( i , j ) = 1 } \left( \left( \theta ^ { ( j ) } \right) ^ { T } x ^ { ( i ) } - y ^ { ( i , j ) } \right) ^ { 2 } + \frac { \lambda } { 2 } \sum _ { i = 1 } ^ { n _ { m } } \sum _ { k = 1 } ^ { n } \left( x _ { k } ^ { ( j ) } \right) ^ { 2 } + \frac { \lambda } { 2 } \sum _ { j = 1 } ^ { n _ { u } } \sum _ { k = 1 } ^ { n } \left( \theta _ { k } ^ { ( j ) } \right) ^ { 2 }$ ä¼˜åŒ–ç›®æ ‡ä¼˜åŒ–å‡½æ•° $\min _ { x ^ { ( 1 ) } , \ldots , x ^ { \left( n _ { m } \right) } \theta ^ { ( 1 ) } , \ldots , \theta ^ { \left( n _ { u } \right) } } J \left( x ^ { ( 1 ) } , \ldots , x ^ { \left( n _ { m } \right) } , \theta ^ { ( 1 ) } , \ldots , \theta ^ { \left( n _ { u } \right) } \right)$ $x _ { k } ^ { ( i ) } : = x _ { k } ^ { ( i ) } - \alpha \left( \sum _ { j : r ( i , j ) = 1 } \left( \left( \theta ^ { ( j ) } \right) ^ { T } x ^ { ( i ) } - y ^ { ( i , j ) } \theta _ { k } ^ { j } + \lambda x _ { k } ^ { ( i ) } \right)\right.$ $\theta _ { k } ^ { ( i ) } : = \theta _ { k } ^ { ( i ) } - \alpha \left( \sum _ { i : r ( i , j ) = 1 } \left( \left( \theta ^ { ( j ) } \right) ^ { T } x ^ { ( i ) } - y ^ { ( i , j ) } x _ { k } ^ { ( i ) } + \lambda \theta _ { k } ^ { ( j ) } \right)\right.$ å¤‡æ³¨: åœ¨ååŒè¿‡æ»¤ç®—æ³•ä¸­ï¼Œä¸éœ€è¦ç‰¹åœ°çš„å»å­¦ä¹ æ–¹å·®é¡¹ï¼Œ å³çº¿æ€§å›å½’çš„å¸¸æ•°é¡¹ï¼Œå› ä¸ºå¦‚æœéœ€è¦ï¼Œ æˆ‘ä»¬åˆå§‹åŒ–Î¸åï¼Œ ç®—æ³•ä¼šè‡ªåŠ¨çš„å°†ä¸€ä¸ªç‰¹å¾å­¦ä¹ ä¸ºæ–¹å·®é¡¹ ååŒè¿‡æ»¤æ­¥éª¤ï¼š å…ˆåˆå§‹åŒ–$x ^ { ( 1 ) } , x ^ { ( 1 ) } , \ldots x ^ { ( n m ) } , \theta ^ { ( 1 ) } , \theta ^ { ( 2 ) } , \ldots , \theta ^ { \left( n _ { 2 } \right) }$, ä¸ºä¸€äº›éšæœºå°å€¼ ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—å‡ºæœ€å°åŒ–çš„ä»£ä»·å‡½æ•° è®­ç»ƒå®Œæˆåï¼Œ é¢„æµ‹ç”¨æˆ·ç»™ j ç”µå½± i çš„è¯„åˆ† é€šè¿‡è¿™ä¸ªå­¦ä¹ è¿‡ç¨‹è·å¾—çš„ç‰¹å¾çŸ©é˜µåŒ…å«ï¦ºæœ‰å…³ç”µå½±çš„é‡è¦æ•°æ®ï¼Œè¿™äº›æ•°æ®ï¥§æ€»æ˜¯äººèƒ½è¯»æ‡‚çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›æ•°æ®ä½œä¸ºç»™ç”¨æˆ·æ¨èç”µå½±çš„ä¾æ®ã€‚ ï¦µå¦‚ï¼Œå¦‚æœä¸€ä½ç”¨æˆ·æ­£åœ¨è§‚çœ‹ç”µå½± $x^{(i)}$ ï¼Œæˆ‘ä»¬å¯ä»¥å¯»æ‰¾å¦ä¸€éƒ¨ç”µå½± $x^{(j)}$ ï¼Œä¾æ®ä¸¤éƒ¨ç”µå½±çš„ç‰¹å¾å‘ï¥¾ä¹‹é—´çš„è·ç¦» $\left| x ^ { ( i ) } - x ^ { ( j ) } \right|$ å¤§å° å‘é‡åŒ–: ä½ç§©çŸ©é˜µåˆ†è§£å…ˆä¸¾ä¸€ä¸ªååŒç®—æ³•çš„ä¾‹å­ï¼š å½“ç»™å‡ºä¸€ä»¶äº§å“æ—¶ï¼Œä½ èƒ½å¦æ‰¾åˆ°ä¸ä¹‹ç›¸å…³çš„å…¶å®ƒäº§å“ã€‚ ä¸€ä½ç”¨æˆ·æœ€è¿‘çœ‹ä¸Šä¸€ä»¶äº§å“ï¼Œæœ‰æ²¡æœ‰å…¶å®ƒç›¸å…³çš„äº§å“ï¼Œä½ å¯ä»¥æ¨èç»™ä»–ã€‚ ä¸ºäº†å®ç°è¿™äº›åŠŸèƒ½ï¼Œ å¯ä»¥å®ç°ä¸€ç§é€‰æ‹©çš„æ–¹æ³•ï¼Œå†™å‡ºååŒè¿‡æ»¤ç®—æ³•çš„é¢„æµ‹æƒ…å†µ æœ‰å…³äºäº”éƒ¨ç”µå½±çš„æ•°æ®é›†ï¼Œæˆ‘å°†è¦åšçš„æ˜¯ï¼Œå°†è¿™äº›ç”¨æˆ·çš„ç”µå½±è¯„åˆ†ï¼Œè¿›ï¨ˆåˆ†ç»„å¹¶å­˜åˆ°ä¸€ä¸ªçŸ©é˜µä¸­ã€‚æˆ‘ä»¬æœ‰äº”éƒ¨ç”µå½±ï¼Œä»¥åŠå››ä½ç”¨æˆ·ï¼Œé‚£ä¹ˆ è¿™ä¸ªçŸ©é˜µ å°±æ˜¯ä¸€ä¸ª5ï¨ˆ4ï¦œçš„çŸ©é˜µï¼Œå®ƒå°†è¿™äº›ç”µå½±çš„ç”¨æˆ·è¯„åˆ†æ•°æ®éƒ½å­˜åœ¨çŸ©é˜µï§©ï¼š é›¶å‡å€¼åŒ– å¦‚æœæˆ‘ä»¬æ–°å¢ä¸€ä¸ªç”¨æˆ· Eveï¼Œå¹¶ä¸” Eve æ²¡æœ‰ä¸ºä»»ä½•ç”µå½±è¯„åˆ†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»¥ï§½ä¹ˆä¸ºä¾æ®ä¸ºEveæ¨èç”µå½±å‘¢ï¼Ÿ å¦‚æœæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„ååŒè¿‡æ»¤ç®—æ³•è·å¾—çš„æ¨¡å‹ï¼Œç”±äºEveæ²¡æœ‰å¯¹ä»»ä½•ç”µå½±è¿›è¡Œè¯„åˆ†ï¼Œæ‰€ä»¥ä¸ºäº†ä¼˜åŒ–æ¨¡å‹ï¼Œå‡å°‘è¯¯å·®ï¼Œæœ€ç»ˆEveçš„æ‰€æœ‰ç‰¹å¾å‚æ•°éƒ½å°†ä¸º0ï¼Œå› ä¸ºè¿™æ ·çš„æŸå¤±æ˜¯æœ€å°çš„ï¼Œå°±ä¼šå¯¼è‡´å¯¹å…¶ç”µå½±è¯„åˆ†çš„é¢„æµ‹éƒ½å°†æ˜¯0ï¼Œ é‚£ä¹ˆå°±æ²¡æœ‰åŠæ³•å¯¹å…¶è¿›è¡Œç”µå½±æ¨èï¼› æ€ä¹ˆè®©æ²¡æœ‰è¯„ä»·è®°å½•çš„ç”¨æˆ·çš„é¢„æµ‹ä¸ä¸º0ï¼š é¦–å…ˆéœ€è¦å¯¹ç»“æœ Y çŸ©é˜µè¿›ï¨ˆé›¶å‡å€¼åŒ–ï¼Œå°†æ¯ä¸€ä¸ªç”¨æˆ·å¯¹æŸä¸€éƒ¨ç”µå½±çš„è¯„åˆ†å‡å»æ‰€æœ‰ç”¨æˆ·å¯¹è¯¥ç”µå½±è¯„åˆ†çš„å¹³å‡å€¼ï¼š ç„¶åæˆ‘ä»¬ï§ç”¨è¿™ä¸ªæ–°çš„ Y çŸ©é˜µæ¥è®­ç»ƒç®—æ³•ã€‚ å¦‚æœæˆ‘ä»¬è¦ç”¨æ–°è®­ç»ƒå‡ºçš„ç®—æ³•æ¥é¢„æµ‹è¯„åˆ†ï¼Œåˆ™éœ€è¦å°†å¹³å‡å€¼é‡æ–°åŠ å›å»ï¼Œé¢„æµ‹ $\left( \theta ^ { ( j ) } \right) ^ { T } x ^ { ( i ) } + \mu _ { i }$ï¼Œå¯¹äºEveï¼Œæˆ‘ä»¬çš„æ–°æ¨¡å‹ä¼šè®¤ä¸ºå¥¹ç»™æ¯éƒ¨ç”µå½±çš„è¯„åˆ†éƒ½æ˜¯è¯¥ç”µå½±çš„å¹³å‡åˆ†ï¼Œ è¿™æ ·å°±é˜²æ­¢äº†å…¶å¯¹æ‰€æœ‰çš„ç”µå½±è¯„åˆ†éƒ½ä¸ºäº†ï¼Œå¯¼è‡´æ¨èç³»ç»Ÿå¼‚å¸¸çš„åˆ¤æ–­ã€‚]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>ç›‘ç£å­¦ä¹ </tag>
        <tag>æ¨èç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¼‚å¸¸æ£€æµ‹æ¨¡å‹]]></title>
    <url>%2F2018%2F12%2F14%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E5%BC%82%E5%B8%B8%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[1.å¼‚å¸¸æ£€æµ‹ä½¿ç”¨åœºæ™¯ä»€ä¹ˆæ˜¯å¼‚å¸¸æ£€æµ‹ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚åœ¨åŒ»é™¢ä½“æ£€æµ‹é‡æˆ‘ä»¬çš„è¡€æ¶²ä¸­å„ç§æˆåˆ†çš„å«é‡ï¼Œæ¯ä¸€ç§å«é‡éƒ½å¯ä»¥æ˜¯ä¸€ç§ç‰¹å¾ï¼Œæ¯”å¦‚ç»´ç”Ÿç´ ï¼Œå¾®é‡å…ƒç´ ç­‰å«é‡ã€‚å½“æµ‹é‡çš„äººå¾ˆå¤šï¼Œè¿™æ ·ï¼Œå°±æœ‰äº†ä¸€ä¸ªæ•°æ®é›†ï¼Œç»˜åˆ¶æˆå›¾æ ‡ç±»ä¼¼ä¸‹é¢çš„æ ·å­ï¼š è¿™ï§©çš„æ¯ä¸ªç‚¹ã€æ¯ä¸ªå‰ï¼Œéƒ½æ˜¯ä½ çš„æ— æ ‡ç­¾æ•°æ®ã€‚è¿™æ ·ï¼Œå¼‚å¸¸æ£€æµ‹é—®é¢˜å¯ä»¥å®šä¹‰å¦‚ä¸‹ï¼šå‡è®¾æœ‰ä¸€ä¸ªäººçš„ç‰¹å¾å˜é‡ä¸º$x_test$ ã€‚æ‰€è°“çš„å¼‚å¸¸æ£€æµ‹é—®é¢˜å°±æ˜¯ï¼šæˆ‘ä»¬å¸Œæœ›çŸ¥é“çŸ¥é“è¿™ä¸ªäººçš„æµ‹è¯•æŒ‡æ ‡æ˜¯å¦æ­£å¸¸èŒƒå›´ï¼Œæˆ–è€…è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ¤æ–­è¿™ä¸ªäººè¿›è¡Œè¿›ä¸€æ­¥çš„æ£€æŸ¥ã€‚å¦‚æœè¢«æ£€æŸ¥çš„äººçš„å„é¡¹æŒ‡æ ‡éƒ½åœ¨æ­£å¸¸èŒƒå›´å†…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ¤æ–­è¯¥äººçš„ä½“æ£€æ¥å£å±äºæ­£å¸¸ï¼Œè€Œï¥§éœ€è¦è¿›ä¸€æ­¥çš„æ£€æŸ¥ã€‚ ç»™å®šæ•°æ®é›†$x^{(1)}, x^{(2)}, â€¦.,x^{(m)}$ ï¼Œæˆ‘ä»¬å‡ä½¿æ•°æ®é›†æ˜¯æ­£å¸¸çš„ï¼Œæˆ‘ä»¬å¸Œæœ›çŸ¥é“æ–°çš„æ•°æ® $x_{test}$ æ˜¯ï¥§æ˜¯å¼‚å¸¸çš„ï¼Œå³è¿™ä¸ªæµ‹è¯•æ•°æ®ï¥§å±äºè¯¥ç»„æ•°æ®çš„å‡ ç‡å¦‚ä½•ã€‚æˆ‘ä»¬æ‰€æ„å»ºçš„æ¨¡å‹åº”è¯¥èƒ½æ ¹æ®è¯¥æµ‹è¯•æ•°æ®çš„ä½ç½®å‘Šè¯‰æˆ‘ä»¬å…¶å±äºä¸€ç»„æ•°æ®çš„å¯èƒ½æ€§ p(x) , ç»¼ä¸Šå¯ä»¥å®šä¹‰å¼‚å¸¸æ£€æµ‹ï¼Œ å°±æ˜¯é€šè¿‡åˆ¤æ ¹æ®æµ‹è¯•æ•°æ®å’Œæ‰€æœ‰æµ‹è¯•é›†çš„å…³ç³»æ¥åˆ¤æ–­å…¶æ­£å¸¸(æˆ–å¼‚å¸¸)çš„æ¦‚ç‡ã€‚ ä¸Šå›¾ä¸­ï¼Œåœ¨è“è‰²åœˆå†…çš„æ•°æ®å±äºè¯¥ç»„æ•°æ®çš„å¯èƒ½æ€§è¾ƒé«˜ï¼Œè€Œè¶Šæ˜¯åè¿œçš„æ•°æ®ï¼Œå…¶å±äºè¯¥ç»„æ•°æ®çš„å¯èƒ½æ€§å°±è¶Šä½ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºå¯†åº¦ä¼°è®¡ï¼Œå°±æ˜¯å¼‚å¸¸æ£€æµ‹çš„æ ¸å¿ƒæ€æƒ³ï¼Œè¡¨è¾¾å¦‚ä¸‹ï¼š â€‹ If $\quad p ( x ) \left{ \begin{array} { l l } { &lt; \varepsilon } &amp; { \text { anomaly } } \ { &gt; = \varepsilon } &amp; { \text { normal } } \end{array} \right.$ å¼‚å¸¸æ£€æµ‹çš„ä¾‹å­ å¼‚å¸¸æ£€æµ‹ä¸»è¦ç”¨æ¥è¯†åˆ«æ¬ºéª—ã€‚ï¦µå¦‚åœ¨çº¿é‡‡é›†è€Œæ¥çš„æœ‰å…³ç”¨æˆ·çš„æ•°æ®ï¼Œä¸€ä¸ªç‰¹å¾å‘ï¥¾ä¸­å¯èƒ½ä¼šåŒ…å«å¦‚ï¼šç”¨æˆ·å¤šä¹…ç™»å½•ä¸€æ¬¡ï¼Œè®¿é—®è¿‡çš„é¡µé¢ï¼Œåœ¨è®ºå›å‘å¸ƒçš„å¸–å­æ•°ï¥¾ï¼Œç”šè‡³æ˜¯æ‰“å­—é€Ÿåº¦ç­‰ã€‚å°è¯•æ ¹æ®è¿™äº›ç‰¹å¾æ„å»ºä¸€ä¸ªæ¨¡å‹ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ¨¡å‹æ¥è¯†åˆ«é‚£äº›ï¥§ç¬¦åˆè¯¥æ¨¡å¼çš„ç”¨æˆ·ã€‚ æœåŠ¡å™¨é›†ç¾¤æ£€æµ‹ï¼Œç‰¹å¾å¯èƒ½åŒ…å«ï¼šå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè¢«è®¿é—®çš„ç£ç›˜æ•°ï¥¾ï¼ŒCPUçš„è´Ÿè½½ï¼Œç½‘ç»œçš„é€šä¿¡ï¥¾ç­‰ã€‚æ ¹æ®è¿™äº›ç‰¹å¾å¯ä»¥æ„å»ºä¸€ä¸ªæ¨¡å‹ï¼Œç”¨æ¥åˆ¤æ–­æŸäº›è®¡ç®—æœºæ˜¯ï¥§æ˜¯æœ‰å¯èƒ½å‡ºé”™ï¦ºã€‚ 2.é«˜æ–¯åˆ†å¸ƒä¸€èˆ¬è‡ªç„¶ç•Œäº§ç”Ÿçš„æ•°æ®ï¼Œæˆ‘ä»¬é€šå¸¸è®¤ä¸ºä¼šç¬¦åˆé«˜æ–¯åˆ†å¸ƒï¼Œå…¶è¡¨è¾¾æ–¹å¼ä¸º: $x \sim N \left( \mu , \sigma ^ { 2 } \right)$ , åˆ™å…¶é«˜ç»¿å¯†åº¦å‡½æ•°ä¸º: $p \left( x , \mu , \sigma ^ { 2 } \right) = \frac { 1 } { \sqrt { 2 \pi } \sigma } \exp \left( - \frac { ( x - \mu ) ^ { 2 } } { 2 \sigma ^ { 2 } } \right)$ , æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å·²æœ‰çš„æ•°æ®æ¥é¢„æµ‹æ€»ä½“ä¸­çš„u å’Œ Ïƒ2ï¼Œ è®¡ç®—æ–¹æ³•å¦‚ä¸‹: $\mu = \frac { 1 } { m } \sum _ { i = 1 } ^ { m } x ^ { ( i ) }$ ; $\sigma ^ { 2 } = \frac { 1 } { m } \sum _ { i = 1 } ^ { m } \left( x ^ { ( i ) } - \mu \right) ^ { 2 }$ 3.å¼‚å¸¸æ£€æµ‹ç®—æ³•æ¨¡å‹æ„å»ºæ­¥éª¤å¼€å§‹æ€»ç»“ä½¿ç”¨é«˜æ–¯åˆ†å¸ƒçš„å¼‚å¸¸æ£€æµ‹ç®—æ³• å¼‚å¸¸æ£€æµ‹ç®—æ³•: å¯¹äºç»™å®šçš„æ•°æ®é›†$x ^ { ( 1 ) } , x ^ { ( 2 ) } , \dots , x ^ { ( m ) }$ï¼Œ è®¡ç®—é«˜æ–¯åˆ†å¸ƒçš„uå’ŒÏƒ2çš„ä¼°è®¡å€¼ã€‚ â€‹ $\mu _ { j } = \frac { 1 } { m } \sum _ { i = 1 } ^ { m } x _ { j } ^ { ( i ) }$â€‹ $\sigma _ { j } ^ { 2 } = \frac { 1 } { m } \sum _ { i = 1 } ^ { m } \left( x _ { j } ^ { ( i ) } - \mu _ { j } \right) ^ { 2 }$ æ¨å¯¼å‡ºå¯¹åº”çš„é«˜æ–¯åˆ†å¸ƒåï¼Œ æµ‹è¯•å¯¹åº”æµ‹è¯•å®ä¾‹çš„æ­£å¸¸æ¦‚ç‡p(x); â€‹ $p ( x ) = \prod _ { j = 1 } ^ { n } p \left( x _ { j } ; \mu _ { j } , \sigma _ { j } ^ { 2 } \right) = \prod _ { j = 1 } ^ { 1 } \frac { 1 } { \sqrt { 2 \pi } \sigma _ { j } } \exp \left( - \frac { \left( x _ { j } - \mu _ { j } \right) ^ { 2 } } { 2 \sigma _ { j } ^ { 2 } } \right)$ é€‰æ‹©ä¸€ä¸ª$\varepsilonâ€‹$ ï¼Œ $p(x) = \varepsilonâ€‹$ ä½œä¸ºåˆ¤å®šè¾¹ç•Œï¼Œå½“$p ( x ) &lt; \varepsilonâ€‹$ æ—¶ï¼Œ æµ‹è¯•å®ä¾‹ä¸ºå¼‚å¸¸ï¼› å¼‚å¸¸æ£€æµ‹ç³»ç»Ÿå¼€å‘å¼‚å¸¸æ£€æµ‹ç®—æ³•æ˜¯ä¸€ä¸ªéç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œæ„å‘³ç€æˆ‘ä»¬æ— æ³•æ ¹æ®ç»“æœå˜ï¥¾ y çš„å€¼æ¥å‘Šè¯‰æˆ‘ä»¬æ•°æ®æ˜¯å¦çœŸçš„æ˜¯å¼‚å¸¸çš„ã€‚æˆ‘ä»¬éœ€è¦å¦ä¸€ç§æ–¹æ³•æ¥å¸®åŠ©æ£€éªŒç®—æ³•æ˜¯å¦æœ‰æ•ˆã€‚å½“æˆ‘ä»¬å¼€å‘ä¸€ä¸ªå¼‚å¸¸æ£€æµ‹ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬ä»å¸¦æ ‡è®°ï¼ˆå¼‚å¸¸æˆ–æ­£å¸¸ï¼‰çš„æ•°æ®ç€æ‰‹ï¼Œæˆ‘ä»¬ä»å…¶ä¸­é€‰æ‹©ä¸€éƒ¨åˆ†æ­£å¸¸æ•°æ®ç”¨äºæ„å»ºè®­ç»ƒé›†ï¼Œç„¶åç”¨å‰©ä¸‹çš„æ­£å¸¸æ•°æ®å’Œå¼‚å¸¸æ•°æ®æ··åˆçš„æ•°æ®æ„æˆäº¤å‰æ£€éªŒé›†å’Œæµ‹è¯•é›†ã€‚ æ„å»ºæ­¥éª¤ å°†æ•°æ®é›†åˆ’åˆ†æˆè®­ç»ƒé›†ï¼Œäº¤å‰æ£€éªŒé›†ï¼Œ å’Œæµ‹è¯•é›†ï¼› è¿›è¡Œæ¨¡å‹æ„å»º å°è¯•ä½¿ç”¨ä¸åŒçš„ $\varepsilon$ ä½œä¸ºé˜ˆå€¼ï¼Œå¹¶é¢„æµ‹æ•°æ®æ˜¯å¦å¼‚å¸¸ï¼Œæ ¹æ®F1å€¼æˆ–è€…æŸ¥å‡†ç‡ä¸æŸ¥å…¨ç‡æ¯”ä¾‹æ¥é€‰æ‹©$\varepsilon$ é€‰å‡º $\varepsilon$ åï¼Œé’ˆå¯¹æµ‹è¯•é›†è¿›ï¨ˆé¢„æµ‹ï¼Œè®¡ç®—å¼‚å¸¸æ£€éªŒç³»ç»Ÿçš„ å€¼ï¼Œæˆ–è€…æŸ¥å‡†ç‡ä¸æŸ¥å…¨ç‡ä¹‹æ¯” 4. å¼‚å¸¸æ£€æµ‹å’Œç›‘ç£å­¦ä¹ çš„å¯¹æ¯” æ€»ç»“ï¼š å½“æˆ‘ä»¬çš„æ•°æ®é›†æ­£è´Ÿåˆ†ç±»æ•°é‡çº§å·®ä¸å¤šçš„æ—¶å€™ï¼Œå¹¶ä¸”æ­£è´Ÿåˆ†ç±»éƒ½æœ‰å¯¹åº”çš„æ ‡ç­¾çš„æ—¶å€™é€‰æ‹©ç›‘ç£å­¦ä¹ ï¼› åä¹‹å½“æˆ‘ä»¬æœ‰å¤§é‡çš„æ•°æ®ï¼Œæ•°æ®çš„æ­£æ ·æœ¬ç‰¹åˆ«å°‘ï¼Œ å¯ä»¥ä½¿ç”¨å¼‚å¸¸æ£€æµ‹ï¼› 5.ç‰¹å¾é€‰æ‹©ç‰¹å¾è½¬æ¢ å¼‚å¸¸æ£€æµ‹å‡è®¾ç‰¹å¾ç¬¦åˆé«˜æ–¯åˆ†å¸ƒï¼Œå¦‚æœæ•°æ®çš„åˆ†å¸ƒï¥§æ˜¯é«˜æ–¯åˆ†å¸ƒï¼Œå¼‚å¸¸æ£€æµ‹ç®—æ³•ä¹Ÿèƒ½å¤Ÿå·¥ä½œï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯å°†æ•°æ®è½¬æ¢æˆé«˜æ–¯åˆ†å¸ƒï¼Œï¦µå¦‚ä½¿ç”¨å¯¹æ•°å‡½æ•°ï¼š$x = \log ( x + c )$ ï¼Œå…¶ä¸­ c ä¸ºéè´Ÿå¸¸æ•°ï¼› æˆ–è€… $x = x ^ { c }$ ï¼Œc ä¸º 0-1 ä¹‹é—´çš„ä¸€ä¸ªåˆ†æ•°ï¼Œç­‰æ–¹æ³•ã€‚(ç¼–è€…æ³¨ï¼šåœ¨pythonä¸­ï¼Œé€šå¸¸ç”¨ np.log1p() å‡½æ•°ï¼Œlog1p å°±æ˜¯ log(x + 1)ï¼Œå¯ä»¥é¿å…å‡ºç°è´Ÿæ•°ç»“æœï¼Œåå‘å‡½æ•°å°±æ˜¯ np.expm1() ) å¼‚å¸¸æ£€æµ‹ç»“æœåˆ†æ ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ä¸€äº›å¼‚å¸¸çš„æ•°æ®å¯èƒ½ä¹Ÿä¼šæœ‰è¾ƒé«˜çš„ p(x) å€¼ï¼Œå› è€Œè¢«ç®—æ³•è®¤ä¸ºæ˜¯æ­£å¸¸çš„ã€‚è¿™ç§æƒ…å†µä¸‹è¯¯å·®åˆ†æèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æé‚£äº›è¢«ç®—æ³•é”™è¯¯é¢„æµ‹ä¸ºæ­£å¸¸çš„æ•°æ®ï¼Œè§‚å¯Ÿèƒ½å¦æ‰¾å‡ºä¸€äº›é—®é¢˜ã€‚æˆ‘ä»¬å¯èƒ½èƒ½ä»é—®é¢˜ä¸­å‘ç°æˆ‘ä»¬éœ€è¦å¢åŠ ä¸€äº›æ–°çš„ç‰¹å¾ï¼Œå¢åŠ è¿™äº›æ–°ç‰¹å¾åè·å¾—çš„æ–°ç®—æ³•èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ï¤å¥½åœ°è¿›ï¨ˆå¼‚å¸¸æ£€æµ‹ã€‚ æˆ‘ä»¬é€šå¸¸å¯ä»¥é€šè¿‡å°†ä¸€äº›ç›¸å…³çš„ç‰¹å¾è¿›ï¨ˆç»„åˆï¼Œæ¥è·å¾—ä¸€äº›æ–°çš„ï¤å¥½çš„ç‰¹å¾ï¼ˆå¼‚å¸¸æ•°æ®çš„è¯¥ç‰¹å¾å€¼å¼‚å¸¸åœ°å¤§æˆ–å°ï¼‰ï¼Œï¦µå¦‚ï¼Œåœ¨æ£€æµ‹æ•°æ®ä¸­å¿ƒçš„è®¡ç®—æœºçŠ¶å†µçš„ï¦µå­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨CPUè´Ÿè½½ä¸ç½‘ç»œé€šä¿¡ï¥¾çš„æ¯”ï¦µä½œä¸ºä¸€ä¸ªæ–°çš„ç‰¹å¾ï¼Œå¦‚æœè¯¥å€¼å¼‚å¸¸åœ°å¤§ï¼Œï¥¥æœ‰å¯èƒ½æ„å‘³ç€è¯¥æœåŠ¡ï¨¸æ˜¯é™·å…¥ï¦ºä¸€äº›é—®é¢˜ä¸­ã€‚ 6.å¤šå…ƒé«˜æ–¯åˆ†å¸ƒæ¯”å¦‚æˆ‘ä»¬çš„æ•°æ®é›†çš„ç‰¹å¾æ˜¯ä¸¤ä¸ªç›¸å…³çš„ç‰¹å¾ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªç‰¹å¾çš„å€¼åŸŸèŒƒå›´æ¯”è¾ƒå®½ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸€èˆ¬çš„é«˜æ–¯åˆ†å¸ƒæ¨¡å‹å¯èƒ½ï¥§èƒ½å¾ˆå¥½åœ°è¯†åˆ«å¼‚å¸¸æ•°æ®ã€‚å…¶åŸå› åœ¨äºï¼Œä¸€èˆ¬çš„é«˜æ–¯åˆ†å¸ƒæ¨¡å‹å°è¯•çš„æ˜¯å»åŒæ—¶æŠ“ä½ä¸¤ä¸ªç‰¹å¾çš„åå·®ï¼Œå› æ­¤åˆ›é€ å‡ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„åˆ¤å®šè¾¹ç•Œã€‚ ä¸‹å›¾ä¸­æ˜¯ä¸¤ä¸ªç›¸å…³ç‰¹å¾ï¼Œæ´‹çº¢è‰²çš„çº¿ï¼ˆæ ¹æ®Îµçš„ï¥§åŒå…¶èŒƒå›´å¯å¤§å¯å°ï¼‰æ˜¯ä¸€èˆ¬çš„é«˜æ–¯åˆ†å¸ƒæ¨¡å‹è·å¾—çš„åˆ¤å®šè¾¹ç•Œï¼Œå¾ˆæ˜æ˜¾ç»¿è‰²çš„Xæ‰€ä»£è¡¨çš„æ•°æ®ç‚¹å¾ˆå¯èƒ½æ˜¯å¼‚å¸¸å€¼ï¼Œä½†æ˜¯å…¶ p(x) å€¼å´ä»ç„¶åœ¨æ­£å¸¸èŒƒå›´å†…ã€‚å¤šå…ƒé«˜æ–¯åˆ†å¸ƒå°†åˆ›å»ºåƒå›¾ä¸­è“è‰²æ›²çº¿æ‰€ç¤ºçš„åˆ¤å®šè¾¹ç•Œã€‚ åœ¨ä¸€èˆ¬çš„é«˜æ–¯åˆ†å¸ƒæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬è®¡ç®— p(x) çš„æ–¹æ³•æ˜¯ï¼š é€šè¿‡åˆ†åˆ«è®¡ç®—æ¯ä¸ªç‰¹å¾å¯¹åº”çš„å‡ ç‡ç„¶åå°†å…¶ç´¯ä¹˜èµ·æ¥ï¼Œåœ¨å¤šå…ƒé«˜æ–¯åˆ†å¸ƒæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºç‰¹å¾çš„åæ–¹å·®çŸ©é˜µï¼Œç”¨æ‰€æœ‰çš„ç‰¹å¾ä¸€èµ·æ¥è®¡ç®— p(x) ã€‚ å¤šå…ƒé«˜æ–¯åˆ†å¸ƒç®—æ³•æ­¥éª¤: è®¡ç®—æ‰€æœ‰ç‰¹å¾çš„å¹³å‡å€¼ï¼Œå†è®¡ç®—åæ–¹å·®çŸ©é˜µï¼› â€‹ $\mu = \frac { 1 } { m } \sum _ { i = 1 } ^ { m } x ^ { ( i ) }$ â€‹ $\Sigma = \frac { 1 } { m } \sum _ { i = 1 } ^ { m } \left( x ^ { ( i ) } - \mu \right) \left( x ^ { ( i ) } - \mu \right) ^ { T } = \frac { 1 } { m } ( X - \mu ) ^ { T } ( X - \mu )$ è®¡ç®—é«˜æ–¯åˆ†å¸ƒp(x) â€‹ $p ( x ) = \frac { 1 } { ( 2 \pi ) ^ { \frac { n } { 2 } } | \Sigma | ^ { \frac { 1 } { 2 } } } \exp \left( - \frac { 1 } { 2 } ( x - \mu ) ^ { T } \Sigma ^ { - 1 } ( x - \mu ) \right)$ â€‹ æ³¨: $\Sigma$æ˜¯å®šçŸ©é˜µï¼Œåœ¨ Octave ä¸­ç”¨ det(sigma) è®¡ç®—ï¼Œ $\Sigma ^ { - 1 }$æ˜¯é€†çŸ©é˜µ é€‰æ‹©ä¸€ä¸ª$\varepsilon$ ï¼Œ $p(x) = \varepsilon$ ä½œä¸ºåˆ¤å®šè¾¹ç•Œï¼Œå½“$p ( x ) &lt; \varepsilon$ æ—¶ï¼Œ æµ‹è¯•å®ä¾‹ä¸ºå¼‚å¸¸ï¼› åæ–¹å·®çŸ©é˜µå¯¹æ¨¡å‹çš„å½±å“ å½“ä»å·¦ä¸‹åˆ°å³ä¸Šçš„å¯¹è§’çº¿ä¸Šçš„æ•°ä¸ä¸º0çš„æ—¶å€™ï¼Œè¡¨ç¤ºç‰¹å¾ä¹‹é—´å­˜åœ¨ç›¸å…³æ€§ ä¸Šå›¾æ˜¯5ä¸ªï¥§åŒçš„æ¨¡å‹ï¼Œä»å·¦å¾€å³ä¾æ¬¡åˆ†æï¼š æ˜¯ä¸€ä¸ªä¸€èˆ¬çš„é«˜æ–¯åˆ†å¸ƒæ¨¡å‹ é€šè¿‡åæ–¹å·®çŸ©é˜µï¼Œä»¤ç‰¹å¾1æ‹¥æœ‰è¾ƒå°çš„åå·®ï¼ŒåŒæ—¶ä¿æŒç‰¹å¾2çš„åå·® é€šè¿‡åæ–¹å·®çŸ©é˜µï¼Œä»¤ç‰¹å¾2æ‹¥æœ‰è¾ƒå¤§çš„åå·®ï¼ŒåŒæ—¶ä¿æŒç‰¹å¾1çš„åå·® é€šè¿‡åæ–¹å·®çŸ©é˜µï¼Œåœ¨ï¥§æ”¹å˜ä¸¤ä¸ªç‰¹å¾çš„åŸæœ‰åå·®çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸¤è€…ä¹‹é—´çš„æ­£ç›¸å…³æ€§ é€šè¿‡åæ–¹å·®çŸ©é˜µï¼Œåœ¨ï¥§æ”¹å˜ä¸¤ä¸ªç‰¹å¾çš„åŸæœ‰åå·®çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸¤è€…ä¹‹é—´çš„è´Ÿç›¸å…³æ€§ å¤šè¿œé«˜æ–¯æ¨¡å‹ä½œç”¨ å»ºç«‹å¤šè¿œé«˜æ–¯åˆ†å¸ƒæ¨¡å‹åï¼Œ å¯ä»¥é€šè¿‡åæ–¹å·®ï¼Œå»ºç«‹ä¸¤ä¸ªç‰¹å¾æˆæ­£ç›¸å…³æ€§çš„æ¨¡å‹ï¼Œè¿™æ ·å°±å¯ä»¥å°†ä¸Šå›¾ç»¿è‰²çš„ç‚¹åˆ¤æ–­ä¸ºå¼‚å¸¸ç‚¹ï¼› å¤šè¿œé«˜æ–¯åˆ†å¸ƒä¸æ™®é€šé«˜æ–¯åˆ†å¸ƒå…³ç³»: å¯ä»¥è¯æ˜çš„æ˜¯ï¼ŒåŸæœ¬çš„é«˜æ–¯åˆ†å¸ƒæ¨¡å‹æ˜¯å¤šå…ƒé«˜æ–¯åˆ†å¸ƒæ¨¡å‹çš„ä¸€ä¸ªå­é›†ï¼Œå³åƒä¸Šå›¾ä¸­çš„ç¬¬1ã€2ã€3ï¼Œ3ä¸ªï¦µå­æ‰€ç¤ºï¼Œå¦‚æœåæ–¹å·®çŸ©é˜µåªåœ¨å¯¹è§’çº¿çš„å•ä½ä¸Šæœ‰éé›¶çš„å€¼æ—¶ï¼Œå³ä¸ºåŸæœ¬çš„é«˜æ–¯åˆ†å¸ƒæ¨¡å‹ï¦ºã€‚ åŸé«˜æ–¯åˆ†å¸ƒæ¨¡å‹è¢«å¹¿æ³›ä½¿ç”¨ç€ï¼Œå¦‚æœç‰¹å¾ä¹‹é—´åœ¨æŸç§ç¨‹åº¦ä¸Šå­˜åœ¨ç›¸äº’å…³è”çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ æ–°æ–°ç‰¹å¾çš„æ–¹æ³•æ¥æ•æ‰è¿™äº›ç›¸å…³æ€§ã€‚ æ€»ç»“: å¦‚æœè®­ç»ƒé›†ï¥§æ˜¯å¤ªå¤§ï¼Œå¹¶ä¸”æ²¡æœ‰å¤ªå¤šçš„ç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šå…ƒé«˜æ–¯åˆ†å¸ƒæ¨¡å‹ã€‚]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>éç›‘ç£å­¦ä¹ </tag>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>å¼‚å¸¸æ£€æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®é™ç»´ & PCA]]></title>
    <url>%2F2018%2F12%2F06%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2FPCA%E9%99%8D%E7%BB%B4%2F</url>
    <content type="text"><![CDATA[1. æ•°æ®é™ç»´æ•°æ®é™ç»´ç›®çš„æ•°æ®é™ç»´æ˜¯å¯¹æ•°æ®è¿›è¡Œå‹ç¼©çš„ä¸€ä¸ªå¼ºæœ‰åŠ›çš„å·¥å…·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéç›‘ç£å­¦ä¹ ç®—æ³•ã€‚æœ‰å‡ ä¸ªä¸åŒçš„åŸå› å¯èƒ½ä¼šè®©æˆ‘ä»¬åœ¨è¿›è¡Œå»ºæ¨¡çš„è¿‡ç¨‹ä¸­å¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†ï¼Œä¸€ã€æ•°æ®å‹ç¼©ï¼Œä¸ä»…èƒ½è®©æˆ‘ä»¬çš„æ•°æ®å ç”¨æ¯”è¾ƒå°‘çš„è®¡ç®—æœºèµ„æº(ç¡¬ç›˜ã€å†…å­˜), è¿˜å¯ä»¥é€šè¿‡å‡å°‘ç‰¹å¾çš„æ–¹å¼ï¼Œæ¥è®©æˆ‘ä»¬çš„æœºå™¨å­¦ä¹ ç®—æ³•è¿è¡Œçš„æ›´åŠ å¿«é€Ÿ; äºŒã€æ•°æ®å¯è§†åŒ–ï¼Œ å½“æ•°æ®çš„ç‰¹å¾ç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ²¡æœ‰å¯è§†åŒ–çš„æ–¹æ¡ˆï¼Œå°†ä¸€ä¸ªå¤šç»´çš„æ•°æ®è¿›è¡Œå¯è§†åŒ–å±•ç¤ºï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡PCAæ¥å°†æ•°æ®è¿›è¡Œå‹ç¼©æˆç»´åº¦æ¯”è¾ƒå°‘çš„å½¢å¼ï¼Œå†è¿›è¡Œå±•ç¤ºï¼› ä»€ä¹ˆæ˜¯æ•°æ®é™ç»´ è¿™é‡ŒæŒ‰ç…§ä¸€ä¸ªå°†äºŒç»´çš„æ•°æ®é™ç»´æˆä¸€ç»´æ¥è¿›è¡Œä¸¾ä¾‹ï¼š å‡è®¾æˆ‘ä»¬çš„æ•°æ®æœ‰ä¸¤ä¸ªç‰¹å¾: x1ï¼š é•¿åº¦ï¼Œ å•ä½æ˜¯cm ï¼› x2ï¼šæ˜¯ç”¨è‹±å¯¸è¡¨ç¤ºçš„åŒä¸€ä¸ªç‰©ä½“çš„é•¿åº¦ã€‚ æ‰€ä»¥ï¼Œè¿™ä¸¤ä¸ªç‰¹å¾ç»™ï¦ºæˆ‘ä»¬é«˜åº¦å†—ä½™è¡¨ç¤ºï¼Œä¸¤ä¸ªç‰¹å¾åŸºæœ¬ä¸Šç”¨ä¸€ä¸ªå°±å¯ä»¥è¡¨ç¤ºäº†ä¸€ä¸ªå®ä¾‹çš„é•¿åº¦ç‰¹å¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡é™ç»´æ¥å‡å°‘è¿™ä¸¤ä¸ªç‰¹å¾é€ æˆçš„å†—ä½™ï¼› å°†æ•°æ®ä»äºŒç»´é™è‡³ä¸€ç»´ï¼š å‡ä½¿æˆ‘ä»¬è¦é‡‡ç”¨ä¸¤ç§ï¥§åŒçš„ä»ªï¨¸æ¥æµ‹ï¥¾ä¸€äº›ä¸œè¥¿çš„å°ºå¯¸ï¼Œå…¶ä¸­ä¸€ä¸ªä»ªï¨¸æµ‹ï¥¾ç»“æœçš„å•ä½æ˜¯è‹±å¯¸ï¼Œå¦ä¸€ä¸ªä»ªï¨¸æµ‹ï¥¾çš„ç»“æœæ˜¯å˜ç±³ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æµ‹ï¥¾çš„ç»“æœä½œä¸ºæˆ‘ä»¬æœºï¨¸å­¦ä¹ çš„ç‰¹å¾ã€‚ç°åœ¨çš„é—®é¢˜çš„æ˜¯ï¼Œä¸¤ç§ä»ªï¨¸å¯¹åŒä¸€ä¸ªä¸œè¥¿æµ‹ï¥¾çš„ç»“æœï¥§å®Œå…¨ç›¸ç­‰ï¼ˆç”±äºè¯¯å·®ã€ç²¾åº¦ç­‰ï¼‰ï¼Œè€Œå°†ä¸¤è€…éƒ½ä½œä¸ºç‰¹å¾æœ‰äº›é‡å¤ï¼Œå› è€Œï¼Œæˆ‘ä»¬å¸Œæœ›å°†è¿™ä¸ªäºŒç»´çš„æ•°æ®é™è‡³ä¸€ç»´ã€‚ å°†æˆ‘ä»¬çš„æ•°æ®é›†çš„ç‰¹å¾å‡å°‘å†—ä½™ï¼Œåœ¨ä¿æŒè¯¯å·®åŸºæœ¬ä¸å˜çš„æƒ…å†µï¼Œå‡å°‘ç‰¹å¾çš„æ•°é‡ï¼Œè¿™å°±æ˜¯æ•°æ®çš„é™ç»´ï¼› 2.æ•°æ®å‹ç¼©ä¸‹é¢ä»‹ç»å°†å†—ä½™æ•°æ®è¿›è¡Œå‹ç¼©çš„æ–¹æ³• å°†äºŒç»´æ•°æ®é™ç»´è‡³ä¸€ç»´: å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€æ‰¹ç‰¹å¾ï¼Œx1ä¸ºå­¦ç”Ÿå­¦ä¹ çš„ç§¯æç¨‹åº¦ï¼Œ x2ä¸ºå­¦ç”ŸçŸ¥è¯†çš„æŒæ¡ç¨‹åº¦ï¼Œè¿™ä¸¤ä¸ªç‰¹å¾å¯èƒ½éƒ½å¯ä»¥ä»£è¡¨å­¦ç”Ÿçš„å­¦ä¹ æˆæœã€‚æ‰€ä»¥ï¼Œç›¸æ¯”è¿™ä¸¤ç§ç‰¹å¾ï¼Œæˆ‘ä»¬å¯èƒ½æ›´å€¾å‘äºè·å¾—ç‰¹å¾â€“å­¦ç”Ÿçš„çŸ¥è¯†æŒæ¡ç¨‹åº¦z, æ¥ä»£æ›¿x1ï¼Œ x2ä¸¤ä¸ªç‰¹å¾ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬çœŸæ­£å…³å¿ƒçš„ï¼Œå¯èƒ½æ˜¯ä¸Šé¢é‚£æ¡çº¢è‰²çš„çº¿çš„æ–¹å‘ï¼Œä»¥åŠç‰¹å¾æ˜ å°„åˆ°å…¶ä¸Šçš„ç‚¹ï¼Œä»£è¡¨å­¦ç”Ÿçš„çŸ¥è¯†é‡; ä¸Šé¢è¿™å¹…å›¾è¡¨ç¤ºï¼Œå°†äºŒç»´æ•°æ®é™ç»´æˆä¸€ä½æ•°æ®çš„è¿‡ç¨‹ å°†ä¸‰ç»´æ•°æ®é™ç»´è‡³äºŒç»´: è¿‡ç¨‹æ˜¯ä¸ä¸Šé¢ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å°†ä¸‰ç»´å‘ï¥¾æŠ•å°„åˆ°ä¸€ä¸ªäºŒç»´çš„å¹³é¢ä¸Šï¼Œå¼ºè¿«ä½¿å¾—æ‰€æœ‰çš„æ•°æ®éƒ½åœ¨åŒä¸€ä¸ªå¹³é¢ä¸Šï¼Œé™è‡³äºŒç»´çš„ç‰¹å¾å‘ï¥¾ã€‚ è¿™æ ·çš„å¤„ï§¤è¿‡ç¨‹å¯ä»¥è¢«ç”¨äºæŠŠä»»ä½•ç»´åº¦çš„æ•°æ®é™åˆ°ä»»ä½•æƒ³è¦çš„ç»´åº¦ï¼Œï¦µå¦‚å°†1000ç»´çš„ç‰¹å¾é™è‡³100ç»´ã€‚ 3.æ•°æ®å¯è§†åŒ–åœ¨è®¸å¤šåŠå…¶å­¦ä¹ é—®é¢˜ä¸­ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å°†æ•°æ®å¯è§†åŒ–ï¼Œæˆ‘ä»¬ï¥¥èƒ½å¯»æ‰¾åˆ°ä¸€ä¸ªï¤å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œé™ç»´å¯ä»¥å¸®åŠ©æˆ‘ä»¬ã€‚ å‡ä½¿æˆ‘ä»¬æœ‰æœ‰å…³äºè®¸å¤šï¥§åŒå›½å®¶çš„æ•°æ®ï¼Œæ¯ä¸€ä¸ªç‰¹å¾å‘ï¥¾éƒ½æœ‰50ä¸ªç‰¹å¾ï¼ˆå¦‚GDPï¼Œäººå‡GDPï¼Œå¹³å‡å¯¿å‘½ç­‰ï¼‰ã€‚å¦‚æœè¦å°†è¿™ä¸ª50ç»´çš„æ•°æ®å¯è§†åŒ–æ˜¯ï¥§å¯èƒ½çš„ã€‚ä½¿ç”¨é™ç»´çš„æ–¹æ³•å°†å…¶é™è‡³2ç»´ï¼Œæˆ‘ä»¬ï¥¥å¯ä»¥å°†å…¶å¯è§†åŒ–ï¦ºã€‚ è¿™æ ·åšçš„é—®é¢˜åœ¨äºï¼Œé™ç»´çš„ç®—æ³•åªè´Ÿè´£å‡å°‘ç»´æ•°ï¼Œæ–°äº§ç”Ÿçš„ç‰¹å¾çš„æ„ä¹‰å°±å¿…é¡»ç”±æˆ‘ä»¬è‡ªå·±å»å‘ç°ï¦ºã€‚ 4.ä¸»æˆåˆ†åˆ†æé—®é¢˜ä¸»æˆåˆ†åˆ†æ(PCA)æ˜¯æœ€å¸¸è§çš„é™ç»´ç®—æ³•ã€‚åœ¨PCAä¸­ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ–¹å‘å‘ï¥¾ï¼ˆVector directionï¼‰ï¼Œå½“æˆ‘ä»¬æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½æŠ•å°„åˆ°è¯¥å‘ï¥¾ä¸Šæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æŠ•å°„å¹³å‡å‡æ–¹è¯¯å·®èƒ½å°½å¯èƒ½åœ°å°ã€‚æ–¹å‘å‘ï¥¾æ˜¯ä¸€ä¸ªç»è¿‡åŸç‚¹çš„å‘ï¥¾ï¼Œè€ŒæŠ•å°„è¯¯å·®æ˜¯ä»ç‰¹å¾å‘ï¥¾å‘è¯¥æ–¹å‘å‘ï¥¾ä½œå‚çº¿çš„é•¿åº¦ã€‚ ä¸»æˆåˆ†åˆ†æé—®é¢˜çš„æè¿°ï¼šé—®é¢˜æ˜¯è¦å°†ç»´æ•°æ®é™è‡³ k ç»´ï¼Œç›®æ ‡æ˜¯æ‰¾åˆ°å‘ï¥¾$u^{(i)}, u^{(2)}, â€¦., u^{(k)}$, ä½¿å¾—æ‰€æœ‰çš„å®ä¾‹åˆ°å‘é‡çš„æ€»çš„æŠ•å°„è¯¯å·®æœ€å°ã€‚ ä¸»æˆåˆ†åˆ†æä¸çº¿æ€§å›é¡¾çš„æ¯”è¾ƒï¼šä¸»æˆåˆ†åˆ†æä¸çº¿æ€§å›å½’æ˜¯ä¸¤ç§ï¥§åŒçš„ç®—æ³•ã€‚ä¸»æˆåˆ†åˆ†ææœ€å°åŒ–çš„æ˜¯æŠ•å°„è¯¯å·®ï¼ˆProjected Errorï¼‰ï¼Œè€Œçº¿æ€§å›å½’å°è¯•çš„æ˜¯æœ€å°åŒ–é¢„æµ‹è¯¯å·®ã€‚çº¿æ€§å›å½’çš„ç›®çš„æ˜¯é¢„æµ‹ç»“æœï¼Œè€Œä¸»æˆåˆ†åˆ†æï¥§ä½œä»»ä½•é¢„æµ‹ã€‚ ä¸Šå›¾ä¸­ï¼Œå·¦è¾¹çš„æ˜¯çº¿æ€§å›å½’çš„è¯¯å·®ï¼ˆå‚ç›´äºæ¨ªè½´æŠ•å½±ï¼‰ï¼Œå³è¾¹åˆ™æ˜¯ä¸»è¦æˆåˆ†åˆ†æçš„è¯¯å·®ï¼ˆå‚ç›´äºçº¢çº¿æŠ•å½±ï¼‰ã€‚ PCAå°†nä¸ªç‰¹å¾é™ç»´åˆ°kä¸ªï¼Œå¯ä»¥ç”¨æ¥è¿›ï¨ˆæ•°æ®å‹ç¼©ï¼Œå¦‚æœ100ç»´çš„å‘ï¥¾æœ€åå¯ä»¥ç”¨10ç»´æ¥è¡¨ç¤ºï¼Œé‚£ä¹ˆå‹ç¼©ç‡ä¸º90%ã€‚ä½†PCA è¦ä¿è¯é™ç»´åï¼Œè¿˜è¦ä¿è¯æ•°æ®çš„ç‰¹æ€§æŸå¤±æœ€å°ã€‚ PCAæŠ€æœ¯çš„ä¸€å¤§å¥½å¤„æ˜¯å¯¹æ•°æ®è¿›ï¨ˆé™ç»´çš„å¤„ï§¤ã€‚æˆ‘ä»¬å¯ä»¥å¯¹æ–°æ±‚å‡ºçš„â€œä¸»å…ƒâ€å‘ï¥¾çš„é‡è¦æ€§è¿›ï¨ˆæ’åºï¼Œæ ¹æ®éœ€è¦å–å‰é¢æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå°†åé¢çš„ç»´æ•°çœå»ï¼Œå¯ä»¥è¾¾åˆ°é™ç»´ä»è€Œç®€åŒ–æ¨¡å‹æˆ–æ˜¯å¯¹æ•°æ®è¿›ï¨ˆå‹ç¼©çš„æ•ˆæœã€‚åŒæ—¶æœ€å¤§ç¨‹åº¦çš„ä¿æŒï¦ºåŸæœ‰æ•°æ®çš„ä¿¡æ¯ã€‚ PCAçš„ä¼˜ç‚¹ PCAæŠ€æœ¯çš„ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒæ˜¯å®Œå…¨æ— å‚æ•°é™åˆ¶çš„ã€‚åœ¨PCAçš„è®¡ç®—è¿‡ç¨‹ä¸­å®Œå…¨ï¥§éœ€è¦äººä¸ºçš„è®¾å®šå‚æ•°æˆ–æ˜¯æ ¹æ®ä»»ä½•ç»éªŒæ¨¡å‹å¯¹è®¡ç®—è¿›ï¨ˆå¹²é¢„ï¼Œæœ€åçš„ç»“æœåªä¸æ•°æ®ç›¸å…³ï¼Œä¸ç”¨æˆ·æ˜¯ç‹¬ç«‹çš„ã€‚ PCAçš„ç¼ºç‚¹ å¦‚æœç”¨æˆ·å¯¹è§‚æµ‹å¯¹è±¡æœ‰ä¸€å®šçš„å…ˆéªŒçŸ¥è¯†ï¼ŒæŒæ¡ï¦ºæ•°æ®çš„ä¸€äº›ç‰¹å¾ï¼Œæœ¬å¯ä»¥æ ¹æ®ç»éªŒåšä¸€äº›æ•°æ®çš„æ•´åˆæˆ–é™ç»´ï¼Œä½†ä½¿ç”¨PCAå´æ— æ³•é€šè¿‡å‚æ•°åŒ–ç­‰æ–¹æ³•å¯¹å¤„ï§¤è¿‡ç¨‹è¿›ï¨ˆå¹²é¢„ï¼Œå¯èƒ½ä¼šå¾—ï¥§åˆ°é¢„æœŸçš„æ•ˆæœï¼Œæ•ˆç‡ä¹Ÿï¥§é«˜ã€‚ 5.ä¸»æˆåˆ†åˆ†æç®—æ³•PCA å‡å°‘nç»´åˆ°kç»´ï¼šç¬¬ä¸€æ­¥æ˜¯å‡å€¼å½’ä¸€åŒ–ã€‚æˆ‘ä»¬éœ€è¦è®¡ç®—å‡ºæ‰€æœ‰ç‰¹å¾çš„å‡å€¼ï¼Œç„¶åä»¤ $x_j = x_j - u_j$ã€‚å¦‚æœç‰¹å¾æ˜¯åœ¨ï¥§åŒçš„æ•°ï¥¾çº§ä¸Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å…¶é™¤ä»¥æ ‡å‡†å·® $\sigma^2$ ã€‚ç¬¬äºŒæ­¥æ˜¯è®¡ç®—åæ–¹å·®çŸ©é˜µï¼ˆcovariance matrixï¼‰ $\Sigma : \sum = \frac { 1 } { m } \sum _ { i - 1 } ^ { n } \left( x ^ { ( i ) } \right) \left( x ^ { ( i ) } \right) ^ { T }$ç¬¬ä¸‰æ­¥æ˜¯è®¡ç®—åæ–¹å·®çŸ©é˜µ$\Sigma$çš„ç‰¹å¾å‘ï¥¾ï¼ˆeigenvectorsï¼‰:åœ¨ Octave ï§©æˆ‘ä»¬å¯ä»¥ï§ç”¨å¥‡å¼‚å€¼åˆ†è§£ï¼ˆsingular value decompositionï¼‰æ¥æ±‚è§£ï¼Œ[U, S, V]= svd(sigma) ã€‚ å¯¹äºä¸€ä¸ªn*n ç»´åº¦çš„çŸ©é˜µï¼Œä¸Šå¼ä¸­çš„Uæ˜¯ä¸€ä¸ªå…·æœ‰ä¸æ•°æ®ä¹‹é—´æœ€å°æŠ•å°„è¯¯å·®çš„æ–¹å‘å‘ï¥¾æ„æˆçš„çŸ©é˜µã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å°†æ•°æ®ä»nç»´é™è‡³kç»´ï¼Œæˆ‘ä»¬åªéœ€è¦ä»Uä¸­é€‰å–å‰kä¸ªå‘ï¥¾ï¼Œè·å¾—ä¸€ä¸ªç»´åº¦çš„n * kçŸ©é˜µï¼Œæˆ‘ä»¬ç”¨$U_{reduce}$è¡¨ç¤ºï¼Œç„¶åé€šè¿‡å¦‚ä¸‹è®¡ç®—è·å¾—è¦æ±‚çš„æ–°ç‰¹å¾å‘ï¥¾:$z ^ { ( i ) } : z ^ { ( i ) } = U _ {reduce} ^ { T } * x ^ { ( i ) }$ å…¶ä¸­xæ˜¯ n * 1 ç»´çš„ï¼Œ å› æ­¤ç»“æœä¸º K * 1 ç»´åº¦çš„ï¼› 6.é€‰æ‹©ä¸»æˆåˆ†çš„æ•°é‡ä¸»è¦æˆåˆ†åˆ†ææ˜¯å‡å°‘æŠ•å°„çš„å¹³å‡å‡æ–¹è¯¯å·®ï¼šè®­ç»ƒé›†(ç»è¿‡å‡å€¼å½’ä¸€åŒ–å¤„ç†å)çš„æ–¹å·®ä¸º: $\frac { 1 } { m } \sum _ { i = 1 } ^ { m } \left| x ^ { ( i ) } \right| ^ { 2 }$ æˆ‘ä»¬å¸Œæœ›åœ¨å¹³å‡å‡æ–¹è¯¯å·®ä¸è®­ç»ƒé›†æ–¹å·®çš„æ¯”ï¦µå°½å¯èƒ½å°çš„æƒ…å†µä¸‹é€‰æ‹©å°½å¯èƒ½å°çš„å€¼ã€‚ å¦‚æœæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªæ¯”ï¦µå°äº1%ï¼Œå°±æ„å‘³ç€åŸæœ¬æ•°æ®çš„åå·®æœ‰99%éƒ½ä¿ï§ä¸‹æ¥ï¦ºï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©ä¿ï§95%çš„åå·®ï¼Œï¥¥èƒ½éå¸¸æ˜¾è‘—åœ°é™ä½æ¨¡å‹ä¸­ç‰¹å¾çš„ç»´åº¦ï¦º, ä¸€èˆ¬è¿™ä¸ªå€¼æœ€å¥½ä¸è¦å°äº90%ï¼Œ å› ä¸ºé‚£æ ·æ•°æ®å¯èƒ½å°±åç¦»åŸæ•°æ®å¤ªå¤šäº†ã€‚ è¿›è¡Œä¸»æˆåˆ†é€‰æ‹©çš„æ­¥éª¤(ç¬¬ä¸€ç§æ–¹æ³•): æˆ‘ä»¬å¯ä»¥å…ˆä»¤k = 1ï¼Œç„¶åè¿›ï¨ˆä¸»è¦æˆåˆ†åˆ†æï¼Œè·å¾—$U_{reduce}$å’Œzï¼Œç„¶åè®¡ç®—æ¯”ï¦µæ˜¯å¦å°äº1%; å¦‚æœï¥§æ˜¯çš„è¯å†ä»¤k = K + 1ï¼Œå¦‚æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰¾åˆ°å¯ä»¥ä½¿å¾—æ¯”ï¦µå°äº1%çš„æœ€å° å€¼; è¿›è¡Œä¸»æˆåˆ†é€‰æ‹©çš„æ­¥éª¤(ç¬¬äºŒç§æ–¹æ³•): æˆ‘ä»¬å¯ä»¥å…ˆä»¤k = 1ï¼Œç„¶åè¿›ï¨ˆä¸»è¦æˆåˆ†åˆ†æï¼Œè·å¾—$U_{reduce}$ï¼Œ S , ç„¶åè®¡ç®—å¹³å‡å‡æ–¹è¯¯å·®ä¸è®­ç»ƒé›†çš„æ¯”ä¾‹ å¤‡æ³¨ï¼š Sæ˜¯ä¸€ä¸ªn * nçš„çŸ©é˜µï¼Œåªæœ‰å¯¹è§’çº¿ä¸Šæœ‰å€¼ï¼Œè€Œå…¶å®ƒå•å…ƒéƒ½æ˜¯0ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªçŸ©é˜µæ¥è®¡ç®—å¹³å‡å‡æ–¹è¯¯å·®ä¸è®­ç»ƒé›†æ–¹å·®çš„æ¯”ï¦µ è®¡ç®—å¹³å‡å‡æ–¹è¯¯å·®ä¸è®­ç»ƒé›†çš„æ¯”ä¾‹å…¬å¼: å¦‚æœæ¯”ä¾‹å¤§äº1%,å†ä»¤k = K + 1ï¼Œå¦‚æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰¾åˆ°å¯ä»¥ä½¿å¾—æ¯”ï¦µå°äº1%çš„æœ€å° å€¼; 7. é‡å»ºè¢«å‹ç¼©çš„æ•°æ®PCAä½œä¸ºå‹ç¼©ç®—æ³•ã€‚åœ¨é‚£ï§©ä½ å¯èƒ½éœ€è¦æŠŠ1000ç»´çš„æ•°æ®å‹ç¼©100ç»´ç‰¹å¾ï¼Œæˆ–å…·æœ‰ä¸‰ç»´æ•°æ®å‹ç¼©åˆ°ä¸€äºŒç»´è¡¨ç¤ºã€‚æ‰€ä»¥ï¼Œå¦‚æœè¿™æ˜¯ä¸€ä¸ªå‹ç¼©ç®—æ³•ï¼Œåº”è¯¥èƒ½å›åˆ°è¿™ä¸ªå‹ç¼©è¡¨ç¤ºï¼Œå›åˆ°ä½ åŸæœ‰çš„é«˜ç»´æ•°æ®çš„ä¸€ç§è¿‘ä¼¼ã€‚ æ‰€ä»¥ï¼Œ ç»™å®š$z^{(i)}$, å¯èƒ½æ˜¯100ç»´ï¼Œ æ€ä¹ˆå›åˆ°åŸæ¥çš„$x^{(i)}$, å¯èƒ½æ˜¯1000ç»´çš„æ•°æ®ï¼› PCAç®—æ³•ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰ä¸€ä¸ªè¿™æ ·çš„æ ·æœ¬ã€‚å¦‚å›¾ä¸­æ ·æœ¬ $x^{(1)}, x^{(2)}$, ã€‚æˆ‘ä»¬åšçš„æ˜¯ï¼Œæˆ‘ä»¬æŠŠè¿™äº›æ ·æœ¬æŠ•å°„åˆ°å›¾ä¸­è¿™ä¸ªä¸€ç»´å¹³é¢ã€‚ç„¶åç°åœ¨æˆ‘ä»¬éœ€è¦åªä½¿ç”¨ä¸€ä¸ªå®æ•°ï¼Œæ¯”å¦‚ $z^{(1)}$ï¼ŒæŒ‡å®šè¿™äº›ç‚¹çš„ä½ç½®åä»–ä»¬è¢«æŠ•å°„åˆ°è¿™ä¸€ä¸ªä¸‰ç»´æ›²é¢ã€‚ç»™å®šä¸€ä¸ªç‚¹$z^{(1)}$ï¼Œæˆ‘ä»¬æ€ä¹ˆèƒ½å›å»è¿™ä¸ªåŸå§‹çš„äºŒç»´ç©ºé—´å‘¢ï¼Ÿ ä¸º2ç»´ï¼Œzä¸º1ç»´ï¼Œ$z = U^T_{reduce}x$ ï¼Œç›¸åçš„æ–¹ç¨‹ä¸ºï¼š$x_{appoz } = U_{reduce} * z$, $x_{appox} \approx x$ ã€‚å¦‚å›¾ï¼š é€šè¿‡ä»¥ä¸Šçš„æ­¥éª¤å¾—åˆ°çš„æ•°æ®ä¸åŸå§‹æ•°æ®ç›¸å½“ç›¸ä¼¼ã€‚æ‰€ä»¥ï¼Œè¿™å°±æ˜¯ä½ ä»ä½ç»´è¡¨ç¤ºzå›åˆ°æœªå‹ç¼©çš„è¡¨ç¤ºã€‚æˆ‘ä»¬å¾—åˆ°çš„æ•°æ®å’ŒåŸå§‹æ•°æ®xéå¸¸è¿‘ä¼¼ ï¼Œæˆ‘ä»¬ä¹ŸæŠŠè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé‡å»ºåŸå§‹æ•°æ®ã€‚ä½†æ˜¯æ²¡æœ‰æ–¹æ³•å¯ä»¥å°†æ•°æ®ä»ä½ç»´ï¼Œæ²¡æœ‰åå·®çš„è¿˜åŸåˆ°é«˜çº¬ã€‚ 8.PCAä½¿ç”¨çš„æ€»ç»“ä½¿ç”¨PCAçš„æ•°æ®è¿›è¡Œå»ºæ¨¡çš„æ­¥éª¤: è¿ç”¨ä¸»è¦æˆåˆ†åˆ†æå°†æ•°æ®å‹ç¼©åˆ°Kä¸ªç‰¹å¾ ç„¶åå¯¹è®­ç»ƒé›†è¿›è¡Œè®­ç»ƒ åœ¨é¢„æµ‹æˆ–è€…äº¤å‰éªŒè¯æ—¶ï¼Œé‡‡ç”¨ä¹‹å‰å­¦ä¹ è€Œæ¥çš„$U_{reduce}$ï¼Œ å°†è¾“å…¥çš„ç‰¹å¾xè½¬æ¢æˆç‰¹å¾å‘é‡zï¼Œ ç„¶ååœ¨è¿›è¡Œé¢„æµ‹ï¼› ä¸è¦åœ¨ä¸€ä¸‹æƒ…å†µä½¿ç”¨PCA å°†å…¶ç”¨äºå‡å°‘è¿‡æ‹Ÿåˆï¼ˆå‡å°‘ï¦ºç‰¹å¾çš„æ•°ï¥¾ï¼‰ã€‚è¿™æ ·åšéå¸¸ï¥§å¥½ï¼Œï¥§å¦‚å°è¯•æ­£åˆ™åŒ–å¤„ï§¤ã€‚åŸå› åœ¨äºä¸»è¦æˆåˆ†åˆ†æåªæ˜¯è¿‘ä¼¼åœ°ä¸¢å¼ƒæ‰ä¸€äº›ç‰¹å¾ï¼Œå®ƒå¹¶ï¥§è€ƒè™‘ä»»ä½•ä¸ç»“æœå˜ï¥¾æœ‰å…³çš„ä¿¡æ¯ï¼Œå› æ­¤å¯èƒ½ä¼šä¸¢å¤±éå¸¸é‡è¦çš„ç‰¹å¾ã€‚ç„¶è€Œå½“æˆ‘ä»¬è¿›ï¨ˆæ­£åˆ™åŒ–å¤„ï§¤æ—¶ï¼Œä¼šè€ƒè™‘åˆ°ç»“æœå˜ï¥¾ï¼Œï¥§ä¼šä¸¢æ‰é‡è¦çš„æ•°æ®ã€‚ ä¸è€ƒè™‘ä¸ºä»€ä¹ˆä½¿ç”¨PCAï¼Œé»˜è®¤åœ°å°†ä¸»è¦æˆåˆ†åˆ†æä½œä¸ºå­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè¿™è™½ç„¶å¾ˆå¤šæ—¶å€™æœ‰æ•ˆæœï¼Œæœ€å¥½è¿˜æ˜¯ä»æ‰€æœ‰åŸå§‹ç‰¹å¾å¼€å§‹ï¼Œåªåœ¨æœ‰å¿…è¦çš„æ—¶å€™ï¼ˆç®—æ³•è¿ï¨ˆå¤ªæ…¢æˆ–è€…å ç”¨å¤ªå¤šå†…å­˜ï¼‰æ‰è€ƒè™‘é‡‡ç”¨ä¸»è¦æˆåˆ†åˆ†æã€‚ æ€»ç»“: PCAå¦‚æœä¸æ˜¯æƒ³åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼Œ å‡å°‘èµ„æºæ¶ˆè€—ï¼Œæ²¡å¿…è¦ä½¿ç”¨ï¼Œ å…¶åªå¯èƒ½é™ä½æ•°æ®ä¿¡æ¯é‡ï¼Œ æ›´è¦æ³¨æ„ï¼Œåƒä¸‡ä¸è¦ç”¨PCAæ¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼›å¦‚æœä½¿ç”¨ï¼Œ é€šè¿‡å¹³å‡å‡æ–¹è¯¯å·®ä¸è®­ç»ƒé›†çš„æ¯”ä¾‹æ¥ç¡®å®šç‰¹å¾æ•°é‡Kï¼›]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>éç›‘ç£å­¦ä¹ </tag>
        <tag>PCA</tag>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èšç±»é—®é¢˜]]></title>
    <url>%2F2018%2F12%2F06%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E8%81%9A%E7%B1%BB%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[1.éç›‘ç£å­¦ä¹ å’Œèšç±»ç®—æ³•ä»‹ç»åœ¨ç›‘ç£å­¦ä¹ ä¸­ï¼Œæ‰€æœ‰çš„è®­ç»ƒæ•°æ®ã€æµ‹è¯•æ•°æ®ã€éƒ½æœ‰ä¸€ç³»ï¦œæ ‡ç­¾ï¼Œæˆ‘ä»¬éœ€è¦æ®æ­¤æ‹Ÿåˆä¸€ä¸ªå‡è®¾å‡½æ•°ã€‚ä¸æ­¤ï¥§åŒçš„æ˜¯ï¼Œåœ¨éç›‘ç£å­¦ä¹ ä¸­ï¼Œæ•°æ®æ²¡æœ‰é™„å¸¦ä»»ä½•æ ‡ç­¾ï¼Œæ•°æ®åªæœ‰ä¸€äº›åˆ—çš„ç‰¹å¾ï¼Œè€Œæˆ‘ä»¬çš„è®­ç»ƒç›®æ ‡å°±æ˜¯é€šè¿‡ä¸åŒç‰¹å¾çš„è®­ç»ƒé›†ï¼Œå°†ä¸åŒçš„è®­ç»ƒé›†åˆ†ä¸ºKä¸ªç±»åˆ«ã€‚ å¦‚ä¸Šå›¾ï¼Œé€šè¿‡æ•°æ®ç‰¹å¾å¯ä»¥ç»˜åˆ¶å‡ºä¸€äº›åˆ—çš„ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰æ ‡ç­¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨éç›‘ç£å­¦ä¹ ä¸­ï¼Œéœ€è¦å°†ä¸€ç³»ï¦œæ— æ ‡ç­¾çš„è®­ç»ƒæ•°æ®ï¼Œè¾“å…¥åˆ°ä¸€ä¸ªç®—æ³•ä¸­ï¼Œç„¶åæˆ‘ä»¬å‘Šè¯‰è¿™ä¸ªç®—æ³•ï¼Œé€šè¿‡æˆ‘ä»¬ç»™å®šçš„æ•°æ®ï¼Œä¸ºæˆ‘ä»¬æ‰¾åˆ°è¿™ä¸ªæ•°æ®çš„å†…åœ¨ç»“æ„ã€‚å›¾ä¸Šçš„æ•°æ®çœ‹èµ·æ¥å¯ä»¥åˆ†æˆä¸¤ä¸ªåˆ†å¼€çš„ç‚¹é›†ï¼ˆç§°ä¸ºç°‡ï¼‰ï¼Œä¸€ä¸ªèƒ½å¤Ÿæ‰¾åˆ°ä¸Šé¢çš„ç‚¹é›†çš„å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªåˆ†ç±»çš„ç®—æ³•ï¼Œå°±è¢«ç§°ä¸ºèšç±»ç®—æ³•ï¼Œ æ¥ä¸‹æ¥å°±é€šè¿‡å­¦ä¹ èšç±»ç®—æ³•æ¥äº†è§£éç›‘ç£å­¦ä¹ ã€‚ èšç±»ç®—æ³•çš„ä¸€äº›åº”ç”¨: å¸‚åœºåˆ†å‰²ï¼šæ¯”å¦‚åœ¨æ•°æ®åº“ä¸­å­˜å‚¨ï¦ºè®¸å¤šå®¢æˆ·çš„ä¿¡æ¯ï¼Œå¸Œæœ›å°†ä»–ä»¬åˆ†æˆï¥§åŒçš„å®¢æˆ·ç¾¤ï¼Œè¿™æ ·ä½ å¯ä»¥å¯¹ï¥§åŒç±»å‹çš„å®¢æˆ·åˆ†åˆ«é”€å”®äº§å“æˆ–è€…åˆ†åˆ«æä¾›ï¤é€‚åˆçš„æœåŠ¡ã€‚ ç¤¾äº¤ç½‘ç»œåˆ†æï¼šå…³æ³¨ä¸ªäººçš„ç¤¾äº¤ä¿¡æ¯ï¼Œï¦µå¦‚Facebookï¼ŒGoogle+ï¼Œæˆ–è€…æ˜¯å…¶ä»–çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ï¼šç»å¸¸è·Ÿå“ªäº›äººè”ç³»ï¼Œè€Œè¿™äº›äººåˆç»å¸¸ç»™å“ªäº›äººå‘é‚®ä»¶ï¼Œç”±æ­¤æ‰¾åˆ°å…³ç³»å¯†åˆ‡çš„äººç¾¤ æ˜Ÿç³»åˆ†ç±»: é€šè¿‡èšç±»ç®—æ³•å°†ä¸åŒçš„è¡Œæ˜Ÿåˆ’åˆ†åˆ°å„ä¸ªæ˜Ÿç³» 2.K-meansç®—æ³•K-meansæ˜¯æœ€æ™®åŠçš„èšç±»ç®—æ³•ï¼Œç®—æ³•æ¥å—ä¸€ä¸ªæœªæ ‡è®°çš„æ•°æ®é›†ï¼Œç„¶åå°†æ•°æ®èšç±»æˆï¥§åŒçš„ç»„ã€‚K-meansä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£ç®—æ³•ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦å°†æ•°æ®èšç±»æˆnä¸ªç»„ï¼Œå…¶æ­¥éª¤ä¸º: é¦–å…ˆé€‰æ‹©Kä¸ªéšæœºçš„ç‚¹ï¼Œç§°ä¸ºèšç±»ä¸­å¿ƒï¼ˆcluster centroidsï¼‰ï¼› å¯¹äºæ•°æ®é›†ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®ï¼ŒæŒ‰ç…§è·ç¦»Kä¸ªä¸­å¿ƒç‚¹çš„è·ç¦» å°†å…¶ä¸è·ç¦»æœ€è¿‘çš„ä¸­å¿ƒç‚¹å…³è”èµ·æ¥ï¼Œä¸åŒä¸€ä¸ªä¸­å¿ƒç‚¹å…³è”çš„æ‰€æœ‰ç‚¹èšæˆä¸€ç±»ã€‚ è®¡ç®—æ¯ä¸€ä¸ªç»„çš„å¹³å‡å€¼ï¼Œå°†è¯¥ç»„æ‰€å…³è”çš„ä¸­å¿ƒç‚¹ç§»åŠ¨åˆ°å¹³å‡å€¼çš„ä½ç½®ã€‚ é‡å¤æ­¥éª¤2-4ç›´è‡³ä¸­å¿ƒç‚¹ï¥§å†å˜åŒ–ã€‚ ä¸€ä¸ªèšç±»è¿‡ç¨‹ç¤ºä¾‹ï¼š å‡å¦‚è¿›è¡Œäº†10æ¬¡è¿­ä»£ ç”¨$u^{(1)}, u^{(2)}, â€¦., u^{(k)}$æ¥è¡¨ç¤ºèšç±»ä¸­å¿ƒï¼Œç”¨$c^{(1)}, c^{(2)}, â€¦.., c^{(m)}$ æ¥å­˜å‚¨ä¸ç¬¬ i ä¸ªå®ï¦µæ•°æ®æœ€è¿‘çš„èšç±»ä¸­å¿ƒçš„ç´¢å¼•ï¼ŒK-å‡å€¼ç®—æ³•çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š 1234567891011Repeat &#123;for i = 1 to mc(i) := index (form 1 to K) of cluster centroid closest to x(i)for k = 1 to KÎ¼k := average (mean) of points assigned to cluster k&#125; ç®—æ³•æ­¥éª¤: å¯¹äºæ¯ä¸€ä¸ªæ ·ï¦µï¼Œè®¡ç®—å…¶åº”è¯¥å±äºçš„ç±»ã€‚ ç§»åŠ¨èšç±»ä¸­å¿ƒï¼Œå¯¹äºæ¯ä¸€ä¸ªç±»ï¼Œé‡æ–°è®¡ç®—è¯¥ç±»çš„ä¸­å¿ƒã€‚ K-å‡å€¼ç®—æ³•ä¹Ÿå¯ä»¥å¾ˆï¥¥ï§åœ°ç”¨äºå°†æ•°æ®åˆ†ä¸ºè®¸å¤šï¥§åŒç»„ï¼Œå³ä½¿åœ¨æ²¡æœ‰éå¸¸æ˜æ˜¾åŒºåˆ†çš„ç»„ç¾¤çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ã€‚ä¸‹å›¾æ‰€ç¤ºçš„æ•°æ®é›†åŒ…å«èº«é«˜å’Œä½“é‡ä¸¤é¡¹ç‰¹å¾æ„æˆçš„ï¼Œï§ç”¨K-å‡å€¼ç®—æ³•å°†æ•°æ®åˆ†ä¸ºä¸‰ç±»ï¼Œç”¨äºå¸®åŠ©ç¡®å®šå°†è¦ç”Ÿäº§çš„T-æ¤è¡«çš„ä¸‰ç§å°ºå¯¸ã€‚ 3. K-meansä¼˜åŒ–ç›®æ ‡K-å‡å€¼æœ€å°åŒ–é—®é¢˜ï¼Œæ˜¯è¦æœ€å°åŒ–æ‰€æœ‰çš„æ•°æ®ç‚¹ä¸å…¶æ‰€å…³è”çš„èšç±»ä¸­å¿ƒç‚¹ä¹‹é—´çš„è·ç¦»ä¹‹å’Œ K-å‡å€¼çš„ä»£ä»·å‡½æ•°ï¼ˆåˆç§°ç•¸å˜å‡½æ•° Distortion functionï¼‰çš„å…¬å¼ä¸ºï¼š $J \left( c ^ { ( 1 ) } , \ldots , c ^ { ( m ) } , \mu _ { 1 } , \ldots , \mu _ { K } \right) = \frac { 1 } { m } \sum _ { i = 1 } ^ { m } \left| X ^ { ( i ) } - \mu _ { c ^ { ( i ) } } \right| ^ { 2 }$ å…¶ä¸­ï¼Œ$u_{c^{(i)}}$ä»£è¡¨è·ç¦»$x^{(i)}$æœ€è¿‘çš„èšç±»ä¸­å¿ƒï¼Œ æˆ‘ä»¬çš„çš„ä¼˜åŒ–ç›®æ ‡ï¥¥æ˜¯æ‰¾å‡ºä½¿å¾—ä»£ä»·å‡½æ•°æœ€å°çš„$c^{(1)}, c^{(2)}, â€¦,c^{(m)}$ å’Œ $u_1, u_2, â€¦,u_k$, å…¶ä¼˜åŒ–ç›®æ ‡çš„å…¬å¼ä¸ºï¼š ${\min \over { c ^ { ( 1 ) } , \ldots , c ^ { ( m ) } \atop \mu _ { 1 } , \ldots , \mu _ { K } }} J \left( c ^ { ( 1 ) } , \ldots , c ^ { ( m ) } , \mu _ { 1 } , \ldots , \mu _ { K } \right)$ é€šè¿‡å¯¹ä»£ä»·å‡½æ•°çš„æ„å»ºï¼Œå¯ä»¥å°†K-meansæ¯æ¬¡è¿­ä»£çš„ä¸¤æ¬¡å¾ªç¯çš„ç›®çš„åšä¸€ä¸ªå½’çº³: ç¬¬ä¸€ä¸ªå¾ªç¯æ˜¯é‡æ–°å°†æ ·æœ¬åˆ’åˆ†åˆ°è·ç¦»æœ€è¿‘çš„èšç±»ä¸­å¿ƒç‚¹ï¼Œæ˜¯ç”¨äºå‡å°$c^{(i)}$å¼•èµ·çš„ä»£ä»·ï¼› ç¬¬äºŒä¸ªå¾ªç¯ æ˜¯é‡æ–°è°ƒæ•´ä¸­å¿ƒç‚¹ï¼Œä½¿å…¶ä½äºè¯¥åˆ†ç±»çš„ä¸­å¿ƒï¼Œ æ˜¯ç”¨äºå‡å°$u_{c^{(i)}}$å¼•èµ·çš„ä»£ä»· 4. éšæœºåˆå§‹åŒ–èšç±»ä¸­å¿ƒè¿ï¨ˆK-meansç®—æ³•ï¼Œé¦–å…ˆè¦éšæœºåˆå§‹åŒ–æ‰€æœ‰çš„èšç±»ä¸­å¿ƒç‚¹ï¼Œé€šå¸¸é‡‡ç”¨çš„æ–¹å¼æ˜¯ï¼š ç¡®å®šèšç±»ä¸­å¿ƒä¸ªæ•° Kï¼Œæ³¨æ„èšç±»ä¸­å¿ƒç‚¹çš„ä¸ªæ•° K è¦å°äºæ‰€æœ‰è®­ç»ƒé›†å®ï¦µçš„æ•°ï¥¾, å³: K &lt; mï¼› éšæœºé€‰æ‹© Kä¸ªè®­ç»ƒå®ï¦µï¼Œç„¶åä»¤ä¸ªèšç±»ä¸­å¿ƒåˆ†åˆ«ä¸è¿™ K ä¸ªè®­ç»ƒå®ï¦µç›¸ç­‰; K-meansç®—æ³•æœ‰ä¸€ä¸ªå¸¸è§çš„é—®é¢˜ï¼Œå³å®ƒæœ‰å¯èƒ½ä¼šåœï§åœ¨ä¸€ä¸ªå±€éƒ¨æœ€å°å€¼å¤„ï¼Œè€Œè¿™å–å†³äºåˆå§‹åŒ–çš„æƒ…å†µï¼Œ å¦‚ä¸‹å›¾: ç”±äºèšç±»ä¸­å¿ƒåˆå§‹åŒ–çš„è·ç¦»è¿‡è¿‘ï¼Œå¯¼è‡´æœ€ç»ˆåªèƒ½è·å¾—å±€éƒ¨çš„æœ€ä¼˜è§£ï¼Œè¿™æ ·å¾€å¾€ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„åˆ†ç±»ç»“æœã€‚ å¦‚æœæƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸éœ€è¦å¤šæ¬¡è¿ï¨ˆK-meansç®—æ³•ï¼Œæ¯ä¸€æ¬¡éƒ½é‡æ–°è¿›ï¨ˆéšæœºåˆå§‹åŒ–ï¼Œæœ€åå†æ¯”è¾ƒå¤šæ¬¡è¿ï¨ˆK-meansçš„ç»“æœï¼Œé€‰æ‹©ä»£ä»·å‡½æ•°æœ€å°çš„ç»“æœã€‚è¿™ç§æ–¹æ³•åœ¨ K è¾ƒå°çš„æ—¶å€™ï¼ˆ2â€“10ï¼‰è¿˜æ˜¯å¯ï¨ˆçš„ï¼Œä½†æ˜¯å¦‚æœ K è¾ƒå¤§ï¼Œè¿™ä¹ˆåšä¹Ÿå¯èƒ½ï¥§ä¼šæœ‰æ˜æ˜¾åœ°æ”¹å–„, ä½†æ˜¯é€šå¸¸Kæ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œå±€éƒ¨æœ€ä¼˜è§£å·²ç»å¯ä»¥å¾ˆæ¥è¿‘æœ€ä¼˜è§£ã€‚ 7.äºŒåˆ†K-meansç®—æ³•äºŒåˆ†k-meansç®—æ³•ä»‹ç»åŸºäºkmeansç®—æ³•å®¹æ˜“ä½¿å¾—ç»“æœä¸ºå±€éƒ¨æœ€å°å€¼è€Œéå…¨å±€æœ€å°å€¼è¿™ä¸€ç¼ºé™·ï¼Œå¯¹ç®—æ³•åŠ ä»¥æ”¹è¿›ã€‚ä½¿ç”¨ä¸€ç§ç”¨äºåº¦é‡èšç±»æ•ˆæœçš„æŒ‡æ ‡SSE(Sum of Squared Error)ï¼Œå³å¯¹äºç¬¬ i ä¸ªç°‡ï¼Œå…¶SSEä¸ºå„ä¸ªæ ·æœ¬ç‚¹åˆ°â€œç°‡ä¸­å¿ƒâ€ç‚¹çš„è·ç¦»çš„å¹³æ–¹çš„å’Œï¼ŒSSEå€¼è¶Šå°è¡¨ç¤ºæ•°æ®ç‚¹è¶Šæ¥è¿‘äºå®ƒä»¬çš„â€œç°‡ä¸­å¿ƒâ€ç‚¹ï¼Œèšç±»æ•ˆæœä¹Ÿå°±è¶Šå¥½ã€‚ä»¥æ­¤ä½œä¸ºåˆ’åˆ†ç°‡çš„æ ‡å‡†ã€‚ ç®—æ³•æ€æƒ³æ˜¯ï¼šå…ˆå°†æ•´ä¸ªæ ·æœ¬é›†ä½œä¸ºä¸€ä¸ªç°‡ï¼Œè¯¥â€œç°‡ä¸­å¿ƒâ€ç‚¹å‘é‡ä¸ºæ‰€æœ‰æ ·æœ¬ç‚¹çš„å‡å€¼ï¼Œè®¡ç®—æ­¤æ—¶çš„SSEã€‚è‹¥æ­¤æ—¶ç°‡ä¸ªæ•°å°äº kï¼Œå¯¹æ¯ä¸€ä¸ªç°‡è¿›è¡Œkmeansèšç±»(k=2) ï¼Œè®¡ç®—å°†æ¯ä¸€ä¸ªç°‡ä¸€åˆ†ä¸ºäºŒåçš„æ€»è¯¯å·®SSEï¼Œé€‰æ‹©SSEæœ€å°çš„é‚£ä¸ªç°‡è¿›è¡Œåˆ’åˆ†æ“ä½œã€‚ ç®—æ³•è®¡ç®—è¿‡ç¨‹è¾“å…¥ï¼šè®­ç»ƒæ•°æ®é›† D=x(1),x(2),â€¦,x(m) ,èšç±»ç°‡æ•° k ;è¿‡ç¨‹ï¼šå‡½æ•° kMeans(D,k,maxIter) . 1ï¼šå°†æ‰€æœ‰ç‚¹çœ‹åšä¸€ä¸ªç°‡ï¼Œè®¡ç®—æ­¤æ—¶â€œç°‡ä¸­å¿ƒâ€å‘é‡ï¼š$\mu ^ { ( 1 ) } = \frac { 1 } { m } \sum _ { x \in D } xâ€‹$ 2ï¼šwhile â€œç°‡ä¸­å¿ƒâ€ä¸ªæ•°h&lt;kâ€œï¼š 3ï¼š for i=1,2,â€¦,h do 4ï¼š å°†ç¬¬ i ä¸ªç°‡ä½¿ç”¨ kmeansç®—æ³•è¿›è¡Œåˆ’åˆ†ï¼Œå…¶ä¸­ k=2 5ï¼š è®¡ç®—åˆ’åˆ†åçš„è¯¯å·®å¹³æ–¹å’Œ SSEi 5ï¼š æ¯”è¾ƒ k ç§åˆ’åˆ†çš„SSEå€¼ï¼Œé€‰æ‹©SSEå€¼æœ€å°çš„é‚£ç§ç°‡åˆ’åˆ†è¿›è¡Œåˆ’åˆ† 5ï¼š æ›´æ–°ç°‡çš„åˆ†é…ç»“æœ 5ï¼š æ·»åŠ æ–°çš„â€œç°‡ä¸­å¿ƒâ€ 18ï¼šuntil å½“å‰â€œç°‡ä¸­å¿ƒâ€ä¸ªæ•°è¾¾åˆ° k è¾“å‡ºï¼šç°‡åˆ’åˆ† C=C1,C2,â€¦,CK 6.é€‰å–èšç±»æ•°é‡èšç±»é€‰æ‹©çš„é€šå¸¸åšæ³•é€šå¸¸æ²¡æœ‰å…·ä½“çš„èšç±»æ•°é‡é€‰æ‹©çš„æ–¹æ³•ï¼Œæœ€æ™®éçš„æ–¹æ³•å°±æ˜¯æ ¹æ®ä¸åŒçš„é—®é¢˜å’Œä¸åŒçš„éœ€æ±‚ï¼Œäººå·¥è¿›è¡Œé€‰æ‹©ã€‚ é€šå¸¸æˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œè¿›è¡Œèšç±»æ•°é‡é€‰æ‹©çš„æ—¶å€™éœ€è¦æ€è€ƒæˆ‘ä»¬è¿ç”¨K-meansç®—æ³•èšç±»çš„åŠ¨æœºæ˜¯ï§½ä¹ˆï¼Œç„¶åé€‰æ‹©èƒ½æœ€å¥½æœåŠ¡äºè¯¥ç›®çš„æ ‡èšç±»æ•°ã€‚ è‚˜éƒ¨æ³•åˆ™å½“äººä»¬åœ¨è®¨è®ºï¼Œé€‰æ‹©èšç±»æ•°ç›®çš„æ–¹æ³•æ—¶ï¼Œæœ‰ä¸€ä¸ªå¯èƒ½ä¼šè°ˆåŠçš„æ–¹æ³•å«ä½œâ€œè‚˜éƒ¨æ³•åˆ™â€ã€‚å…³äºâ€œè‚˜éƒ¨æ³•åˆ™â€ï¼Œæˆ‘ä»¬æ‰€éœ€è¦åšçš„æ˜¯æ”¹å˜ K å€¼ï¼Œä¹Ÿå°±æ˜¯èšç±»ç±»åˆ«æ•°ç›®çš„æ€»æ•°ã€‚æˆ‘ä»¬ç”¨ K ä¸ªèšç±»æ¥è¿ï¨ˆK-meansèšç±»æ–¹æ³•ã€‚è¿™å°±æ„å‘³ç€ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½ä¼šåˆ†åˆ° K ä¸ªèšç±»ï§©ï¼Œç„¶åè®¡ç®—æˆæœ¬å‡½æ•° J æˆ–è€…è®¡ç®—ç•¸å˜å‡½æ•°ã€‚K ä»£è¡¨èšç±»æ•°å­—ã€‚ ç»è¿‡èšç±»è¿ç®—ï¼Œå¯èƒ½ä¼šå¾—åˆ°ä¸€æ¡ç±»ä¼¼äºå·¦è¾¹è¿™æ ·çš„æ›²çº¿ã€‚åƒä¸€ä¸ªäººçš„è‚˜éƒ¨ã€‚è¿™å°±æ˜¯â€œè‚˜éƒ¨æ³•åˆ™â€æ‰€åšçš„ï¼Œè®©æˆ‘ä»¬æ¥çœ‹è¿™æ ·ä¸€ä¸ªå›¾ï¼Œçœ‹èµ·æ¥å°±å¥½åƒæœ‰ä¸€ä¸ªå¾ˆæ¸…æ¥šçš„è‚˜åœ¨é‚£å„¿ã€‚å¥½åƒäººçš„æ‰‹è‡‚ï¼Œå¦‚æœä½ ä¼¸å‡ºä½ çš„èƒ³è†Šï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä½ çš„è‚©å…³èŠ‚ã€è‚˜å…³èŠ‚ã€æ‰‹ã€‚è¿™å°±æ˜¯â€œè‚˜éƒ¨æ³•åˆ™â€ã€‚ ä½ ä¼šå‘ç°è¿™ç§æ¨¡å¼ï¼Œå®ƒçš„ç•¸å˜å€¼ä¼šè¿…é€Ÿä¸‹é™ï¼Œä»1åˆ°2ï¼Œä»2åˆ°3ä¹‹åï¼Œä½ ä¼šåœ¨3çš„æ—¶å€™è¾¾åˆ°ä¸€ä¸ªè‚˜ç‚¹ã€‚åœ¨æ­¤ä¹‹åï¼Œç•¸å˜å€¼å°±ä¸‹é™çš„éå¸¸æ…¢ï¼Œçœ‹èµ·æ¥å°±åƒä½¿ç”¨3ä¸ªèšç±»æ¥è¿›ï¨ˆèšç±»æ˜¯æ­£ç¡®çš„ï¼Œè¿™æ˜¯å› ä¸ºé‚£ä¸ªç‚¹æ˜¯æ›²çº¿çš„è‚˜ç‚¹ï¼Œç•¸å˜å€¼ä¸‹é™å¾—å¾ˆå¿«ï¼Œ K = 3ä¹‹åå°±ä¸‹é™å¾—å¾ˆæ…¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±é€‰ K= 3ã€‚å½“ä½ åº”ç”¨â€œè‚˜éƒ¨æ³•åˆ™â€çš„æ—¶å€™ï¼Œå¦‚æœä½ å¾—åˆ°ï¦ºä¸€ä¸ªåƒä¸Šé¢è¿™æ ·çš„å›¾ï¼Œé‚£ä¹ˆè¿™å°†æ˜¯ä¸€ç§ç”¨æ¥é€‰æ‹©èšç±»ä¸ªæ•°çš„åˆï§¤æ–¹æ³•ã€‚ æ€»ç»“: é€‰æ‹©èšç±»æ•°é‡æœ€å¥½æ˜¯æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå’Œåœºæ™¯æ¥ç¡®å®šæˆ‘ä»¬æ˜¯éœ€è¦å¤šå°‘ç§èšç±»ï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½æ ¹æ®ä½¿ç”¨åœºæ™¯å’Œéœ€æ±‚ç¡®å®šä¸‹æ¥èšç±»çš„æ•°é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è‚˜éƒ¨æ³•åˆ™ï¼Œæ¥é€‰æ‹©ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„èšç±»æ•°é‡ã€‚ pyhtonå®ç°12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273# coding:utf-8import numpy as npdef distEclud(vecA, vecB): # è®¡ç®—æ¬§å¼è·ç¦» return np.sqrt(np.sum(np.power(vecA - vecB, 2))) # la.norm(vecA-vecB)def randCent(dataSet, k): # åˆå§‹åŒ–kä¸ªéšæœºç°‡å¿ƒ n = np.array(dataSet).shape[1] # ç‰¹å¾ä¸ªæ•° centroids = np.mat(np.zeros((k, n))) # ç°‡å¿ƒçŸ©é˜µk*n for j in range(n): # ç‰¹å¾é€ä¸ªé€ä¸ªåœ°åˆ†é…ç»™è¿™kä¸ªç°‡å¿ƒã€‚æ¯ä¸ªç‰¹å¾çš„å–å€¼éœ€è¦è®¾ç½®åœ¨æ•°æ®é›†çš„èŒƒå›´å†… minJ = min(dataSet[:, j]) # æ•°æ®é›†ä¸­è¯¥ç‰¹å¾çš„æœ€å°å€¼ rangeJ = float(max(dataSet[:, j]) - minJ) # æ•°æ®é›†ä¸­è¯¥ç‰¹å¾çš„è·¨åº¦ centroids[:, j] = np.mat(minJ + rangeJ * np.random.rand(k, 1)) # ä¸ºkä¸ªç°‡å¿ƒåˆ†é…ç¬¬jä¸ªç‰¹å¾ï¼ŒèŒƒå›´éœ€é™å®šåœ¨æ•°æ®é›†å†…ã€‚ return centroids # è¿”å›kä¸ªç°‡å¿ƒdef kMeans(dataSet, k, distMeas=distEclud, createCent=randCent): """éšæœºåˆå§‹åŒ–k-means""" m = np.array(dataSet).shape[0] # æ•°æ®ä¸ªæ•° clusterAssment = np.mat(np.zeros((m, 2))) # è®°å½•æ¯ä¸ªæ•°æ®ç‚¹è¢«åˆ†é…åˆ°çš„ç°‡ï¼Œä»¥åŠåˆ°ç°‡å¿ƒçš„è·ç¦» centroids = createCent(dataSet, k) # åˆå§‹åŒ–kä¸ªéšæœºç°‡å¿ƒ clusterChanged = True # è®°å½•ä¸€è½®ä¸­æ˜¯å¦æœ‰æ•°æ®ç‚¹çš„å½’å±å‡ºç°å˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç®—æ³•ç»“æŸ while clusterChanged: clusterChanged = False for i in range(m): # æšä¸¾æ¯ä¸ªæ•°æ®ç‚¹ï¼Œé‡æ–°åˆ†é…å…¶ç°‡å½’å± minDist = np.inf # å…ˆå‡è®¾è·ç¦»ç°‡å¿ƒçš„è·ç¦»ä¸ºæ— ç©·å¤§ï¼Œåˆ™å…ˆéšæœºåˆ†é…ä¸€ä¸ªç°‡å¿ƒç»™æ•°æ®ç‚¹ minIndex = -1 # è®°å½•æœ€è¿‘ç°‡å¿ƒåŠå…¶è·ç¦» for j in range(k): # æšä¸¾æ¯ä¸ªç°‡å¿ƒ distJI = distMeas(centroids[j, :], dataSet[i, :]) # è®¡ç®—æ•°æ®ç‚¹ä¸ç°‡å¿ƒçš„è·ç¦» if distJI &lt; minDist: # æ›´æ–°æœ€è¿‘ç°‡å¿ƒ minDist = distJI minIndex = j if clusterAssment[i, 0] != minIndex: clusterChanged = True # æ›´æ–°â€œå˜åŒ–â€è®°å½• clusterAssment[i, :] = minIndex, minDist ** 2 # æ›´æ–°æ•°æ®ç‚¹çš„ç°‡å½’å± print(centroids) for cent in range(k): # æšä¸¾æ¯ä¸ªç°‡å¿ƒï¼Œæ›´æ–°å…¶ä½ç½® ptsInClust = dataSet[np.nonzero(clusterAssment[:, 0].A == cent)[0]] # å¾—åˆ°è¯¥ç°‡æ‰€æœ‰çš„æ•°æ®ç‚¹ centroids[cent, :] = np.mean(ptsInClust, axis=0) # å°†æ•°æ®ç‚¹çš„å‡å€¼ä½œä¸ºç°‡å¿ƒçš„ä½ç½® return centroids, clusterAssment # è¿”å›ç°‡å¿ƒåŠæ¯ä¸ªæ•°æ®ç‚¹çš„ç°‡å½’å±def biKmeans(dataSet, k, distMeas=distEclud): """éšæœºåˆå§‹åŒ–äºŒå€¼åŒ–k-means""" m = np.array(dataSet).shape[0] centroid0 = np.mean(dataSet, axis=0).tolist()[0] # åˆ›å»ºåˆå§‹ç°‡å¿ƒï¼Œæ ‡å·ä¸º0 centList = [centroid0] # åˆ›å»ºç°‡å¿ƒåˆ—è¡¨ clusterAssment = np.array(np.zeros((m, 2))) # åˆå§‹åŒ–æ‰€æœ‰æ•°æ®ç‚¹çš„ç°‡å½’å±(ä¸º0) for j in range(m): # è®¡ç®—æ‰€æœ‰æ•°æ®ç‚¹ä¸ç°‡å¿ƒ0çš„è·ç¦» clusterAssment[j, 1] = distMeas(np.array(centroid0), dataSet[j, :]) ** 2 while len(centList) &lt; k: # åˆ†è£‚k-1æ¬¡ï¼Œå½¢æˆkä¸ªç°‡ lowestSSE = np.inf # åˆå§‹åŒ–æœ€å°sseä¸ºæ— é™å¤§ for i in range(len(centList)): # æšä¸¾å·²æœ‰çš„ç°‡ï¼Œå°è¯•å°†å…¶ä¸€åˆ†ä¸ºäºŒ ptsInCurrCluster = dataSet[np.nonzero(clusterAssment[:, 0].A == i)[0], :] # å°†è¯¥ç°‡çš„æ•°æ®ç‚¹æå–å‡ºæ¥ centroidMat, splitClustAss = kMeans(ptsInCurrCluster, 2, distMeas) # åˆ©ç”¨æ™®é€škå‡å€¼å°†å…¶ä¸€åˆ†ä¸ºäºŒ sseSplit = np.sum(splitClustAss[:, 1]) # è®¡ç®—åˆ’åˆ†åè¯¥ç°‡çš„SSE sseNotSplit = np.sum(clusterAssment[np.nonzero(clusterAssment[:, 0].A != i)[0], 1]) # è®¡ç®—è¯¥ç°‡ä¹‹å¤–çš„æ•°æ®ç‚¹çš„SSE print("sseSplit, and notSplit: ", sseSplit, sseNotSplit) if (sseSplit + sseNotSplit) &lt; lowestSSE: # æ›´æ–°æœ€å°æ€»SSEä¸‹çš„åˆ’åˆ†ç°‡åŠç›¸å…³ä¿¡æ¯ bestCentToSplit = i # è¢«åˆ’åˆ†çš„ç°‡ bestNewCents = centroidMat # åˆ’åˆ†åçš„ä¸¤ä¸ªç°‡å¿ƒ bestClustAss = splitClustAss.copy() # åˆ’åˆ†åç°‡å†…æ•°æ®ç‚¹çš„å½’å±åŠåˆ°æ–°ç°‡å¿ƒçš„è·ç¦» lowestSSE = sseSplit + sseNotSplit # æ›´æ–°æœ€å°æ€»SSE print('the bestCentToSplit is: ', bestCentToSplit) print('the len of bestClustAss is: ', len(bestClustAss)) centList[bestCentToSplit] = bestNewCents[0, :].tolist()[0] # ä¸€ä¸ªæ–°ç°‡å¿ƒçš„æ ‡å·ä¸ºæ—§ç°‡å¿ƒçš„æ ‡å·ï¼Œæ‰€ä»¥å°†å…¶å–ä»£å°±ç°‡å¿ƒçš„ä½ç½® centList.append(bestNewCents[1, :].tolist()[0]) # å¦ä¸€ä¸ªæ–°ç°‡å¿ƒåŠ å…¥åˆ°ç°‡å¿ƒåˆ—è¡¨çš„å°¾éƒ¨ï¼Œæ ‡å·é‡æ–°èµ· bestClustAss[np.nonzero(bestClustAss[:, 0].A == 1)[0], 0] = len(centList) # æ›´æ–°æ—§ç°‡å†…æ•°æ®ç‚¹çš„æ ‡å· bestClustAss[np.nonzero(bestClustAss[:, 0].A == 0)[0], 0] = bestCentToSplit # åŒä¸Š clusterAssment[np.nonzero(clusterAssment[:, 0].A == bestCentToSplit)[0], :] = bestClustAss # å°†æ›´æ–°çš„ç°‡å½’å±ç»Ÿè®¡åˆ°æ€»æ•°æ®ä¸Š return np.mat(centList), clusterAssment]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>éç›‘ç£å­¦ä¹ </tag>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>èšç±»</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®å¤„ç† ç‰¹å¾å·¥ç¨‹]]></title>
    <url>%2F2018%2F12%2F01%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%2F</url>
    <content type="text"><![CDATA[0.æ•°æ®å¤„ç†çš„ä¸€èˆ¬æµç¨‹æ•°æ®è·å– â€“&gt; æ•°æ®åˆ’åˆ† â€“&gt; æ•°æ®å¤„ç† â€“&gt; æ•ˆæœè¯„åˆ¤ 1.æ•°æ®è·å–æ•°æ®æ¥æº ä¼ä¸šæ—¥ç›Šç§¯ç´¯çš„å¤§é‡æ•°æ®ï¼ˆäº’è”ç½‘å…¬å¸æ›´ä¸ºæ˜¾è‘—ï¼‰ æ”¿åºœæŒæ¡çš„å„ç§æ•°æ® ç§‘ç ”æœºæ„çš„å®éªŒæ•°æ® æ•°æ®ç±»å‹ ç¦»æ•£å‹æ•°æ® ç”±è®°å½•ä¸åŒç±»åˆ«ä¸ªä½“çš„æ•°ç›®æ‰€å¾—åˆ°çš„æ•°æ®ï¼Œåˆç§°è®¡æ•°æ•°æ®ï¼Œæ‰€æœ‰è¿™äº›æ•°æ®å…¨éƒ¨éƒ½æ˜¯æ•´æ•°ï¼Œè€Œä¸”ä¸èƒ½å†ç»†åˆ†ï¼Œä¹Ÿä¸èƒ½è¿›ä¸€æ­¥æé«˜ä»–ä»¬çš„ç²¾ç¡®åº¦ã€‚ è¿ç»­æ€§æ•°æ® å˜é‡å¯ä»¥åœ¨æŸä¸ªèŒƒå›´å†…å–ä»»ä¸€æ•°ï¼Œå³å˜é‡çš„å–å€¼å¯ä»¥æ˜¯è¿ç»­çš„ï¼Œå¦‚ï¼Œé•¿åº¦ã€æ—¶é—´ã€è´¨é‡å€¼ç­‰ï¼Œè¿™ç±»æ•´æ•°é€šå¸¸æ˜¯éæ•´æ•°ï¼Œå«æœ‰å°æ•°éƒ¨åˆ†ã€‚ é€šè¿‡sk-learnè·å–æ•°æ® sklearnæ•°æ®é›†è·å–API sklearn.datasets å°è§„æ¨¡æ•°æ®é›†çš„è·å– datasets.load_*() è·å–å°è§„æ¨¡çš„æ•°æ®é›†ï¼Œ æ•°æ®é›†å·²ç»åŒ…å«åœ¨äº†datasetsé‡Œ å‚æ•°subset: train è¡¨ç¤ºè·å–è®­ç»ƒè¡—, test è¡¨ç¤ºè·å–æµ‹è¯•é›†, all è¡¨ç¤ºä¸¤è€…å…¨éƒ¨ å¤§è§„æ¨¡æ•°æ®çš„è·å–ä¸åˆ é™¤ datasets.fetch_*(data_home=None) ä»ç½‘ç»œä¸Šä»¥ä¸‹è½½çš„æ–¹å¼è·å–å¤§è§„æ¨¡çš„æ•°æ®é›† data_homï¼šè¡¨ç¤ºæ•°æ®é›†ä¸‹è½½çš„ç›®å½•,é»˜è®¤æ˜¯ ~/scikit_learn_data/ subset: train è¡¨ç¤ºè·å–è®­ç»ƒè¡—, test è¡¨ç¤ºè·å–æµ‹è¯•é›†, all è¡¨ç¤ºä¸¤è€…å…¨éƒ¨ datasets.clear_data_home(data_home=None) æ¸…é™¤ç›®å½•ä¸‹çš„æ•°æ®é›† apiæ¥å£è¿”å›å€¼ï¼ˆdatasets.base.Bunch å®ä¾‹ï¼‰çš„å±æ€§ dataï¼šç‰¹å¾æ•°æ®æ•°ç»„ï¼Œæ˜¯ [n_samples * n_features] çš„äºŒç»´numpy.ndarray æ•°ç»„ targetï¼šç›®æ ‡å€¼æ•°ç»„ï¼Œæ˜¯ n_samples çš„ä¸€ç»´ numpy.ndarray æ•°ç»„ feature_namesï¼šç‰¹å¾å,æ–°é—»æ•°æ®ï¼Œæ‰‹å†™æ•°å­—ã€å›å½’æ•°æ®é›†æ²¡æœ‰ target_namesï¼šç›®æ ‡æ•°æ®åç§° DESCRï¼šæ•°æ®æè¿° 2.æ•°æ®é›†çš„åˆ’åˆ†æ•°æ®é›†å¸¸è§åˆ’åˆ†å½¢å¼ è®­ç»ƒæ•°æ®ï¼šç”¨äºè®­ç»ƒï¼Œæ„å»ºæ¨¡å‹ æµ‹è¯•æ•°æ®ï¼šåœ¨æ¨¡å‹æ£€éªŒæ—¶ä½¿ç”¨ï¼Œç”¨äºè¯„ä¼°æ¨¡å‹æ˜¯å¦æœ‰æ•ˆ æ•°æ®åˆ’åˆ†çš„åŸåˆ™ å°†æ•°æ®é›†åˆ’åˆ†ä¸ºä¸¤ä¸ªäº’æ–¥çš„é›†åˆï¼Œå…¶ä¸­ä¸€ä¸ªé›†åˆä½œä¸ºè®­ç»ƒé›†ï¼Œç•™ä¸‹çš„é›†åˆä½œä¸ºæµ‹è¯•é›† åˆ’åˆ†è¦å°½å¯èƒ½çš„ä¿æŒæ•°æ®åˆ†å¸ƒçš„ä¸€è‡´æ€§(ä¸­çš„æ•°æ®åˆ†å¸ƒè·Ÿæ˜¯ä¸€æ ·çš„)ï¼Œæ‰èƒ½é¿å…å› æ•°æ®åˆ’åˆ†è¿‡ç¨‹å¼•å…¥é¢å¤–çš„åå·®è€Œå¯¹æœ€ç»ˆç»“æœäº§ç”Ÿå½±å“ ä¸åŒçš„åˆ’åˆ†å°†å¯¼è‡´ä¸åŒçš„è®­ç»ƒ/æµ‹è¯•é›†ï¼Œç›¸åº”çš„æ¨¡å‹è¯„ä¼°ä¹Ÿæ˜¯æœ‰å·®åˆ«çš„ï¼Œè‹¥å¹²æ¬¡éšæœºåˆ’åˆ†ã€é‡å¤è¿›è¡Œå®éªŒè¯„ä¼°åå–å¹³å‡å€¼ä½œä¸ºç•™å‡ºæ³•çš„è¯„ä¼°ç»“æœ sklearnæ•°æ®é›†åˆ’åˆ†æ–¹æ³• sklearn.model_selection.train_test_split(x, y, **options) x æ•°æ®é›†çš„ç‰¹å¾å€¼ y æ•°æ®é›†çš„æ ‡ç­¾å€¼ test_size æµ‹è¯•é›†å ç”¨æ¯”ä¾‹çš„å¤§å°, ä¸€èˆ¬æ˜¯0.8 random_state å½“è®¾ç½®è¯¥å€¼ä¸ºä»»æ„å€¼æ—¶, è¿”å›çš„åˆ’åˆ†ç»“æœç›¸åŒ return (è®­ç»ƒé›†ç‰¹å¾å€¼ï¼Œæµ‹è¯•é›†ç‰¹å¾å€¼ï¼Œè®­ç»ƒæ ‡ç­¾ï¼Œæµ‹è¯•æ ‡ç­¾) 3.æ•°æ®å¤„ç†å’Œç‰¹å¾å·¥ç¨‹ç‰¹å¾æŠ½è±¡&amp;ç‰¹å¾è¡ç”Ÿç‰¹å¾æŠ½è±¡çš„ä½œç”¨å°†è®¡ç®—æœºä¸å¥½ç†è§£çš„æ•°æ®è½¬åŒ–ä¸ºè®¡ç®—æœºå‹å¥½çš„æ•°æ®å½¢å¼æ¥ä½“ç° ä¸¾ä¾‹ ç‰¹å¾è¡ç”Ÿçš„ä½œç”¨å°†ä¸€äº›æ•°æ®ä¹‹é—´æ‰€ä½“ç°çš„è§„å¾‹å’Œç‰¹å¾ä½“ç°å‡ºæ¥ ä¸¾ä¾‹è¿ç»­å˜é‡ ç¦»æ•£å˜é‡ ç‰¹å¾æŠ½å–æ•°æ®æŠ½å–çš„ä½œç”¨ è®©è®¡ç®—æœºå’Œæ¨¡å‹æ›´å¥½çš„ç†è§£æ•°æ®çš„ç»“æ„ï¼Œå¯å°†æ•°æ®å¤„ç†æˆè®¡ç®—æœºæ¯”è¾ƒå‹å¥½çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚è®²åˆ†ç±»é—®é¢˜çš„æ•°æ®å¤„ç†æˆone-hotç¼–ç çš„æ•°æ®ç±»å‹ç­‰ï¼Œ å¸¸ç”¨ä¸åˆ†ç±»é—®é¢˜çš„ç‰¹å¾å¤„ç† sk-learnç‰¹å¾æŠ½å–api1.å­—å…¸ç‰¹å¾æŠ½å– ä½¿ç”¨ç±»: sklearn.feature_extraction.DictVectorizer å¸¸ç”¨æ–¹æ³• DictVectorizer(sparse=True,â€¦) # åˆ›å»ºdict_vertå¯¹è±¡ sparse: æ˜¯å¦è¿”å›sparseçŸ©é˜µ DictVectorizer.fit_transform(X) # å°†Xè¿›è¡Œç‰¹å¾è½¬åŒ– X:å­—å…¸æˆ–è€…åŒ…å«å­—å…¸çš„è¿­ä»£å™¨ DictVectorizer.inverse_transform(X) # å°†Xè½¬ä¸ºä¸ºç‰¹å¾è½¬åŒ–ä¹‹å‰çš„æ•°æ®æ ¼å¼ X:arrayæ•°ç»„æˆ–è€…sparseçŸ©é˜µ DictVectorizer.get_feature_names() # è·å–ç‰¹å¾ç±»åˆ«åç§° DictVectorizer.fit(X) å°†Xæ•°æ®è¿›è¡Œç‰¹å¾å€¼æ ‡å‡†åŒ¹é… DictVectorizer.transform(X) # å°†XæŒ‰ç…§ä¹‹å‰çš„fitæ ‡å‡†è¿›è¡Œè½¬åŒ– è¿”å›å€¼çš„æ•°æ®æ ¼å¼ç±»å‹one-hotç¼–ç  2.æ–‡æœ¬çš„ç‰¹å¾æŠ½å– è‹±æ–‡æ–‡æœ¬ç‰¹å¾æŠ½å– ä½¿ç”¨ç±»: sklearn.feature_extraction.text.CountVectorizer å¸¸ç”¨æ–¹æ³• CountVectorizer(max_df=1.0,min_df=1, stop_wordï¼‰ # åˆ›å»ºè¯é¢‘çŸ©é˜µå¯¹è±¡ max_dfæ•´æ•°ï¼šæŒ‡æ¯ä¸ªè¯çš„æ‰€æœ‰æ–‡æ¡£è¯é¢‘æ•°ä¸å¤§äºè¯¥å€¼ min_dfå°æ•°ï¼šæ¯ä¸ªè¯çš„æ¬¡æ•°ï¼æ‰€æœ‰æ–‡æ¡£æ•°é‡ï¼Œæœ€å° stop_word: å°†åˆ†è¯çš„å“ªäº›ä¸éœ€è¦çš„ç»“æœè¿›è¡Œå‰”é™¤ CountVectorizer.fit_transform(X) # è·å–ç‰¹å¾å€¼çŸ©é˜µ X:æ–‡æœ¬æˆ–è€…åŒ…å«æ–‡æœ¬å­—ç¬¦ä¸²çš„å¯è¿­ä»£å¯¹è±¡ æ³¨æ„: åˆ©ç”¨toarray(), å¯ä»¥å°†è¿”å›å€¼è¿›è¡ŒsparseçŸ©é˜µè½¬æ¢arrayæ•°ç»„ CountVectorizer.inverse_transform(X) # å°†ç‰¹å¾å€¼çŸ©é˜µè½¬åŒ–ä¸ºä¹‹å‰çš„æ•°æ®æ ¼å¼ X:arrayæ•°ç»„æˆ–è€…sparseçŸ©é˜µ CountVectorizer.get_feature_names() # è·å–ç‰¹å¾å€¼åŒ–åçš„å•è¯åˆ—è¡¨ ä¸­æ–‡æ–‡æœ¬ç‰¹å¾æŠ½å– å¸¸ç”¨æ–¹æ³• ä½¿ç”¨ç±»ï¼šsklearn.feature_extraction.text.TfidfVectorizer TfidfVectorizer(stop_words=None,â€¦) # åˆ›å»ºæƒé‡çŸ©é˜µå¯¹è±¡ TfidfVectorizer.fit_transform(X) # è¿”å›æ–‡æœ¬å•è¯çš„æƒé‡sparseçŸ©é˜µ X:æ–‡æœ¬æˆ–è€…åŒ…å«æ–‡æœ¬å­—ç¬¦ä¸²çš„å¯è¿­ä»£å¯¹è±¡ TfidfVectorizer.inverse_transform(X) X:arrayæ•°ç»„æˆ–è€…sparseçŸ©é˜µ # å°†çŸ©é˜µè½¬æ¢ä¹‹å‰æ•°æ®æ ¼å¼ TfidfVectorizer.get_feature_names() # è·å–ç‰¹å¾æŠ½å–åçš„å•è¯åˆ—è¡¨ å¤‡æ³¨: ä¸­æ–‡çš„ç‰¹å¾å€¼æŠ½å–åŸç†ä¸Šå’Œè‹±æ–‡ä¸€æ ·ï¼Œä½†æ˜¯éœ€è¦å…ˆä½¿ç”¨åˆ†è¯å™¨å¯¹é•¿å¥å­, è¿›è¡Œåˆ†è¯å¤„ç† åˆ†è¯å™¨çš„å¸¸ç”¨æ–¹æ³• pip3 install jieba # ä¸‹è½½jiebaåˆ†è¯å™¨ import jieba jieba.cut(â€œpython ç°åœ¨æˆ‘åœ¨è¿›è¡Œç‰¹å¾è¯æŠ½å–â€) # å¯¹å¥å­è¿›è¡Œåˆ†è¯å¤„ç† è¿”å›ï¼š è¿”å›åŒ…å«åˆ†è¯ç»“æœçš„ç”Ÿæˆå™¨ TF-IDF TF_IDFçš„ä»‹ç» å¦‚æœæŸä¸ªè¯æˆ–çŸ­è¯­åœ¨ä¸€ç¯‡æ–‡ç« ä¸­å‡ºç°çš„æ¦‚ç‡é«˜ï¼Œå¹¶ä¸”åœ¨å…¶ä»–æ–‡ç« ä¸­å¾ˆå°‘å‡ºç°ï¼Œåˆ™è®¤ä¸ºæ­¤è¯æˆ–è€…çŸ­è¯­å…·æœ‰å¾ˆå¥½çš„ç±»åˆ«åŒºåˆ†èƒ½åŠ›ï¼Œé€‚åˆç”¨æ¥åˆ†ç±»ã€‚ TF-IDFä½œç”¨ ç”¨ä»¥è¯„ä¼°ä¸€å­—è¯å¯¹äºä¸€ä¸ªæ–‡ä»¶é›†æˆ–ä¸€ä¸ªè¯­æ–™åº“ä¸­çš„å…¶ä¸­ä¸€ä»½æ–‡ä»¶çš„é‡è¦ç¨‹åº¦ã€‚ åˆ†ç±»æœºå™¨å­¦ä¹ ç®—æ³•çš„é‡è¦ä¾æ® TF-IDFçš„è®¡ç®—å…¬å¼ æ•°æ®ç‰¹å¾ç”Ÿæˆ(ç”Ÿæˆäº¤å‰ç‰¹å¾)ä¸ºä»€ä¹ˆç”Ÿæˆäº¤å‰ç‰¹å¾æ¯”å¦‚è¯´æˆ‘ä»¬ç›®å‰æœ‰ä¸€ç¾¤äºŒç»´çš„è¾“å…¥æ ·æœ¬[a,b][a,b], è¿™ä¸ªç¾¤äºŒç»´çš„è¾“å…¥æ ·æœ¬å»è®­ç»ƒæ¨¡å‹ï¼Œå‘ç°ä¸ç®¡åœ¨è®­ç»ƒé›†è¿˜æ˜¯åœ¨æµ‹è¯•é›†ä¸­çš„R^2 å€¼éƒ½ä¸é«˜ã€‚ è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†äºŒç»´æ ·æœ¬ç©ºé—´æ˜ å°„åˆ°è·Ÿé«˜ç»´åº¦ä¾‹å¦‚ï¼š[1,a,b,a2,ab,b2][1,a,b,a2,ab,b2] æˆ–è€…æ›´é«˜ç»´åº¦ã€‚æ¥ä½“ç°featureså’Œfeaturesä¹‹é—´çš„å…³ç³»ã€‚ sklearnçš„äº¤å‰ç‰¹å¾ç”Ÿæˆapi poly = PolynomialFeatures(degree = 2, interaction_only = True, include_bias=False) degreeï¼šé»˜è®¤ä¸º2ï¼Œå¤šé¡¹å¼æ¬¡æ•°(å°±åŒå‡ å…ƒå‡ æ¬¡æ–¹ç¨‹ä¸­çš„æ¬¡æ•°ä¸€æ ·) interaction_onlyï¼šæ˜¯å¦åŒ…å«å•ä¸ªè‡ªå˜é‡è‡ªç›¸ä½œç”¨ï¼Œé»˜è®¤ä¸ºFalseï¼Œä¸ºTrueåˆ™è¡¨ç¤ºå»é™¤ä¸è‡ªå·±ç›¸ä¹˜çš„æƒ…å†µ include_biasï¼šæ˜¯å¦åŒ…å«åå·®æ ‡è¯†ï¼Œé»˜è®¤ä¸ºTrueï¼Œä¸ºFalseåˆ™è¡¨ç¤ºä¸åŒ…å«åå·®é¡¹ poly.fit_transform(X) ç¼ºå¤±å€¼å¤„ç†å¤„ç†çš„ä¸¤ç§æ€è·¯ åˆ é™¤ï¼š å¦‚æœæ¯åˆ—æˆ–è€…è¡Œæ•°æ®ç¼ºå¤±å€¼è¾¾åˆ°ä¸€å®šçš„æ¯”ä¾‹ï¼Œå»ºè®®æ”¾å¼ƒæ•´è¡Œæˆ–è€…æ•´åˆ— æ’è¡¥ï¼šå¯ä»¥é€šè¿‡ç¼ºå¤±å€¼æ¯è¡Œæˆ–è€…æ¯åˆ—çš„å¹³å‡å€¼ã€ä¸­ä½æ•°æ¥å¡«å…… sk-learnç¼ºå¤±å€¼å¤„ç†api sklearn.preprocessing.Imputer Imputer(missing_values=â€™NaNâ€™, strategy=â€™meanâ€™, axis=0) missing_values: å´æ˜¯å€¼çš„ä»£æ›¿å€¼ strategyï¼š ç¼ºå¤±ä»£æ›¿å€¼çš„ç±»å‹ axisï¼š ä»£è¡¨æŒ‰ç…§åˆ—æ¥è®¡ç®—, 1æŒ‰ç…§è¡Œæ¥è®¡ç®— Imputer.fit_transform(X) # å°†ç¼ºå¤±å€¼è¿›è¡Œæ’è¡¥ X:numpy arrayæ ¼å¼çš„æ•°æ®[n_samples,n_features] np.NaNçš„è§£é‡Š numpyçš„æ•°ç»„ä¸­å¯ä»¥ä½¿ç”¨np.nan/np.NaNæ¥ä»£æ›¿ç¼ºå¤±å€¼ï¼Œå±äºfloatç±»å‹ å¦‚æœæ˜¯æ–‡ä»¶ä¸­çš„ä¸€äº›ç¼ºå¤±å€¼ï¼Œå¯ä»¥æ›¿æ¢æˆnanï¼Œé€šè¿‡np.arrayè½¬åŒ–æˆfloatå‹çš„æ•°å€¼å³å¯ æ ‡å‡†åŒ–å’Œå½’ä¸€åŒ–å¤„ç†å½’ä¸€åŒ–å¤„ç†é€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡Œå˜æ¢æŠŠæ•°æ®æ˜ å°„åˆ°(é»˜è®¤ä¸º[0,1])ä¹‹é—´ å½’ä¸€åŒ–å…¬å¼ å¤‡æ³¨: ä½œç”¨äºæ¯ä¸€åˆ—ï¼Œmaxä¸ºä¸€åˆ—çš„æœ€å¤§å€¼ï¼Œminä¸ºä¸€åˆ—çš„æœ€å°å€¼,é‚£ä¹ˆXâ€™ä¸ºæœ€ç»ˆç»“æœï¼Œmxï¼Œmiåˆ†åˆ«ä¸ºæŒ‡å®šåŒºé—´å€¼é»˜è®¤mxä¸º1,miä¸º0 sklearnå½’ä¸€åŒ–API sklearn.preprocessing.MinMaxScaler MinMaxScalar(feature_range=(0,1)â€¦) # åˆ›å»ºå½’ä¸€åŒ–å¯¹è±¡ feature_rangeï¼šæ¯ä¸ªç‰¹å¾ç¼©æ”¾åˆ°ç»™å®šèŒƒå›´(é»˜è®¤[0,1]) MinMaxScalar.fit_transform(X) # å¯¹æ•°æ®é›†è¿›è¡Œå½’ä¸€åŒ–å¤„ç† X:numpy arrayæ ¼å¼çš„æ•°æ® è¿”å›è½¬æ¢åçš„å½¢çŠ¶ç›¸åŒçš„arrayå½’ä¸€åŒ–çš„å¼Šç«¯ä½¿ç”¨å½’ä¸€åŒ–çš„æ—¶å€™ï¼Œæœ€å¤§å€¼å’Œæœ€å°å€¼éå¸¸å®¹æ˜“å—åˆ°å¼‚å¸¸ç‚¹çš„å½±å“ï¼Œ æ‰€ä»¥è¿™ç§åªé€‚åˆäºä¼ ç»Ÿç²¾ç¡®å°çš„æ•°æ®åœºæ™¯ æ ‡å‡†åŒ–å¤„ç†é€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡Œå˜æ¢æŠŠæ•°æ®å˜æ¢åˆ°å‡å€¼ä¸º0,æ–¹å·®ä¸º1çš„æ­£å¤ªåˆ†å¸ƒèŒƒå›´å†… æ ‡å‡†åŒ–å¤„ç† å…¬å¼ æ ‡å‡†åŒ–çš„ä¼˜ç‚¹å¦‚æœå‡ºç°å¼‚å¸¸ç‚¹ï¼Œç”±äºå…·æœ‰ä¸€å®šæ•°æ®é‡ï¼Œå°‘é‡çš„å¼‚å¸¸ç‚¹å¯¹äºå¹³å‡å€¼çš„å½±å“å¹¶ä¸å¤§ï¼Œä»è€Œæ–¹å·®æ”¹å˜è¾ƒå°, å¯¹æ ‡å‡†åŒ–çš„å½±å“è¾ƒå°ã€‚ sklearnæ ‡å‡†åŒ–å¤„ç†API scikit-learn.preprocessing.StandardScaler StandardScaler() # åˆ›å»ºæ ‡å‡†åŒ–å®ä¾‹å¯¹è±¡ StandardScaler.fit_transform(X) # å°†Numpy array æ ¼å¼çš„æ•°æ®è¿›è¡Œæ ‡å‡†åŒ– StandardScaler.mean_ # åŸå§‹æ•°æ®ä¸­æ¯åˆ—ç‰¹å¾çš„å¹³å‡å€¼ StandardScaler.std_ # åŸå§‹æ•°æ®æ¯åˆ—ç‰¹å¾çš„æ–¹å·® ç‰¹å¾çš„ç­›é€‰å’Œé™ç»´ç‰¹å¾å€¼é€‰æ‹©çš„åŸå›  å†—ä½™ï¼šéƒ¨åˆ†ç‰¹å¾çš„ç›¸å…³åº¦é«˜ï¼Œå®¹æ˜“æ¶ˆè€—è®¡ç®—æ€§èƒ½ å™ªå£°ï¼šéƒ¨åˆ†ç‰¹å¾å¯¹é¢„æµ‹ç»“æœæœ‰è´Ÿå½±å“ ä¸»è¦åº”ç”¨çš„æ–¹æ³• 1.Filter(è¿‡æ»¤å¼):VarianceThreshold 2.Embedded(åµŒå…¥å¼)ï¼šæ­£åˆ™åŒ–ã€å†³ç­–æ ‘ 3.Wrapper(åŒ…è£¹å¼) 1.ä½æ–¹å·®ç‰¹å¾ç­›é€‰-sklearnç‰¹å¾é€‰æ‹©API sklearn.feature_selection.VarianceThreshold VarianceThreshold(threshold = 0.0) # åˆ›å»ºä½æ–¹å·®æ•°æ®åˆ é™¤å¯¹è±¡ thresholdï¼š è®¾å®šæ–¹å·®ä½äºå¤šå°‘è¿›è¡Œåˆ é™¤ Variance.fit_transform(X) # å¯¹ç‰¹å¾æ•°æ®ä¸­æ–¹å·®è¾ƒä½çš„ç‰¹å¾è¿›è¡Œåˆ é™¤ X:numpy arrayæ ¼å¼çš„æ•°æ® è¿”å›å€¼ï¼šè®­ç»ƒé›†å·®å¼‚ä½äºthresholdçš„ç‰¹å¾å°†è¢«åˆ é™¤ã€‚é»˜è®¤å€¼æ˜¯ä¿ç•™æ‰€æœ‰éé›¶æ–¹å·®ç‰¹å¾ï¼Œå³åˆ é™¤æ‰€æœ‰æ ·æœ¬ä¸­å…·æœ‰ç›¸åŒå€¼çš„ç‰¹å¾ã€‚ PCAçš„çš„ä½œç”¨ ç‰¹å¾ä¹‹é—´é€šå¸¸æ˜¯çº¿æ€§ç›¸å…³çš„ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›ç‰¹å¾åˆå¹¶æ“ä½œ PCAæ˜¯ä¸€ç§åˆ†æã€ç®€åŒ–æ•°æ®é›†çš„æŠ€æœ¯ï¼Œ æ˜¯æ•°æ®ç»´æ•°å‹ç¼©ï¼Œå°½å¯èƒ½é™ä½åŸæ•°æ®çš„ç»´æ•°ï¼ˆå¤æ‚åº¦ï¼‰ï¼ŒæŸå¤±å°‘é‡ä¿¡æ¯, å¯ä»¥å‰Šå‡å›å½’åˆ†ææˆ–è€…èšç±»åˆ†æä¸­ç‰¹å¾çš„æ•°é‡. PCA é™ç»´ å…¬å¼ 2.ç‰¹å¾çš„é™ç»´(PCA)-sklearn api sklearn. decomposition.PCA PCA(n_components=None) # åˆ›å»ºPCAå¯¹è±¡ n_componentsï¼š å°†æ•°æ®è½¬åŒ–ä¸ºå¤šå°‘ç»´åº¦çš„æ•°æ®, é»˜è®¤åªé™ä½ä¸€ç»´ PCA.fit_transform(X) # å¯¹ç‰¹å¾çŸ©é˜µè¿›è¡Œé™ç»´å¤„ç† X:numpy arrayæ ¼å¼çš„æ•°æ®[n_samples,n_features] è¿”å›å€¼ï¼šè½¬æ¢åæŒ‡å®šç»´åº¦çš„array 4.ç‰¹å¾çš„æ•ˆæœè¯„åˆ¤ å‡†ç¡®ç‡ è®¡ç®—å…¬å¼ å‡†ç¡®ç‡ = (TP + TN)/(TP + FP + FN + TN) sklearn api from sklearn.metrics import accuracy_score accuracy_score(y_true, y_predict, normalize=False) ç²¾ç¡®ç‡ è®¡ç®—å…¬å¼ ç²¾ç¡®ç‡ = (TP) / (TP + FP) sklearn api from sklearn.metrics import precision_score precision_score(y_true, y_predict) å¬å›ç‡ è®¡ç®—å…¬å¼ å¬å›ç‡ = (TP) / (TP + FN) sklearn api from sklearn.metrics import recall_score recall_score(y_true, y_predict) F1-score è®¡ç®—å…¬å¼ $F 1 - socre = 2 * \frac { \text { Precision } _ { - } \text { score*Recall score } } { \text { Precision } _ { - } \text { score } + \text { Recall } \text { score } }$ sklearn api from sklearn.metrics import f1_score f1_score(y_true, y_predict) æ··æ·†çŸ©é˜µ ä»€ä¹ˆæ˜¯æ··æ·†çŸ©é˜µ æ··æ·†çŸ©é˜µç”¨æ¥è¡¨ç¤ºé¢„æµ‹ç»“æœçš„çœŸå®åé¦ˆï¼Œè¿”å›çš„å½¢å¼æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œå¯¹è§’çº¿å…ƒç´ è¡¨ç¤ºé¢„æµ‹æ ‡ç­¾ç­‰äºçœŸå®æ ‡ç­¾çš„ç‚¹çš„æ•°é‡,æ˜¯åˆ†ç±»ç»“æœçš„ä¸€ä¸ªç»å¯¹é‡ ä¸¾ä¸ªæ —å­ â€‹ è·å¾—çš„æ··æ·†çŸ©é˜µä¸º sklearn api from sklearn.metrics import confusion_matrix confusion_matrix(y_true, y_pred) ROC è®¡ç®—å…¬å¼ TPR = TP / (TP + FN) é¢„æµ‹ä¸ºæ­£çš„æ ·æœ¬å æ‰€æœ‰æ­£æ ·æœ¬æ¯”ä¾‹ FPR = FP / (FP + TN) é¢„æµ‹ä¸ºæ­£ä½†æ˜¯å®é™…ä¸ºè´Ÿçš„æ ·æœ¬å æ‰€æœ‰è´Ÿæ ·æœ¬çš„æ¯”ä¾‹ sklearn api from sklearn.metrics import roc_curve fpr, tpr, thresholds = roc_curve(y_true, y_pred,pos_label=1) thresholdsï¼š æ ·æœ¬å±äºæ­£æ ·æœ¬çš„æ¦‚ç‡ ROCæ›²çº¿ AUC è®¡ç®—å…¬å¼ AUCæ˜¯ROCæ›²çº¿ä¸‹æ–¹çš„é¢ç§¯ï¼Œé€šå¸¸AUCå€¼åœ¨0.5-1.0ä¹‹é—´ï¼Œå€¼è¶Šå¤§æ¨¡å‹æ•ˆæœè¶Šå¥½ AUC ä¸º 0.5 è·ŸéšæœºçŒœæµ‹ä¸€æ ·ï¼ˆä¾‹ï¼šä¸¢ç¡¬å¸ï¼‰ï¼Œæ¨¡å‹æ²¡æœ‰é¢„æµ‹ä»·å€¼ sklearn api from sklearn.metrics import auc roc_auc = auc(fpr, tpr) KS è®¡ç®—å…¬å¼ ks = max(TPR â€“ FPR) 5.æ¨¡å‹çš„é€‰æ‹©ä¸è°ƒä¼˜äº¤å‰éªŒè¯ äº¤å‰éªŒè¯çš„ä½œç”¨ ä¸ºäº†è®©è¢«è¯„ä¼°çš„æ¨¡å‹æ›´åŠ å‡†ç¡®å¯ä¿¡ äº¤å‰éªŒè¯çš„è¿‡ç¨‹ å°†æ‹¿åˆ°çš„è®­ç»ƒæ•°æ®ï¼Œåˆ†ä¸ºè®­ç»ƒå’ŒéªŒè¯é›†ã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼šå°†æ•°æ®åˆ†æˆ5ä»½ï¼Œå…¶ä¸­ä¸€ä»½ä½œä¸ºéªŒè¯é›†ã€‚ç„¶åç»è¿‡5æ¬¡(ç»„)çš„æµ‹è¯•ï¼Œæ¯æ¬¡éƒ½æ›´æ¢ä¸åŒçš„éªŒè¯é›†ã€‚å³å¾—åˆ°5ç»„æ¨¡å‹çš„ç»“æœï¼Œå–å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆç»“æœã€‚åˆç§°5æŠ˜äº¤å‰éªŒè¯ã€‚ ç½‘æ ¼æœç´¢ é€šå¸¸æƒ…å†µä¸‹ï¼Œæœ‰å¾ˆå¤šå‚æ•°æ˜¯éœ€è¦æ‰‹åŠ¨æŒ‡å®šçš„ï¼ˆå¦‚k-è¿‘é‚»ç®—æ³•ä¸­çš„Kå€¼ï¼‰ï¼Œè¿™ç§å«è¶…å‚æ•°ã€‚ä½†æ˜¯æ‰‹åŠ¨è¿‡ç¨‹ç¹æ‚ï¼Œæ‰€ä»¥éœ€è¦å¯¹æ¨¡å‹é¢„è®¾å‡ ç§è¶…å‚æ•°ç»„åˆã€‚æ¯ç»„è¶…å‚æ•°éƒ½é‡‡ç”¨äº¤å‰éªŒè¯æ¥è¿›è¡Œè¯„ä¼°ã€‚æœ€åé€‰å‡ºæœ€ä¼˜å‚æ•°ç»„åˆå»ºç«‹æ¨¡å‹ã€‚ äº¤å‰éªŒè¯é€šå¸¸æ˜¯ä¸ºäº†é…åˆç½‘æ ¼æœç´¢, é€šè¿‡ç½‘æ ¼ä¼¼çš„å‚æ•°å¯¹æ¯”, äº¤å‰éªŒè¯å‡ºæœ€ä¼˜å‚æ•°, ä»¥æ­¤æ¥ä¼˜åŒ–æ¨¡å‹çš„å‚æ•°é€‰æ‹© äº¤å‰éªŒè¯-ç½‘æ ¼æœç´¢api sklearn.model_selection.GridSearchCV sklearn.model_selection.GridSearchCV(estimator, param_grid=None,cv=None) estimatorï¼šä¼°è®¡å™¨å¯¹è±¡ param_gridï¼šä¼°è®¡å™¨å‚æ•° dictç±»å‹, keyä¸ºè¶…å‚æ•°, valueä¸ºå°†è¦è¿›è¡Œç½‘æ ¼æœç´¢çš„å‚æ•° {â€œn_neighborsâ€:[1,3,5]} cvï¼šæŒ‡å®šå‡ æŠ˜äº¤å‰éªŒè¯ fitï¼šè¾“å…¥è®­ç»ƒæ•°æ® scoreï¼šå‡†ç¡®ç‡è¯„ä¼°é›†åˆï¼Œè¿”å›å¤šç»„çš„è®­ç»ƒå‡†ç¡®ç‡ç»“æœ è¿”å›ç»“æœåˆ†æï¼š best_score_:åœ¨äº¤å‰éªŒè¯ä¸­éªŒè¯çš„æœ€å¥½ç»“æœ best_estimator_ï¼šæœ€å¥½çš„å‚æ•°æ¨¡å‹ cv_results_:æ¯æ¬¡äº¤å‰éªŒè¯åçš„æµ‹è¯•é›†å‡†ç¡®ç‡ç»“æœå’Œè®­ç»ƒé›†å‡†ç¡®ç‡ç»“æœ]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ•°æ®å¤„ç†</tag>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>ç‰¹å¾å·¥ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ”¯æŒå‘é‡æœº]]></title>
    <url>%2F2018%2F11%2F30%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%2F</url>
    <content type="text"><![CDATA[1.æ”¯æŒå‘é‡æœºä¼˜åŒ–ç›®æ ‡ä¸é€»è¾‘å›å½’å’Œç¥ç»ç½‘ç»œç›¸æ¯”ï¼Œæ”¯æŒå‘ï¥¾æœºï¼Œæˆ–è€…ç®€ç§°SVMï¼Œåœ¨è®­ç»ƒå¤æ‚çš„éçº¿æ€§æ–¹ç¨‹æ—¶æä¾›ï¦ºä¸€ç§ï¤ä¸ºæ¸…æ™°ï¼Œï¤åŠ å¼ºå¤§çš„æ–¹å¼ã€‚ åœ¨é€»è¾‘å›å½’ä¸­æˆ‘ä»¬å·²ç»ç†Ÿæ‚‰ï¦ºè¿™ï§©çš„å‡è®¾å‡½æ•°å½¢å¼ï¼Œå’Œä¸‹è¾¹çš„Så‹æ¿€æ´»å‡½æ•°ã€‚ä¸‹é¢ä¾ç„¶ç”¨zè¡¨ç¤º$\theta^Tx$ ç°åœ¨è€ƒè™‘ä¸‹æˆ‘ä»¬æƒ³è¦é€»è¾‘å›å½’åšï§½ä¹ˆï¼šå¦‚æœæœ‰ä¸€ä¸ª y = 1 çš„æ ·æœ¬ï¼Œï¥§ç®¡æ˜¯åœ¨è®­ç»ƒé›†ä¸­æˆ–æ˜¯åœ¨æµ‹è¯•é›†ä¸­ï¼Œåˆæˆ–è€…åœ¨äº¤å‰éªŒè¯é›†ä¸­ï¼Œæ€»ä¹‹æ˜¯ y = 1ï¼Œç°åœ¨æˆ‘ä»¬å¸Œæœ› $h_\theta(x)â€‹$ è¶‹è¿‘1ã€‚å› ä¸ºæˆ‘ä»¬æƒ³è¦æ­£ç¡®åœ°å°†æ­¤æ ·æœ¬åˆ†ç±»ï¼Œè¿™å°±æ„å‘³ç€å½“ $h_\theta(x)â€‹$ è¶‹è¿‘äº1æ—¶ï¼Œ$\theta^Txâ€‹$ åº”å½“è¿œå¤§äº0ã€‚è¿™æ˜¯å› ä¸ºç”±äº z è¡¨ç¤º $\theta^Txâ€‹$ï¼Œå½“ z è¿œå¤§äº0æ—¶ï¼Œå³åˆ°ï¦ºè¯¥å›¾çš„å³è¾¹ï¼Œä½ ï¥§éš¾å‘ç°æ­¤æ—¶é€»è¾‘å›å½’çš„è¾“å‡ºå°†è¶‹è¿‘äº1ã€‚ç›¸ååœ°ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¦ä¸€ä¸ªæ ·æœ¬ï¼Œå³ y = 0ã€‚æˆ‘ä»¬å¸Œæœ›å‡è®¾å‡½æ•°çš„è¾“å‡ºå€¼å°†è¶‹è¿‘äº0ï¼Œè¿™å¯¹åº”äº $\theta^Txâ€‹$ï¼Œæˆ–è€…å°±æ˜¯ z ä¼šè¿œå°äº0ï¼Œå› ä¸ºå¯¹åº”çš„å‡è®¾å‡½æ•°çš„è¾“å‡ºå€¼è¶‹è¿‘0ã€‚ å¦‚æœä½ è¿›ä¸€æ­¥è§‚å¯Ÿé€»è¾‘å›å½’çš„ä»£ä»·å‡½æ•°å…¬å¼ï¼Œä½ ä¼šå‘ç°æ¯ä¸ªæ ·æœ¬ (x, y) éƒ½ä¼šä¸ºæ€»ä»£ä»·å‡½æ•°ï¼Œå¢åŠ ä¸Šé¢çš„ä¸€é¡¹ï¼Œå› æ­¤ï¼Œå¯¹äºæ€»ä»£ä»·å‡½æ•°é€šå¸¸ä¼šæœ‰å¯¹æ‰€æœ‰çš„è®­ç»ƒæ ·æœ¬çš„ä»£ä»·å‡½æ•°æ±‚å’Œã€‚ æ¥ä¸‹æ¥ï¼Œè€ƒè™‘é€»è¾‘å›å½’çš„ä¸¤ç§æƒ…å†µï¼š ä¸€ç§æ˜¯y = 1 çš„æƒ…å†µï¼Œ ä¸€ç§æ˜¯ y = 0çš„æƒ…å†µ åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸­ï¼Œå‡è®¾ y = 1ï¼Œ æ­¤æ—¶åœ¨ç›®æ ‡å‡½æ•°ä¸­åªéœ€è¦ç¬¬ä¸€é¡¹èµ·ä½œç”¨ï¼Œ å› ä¸ºy = 1æ—¶ï¼Œ (1-y)é¡¹ç­‰äºé›¶ï¼Œå› æ­¤ï¼Œåœ¨y = 1çš„æ ·æœ¬ä¸­ï¼Œ å³(x, y) ä¸­ï¼Œ æˆ‘ä»¬å¾—åˆ°$-log({1\over1+e^{-z}})$ è¿™ä¸€é¡¹ã€‚ã€‚å¦‚æœç”»å‡ºå…³äº z çš„å‡½æ•°ï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„è¿™æ¡æ›²çº¿ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥çœ‹åˆ°ï¼Œå½“ Z å¢å¤§æ—¶ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äº $\theta^Tx$ å¢å¤§æ—¶ï¼Œz å¯¹åº”çš„å€¼ä¼šå˜çš„éå¸¸å°ã€‚å¯¹æ•´ä¸ªä»£ä»·å‡½æ•°è€Œè¨€ï¼Œå½±å“ä¹Ÿéå¸¸å°ã€‚è¿™ä¹Ÿå°±è§£é‡Šï¦ºï¼Œä¸ºï§½ä¹ˆé€»è¾‘å›å½’åœ¨è§‚å¯Ÿåˆ°æ­£æ ·æœ¬æ—¶ï¼Œè¯•å›¾å°†$\theta^Tx$è®¾ç½®å¾—éå¸¸å¤§ã€‚å› ä¸ºï¼Œåœ¨ä»£ä»·å‡½æ•°ä¸­çš„è¿™ä¸€é¡¹ä¼šå˜çš„éå¸¸å°ã€‚ ç°åœ¨å¼€å§‹å»ºç«‹æ”¯æŒå‘ï¥¾æœºï¼Œæˆ‘ä»¬ä»è¿™ï§©å¼€å§‹ï¼š æˆ‘ä»¬ä¼šä»è¿™ä¸ªä»£ä»·å‡½æ•°å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯ $-log({1\over1+e^{-z}})$ ä¸€ç‚¹ä¸€ç‚¹ä¿®æ”¹ï¼Œè®©æˆ‘å–è¿™ï§©çš„ z = 1 ç‚¹ï¼Œæˆ‘å…ˆç”»å‡ºå°†è¦ç”¨çš„ä»£ä»·å‡½æ•°ã€‚ æ–°çš„ä»£ä»·å‡½æ•°(å½“y=1)å’Œé€»è¾‘å›å½’çš„ä»£ä»·å‡½æ•°ç±»ä¼¼ï¼Œå°±æ˜¯è¿™æ¡ç´«çº¢è‰²çš„æ›²çº¿ã€‚é‚£ä¹ˆï¼Œåˆ°ï¦ºè¿™ï§©å·²ç»éå¸¸æ¥è¿‘é€»è¾‘å›å½’ä¸­ä½¿ç”¨çš„ä»£ä»·å‡½æ•°ï¦ºã€‚åªæ˜¯è¿™ï§©æ˜¯ç”±ä¸¤æ¡çº¿æ®µç»„æˆï¼Œå³ä½äºå³è¾¹çš„æ°´å¹³éƒ¨åˆ†å’Œä½äºå·¦è¾¹çš„ç›´çº¿éƒ¨åˆ†ï¼Œå…ˆåˆ«è¿‡å¤šçš„è€ƒè™‘å·¦è¾¹ç›´çº¿éƒ¨åˆ†çš„æ–œç‡ï¼Œè¿™å¹¶ï¥§æ˜¯å¾ˆé‡è¦ã€‚ä½†æ˜¯ï¼Œè¿™ï§©æˆ‘ä»¬å°†ä½¿ç”¨çš„æ–°çš„ä»£ä»·å‡½æ•°ï¼Œæ˜¯åœ¨y=1çš„å‰æä¸‹çš„ã€‚ä½ ä¹Ÿè®¸èƒ½æƒ³åˆ°ï¼Œè¿™åº”è¯¥èƒ½åšåŒé€»è¾‘å›å½’ä¸­ç±»ä¼¼çš„äº‹æƒ…ï¼Œä½†äº‹å®ä¸Šï¼Œåœ¨å‘é‡æœºçš„ä¼˜åŒ–é—®é¢˜ä¸­ï¼Œè¿™ä¼šå˜å¾—ï¤åšå®šï¼Œå¹¶ä¸”ä¸ºæ”¯æŒå‘ï¥¾æœºï¼Œå¸¦æ¥è®¡ç®—ä¸Šçš„ä¼˜åŠ¿ã€‚ å¦å¤–ä¸€ç§æƒ…å†µæ˜¯å½“ y = 1æ—¶ï¼Œæ­¤æ—¶å¦‚æœä½ ä»”ç»†è§‚å¯Ÿé€»è¾‘å›å½’çš„ä»£ä»·å‡½æ•°åªï§ä¸‹ï¦ºç¬¬äºŒé¡¹ï¼Œå› ä¸ºç¬¬ä¸€é¡¹è¢«æ¶ˆé™¤ï¦ºã€‚å¦‚æœå½“ y = 0æ—¶ï¼Œé‚£ä¹ˆè¿™ä¸€é¡¹ä¹Ÿå°±æ˜¯0ï¦ºã€‚æ‰€ä»¥ä¸Šè¿°è¡¨è¾¾å¼åªï§ä¸‹ï¦ºç¬¬äºŒé¡¹ã€‚å› æ­¤ï¼Œè¿™ä¸ªæ ·æœ¬çš„ä»£ä»·æˆ–æ˜¯ä»£ä»·å‡½æ•°çš„è´¡çŒ®ã€‚å°†ä¼šç”±è¿™ä¸€é¡¹è¡¨ç¤ºã€‚å¹¶ä¸”ï¼Œå¦‚æœä½ å°†è¿™ä¸€é¡¹ä½œä¸ºzçš„å‡½æ•°ï¼Œé‚£ä¹ˆï¼Œè¿™ï§©å°±ä¼šå¾—åˆ°æ¨ªè½´ z ã€‚åŒæ ·åœ°ï¼Œæˆ‘ä»¬è¦æ›¿ä»£é€»è¾‘å›å½’çš„ä»£ä»·å‡½æ•°è¿™ä¸€æ¡è“è‰²çš„çº¿ï¼Œç”¨ç›¸ä¼¼çš„æ–¹æ³•ï¼Œ ç”»å‡ºå½“y = 0çš„æ—¶å€™å‘é‡æœºçš„ä»£ä»·å‡½æ•°ã€‚ å¦‚æœæˆ‘ä»¬ç”¨ä¸€ä¸ªæ–°çš„ä»£ä»·å‡½æ•°æ¥ä»£æ›¿ï¼Œå³è¿™æ¡ä»0ç‚¹å¼€å§‹çš„æ°´å¹³ç›´çº¿ï¼Œç„¶åæ˜¯ä¸€æ¡æ–œçº¿ï¼Œåƒä¸Šå›¾ã€‚é‚£ä¹ˆï¼Œç°åœ¨è®©æˆ‘ç»™è¿™ä¸¤ä¸ªæ–¹ç¨‹å‘½åï¼Œç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ç§°ä¹‹ä¸ºcost1(z)ï¼ŒåŒæ—¶ï¼Œç¬¬äºŒä¸ªå‡½æ•°å‡½æ•°æˆ‘ç§°å®ƒä¸ºcost0(z)ã€‚è¿™ï§©çš„ä¸‹æ ‡æ˜¯æŒ‡åœ¨ä»£ä»·å‡½æ•°ä¸­ï¼Œå¯¹åº”çš„y=1å’Œy=0 çš„æƒ…å†µï¼Œæ‹¥æœ‰ï¦ºè¿™äº›å®šä¹‰åï¼Œä¸‹é¢å¼€å§‹æ„å»ºæ”¯æŒå‘ï¥¾æœºã€‚ è¿™æ˜¯æˆ‘ä»¬åœ¨é€»è¾‘å›å½’ä¸­ä½¿ç”¨ä»£ä»·å‡½æ•° J(Î¸)ã€‚ä¹Ÿè®¸è¿™ä¸ªæ–¹ç¨‹çœ‹èµ·æ¥ï¥§æ˜¯éå¸¸ç†Ÿæ‚‰ã€‚è¿™æ˜¯å› ä¸ºä¹‹å‰æœ‰ä¸ªè´Ÿå·åœ¨æ–¹ç¨‹å¤–é¢ï¼Œä½†æ˜¯ï¼Œè¿™ï§©æˆ‘æ‰€åšçš„æ˜¯ï¼Œå°†è´Ÿå·ç§»åˆ°ï¦ºè¡¨è¾¾å¼çš„ï§©é¢ï¼Œè¿™æ ·åšä½¿å¾—æ–¹ç¨‹çœ‹èµ·æ¥æœ‰äº›ï¥§åŒã€‚å¯¹äºæ”¯æŒå‘ï¥¾æœºè€Œè¨€ï¼Œå®è´¨ä¸Šæˆ‘ä»¬è¦å…¶è¡¨è¾¾å¼çš„ä¸¤ä¸ªéƒ¨åˆ†æ›¿æ¢ä¸º cost1(z)ï¼Œä¹Ÿå°±æ˜¯å‰é¢æ„å»ºçš„ä»£ä»·å‡½æ•°$cost_1(\theta^Tx)$, å’Œcost0(z)ï¼Œä¹Ÿå°±æ˜¯$cost_0(\theta^Tx)$ã€‚å› æ­¤ï¼Œå¯¹äºæ”¯æŒå‘ï¥¾æœºï¼Œæˆ‘ä»¬å¾—åˆ°ï¦ºè¿™ï§©çš„æœ€å°åŒ–é—®é¢˜ï¼Œå³æ˜¯å°†ä¸Šé¢çš„ä¸¤éƒ¨åˆ†ä»£ä»·å‡½æ•°æ›¿æ¢ä¸ºä¸‹è¾¹è“è‰²çš„æ”¯æŒå‘é‡æœºä»£ä»·å‡½æ•°çš„å…¬å¼$cost_1(\theta^Tx)$ å’Œ $cost_0(\theta^Tx)$ã€‚ç„¶åå†åŠ ä¸Šæ­£åˆ™åŒ–å‚æ•°ã€‚ ä½†æ˜¯åœ¨ä¸€èˆ¬çš„æ—¶å€™ï¼Œå¯¹æ”¯æŒå‘é‡æœºå…¬å¼çš„å‚æ•°ï¼Œä¼šæœ‰ä¸€äº›ä¸åŒï¼Œä¸‹é¢å°è¯•å¯¹å‘é‡æœºçš„ä»£ä»·å‡½æ•°è¿›è¡Œæ”¹é€ ï¼š é¦–å…ˆï¼Œæˆ‘ä»¬è¦é™¤å»1/mè¿™ä¸€é¡¹ï¼Œå½“ç„¶ï¼Œè¿™ä»…ä»…æ˜¯ç”±äºäººä»¬ä½¿ç”¨æ”¯æŒå‘ï¥¾æœºæ—¶ï¼Œå¯¹æ¯”äºé€»è¾‘å›å½’è€Œè¨€ï¼Œï¥§åŒçš„ä¹ æƒ¯æ‰€è‡´ï¼Œå› ä¸ºè¿™é‡Œä»…ä»…é™¤å»1/mè¿™ä¸€é¡¹ï¼Œä¹Ÿä¼šå¾—å‡ºåŒæ ·çš„ Î¸ æœ€ä¼˜å€¼ï¼Œå› ä¸º ä»…æ˜¯ä¸ªå¸¸ï¥¾ï¼Œå› æ­¤ï¼Œè¿™ä¸ªæœ€å°åŒ–é—®é¢˜ä¸­ï¼Œæ— è®ºå‰é¢æ˜¯å¦æœ‰ 1/m è¿™ä¸€é¡¹ï¼Œæœ€ç»ˆæˆ‘æ‰€å¾—åˆ°çš„æœ€ä¼˜å€¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚ ç¬¬äºŒç‚¹æ¦‚å¿µä¸Šçš„å˜åŒ–ï¼Œå¯¹äºé€»è¾‘å›å½’ï¼Œåœ¨ç›®æ ‡å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤é¡¹ï¼šç¬¬ä¸€ä¸ªæ˜¯è®­ç»ƒæ ·æœ¬çš„ä»£ä»·ï¼Œç¬¬äºŒä¸ªæ˜¯æˆ‘ä»¬çš„æ­£åˆ™åŒ–é¡¹ï¼Œæˆ‘ä»¬ï¥§å¾—ï¥§å»ç”¨æœ‰ Î» è¿™ä¸€é¡¹æ¥å¹³è¡¡ï¼Œè¿™å°±ç›¸å½“äºæˆ‘ä»¬æƒ³è¦æœ€å°åŒ–åŠ ä¸Šæ­£åˆ™åŒ–å‚æ•°ã€‚æˆ‘ä»¬æ‰€åšçš„æ˜¯é€šè¿‡è®¾ç½®ï¥§åŒæ­£åˆ™å‚æ•° Î» è¾¾åˆ°ä¼˜åŒ–ç›®çš„ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿæƒè¡¡å¯¹åº”çš„é¡¹ï¼Œæ˜¯ä½¿å¾—è®­ç»ƒæ ·æœ¬æ‹Ÿåˆçš„ï¤å¥½ã€‚å³æœ€å°åŒ–ã€‚ä½†å¯¹äºæ”¯æŒå‘ï¥¾æœºï¼ŒæŒ‰ç…§æƒ¯ï¦µï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªï¥§åŒçš„å‚æ•°æ›¿æ¢è¿™ï§©ä½¿ç”¨çš„ Î» æ¥æƒè¡¡è¿™ä¸¤é¡¹ã€‚å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªï¥§åŒçš„å‚æ•°ç§°ä¸ºCï¼Œ å› æ­¤ï¼Œåœ¨é€»è¾‘å›å½’ä¸­ï¼Œå¦‚æœç»™å®š Î»ï¼Œä¸€ä¸ªéå¸¸å¤§çš„å€¼ï¼Œæ„å‘³ç€ç»™äºˆæ­£åˆ™åŒ–ï¤å¤§çš„æƒé‡ã€‚è€Œè¿™ï§©ï¼Œå°±å¯¹åº”äºå°† C è®¾å®šä¸ºéå¸¸å°çš„å€¼ï¼Œé‚£ä¹ˆï¼ŒåŒæ ·çš„çš„å°†ä¼šç»™æ­£åˆ™åŒ–é¡¹ï¤å¤§çš„æƒé‡ã€‚å› æ­¤ï¼Œè¿™åªæ˜¯ä¸€ç§ï¥§åŒçš„æ–¹å¼æ¥æ§åˆ¶è¿™ç§æƒè¡¡æˆ–è€…ä¸€ç§ï¥§åŒçš„æ–¹æ³•ï¼Œå³ç”¨å‚æ•°æ¥å†³å®šæ˜¯ï¤å…³å¿ƒç¬¬ä¸€é¡¹çš„ä¼˜åŒ–ï¼Œè¿˜æ˜¯ï¤å…³å¿ƒç¬¬äºŒé¡¹çš„ä¼˜åŒ–ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥æŠŠè¿™ï§©çš„å‚æ•° C è€ƒè™‘æˆ 1/Î»ã€‚ æœ€åæœ‰åˆ«äºé€»è¾‘å›å½’è¾“å‡ºçš„æ¦‚ç‡ã€‚æˆ‘ä»¬çš„ä»£ä»·å‡½æ•°ï¼Œå½“æœ€å°åŒ–ä»£ä»·å‡½æ•°ï¼Œè·å¾—å‚æ•°Î¸æ—¶ï¼Œæ”¯æŒå‘ï¥¾æœºæ‰€åšçš„æ˜¯å®ƒæ¥ç›´æ¥é¢„æµ‹çš„å€¼ç­‰äº1ï¼Œè¿˜æ˜¯ç­‰äº0ã€‚å› æ­¤ï¼Œå½“è¿™ä¸ªå‡è®¾å‡½æ•°å½“$\theta^Tx$å°äº0æ—¶ï¼Œä¼šé¢„æµ‹ä¸º0ã€‚å½“$\theta^Tx$å¤§äºæˆ–è€…ç­‰äº0æ—¶ï¼Œå°†é¢„æµ‹ä¸º1ã€‚ 2.å¤§é—´è·çš„ç†è§£å¤§é—´è·åˆ†ç±»å™¨ä¼˜åŒ–çº¦å®šå‘é‡æœºç»å¸¸è¢«çœ‹åšæ˜¯å¤§é—´è·åˆ†ç±»å™¨ï¼Œæ¥ä¸‹æ¥äº†è§£ä¸€ä¸‹å‘é‡æœºçš„å¤§è¾¹ç•Œçš„å«ä¹‰ï¼Œå¹¶è¿›ä¸€æ­¥äº†è§£SVMæ¨¡å‹çš„å‡è®¾ã€‚ è¿™æ˜¯æˆ‘çš„æ”¯æŒå‘ï¥¾æœºæ¨¡å‹çš„ä»£ä»·å‡½æ•°ï¼Œå·¦è¾¹æ˜¯cost1(z) å…³äºzçš„ä»£ä»·å‡½æ•°ï¼Œæ­¤å‡½æ•°ç”¨äºæ­£æ ·æœ¬ï¼Œå³è¾¹æ˜¯cost0(x)å…³äºzçš„ä»£ä»·å‡½æ•°ï¼Œæ¨ªè½´è¡¨ç¤ºzï¼Œç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ï¼Œæœ€å°åŒ–è¿™äº›ä»£ä»·å‡½æ•°çš„å¿…è¦æ¡ä»¶æ˜¯ï§½ä¹ˆã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªæ­£æ ·æœ¬y=1 ï¼Œåˆ™åªæœ‰åœ¨z &gt;= 1æ—¶ï¼Œä»£ä»·å‡½æ•°cost1(z)æ‰ç­‰äº0ã€‚ æˆ–è€…æ˜¯è¯´ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ­£æ ·æœ¬ï¼Œæˆ‘ä»¬å¸Œæœ›$\theta^Tx$&gt;=1, åä¹‹ï¼Œ å¦‚æœy = 0, ä»–åªæœ‰åœ¨z &lt;= -1 çš„æ—¶å€™ï¼Œ å‡½æ•°å€¼æ‰ä¸º0.è¿™æ˜¯æ”¯æŒå‘é‡æœºçš„ä¸€ä¸ªæœ‰è¶£çš„æ€§è´¨ã€‚äº‹å®ä¸Šï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ­£æ ·æœ¬y = 1, åˆ™å…¶å®æˆ‘ä»¬ä»…ä»…è¦æ±‚$\theta^Tx$å¤§äºç­‰äº0ï¼Œå°±èƒ½å°†è¯¥æ ·æœ¬æ°å½“çš„åˆ†å‡ºï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœ$\theta^Tx&gt;&gt;0$çš„è¯ï¼Œæˆ‘ä»¬çš„æ¨¡å‹ä»£ä»·å‡½æ•°å€¼ä¸º0ï¼Œ æ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„æ˜¯æ¯”0å¤§å¾ˆå¤šçš„å€¼ï¼Œæ¯”å¦‚å¤§äºç­‰äº1ã€‚è¿™å°±ç›¸å½“äºåœ¨æ”¯æŒå‘é‡æœºä¸­åµŒå…¥äº†ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å› å­ï¼Œæˆ–è€…è¯´æ˜¯å®‰å…¨çš„é—´è·å› å­ã€‚ æ¥ä¸‹æ¥çœ‹çœ‹Cå‚æ•°å¯¹æ”¯æŒå‘é‡æœºçš„å½±å“ã€‚å‡è®¾å°†Cè®¾ç½®ä¸ºä¸€ä¸ªéå¸¸å¤§çš„æ•°ï¼Œæ¯”å¦‚å°†Cè®¾ç½®æˆ10000æˆ–è€…å…¶ä»–éå¸¸å¤§çš„æ•° å¦‚æœ C éå¸¸å¤§ï¼Œåˆ™æœ€å°åŒ–ä»£ä»·å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†ä¼šå¾ˆå¸Œæœ›æ‰¾åˆ°ä¸€ä¸ªä½¿ç¬¬ä¸€é¡¹ä¸º0çš„æœ€ä¼˜è§£ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å°è¯•åœ¨ä»£ä»·é¡¹çš„ç¬¬ä¸€é¡¹ä¸º0çš„æƒ…å½¢ä¸‹ï§¤è§£è¯¥ä¼˜åŒ–é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æŠŠè®¾ç½®æˆï¦ºéå¸¸å¤§çš„å¸¸æ•°ï¼Œè¿™å°†ç»™æˆ‘ä»¬ä¸€äº›å…³äºæ”¯æŒå‘ï¥¾æœºæ¨¡å‹çš„ç›´è§‚æ„Ÿå—ã€‚ å‡å¦‚è¾“å…¥ä¸€ä¸ªè®­ç»ƒæ ·æœ¬æ ‡ç­¾ä¸º y = 1ï¼Œä½ æƒ³ä»¤ç¬¬ä¸€é¡¹ä¸º0ï¼Œä½ éœ€è¦åšçš„æ˜¯æ‰¾åˆ°ä¸€ä¸ª Î¸ï¼Œä½¿å¾—$\theta^Tx &gt;= 1$ï¼Œç±»ä¼¼åœ°ï¼Œå¯¹äºä¸€ä¸ªè®­ç»ƒæ ·æœ¬ï¼Œæ ‡ç­¾ä¸º y = 0ï¼Œä¸ºï¦ºä½¿ cost0(z) å‡½æ•°çš„å€¼ä¸º0ï¼Œæˆ‘ä»¬éœ€è¦ $\theta^Tx &lt;= -1$ã€‚å› æ­¤ï¼Œç°åœ¨è€ƒè™‘ä¼˜åŒ–é—®é¢˜ã€‚é€‰æ‹©å‚æ•°ï¼Œä½¿å¾—ç¬¬ä¸€é¡¹ç­‰äº0ï¼Œå°±ä¼šå¯¼è‡´ä¸‹é¢çš„ä¼˜åŒ–é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬å°†é€‰æ‹©å‚æ•°ä½¿ç¬¬ä¸€é¡¹ä¸º0ï¼Œå› æ­¤è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€é¡¹ä¸º0ï¼Œå› æ­¤æ˜¯Cä¹˜ä»¥0åŠ ä¸ŠäºŒåˆ†ä¹‹ä¸€ä¹˜ä»¥ç¬¬äºŒé¡¹ã€‚è¿™ï§©ç¬¬ä¸€é¡¹æ˜¯Cä¹˜ä»¥0ï¼Œå› æ­¤å¯ä»¥å°†å…¶åˆ å»ï¼Œå› ä¸ºæˆ‘çŸ¥é“å®ƒæ˜¯0ã€‚è¿™å°†éµä»ä»¥ä¸‹çš„çº¦æŸ(æ³¨æ„ï¼Œè¿™äº‹æ˜¯å½“å‘é‡æœºè¢«çœ‹åšæ˜¯å¤§é—´è·åˆ†ç±»å™¨æ—¶çš„çº¦å®š)ï¼šå¦‚æœ $y^{(i)}$ æ˜¯ç­‰äº1 çš„ï¼Œ $\theta^Tx^{(i)} &gt;=1$ ï¼Œå¦‚æœ $y^{(i)}$ æ˜¯ç­‰äº0çš„ï¼Œ$\theta^Tx^{(i)} &lt;= -1$ ï¼Œè¿™æ ·å½“æ±‚è§£è¿™ä¸ªä¼˜åŒ–é—®é¢˜çš„æ—¶å€™ï¼Œå½“ä½ æœ€å°åŒ–è¿™ä¸ªå…³äºå˜ï¥¾Î¸çš„å‡½æ•°çš„æ—¶å€™ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªéå¸¸æœ‰è¶£çš„å†³ç­–è¾¹ç•Œã€‚ å¤§é—´è·åˆ†ç±»å™¨å†³ç­–è¾¹ç•Œå’Œå¤§è¾¹ç•Œç†è§£ å¦‚æœæœ‰ä¸€ä¸ªæ•°æ®é›†ï¼Œå…¶ä¸­æœ‰æ­£æ ·æœ¬ï¼Œä¹Ÿæœ‰è´Ÿæ ·æœ¬ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ•°æ®é›†æ˜¯çº¿æ€§å¯åˆ†çš„ï¼Œå­˜åœ¨ä¸€æ¡ç›´çº¿æŠŠæ­£è´Ÿæ ·æœ¬åˆ†å¼€ã€‚å½“ç„¶æœ‰å¤šæ¡ï¥§åŒçš„ç›´çº¿ï¼Œå¯ä»¥æŠŠæ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬å®Œå…¨åˆ†å¼€ã€‚ æ¯”å¦‚ï¼Œä¸Šé¢çš„ç»¿è‰²å’Œç²‰è‰²çš„å†³ç­–è¾¹ç•Œï¼Œå¯ä»¥å®Œå…¨å°†è®­ç»ƒæ ·æœ¬åŒºåˆ†å¼€ã€‚ä½†æ˜¯å¤šå¤šå°‘å°‘è¿™ä¸ªçœ‹èµ·æ¥å¹¶ï¥§æ˜¯éå¸¸è‡ªç„¶ æ­£å¸¸çš„æ”¯æŒå‘ï¥¾æœºå°†ä¼šé€‰æ‹©è¿™ä¸ªé»‘è‰²çš„å†³ç­–è¾¹ç•Œï¼Œç›¸è¾ƒäºä¹‹å‰æˆ‘ç”¨ç²‰è‰²æˆ–è€…ç»¿è‰²ç”»çš„å†³ç­–ç•Œã€‚è¿™æ¡é»‘è‰²çš„çœ‹èµ·æ¥å¥½å¾—å¤šï¼Œé»‘çº¿çœ‹èµ·æ¥æ˜¯ï¤ç¨³å¥çš„å†³ç­–ç•Œã€‚åœ¨åˆ†ç¦»æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬ä¸Šå®ƒæ˜¾å¾—çš„ï¤å¥½ã€‚æ•°å­¦ä¸Šæ¥è®²ï¼Œè¿™æ˜¯ï§½ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™æ¡é»‘çº¿ä¸æ ·æœ¬ä¹‹é—´æœ‰ï¤å¤§çš„è·ç¦»ï¼Œè¿™ä¸ªè·ç¦»å«åšé—´è·(margin)ã€‚ å½“ç”»å‡ºè¿™ä¸¤æ¡é¢å¤–çš„è“çº¿ï¼Œæˆ‘ä»¬çœ‹åˆ°é»‘è‰²çš„å†³ç­–ç•Œå’Œè®­ç»ƒæ ·æœ¬ä¹‹é—´æœ‰ï¤å¤§çš„æœ€çŸ­è·ç¦»ã€‚ç„¶è€Œç²‰çº¿å’Œè“çº¿ç¦»è®­ç»ƒæ ·æœ¬å°±éå¸¸è¿‘ï¼Œåœ¨åˆ†ç¦»æ ·æœ¬çš„æ—¶å€™å°±ä¼šæ¯”é»‘çº¿è¡¨ç°å·®ã€‚å› æ­¤ï¼Œè¿™ä¸ªè·ç¦»å«åšæ”¯æŒå‘ï¥¾æœºçš„é—´è·ï¼Œè€Œè¿™æ˜¯æ”¯æŒå‘ï¥¾æœºå…·æœ‰é²æ£’æ€§çš„åŸå› ï¼Œå› ä¸ºå®ƒåŠªï¦Šç”¨ä¸€ä¸ªæœ€å¤§é—´è·æ¥åˆ†ç¦»æ ·æœ¬ã€‚å› æ­¤æ”¯æŒå‘ï¥¾æœºæœ‰æ—¶è¢«ç§°ä¸ºå¤§é—´è·åˆ†ç±»ï¨¸ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼Œä¸Šé¢ä¸€å°èŠ‚æåˆ°çš„ä¼˜åŒ–çº¦å®šï¼Œå³ï¼šå¦‚æœ $y^{(i)}$ æ˜¯ç­‰äº1 çš„ï¼Œ $\theta^Tx^{(i)} &gt;=1$ ï¼Œå¦‚æœ $y^{(i)}$ æ˜¯ç­‰äº0çš„ï¼Œ$\theta^Tx^{(i)} &lt;= -1$ ï¼Œå°±æ˜¯ä¸ºäº†è·å–å…·æœ‰æœ€å¤§é—´è·çš„å†³ç­–è¾¹ç•Œï¼Œæ¥è·å–æœ€å¥½çš„ä¼˜åŒ–ç»“æœã€‚ é‚£ä¹ˆåœ¨è®©ä»£ä»·å‡½æ•°æœ€å°åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾å‡ºåœ¨y=0å’Œy=1ä¸¤ç§æƒ…å†µä¸‹éƒ½ä½¿å¾—ä»£ä»·å‡½æ•°ä¸­å·¦è¾¹çš„è¿™ä¸€é¡¹å°½ï¥¾ä¸ºé›¶çš„å‚æ•°ã€‚å¦‚æœæˆ‘ä»¬æ‰¾åˆ°ï¦ºè¿™æ ·çš„å‚æ•°ï¼Œåˆ™æˆ‘ä»¬çš„æœ€å°åŒ–é—®é¢˜ï¥¥è½¬å˜æˆï¼š äº‹å®ä¸Šï¼Œæ”¯æŒå‘ï¥¾æœºç°åœ¨è¦æ¯”è¿™ä¸ªå¤§é—´è·åˆ†ç±»ï¨¸æ‰€ä½“ç°å¾—ï¤æˆç†Ÿï¼Œå°¤å…¶æ˜¯å½“ä½ ä½¿ç”¨å¤§é—´è·åˆ†ç±»ï¨¸çš„æ—¶å€™ï¼Œä½ çš„å­¦ä¹ ç®—æ³•ä¼šå—å¼‚å¸¸ç‚¹(outlier) çš„å½±å“ã€‚æ¯”å¦‚æˆ‘ä»¬åŠ å…¥ä¸€ä¸ªé¢å¤–çš„æ­£æ ·æœ¬ã€‚ åœ¨è¿™ï§©ï¼Œå¦‚æœä½ åŠ ï¦ºè¿™ä¸ªæ ·æœ¬ï¼Œä¸ºï¦ºå°†æ ·æœ¬ç”¨æœ€å¤§é—´è·åˆ†å¼€ï¼Œä¹Ÿè®¸æˆ‘æœ€ç»ˆä¼šå¾—åˆ°ä¸€æ¡ç±»ä¼¼ç²‰è‰²çš„å†³ç­–ç•Œã€‚ä»…ä»…åŸºäºä¸€ä¸ªå¼‚å¸¸å€¼ï¼Œä»…ä»…åŸºäºä¸€ä¸ªæ ·æœ¬ï¼Œå°±å°†æˆ‘çš„å†³ç­–ç•Œä»è¿™æ¡é»‘çº¿å˜åˆ°è¿™æ¡ç²‰çº¿ï¼Œè¿™å®åœ¨æ˜¯ï¥§æ˜æ™ºçš„ã€‚è€Œå¦‚æœæ­£åˆ™åŒ–å‚æ•°Cï¼Œè®¾ç½®çš„éå¸¸å¤§ï¼Œè¿™äº‹å®ä¸Šæ­£æ˜¯æ”¯æŒå‘ï¥¾æœºå°†ä¼šåšçš„ã€‚å®ƒå°†å†³ç­–ç•Œï¼Œä»é»‘çº¿å˜åˆ°ï¦ºç²‰çº¿ï¼Œä½†æ˜¯å¦‚æœC è®¾ç½®çš„å°ä¸€ç‚¹ï¼Œå¦‚æœä½ å°†Cè®¾ç½®çš„ï¥§è¦å¤ªå¤§ï¼Œåˆ™ä½ æœ€ç»ˆä¼šå¾—åˆ°è¿™æ¡é»‘çº¿ï¼Œå½“ç„¶æ•°æ®å¦‚æœï¥§æ˜¯çº¿æ€§å¯åˆ†çš„ï¼Œå¦‚æœä½ åœ¨è¿™ï§©æœ‰ä¸€äº›æ­£æ ·æœ¬æˆ–è€…ä½ åœ¨è¿™ï§©æœ‰ä¸€äº›è´Ÿæ ·æœ¬ï¼Œåˆ™æ”¯æŒå‘ï¥¾æœºä¹Ÿä¼šå°†å®ƒä»¬æ°å½“åˆ†å¼€ã€‚å› æ­¤ï¼Œå¤§é—´è·åˆ†ç±»ï¨¸çš„æè¿°ï¼Œä»…ä»…æ˜¯ä»ç›´è§‚ä¸Šç»™å‡ºï¦ºæ­£åˆ™åŒ–å‚æ•°Céå¸¸å¤§çš„æƒ…å½¢ï¼ŒåŒæ—¶ï¼ŒCçš„ä½œç”¨ç±»ä¼¼äº1/Î»ã€‚è¿™åªæ˜¯Céå¸¸å¤§çš„æƒ…å½¢ï¼Œæˆ–è€…ç­‰ä»·åœ° Î» éå¸¸å°çš„æƒ…å½¢ã€‚ä½ æœ€ç»ˆä¼šå¾—åˆ°ç±»ä¼¼ç²‰çº¿è¿™æ ·çš„å†³ç­–ç•Œï¼Œä½†æ˜¯å®é™…ä¸Šåº”ç”¨æ”¯æŒå‘ï¥¾æœºçš„æ—¶å€™ï¼Œå½“Cï¥§æ˜¯éå¸¸éå¸¸å¤§çš„æ—¶å€™ï¼Œå®ƒå¯ä»¥å¿½ï¥¶æ‰ä¸€äº›å¼‚å¸¸ç‚¹çš„å½±å“ï¼Œå¾—åˆ°ï¤å¥½çš„å†³ç­–ç•Œã€‚ç”šè‡³å½“ä½ çš„æ•°æ®ï¥§æ˜¯çº¿æ€§å¯åˆ†çš„æ—¶å€™ï¼Œæ”¯æŒå‘ï¥¾æœºä¹Ÿå¯ä»¥ç»™å‡ºå¥½çš„ç»“æœã€‚ 3.é€šè¿‡å‘é‡å†…ç§¯ç†è§£ç›®æ ‡å‡½æ•°æˆ‘ä»¬å…ˆå‰ç»™å‡ºçš„æ”¯æŒå‘ï¥¾æœºæ¨¡å‹ä¸­çš„ç›®æ ‡å‡½æ•°ã€‚ 4.æ ¸å‡½æ•°æ ¸å‡½æ•°åŠŸèƒ½å›é¡¾æˆ‘ä»¬ä¹‹å‰è®¨è®ºè¿‡å¯ä»¥ä½¿ç”¨é«˜çº§æ•°çš„å¤šé¡¹å¼æ¨¡å‹æ¥è§£å†³æ— æ³•ç”¨ç›´çº¿è¿›ï¨ˆåˆ†éš”çš„åˆ†ç±»é—®é¢˜ï¼š ä¸ºäº†è·å–ä¸Šå›¾æ‰€ç¤ºçš„åˆ¤å®šè¾¹ç•Œï¼Œæˆ‘ä»¬çš„æ¨¡å‹å¯èƒ½æ˜¯$\theta_0 + \theta_{1x1} + \theta_{2x2} + \theta_{3x1x2} + + \theta_{4x1^2} + â€¦..$ çš„å½¢å¼ æˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›åˆ—æ–°çš„ç‰¹å¾fæ¥ä»£æ›¿æ¨¡å‹ä¸­çš„æ¯ä¸€é¡¹ã€‚ä¾‹å¦‚ä»¤ï¼š f1 = x1, f2 = x2, f3 = x1x2, f4 = x1^2 â€¦.ï¼Œ å¾—åˆ°$h_\theta(x) = f1 + f2 + f3 + â€¦ + fn$, ç„¶è€Œï¼Œ é™¤äº†å¯¹åŸæœ‰çš„ç‰¹å¾è¿›è¡Œç»„åˆä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ¸å‡½æ•°è®¡ç®—å‡ºæ–°çš„ç‰¹å¾ã€‚ ç»™å®šä¸€ä¸ªè®­ç»ƒå®ä¾‹xï¼Œ æˆ‘ä»¬åˆ©ç”¨xçš„å„ä¸ªç‰¹å¾ä¸æˆ‘ä»¬é¢„å…ˆé€‰å®šçš„åœ°æ ‡(landmarks) $l^{(1)}, l^{(2)}, l^{(3)}$çš„è¿‘ä¼¼æˆéƒ½æ¥é€‰å–æ–°çš„ç‰¹å¾f1ï¼Œf2, f3 è¿™äº›åœ°æ ‡ $l^{(i)}$ çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ å¦‚æœä¸€ä¸ªè®­ç»ƒå®ï¦µä¸åœ°æ ‡ä¹‹é—´çš„è·ç¦»è¿‘ä¼¼äº0ï¼Œåˆ™æ–°ç‰¹å¾ f è¿‘ä¼¼äº $e^{-0} = 1$ï¼Œå¦‚æœè®­ç»ƒå®ï¦µxä¸åœ°æ ‡ä¹‹é—´è·ç¦»è¾ƒè¿œï¼Œåˆ™ f è¿‘ä¼¼äº$e^{ä¸€ä¸ªå¤§æ•°} = 0$ å‡è®¾æˆ‘ä»¬çš„è®­ç»ƒå®ä¾‹å«æœ‰ä¸¤ä¸ªç‰¹å¾[x1, x2] , ç»™å®šåœ°æ ‡$l^{(1)}$ä¸ä¸åŒçš„Ïƒå€¼ï¼Œè§ä¸‹å›¾ï¼š å›¾ä¸­æ°´å¹³é¢çš„åæ ‡ä¸º x1ï¼Œx2 ï¼Œ fä»£è¡¨å‚ç›´åæ ‡è½´ã€‚å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰å½“xä¸$l^{(1)}$é‡åˆæ—¶æ‰å…·æœ‰æœ€å¤§å€¼ã€‚éšç€xçš„æ”¹å˜ f å€¼æ”¹å˜çš„é€Ÿç‡å—åˆ°Ïƒ2çš„æ§åˆ¶ã€‚ åœ¨ä¸‹å›¾ä¸­ï¼Œå½“å®ï¦µå¤„äºæ´‹çº¢è‰²çš„ç‚¹ä½ç½®å¤„ï¼Œå› ä¸ºå…¶ç¦»$l^{(1)}$ï¤è¿‘ï¼Œä½†æ˜¯ç¦»$l^{(2)}$å’Œ$l^{(3)}$è¾ƒè¿œï¼Œå› æ­¤ f1 æ¥è¿‘1ï¼Œè€Œ f2, f3æ¥è¿‘0ã€‚å› æ­¤hÎ¸ï¼ˆxï¼‰ &gt; 0ï¼Œå› æ­¤é¢„æµ‹y = 1ã€‚åŒï§¤å¯ä»¥æ±‚å‡ºï¼Œå¯¹äºç¦» $l^{(2)}$ è¾ƒè¿‘çš„ç»¿è‰²ç‚¹ï¼Œä¹Ÿé¢„æµ‹ y = 1ï¼Œä½†æ˜¯å¯¹äºè“ç»¿è‰²çš„ç‚¹ï¼Œå› ä¸ºå…¶ç¦»ä¸‰ä¸ªåœ°æ ‡éƒ½è¾ƒè¿œï¼Œé¢„æµ‹ y = 0ã€‚ è¿™æ ·ï¼Œå›¾ä¸­çº¢è‰²çš„å°é—­æ›²çº¿æ‰€è¡¨ç¤ºçš„èŒƒå›´ï¼Œï¥¥æ˜¯æˆ‘ä»¬ä¾æ®ä¸€ä¸ªå•ä¸€çš„è®­ç»ƒå®ï¦µå’Œæˆ‘ä»¬é€‰å–çš„åœ°æ ‡æ‰€å¾—å‡ºçš„åˆ¤å®šè¾¹ç•Œï¼Œåœ¨é¢„æµ‹æ—¶ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„ç‰¹å¾ï¥§æ˜¯è®­ç»ƒå®ï¦µæœ¬èº«çš„ç‰¹å¾ï¼Œè€Œæ˜¯é€šè¿‡æ ¸å‡½æ•°è®¡ç®—å‡ºçš„æ–°ç‰¹å¾f1, f2, f3ã€‚ æ ¸å‡½æ•°ä½¿ç”¨å¦‚ä½•é€‰æ‹©åœ°æ ‡ æˆ‘ä»¬é€šå¸¸æ˜¯æ ¹æ®è®­ç»ƒé›†çš„æ•°ï¥¾é€‰æ‹©åœ°æ ‡çš„æ•°ï¥¾ï¼Œå³å¦‚æœè®­ç»ƒé›†ä¸­æœ‰mä¸ªå®ï¦µï¼Œåˆ™æˆ‘ä»¬é€‰å–mä¸ªåœ°æ ‡ï¼Œå¹¶ä¸”ä»¤:$l^{(1)} = x^{(1)}, l^{(2)} = x^{(2)}, â€¦., l^{(m)} = x^{(m)}$ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼šç°åœ¨æˆ‘ä»¬å¾—åˆ°çš„æ–°ç‰¹å¾æ˜¯å»ºç«‹åœ¨åŸæœ‰ç‰¹å¾ä¸è®­ç»ƒé›†ä¸­æ‰€æœ‰å…¶ä»–ç‰¹å¾ä¹‹é—´è·ç¦»çš„åŸºç¡€ä¹‹ä¸Šçš„ï¼Œå³ï¼š z æ³¨æ„: å¦‚æœæˆ‘ä»¬ä½¿ç”¨é«˜æ–¯æ ¸å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨ä¹‹å‰è¿›ï¨ˆç‰¹å¾ç¼©æ”¾æ˜¯éå¸¸å¿…è¦çš„ å¦å¤–ï¼Œæ”¯æŒå‘ï¥¾æœºä¹Ÿå¯ä»¥ï¥§ä½¿ç”¨æ ¸å‡½æ•°ï¼Œï¥§ä½¿ç”¨æ ¸å‡½æ•°åˆç§°ä¸ºçº¿æ€§æ ¸å‡½æ•°(linear kernel)ï¼Œå½“æˆ‘ä»¬ï¥§é‡‡ç”¨éå¸¸å¤æ‚çš„å‡½æ•°ï¼Œæˆ–è€…æˆ‘ä»¬çš„è®­ç»ƒé›†ç‰¹å¾éå¸¸å¤šè€Œå®ï¦µéå¸¸å°‘çš„æ—¶å€™ï¼Œå¯ä»¥é‡‡ç”¨è¿™ç§ï¥§å¸¦æ ¸å‡½æ•°çš„æ”¯æŒå‘ï¥¾æœºã€‚ 5.ä¸¤ä¸ªå‚æ•°C, Ïƒå¯¹æ”¯æŒå‘é‡æœºçš„å½±å“Cå¯¹æ”¯æŒå‘é‡æœºçš„å½±å“ C = 1/Î» Cè¾ƒå¤§çš„æ—¶å€™ï¼Œ ç›¸å½“äºÎ»è¾ƒå°çš„æ—¶å€™ï¼Œ å¯èƒ½ä¼šå¯¼è‡´è¿‡æ‹Ÿåˆï¼Œ é«˜æ–¹å·®ï¼› Cè¾ƒå°çš„æ—¶å€™ï¼Œç›¸å½“äºÎ»è¾ƒå¤§çš„æ—¶å€™ï¼Œ å¯èƒ½ä¼šå¯¼è‡´æ¬ æ‹Ÿåˆï¼Œ é«˜åå·®ï¼› Ïƒå¯¹æ”¯æŒå‘é‡æœºçš„å½±å“ Ïƒè¾ƒå¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½æ–¹å·®ï¼Œé«˜åå·®ï¼› Ïƒè¾ƒå°æ—¶æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½åå·®ï¼Œé«˜æˆ¿å·®ï¼› 6.ä½¿ç”¨æ”¯æŒå‘é‡æœºä¸åŒçš„æ ¸å‡½æ•° åœ¨é«˜æ–¯æ ¸å‡½æ•°ä¹‹å¤–æˆ‘ä»¬è¿˜æœ‰å…¶ä»–ä¸€äº›é€‰æ‹©ï¼Œå¦‚ï¼šå¤šé¡¹å¼æ ¸å‡½æ•°ï¼ˆPolynomial Kernelï¼‰å­—ç¬¦ï¤…æ ¸å‡½æ•°ï¼ˆString kernelï¼‰å¡æ–¹æ ¸å‡½æ•°ï¼ˆ chi-square kernelï¼‰ç›´æ–¹å›¾äº¤é›†æ ¸å‡½æ•°ï¼ˆhistogram intersection kernelï¼‰ å¤šåˆ†ç±»é—®é¢˜ å‡è®¾æˆ‘ä»¬ï§ç”¨ä¹‹å‰ä»‹ç»çš„ä¸€å¯¹å¤šæ–¹æ³•æ¥è§£å†³ä¸€ä¸ªå¤šç±»åˆ†ç±»é—®é¢˜ã€‚å¦‚æœä¸€å…±æœ‰kä¸ªç±»ï¼Œåˆ™æˆ‘ä»¬éœ€è¦kä¸ªæ¨¡å‹ï¼Œä»¥åŠkä¸ªå‚æ•°å‘ï¥¾Î¸ã€‚æˆ‘ä»¬åŒæ ·ä¹Ÿå¯ä»¥è®­ç»ƒkä¸ªæ”¯æŒå‘ï¥¾æœºæ¥è§£å†³å¤šç±»åˆ†ç±»é—®é¢˜ã€‚ä½†æ˜¯å¤§å¤šæ•°æ”¯æŒå‘ï¥¾æœºè½¯ä»¶åŒ…éƒ½æœ‰å†…ç½®çš„å¤šç±»åˆ†ç±»åŠŸèƒ½ï¼Œæˆ‘ä»¬åªè¦ç›´æ¥ä½¿ç”¨å³å¯ã€‚ é€‰æ‹©å‚æ•° 1ã€é€‰æ‹©å‚æ•°Cã€‚éœ€è¦è€ƒè™‘é«˜æ–¹å·®å’Œé«˜åå·®çš„é—®é¢˜2ã€é€‰æ‹©å†…æ ¸å‚æ•°Ïƒ ï¼Œ å’Œæ ¸å‡½æ•°ã€‚ é™¤éä½¿ç”¨çº¿å‹å’Œçš„SVMã€‚ 7.é€»è¾‘å›å½’å’ŒSVMä¹‹é—´çš„é€‰æ‹©nä¸ºç‰¹å¾æ•°ï¼Œ mä¸ºè®­ç»ƒæ ·æœ¬æ•°ã€‚ (1) å¦‚æœç›¸è¾ƒäºmè€Œè¨€ï¼Œ nè¦å¤§è®¸å¤šï¼Œå³è®­ç»ƒé›†æ•°æ®ï¥¾ï¥§å¤Ÿæ”¯æŒæˆ‘ä»¬è®­ç»ƒä¸€ä¸ªå¤æ‚çš„éçº¿æ€§æ¨¡å‹ï¼Œæˆ‘ä»¬é€‰ç”¨é€»è¾‘å›å½’æ¨¡å‹æˆ–è€…ï¥§å¸¦æ ¸å‡½æ•°çš„æ”¯æŒå‘ï¥¾æœºã€‚ (2)å¦‚æœnè¾ƒå°ï¼Œè€Œä¸”må¤§å°ä¸­ç­‰ï¼Œï¦µå¦‚åœ¨ 1-1000 ä¹‹é—´ï¼Œè€Œmåœ¨10-10000ä¹‹é—´ï¼Œä½¿ç”¨é«˜æ–¯æ ¸å‡½æ•°çš„æ”¯æŒå‘ï¥¾æœºã€‚ (3)å¦‚æœnè¾ƒå°ï¼Œè€Œmè¾ƒå¤§ï¼Œï¦µå¦‚åœ¨1-1000ä¹‹é—´ï¼Œè€Œmå¤§äº50000ï¼Œåˆ™ä½¿ç”¨æ”¯æŒå‘ï¥¾æœºä¼šéå¸¸æ…¢ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯åˆ›é€ ã€å¢åŠ ï¤å¤šçš„ç‰¹å¾ï¼Œç„¶åä½¿ç”¨é€»è¾‘å›å½’æˆ–ï¥§å¸¦æ ¸å‡½æ•°çš„æ”¯æŒå‘ï¥¾æœºã€‚ (4)ç¥ç»ç½‘ç»œåœ¨ä»¥ä¸Šä¸‰ç§æƒ…å†µä¸‹éƒ½å¯èƒ½ä¼šæœ‰è¾ƒå¥½çš„è¡¨ç°ï¼Œä½†æ˜¯è®­ç»ƒç¥ç»ç½‘ç»œå¯èƒ½éå¸¸æ…¢ï¼Œé€‰æ‹©æ”¯æŒå‘ï¥¾æœºçš„åŸå› ä¸»è¦åœ¨äºå®ƒçš„ä»£ä»·å‡½æ•°æ˜¯å‡¸å‡½æ•°ï¼Œï¥§å­˜åœ¨å±€éƒ¨æœ€å°å€¼ã€‚]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>ç›‘ç£å­¦ä¹ </tag>
        <tag>æ”¯æŒå‘é‡æœº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¨¡å‹çš„åå·®ã€æ–¹å·®ä»¥åŠä¼˜åŒ–]]></title>
    <url>%2F2018%2F11%2F24%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%2F</url>
    <content type="text"><![CDATA[1.æœºå™¨å­¦ä¹ æ¨¡å‹çš„è¯„ä¼°å’Œé€‰æ‹©æœ‰å•¥æ–¹æ³•èƒ½ä¼˜åŒ–æˆ‘ä»¬çš„æ¨¡å‹æ•´ç†äº†ä¸€ä¸‹ä¼˜åŒ–æ¨¡å‹æ—¶ï¼Œç»å¸¸åšçš„ä¸€äº›æ“ä½œï¼Œä¼˜åŒ–æ¨¡å‹æ— å¤–ä¹ä»¥ä¸‹å‡ ç§æ–¹æ³•: è·å¾—ï¤å¤šçš„è®­ç»ƒå®ï¦µâ€”â€”é€šå¸¸æ˜¯æœ‰æ•ˆçš„ï¼Œä½†ä»£ä»·è¾ƒå¤§ï¼Œä¸‹é¢çš„æ–¹æ³•ä¹Ÿå¯èƒ½æœ‰æ•ˆï¼Œå¯è€ƒè™‘å…ˆé‡‡ç”¨ä¸‹é¢çš„å‡ ç§æ–¹æ³•ã€‚ å°è¯•å‡å°‘ç‰¹å¾çš„æ•°ï¥¾ å°è¯•è·å¾—ï¤å¤šçš„ç‰¹å¾ å°è¯•å¢åŠ å¤šé¡¹å¼ç‰¹å¾ å°è¯•å‡å°‘æ­£åˆ™åŒ–ç¨‹åº¦ å°è¯•å¢åŠ æ­£åˆ™åŒ–ç¨‹åº¦ ä½†æ˜¯ï¼Œä¹Ÿå¦‚æˆ‘ä»¬æ‰€è§ï¼Œå¹¶ä¸æ˜¯ä»»ä½•æ¨¡å‹éƒ½é€‚ç”¨äºè¿™äº›ä¼˜åŒ–æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹ç—‡ä¸‹è¯ï¼Œæ¥ä¸‹æ¥å¯ä»¥çœ‹ä¸€ä¸‹æ€ä¹ˆç¡®å®šï¼Œæˆ‘ä»¬çš„æ¨¡å‹éœ€è¦ä»€ä¹ˆä¼˜åŒ–æœåŠ¡ æ¨¡å‹è¿‡æ‹Ÿåˆçš„åˆ¤æ–­ å½“æˆ‘ä»¬ç¡®å®šå­¦ä¹ ç®—æ³•çš„å‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬è€ƒè™‘çš„æ˜¯é€‰æ‹©å‚ï¥¾æ¥ä½¿è®­ç»ƒè¯¯å·®æœ€å°åŒ–ï¼Œæœ‰äººè®¤ä¸ºå¾—åˆ°ä¸€ä¸ªéå¸¸å°çš„è®­ç»ƒè¯¯å·®ä¸€å®šæ˜¯ä¸€ä»¶å¥½äº‹ï¼Œä½†æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œä»…ä»…æ˜¯å› ä¸ºè¿™ä¸ªå‡è®¾å…·æœ‰å¾ˆå°çš„è®­ç»ƒè¯¯å·®ï¼Œå¹¶ï¥§èƒ½è¯´æ˜å®ƒå°±ä¸€å®šæ˜¯ä¸€ä¸ªå¥½çš„å‡è®¾å‡½æ•°ã€‚æ­¤æ—¶å¾ˆå¯èƒ½æ¨¡å‹å·²ç»äº§ç”Ÿäº†è¿‡æ‹Ÿåˆã€‚ ä¸ºï¦ºæ£€éªŒç®—æ³•æ˜¯å¦è¿‡æ‹Ÿåˆï¼Œæˆ‘ä»¬å°†æ•°æ®åˆ†æˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œé€šå¸¸ç”¨70%çš„æ•°æ®ä½œä¸ºè®­ç»ƒé›†ï¼Œç”¨å‰©ä¸‹30%çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›†ã€‚å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯è®­ç»ƒé›†å’Œæµ‹è¯•é›†å‡è¦å«æœ‰å„ç§ç±»å‹çš„æ•°æ®ï¼Œé€šå¸¸æˆ‘ä»¬è¦å¯¹æ•°æ®è¿›ï¨ˆâ€œæ´—ç‰Œâ€ï¼Œç„¶åå†åˆ†æˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚ æµ‹è¯•é›†è¯„ä¼°åœ¨é€šè¿‡è®­ç»ƒé›†è®©æˆ‘ä»¬çš„æ¨¡å‹å­¦ä¹ å¾—å‡ºå…¶å‚æ•°åï¼Œå¯¹æµ‹è¯•é›†è¿ç”¨è¯¥æ¨¡å‹ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼è®¡ç®—è¯¯å·®ï¼š å¯¹äºçº¿æ€§å›å½’æ¨¡å‹ï¼Œæˆ‘ä»¬ï§ç”¨æµ‹è¯•é›†æ•°æ®è®¡ç®—ä»£ä»·å‡½æ•° J å¯¹äºé€»è¾‘å›å½’æ¨¡å‹ï¼Œæˆ‘ä»¬é™¤ï¦ºå¯ä»¥ï§ç”¨æµ‹è¯•æ•°æ®é›†æ¥è®¡ç®—ä»£ä»·å‡½æ•°å¤–è¿˜å¯ä»¥è®¡ç®—è¯¯åˆ†ç±»æ¯”ç‡ æ¨¡å‹çš„é€‰æ‹©å’Œäº¤å‰éªŒè¯é›†å½“æˆ‘ä»¬çš„ä½¿ç”¨å¤šé¡¹å¼æ¨¡å‹çš„æ—¶å€™ï¼Œç»å¸¸ä¼šä¸ç¡®å®šå¤šé¡¹å¼çš„é¡¹æ•°è¯¥å¦‚ä½•ç¡®å®šï¼Œä¸‹é¢æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„å¤„ç†æ€è·¯: å‡è®¾æˆ‘ä»¬è¦åœ¨10ä¸ªï¥§åŒæ¬¡æ•°çš„äºŒé¡¹å¼æ¨¡å‹ä¹‹é—´è¿›ï¨ˆé€‰æ‹©ï¼š â€‹ æ˜¾ç„¶è¶Šé«˜æ¬¡æ•°çš„å¤šé¡¹å¼æ¨¡å‹è¶Šèƒ½å¤Ÿé€‚åº”æˆ‘ä»¬çš„è®­ç»ƒæ•°æ®é›†ï¼Œä½†æ˜¯é€‚åº”è®­ç»ƒæ•°æ®é›†å¹¶ï¥§ä»£è¡¨ç€èƒ½é€‚åº”æˆ‘ä»¬çš„æµ‹è¯•é›†æˆ–è€…æ¨å¹¿è‡³ä¸€èˆ¬æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥é€‰æ‹©ä¸€ä¸ªï¤èƒ½é€‚åº”ä¸€èˆ¬æƒ…å†µçš„æ¨¡å‹ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨äº¤å‰éªŒè¯é›†æ¥å¸®åŠ©é€‰æ‹©æ¨¡å‹ã€‚ é€‰æ‹©æ¨¡å‹çš„æ–¹æ³•ï¼šä½¿ç”¨60%çš„æ•°æ®ä½œä¸ºè®­ç»ƒé›†ï¼Œä½¿ç”¨ 20%çš„æ•°æ®ä½œä¸ºäº¤å‰éªŒè¯é›†ï¼Œä½¿ç”¨20%çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›† ä½¿ç”¨è®­ç»ƒé›†è®­ç»ƒå‡º10ä¸ªæ¨¡å‹ ç”¨10ä¸ªæ¨¡å‹åˆ†åˆ«å¯¹äº¤å‰éªŒè¯é›†è®¡ç®—å¾—å‡ºäº¤å‰éªŒè¯è¯¯å·®ï¼ˆä»£ä»·å‡½æ•°çš„å€¼ï¼‰ é€‰å–ä»£ä»·å‡½æ•°å€¼æœ€å°çš„æ¨¡å‹ ç”¨æ­¥éª¤3ä¸­é€‰å‡ºçš„æ¨¡å‹å¯¹æµ‹è¯•é›†è®¡ç®—å¾—å‡ºæ¨å¹¿è¯¯å·®ï¼ˆä»£ä»·å‡½æ•°çš„å€¼ï¼‰Train/validation/test error Training error:$J{train}(\theta) = \frac{1}{2m}\sum\limits{i=1}{m}(h_{\theta}(x{(i)})-y{(i)})2$Cross Validation error:$J{cv}(\theta) = \frac{1}{2m{cv}}\sum\limits{i=1}^{m}(h{\theta}(x{(i)}{cv})-y{(i)}{cv})^2$Test error:$J{test}(\theta)=\frac{1}{2m{test}}\sum\limits{i=1}^{m{test}}(h{\theta}(x^{(i)}{cv})-y{(i)}_{cv})2â€‹$ æ¨¡å‹çš„åå·®å’Œæ–¹å·®è¯Šæ–­åå·®å’Œæ–¹å·®å½“ä½ è¿ï¨ˆä¸€ä¸ªå­¦ä¹ ç®—æ³•æ—¶ï¼Œå¦‚æœè¿™ä¸ªç®—æ³•çš„è¡¨ç°ï¥§ï§¤æƒ³ï¼Œé‚£ä¹ˆå¤šåŠæ˜¯å‡ºç°ä¸¤ç§æƒ…å†µï¼šè¦ä¹ˆæ˜¯åå·®æ¯”è¾ƒå¤§ï¼Œè¦ä¹ˆæ˜¯æ–¹å·®æ¯”è¾ƒå¤§ã€‚æ¢ï¤†è¯è¯´ï¼Œå‡ºç°çš„æƒ…å†µè¦ä¹ˆæ˜¯æ¬ æ‹Ÿåˆï¼Œè¦ä¹ˆæ˜¯è¿‡æ‹Ÿåˆé—®é¢˜ã€‚é‚£ä¹ˆè¿™ä¸¤ç§æƒ…å†µï¼Œå“ªä¸ªå’Œåå·®æœ‰å…³ï¼Œå“ªä¸ªå’Œæ–¹å·®æœ‰å…³ï¼Œæˆ–è€…æ˜¯ï¥§æ˜¯å’Œä¸¤ä¸ªéƒ½æœ‰å…³ï¼Ÿ å…¶å®æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ•ˆçš„æŒ‡ç¤ºï¨¸ï¼ŒæŒ‡å¼•ç€å¯ä»¥æ”¹è¿›ç®—æ³•çš„æœ€æœ‰æ•ˆçš„æ–¹æ³•å’Œé€”å¾„ã€‚åœ¨è¿™æ®µè§†é¢‘ä¸­ï¼Œæˆ‘æƒ³ï¤æ·±å…¥åœ°æ¢è®¨ä¸€ä¸‹æœ‰å…³åå·®å’Œæ–¹å·®çš„é—®é¢˜ï¼Œå¸Œæœ›ä½ èƒ½å¯¹å®ƒä»¬æœ‰ä¸€ä¸ªï¤æ·±å…¥çš„ï§¤è§£ï¼Œå¹¶ä¸”ä¹Ÿèƒ½ï¥ƒæ¸…æ¥šæ€æ ·è¯„ä»·ä¸€ä¸ªå­¦ä¹ ç®—æ³•ï¼Œèƒ½å¤Ÿåˆ¤æ–­ä¸€ä¸ªç®—æ³•æ˜¯åå·®è¿˜æ˜¯æ–¹å·®æœ‰é—®é¢˜ï¼Œå› ä¸ºè¿™ä¸ªé—®é¢˜å¯¹äºï¥ƒæ¸…å¦‚ä½•æ”¹è¿›å­¦ä¹ ç®—æ³•çš„æ•ˆæœéå¸¸é‡è¦ï¼Œé«˜åå·®å’Œé«˜æ–¹å·®çš„é—®é¢˜åŸºæœ¬ä¸Šæ¥è¯´æ˜¯æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆçš„é—®é¢˜ã€‚ æˆ‘ä»¬é€šå¸¸ä¼šé€šè¿‡å°†è®­ç»ƒé›†å’Œäº¤å‰éªŒè¯é›†çš„ä»£ä»·å‡½æ•°è¯¯å·®ä¸å¤šé¡¹å¼çš„æ¬¡æ•°ç»˜åˆ¶åœ¨åŒä¸€å¼ å›¾è¡¨ä¸Šæ¥å¸®åŠ©åˆ†æï¼š é€šè¿‡è®­ç»ƒè¯¯å·®å’Œäº¤å‰éªŒè¯é›†è¯¯å·®åˆ¤æ–­åå·®å’Œæ–¹å·®é—®é¢˜ï¼Œæ€»ç»“å¦‚ä¸‹: è®­ç»ƒé›†è¯¯å·®å’Œäº¤å‰éªŒè¯é›†è¯¯å·®è¿‘ä¼¼æ—¶ï¼šåå·®/æ¬ æ‹Ÿåˆäº¤å‰éªŒè¯é›†è¯¯å·®è¿œå¤§äºè®­ç»ƒé›†è¯¯å·®æ—¶ï¼šæ–¹å·®/è¿‡æ‹Ÿåˆ æ­£åˆ™åŒ–åŠ›åº¦ä¸åå·®/æ–¹å·®åœ¨æˆ‘ä»¬åœ¨è®­ç»ƒæ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ä¸€äº›æ­£åˆ™åŒ–æ–¹æ³•æ¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚ä½†æ˜¯æˆ‘ä»¬å¯èƒ½ä¼šæ­£åˆ™åŒ–çš„ç¨‹åº¦å¤ªé«˜æˆ–å¤ªå°ï¦ºï¼Œå³æˆ‘ä»¬åœ¨é€‰æ‹©Î»çš„å€¼æ—¶ä¹Ÿéœ€è¦æ€è€ƒä¸åˆšæ‰é€‰æ‹©å¤šé¡¹å¼æ¨¡å‹æ¬¡æ•°ç±»ä¼¼çš„é—®é¢˜ã€‚ æˆ‘ä»¬é€‰æ‹©ä¸€ç³»ï¦œçš„æƒ³è¦æµ‹è¯•çš„ Î» å€¼ï¼Œé€šå¸¸æ˜¯ 0-10ä¹‹é—´çš„å‘ˆç°2å€å…³ç³»çš„å€¼ï¼ˆå¦‚ 0ï¼Œ 0.01ï¼Œ 0.01ï¼Œ 0.04ï¼Œ 0.08ï¼Œ 0.015ï¼Œ 0.032ï¼Œ 0.064ï¼Œ 1.28, 2.56, 5.12, 10å…±12ä¸ªï¼‰ã€‚ æˆ‘ä»¬åŒæ ·æŠŠæ•°æ®åˆ†ä¸ºè®­ç»ƒé›†ã€äº¤å‰éªŒè¯é›†å’Œæµ‹è¯•é›†ã€‚ é€‰æ‹©æ­£åˆ™åŒ–ç³»æ•°çš„æ–¹æ³•ä¸ºï¼š ä½¿ç”¨è®­ç»ƒé›†è®­ç»ƒå‡º12ä¸ªï¥§åŒç¨‹åº¦æ­£åˆ™åŒ–çš„æ¨¡å‹ ç”¨12ä¸ªæ¨¡å‹åˆ†åˆ«å¯¹äº¤å‰éªŒè¯é›†è®¡ç®—çš„å‡ºäº¤å‰éªŒè¯è¯¯å·® é€‰æ‹©å¾—å‡ºäº¤å‰éªŒè¯è¯¯å·®æœ€å°çš„æ¨¡å‹ è¿ç”¨æ­¥éª¤3ä¸­é€‰å‡ºæ¨¡å‹å¯¹æµ‹è¯•é›†è®¡ç®—å¾—å‡ºæ¨å¹¿è¯¯å·®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶å°†è®­ç»ƒé›†å’Œäº¤å‰éªŒè¯é›†æ¨¡å‹çš„ä»£ä»·å‡½æ•°è¯¯å·®ä¸Î»çš„å€¼ç»˜åˆ¶åœ¨ä¸€å¼ å›¾è¡¨ä¸Šï¼š å½“ Î» è¾ƒå°æ—¶ï¼Œè®­ç»ƒé›†è¯¯å·®è¾ƒå°ï¼ˆè¿‡æ‹Ÿåˆï¼‰è€Œäº¤å‰éªŒè¯é›†è¯¯å·®è¾ƒå¤§éšç€ Î» çš„å¢åŠ ï¼Œè®­ç»ƒé›†è¯¯å·®ï¥§æ–­å¢åŠ ï¼ˆæ¬ æ‹Ÿåˆï¼‰ï¼Œè€Œäº¤å‰éªŒè¯é›†è¯¯å·®åˆ™æ˜¯å…ˆå‡å°åå¢åŠ  é€šè¿‡å­¦ä¹ æ›²çº¿è¯„ä¼°åå·®å’Œæ–¹å·®å­¦ä¹ æ›²çº¿å°±æ˜¯ä¸€ç§å¾ˆå¥½çš„å·¥å…·ï¼Œæˆ‘ç»å¸¸ä½¿ç”¨å­¦ä¹ æ›²çº¿æ¥åˆ¤æ–­æŸä¸€ä¸ªå­¦ä¹ ç®—æ³•æ˜¯å¦å¤„äºåå·®ã€æ–¹å·®é—®é¢˜ã€‚å­¦ä¹ æ›²çº¿æ˜¯å­¦ä¹ ç®—æ³•çš„ä¸€ä¸ªå¾ˆå¥½çš„åˆï§¤æ£€éªŒï¼ˆsanity checkï¼‰ã€‚å­¦ä¹ æ›²çº¿æ˜¯å°†è®­ç»ƒé›†è¯¯å·®å’Œäº¤å‰éªŒè¯é›†è¯¯å·®ä½œä¸ºè®­ç»ƒé›†å®ï¦µæ•°ï¥¾ï¼ˆmï¼‰çš„å‡½æ•°ç»˜åˆ¶çš„å›¾è¡¨ã€‚ ä¾‹å¦‚ï¼š å¦‚æœæˆ‘ä»¬æœ‰100ï¨ˆæ•°æ®ï¼Œæˆ‘ä»¬ä»1ï¨ˆæ•°æ®å¼€å§‹ï¼Œé€æ¸å­¦ä¹ ï¤å¤šï¨ˆçš„æ•°æ®ã€‚æ€æƒ³æ˜¯ï¼šå½“è®­ç»ƒè¾ƒå°‘ï¨ˆæ•°æ®çš„æ—¶å€™ï¼Œè®­ç»ƒçš„æ¨¡å‹å°†èƒ½å¤Ÿéå¸¸å®Œç¾åœ°é€‚åº”è¾ƒå°‘çš„è®­ç»ƒæ•°æ®ï¼Œä½†æ˜¯è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹å´ï¥§èƒ½å¾ˆå¥½åœ°é€‚åº”äº¤å‰éªŒè¯é›†æ•°æ®æˆ–æµ‹è¯•é›†æ•°æ®ã€‚ å¦‚ä½•ï§ç”¨å­¦ä¹ æ›²çº¿è¯†åˆ«é«˜åå·®/æ¬ æ‹Ÿåˆï¼šä½œä¸ºï¦µå­ï¼Œæˆ‘ä»¬å°è¯•ç”¨ä¸€æ¡ç›´çº¿æ¥é€‚åº”ä¸‹é¢çš„æ•°æ®ï¼Œå¯ä»¥çœ‹å‡ºï¼Œæ— è®ºè®­ç»ƒé›†æœ‰å¤šä¹ˆå¤§è¯¯å·®éƒ½ï¥§ä¼šæœ‰å¤ªå¤§æ”¹è§‚ ä¹Ÿå°±æ˜¯è¯´åœ¨é«˜åå·®/æ¬ æ‹Ÿåˆçš„æƒ…å†µä¸‹ï¼Œå¢åŠ æ•°æ®åˆ°è®­ç»ƒé›†ï¥§ä¸€å®šèƒ½æœ‰å¸®åŠ©ã€‚ å¦‚ä½•ï§ç”¨å­¦ä¹ æ›²çº¿è¯†åˆ«é«˜æ–¹å·®/è¿‡æ‹Ÿåˆï¼šå‡è®¾æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªéå¸¸é«˜æ¬¡çš„å¤šé¡¹å¼æ¨¡å‹ï¼Œå¹¶ä¸”æ­£åˆ™åŒ–éå¸¸å°ï¼Œå¯ä»¥çœ‹å‡ºï¼Œå½“äº¤å‰éªŒè¯é›†è¯¯å·®è¿œå¤§äºè®­ç»ƒé›†è¯¯å·®æ—¶ï¼Œå¾€è®­ç»ƒé›†å¢åŠ ï¤å¤šæ•°æ®å¯ä»¥æé«˜æ¨¡å‹çš„æ•ˆæœã€‚ ä¹Ÿå°±æ˜¯è¯´åœ¨é«˜æ–¹å·®/è¿‡æ‹Ÿåˆçš„æƒ…å†µä¸‹ï¼Œå¢åŠ ï¤å¤šæ•°æ®åˆ°è®­ç»ƒé›†å¯èƒ½å¯ä»¥æé«˜ç®—æ³•æ•ˆæœã€‚ å­¦ä¹ æ›²çº¿çš„æ€»ç»“: å½“Jtrainå’ŒJcvéƒ½åé«˜çš„æ—¶å€™ï¼Œå¤„äºé«˜åå·®(æ¬ æ‹Ÿåˆ)çš„æƒ…å†µï¼Œæ­¤æ—¶å¢åŠ è®­ç»ƒæ•°æ®ä¸ä¼šæœ‰æ›´å¥½çš„ç»“æœ å½“Jtrainåä½è€ŒJcvåé«˜çš„æ—¶å€™ï¼Œå¤„äºé«˜æ–¹å·®(è¿‡æ‹Ÿåˆ)çš„æƒ…å†µï¼Œæ­¤æ—¶å¢åŠ è®­ç»ƒæ•°æ®å¾€å¾€ä¼šè·å¾—æ›´å¥½çš„è®­ç»ƒç»“æœ ç¥ç»ç½‘ç»œçš„æ–¹å·®å’Œåå·® ä½¿ç”¨è¾ƒå°çš„ç¥ç»ç½‘ç»œï¼Œç±»ä¼¼äºå‚æ•°è¾ƒå°‘çš„æƒ…å†µï¼Œå®¹ï§ å¯¼è‡´é«˜åå·®å’Œæ¬ æ‹Ÿåˆï¼Œä½†è®¡ç®—ä»£ä»·è¾ƒå°ä½¿ç”¨è¾ƒå¤§çš„ç¥ç»ç½‘ç»œï¼Œç±»ä¼¼äºå‚æ•°è¾ƒå¤šçš„æƒ…å†µï¼Œå®¹ï§ å¯¼è‡´é«˜æ–¹å·®å’Œè¿‡æ‹Ÿåˆï¼Œè™½ç„¶è®¡ç®—ä»£ä»·æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ­£åˆ™åŒ–æ‰‹æ®µæ¥è°ƒæ•´è€Œï¤åŠ é€‚åº”æ•°æ®ã€‚ é€šå¸¸é€‰æ‹©è¾ƒå¤§çš„ç¥ç»ç½‘ç»œå¹¶é‡‡ç”¨æ­£åˆ™åŒ–å¤„ï§¤ä¼šæ¯”é‡‡ç”¨è¾ƒå°çš„ç¥ç»ç½‘ç»œæ•ˆæœè¦å¥½ã€‚ å¯¹äºç¥ç»ç½‘ç»œä¸­çš„éšè—å±‚çš„å±‚æ•°çš„é€‰æ‹©ï¼Œé€šå¸¸ä»ä¸€å±‚å¼€å§‹é€æ¸å¢åŠ å±‚æ•°ï¼Œä¸ºï¦ºï¤å¥½åœ°ä½œé€‰æ‹©ï¼Œå¯ä»¥æŠŠæ•°æ®åˆ†ä¸ºè®­ç»ƒé›†ã€äº¤å‰éªŒè¯é›†å’Œæµ‹è¯•é›†ï¼Œé’ˆå¯¹ï¥§åŒéšè—å±‚å±‚æ•°çš„ç¥ç»ç½‘ç»œè®­ç»ƒç¥ç»ç½‘ç»œï¼Œ ç„¶åé€‰æ‹©äº¤å‰éªŒè¯é›†ä»£ä»·æœ€å°çš„ç¥ç»ç½‘ç»œã€‚ è§£å†³é«˜åå·®å’Œé«˜æ–¹å·®çš„æ€»ç»“è§£å†³é«˜æ–¹å·®é—®é¢˜: è·å¾—ï¤å¤šçš„è®­ç»ƒå®ï¦µâ€”â€”è§£å†³é«˜æ–¹å·® å°è¯•å‡å°‘ç‰¹å¾çš„æ•°ï¥¾â€”â€”è§£å†³é«˜æ–¹å·® å°è¯•å¢åŠ æ­£åˆ™åŒ–ç¨‹åº¦Î»â€”â€”è§£å†³é«˜æ–¹å·® è§£å†³é«˜åå·®çš„é—®é¢˜ å°è¯•è·å¾—ï¤å¤šçš„ç‰¹å¾â€”â€”è§£å†³é«˜åå·® å°è¯•å¢åŠ å¤šé¡¹å¼ç‰¹å¾â€”â€”è§£å†³é«˜åå·® å°è¯•å‡å°‘æ­£åˆ™åŒ–ç¨‹åº¦Î»â€”â€”è§£å†³é«˜åå·® ç±»åæ–œçš„è¯¯å·®åº¦é‡ç±»åæ–œå’ŒæŸ¥å‡†ç‡æŸ¥å…¨ç‡çš„ä»‹ç»ç±»åæ–œæƒ…å†µè¡¨ç°ä¸ºæˆ‘ä»¬çš„è®­ç»ƒé›†ä¸­æœ‰éå¸¸å¤šçš„åŒä¸€ç§ç±»çš„å®ï¦µï¼Œåªæœ‰å¾ˆå°‘æˆ–æ²¡æœ‰å…¶ä»–ç±»çš„å®ï¦µï¼Œ è¿™æ—¶å€™å¾ˆéš¾ç”¨ä¸€èˆ¬çš„è¯¯å·®åº¦é‡æ–¹æ³•æ¥åº¦é‡å…¶çœŸå®çš„è¯¯å·®ã€‚ ï¦µå¦‚æˆ‘ä»¬å¸Œæœ›ç”¨ç®—æ³•æ¥é¢„æµ‹ç™Œç—‡æ˜¯å¦æ˜¯æ¶æ€§çš„ï¼Œåœ¨æˆ‘ä»¬çš„è®­ç»ƒé›†ä¸­ï¼Œåªæœ‰0.5%çš„å®ï¦µæ˜¯æ¶æ€§è‚¿ç˜¤ã€‚å‡è®¾æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªéå­¦ä¹ è€Œæ¥çš„ç®—æ³•ï¼Œåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½é¢„æµ‹è‚¿ç˜¤æ˜¯è‰¯æ€§çš„ï¼Œé‚£ä¹ˆè¯¯å·®åªæœ‰0.5%ã€‚ç„¶è€Œæˆ‘ä»¬é€šè¿‡è®­ç»ƒè€Œå¾—åˆ°çš„ç¥ç»ç½‘ç»œç®—æ³•å´æœ‰1%çš„è¯¯å·®ã€‚è¿™æ—¶ï¼Œè¯¯å·®çš„å¤§å°æ˜¯ï¥§èƒ½è§†ä¸ºè¯„åˆ¤ç®—æ³•æ•ˆæœçš„ä¾æ®çš„ã€‚ å› ä¸ºï¼Œä¸‹é¢å°†å¼•å…¥æŸ¥å‡†ç‡å’ŒæŸ¥å…¨ç‡çš„æ¦‚å¿µã€‚ æˆ‘ä»¬å°†ç®—æ³•é¢„æµ‹çš„ç»“æœåˆ†æˆå››ç§æƒ…å†µï¼š æ­£ç¡®è‚¯å®šï¼ˆTrue Positive,TPï¼‰ï¼šé¢„æµ‹ä¸ºçœŸï¼Œå®é™…ä¸ºçœŸ æ­£ç¡®å¦å®šï¼ˆTrue Negative,TNï¼‰ï¼šé¢„æµ‹ä¸ºå‡ï¼Œå®é™…ä¸ºå‡ é”™è¯¯è‚¯å®šï¼ˆFalse Positive,FPï¼‰ï¼šé¢„æµ‹ä¸ºçœŸï¼Œå®é™…ä¸ºå‡ é”™è¯¯å¦å®šï¼ˆFalse Negative,FNï¼‰ï¼šé¢„æµ‹ä¸ºå‡ï¼Œå®é™…ä¸ºçœŸ æŸ¥å‡†ç‡ï¼ˆPrecisionï¼‰å’ŒæŸ¥å…¨ç‡ï¼ˆRecallï¼‰çš„å…¬å¼ä¸º ï¼š æŸ¥å‡†ç‡=TP/(TP+FP)ã€‚ï¦µï¼Œåœ¨æ‰€æœ‰æˆ‘ä»¬é¢„æµ‹æœ‰æ¶æ€§è‚¿ç˜¤çš„ç—…äººä¸­ï¼Œå®é™…ä¸Šæœ‰æ¶æ€§è‚¿ç˜¤çš„ç—…äººçš„ç™¾åˆ†æ¯”ï¼Œè¶Šé«˜è¶Šå¥½ã€‚ æŸ¥å…¨ç‡=TP/(TP+FN)ã€‚ï¦µï¼Œåœ¨æ‰€æœ‰å®é™…ä¸Šæœ‰æ¶æ€§è‚¿ç˜¤çš„ç—…äººä¸­ï¼ŒæˆåŠŸé¢„æµ‹æœ‰æ¶æ€§è‚¿ç˜¤çš„ç—…äººçš„ç™¾åˆ†æ¯”ï¼Œè¶Šé«˜è¶Šå¥½ã€‚ è¿™æ ·ï¼Œå¯¹äºæˆ‘ä»¬åˆšæ‰é‚£ä¸ªæ€»æ˜¯é¢„æµ‹ç—…äººè‚¿ç˜¤ä¸ºè‰¯æ€§çš„ç®—æ³•ï¼Œå…¶æŸ¥å…¨ç‡æ˜¯0ã€‚ å› æ­¤ï¼Œå¯ä»¥çœ‹å‡ºç”¨äºåº¦é‡åæ–œç±»é—®é¢˜ï¼ŒæŸ¥å‡†ç‡å’ŒæŸ¥å…¨ç‡æ›´èƒ½ä½“ç°æ¨¡å‹è¡¨ç°çš„å¥½åã€‚ æŸ¥å‡†ç‡å’ŒæŸ¥å…¨ç‡ä¹‹é—´çš„é€‰æ‹©åœ¨å¾ˆå¤šçš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä¿è¯æŸ¥å‡†ç‡å’Œå¬å›ç‡çš„ç›¸å¯¹å¹³è¡¡ã€‚ ç»§ç»­æ²¿ç”¨åˆšæ‰é¢„æµ‹è‚¿ç˜¤æ€§è´¨çš„ï¦µå­ã€‚å‡ä½¿ï¼Œæˆ‘ä»¬çš„ç®—æ³•è¾“å‡ºçš„ç»“æœåœ¨0-1 ä¹‹é—´ï¼Œæˆ‘ä»¬ä½¿ç”¨é˜€å€¼0.5 æ¥é¢„æµ‹çœŸå’Œå‡ã€‚ æŸ¥å‡†ç‡(Precision)=TP/(TP+FP) ï¦µï¼Œåœ¨æ‰€æœ‰æˆ‘ä»¬é¢„æµ‹æœ‰æ¶æ€§è‚¿ç˜¤çš„ç—…äººä¸­ï¼Œå®é™…ä¸Šæœ‰æ¶æ€§è‚¿ç˜¤çš„ç—…äººçš„ç™¾åˆ†æ¯”ï¼Œè¶Šé«˜è¶Šå¥½ã€‚ æŸ¥å…¨ç‡(Recall)=TP/(TP+FN)ï¦µï¼Œåœ¨æ‰€æœ‰å®é™…ä¸Šæœ‰æ¶æ€§è‚¿ç˜¤çš„ç—…äººä¸­ï¼ŒæˆåŠŸé¢„æµ‹æœ‰æ¶æ€§è‚¿ç˜¤çš„ç—…äººçš„ç™¾åˆ†æ¯”ï¼Œè¶Šé«˜è¶Šå¥½ã€‚ å¦‚æœæˆ‘ä»¬å¸Œæœ›åªåœ¨éå¸¸ç¡®ä¿¡çš„æƒ…å†µä¸‹é¢„æµ‹ä¸ºçœŸï¼ˆè‚¿ç˜¤ä¸ºæ¶æ€§ï¼‰ï¼Œå³æˆ‘ä»¬å¸Œæœ›ï¤é«˜çš„æŸ¥å‡†ç‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¯”0.5ï¤å¤§çš„é˜€å€¼ï¼Œå¦‚0.7ï¼Œ0.9ã€‚è¿™æ ·åšæˆ‘ä»¬ä¼šå‡å°‘é”™è¯¯é¢„æµ‹ç—…äººä¸ºæ¶æ€§è‚¿ç˜¤çš„æƒ…å†µï¼ŒåŒæ—¶å´ä¼šå¢åŠ æœªèƒ½æˆåŠŸé¢„æµ‹è‚¿ç˜¤ä¸ºæ¶æ€§çš„æƒ…å†µã€‚ å¦‚æœæˆ‘ä»¬å¸Œæœ›æé«˜æŸ¥å…¨ç‡ï¼Œå°½å¯èƒ½åœ°è®©æ‰€æœ‰æœ‰å¯èƒ½æ˜¯æ¶æ€§è‚¿ç˜¤çš„ç—…äººéƒ½å¾—åˆ°è¿›ä¸€æ­¥åœ°æ£€æŸ¥ã€è¯Šæ–­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¯”0.5ï¤å°çš„é˜€å€¼ï¼Œå¦‚0.3ã€‚ æˆ‘ä»¬å¯ä»¥å°†ï¥§åŒé˜€å€¼æƒ…å†µä¸‹ï¼ŒæŸ¥å…¨ç‡ä¸æŸ¥å‡†ç‡çš„å…³ç³»ç»˜åˆ¶æˆå›¾è¡¨ï¼Œæ›²çº¿çš„å½¢çŠ¶æ ¹æ®æ•°æ®çš„ï¥§åŒè€Œï¥§åŒï¼š æˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬é€‰æ‹©è¿™ä¸ªé˜€å€¼çš„æ–¹æ³•ã€‚ ä¸€ç§æ–¹æ³•æ˜¯è®¡ç®—F1 å€¼ï¼ˆF1 Scoreï¼‰ï¼Œå…¶è®¡ç®—å…¬å¼ä¸ºï¼š $F_1Scoreï¼š2{PR\over{P+R}}$ æˆ‘ä»¬é€‰æ‹©ä½¿å¾—F1å€¼æœ€é«˜çš„é˜€å€¼, F1çš„æƒ³æ³•å°±æ˜¯å°½é‡è®©æŸ¥å‡†ç‡å’ŒæŸ¥å…¨ç‡éƒ½ä¸ä¼šå¤ªå°ã€‚ 2.æœºå™¨å­¦ä¹ ç³»ç»Ÿçš„è®¾è®¡æœºå™¨å­¦ä¹ ç³»ç»Ÿè®¾è®¡æ€è·¯ä»¥ä¸€ä¸ªåƒåœ¾é‚®ä»¶åˆ†ç±»ï¨¸ç®—æ³•ä¸ºï¦µ ä¸ºï¦ºè§£å†³è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦åšçš„å†³å®šæ˜¯å¦‚ä½•é€‰æ‹©å¹¶è¡¨è¾¾ç‰¹å¾å‘ï¥¾ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ä¸ªç”±100ä¸ªæœ€å¸¸å‡ºç°åœ¨åƒåœ¾é‚®ä»¶ä¸­çš„è¯æ‰€æ„æˆçš„ï¦œè¡¨ï¼Œæ ¹æ®è¿™äº›è¯æ˜¯å¦æœ‰åœ¨é‚®ä»¶ä¸­å‡ºç°ï¼Œæ¥è·å¾—æˆ‘ä»¬çš„ç‰¹å¾å‘ï¥¾ï¼ˆå‡ºç°ä¸º1ï¼Œï¥§å‡ºç°ä¸º0ï¼‰ï¼Œå°ºå¯¸ä¸º100Ã—1ã€‚ ä¸ºï¦ºæ„å»ºè¿™ä¸ªåˆ†ç±»ï¨¸ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾ˆå¤šäº‹ï¼Œï¦µå¦‚ï¼š æ”¶é›†ï¤å¤šçš„æ•°æ®ï¼Œè®©æˆ‘ä»¬æœ‰ï¤å¤šçš„åƒåœ¾é‚®ä»¶å’Œéåƒåœ¾é‚®ä»¶çš„æ ·æœ¬ åŸºäºé‚®ä»¶çš„ï¤·ç”±ä¿¡æ¯å¼€å‘ä¸€ç³»ï¦œå¤æ‚çš„ç‰¹å¾ åŸºäºé‚®ä»¶çš„æ­£æ–‡ä¿¡æ¯å¼€å‘ä¸€ç³»ï¦œå¤æ‚çš„ç‰¹å¾ï¼ŒåŒ…æ‹¬è€ƒè™‘æˆªè¯çš„å¤„ï§¤ ä¸ºæ¢æµ‹åˆ»æ„çš„æ‹¼å†™é”™è¯¯ï¼ˆæŠŠwatch å†™æˆw4tchï¼‰å¼€å‘å¤æ‚çš„ç®—æ³• è¯¯å·®åˆ†æè®¾è®¡æœºå™¨å­¦ä¹ ç³»ç»Ÿçš„é¦–è¦ä»»åŠ¡ å½“è®¾è®¡ä¸€ä¸ªæ¨¡å‹çš„æ—¶å€™ï¼Œ æœ€å¥½çš„æ–¹æ³•æ˜¯å¿«é€Ÿçš„å°†æœ€ç®€å•ç‰ˆæœ¬çš„ç®—æ³•å®ç°ï¼Œä¸€æ—¦åšå®Œï¼Œä½ å¯ä»¥ç”»å‡ºå­¦ä¹ æ›²çº¿ï¼Œé€šè¿‡ç”»å‡ºå­¦ä¹ æ›²çº¿ï¼Œä»¥åŠæ£€éªŒè¯¯å·®ï¼Œæ¥æ‰¾å‡ºä½ çš„ç®—æ³•æ˜¯å¦æœ‰é«˜åå·®å’Œé«˜æ–¹å·®çš„é—®é¢˜ï¼Œæˆ–è€…åˆ«çš„é—®é¢˜ã€‚åœ¨è¿™æ ·åˆ†æä¹‹åï¼Œå†æ¥å†³å®šç”¨ï¤å¤šçš„æ•°æ®è®­ç»ƒï¼Œæˆ–è€…åŠ å…¥ï¤å¤šçš„ç‰¹å¾å˜ï¥¾æ˜¯å¦æœ‰ç”¨ã€‚ è¿™ä¹ˆåšçš„åŸå› æ˜¯ï¼šå› ä¸ºé€šå¸¸ä½ å¹¶ï¥§èƒ½æå‰çŸ¥é“ä½ æ˜¯å¦éœ€è¦å¤æ‚çš„ç‰¹å¾å˜ï¥¾ï¼Œæˆ–è€…ä½ æ˜¯å¦éœ€è¦ï¤å¤šçš„æ•°æ®ï¼Œè¿˜æ˜¯åˆ«çš„ï§½ä¹ˆã€‚æå‰çŸ¥é“ä½ åº”è¯¥åšï§½ä¹ˆï¼Œæ˜¯éå¸¸éš¾çš„ï¼Œå› ä¸ºä½ ç¼ºå°‘è¯æ®ï¼Œç¼ºå°‘å­¦ä¹ æ›²çº¿ã€‚å› æ­¤ï¼Œä½ å¾ˆéš¾çŸ¥é“ä½ åº”è¯¥æŠŠæ—¶é—´èŠ±åœ¨ï§½ä¹ˆåœ°æ–¹æ¥æé«˜ç®—æ³•çš„è¡¨ç°ã€‚ä½†æ˜¯å½“ä½ å®è·µä¸€ä¸ªéå¸¸ç®€å•å³ï¥¥ï¥§å®Œç¾çš„æ–¹æ³•æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ç”»å‡ºå­¦ä¹ æ›²çº¿æ¥åšå‡ºè¿›ä¸€æ­¥çš„é€‰æ‹©ã€‚ä½ å¯ä»¥ç”¨è¿™ç§æ–¹å¼æ¥é¿å…ä¸€ç§ç”µè„‘ç¼–ç¨‹ï§©çš„è¿‡æ—©ä¼˜åŒ–é—®é¢˜ï¼Œè¿™ç§ï§¤å¿µæ˜¯ï¼šæˆ‘ä»¬å¿…é¡»ç”¨è¯æ®æ¥é¢†å¯¼æˆ‘ä»¬çš„å†³ç­–ï¼Œæ€æ ·åˆ†é…è‡ªå·±çš„æ—¶é—´æ¥ä¼˜åŒ–ç®—æ³•ï¼Œè€Œï¥§æ˜¯ä»…ä»…å‡­ç›´è§‰ï¼Œå‡­ç›´è§‰å¾—å‡ºçš„ä¸œè¥¿ä¸€èˆ¬æ€»æ˜¯é”™è¯¯çš„ã€‚ é™¤ï¦ºç”»å‡ºå­¦ä¹ æ›²çº¿ä¹‹å¤–ï¼Œä¸€ä»¶éå¸¸æœ‰ç”¨çš„äº‹æ˜¯è¯¯å·®åˆ†æã€‚æ¯”å¦‚åœ¨æ„é€ åƒåœ¾é‚®ä»¶åˆ†ç±»ï¨¸æ—¶ï¼Œå¯ä»¥çœ‹ä¸€çœ‹æˆ‘çš„äº¤å‰éªŒè¯æ•°æ®é›†ï¼Œç„¶åäº²è‡ªçœ‹ä¸€çœ‹å“ªäº›é‚®ä»¶è¢«ç®—æ³•é”™è¯¯åœ°åˆ†ç±»ã€‚å› æ­¤ï¼Œé€šè¿‡è¿™äº›è¢«ç®—æ³•é”™è¯¯åˆ†ç±»çš„åƒåœ¾é‚®ä»¶ä¸éåƒåœ¾é‚®ä»¶ï¼Œä½ å¯ä»¥å‘ç°æŸäº›ç³»ç»Ÿæ€§çš„è§„ï§˜ï¼šï§½ä¹ˆç±»å‹çš„é‚®ä»¶æ€»æ˜¯è¢«é”™è¯¯åˆ†ç±»ã€‚ç»å¸¸åœ°è¿™æ ·åšä¹‹åï¼Œè¿™ä¸ªè¿‡ç¨‹èƒ½å¯å‘ä½ æ„é€ æ–°çš„ç‰¹å¾å˜ï¥¾ï¼Œæˆ–è€…å‘Šè¯‰ä½ ï¼šç°åœ¨è¿™ä¸ªç³»ç»Ÿçš„çŸ­å¤„ï¼Œç„¶åå¯å‘ä½ å¦‚ä½•å»æé«˜å®ƒã€‚ æ„å»ºä¸€ä¸ªå­¦ä¹ ç®—æ³•çš„æ¨èæ–¹æ³•ä¸ºï¼š ä»ä¸€ä¸ªç®€å•çš„èƒ½å¿«é€Ÿå®ç°çš„ç®—æ³•å¼€å§‹ï¼Œå®ç°è¯¥ç®—æ³•å¹¶ç”¨äº¤å‰éªŒè¯é›†æ•°æ®æµ‹è¯•è¿™ä¸ªç®—æ³• ç»˜åˆ¶å­¦ä¹ æ›²çº¿ï¼Œå†³å®šæ˜¯å¢åŠ ï¤å¤šæ•°æ®ï¼Œæˆ–è€…æ·»åŠ ï¤å¤šç‰¹å¾ï¼Œè¿˜æ˜¯å…¶ä»–é€‰æ‹© è¿›ï¨ˆè¯¯å·®åˆ†æï¼šäººå·¥æ£€æŸ¥äº¤å‰éªŒè¯é›†ä¸­æˆ‘ä»¬ç®—æ³•ä¸­äº§ç”Ÿé¢„æµ‹è¯¯å·®çš„å®ï¦µï¼Œçœ‹çœ‹è¿™äº›å®ï¦µæ˜¯å¦æœ‰æŸç§ç³»ç»ŸåŒ–çš„è¶‹åŠ¿ ä¸¾ä¸ªè¯¯å·®åˆ†æçš„æ —å­: ä»¥æˆ‘ä»¬çš„åƒåœ¾é‚®ä»¶è¿‡æ»¤ï¨¸ä¸ºï¦µï¼Œè¯¯å·®åˆ†æè¦åšçš„æ—¢æ˜¯æ£€éªŒäº¤å‰éªŒè¯é›†ä¸­æˆ‘ä»¬çš„ç®—æ³•äº§ç”Ÿé”™è¯¯é¢„æµ‹çš„æ‰€æœ‰é‚®ä»¶ï¼Œçœ‹ï¼š æ˜¯å¦èƒ½å°†è¿™äº›é‚®ä»¶æŒ‰ç…§ç±»åˆ†ç»„ã€‚ï¦µå¦‚åŒ»è¯å“åƒåœ¾é‚®ä»¶ï¼Œä»¿å†’å“åƒåœ¾é‚®ä»¶æˆ–è€…å¯†ç çªƒå–é‚®ä»¶ç­‰ã€‚ç„¶åçœ‹åˆ†ç±»ï¨¸å¯¹å“ªä¸€ç»„é‚®ä»¶çš„é¢„æµ‹è¯¯å·®æœ€å¤§ï¼Œå¹¶ç€æ‰‹ä¼˜åŒ–ã€‚ å‘ç°æ˜¯å¦ç¼ºå°‘æŸäº›ç‰¹å¾ï¼Œè®°ä¸‹è¿™äº›ç‰¹å¾å‡ºç°çš„æ¬¡æ•°ã€‚ï¦µå¦‚è®°å½•ä¸‹é”™è¯¯æ‹¼å†™å‡ºç°ï¦ºå¤šå°‘æ¬¡ï¼Œå¼‚å¸¸çš„é‚®ä»¶ï¤·ç”±æƒ…å†µå‡ºç°ï¦ºå¤šå°‘æ¬¡ç­‰ç­‰ï¼Œç„¶åä»å‡ºç°æ¬¡æ•°æœ€å¤šçš„æƒ…å†µå¼€å§‹ç€æ‰‹ä¼˜åŒ–ã€‚ è¯¯å·®åˆ†æéœ€è¦äº¤å‰éªŒè¯æ¥éªŒè¯ è¯¯å·®åˆ†æå¹¶ï¥§æ€»èƒ½å¸®åŠ©æˆ‘ä»¬åˆ¤æ–­åº”è¯¥é‡‡å–æ€æ ·çš„ï¨ˆåŠ¨ã€‚æœ‰æ—¶æˆ‘ä»¬éœ€è¦å°è¯•ï¥§åŒçš„æ¨¡å‹ï¼Œç„¶åè¿›ï¨ˆæ¯”è¾ƒï¼Œåœ¨æ¨¡å‹æ¯”è¾ƒæ—¶ï¼Œç”¨æ•°å€¼æ¥åˆ¤æ–­å“ªä¸€ä¸ªæ¨¡å‹ï¤å¥½ï¤æœ‰æ•ˆï¼Œé€šå¸¸æˆ‘ä»¬æ˜¯çœ‹äº¤å‰éªŒè¯é›†çš„è¯¯å·®ã€‚ åœ¨æˆ‘ä»¬çš„åƒåœ¾é‚®ä»¶åˆ†ç±»ï¨¸ï¦µå­ä¸­ï¼Œå¯¹äºâ€œæˆ‘ä»¬æ˜¯å¦åº”è¯¥å°†discount/discounts/discounted/discountingå¤„ï§¤æˆåŒä¸€ä¸ªè¯ï¼Ÿâ€å¦‚æœè¿™æ ·åšå¯ä»¥æ”¹å–„æˆ‘ä»¬ç®—æ³•ï¼Œæˆ‘ä»¬ä¼šé‡‡ç”¨ä¸€äº›æˆªè¯è½¯ä»¶ã€‚è¯¯å·®åˆ†æï¥§èƒ½å¸®åŠ©æˆ‘ä»¬åšå‡ºè¿™ç±»åˆ¤æ–­ï¼Œæˆ‘ä»¬åªèƒ½å°è¯•é‡‡ç”¨å’Œï¥§é‡‡ç”¨æˆªè¯è½¯ä»¶è¿™ä¸¤ç§ï¥§åŒæ–¹æ¡ˆï¼Œç„¶åæ ¹æ®æ•°å€¼æ£€éªŒçš„ç»“æœæ¥åˆ¤æ–­å“ªä¸€ç§ï¤å¥½ã€‚ ä¸è¦ç”¨æµ‹è¯•é›†æ¥åšäº¤å‰éªŒè¯ å› æ­¤ï¼Œå½“ä½ åœ¨æ„é€ å­¦ä¹ ç®—æ³•çš„æ—¶å€™ï¼Œä½ æ€»æ˜¯ä¼šå»å°è¯•å¾ˆå¤šæ–°çš„æƒ³æ³•ï¼Œå®ç°å‡ºå¾ˆå¤šç‰ˆæœ¬çš„å­¦ä¹ ç®—æ³•ï¼Œå¦‚æœæ¯ä¸€æ¬¡ä½ å®è·µæ–°æƒ³æ³•çš„æ—¶å€™ï¼Œä½ éƒ½è¦æ‰‹åŠ¨åœ°æ£€æµ‹è¿™äº›ï¦µå­ï¼Œå»çœ‹çœ‹æ˜¯è¡¨ç°å·®è¿˜æ˜¯è¡¨ç°å¥½ï¼Œé‚£ä¹ˆè¿™å¾ˆéš¾è®©ä½ åšå‡ºå†³å®šã€‚åˆ°åº•æ˜¯å¦ä½¿ç”¨è¯å¹²æå–ï¼Œæ˜¯å¦åŒºåˆ†å¤§å°å†™ã€‚ä½†æ˜¯é€šè¿‡ä¸€ä¸ªï¥¾åŒ–çš„æ•°å€¼è¯„ä¼°ï¼Œä½ å¯ä»¥çœ‹çœ‹è¿™ä¸ªæ•°å­—ï¼Œè¯¯å·®æ˜¯å˜å¤§è¿˜æ˜¯å˜å°ï¦ºã€‚ä½ å¯ä»¥é€šè¿‡å®ƒï¤å¿«åœ°å®è·µä½ çš„æ–°æƒ³æ³•ï¼Œå®ƒåŸºæœ¬ä¸Šéå¸¸ç›´è§‚åœ°å‘Šè¯‰ä½ ï¼šä½ çš„æƒ³æ³•æ˜¯æé«˜ï¦ºç®—æ³•è¡¨ç°ï¼Œè¿˜æ˜¯è®©å®ƒå˜å¾—ï¤åï¼Œè¿™ä¼šå¤§å¤§æé«˜ä½ å®è·µç®—æ³•æ—¶çš„é€Ÿåº¦ã€‚æ‰€ä»¥æˆ‘å¼ºï¦Ÿæ¨èåœ¨äº¤å‰éªŒè¯é›†ä¸Šæ¥å®æ–½è¯¯å·®åˆ†æï¼Œè€Œï¥§æ˜¯åœ¨æµ‹è¯•é›†ä¸Šã€‚ä½†æ˜¯ï¼Œè¿˜æ˜¯æœ‰ä¸€äº›äººä¼šåœ¨æµ‹è¯•é›†ä¸Šæ¥åšè¯¯å·®åˆ†æã€‚å³ä½¿è¿™ä»æ•°å­¦ä¸Šè®²æ˜¯ï¥§åˆé€‚çš„ã€‚æ‰€ä»¥æˆ‘è¿˜æ˜¯æ¨èä½ åœ¨äº¤å‰éªŒè¯å‘ï¥¾ä¸Šæ¥åšè¯¯å·®åˆ†æã€‚ æ€»ç»“: å½“ä½ åœ¨ç ”ç©¶ä¸€ä¸ªæ–°çš„æœºï¨¸å­¦ä¹ é—®é¢˜æ—¶ï¼Œæ¨èä½ å®ç°ä¸€ä¸ªè¾ƒä¸ºç®€å•å¿«é€Ÿã€å³ï¥¥ï¥§æ˜¯é‚£ä¹ˆå®Œç¾çš„ç®—æ³•ã€‚ç›®å‰å¤§å®¶ç»å¸¸å¹²çš„äº‹æƒ…æ˜¯ï¼šèŠ±è´¹å¤§ï¥¾çš„æ—¶é—´åœ¨æ„é€ ç®—æ³•ä¸Šï¼Œæ„é€ ä»–ä»¬ä»¥ä¸ºçš„ç®€å•çš„æ–¹æ³•ã€‚å› æ­¤ï¼Œï¥§è¦æ‹…å¿ƒä½ çš„ç®—æ³•å¤ªç®€å•ï¼Œæˆ–è€…å¤ªï¥§å®Œç¾ï¼Œè€Œæ˜¯å°½å¯èƒ½å¿«åœ°å®ç°ä½ çš„ç®—æ³•ã€‚å½“ä½ æœ‰ï¦ºåˆå§‹çš„å®ç°ä¹‹åï¼Œå®ƒä¼šå˜æˆä¸€ä¸ªéå¸¸æœ‰ï¦Šçš„å·¥å…·ï¼Œæ¥å¸®åŠ©ä½ å†³å®šä¸‹ä¸€æ­¥çš„åšæ³•ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹ç®—æ³•é€ æˆçš„é”™è¯¯ï¼Œé€šè¿‡è¯¯å·®åˆ†æï¼Œæ¥çœ‹çœ‹ä»–çŠ¯ï¦ºï§½ä¹ˆé”™ï¼Œç„¶åæ¥å†³å®šä¼˜åŒ–çš„æ–¹å¼ã€‚ å¦ä¸€ä»¶äº‹æ˜¯ï¼šå‡è®¾ä½ æœ‰ï¦ºä¸€ä¸ªå¿«é€Ÿè€Œï¥§å®Œç¾çš„ç®—æ³•å®ç°ï¼Œåˆæœ‰ä¸€ä¸ªæ•°å€¼çš„è¯„ä¼°æ•°æ®ï¼Œè¿™ä¼šå¸®åŠ©ä½ å°è¯•æ–°çš„æƒ³æ³•ï¼Œå¿«é€Ÿåœ°å‘ç°ä½ å°è¯•çš„è¿™äº›æƒ³æ³•æ˜¯å¦èƒ½å¤Ÿæé«˜ç®—æ³•çš„è¡¨ç°ï¼Œä»è€Œä½ ä¼šï¤å¿«åœ°åšå‡ºå†³å®šï¼Œåœ¨ç®—æ³•ä¸­æ”¾å¼ƒï§½ä¹ˆï¼Œå¸æ”¶ï§½ä¹ˆè¯¯å·®åˆ†æå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç³»ç»ŸåŒ–åœ°é€‰æ‹©è¯¥åšï§½ä¹ˆã€‚]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>è®¾è®¡è¿‡ç¨‹</tag>
        <tag>æ¨¡å‹è¯„ä¼°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kerasæ„å»ºç®€å•ç¥ç»ç½‘ç»œ]]></title>
    <url>%2F2018%2F11%2F11%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%2Fkeras%E6%9E%84%E5%BB%BA%E7%AE%80%E5%8D%95%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%2F</url>
    <content type="text"><![CDATA[Keras æ„å»ºç¥ç»ç½‘ç»œè¯¥ç¤ºä¾‹çš„ä¸€èˆ¬æµç¨‹æ˜¯é¦–å…ˆåŠ è½½æ•°æ®ï¼Œç„¶åå®šä¹‰ç½‘ç»œï¼Œæœ€åè®­ç»ƒç½‘ç»œã€‚ è¦ä½¿ç”¨ Kerasï¼Œä½ éœ€è¦çŸ¥é“ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚ åˆ›å»ºç¥ç»ç½‘ç»œåºåˆ—æ¨¡å‹123from keras.models import Sequential # Create the Sequential model model = Sequential() keras.models.Sequential ç±»æ˜¯ç¥ç»ç½‘ç»œæ¨¡å‹çš„å°è£…å®¹å™¨ã€‚å®ƒä¼šæä¾›å¸¸è§çš„å‡½æ•°ï¼Œä¾‹å¦‚ fit()ã€evaluate() å’Œ compile()ã€‚æˆ‘ä»¬å°†ä»‹ç»è¿™äº›å‡½æ•°ï¼ˆåœ¨ç¢°åˆ°è¿™äº›å‡½æ•°çš„æ—¶å€™ï¼‰ã€‚æˆ‘ä»¬å¼€å§‹ç ”ç©¶æ¨¡å‹çš„å±‚çº§å§ã€‚ å±‚çº§Keras å±‚çº§å°±åƒç¥ç»ç½‘ç»œå±‚çº§ã€‚æœ‰å®Œå…¨è¿æ¥çš„å±‚çº§ã€æœ€å¤§æ± åŒ–å±‚çº§å’Œæ¿€æ´»å±‚çº§ã€‚ä½ å¯ä»¥ä½¿ç”¨æ¨¡å‹çš„ add() å‡½æ•°æ·»åŠ å±‚çº§ã€‚ä¾‹å¦‚ï¼Œç®€å•çš„æ¨¡å‹å¯ä»¥å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314from keras.models import Sequentialfrom keras.layers.core import Dense, Activation, Flatten #åˆ›å»ºåºåˆ—æ¨¡å‹ model = Sequential() #ç¬¬ä¸€å±‚çº§ - æ·»åŠ æœ‰ 32 ä¸ªèŠ‚ç‚¹çš„è¾“å…¥å±‚ model.add(Dense, input_dim=32) #ç¬¬äºŒå±‚çº§ - æ·»åŠ æœ‰ 128 ä¸ªèŠ‚ç‚¹çš„å®Œå…¨è¿æ¥å±‚çº§ model.add(Dense(128)) #ç¬¬ä¸‰å±‚çº§ - æ·»åŠ  softmax æ¿€æ´»å±‚çº§ model.add(Activation('softmax')) #ç¬¬å››å±‚çº§ - æ·»åŠ å®Œå…¨è¿æ¥çš„å±‚çº§ model.add(Dense(10)) #ç¬¬äº”å±‚çº§ - æ·»åŠ  Sigmoid æ¿€æ´»å±‚çº§ model.add(Activation('sigmoid')) Keras å°†æ ¹æ®ç¬¬ä¸€å±‚çº§è‡ªåŠ¨æ¨æ–­åç»­æ‰€æœ‰å±‚çº§çš„å½¢çŠ¶ã€‚è¿™æ„å‘³ç€ï¼Œä½ åªéœ€ä¸ºç¬¬ä¸€å±‚çº§è®¾ç½®è¾“å…¥ç»´åº¦ã€‚ ä¸Šé¢çš„ç¬¬ä¸€å±‚çº§ model.add(Flatten(input_dim=32)) å°†ç»´åº¦è®¾ä¸º 32ï¼ˆè¡¨ç¤ºæ•°æ®æ¥è‡ª 32 ç»´ç©ºé—´ï¼‰ã€‚ç¬¬äºŒå±‚çº§è·å–ç¬¬ä¸€å±‚çº§çš„è¾“å‡ºï¼Œå¹¶å°†è¾“å‡ºç»´åº¦è®¾ä¸º 128 ä¸ªèŠ‚ç‚¹ã€‚è¿™ç§å°†è¾“å‡ºä¼ é€’ç»™ä¸‹ä¸€å±‚çº§çš„é“¾ç»§ç»­ä¸‹å»ï¼Œç›´åˆ°æœ€åä¸€ä¸ªå±‚çº§ï¼ˆå³æ¨¡å‹çš„è¾“å‡ºï¼‰ã€‚å¯ä»¥çœ‹å‡ºè¾“å‡ºç»´åº¦æ˜¯ 10ã€‚ æ¨¡å‹ç¼–è¯‘å’Œè®­ç»ƒæ„å»ºå¥½æ¨¡å‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤å¯¹å…¶è¿›è¡Œç¼–è¯‘ã€‚æˆ‘ä»¬å°†æŸå¤±å‡½æ•°æŒ‡å®šä¸ºæˆ‘ä»¬ä¸€ç›´å¤„ç†çš„ categorical_crossentropyã€‚æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šä¼˜åŒ–ç¨‹åºï¼Œæš‚æ—¶å°†ä½¿ç”¨ adamã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šè¯„ä¼°æ¨¡å‹ç”¨åˆ°çš„æŒ‡æ ‡ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å‡†ç¡®ç‡ã€‚ 1model.compile(loss=&quot;categorical_crossentropy&quot;, optimizer=&quot;adam&quot;, metrics = [&apos;accuracy&apos;]) æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹æ¨¡å‹æ¶æ„ï¼š model.summary() ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯¹å…¶è¿›è¡Œæ‹Ÿåˆï¼ŒæŒ‡å®š epoch æ¬¡æ•°å’Œæˆ‘ä»¬å¸Œæœ›åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„ä¿¡æ¯è¯¦ç»†ç¨‹åº¦ã€‚ model.fit(X, y, nb_epoch=1000, verbose=0) æ³¨æ„ï¼šåœ¨ Keras 1 ä¸­ï¼Œnb_epoch ä¼šè®¾ç½® epoch æ¬¡æ•°ï¼Œä½†æ˜¯åœ¨ Keras 2 ä¸­ï¼Œå˜æˆäº† epochsã€‚ æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¯„ä¼°æ¨¡å‹ï¼š model.evaluate() å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬å®è·µæ“ä½œä¸‹ã€‚ ç»ƒä¹ æˆ‘ä»¬ä»æœ€ç®€å•çš„ç¤ºä¾‹å¼€å§‹ã€‚åœ¨æ­¤æµ‹éªŒä¸­ï¼Œä½ å°†æ„å»ºä¸€ä¸ªç®€å•çš„å¤šå±‚å‰å‘åé¦ˆç¥ç»ç½‘ç»œä»¥è§£å†³ XOR é—®é¢˜ã€‚ å°†ç¬¬ä¸€å±‚çº§è®¾ä¸º Flatten() å±‚çº§ï¼Œå¹¶å°† input_dim è®¾ä¸º 2ã€‚ å°†ç¬¬äºŒå±‚çº§è®¾ä¸º Dense() å±‚çº§ï¼Œå¹¶å°†è¾“å‡ºå®½åº¦è®¾ä¸º 8ã€‚ åœ¨ç¬¬äºŒå±‚çº§ä¹‹åä½¿ç”¨ softmax æ¿€æ´»å‡½æ•°ã€‚ å°†è¾“å‡ºå±‚çº§å®½åº¦è®¾ä¸º 2ï¼Œå› ä¸ºè¾“å‡ºåªæœ‰ 2 ä¸ªç±»åˆ«ã€‚ åœ¨è¾“å‡ºå±‚çº§ä¹‹åä½¿ç”¨ softmax æ¿€æ´»å‡½æ•°ã€‚ å¯¹æ¨¡å‹è¿è¡Œ 10 ä¸ª epochã€‚ å‡†ç¡®åº¦åº”è¯¥ä¸º 50%ã€‚å¯ä»¥æ¥å—ï¼Œå½“ç„¶è‚¯å®šä¸æ˜¯å¤ªç†æƒ³ï¼åœ¨ 4 ä¸ªç‚¹ä¸­ï¼Œåªæœ‰ 2 ä¸ªç‚¹åˆ†ç±»æ­£ç¡®ï¼Ÿæˆ‘ä»¬è¯•ç€ä¿®æ”¹æŸäº›å‚æ•°ï¼Œä»¥æ”¹å˜è¿™ä¸€çŠ¶å†µã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¢åŠ  epoch æ¬¡æ•°ã€‚å¦‚æœå‡†ç¡®ç‡è¾¾åˆ° 75%ï¼Œä½ å°†é€šè¿‡è¿™é“æµ‹éªŒã€‚èƒ½å°è¯•è¾¾åˆ° 100% å—ï¼Ÿ é¦–å…ˆï¼ŒæŸ¥çœ‹å…³äºæ¨¡å‹å’Œå±‚çº§çš„ Keras æ–‡æ¡£ã€‚ Keras å¤šå±‚æ„ŸçŸ¥å™¨ç½‘ç»œç¤ºä¾‹å’Œä½ è¦æ„å»ºçš„ç±»ä¼¼ã€‚è¯·å°†è¯¥ç¤ºä¾‹å½“åšæŒ‡å—ï¼Œä½†æ˜¯æ³¨æ„æœ‰å¾ˆå¤šä¸åŒä¹‹å¤„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041import numpy as npfrom keras.utils import np_utilsimport tensorflow as tftf.python.control_flow_ops = tf# Set random seednp.random.seed(42)# Our dataX = np.array([[0,0],[0,1],[1,0],[1,1]]).astype('float32')y = np.array([[0],[1],[1],[0]]).astype('float32')# Initial Setup for Kerasfrom keras.models import Sequentialfrom keras.layers.core import Dense, Activation, Flatten# One-hot encoding the outputy = np_utils.to_categorical(y)# Building the modelxor = Sequential()xor.add(Dense(32, input_dim=2))xor.add(Activation("sigmoid"))xor.add(Dense(2))xor.add(Activation("sigmoid"))xor.compile(loss="categorical_crossentropy", optimizer="adam", metrics = ['accuracy'])# Uncomment this line to print the model architecture# xor.summary()# Fitting the modelhistory = xor.fit(X, y, nb_epoch=100, verbose=0)# Scoring the modelscore = xor.evaluate(X, y)print("\nAccuracy: ", score[-1])# Checking the predictionsprint("\nPredictions:")print(xor.predict_proba(X)) ç»“æœï¼š 123456789Using TensorFlow backend.4/4 [==============================] - 0sAccuracy: 0.75Predictions:4/4 [==============================] - 0s[[0.6914389 0.6965836 ] [0.7073754 0.7086655 ] [0.6919555 0.68419015] [0.70766294 0.6967294 ]]]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ·±åº¦å­¦ä¹ </tag>
        <tag>ç¥ç»ç½‘ç»œ</tag>
        <tag>keras</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¥ç»ç½‘ç»œ]]></title>
    <url>%2F2018%2F11%2F07%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%2F%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%2F</url>
    <content type="text"><![CDATA[1.éçº¿æ€§å‡è®¾å½“æˆ‘ä»¬ä½¿ç”¨çº¿å‹å›å½’æˆ–è€…é€»è¾‘å›å½’çš„æ—¶å€™ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªç¼ºç‚¹ï¼Œå½“ç‰¹å¾å¤ªå¤šçš„æ—¶å€™ï¼Œè®¡ç®—çš„è´Ÿè·ä¼šéå¸¸å¤§ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­: å½“æˆ‘ä»¬ä½¿ç”¨ x1, x2çš„å¤šæ¬¡é¡¹å¼è¿›ï¨ˆé¢„æµ‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨çš„å¾ˆå¥½ã€‚ ä½¿ç”¨éçº¿æ€§çš„å¤šé¡¹å¼é¡¹ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å»ºç«‹ï¤å¥½çš„åˆ†ç±»æ¨¡å‹ã€‚å‡è®¾æˆ‘ä»¬æœ‰éå¸¸å¤šçš„ç‰¹å¾ï¼Œï¦µå¦‚å¤§äº100ä¸ªå˜ï¥¾ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨è¿™100ä¸ªç‰¹å¾æ¥æ„å»ºä¸€ä¸ªéçº¿æ€§çš„å¤šé¡¹å¼æ¨¡å‹ï¼Œç»“æœå°†æ˜¯æ•°ï¥¾éå¸¸æƒŠäººçš„ç‰¹å¾ç»„åˆï¼Œå³ï¥¥æˆ‘ä»¬åªé‡‡ç”¨ä¸¤ä¸¤ç‰¹å¾çš„ç»„åˆï¼ˆx1x2 + x1x3 + x1x4 + â€¦. + x99x100ï¼‰ï¼Œï¼Œæˆ‘ä»¬ä¹Ÿä¼šæœ‰æ¥è¿‘5000ä¸ªç»„åˆè€Œæˆçš„ç‰¹å¾ã€‚è¿™å¯¹äºä¸€èˆ¬çš„é€»è¾‘å›å½’æ¥è¯´éœ€è¦è®¡ç®—çš„ç‰¹å¾å¤ªå¤šï¦ºã€‚ å‡è®¾æˆ‘ä»¬å¸Œæœ›è®­ç»ƒä¸€ä¸ªæ¨¡å‹æ¥è¯†åˆ«è§†è§‰å¯¹è±¡ï¼ˆï¦µå¦‚è¯†åˆ«ä¸€å¼ å›¾ç‰‡ä¸Šæ˜¯å¦æ˜¯ä¸€è¾†æ±½è½¦ï¼‰ï¼Œæˆ‘ä»¬æ€æ ·æ‰èƒ½è¿™ä¹ˆåšå‘¢ï¼Ÿä¸€ç§æ–¹æ³•æ˜¯æˆ‘ä»¬ï§ç”¨å¾ˆå¤šæ±½è½¦çš„å›¾ç‰‡å’Œå¾ˆå¤šéæ±½è½¦çš„å›¾ç‰‡ï¼Œç„¶åï§ç”¨è¿™äº›å›¾ç‰‡ä¸Šä¸€ä¸ªä¸ªåƒç´ çš„å€¼ï¼ˆé¥±å’Œåº¦æˆ–äº®åº¦ï¼‰æ¥ä½œä¸ºç‰¹å¾ã€‚å‡å¦‚æˆ‘ä»¬åªé€‰ç”¨ç°åº¦å›¾ç‰‡ï¼Œæ¯ä¸ªåƒç´ åˆ™åªæœ‰ä¸€ä¸ªå€¼ï¼ˆè€Œé RGBå€¼ï¼‰ï¼Œä½œä¸ºå‡è®¾ï¼Œæˆ‘ä»¬å¯ä»¥é€‰å–å›¾ç‰‡ä¸Šçš„ä¸¤ä¸ªï¥§åŒä½ç½®ä¸Šçš„ä¸¤ä¸ªåƒç´ ï¼Œç„¶åè®­ç»ƒä¸€ä¸ªé€»è¾‘å›å½’ç®—æ³•ï§ç”¨è¿™ä¸¤ä¸ªåƒç´ çš„å€¼æ¥åˆ¤æ–­å›¾ç‰‡ä¸Šæ˜¯å¦æ˜¯æ±½è½¦ï¼Œ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å‡ä½¿æˆ‘ä»¬é‡‡ç”¨çš„éƒ½æ˜¯50x50åƒç´ çš„å°å›¾ç‰‡ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†æ‰€æœ‰çš„åƒç´ è§†ä¸ºç‰¹å¾ï¼Œåˆ™ä¼šæœ‰ 2500ä¸ªç‰¹å¾ï¼Œå¦‚æœæˆ‘ä»¬è¦è¿›ä¸€æ­¥å°†ä¸¤ä¸¤ç‰¹å¾ç»„åˆæ„æˆä¸€ä¸ªå¤šé¡¹å¼æ¨¡å‹ï¼Œåˆ™ä¼šæœ‰çº¦3ç™¾ä¸‡ä¸ªç‰¹å¾ã€‚æ™®é€šçš„é€»è¾‘å›å½’æ¨¡å‹ï¼Œï¥§èƒ½æœ‰æ•ˆåœ°å¤„ï§¤è¿™ä¹ˆå¤šçš„ç‰¹å¾ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦ç¥ç»ç½‘ç»œã€‚ 2.ç¥ç»å…ƒå’Œå¤§è„‘ä»‹ç»2 ç¥ç»ç½‘ç»œæ˜¯ä¸€ç§å¾ˆå¤ï¤´çš„ç®—æ³•ï¼Œå®ƒæœ€åˆäº§ç”Ÿçš„ç›®çš„æ˜¯åˆ¶é€ èƒ½æ¨¡æ‹Ÿå¤§è„‘çš„æœºï¨¸ã€‚ ç¥ç»ç½‘ç»œé€æ¸å…´èµ·äºäºŒåä¸–çºªå…«ä¹åï¦ä»£ï¼Œåº”ç”¨å¾—éå¸¸å¹¿æ³›ã€‚ä½†ç”±äºå„ç§åŸå› ï¼Œåœ¨90ï¦ä»£çš„åæœŸåº”ç”¨å‡å°‘ï¦ºã€‚ä½†æ˜¯æœ€è¿‘ï¼Œç¥ç»ç½‘ç»œåˆä¸œå±±å†èµ·ï¦ºã€‚å…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯ï¼šç¥ç»ç½‘ç»œæ˜¯è®¡ç®—ï¥¾æœ‰äº›åå¤§çš„ç®—æ³•ã€‚ç„¶è€Œå¤§æ¦‚ç”±äºè¿‘äº›ï¦è®¡ç®—æœºçš„è¿ï¨ˆé€Ÿåº¦å˜å¿«ï¼Œæ‰è¶³ä»¥çœŸæ­£è¿ï¨ˆèµ·å¤§è§„æ¨¡çš„ç¥ç»ç½‘ç»œã€‚æ­£æ˜¯ç”±äºè¿™ä¸ªåŸå› å’Œå…¶ä»–ä¸€äº›æˆ‘ä»¬åé¢ä¼šè®¨è®ºåˆ°çš„æŠ€æœ¯å› ç´ ï¼Œå¦‚ä»Šçš„ç¥ç»ç½‘ç»œå¯¹äºè®¸å¤šåº”ç”¨æ¥è¯´æ˜¯æœ€å…ˆè¿›çš„æŠ€æœ¯ã€‚å½“ä½ æƒ³æ¨¡æ‹Ÿå¤§è„‘æ—¶ï¼Œæ˜¯æŒ‡æƒ³åˆ¶é€ å‡ºä¸äººç±»å¤§è„‘ä½œç”¨æ•ˆæœç›¸åŒçš„æœºï¨¸ã€‚å¤§è„‘å¯ä»¥å­¦ä¼šå»ä»¥çœ‹è€Œï¥§æ˜¯å¬çš„æ–¹å¼å¤„ï§¤å›¾åƒï¼Œå­¦ä¼šå¤„ï§¤æˆ‘ä»¬çš„è§¦è§‰ã€‚æˆ‘ä»¬èƒ½å­¦ä¹ æ•°å­¦ï¼Œå­¦ç€åšå¾®ç§¯åˆ†ï¼Œè€Œä¸”å¤§è„‘èƒ½å¤„ï§¤å„ç§ï¥§åŒçš„ä»¤äººæƒŠå¥‡çš„äº‹æƒ…ã€‚ä¼¼ä¹å¦‚æœä½ æƒ³è¦æ¨¡ä»¿å®ƒï¼Œä½ å¾—å†™å¾ˆå¤šï¥§åŒçš„è½¯ä»¶æ¥æ¨¡æ‹Ÿæ‰€æœ‰è¿™äº›äº”èŠ±å…«é—¨çš„å¥‡å¦™çš„äº‹æƒ…ã€‚ï¥§è¿‡èƒ½ï¥§èƒ½å‡è®¾å¤§è„‘åšæ‰€æœ‰è¿™äº›ï¼Œï¥§åŒäº‹æƒ…çš„æ–¹æ³•ï¼Œï¥§éœ€è¦ç”¨ä¸Šåƒä¸ªï¥§åŒçš„ç¨‹åºå»å®ç°ã€‚ç›¸åçš„ï¼Œå¤§è„‘å¤„ï§¤çš„æ–¹æ³•ï¼Œåªéœ€è¦ä¸€ä¸ªå•ä¸€çš„å­¦ä¹ ç®—æ³•å°±å¯ä»¥ï¦ºï¼Ÿå°½ç®¡è¿™åªæ˜¯ä¸€ä¸ªå‡è®¾ï¼Œï¥§è¿‡è®©æˆ‘å’Œä½ åˆ†äº«ï¼Œä¸€äº›è¿™æ–¹é¢çš„è¯æ®ã€‚ å¤§è„‘çš„è¿™ä¸€éƒ¨åˆ†è¿™ä¸€å°ç‰‡çº¢è‰²åŒºåŸŸæ˜¯ä½ çš„å¬è§‰çš®å±‚ï¼Œä½ ç°åœ¨æ­£åœ¨ï§¤è§£æˆ‘çš„è¯ï¼Œè¿™é çš„æ˜¯è€³æœµã€‚è€³æœµæ¥æ”¶åˆ°å£°éŸ³ä¿¡å·ï¼Œå¹¶æŠŠå£°éŸ³ä¿¡å·ä¼ é€’ç»™ä½ çš„å¬è§‰çš®å±‚ï¼Œæ­£å› å¦‚æ­¤ï¼Œä½ æ‰èƒ½æ˜ç™½æˆ‘çš„è¯ã€‚ç¥ç»ç³»ç»Ÿç§‘å­¦å®¶åšï¦ºä¸‹é¢è¿™ä¸ªæœ‰è¶£çš„å®éªŒï¼ŒæŠŠè€³æœµåˆ°å¬è§‰çš®å±‚çš„ç¥ç»åˆ‡æ–­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†å…¶é‡æ–°æ¥åˆ°ä¸€ä¸ªåŠ¨ç‰©çš„å¤§è„‘ä¸Šï¼Œè¿™æ ·ä»çœ¼ç›åˆ°è§†ç¥ç»çš„ä¿¡å·æœ€ç»ˆå°†ä¼ åˆ°å¬è§‰çš®å±‚ã€‚å¦‚æœè¿™æ ·åšï¦ºã€‚é‚£ä¹ˆç»“æœè¡¨æ˜å¬è§‰çš®å±‚å°†ä¼šå­¦ä¼šâ€œçœ‹â€ã€‚è¿™ï§©çš„â€œçœ‹â€ä»£è¡¨ï¦ºæˆ‘ä»¬æ‰€çŸ¥é“çš„æ¯å±‚å«ä¹‰ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ å¯¹åŠ¨ç‰©è¿™æ ·åšï¼Œé‚£ä¹ˆåŠ¨ç‰©å°±å¯ä»¥å®Œæˆè§†è§‰è¾¨åˆ«ä»»åŠ¡ï¼Œå®ƒä»¬å¯ä»¥çœ‹å›¾åƒï¼Œå¹¶æ ¹æ®å›¾åƒåšå‡ºé€‚å½“çš„å†³å®šã€‚å®ƒä»¬æ­£æ˜¯é€šè¿‡è„‘ç»„ç»‡ä¸­çš„è¿™ä¸ªéƒ¨åˆ†å®Œæˆçš„ã€‚ ä¸‹é¢å†ä¸¾å¦ä¸€ä¸ªï¦µå­ï¼Œè¿™å—çº¢è‰²çš„è„‘ç»„ç»‡æ˜¯ä½ çš„èº¯ä½“æ„Ÿè§‰çš®å±‚ï¼Œè¿™æ˜¯ä½ ç”¨æ¥å¤„ï§¤è§¦è§‰çš„ï¼Œå¦‚æœä½ åšä¸€ä¸ªå’Œåˆšæ‰ç±»ä¼¼çš„é‡æ¥å®éªŒï¼Œé‚£ä¹ˆèº¯ä½“æ„Ÿè§‰çš®å±‚ä¹Ÿèƒ½å­¦ä¼šâ€œçœ‹â€ã€‚è¿™ä¸ªå®éªŒå’Œå…¶å®ƒä¸€äº›ç±»ä¼¼çš„å®éªŒï¼Œè¢«ç§°ä¸ºç¥ç»é‡æ¥å®éªŒï¼Œä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œå¦‚æœäººä½“æœ‰åŒä¸€å—è„‘ç»„ç»‡å¯ä»¥å¤„ï§¤å…‰ã€å£°æˆ–è§¦è§‰ä¿¡å·ï¼Œé‚£ä¹ˆä¹Ÿè®¸å­˜åœ¨ä¸€ç§å­¦ä¹ ç®—æ³•ï¼Œå¯ä»¥åŒæ—¶å¤„ï§¤è§†è§‰ã€å¬è§‰å’Œè§¦è§‰ï¼Œè€Œï¥§æ˜¯éœ€è¦è¿ï¨ˆä¸Šåƒä¸ªï¥§åŒçš„ç¨‹åºï¼Œæˆ–è€…ä¸Šåƒä¸ªï¥§åŒçš„ç®—æ³•æ¥åšè¿™äº›å¤§è„‘æ‰€å®Œæˆçš„æˆåƒä¸Šä¸‡çš„ç¾å¥½äº‹æƒ…ã€‚ä¹Ÿè®¸æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ‰¾å‡ºä¸€äº›è¿‘ä¼¼çš„æˆ–å®é™…çš„å¤§è„‘å­¦ä¹ ç®—æ³•ï¼Œç„¶åå®ç°å®ƒå¤§è„‘é€šè¿‡è‡ªå­¦æŒæ¡å¦‚ä½•å¤„ï§¤è¿™äº›ï¥§åŒç±»å‹çš„æ•°æ®ã€‚åœ¨å¾ˆå¤§çš„ç¨‹åº¦ä¸Šï¼Œå¯ä»¥çŒœæƒ³å¦‚æœæˆ‘ä»¬æŠŠå‡ ä¹ä»»ä½•ä¸€ç§ä¼ æ„Ÿï¨¸æ¥å…¥åˆ°å¤§è„‘çš„å‡ ä¹ä»»ä½•ä¸€ä¸ªéƒ¨ä½çš„è¯ï¼Œå¤§è„‘å°±ä¼šå­¦ä¼šå¤„ï§¤å®ƒã€‚ä¸¾å‡ ä¸ªï¦µå­ï¼š è¿™å¼ å›¾æ˜¯ç”¨èˆŒå¤´å­¦ä¼šâ€œçœ‹â€çš„ä¸€ä¸ªï¦µå­ã€‚å®ƒçš„åŸï§¤æ˜¯ï¼šè¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªåä¸ºBrainPortçš„ç³»ç»Ÿï¼Œå®ƒç°åœ¨æ­£åœ¨FDA (ç¾å›½é£Ÿå“å’Œè¯ç‰©ç®¡ï§¤å±€)çš„ä¸´åºŠè¯•éªŒé˜¶æ®µï¼Œå®ƒèƒ½å¸®åŠ©å¤±æ˜äººå£«çœ‹è§äº‹ç‰©ã€‚å®ƒçš„åŸï§¤æ˜¯ï¼Œä½ åœ¨å‰é¢ä¸Šå¸¦ä¸€ä¸ªç°åº¦æ‘„åƒå¤´ï¼Œé¢æœå‰ï¼Œå®ƒå°±èƒ½è·å–ä½ é¢å‰äº‹ç‰©çš„ä½åˆ†è¾¨ç‡çš„ç°åº¦å›¾åƒã€‚ä½ è¿ä¸€æ ¹çº¿åˆ°èˆŒå¤´ä¸Šå®‰è£…çš„ç”µæé˜µï¦œä¸Šï¼Œé‚£ä¹ˆæ¯ä¸ªåƒç´ éƒ½è¢«æ˜ å°„åˆ°ä½ èˆŒå¤´çš„æŸä¸ªä½ç½®ä¸Šï¼Œå¯èƒ½ç”µå‹å€¼é«˜çš„ç‚¹å¯¹åº”ä¸€ä¸ªæš—åƒç´ ç”µå‹å€¼ä½çš„ç‚¹ã€‚å¯¹åº”äºäº®åƒç´ ï¼Œå³ä½¿ä¾é å®ƒç°åœ¨çš„åŠŸèƒ½ï¼Œä½¿ç”¨è¿™ç§ç³»ç»Ÿå°±èƒ½è®©ä½ æˆ‘åœ¨å‡ ååˆ†é’Ÿï§©å°±å­¦ä¼šç”¨æˆ‘ä»¬çš„èˆŒå¤´â€œçœ‹â€ä¸œè¥¿ã€‚ ç¬¬äºŒä¸ªï¦µå­ï¼š å…³äºäººä½“å›å£°å®šä½æˆ–è€…è¯´äººä½“å£°çº³ã€‚ä½ æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å®ç°ï¼šä½ å¯ä»¥å¼¹å“æŒ‡ï¼Œæˆ–è€…å’‚èˆŒå¤´ã€‚ï¥§è¿‡ç°åœ¨æœ‰å¤±æ˜äººå£«ï¼Œç¡®å®åœ¨å­¦æ ¡ï§©æ¥å—è¿™æ ·çš„åŸ¹è®­ï¼Œå¹¶å­¦ä¼šè§£è¯»ä»ç¯å¢ƒåå¼¹å›æ¥çš„å£°æ³¢æ¨¡å¼â€”è¿™å°±æ˜¯å£°çº³ã€‚å¦‚æœä½ æœç´¢YouTubeä¹‹åï¼Œå°±ä¼šå‘ç°æœ‰äº›è§†é¢‘è®²è¿°ï¦ºä¸€ä¸ªä»¤äººç§°å¥‡çš„å­©å­ï¼Œä»–å› ä¸ºç™Œç—‡çœ¼çƒæƒ¨é­ç§»é™¤ï¼Œè™½ç„¶å¤±å»ï¦ºçœ¼çƒï¼Œä½†æ˜¯é€šè¿‡æ‰“å“æŒ‡ï¼Œä»–å¯ä»¥å››å¤„èµ°åŠ¨è€Œï¥§æ’åˆ°ä»»ä½•ä¸œè¥¿ï¼Œä»–èƒ½æ»‘æ»‘æ¿ï¼Œä»–å¯ä»¥å°†ç¯®çƒæŠ•å…¥ç¯®æ¡†ä¸­ã€‚æ³¨æ„è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰çœ¼çƒçš„å­©å­ã€‚ 3.æ¨¡å‹è¡¨ç¤ºç¥ç»ç½‘ç»œæ¨¡å‹è¡¨ç¤ºä¸ºï¦ºæ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆæ€è€ƒå¤§è„‘ä¸­çš„ç¥ç»ç½‘ç»œæ˜¯æ€æ ·çš„ï¼Ÿ æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¤„ï§¤å•å…ƒ/ç¥ç»æ ¸ï¼ˆprocessing unit/Nucleusï¼‰ï¼Œå®ƒå«æœ‰è®¸å¤šè¾“å…¥/æ ‘çªï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªè¾“å‡º/è½´çªã€‚ç¥ç»ç½‘ç»œæ˜¯å¤§ï¥¾ç¥ç»å…ƒç›¸äº’é“¾æ¥å¹¶é€šè¿‡ç”µè„‰å†²æ¥äº¤æµçš„ä¸€ä¸ªç½‘ç»œã€‚ ä¸‹é¢æ˜¯ä¸€ç»„ç¥ç»å…ƒçš„ç¤ºæ„å›¾ï¼Œç¥ç»å…ƒï§ç”¨å¾®å¼±çš„ç”µæµè¿›ï¨ˆæ²Ÿé€šã€‚è¿™äº›å¼±ç”µæµä¹Ÿç§°ä½œåŠ¨ä½œç”µä½ï¼Œå…¶å®å°±æ˜¯ä¸€äº›å¾®å¼±çš„ç”µæµã€‚æ‰€ä»¥å¦‚æœç¥ç»å…ƒæƒ³è¦ä¼ é€’ä¸€ä¸ªæ¶ˆæ¯ï¼Œå®ƒå°±ä¼šå°±é€šè¿‡å®ƒçš„è½´çªï¼Œå‘é€ä¸€æ®µå¾®å¼±ç”µæµç»™å…¶ä»–ç¥ç»å…ƒï¼Œè¿™å°±æ˜¯è½´çªã€‚ è½´çªæ˜¯ä¸€æ¡è¿æ¥åˆ°è¾“å…¥ç¥ç»ï¼Œæˆ–è€…è¿æ¥å¦ä¸€ä¸ªç¥ç»å…ƒæ ‘çªçš„ç¥ç»ï¼Œæ¥ä¸‹æ¥è¿™ä¸ªç¥ç»å…ƒæ¥æ”¶è¿™æ¡æ¶ˆæ¯ï¼Œåšä¸€äº›è®¡ç®—ï¼Œå®ƒæœ‰å¯èƒ½ä¼šåè¿‡æ¥å°†åœ¨è½´çªä¸Šçš„è‡ªå·±çš„æ¶ˆæ¯ä¼ ç»™å…¶ä»–ç¥ç»å…ƒã€‚è¿™å°±æ˜¯æ‰€æœ‰äººç±»æ€è€ƒçš„æ¨¡å‹ï¼šæˆ‘ä»¬çš„ç¥ç»å…ƒæŠŠè‡ªå·±çš„æ”¶åˆ°çš„æ¶ˆæ¯è¿›ï¨ˆè®¡ç®—ï¼Œå¹¶å‘å…¶ä»–ç¥ç»å…ƒä¼ é€’æ¶ˆæ¯ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬çš„æ„Ÿè§‰å’Œè‚Œè‚‰è¿è½¬çš„åŸï§¤ã€‚å¦‚æœä½ æƒ³æ´»åŠ¨ä¸€å—è‚Œè‚‰ï¼Œå°±ä¼šè§¦å‘ä¸€ä¸ªç¥ç»å…ƒç»™ä½ çš„è‚Œè‚‰å‘é€è„‰å†²ï¼Œå¹¶å¼•èµ·ä½ çš„è‚Œè‚‰æ”¶ç¼©ã€‚å¦‚æœä¸€äº›æ„Ÿå®˜ï¼šæ¯”å¦‚è¯´çœ¼ç›æƒ³è¦ç»™å¤§è„‘ä¼ é€’ä¸€ä¸ªæ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒå°±åƒè¿™æ ·å‘é€ç”µè„‰å†²ç»™å¤§è„‘çš„ã€‚ ç¥ç»ç½‘ç»œæ¨¡å‹å»ºç«‹åœ¨å¾ˆå¤šç¥ç»å…ƒä¹‹ä¸Šï¼Œæ¯ä¸€ä¸ªç¥ç»å…ƒåˆæ˜¯ä¸€ä¸ªä¸ªå­¦ä¹ æ¨¡å‹ã€‚è¿™äº›ç¥ç»å…ƒï¼ˆä¹Ÿå«æ¿€æ´»å•å…ƒï¼Œactivation unitï¼‰é‡‡çº³ä¸€äº›ç‰¹å¾ä½œä¸ºè¾“å‡ºï¼Œå¹¶ä¸”æ ¹æ®æœ¬èº«çš„æ¨¡å‹æä¾›ä¸€ä¸ªè¾“å‡ºã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªä»¥é€»è¾‘å›å½’æ¨¡å‹ä½œä¸ºè‡ªèº«å­¦ä¹ æ¨¡å‹çš„ç¥ç»å…ƒç¤ºï¦µï¼Œåœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œå‚æ•°åˆå¯è¢«æˆä¸ºæƒé‡ï¼ˆweightï¼‰ã€‚ é€»è¾‘å›å½’å­¦ä¹ æ¨¡å‹çš„ç¥ç»å…ƒï¼š å•ä¸ªç¥ç»å…ƒçš„æ•ˆæœå’Œé€»è¾‘å›å½’çš„æ•ˆæœæ²¡æœ‰åŒºåˆ«ï¼Œä½†æ˜¯ç¥ç»ç½‘ç»œä¼šç»„æˆæœ‰ç¥ç»å…ƒç»„æˆçš„ç½‘ç»œã€‚ ä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œ å…¶ä¸­ x1, x2, x3æ˜¯è¾“å…¥å•å…ƒï¼ˆinput unitsï¼‰ï¼Œæˆ‘ä»¬å°†åŸå§‹æ•°æ®è¾“å…¥ç»™å®ƒä»¬ã€‚ a1, a2, a3æ˜¯ä¸­é—´å•å…ƒï¼Œä»£è¡¨ä¸‰ä¸ªç¥ç»å…ƒï¼Œå®ƒä»¬è´Ÿè´£å°†æ•°æ®è¿›ï¨ˆå¤„ï§¤ï¼Œç„¶åå‘ˆé€’åˆ°ä¸‹ä¸€å±‚ã€‚ æœ€åæ˜¯è¾“å‡ºå•å…ƒï¼Œå®ƒè´Ÿè´£è®¡ç®— hÎ¸(x)ã€‚ç¥ç»ç½‘ç»œæ¨¡å‹æ˜¯è®¸å¤šé€»è¾‘å•å…ƒæŒ‰ç…§ï¥§åŒå±‚çº§ç»„ç»‡èµ·æ¥çš„ç½‘ç»œï¼Œæ¯ä¸€å±‚çš„è¾“å‡ºå˜ï¥¾éƒ½æ˜¯ä¸‹ä¸€å±‚çš„è¾“å…¥å˜ï¥¾ã€‚ä¸‹å›¾ä¸ºä¸€ä¸ª3å±‚çš„ç¥ç»ç½‘ç»œï¼Œç¬¬ä¸€å±‚æˆä¸ºè¾“å…¥å±‚ï¼ˆInput Layerï¼‰ï¼Œæœ€åä¸€å±‚ç§°ä¸ºè¾“å‡ºå±‚ï¼ˆOutput Layerï¼‰ï¼Œä¸­é—´ä¸€å±‚æˆä¸ºéšè—å±‚ï¼ˆHidden Layersï¼‰ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸€å±‚éƒ½å¢åŠ ä¸€ä¸ªåå·®å•ä½ï¼ˆbias unitï¼‰ï¼š ä¸‹é¢å¼•å…¥ä¸€äº›æ ‡è®°æ³•æ¥å¸®åŠ©æè¿°æ¨¡å‹ï¼š $a_i^{(j)}$ä»£è¡¨ç¬¬ j å±‚çš„ç¬¬ i ä¸ªæ¿€æ´»å•å…ƒ(ç¥ç»å…ƒ)ã€‚ $\theta^{(j)}$ä»£è¡¨ä»ç¬¬ j å±‚æ˜ å°„åˆ°ç¬¬ j+1 å±‚æ—¶çš„æƒé‡çš„çŸ©é˜µï¼Œï¦µå¦‚ $\theta^{(1)}$ ä»£è¡¨ä»ç¬¬ä¸€å±‚æ˜ å°„åˆ°ç¬¬äºŒå±‚çš„æƒé‡çš„çŸ©é˜µã€‚å…¶å°ºå¯¸ä¸ºï¼šä»¥ç¬¬ j + 1 å±‚çš„æ¿€æ´»å•å…ƒæ•°ï¥¾ä¸ºï¨ˆæ•°ï¼Œä»¥ç¬¬ j å±‚çš„æ¿€æ´»å•å…ƒæ•°åŠ ä¸€ä¸ºï¦œæ•°çš„çŸ©é˜µã€‚ï¦µå¦‚ï¼šä¸Šå›¾æ‰€ç¤ºçš„ç¥ç»ç½‘ç»œä¸­ $\theta^{(1)}$ çš„å°ºå¯¸ä¸º 3*4ã€‚ æ³¨: æ¯å±‚æƒé‡çŸ©é˜µçš„åˆ—æ•°ä¸º ( ç¥ç»å…ƒæ•° + 1 ), è¡Œæ•°ä¸º ( ä¸Šä¸€å±‚ç¥ç»å…ƒæ•° + 1 ) å¯¹äºä¸Šå›¾æ‰€ç¤ºçš„æ¨¡å‹ï¼Œæ¿€æ´»å•å…ƒå’Œè¾“å‡ºåˆ†åˆ«è¡¨è¾¾ä¸ºï¼š ä¸Šé¢è¿›ï¨ˆçš„è®¨è®ºä¸­åªæ˜¯å°†ç‰¹å¾çŸ©é˜µä¸­çš„ä¸€ï¨ˆï¼ˆä¸€ä¸ªè®­ç»ƒå®ï¦µï¼‰å–‚ç»™ï¦ºç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬éœ€è¦å°†æ•´ä¸ªè®­ç»ƒé›†éƒ½å–‚ç»™æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œç®—æ³•æ¥å­¦ä¹ æ¨¡å‹ æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼šæ¯ä¸€ä¸ª a çš„è¾“å‡ºéƒ½æ˜¯ç”±ä¸Šä¸€å±‚æ‰€æœ‰çš„ x å’Œæ¯ä¸€ä¸ª x æ‰€å¯¹åº”çš„ Î¸ å†³å®šçš„ï¼ˆæˆ‘ä»¬æŠŠè¿™æ ·ä»å·¦åˆ°å³çš„ç®—æ³•ç§°ä¸ºå‰å‘ä¼ æ’­ç®—æ³•( FORWARD PROPAGATION )ï¼‰æŠŠ x , Î¸, aåˆ†åˆ«ç”¨çŸ©é˜µè¡¨ç¤ºï¼š ç¥ç»ç½‘ç»œæ¨¡å‹å‘é‡åŒ–( FORWARD PROPAGATION ) ç›¸å¯¹äºä½¿ç”¨å¾ªç¯æ¥ç¼–ç ï¼Œï§ç”¨å‘ï¥¾åŒ–çš„æ–¹æ³•ä¼šä½¿å¾—è®¡ç®—ï¤ä¸ºç®€ï¥¥ã€‚ä»¥ä¸Šé¢çš„ç¥ç»ç½‘ç»œä¸ºï¦µï¼Œè¯•ç€è®¡ç®—ç¬¬äºŒå±‚çš„å€¼ï¼š ä¸ºï¦ºï¤å¥½ï¦ºï¦ºè§£Neuron Networksçš„å·¥ä½œåŸï§¤ï¼Œæˆ‘ä»¬å…ˆæŠŠå·¦åŠéƒ¨åˆ†é®ä½ï¼š å³åŠéƒ¨åˆ†å…¶å®å°±æ˜¯ä»¥a0, a1, a2, a3 , æŒ‰ç…§Logistic Regressionçš„æ–¹å¼è¾“å‡º hÎ¸(x)ï¼š å…¶å®ç¥ç»ç½‘ç»œå°±åƒæ˜¯logistic regressionï¼Œåªï¥§è¿‡æˆ‘ä»¬æŠŠlogistic regressionä¸­çš„è¾“å…¥å‘ï¥¾ [x1 - x3] å˜æˆï¦ºä¸­é—´å±‚çš„ [ $a_1^{(2)}$ - $a_3^{(2)}$] ,æˆ‘ä»¬å¯ä»¥æŠŠa0, a1, a2, a3çœ‹æˆï¤ä¸ºé«˜çº§çš„ç‰¹å¾å€¼ï¼Œä¹Ÿå°±æ˜¯x0, x1, x2, x3 çš„è¿›åŒ–ä½“ï¼Œå¹¶ä¸”å®ƒä»¬æ˜¯ç”± x ä¸ Î¸ å†³å®šçš„ï¼Œå› ä¸ºæ˜¯æ¢¯åº¦ä¸‹é™çš„ï¼Œæ‰€ä»¥ a æ˜¯å˜åŒ–çš„ï¼Œå¹¶ä¸”å˜å¾—è¶Šæ¥è¶Šå‰å®³ï¼Œæ‰€ä»¥è¿™äº›ï¤é«˜çº§çš„ç‰¹å¾å€¼è¿œæ¯”ä»…ä»…å°† x æ¬¡æ–¹å‰å®³ï¼Œä¹Ÿèƒ½ï¤å¥½çš„é¢„æµ‹æ–°æ•°æ®ã€‚ è¿™å°±æ˜¯ç¥ç»ç½‘ç»œç›¸æ¯”äºé€»è¾‘å›å½’å’Œçº¿æ€§å›å½’çš„ä¼˜åŠ¿ã€‚ 4. ç‰¹å¾çš„ç›´è§‚ç†è§£ä»æœ¬è´¨ä¸Šè®²ï¼Œç¥ç»ç½‘ç»œèƒ½å¤Ÿé€šè¿‡å­¦ä¹ å¾—å‡ºå…¶è‡ªèº«çš„ä¸€ç³»ï¦œç‰¹å¾ã€‚åœ¨æ™®é€šçš„é€»è¾‘å›å½’ä¸­ï¼Œæˆ‘ä»¬è¢«é™åˆ¶ä¸ºä½¿ç”¨æ•°æ®ä¸­çš„åŸå§‹ç‰¹å¾ï¼Œæˆ‘ä»¬è™½ç„¶å¯ä»¥ä½¿ç”¨ä¸€äº›äºŒé¡¹å¼é¡¹æ¥ç»„åˆè¿™äº›ç‰¹å¾ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å—åˆ°è¿™äº›åŸå§‹ç‰¹å¾çš„é™åˆ¶ã€‚åœ¨ç¥ç»ç½‘ç»œä¸­ï¼ŒåŸå§‹ç‰¹å¾åªæ˜¯è¾“å…¥å±‚ï¼Œåœ¨æˆ‘ä»¬ä¸Šé¢ä¸‰å±‚çš„ç¥ç»ç½‘ç»œï¦µå­ä¸­ï¼Œç¬¬ä¸‰å±‚ä¹Ÿå°±æ˜¯è¾“å‡ºå±‚åšå‡ºçš„é¢„æµ‹ï§ç”¨çš„æ˜¯ç¬¬äºŒå±‚çš„ç‰¹å¾ï¼Œè€Œéè¾“å…¥å±‚ä¸­çš„åŸå§‹ç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºç¬¬äºŒå±‚ä¸­çš„ç‰¹å¾æ˜¯ç¥ç»ç½‘ç»œé€šè¿‡å­¦ä¹ åè‡ªå·±å¾—å‡ºçš„ä¸€ç³»ï¦œç”¨äºé¢„æµ‹è¾“å‡ºå˜ï¥¾çš„æ–°ç‰¹å¾ã€‚ ç¥ç»ç½‘ç»œä¸­ï¼Œå•å±‚ç¥ç»å…ƒï¼ˆæ— ä¸­é—´å±‚ï¼‰çš„è®¡ç®—å¯ç”¨æ¥è¡¨ç¤ºé€»è¾‘è¿ç®—ï¼Œæ¯”å¦‚é€»è¾‘ä¸(AND)ã€é€»è¾‘æˆ–(OR)ã€‚ä¸¾ï¦µè¯´æ˜ï¼š é€»è¾‘ä¸(AND)ï¼šä¸‹å›¾ä¸­å·¦åŠéƒ¨åˆ†æ˜¯ç¥ç»ç½‘ç»œçš„è®¾è®¡ä¸outputå±‚è¡¨è¾¾å¼ï¼Œå³è¾¹ä¸Šéƒ¨åˆ†æ˜¯sigmodå‡½æ•°ï¼Œä¸‹åŠéƒ¨åˆ†æ˜¯çœŸå€¼è¡¨ã€‚ å…¶ä¸­ Î¸0 = -30, Î¸1 = 20, Î¸2 = 20 æˆ‘ä»¬çš„è¾“å‡ºå‡½æ•°hÎ¸(x) å³ä¸ºï¼šhÎ¸(x) = g(-30 + 20x1 + 20x2), g(x) çš„å›¾åƒæ˜¯ï¼š æ‰€ä»¥æˆ‘ä»¬æœ‰ï¼šhÎ¸(x) â‰ˆ x1 AND x2 é€»è¾‘æˆ–(OR): ä¸‹å›¾æ˜¯ç¥ç»ç½‘ç»œçš„è®¾è®¡ä¸outputå±‚è¡¨è¾¾å¼å’ŒçœŸå€¼è¡¨ã€‚ é€»è¾‘é(NOT)ï¼š å¼‚æˆ–(XNOR): 5.å¤šåˆ†ç±»ç¥ç»ç½‘ç»œå½“æˆ‘ä»¬æœ‰ï¥§æ­¢ä¸¤ç§åˆ†ç±»æ—¶ï¼ˆä¹Ÿå°±æ˜¯ y = 1, 2, 3, â€¦ ï¼‰ï¼Œæ¯”å¦‚ä»¥ä¸‹è¿™ç§æƒ…å†µï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ å¦‚æœæˆ‘ä»¬è¦è®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œç®—æ³•æ¥è¯†åˆ«ï¤·äººã€æ±½è½¦ã€æ‘©æ‰˜è½¦å’Œå¡è½¦ï¼Œåœ¨è¾“å‡ºå±‚æˆ‘ä»¬åº”è¯¥æœ‰4ä¸ªå€¼ã€‚ï¦µå¦‚ï¼Œç¬¬ä¸€ä¸ªå€¼ä¸º1æˆ–0ç”¨äºé¢„æµ‹æ˜¯å¦æ˜¯ï¨ˆäººï¼Œç¬¬äºŒä¸ªå€¼ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸ºæ±½è½¦ã€‚å‡å¦‚è¾“å…¥å‘ï¥¾ x æœ‰ä¸‰ä¸ªç»´åº¦ï¼Œä¸¤ä¸ªä¸­é—´å±‚ï¼Œè¾“å‡ºå±‚4ä¸ªç¥ç»å…ƒåˆ†åˆ«ç”¨æ¥è¡¨ç¤º4ç±»ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªæ•°æ®åœ¨è¾“å‡ºå±‚éƒ½ä¼šå‡ºç° [a b c d] ^T, ä¸”a, b, c, d ä¸­ä»…æœ‰ä¸€ä¸ªä¸º1ï¼Œè¡¨ç¤ºå½“å‰ç±»ã€‚ä¸‹é¢æ˜¯è¯¥ç¥ç»ç½‘ç»œçš„å¯èƒ½ç»“æ„ç¤ºï¦µï¼š 6. ç¥ç»ç½‘ç»œå¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ä»€ä¹ˆæ˜¯æ¿€æ´»å‡½æ•°åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¯ä»¥çœ‹åˆ°å¯¹äºæŸä¸€ä¸ªéšè—å±‚çš„èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹çš„æ¿€æ´»å€¼è®¡ç®—ä¸€èˆ¬åˆ†ä¸ºä¸¤æ­¥ï¼š ï¼ˆ1ï¼‰è¾“å…¥è¯¥èŠ‚ç‚¹çš„å€¼ä¸º x1,x2æ—¶ï¼Œåœ¨è¿›å…¥è¿™ä¸ªéšè—èŠ‚ç‚¹åï¼Œä¼šå…ˆè¿›è¡Œä¸€ä¸ªçº¿æ€§å˜æ¢ï¼Œè®¡ç®—å‡ºå€¼ $z^{[1]}=w_1x_1+w_2x_2+b^{[1]}=W^{[1]}x+b^{[1]}$ï¼Œä¸Šæ ‡ 1è¡¨ç¤ºç¬¬ 1 å±‚éšè—å±‚ã€‚ ï¼ˆ2ï¼‰å†è¿›è¡Œä¸€ä¸ªéçº¿æ€§å˜æ¢ï¼Œä¹Ÿå°±æ˜¯ç»è¿‡éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œè®¡ç®—å‡ºè¯¥èŠ‚ç‚¹çš„è¾“å‡ºå€¼(æ¿€æ´»å€¼) $a^{(1)}=g(z^{(1)})$ ï¼Œå…¶ä¸­ g(z)ä¸ºéçº¿æ€§å‡½æ•°ã€‚ å¸¸ç”¨çš„æ¿€æ´»å‡½æ•°åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œå¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ä¸»è¦æœ‰ï¼šsigmoidå‡½æ•°ï¼Œtanhå‡½æ•°ï¼ŒReLUå‡½æ•°ã€‚ 1.sigmoidå‡½æ•° åœ¨é€»è¾‘å›å½’ä¸­æˆ‘ä»¬ä»‹ç»è¿‡sigmoidå‡½æ•°ï¼Œè¯¥å‡½æ•°æ˜¯å°†å–å€¼ä¸º (âˆ’âˆ,+âˆ)(âˆ’âˆ,+âˆ) çš„æ•°æ˜ å°„åˆ° (0,1)(0,1) ä¹‹é—´ã€‚sigmoidå‡½æ•°çš„å…¬å¼ä»¥åŠå›¾å½¢å¦‚ä¸‹ï¼š sigmoidæ¿€æ´»å‡½æ•°ç¼ºç‚¹ï¼š ï¼ˆ1ï¼‰å½“ z å€¼éå¸¸å¤§æˆ–è€…éå¸¸å°æ—¶ï¼Œé€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œsigmoidå‡½æ•°çš„å¯¼æ•° gâ€²(z) å°†æ¥è¿‘ 0 ã€‚è¿™ä¼šå¯¼è‡´æƒé‡ W çš„æ¢¯åº¦å°†æ¥è¿‘ 0 ï¼Œä½¿å¾—æ¢¯åº¦æ›´æ–°ååˆ†ç¼“æ…¢ï¼Œå³æ¢¯åº¦æ¶ˆå¤±ã€‚ ï¼ˆ2ï¼‰å‡½æ•°çš„è¾“å‡ºä¸æ˜¯ä»¥0ä¸ºå‡å€¼ï¼Œå°†ä¸ä¾¿äºä¸‹å±‚çš„è®¡ç®—ã€‚sigmoidå‡½æ•°å¯ç”¨åœ¨ç½‘ç»œæœ€åä¸€å±‚ï¼Œä½œä¸ºè¾“å‡ºå±‚è¿›è¡ŒäºŒåˆ†ç±»ï¼Œå°½é‡ä¸è¦ä½¿ç”¨åœ¨éšè—å±‚ã€‚ (3) æŒ‡æ•°è®¡ç®—æ¶ˆè€—èµ„æº 2.tanhå‡½æ•° tanhå‡½æ•°ç›¸è¾ƒäºsigmoidå‡½æ•°è¦å¸¸è§ä¸€äº›ï¼Œè¯¥å‡½æ•°æ˜¯å°†å–å€¼ä¸º (âˆ’âˆ,+âˆ)(âˆ’âˆ,+âˆ) çš„æ•°æ˜ å°„åˆ° (âˆ’1,1)(âˆ’1,1)ä¹‹é—´ï¼Œå…¶å…¬å¼ä¸å›¾å½¢ä¸ºï¼š tanhå‡½æ•°çš„ä¼˜ç‚¹ (1) tanhè§£å†³äº†sigmoidçš„è¾“å‡ºéâ€œé›¶ä¸ºä¸­å¿ƒâ€çš„é—®é¢˜ã€‚ tanhå‡½æ•°çš„ç¼ºç‚¹ ï¼ˆ1ï¼‰åŒsigmoidå‡½æ•°çš„ç¬¬ä¸€ä¸ªç¼ºç‚¹ä¸€æ ·ï¼Œå½“ z å¾ˆå¤§æˆ–å¾ˆå°æ—¶ï¼Œgâ€²(z) æ¥è¿‘äº 0 ï¼Œä¼šå¯¼è‡´æ¢¯åº¦å¾ˆå°ï¼Œæƒé‡æ›´æ–°éå¸¸ç¼“æ…¢ï¼Œå³æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚ (2) ä¾æ—§æ˜¯æŒ‡æ•°è®¡ç®— 3.ReLUå‡½æ•° ReLUå‡½æ•°åˆç§°ä¸ºä¿®æ­£çº¿æ€§å•å…ƒï¼ˆRectified Linear Unitï¼‰ï¼Œæ˜¯ä¸€ç§åˆ†æ®µçº¿æ€§å‡½æ•°ï¼Œå…¶å¼¥è¡¥äº†sigmoidå‡½æ•°ä»¥åŠtanhå‡½æ•°çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚ReLUå‡½æ•°çš„å…¬å¼ä»¥åŠå›¾å½¢å¦‚ä¸‹ï¼š ReLUå‡½æ•°çš„ä¼˜ç‚¹ï¼š ï¼ˆ1ï¼‰åœ¨è¾“å…¥ä¸ºæ­£æ•°çš„æ—¶å€™ï¼ˆå¯¹äºå¤§å¤šæ•°è¾“å…¥ zz ç©ºé—´æ¥è¯´ï¼‰ï¼Œä¸å­˜åœ¨æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚ï¼ˆ2ï¼‰ è®¡ç®—é€Ÿåº¦è¦å¿«å¾ˆå¤šã€‚ReLUå‡½æ•°åªæœ‰çº¿æ€§å…³ç³»ï¼Œä¸ç®¡æ˜¯å‰å‘ä¼ æ’­è¿˜æ˜¯åå‘ä¼ æ’­ï¼Œéƒ½æ¯”sigmodå’Œtanhè¦å¿«å¾ˆå¤šã€‚ï¼ˆsigmodå’Œtanhè¦è®¡ç®—æŒ‡æ•°ï¼Œè®¡ç®—é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ï¼‰ReLUå‡½æ•°çš„ç¼ºç‚¹ï¼š ï¼ˆ1ï¼‰å½“è¾“å…¥ä¸ºè´Ÿæ—¶ï¼Œæ¢¯åº¦ä¸º0ï¼Œä¼šäº§ç”Ÿæ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚ 4.Leaky ReLU å‡½æ•° è¿™æ˜¯ä¸€ç§å¯¹ReLUå‡½æ•°æ”¹è¿›çš„å‡½æ•°ï¼Œåˆç§°ä¸ºPReLUå‡½æ•°ï¼Œä½†å…¶å¹¶ä¸å¸¸ç”¨ã€‚å…¶å…¬å¼ä¸å›¾å½¢å¦‚ä¸‹ï¼š Leaky ReLUå‡½æ•°è§£å†³äº†ReLUå‡½æ•°åœ¨è¾“å…¥ä¸ºè´Ÿçš„æƒ…å†µä¸‹äº§ç”Ÿçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚ ä¼˜ç‚¹: 1.ç¥ç»å…ƒä¸ä¼šå‡ºç°æ­»äº¡çš„æƒ…å†µã€‚ 2.å¯¹äºæ‰€æœ‰çš„è¾“å…¥ï¼Œä¸ç®¡æ˜¯å¤§äºç­‰äº0è¿˜æ˜¯å°äº0ï¼Œç¥ç»å…ƒä¸ä¼šé¥±å’Œã€‚ 3.ç”±äºLeaky ReLUçº¿æ€§ã€éé¥±å’Œçš„å½¢å¼ï¼Œåœ¨SGDä¸­èƒ½å¤Ÿå¿«é€Ÿæ”¶æ•›ã€‚ 4.è®¡ç®—é€Ÿåº¦è¦å¿«å¾ˆå¤šã€‚Leaky ReLUå‡½æ•°åªæœ‰çº¿æ€§å…³ç³»ï¼Œä¸éœ€è¦æŒ‡æ•°è®¡ç®—ï¼Œä¸ç®¡åœ¨å‰å‘ä¼ æ’­è¿˜æ˜¯åå‘ä¼ æ’­ï¼Œè®¡ç®—é€Ÿåº¦éƒ½æ¯”sigmoidå’Œtanhå¿«ã€‚ 7.ç¥ç»ç½‘ç»œä»£ä»·å‡½æ•°å‡è®¾ç¥ç»ç½‘ç»œçš„è®­ç»ƒæ ·æœ¬æœ‰ m ä¸ªï¼Œæ¯ä¸ªåŒ…å«ä¸€ç»„è¾“å…¥x å’Œä¸€ç»„è¾“å‡ºä¿¡å· y ï¼ŒL è¡¨ç¤ºç¥ç»ç½‘ç»œå±‚æ•°ï¼ŒSi è¡¨ç¤ºæ¯å±‚çš„neuronä¸ªæ•°( Slè¡¨ç¤ºè¾“å‡ºå±‚ç¥ç»å…ƒä¸ªæ•°)ï¼ŒSL ä»£è¡¨æœ€åä¸€å±‚ä¸­å¤„ï§¤å•å…ƒçš„ä¸ªæ•°ã€‚ å°†ç¥ç»ç½‘ç»œçš„åˆ†ç±»å®šä¹‰ä¸ºä¸¤ç§æƒ…å†µï¼šäºŒç±»åˆ†ç±»å’Œå¤šç±»åˆ†ç±»ï¼Œ äºŒç±»åˆ†ç±»: SL = 1, y = 0 or 1 è¡¨ç¤ºå“ªä¸€ç±»ï¼› Kç±»åˆ†ç±»: SL = k, yi = 1 è¡¨ç¤ºåˆ†åˆ°ç¬¬iç±»ï¼› (k &gt; 2) è¿™ä¸ªçœ‹èµ·æ¥å¤æ‚å¾ˆå¤šçš„ä»£ä»·å‡½æ•°èƒŒåçš„æ€æƒ³è¿˜æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ä»£ä»·å‡½æ•°æ¥è§‚å¯Ÿç®—æ³•é¢„æµ‹çš„ç»“æœä¸çœŸå®æƒ…å†µçš„è¯¯å·®æœ‰å¤šå¤§ï¼Œå”¯ä¸€ï¥§åŒçš„æ˜¯ï¼Œå¯¹äºæ¯ä¸€ï¨ˆç‰¹å¾ï¼Œæˆ‘ä»¬éƒ½ä¼šç»™å‡º K ä¸ªé¢„æµ‹ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬å¯ä»¥ï§ç”¨å¾ªç¯ï¼Œå¯¹æ¯ä¸€ï¨ˆç‰¹å¾éƒ½é¢„æµ‹ K ä¸ªï¥§åŒç»“æœï¼Œç„¶ååœ¨ï§ç”¨å¾ªç¯åœ¨ K ä¸ªé¢„æµ‹ä¸­é€‰æ‹©å¯èƒ½æ€§æœ€é«˜çš„ä¸€ä¸ªï¼Œå°†å…¶ä¸ y ä¸­çš„å®é™…æ•°æ®è¿›ï¨ˆæ¯”è¾ƒã€‚æ­£åˆ™åŒ–çš„é‚£ä¸€é¡¹åªæ˜¯æ’é™¤ï¦ºæ¯ä¸€å±‚ Î¸0 åï¼Œæ¯ä¸€å±‚çš„ Î¸ çŸ©é˜µçš„å’Œã€‚æœ€ï§©å±‚çš„å¾ªç¯ j å¾ªç¯æ‰€æœ‰çš„ï¨ˆï¼ˆç”± sl +1 å±‚çš„æ¿€æ´»å•å…ƒæ•°å†³å®šï¼‰ï¼Œå¾ªç¯ i åˆ™å¾ªç¯æ‰€æœ‰çš„ï¦œï¼Œç”±è¯¥å±‚ï¼ˆ sl å±‚ï¼‰çš„æ¿€æ´»å•å…ƒæ•°æ‰€å†³å®šã€‚å³ï¼šhÎ¸(x) ä¸çœŸå®å€¼ä¹‹é—´çš„è·ç¦»ä¸ºæ¯ä¸ªæ ·æœ¬-æ¯ä¸ªç±»è¾“å‡ºçš„åŠ å’Œï¼Œå¯¹å‚æ•°è¿›ï¨ˆregularizationçš„biasé¡¹å¤„ï§¤æ‰€æœ‰å‚æ•°çš„å¹³æ–¹å’Œã€‚ 8.åå‘ä¼ æ’­ç®—æ³•åå‘ä¼ æ’­ç®—æ³•ä»‹ç»åœ¨è®¡ç®—ç¥ç»ç½‘ç»œé¢„æµ‹ç»“æœçš„æ—¶å€™é‡‡ç”¨äº†æ­£å‘ä¼ æ’­çš„ç®—æ³•ï¼Œå³ä»ç¬¬ä¸€å±‚å¼€å§‹å‘æ­£å‘ä¸€å±‚çš„ç¥ç»å…ƒä¸€å±‚ä¸€å±‚è¿›è¡Œè®¡ç®—ï¼ŒçŸ¥é“æœ€åä¸€å±‚çš„hÎ¸(x). ä¸ºäº†è®¡ç®—ä»£ä»·å‡½æ•°çš„åå¯¼æ•°${\delta\over\delta\theta_{ij}^{(i)}} J(\theta)$ , ç°åœ¨éœ€è¦ç”¨åˆ°åå‘ä¼ æ’­ç®—æ³•ï¼Œä»¥æå…·æ˜¯é¦–å…ˆè®¡ç®—æœ€åä¸€å±‚çš„è¯¯å·®ï¼Œç„¶åå†ä¸€å±‚ä¸€å±‚çš„åå‘æ±‚å‡ºå„å±‚çš„è¯¯å·®ï¼Œç›´åˆ°å€’æ•°ç¬¬äºŒå±‚ã€‚ä¸‹é¢ä¸¾ä¾‹è¯´æ˜åå‘ä¼ æ’­ç®—æ³•ï¼š å‡è®¾æˆ‘ä»¬çš„è®­ç»ƒé›†åªæœ‰ä¸€ä¸ªå®ä¾‹(x^(1), y^(1)), æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œæ˜¯ä¸€ä¸ªå››å±‚çš„ç¥ç»ç½‘ç»œï¼Œå…¶ä¸­: K = 4, SL = 4, L = 4 å…¶å‰å‘ä¼ æ’­ç®—æ³•ä¸º: åå‘ä¼ æ’­ç®—æ³•æ¨å¯¼è¿‡ç¨‹ å³é¦–å…ˆç”¨æ­£å‘ä¼ æ’­æ–¹æ³•è®¡ç®—å‡ºæ¯ä¸€å±‚çš„æ¿€æ´»å•å…ƒï¼Œï§ç”¨è®­ç»ƒé›†çš„ç»“æœä¸ç¥ç»ç½‘ç»œé¢„æµ‹çš„ç»“æœæ±‚å‡ºæœ€åä¸€å±‚çš„è¯¯å·®ï¼Œç„¶åï§ç”¨è¯¥è¯¯å·®è¿ç”¨åå‘ä¼ æ’­æ³•è®¡ç®—å‡ºç›´è‡³ç¬¬äºŒå±‚çš„æ‰€æœ‰è¯¯å·®ã€‚ 9. æ¨¡å‹æ„å»ºå¸¸ç”¨æŠ€å·§1.æ¢¯åº¦æ£€éªŒ 2. éšæœºåˆå§‹åŒ–ä»»ä½•ä¼˜åŒ–ç®—æ³•éƒ½éœ€è¦ä¸€äº›åˆå§‹çš„å‚æ•°ã€‚åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬éƒ½æ˜¯åˆå§‹æ‰€æœ‰å‚æ•°ä¸º0ï¼Œè¿™æ ·çš„åˆå§‹æ–¹æ³•å¯¹äºé€»è¾‘å›å½’æ¥è¯´æ˜¯å¯ï¨ˆçš„ï¼Œä½†æ˜¯å¯¹äºç¥ç»ç½‘ç»œæ¥è¯´æ˜¯ï¥§å¯ï¨ˆçš„ã€‚å¦‚æœæˆ‘ä»¬ä»¤æ‰€æœ‰çš„åˆå§‹å‚æ•°éƒ½ä¸º0ï¼Œè¿™å°†æ„å‘³ç€æˆ‘ä»¬ç¬¬äºŒå±‚çš„æ‰€æœ‰æ¿€æ´»å•å…ƒéƒ½ä¼šæœ‰ç›¸åŒçš„å€¼ã€‚åŒï§¤ï¼Œå¦‚æœæˆ‘ä»¬åˆå§‹æ‰€æœ‰çš„å‚æ•°éƒ½ä¸ºä¸€ä¸ªé0çš„æ•°ï¼Œç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œ ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±çš„æƒ…å†µã€‚æˆ‘ä»¬é€šå¸¸åˆå§‹å‚æ•°ä¸ºæ­£è´ŸÎµä¹‹é—´çš„éšæœºå€¼ï¼Œå‡è®¾æˆ‘ä»¬è¦éšæœºåˆå§‹ä¸€ä¸ªå°ºå¯¸ä¸º10Ã—11çš„å‚æ•°çŸ©é˜µï¼Œä»£ç å¦‚ä¸‹ï¼šTheta1 = rand(10, 11) * (2*eps) â€“ ep 10. æ¢¯åº¦å°æ—¶å’Œæ¢¯åº¦çˆ†ç…§(1)ç®€ä»‹æ¢¯åº¦æ¶ˆå¤±ä¸æ¢¯åº¦çˆ†ç‚¸ å±‚æ•°æ¯”è¾ƒå¤šçš„ç¥ç»ç½‘ç»œæ¨¡å‹åœ¨è®­ç»ƒçš„æ—¶å€™ä¼šå‡ºç°æ¢¯åº¦æ¶ˆå¤±(gradient vanishing problem)å’Œæ¢¯åº¦çˆ†ç‚¸(gradient exploding problem)é—®é¢˜ã€‚æ¢¯åº¦æ¶ˆå¤±é—®é¢˜å’Œæ¢¯åº¦çˆ†ç‚¸é—®é¢˜ä¸€èˆ¬ä¼šéšç€ç½‘ç»œå±‚æ•°çš„å¢åŠ å˜å¾—è¶Šæ¥è¶Šæ˜æ˜¾ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºå›¾1æ‰€ç¤ºçš„å«æœ‰3ä¸ªéšè—å±‚çš„ç¥ç»ç½‘ç»œï¼Œæ¢¯åº¦æ¶ˆå¤±é—®é¢˜å‘ç”Ÿæ—¶ï¼Œé è¿‘è¾“å‡ºå±‚çš„hidden layer 3çš„æƒå€¼æ›´æ–°ç›¸å¯¹æ­£å¸¸ï¼Œä½†æ˜¯é è¿‘è¾“å…¥å±‚çš„hidden layer1çš„æƒå€¼æ›´æ–°ä¼šå˜å¾—å¾ˆæ…¢ï¼Œå¯¼è‡´é è¿‘è¾“å…¥å±‚çš„éšè—å±‚æƒå€¼å‡ ä¹ä¸å˜ï¼Œæ‰”æ¥è¿‘äºåˆå§‹åŒ–çš„æƒå€¼ã€‚è¿™å°±å¯¼è‡´hidden layer 1 ç›¸å½“äºåªæ˜¯ä¸€ä¸ªæ˜ å°„å±‚ï¼Œå¯¹æ‰€æœ‰çš„è¾“å…¥åšäº†ä¸€ä¸ªå‡½æ•°æ˜ å°„ï¼Œè¿™æ—¶æ­¤æ·±åº¦ç¥ç»ç½‘ç»œçš„å­¦ä¹ å°±ç­‰ä»·äºåªæœ‰åå‡ å±‚çš„éšè—å±‚ç½‘ç»œåœ¨å­¦ä¹ ã€‚æ¢¯åº¦çˆ†ç‚¸çš„æƒ…å†µæ˜¯ï¼šå½“åˆå§‹çš„æƒå€¼è¿‡å¤§ï¼Œé è¿‘è¾“å…¥å±‚çš„hidden layer 1çš„æƒå€¼å˜åŒ–æ¯”é è¿‘è¾“å‡ºå±‚çš„hidden layer 3çš„æƒå€¼å˜åŒ–æ›´å¿«ï¼Œå°±ä¼šå¼•èµ·æ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ã€‚ (2)æ¢¯åº¦ä¸ç¨³å®šé—®é¢˜ åœ¨æ·±åº¦ç¥ç»ç½‘ç»œä¸­çš„æ¢¯åº¦æ˜¯ä¸ç¨³å®šçš„ï¼Œåœ¨é è¿‘è¾“å…¥å±‚çš„éšè—å±‚ä¸­æˆ–ä¼šæ¶ˆå¤±ï¼Œæˆ–ä¼šçˆ†ç‚¸ã€‚è¿™ç§ä¸ç¨³å®šæ€§æ‰æ˜¯æ·±åº¦ç¥ç»ç½‘ç»œä¸­åŸºäºæ¢¯åº¦å­¦ä¹ çš„æ ¹æœ¬é—®é¢˜ã€‚ æ¢¯åº¦ä¸ç¨³å®šçš„åŸå› ï¼šå‰é¢å±‚ä¸Šçš„æ¢¯åº¦æ˜¯æ¥è‡ªåé¢å±‚ä¸Šæ¢¯åº¦çš„ä¹˜ç§¯ã€‚å½“å­˜åœ¨è¿‡å¤šçš„å±‚æ—¶ï¼Œå°±ä¼šå‡ºç°æ¢¯åº¦ä¸ç¨³å®šåœºæ™¯ï¼Œæ¯”å¦‚æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸ã€‚ (3)äº§ç”Ÿæ¢¯åº¦æ¶ˆå¤±çš„æ ¹æœ¬åŸå›  æˆ‘ä»¬ä»¥å›¾2çš„åå‘ä¼ æ’­ä¸ºä¾‹ï¼Œå‡è®¾æ¯ä¸€å±‚åªæœ‰ä¸€ä¸ªç¥ç»å…ƒä¸”å¯¹äºæ¯ä¸€å±‚éƒ½å¯ä»¥ç”¨å…¬å¼1è¡¨ç¤ºï¼Œå…¶ä¸­Ïƒä¸ºsigmoidå‡½æ•°ï¼ŒCè¡¨ç¤ºçš„æ˜¯ä»£ä»·å‡½æ•°ï¼Œå‰ä¸€å±‚çš„è¾“å‡ºå’Œåä¸€å±‚çš„è¾“å…¥å…³ç³»å¦‚å…¬å¼1æ‰€ç¤ºã€‚æˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºå…¬å¼2ã€‚ å›¾2ï¼šç®€å•çš„æ·±åº¦ç¥ç»ç½‘ç»œ è€Œsigmoidå‡½æ•°çš„å¯¼æ•°Ïƒâ€™(x)å¦‚å›¾3æ‰€ç¤ºã€‚ å›¾3ï¼šsigmoidå‡½æ•°å¯¼æ•°å›¾åƒ å¯è§ï¼ŒÏƒâ€™(x)çš„æœ€å¤§å€¼ä¸º 1/4ï¼Œè€Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨æ ‡å‡†æ–¹æ³•æ¥åˆå§‹åŒ–ç½‘ç»œæƒé‡ï¼Œå³ä½¿ç”¨ä¸€ä¸ªå‡å€¼ä¸º0æ ‡å‡†å·®ä¸º1çš„é«˜æ–¯åˆ†å¸ƒã€‚å› æ­¤ï¼Œåˆå§‹åŒ–çš„ç½‘ç»œæƒå€¼é€šå¸¸éƒ½å°äº1ï¼Œä»è€Œæœ‰ |Ïƒâ€™(z)w &lt;= 1/4|ã€‚å¯¹äº2å¼çš„é“¾å¼æ±‚å¯¼ï¼Œå±‚æ•°è¶Šå¤šï¼Œæ±‚å¯¼ç»“æœè¶Šå°ï¼Œæœ€ç»ˆå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±çš„æƒ…å†µå‡ºç°ã€‚ (4)äº§ç”Ÿæ¢¯åº¦çˆ†ç‚¸çš„æ ¹æœ¬åŸå›  å½“ï¼Œä¹Ÿå°±æ˜¯wæ¯”è¾ƒå¤§çš„æƒ…å†µã€‚åˆ™å‰é¢çš„ç½‘ç»œå±‚æ¯”åé¢çš„ç½‘ç»œå±‚æ¢¯åº¦å˜åŒ–æ›´å¿«ï¼Œå¼•èµ·äº†æ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ã€‚ (5)å¦‚ä½•è§£å†³æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸ æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸é—®é¢˜éƒ½æ˜¯å› ä¸ºç½‘ç»œå¤ªæ·±ï¼Œç½‘ç»œæƒå€¼æ›´æ–°ä¸ç¨³å®šé€ æˆçš„ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸ºæ¢¯åº¦åå‘ä¼ æ’­ä¸­çš„è¿ä¹˜æ•ˆåº”ã€‚å¯¹äºæ›´æ™®éçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸‰ç§æ–¹æ¡ˆè§£å†³ï¼š ç”¨ReLUã€Leaky ReLUã€PReLUã€RReLUã€Maxoutç­‰æ›¿ä»£sigmoidå‡½æ•°ã€‚ ç”¨Batch Normalizationã€‚ LSTMçš„ç»“æ„è®¾è®¡ä¹Ÿå¯ä»¥æ”¹å–„RNNä¸­çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚ 11.æ„å»ºç¥ç»ç½‘ç»œçš„ç»¼åˆæ­¥éª¤ç½‘ç»œç»“æ„ï¼šç¬¬ä¸€ä»¶è¦åšçš„äº‹æ˜¯é€‰æ‹©ç½‘ç»œç»“æ„ï¼Œå³å†³å®šé€‰æ‹©å¤šå°‘å±‚ä»¥åŠå†³å®šæ¯å±‚åˆ†åˆ«æœ‰å¤šå°‘ä¸ªå•å…ƒã€‚ç¬¬ä¸€å±‚çš„å•å…ƒæ•°å³æˆ‘ä»¬è®­ç»ƒé›†çš„ç‰¹å¾æ•°ï¥¾ã€‚æœ€åä¸€å±‚çš„å•å…ƒæ•°æ˜¯æˆ‘ä»¬è®­ç»ƒé›†çš„ç»“æœçš„ç±»çš„æ•°ï¥¾ã€‚å¦‚æœéšè—å±‚æ•°å¤§äº1ï¼Œç¡®ä¿æ¯ä¸ªéšè—å±‚çš„å•å…ƒä¸ªæ•°ç›¸åŒï¼Œé€šå¸¸æƒ…å†µä¸‹éšè—å±‚å•å…ƒçš„ä¸ªæ•°è¶Šå¤šè¶Šå¥½ã€‚æˆ‘ä»¬çœŸæ­£è¦å†³å®šçš„æ˜¯éšè—å±‚çš„å±‚æ•°å’Œæ¯ä¸ªä¸­é—´å±‚çš„å•å…ƒæ•°ã€‚è®­ç»ƒç¥ç»ç½‘ç»œï¼š å‚æ•°çš„éšæœºåˆå§‹åŒ– ï§ç”¨æ­£å‘ä¼ æ’­æ–¹æ³•è®¡ç®—æ‰€æœ‰çš„hÎ¸(x) ç¼–å†™è®¡ç®—ä»£ä»·å‡½æ•° J çš„ä»£ç  ï§ç”¨åå‘ä¼ æ’­æ–¹æ³•è®¡ç®—æ‰€æœ‰åå¯¼æ•° ï§ç”¨æ•°å€¼æ£€éªŒæ–¹æ³•æ£€éªŒè¿™äº›åå¯¼æ•° ä½¿ç”¨ä¼˜åŒ–ç®—æ³•æ¥æœ€å°åŒ–ä»£ä»·å‡½æ•° ä¸€å¥è¯æ€»ç»“ç¥ç»ç½‘ç»œæˆ‘è®¤ä¸ºç¥ç»ç½‘ç»œå°±æ˜¯é€šè¿‡å„å±‚ç¥ç»å…ƒå°†å˜é‡çš„é‡æ–°è®¡ç®—ï¼Œ å¯¼è‡´ç‰¹å¾çš„ç»´åº¦è¢«å¤§å¤§æ”¾å¤§ï¼Œ æ€»ä¹‹ç»è¿‡ç¥ç»ç½‘ç»œçæä¹‹åï¼Œç‰¹å¾å·²ä¸æ˜¯ç®€å•çš„ç‰¹å¾ï¼Œè€ŒåŸç†ä»æ ¹æœ¬è¿˜æ˜¯é€»è¾‘å›å½’ï¼Œå½“ç‰¹å¾æ•°é‡è¾ƒå¤šï¼Œè€Œä¸”æ¨¡å‹ä¸èƒ½æ»¡è¶³çº¿å‹è¦æ±‚ï¼Œ å¯ä»¥è€ƒè™‘ä½¿ç”¨ç¥ç»ç½‘ç»œ]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ·±åº¦å­¦ä¹ </tag>
        <tag>ç¥ç»ç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sklearn é€»è¾‘å›å½’]]></title>
    <url>%2F2018%2F11%2F03%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2Fsklearn%20%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%2F</url>
    <content type="text"><![CDATA[é€»è¾‘å›å½’ä½œç”¨å¯ä»¥åšæ¦‚ç‡é¢„æµ‹ï¼Œä¹Ÿå¯ç”¨äºåˆ†ç±»ï¼Œä»…èƒ½ç”¨äºçº¿æ€§é—®é¢˜ã€‚é€šè¿‡è®¡ç®—çœŸå®å€¼ä¸é¢„æµ‹å€¼çš„æ¦‚ç‡ï¼Œç„¶åå˜æ¢æˆæŸå¤±å‡½æ•°ï¼Œæ±‚æŸå¤±å‡½æ•°æœ€å°å€¼æ¥è®¡ç®—æ¨¡å‹å‚æ•°ï¼Œä»è€Œå¾—å‡ºæ¨¡å‹ã€‚ sklearnè°ƒç”¨æ¥å£1class sklearn.linear_model.LogisticRegression(penalty=â€™l2â€™, dual=False, tol=0.0001, C=1.0, fit_intercept=True, intercept_scaling=1, class_weight=None, *random_state=None*, solver=â€™liblinearâ€˜, max_iter=100, multi_class=â€™ovrâ€™, verbose=0, warm_start=False, n_jobs=1) å‚æ•°** =&gt; penalty : str, â€˜l1â€™ or â€˜l2â€™ LogisticRegressionå’ŒLogisticRegressionCVé»˜è®¤å°±å¸¦äº†æ­£åˆ™åŒ–é¡¹ã€‚penaltyå‚æ•°å¯é€‰æ‹©çš„å€¼ä¸ºâ€l1â€å’Œâ€l2â€ï¼Œåˆ†åˆ«å¯¹åº”L1çš„æ­£åˆ™åŒ–å’ŒL2çš„æ­£åˆ™åŒ–ï¼Œé»˜è®¤æ˜¯L2çš„æ­£åˆ™åŒ–ã€‚ åœ¨è°ƒå‚æ—¶å¦‚æœæˆ‘ä»¬ä¸»è¦çš„ç›®çš„åªæ˜¯ä¸ºäº†è§£å†³è¿‡æ‹Ÿåˆï¼Œä¸€èˆ¬penaltyé€‰æ‹©L2æ­£åˆ™åŒ–å°±å¤Ÿäº†ã€‚ä½†æ˜¯å¦‚æœé€‰æ‹©L2æ­£åˆ™åŒ–å‘ç°è¿˜æ˜¯è¿‡æ‹Ÿåˆï¼Œå³é¢„æµ‹æ•ˆæœå·®çš„æ—¶å€™ï¼Œå°±å¯ä»¥è€ƒè™‘L1æ­£åˆ™åŒ–ã€‚ å¦å¤–ï¼Œå¦‚æœæ¨¡å‹çš„ç‰¹å¾éå¸¸å¤šï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€äº›ä¸é‡è¦çš„ç‰¹å¾ç³»æ•°å½’é›¶ï¼Œä»è€Œè®©æ¨¡å‹ç³»æ•°ç¨€ç–åŒ–çš„è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨L1æ­£åˆ™åŒ–ã€‚ penaltyå‚æ•°çš„é€‰æ‹©ä¼šå½±å“æˆ‘ä»¬æŸå¤±å‡½æ•°ä¼˜åŒ–ç®—æ³•çš„é€‰æ‹©ã€‚å³å‚æ•°solverçš„é€‰æ‹©ï¼Œå¦‚æœæ˜¯L2æ­£åˆ™åŒ–ï¼Œé‚£ä¹ˆ4ç§å¯é€‰çš„ç®—æ³•{â€˜newton-cgâ€™, â€˜lbfgsâ€™, â€˜liblinearâ€™, â€˜sagâ€™}éƒ½å¯ä»¥é€‰æ‹©ã€‚ ä½†æ˜¯å¦‚æœpenaltyæ˜¯L1æ­£åˆ™åŒ–çš„è¯ï¼Œå°±åªèƒ½é€‰æ‹©â€˜liblinearâ€™äº†ã€‚è¿™æ˜¯å› ä¸ºL1æ­£åˆ™åŒ–çš„æŸå¤±å‡½æ•°ä¸æ˜¯è¿ç»­å¯å¯¼çš„ï¼Œè€Œ{â€˜newton-cgâ€™, â€˜lbfgsâ€™,â€˜sagâ€™}è¿™ä¸‰ç§ä¼˜åŒ–ç®—æ³•æ—¶éƒ½éœ€è¦æŸå¤±å‡½æ•°çš„ä¸€é˜¶æˆ–è€…äºŒé˜¶è¿ç»­å¯¼æ•°ã€‚è€Œâ€˜liblinearâ€™å¹¶æ²¡æœ‰è¿™ä¸ªä¾èµ–ã€‚ =&gt; dual : bool å¯¹å¶æˆ–è€…åŸå§‹æ–¹æ³•ã€‚Dualåªé€‚ç”¨äºæ­£åˆ™åŒ–ç›¸ä¸ºl2 liblinearçš„æƒ…å†µï¼Œé€šå¸¸æ ·æœ¬æ•°å¤§äºç‰¹å¾æ•°çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¸ºFalse =&gt; tol : float, optional è¿­ä»£ç»ˆæ­¢åˆ¤æ®çš„è¯¯å·®èŒƒå›´ã€‚ =&gt; C : float, default: 1.0 Cä¸ºæ­£åˆ™åŒ–ç³»æ•°Î»çš„å€’æ•°ï¼Œé€šå¸¸é»˜è®¤ä¸º1ã€‚è®¾ç½®è¶Šå°åˆ™å¯¹åº”è¶Šå¼ºçš„æ­£åˆ™åŒ–ã€‚ =&gt; fit_intercept : bool, default: True æ˜¯å¦å­˜åœ¨æˆªè·ï¼Œé»˜è®¤å­˜åœ¨ =&gt; intercept_scaling : float, default 1. ä»…åœ¨æ­£åˆ™åŒ–é¡¹ä¸ºâ€liblinearâ€ï¼Œä¸”fit_interceptè®¾ç½®ä¸ºTrueæ—¶æœ‰ç”¨ã€‚ =&gt; class_weight : dict or â€˜balancedâ€™, default: None class_weightå‚æ•°ç”¨äºæ ‡ç¤ºåˆ†ç±»æ¨¡å‹ä¸­å„ç§ç±»å‹çš„æƒé‡ï¼Œå¯ä»¥ä¸è¾“å…¥ï¼Œå³ä¸è€ƒè™‘æƒé‡ï¼Œæˆ–è€…è¯´æ‰€æœ‰ç±»å‹çš„æƒé‡ä¸€æ ·ã€‚å¦‚æœé€‰æ‹©è¾“å…¥çš„è¯ï¼Œå¯ä»¥é€‰æ‹©balancedè®©ç±»åº“è‡ªå·±è®¡ç®—ç±»å‹æƒé‡ï¼Œ æˆ–è€…æˆ‘ä»¬è‡ªå·±è¾“å…¥å„ä¸ªç±»å‹çš„æƒé‡ï¼Œæ¯”å¦‚å¯¹äº0,1çš„äºŒå…ƒæ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰class_weight={0:0.9, 1:0.1}ï¼Œè¿™æ ·ç±»å‹0çš„æƒé‡ä¸º90%ï¼Œè€Œç±»å‹1çš„æƒé‡ä¸º10%ã€‚ å¦‚æœclass_weighté€‰æ‹©**balanced**ï¼Œé‚£ä¹ˆç±»åº“ä¼šæ ¹æ®è®­ç»ƒæ ·æœ¬é‡æ¥è®¡ç®—æƒé‡ã€‚æŸç§ç±»å‹æ ·æœ¬é‡è¶Šå¤šï¼Œåˆ™æƒé‡è¶Šä½ï¼›æ ·æœ¬é‡è¶Šå°‘ï¼Œåˆ™æƒé‡è¶Šé«˜ã€‚ å½“class_weightä¸ºbalancedæ—¶ï¼Œç±»æƒé‡è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼šn_samples / (n_classes * np.bincount(y)) n_samplesä¸ºæ ·æœ¬æ•°ï¼Œn_classesä¸ºç±»åˆ«æ•°é‡ï¼Œnp.bincount(y)ä¼šè¾“å‡ºæ¯ä¸ªç±»çš„æ ·æœ¬æ•°ï¼Œä¾‹å¦‚y=[1,0,0,1,1],åˆ™np.bincount(y)=[2,3] 0,1åˆ†åˆ«å‡ºç°2æ¬¡å’Œä¸‰æ¬¡ é‚£ä¹ˆ**class_weight**æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ â€‹ åœ¨åˆ†ç±»æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸¤ç±»é—®é¢˜ï¼š â€‹ ç¬¬ä¸€ç§æ˜¯è¯¯åˆ†ç±»çš„ä»£ä»·å¾ˆé«˜ã€‚æ¯”å¦‚å¯¹åˆæ³•ç”¨æˆ·å’Œéæ³•ç”¨æˆ·è¿›è¡Œåˆ†ç±»ï¼Œå°†éæ³•ç”¨æˆ·åˆ†ç±»ä¸ºåˆæ³•ç”¨æˆ·çš„ä»£ä»·å¾ˆé«˜ï¼Œæˆ‘ä»¬å®æ„¿å°†åˆæ³•ç”¨æˆ·åˆ†ç±»ä¸ºéæ³•ç”¨æˆ·ï¼Œè¿™æ—¶å¯ä»¥äººå·¥å†ç”„åˆ«ï¼Œä½†æ˜¯å´ä¸æ„¿å°†éæ³•ç”¨æˆ·åˆ†ç±»ä¸ºåˆæ³•ç”¨æˆ·ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“æé«˜éæ³•ç”¨æˆ·çš„æƒé‡ã€‚ â€‹ ç¬¬äºŒç§æ˜¯æ ·æœ¬æ˜¯é«˜åº¦å¤±è¡¡çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰åˆæ³•ç”¨æˆ·å’Œéæ³•ç”¨æˆ·çš„äºŒå…ƒæ ·æœ¬æ•°æ®10000æ¡ï¼Œé‡Œé¢åˆæ³•ç”¨æˆ·æœ‰9995æ¡ï¼Œéæ³•ç”¨æˆ·åªæœ‰5æ¡ï¼Œå¦‚æœæˆ‘ä»¬ä¸è€ƒè™‘æƒé‡ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„æµ‹è¯•é›†éƒ½é¢„æµ‹ä¸ºåˆæ³•ç”¨æˆ·ï¼Œè¿™æ ·é¢„æµ‹å‡†ç¡®ç‡ç†è®ºä¸Šæœ‰99.95%ï¼Œä½†æ˜¯å´æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©balancedï¼Œè®©ç±»åº“è‡ªåŠ¨æé«˜éæ³•ç”¨æˆ·æ ·æœ¬çš„æƒé‡ã€‚ =&gt; random_state : int, RandomState instance or None, optional, default: None éšæœºæ•°ç§å­ï¼Œé»˜è®¤ä¸ºæ— ï¼Œä»…åœ¨æ­£åˆ™åŒ–ä¼˜åŒ–ç®—æ³•ä¸ºsag,liblinearæ—¶æœ‰ç”¨ã€‚ =&gt; solver : {â€˜newton-cgâ€™, â€˜lbfgsâ€™, â€˜liblinearâ€™, â€˜sagâ€™, â€˜sagaâ€™} solverå‚æ•°å†³å®šäº†æˆ‘ä»¬å¯¹é€»è¾‘å›å½’æŸå¤±å‡½æ•°çš„ä¼˜åŒ–æ–¹æ³•ï¼Œæœ‰4ç§ç®—æ³•å¯ä»¥é€‰æ‹©ï¼Œåˆ†åˆ«æ˜¯ï¼š a) liblinearï¼šä½¿ç”¨äº†å¼€æºçš„liblinearåº“å®ç°ï¼Œå†…éƒ¨ä½¿ç”¨äº†åæ ‡è½´ä¸‹é™æ³•æ¥è¿­ä»£ä¼˜åŒ–æŸå¤±å‡½æ•°ã€‚ b) lbfgsï¼šæ‹Ÿç‰›é¡¿æ³•çš„ä¸€ç§ï¼Œåˆ©ç”¨æŸå¤±å‡½æ•°äºŒé˜¶å¯¼æ•°çŸ©é˜µå³æµ·æ£®çŸ©é˜µæ¥è¿­ä»£ä¼˜åŒ–æŸå¤±å‡½æ•°ã€‚ c) newton-cgï¼šä¹Ÿæ˜¯ç‰›é¡¿æ³•å®¶æ—çš„ä¸€ç§ï¼Œåˆ©ç”¨æŸå¤±å‡½æ•°äºŒé˜¶å¯¼æ•°çŸ©é˜µå³æµ·æ£®çŸ©é˜µæ¥è¿­ä»£ä¼˜åŒ–æŸå¤±å‡½æ•°ã€‚ d) sagï¼šå³éšæœºå¹³å‡æ¢¯åº¦ä¸‹é™ï¼Œæ˜¯æ¢¯åº¦ä¸‹é™æ³•çš„å˜ç§ï¼Œå’Œæ™®é€šæ¢¯åº¦ä¸‹é™æ³•çš„åŒºåˆ«æ˜¯æ¯æ¬¡è¿­ä»£ä»…ä»…ç”¨ä¸€éƒ¨åˆ†çš„æ ·æœ¬æ¥è®¡ç®—æ¢¯åº¦ï¼Œé€‚åˆäºæ ·æœ¬æ•°æ®å¤šçš„æ—¶å€™ï¼ŒSAGæ˜¯ä¸€ç§çº¿æ€§æ”¶æ•›ç®—æ³•ï¼Œè¿™ä¸ªé€Ÿåº¦è¿œæ¯”SGDå¿«ã€‚ ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºï¼Œnewton-cg, lbfgså’Œsagè¿™ä¸‰ç§ä¼˜åŒ–ç®—æ³•æ—¶éƒ½éœ€è¦æŸå¤±å‡½æ•°çš„ä¸€é˜¶æˆ–è€…äºŒé˜¶è¿ç»­å¯¼æ•°ï¼Œå› æ­¤ä¸èƒ½ç”¨äºæ²¡æœ‰è¿ç»­å¯¼æ•°çš„L1æ­£åˆ™åŒ–ï¼Œåªèƒ½ç”¨äºL2æ­£åˆ™åŒ–ã€‚è€Œliblinearåˆ™æ—¢å¯ä»¥ç”¨L1æ­£åˆ™åŒ–ä¹Ÿå¯ä»¥ç”¨L2æ­£åˆ™åŒ–ã€‚ åŒæ—¶ï¼Œsagæ¯æ¬¡ä»…ä»…ä½¿ç”¨äº†éƒ¨åˆ†æ ·æœ¬è¿›è¡Œæ¢¯åº¦è¿­ä»£ï¼Œæ‰€ä»¥å½“æ ·æœ¬é‡å°‘çš„æ—¶å€™ä¸è¦é€‰æ‹©å®ƒï¼Œè€Œå¦‚æœæ ·æœ¬é‡éå¸¸å¤§ï¼Œæ¯”å¦‚å¤§äº10ä¸‡ï¼Œsagæ˜¯ç¬¬ä¸€é€‰æ‹©ã€‚ä½†æ˜¯sagä¸èƒ½ç”¨äºL1æ­£åˆ™åŒ–ï¼Œæ‰€ä»¥å½“ä½ æœ‰å¤§é‡çš„æ ·æœ¬ï¼Œåˆéœ€è¦L1æ­£åˆ™åŒ–çš„è¯å°±è¦è‡ªå·±åšå–èˆäº† =&gt; max_iter : int, optional ä»…åœ¨æ­£åˆ™åŒ–ä¼˜åŒ–ç®—æ³•ä¸ºnewton-cg, sag and lbfgs æ‰æœ‰ç”¨ï¼Œç®—æ³•æ”¶æ•›çš„æœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚ =&gt; multi_class : str, {â€˜ovrâ€™, â€˜multinomialâ€™}, default: â€˜ovrâ€™ OvRçš„æ€æƒ³å¾ˆç®€å•ï¼Œæ— è®ºä½ æ˜¯å¤šå°‘å…ƒé€»è¾‘å›å½’ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥çœ‹åšäºŒå…ƒé€»è¾‘å›å½’ã€‚å…·ä½“åšæ³•æ˜¯ï¼Œå¯¹äºç¬¬Kç±»çš„åˆ†ç±»å†³ç­–ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰ç¬¬Kç±»çš„æ ·æœ¬ä½œä¸ºæ­£ä¾‹ï¼Œé™¤äº†ç¬¬Kç±»æ ·æœ¬ä»¥å¤–çš„æ‰€æœ‰æ ·æœ¬éƒ½ä½œä¸ºè´Ÿä¾‹ï¼Œç„¶ååœ¨ä¸Šé¢åšäºŒå…ƒé€»è¾‘å›å½’ï¼Œå¾—åˆ°ç¬¬Kç±»çš„åˆ†ç±»æ¨¡å‹ã€‚ å…¶ä»–ç±»çš„åˆ†ç±»æ¨¡å‹è·å¾—ä»¥æ­¤ç±»æ¨ã€‚ â€‹ è€ŒMvMåˆ™ç›¸å¯¹å¤æ‚ï¼Œè¿™é‡Œä¸¾MvMçš„ç‰¹ä¾‹one-vs-one(OvO)ä½œè®²è§£ã€‚å¦‚æœæ¨¡å‹æœ‰Tç±»ï¼Œæˆ‘ä»¬æ¯æ¬¡åœ¨æ‰€æœ‰çš„Tç±»æ ·æœ¬é‡Œé¢é€‰æ‹©ä¸¤ç±»æ ·æœ¬å‡ºæ¥ï¼Œä¸å¦¨è®°ä¸ºT1ç±»å’ŒT2ç±»ï¼ŒæŠŠæ‰€æœ‰çš„è¾“å‡ºä¸ºT1å’ŒT2çš„æ ·æœ¬æ”¾åœ¨ä¸€èµ·ï¼ŒæŠŠT1ä½œä¸ºæ­£ä¾‹ï¼ŒT2ä½œä¸ºè´Ÿä¾‹ï¼Œè¿›è¡ŒäºŒå…ƒé€»è¾‘å›å½’ï¼Œ å¾—åˆ°æ¨¡å‹å‚æ•°ã€‚æˆ‘ä»¬ä¸€å…±éœ€è¦T(T-1)/2æ¬¡åˆ†ç±»ã€‚ å¯ä»¥çœ‹å‡ºOvRç›¸å¯¹ç®€å•ï¼Œä½†åˆ†ç±»æ•ˆæœç›¸å¯¹ç•¥å·®ï¼ˆè¿™é‡ŒæŒ‡å¤§å¤šæ•°æ ·æœ¬åˆ†å¸ƒæƒ…å†µï¼ŒæŸäº›æ ·æœ¬åˆ†å¸ƒä¸‹OvRå¯èƒ½æ›´å¥½ï¼‰ã€‚è€ŒMvMåˆ†ç±»ç›¸å¯¹ç²¾ç¡®ï¼Œä½†æ˜¯åˆ†ç±»é€Ÿåº¦æ²¡æœ‰OvRå¿«ã€‚å¦‚æœé€‰æ‹©äº†ovrï¼Œåˆ™4ç§æŸå¤±å‡½æ•°çš„ä¼˜åŒ–æ–¹æ³•liblinearï¼Œnewton-cg,lbfgså’Œsagéƒ½å¯ä»¥é€‰æ‹©ã€‚ ä½†æ˜¯å¦‚æœé€‰æ‹©äº†multinomial,åˆ™åªèƒ½é€‰æ‹©newton-cg, lbfgså’Œsagäº†ã€‚ =&gt; verbose : int, default: 0 =&gt; warm_start : bool, default: False =&gt; n_jobs : int, default: 1 å¦‚æœmulti_class =â€™ovrâ€™â€œï¼Œå¹¶è¡Œæ•°ç­‰äºCPUå†…æ ¸æ•°é‡ã€‚å½“â€œsolverâ€è®¾ç½®ä¸ºâ€œliblinearâ€æ—¶ï¼Œæ— è®ºæ˜¯å¦æŒ‡å®šâ€œmulti_classâ€ï¼Œè¯¥å‚æ•°å°†è¢«å¿½ç•¥ã€‚å¦‚æœç»™å®šå€¼-1ï¼Œåˆ™ä½¿ç”¨æ‰€æœ‰å†…æ ¸ã€‚]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>sklearn</tag>
        <tag>ç›‘ç£å­¦ä¹ </tag>
        <tag>é€»è¾‘å›å½’</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¿‡æ‹Ÿåˆã€æ­£åˆ™åŒ–(Regularization)]]></title>
    <url>%2F2018%2F11%2F02%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%AD%A3%E5%88%99%E5%8C%96%2F</url>
    <content type="text"><![CDATA[1.è¿‡æ‹Ÿåˆé—®é¢˜è¿‡æ‹Ÿåˆé—®é¢˜æè¿°å¸¸ç”¨çš„æœºå™¨å­¦ä¹ ä¼˜åŒ–ç®—æ³•ï¼ŒåŒ…æ‹¬çº¿æ€§å›å½’å’Œé€»è¾‘å›å½’ï¼Œå®ƒä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°è§£å†³è®¸å¤šé—®é¢˜ï¼Œä½†æ˜¯å½“å°†å®ƒä»¬åº”ç”¨åˆ°æŸäº›ç‰¹å®šçš„æœºï¨¸å­¦ä¹ åº”ç”¨æ—¶ï¼Œä¼šé‡åˆ°è¿‡æ‹Ÿåˆ(over-fitting)çš„é—®é¢˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®ƒä»¬æ•ˆæœå¾ˆå·®ã€‚ä½¿ç”¨æ­£åˆ™åŒ–æŠ€æœ¯å¯ä»¥å‡å°‘è¿‡æ‹Ÿåˆé—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬æœ‰éå¸¸å¤šçš„ç‰¹å¾ï¼Œæˆ‘ä»¬é€šè¿‡å­¦ä¹ å¾—åˆ°çš„å‡è®¾å¯èƒ½èƒ½å¤Ÿéå¸¸å¥½åœ°é€‚åº”è®­ç»ƒé›†ï¼ˆä»£ä»·å‡½æ•°å¯èƒ½å‡ ä¹ä¸º0ï¼‰ï¼Œä½†æ˜¯å¯èƒ½ä¼šï¥§èƒ½æ¨å¹¿åˆ°æ–°çš„æ•°æ®ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªå›å½’é—®é¢˜çš„ï¦µå­ï¼š ç¬¬ä¸€ä¸ªæ¨¡å‹æ˜¯ä¸€ä¸ªçº¿æ€§æ¨¡å‹ï¼Œæ¬ æ‹Ÿåˆï¼Œï¥§èƒ½å¾ˆå¥½åœ°é€‚åº”æˆ‘ä»¬çš„è®­ç»ƒé›†ï¼›ç¬¬ä¸‰ä¸ªæ¨¡å‹æ˜¯ä¸€ä¸ªå››æ¬¡æ–¹çš„æ¨¡å‹ï¼Œè¿‡äºå¼ºè°ƒæ‹ŸåˆåŸå§‹æ•°æ®ï¼Œè€Œä¸¢å¤±ï¦ºç®—æ³•çš„æœ¬è´¨ï¼šé¢„æµ‹æ–°æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè‹¥ç»™å‡ºä¸€ä¸ªæ–°çš„å€¼ä½¿ä¹‹é¢„æµ‹ï¼Œå®ƒå°†è¡¨ç°çš„å¾ˆå·®ï¼Œæ˜¯è¿‡æ‹Ÿåˆï¼Œè™½ç„¶èƒ½éå¸¸å¥½åœ°é€‚åº”æˆ‘ä»¬çš„è®­ç»ƒé›†ä½†åœ¨æ–°è¾“å…¥å˜ï¥¾è¿›ï¨ˆé¢„æµ‹æ—¶å¯èƒ½ä¼šæ•ˆæœï¥§å¥½ï¼›è€Œä¸­é—´çš„æ¨¡å‹ä¼¼ä¹æœ€åˆé€‚ã€‚åˆ†ç±»é—®é¢˜ä¸­ä¹Ÿå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼š å°±ä»¥å¤šé¡¹å¼ï§¤è§£ï¼Œ çš„æ¬¡æ•°è¶Šé«˜ï¼Œæ‹Ÿåˆçš„è¶Šå¥½ï¼Œä½†ç›¸åº”çš„é¢„æµ‹çš„èƒ½ï¦Šå°±å¯èƒ½å˜å·®ã€‚ å¦‚æœæˆ‘ä»¬å‘ç°ï¦ºè¿‡æ‹Ÿåˆé—®é¢˜ï¼Œåº”è¯¥å¦‚ä½•å¤„ï§¤ï¼Ÿ ä¸¢å¼ƒä¸€äº›ï¥§èƒ½å¸®åŠ©æˆ‘ä»¬æ­£ç¡®é¢„æµ‹çš„ç‰¹å¾ã€‚å¯ä»¥æ˜¯æ‰‹å·¥é€‰æ‹©ä¿ï§å“ªäº›ç‰¹å¾ï¼Œæˆ–è€…ä½¿ç”¨ä¸€äº›æ¨¡å‹é€‰æ‹©çš„ç®—æ³•æ¥å¸®å¿™ï¼ˆï¦µå¦‚PCAï¼‰ æ­£åˆ™åŒ–ã€‚ ä¿ï§æ‰€æœ‰çš„ç‰¹å¾ï¼Œä½†æ˜¯å‡å°‘å‚æ•°çš„å¤§å°ï¼ˆmagnitudeï¼‰ã€‚ 2.ä»£ä»·å‡½æ•°ä¸Šé¢çš„å›å½’é—®é¢˜ä¸­å¦‚æœæˆ‘ä»¬çš„æ¨¡å‹æ˜¯ï¼š$h_Î¸(x) = Î¸_0 + Î¸_1x_1 + Î¸_2x_2^2 + Î¸_3x_3^3 + Î¸_4x_4^4$ æˆ‘ä»¬å¯ä»¥ä»ä¹‹å‰çš„äº‹ï¦µä¸­çœ‹å‡ºï¼Œæ­£æ˜¯é‚£äº›é«˜æ¬¡é¡¹å¯¼è‡´ï¦ºè¿‡æ‹Ÿåˆçš„äº§ç”Ÿï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬èƒ½è®©è¿™äº›é«˜æ¬¡é¡¹çš„ç³»æ•°æ¥è¿‘äº0çš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½å¾ˆå¥½çš„æ‹Ÿåˆï¦ºã€‚ æ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°è¿™äº›å‚æ•° Î¸ çš„å€¼ï¼Œè¿™å°±æ˜¯æ­£åˆ™åŒ–çš„åŸºæœ¬æ–¹æ³•ã€‚ æˆ‘ä»¬å†³å®šè¦å‡å°‘Î¸3å’Œ Î¸4çš„å¤§å°ï¼Œæˆ‘ä»¬è¦åšçš„ï¥¥æ˜¯ä¿®æ”¹ä»£ä»·å‡½æ•°ï¼Œåœ¨å…¶ä¸­ Î¸3å’Œ Î¸4 è®¾ç½®ä¸€ç‚¹æƒ©ç½šã€‚è¿™æ ·åšçš„è¯ï¼Œæˆ‘ä»¬åœ¨å°è¯•æœ€å°åŒ–ä»£ä»·æ—¶ä¹Ÿéœ€è¦å°†è¿™ä¸ªæƒ©ç½šçº³å…¥è€ƒè™‘ä¸­ï¼Œå¹¶æœ€ç»ˆå¯¼è‡´é€‰æ‹©è¾ƒå°ä¸€äº›çš„ Î¸3å’ŒÎ¸4ã€‚ ä¿®æ”¹åçš„ä»£ä»·å‡½æ•°å¦‚ä¸‹ï¼š $min_Î¸ {1\over 2m}[h_Î¸(x^{(i)} - y^{(i)})^2 + 1000Î¸_3^2 + 10000Î¸_4^2]$ é€šè¿‡è¿™æ ·çš„ä»£ä»·å‡½æ•°é€‰æ‹©å‡ºçš„ Î¸3å’Œ Î¸4 å¯¹é¢„æµ‹ç»“æœçš„å½±å“å°±æ¯”ä¹‹å‰è¦å°è®¸å¤šï¼Œ å› ä¸ºä¸ºäº†Î¸3å’ŒÎ¸4çš„ç³»æ•°å¾ˆå¤§ï¼Œä¸ºäº†ä¼˜åŒ–ä»£ä»·å‡½æ•°ï¼Œ å…¶å€¼ä¸€å®šä¼šç‰¹åˆ«çš„å°ã€‚ å‡å¦‚æˆ‘ä»¬æœ‰éå¸¸å¤šçš„ç‰¹å¾ï¼Œæˆ‘ä»¬å¹¶ï¥§çŸ¥é“å…¶ä¸­å“ªäº›ç‰¹å¾æˆ‘ä»¬è¦æƒ©ç½šï¼Œæˆ‘ä»¬å°†å¯¹æ‰€æœ‰çš„ç‰¹å¾è¿›ï¨ˆæƒ©ç½šï¼Œå¹¶ä¸”è®©ä»£ä»·å‡½æ•°æœ€ä¼˜åŒ–çš„è½¯ä»¶æ¥é€‰æ‹©è¿™äº›æƒ©ç½šçš„ç¨‹åº¦ã€‚è¿™æ ·çš„ç»“æœæ˜¯å¾—åˆ°ï¦ºä¸€ä¸ªè¾ƒä¸ºç®€å•çš„èƒ½é˜²æ­¢è¿‡æ‹Ÿåˆé—®é¢˜çš„å‡è®¾ï¼š $J_Î¸ = {1\over 2m}[\sum_{i=1}^m(h_Î¸(x^{(i)}) - y^{(i)}) + Î»\sum_{j=1}^nÎ¸_j^2]$å…¶ä¸­åˆç§°ä¸ºæ­£åˆ™åŒ–å‚æ•°ï¼ˆRegularization Parameterï¼‰ã€‚ æ³¨ï¼šæ ¹æ®æƒ¯ï¦µï¼Œæˆ‘ä»¬ï¥§å¯¹ Î¸0 è¿›ï¨ˆæƒ©ç½šã€‚ ç»è¿‡æ­£åˆ™åŒ–å¤„ï§¤çš„æ¨¡å‹ä¸åŸæ¨¡å‹çš„å¯èƒ½å¯¹æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚æœé€‰æ‹©çš„æ­£åˆ™åŒ–å‚æ•°Î»è¿‡å¤§ï¼Œåˆ™ä¼šæŠŠæ‰€æœ‰çš„å‚æ•°éƒ½æœ€å°åŒ–ï¦ºï¼Œå¯¼è‡´æ¨¡å‹å˜æˆ $h_Î¸(x) = Î¸_0$ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çº¢è‰²ç›´çº¿æ‰€ç¤ºçš„æƒ…å†µï¼Œé€ æˆæ¬ æ‹Ÿåˆã€‚ é‚£ä¸ºï§½ä¹ˆå¢åŠ çš„ä¸€é¡¹ $Î»\sum_{j=1}^nÎ¸_j^2$ å¯ä»¥ä½¿çš„å€¼å‡å°å‘¢ï¼Ÿ å› ä¸ºå¦‚æœæˆ‘ä»¬ä»¤ Î»çš„å€¼å¾ˆå¤§çš„è¯ï¼Œä¸ºï¦ºä½¿Cost Function å°½å¯èƒ½çš„å°ï¼Œæ‰€æœ‰çš„ Î¸ çš„å€¼ï¼ˆï¥§åŒ…æ‹¬Î¸0ï¼‰ éƒ½ä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°ã€‚ ä½†è‹¥Î»çš„å€¼å¤ªå¤§ï¦ºï¼Œé‚£ä¹ˆï¥§åŒ…æ‹¬Î¸0ï¼‰éƒ½ä¼šè¶‹è¿‘äº0ï¼Œè¿™æ ·æˆ‘ä»¬æ‰€å¾—åˆ°çš„åªèƒ½æ˜¯ä¸€æ¡å¹³ï¨ˆäºè½´çš„ç›´çº¿ã€‚ æ‰€ä»¥å¯¹äºæ­£åˆ™åŒ–ï¼Œæˆ‘ä»¬è¦å–ä¸€ä¸ªåˆï§¤çš„ Î» çš„å€¼ï¼Œè¿™æ ·æ‰èƒ½ï¤å¥½çš„åº”ç”¨æ­£åˆ™åŒ–ã€‚ å›é¡¾ä¸€ä¸‹ä»£ä»·å‡½æ•°ï¼Œä¸ºï¦ºä½¿ç”¨æ­£åˆ™åŒ–ï¼Œè®©æˆ‘ä»¬æŠŠè¿™äº›æ¦‚å¿µåº”ç”¨åˆ°åˆ°çº¿æ€§å›å½’å’Œé€»è¾‘å›å½’ä¸­å»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©ä»–ä»¬é¿å…è¿‡åº¦æ‹Ÿåˆï¦ºã€‚ 3.æ­£åˆ™åŒ–çº¿æ€§å›å½’å¯¹äºçº¿æ€§å›å½’çš„æ±‚è§£ï¼Œæˆ‘ä»¬ä¹‹å‰æ¨å¯¼ï¦ºä¸¤ç§å­¦ä¹ ç®—æ³•ï¼šä¸€ç§åŸºäºæ¢¯åº¦ä¸‹é™ï¼Œä¸€ç§åŸºäºæ­£è§„æ–¹ç¨‹ã€‚æ­£åˆ™åŒ–çº¿æ€§å›å½’çš„ä»£ä»·å‡½æ•°ä¸ºï¼š $J_{(Î¸)} = {1\over 2m} \sum_{i=1}^m[(h_Î¸(x^{(i)})-y^{(i)})^2 + Î»\sum_{j=1}^nÎ¸_j^2]$ å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•ä»¤è¿™ä¸ªä»£ä»·å‡½æ•°æœ€å°åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬æœªå¯¹Î¸è¿›ï¨ˆæ­£åˆ™åŒ–ï¼Œæ‰€ä»¥æ¢¯åº¦ä¸‹é™ç®—æ³•å°†åˆ†ä¸¤ç§æƒ…å½¢ï¼š 4.æ­£è§„æ–¹ç¨‹é€»è¾‘å›å½’é’ˆå¯¹é€»è¾‘å›å½’é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„è¯¾ç¨‹å·²ç»å­¦ä¹ è¿‡ä¸¤ç§ä¼˜åŒ–ç®—æ³•ï¼šæˆ‘ä»¬é¦–å…ˆå­¦ä¹ ï¦ºä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ¥ä¼˜åŒ–ä»£ä»·å‡½æ•°J(Î¸)ï¼Œæ¥ä¸‹æ¥å­¦ä¹ ï¦ºï¤é«˜çº§çš„ä¼˜åŒ–ç®—æ³•ï¼Œè¿™äº›é«˜çº§ä¼˜åŒ–ç®—æ³•éœ€è¦ä½ è‡ªå·±è®¾è®¡ä»£ä»·å‡½æ•°J(Î¸)ã€‚ ç”¨Pythonå®ç° 123456789import numpy as npdef costReg(theta, X, y, learningRate): theta = np.matrix(theta) X = np.matrix(X) y = np.matrix(y) first = np.multiply(â€y, np.log(sigmoid(X*theta.T))) second = np.multiply((1 â€ y), np.log(1 â€ sigmoid(X*theta.T))) reg = (learningRate / (2 * len(X))* np.sum(np.power(theta[:,1:theta.shape[1]],2)) return np.sum(first â€ second) / (len(X)) + reg è¦æœ€å°åŒ–è¯¥ä»£ä»·å‡½æ•°ï¼Œé€šè¿‡æ±‚å¯¼ï¼Œå¾—å‡ºæ¢¯åº¦ä¸‹é™ç®—æ³•ä¸ºï¼š æ³¨ï¼šçœ‹ä¸Šå»åŒçº¿æ€§å›å½’ä¸€æ ·ï¼Œä½†æ˜¯çŸ¥é“ $h_Î¸(x) = g(Î¸^TX)$ ï¼Œæ‰€ä»¥ä¸çº¿æ€§å›å½’ï¥§åŒã€‚ Octave ä¸­ï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥ç”¨fminuc å‡½æ•°æ¥æ±‚è§£ä»£ä»·å‡½æ•°æœ€å°åŒ–çš„å‚æ•°ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯Î¸0å‚æ•°çš„ï¤æ–°è§„åˆ™ä¸å…¶ä»–æƒ…å†µï¥§åŒã€‚ æ³¨æ„ï¼š è™½ç„¶æ­£åˆ™åŒ–çš„é€»è¾‘å›å½’ä¸­çš„æ¢¯åº¦ä¸‹é™å’Œæ­£åˆ™åŒ–çš„çº¿æ€§å›å½’ä¸­çš„è¡¨è¾¾å¼çœ‹èµ·æ¥ä¸€æ ·ï¼Œä½†ç”±äºä¸¤è€…hÎ¸(x)çš„ï¥§åŒæ‰€ä»¥è¿˜æ˜¯æœ‰å¾ˆå¤§å·®åˆ«ã€‚ Î¸ï¥§å‚ä¸å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªæ­£åˆ™åŒ–ã€‚ 5.å…¶ä»–é˜²æ­¢è¿‡æ‹Ÿåˆçš„æ–¹æ³•DropoutDropoutæ˜¯åœ¨æ·±åº¦å­¦ä¹ ä¸­é™ä½è¿‡æ‹Ÿåˆé£é™©çš„å¸¸è§æ–¹æ³•ï¼Œå®ƒæ˜¯ç”±å¤§ç‰›Hintonè€çˆ·å­æå‡ºçš„ã€‚è€çˆ·å­è®¤ä¸ºåœ¨ç¥ç»ç½‘ç»œäº§ç”Ÿè¿‡æ‹Ÿåˆä¸»è¦æ˜¯å› ä¸ºç¥ç»å…ƒä¹‹é—´çš„ååŒä½œç”¨äº§ç”Ÿçš„ã€‚å› æ­¤è€çˆ·å­åœ¨ç¥ç»ç½‘ç»œè¿›è¡Œè®­ç»ƒçš„æ—¶å€™ï¼Œè®©éƒ¨åˆ†ç¥ç»å…ƒå¤±æ´»ï¼Œè¿™æ ·å°±é˜»æ–­äº†éƒ¨åˆ†ç¥ç»å…ƒä¹‹é—´çš„ååŒä½œç”¨ï¼Œä»è€Œå¼ºåˆ¶è¦æ±‚ä¸€ä¸ªç¥ç»å…ƒå’ŒéšæœºæŒ‘é€‰å‡ºçš„ç¥ç»å…ƒå…±åŒè¿›è¡Œå·¥ä½œï¼Œå‡è½»äº†éƒ¨åˆ†ç¥ç»å…ƒä¹‹é—´çš„è”åˆé€‚åº”æ€§ã€‚Dropoutçš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š 1.å¯¹ l å±‚ç¬¬ j ä¸ªç¥ç»å…ƒäº§ç”Ÿä¸€ä¸ªéšæœºæ•° $r^{(l)}_jâˆ¼Bernouli(p)$ 2.å°† l å±‚ç¬¬ j ä¸ªç¥ç»å…ƒçš„è¾“å…¥ä¹˜ä¸Šäº§ç”Ÿçš„éšæœºæ•°ä½œä¸ºè¿™ä¸ªç¥ç»å…ƒæ–°çš„è¾“å…¥ï¼š$x^{(l)âˆ—}_j=x^{(l)}_jâˆ—r^{(l)}_j$ 3.æ­¤æ—¶ç¬¬ l å±‚ç¬¬ j ä¸ªç¥ç»å…ƒçš„è¾“å‡ºä¸ºï¼š$y{(l+1)}j=f(âˆ‘^k{j=1}(w^{(l+1)}_j âˆ— x^{(l)âˆ—}_j + b^{(l+1)}))$å…¶ä¸­ï¼Œkä¸ºç¬¬lå±‚ç¥ç»å…ƒçš„ä¸ªæ•°ï¼Œfä¸ºè¯¥ç¥ç»å…ƒçš„æ¿€æ´»å‡½æ•°ï¼Œbä¸ºåç½®ï¼Œwä¸ºæƒé‡å‘é‡ã€‚æ³¨æ„ï¼šå½“æˆ‘ä»¬é‡‡ç”¨äº†Dropoutä¹‹åå†è®­ç»ƒç»“æŸä¹‹åï¼Œåº”å½“å°†ç½‘ç»œçš„æƒé‡ä¹˜ä¸Šæ¦‚ç‡på¾—åˆ°æµ‹è¯•ç½‘ç»œçš„æƒé‡ï¼Œæˆ–è€…å¯ä»¥åœ¨è®­ç»ƒæ—¶ï¼Œå°†æ ·æœ¬ä¹˜ä¸Š 1/Pã€‚ æå‰ç»ˆæ­¢åœ¨å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬çš„æ•°æ®é›†åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œè®­ç»ƒé›†ã€éªŒè¯é›†ã€æµ‹è¯•é›†ã€‚æˆ‘ä»¬åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æ¯éš”ä¸€å®šé‡çš„stepï¼Œä½¿ç”¨éªŒè¯é›†å¯¹è®­ç»ƒçš„æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ¨¡å‹åœ¨è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„æŸå¤±å˜åŒ–å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥çœ‹å‡ºï¼Œæ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„è¯¯å·®åœ¨ä¸€å¼€å§‹æ˜¯éšç€è®­ç»ƒé›†çš„è¯¯å·®çš„ä¸‹é™è€Œä¸‹é™çš„ã€‚å½“è¶…è¿‡ä¸€å®šè®­ç»ƒæ­¥æ•°åï¼Œæ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„è¯¯å·®è™½ç„¶è¿˜åœ¨ä¸‹é™ï¼Œä½†æ˜¯åœ¨éªŒè¯é›†ä¸Šçš„è¯¯å·®å´ä¸åœ¨ä¸‹é™äº†ã€‚æ­¤æ—¶æˆ‘ä»¬çš„æ¨¡å‹å°±è¿‡æ‹Ÿåˆäº†ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿæˆ‘ä»¬è®­ç»ƒæ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„è¯¯å·®ï¼Œä¸€æ—¦å½“éªŒè¯é›†çš„è¯¯å·®ä¸å†ä¸‹é™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æå‰ç»ˆæ­¢æˆ‘ä»¬è®­ç»ƒçš„æ¨¡å‹ã€‚ å¢åŠ æ ·æœ¬é‡åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œä½ ä¼šå‘ç°ï¼Œä¸Šé¢è®²è¿°çš„é‚£äº›æŠ€å·§è™½ç„¶éƒ½å¯ä»¥å‡è½»è¿‡æ‹Ÿåˆçš„é£é™©ï¼Œä½†æ˜¯å´éƒ½æ¯”ä¸ä¸Šå¢åŠ æ ·æœ¬é‡æ¥çš„æ›´å®åœ¨ã€‚ ä¸ºä»€ä¹ˆå¢åŠ æ ·æœ¬å¯ä»¥å‡è½»è¿‡æ‹Ÿåˆçš„é£é™©å‘¢ï¼Ÿè¿™ä¸ªè¦ä»è¿‡æ‹Ÿåˆæ˜¯å•¥æ¥è¯´ã€‚è¿‡æ‹Ÿåˆå¯ä»¥ç†è§£ä¸ºæˆ‘ä»¬çš„æ¨¡å‹å¯¹æ ·æœ¬é‡å­¦ä¹ çš„å¤ªå¥½äº†ï¼ŒæŠŠä¸€äº›æ ·æœ¬çš„ç‰¹æ®Šçš„ç‰¹å¾å½“åšæ˜¯æ‰€æœ‰æ ·æœ¬éƒ½å…·æœ‰çš„ç‰¹å¾ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬æ¨¡å‹å»è®­ç»ƒå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªä¸œè¥¿æ˜¯ä¸æ˜¯å¶å­æ—¶ï¼Œæˆ‘ä»¬æ ·æœ¬ä¸­å¶å­å¦‚æœéƒ½æ˜¯é”¯é½¿çŠ¶çš„è¯ï¼Œå¦‚æœæ¨¡å‹äº§ç”Ÿè¿‡æ‹Ÿåˆäº†ï¼Œä¼šè®¤ä¸ºå¶å­éƒ½æ˜¯é”¯é½¿çŠ¶çš„ï¼Œè€Œä¸æ˜¯é”¯é½¿çŠ¶çš„å°±ä¸æ˜¯å¶å­äº†ã€‚å¦‚æœæ­¤æ—¶æˆ‘ä»¬æŠŠä¸æ˜¯é”¯é½¿çŠ¶çš„å¶å­æ•°æ®å¢åŠ è¿›æ¥ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„æ¨¡å‹å°±ä¸ä¼šå†è¿‡æ‹Ÿåˆäº†ã€‚å› æ­¤å…¶å®ä¸Šè¿°çš„é‚£äº›æŠ€å·§è™½ç„¶æœ‰ç”¨ï¼Œä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ ä¼šå‘ç°ï¼Œå…¶å®å¤§å¤šæ•°æƒ…å†µéƒ½æ¯”ä¸ä¸Šå¢åŠ æ ·æœ¬æ•°æ®æ¥çš„å®åœ¨ã€‚]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ­£åˆ™åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sklearn çº¿å‹å›å½’]]></title>
    <url>%2F2018%2F10%2F31%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2Fsklearn%20%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92%2F</url>
    <content type="text"><![CDATA[ç®€å•çº¿æ€§å›å½’çº¿æ€§å›å½’æ˜¯æ•°æ®æŒ–æ˜ä¸­çš„åŸºç¡€ç®—æ³•ä¹‹ä¸€ï¼Œä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œåœ¨å­¦ä¹ å‡½æ•°çš„æ—¶å€™å·²ç»å¼€å§‹æ¥è§¦çº¿æ€§å›å½’äº†ï¼Œåªä¸è¿‡é‚£æ—¶å€™å¹¶æ²¡æœ‰æ¶‰åŠåˆ°è¯¯å·®é¡¹ã€‚çº¿æ€§å›å½’çš„æ€æƒ³å…¶å®å°±æ˜¯è§£ä¸€ç»„æ–¹ç¨‹ï¼Œå¾—åˆ°å›å½’å‡½æ•°ï¼Œä¸è¿‡åœ¨å‡ºç°è¯¯å·®é¡¹ä¹‹åï¼Œæ–¹ç¨‹çš„è§£æ³•å°±å­˜åœ¨äº†æ”¹å˜ï¼Œä¸€èˆ¬ä½¿ç”¨æœ€å°äºŒä¹˜æ³•è¿›è¡Œè®¡ç®—ã€‚ ä½¿ç”¨sklearn.linear_model.LinearRegressionè¿›è¡Œçº¿æ€§å›å½’sklearnå¯¹Data Miningçš„å„ç±»ç®—æ³•å·²ç»æœ‰äº†è¾ƒå¥½çš„å°è£…ï¼ŒåŸºæœ¬å¯ä»¥ä½¿ç”¨fitã€predictã€scoreæ¥è®­ç»ƒã€è¯„ä»·æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼Œä¸€ä¸ªç®€å•çš„ä¾‹å­å¦‚ä¸‹ï¼š 123456789from sklearn import linear_modelclf = linear_model.LinearRegression()X = [[0,0],[1,1],[2,2]]y = [0,1,2]clf.fit(X,y)print(clf.coef_)[ 0.5 0.5]print(clf.intercept_)1.11022302463e-16 LinearRegressionå·²ç»å®ç°äº†å¤šå…ƒçº¿æ€§å›å½’æ¨¡å‹ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è®¡ç®—ä¸€å…ƒçº¿æ€§æ¨¡å‹ï¼Œé€šè¿‡ä½¿ç”¨list[list]ä¼ é€’æ•°æ®å°±è¡Œã€‚ä¸‹é¢æ˜¯LinearRegressionçš„å…·ä½“è¯´æ˜ã€‚ ä½¿ç”¨æ–¹æ³•å®ä¾‹åŒ–sklearnä¸€ç›´ç§‰æ‰¿ç€ç®€æ´ä¸ºç¾å¾—æ€æƒ³è®¾è®¡ç€ä¼°è®¡å™¨ï¼Œå®ä¾‹åŒ–çš„æ–¹å¼å¾ˆç®€å•ï¼Œä½¿ç”¨clf = LinearRegression()å°±å¯ä»¥å®Œæˆï¼Œä½†æ˜¯ä»ç„¶æ¨èçœ‹ä¸€ä¸‹å‡ ä¸ªå¯èƒ½ä¼šç”¨åˆ°çš„å‚æ•°ï¼š fit_interceptï¼šæ˜¯å¦å­˜åœ¨æˆªè·ï¼Œé»˜è®¤å­˜åœ¨ normalizeï¼šæ ‡å‡†åŒ–å¼€å…³ï¼Œé»˜è®¤å…³é—­ è¿˜æœ‰ä¸€äº›å‚æ•°æ„Ÿè§‰ä¸æ˜¯å¤ªæœ‰ç”¨ï¼Œå°±ä¸å†è¯´æ˜äº†ï¼Œå¯ä»¥å»å®˜ç½‘æ–‡æ¡£ä¸­æŸ¥çœ‹ã€‚ å›å½’å…¶å®åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å·²ç»ä½¿ç”¨äº†fitè¿›è¡Œå›å½’è®¡ç®—äº†ï¼Œä½¿ç”¨çš„æ–¹æ³•ä¹Ÿæ˜¯ç›¸å½“çš„ç®€å•ã€‚ fit(X,y,sample_weight=None)ï¼šX,yä»¥çŸ©é˜µçš„æ–¹å¼ä¼ å…¥ï¼Œè€Œsample_weightåˆ™æ˜¯æ¯æ¡æµ‹è¯•æ•°æ®çš„æƒé‡ï¼ŒåŒæ ·ä»¥arrayæ ¼å¼ä¼ å…¥ã€‚ predict(X)ï¼šé¢„æµ‹æ–¹æ³•ï¼Œå°†è¿”å›é¢„æµ‹å€¼y_pred score(X,y,sample_weight=None)ï¼šè¯„åˆ†å‡½æ•°ï¼Œå°†è¿”å›ä¸€ä¸ªå°äº1çš„å¾—åˆ†ï¼Œå¯èƒ½ä¼šå°äº0 æ–¹ç¨‹LinearRegressionå°†æ–¹ç¨‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†å­˜æ”¾ï¼Œcoef_å­˜æ”¾å›å½’ç³»æ•°ï¼Œintercept_åˆ™å­˜æ”¾æˆªè·ï¼Œå› æ­¤è¦æŸ¥çœ‹æ–¹ç¨‹ï¼Œå°±æ˜¯æŸ¥çœ‹è¿™ä¸¤ä¸ªå˜é‡çš„å–å€¼ã€‚ å¤šé¡¹å¼å›å½’å…¶å®ï¼Œå¤šé¡¹å¼å°±æ˜¯å¤šå…ƒå›å½’çš„ä¸€ä¸ªå˜ç§ï¼Œåªä¸è¿‡æ˜¯åŸæ¥éœ€è¦ä¼ å…¥çš„æ˜¯Xå‘é‡ï¼Œè€Œå¤šé¡¹å¼åˆ™åªè¦ä¸€ä¸ªxå€¼å°±è¡Œã€‚é€šè¿‡å°†xæ‰©å±•ä¸ºæŒ‡å®šé˜¶æ•°çš„å‘é‡ï¼Œå°±å¯ä»¥ä½¿ç”¨LinearRegressionè¿›è¡Œå›å½’äº†ã€‚sklearnå·²ç»æä¾›äº†æ‰©å±•çš„æ–¹æ³•â€”â€”sklearn.preprocessing.PolynomialFeaturesã€‚åˆ©ç”¨è¿™ä¸ªç±»å¯ä»¥è½»æ¾çš„å°†xæ‰©å±•ä¸ºXå‘é‡ï¼Œä¸‹é¢æ˜¯å®ƒçš„ä½¿ç”¨æ–¹æ³•ï¼š 123456789&gt;&gt;&gt; from sklearn.preprocessing import PolynomialFeatures&gt;&gt;&gt; X_train = [[1],[2],[3],[4]]&gt;&gt;&gt; quadratic_featurizer = PolynomialFeatures(degree=2)&gt;&gt;&gt; X_train_quadratic = quadratic_featurizer.fit_transform(X_train)&gt;&gt;&gt; print(X_train_quadratic)[[ 1 1 1] [ 1 2 4] [ 1 3 9] [ 1 4 16]] ç»è¿‡ä»¥ä¸Šå¤„ç†ï¼Œå°±å¯ä»¥ä½¿ç”¨LinearRegressionè¿›è¡Œå›å½’è®¡ç®—äº†ã€‚]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>sklearn</tag>
        <tag>çº¿å‹å›å½’</tag>
        <tag>ç›‘ç£å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€»è¾‘å›å½’ & åˆ†ç±»é—®é¢˜]]></title>
    <url>%2F2018%2F10%2F31%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%2F</url>
    <content type="text"><![CDATA[1. åˆ†ç±»é—®é¢˜åœ¨åˆ†ç±»é—®é¢˜ä¸­ï¼Œå¦‚æœæƒ³è¦é¢„æµ‹çš„å˜é‡yæ˜¯ç¦»æ•£çš„å€¼ï¼Œé‚£ä¹ˆå¯ä»¥åªç”¨ä¸€ç§å«åšé€»è¾‘å›å½’(logistic regression)çš„ç®—æ³•,è¿™æ˜¯åœ¨ç›®å‰æœ€æµè¡Œçš„ä¸€ç§å­¦ä¹ ç®—æ³•ä¹‹ä¸€ã€‚ åœ¨åˆ†ç±»é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å°è¯•é¢„æµ‹çš„æ˜¯ç»“æœæ˜¯å¦å±äºæŸä¸€ä¸ªç±»ï¼ˆï¦µå¦‚æ­£ç¡®æˆ–é”™è¯¯ï¼‰ã€‚åˆ†ç±»é—®é¢˜çš„ï¦µå­æœ‰ï¼šåˆ¤æ–­ä¸€å°ç”µå­é‚®ä»¶æ˜¯å¦æ˜¯åƒåœ¾é‚®ä»¶ï¼›åˆ¤æ–­ä¸€æ¬¡ï¤Šèäº¤ï§ æ˜¯å¦æ˜¯æ¬ºè¯ˆï¼›ä¹‹å‰æˆ‘ä»¬ä¹Ÿè°ˆåˆ°ï¦ºè‚¿ç˜¤åˆ†ç±»é—®é¢˜çš„ï¦µå­ï¼ŒåŒºåˆ«ä¸€ä¸ªè‚¿ç˜¤æ˜¯æ¶æ€§çš„è¿˜æ˜¯è‰¯æ€§çš„ã€‚ æˆ‘ä»¬å°†å› å˜ï¥¾(dependent variable)å¯èƒ½å±äºçš„ä¸¤ä¸ªç±»åˆ†åˆ«ç§°ä¸ºè´Ÿå‘ç±»ï¼ˆnegative classï¼‰å’Œæ­£å‘ç±»ï¼ˆpositive classï¼‰ï¼Œåˆ™å› å˜ï¥¾yâˆˆ0,1 ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºè´Ÿå‘ç±»ï¼Œ1 è¡¨ç¤ºæ­£å‘ç±»ã€‚ çº¿å‹å›å½’ä¸é€‚åˆåˆ†ç±»é—®é¢˜å¦‚æœæˆ‘ä»¬è¦ç”¨çº¿æ€§å›å½’ç®—æ³•æ¥è§£å†³ä¸€ä¸ªåˆ†ç±»é—®é¢˜ï¼Œå¯¹äºåˆ†ç±»ï¼Œ y å–å€¼ä¸º 0 æˆ–è€…1ï¼Œä½†å¦‚æœä½ ä½¿ç”¨çš„æ˜¯çº¿æ€§å›å½’ï¼Œé‚£ä¹ˆå‡è®¾å‡½æ•°çš„è¾“å‡ºå€¼å¯èƒ½è¿œå¤§äº 1ï¼Œæˆ–è€…è¿œå°äº0ï¼Œå³ä½¿æ‰€æœ‰è®­ç»ƒæ ·æœ¬çš„æ ‡ç­¾ y éƒ½ç­‰äº 0 æˆ– 1ã€‚å°½ç®¡æˆ‘ä»¬çŸ¥é“æ ‡ç­¾åº”è¯¥å–å€¼0 æˆ–è€…1ï¼Œä½†æ˜¯å¦‚æœç®—æ³•å¾—åˆ°çš„å€¼è¿œå¤§äº1æˆ–è€…è¿œå°äº0çš„è¯ï¼Œå°±ä¼šæ„Ÿè§‰å¾ˆå¥‡æ€ªã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„è¦ç ”ç©¶çš„ç®—æ³•å°±å«åšé€»è¾‘å›å½’ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•çš„æ€§è´¨æ˜¯ï¼šå®ƒçš„è¾“å‡ºå€¼æ°¸è¿œåœ¨0åˆ° 1 ä¹‹é—´ã€‚ é€»è¾‘å›å½’ç®—æ³•é€»è¾‘å›å½’ç®—æ³•æ˜¯åˆ†ç±»ç®—æ³•ï¼Œæˆ‘ä»¬å°†å®ƒä½œä¸ºåˆ†ç±»ç®—æ³•ä½¿ç”¨ã€‚æœ‰æ—¶å€™å¯èƒ½å› ä¸ºè¿™ä¸ªç®—æ³•çš„åå­—ä¸­å‡ºç°ï¦ºâ€œå›å½’â€ä½¿ä½ æ„Ÿåˆ°å›°æƒ‘ï¼Œä½†é€»è¾‘å›å½’ç®—æ³•å®é™…ä¸Šæ˜¯ä¸€ç§åˆ†ç±»ç®—æ³•ï¼Œå®ƒé€‚ç”¨äºæ ‡ç­¾ y å–å€¼ç¦»æ•£çš„æƒ…å†µï¼Œå¦‚ï¼š1 0 0 1ã€‚ 2. é€»è¾‘å›å½’è¡¨è¾¾å¼åœ¨åˆ†ç±»é—®é¢˜ä¸­ï¼Œè¦ç”¨ï§½ä¹ˆæ ·çš„å‡½æ•°æ¥è¡¨ç¤ºæˆ‘ä»¬çš„å‡è®¾ã€‚åœ¨è§£å†³åˆ†ç±»é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ†ç±»ï¨¸çš„è¾“å‡ºå€¼åœ¨0å’Œ1ä¹‹é—´ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›æƒ³å‡ºä¸€ä¸ªæ»¡è¶³æŸä¸ªæ€§è´¨çš„å‡è®¾å‡½æ•°ï¼Œè¿™ä¸ªæ€§è´¨æ˜¯å®ƒçš„é¢„æµ‹å€¼è¦åœ¨0å’Œ1ä¹‹é—´ã€‚ ä¸ºä»€ä¹ˆçº¿å‹å›å½’ä¸é€‚åˆåˆ†ç±»é—®é¢˜?å›é¡¾åœ¨ä¸€å¼€å§‹æåˆ°çš„ä¹³è…ºç™Œåˆ†ç±»é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨çº¿æ€§å›å½’çš„æ–¹æ³•æ±‚å‡ºé€‚åˆæ•°æ®çš„ä¸€æ¡ç›´çº¿ï¼š æ ¹æ®çº¿æ€§å›å½’æ¨¡å‹æˆ‘ä»¬åªèƒ½é¢„æµ‹è¿ç»­çš„å€¼ï¼Œç„¶è€Œå¯¹äºåˆ†ç±»é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è¾“å‡º0æˆ–1ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æµ‹ï¼š å½“ $h_Î¸(x) &gt;= 0.5$ æ—¶, é¢„æµ‹y= 1; å½“$h_Î¸(x) &lt; 0.5$ æ—¶ï¼Œé¢„æµ‹y = 0 å¯¹äºä¸Šå›¾æ‰€ç¤ºçš„æ•°æ®ï¼Œè¿™æ ·çš„ä¸€ä¸ªçº¿æ€§æ¨¡å‹ä¼¼ä¹èƒ½å¾ˆå¥½åœ°å®Œæˆåˆ†ç±»ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œ å‡ä½¿æˆ‘ä»¬åˆè§‚æµ‹åˆ°ä¸€ä¸ªéå¸¸å¤§å°ºå¯¸çš„æ¶æ€§è‚¿ç˜¤ï¼Œå°†å…¶ä½œä¸ºå®ï¦µåŠ å…¥åˆ°æˆ‘ä»¬çš„è®­ç»ƒé›†ä¸­æ¥ï¼Œè¿™å°†ä½¿å¾—æˆ‘ä»¬è·å¾—ä¸€æ¡æ–°çš„ç›´çº¿ã€‚ è¿™æ—¶ï¼Œå†ä½¿ç”¨0.5ä½œä¸ºé˜€å€¼æ¥é¢„æµ‹è‚¿ç˜¤æ˜¯è‰¯æ€§è¿˜æ˜¯æ¶æ€§ï¥¥ï¥§åˆé€‚ï¦ºï¼Œ æ‰€ä»¥ä½¿ç”¨çº¿å‹å›å½’æ¨¡å‹ï¼Œå¾ˆéš¾ç¡®å®šæ–­å®šä¸€ä¸ªé—®é¢˜åˆ†ç±»çš„è¾¹ç•Œã€‚å¯ä»¥çœ‹å‡ºï¼Œçº¿æ€§å›å½’æ¨¡å‹ï¼Œå› ä¸ºå…¶é¢„æµ‹çš„å€¼å¯ä»¥è¶…è¶Š[0,1]çš„èŒƒå›´ï¼Œå¹¶ï¥§é€‚åˆè§£å†³åˆ†ç±»è¿™æ ·çš„é—®é¢˜ã€‚ é€»è¾‘å›å½’æ¨¡å‹æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„æ¨¡å‹ï¼Œé€»è¾‘å›å½’ï¼Œè¯¥æ¨¡å‹çš„è¾“å‡ºå˜ï¥¾èŒƒå›´å§‹ç»ˆåœ¨0å’Œ1ä¹‹é—´ã€‚ é€»è¾‘å›å½’æ¨¡å‹çš„å‡è®¾æ˜¯ï¼š $h_Î¸(x) = g(Î¸^TX)$ å‡½æ•°gçš„è¡¨è¾¾å¼ä¸º: $g(z) = {1\over1+e^{-z}}$ å…¶ä¸­: X ä»£è¡¨ç‰¹å¾å‘ï¥¾, gä»£è¡¨é€»è¾‘å‡½æ•°ï¼ˆlogistic function)æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„é€»è¾‘å‡½æ•°ä¸ºSå½¢å‡½æ•°ï¼ˆSigmoid functionï¼‰ g(z) çš„å‡½æ•°å›¾åƒä¸º: å¯¹é€»è¾‘å›å½’æ¨¡å‹ç†è§£ $h_Î¸(x)$ çš„ä½œç”¨æ˜¯ï¼Œå¯¹äºç»™å®šçš„è¾“å…¥å˜é‡ï¼Œæ ¹æ®é€‰æ‹©çš„å‚æ•°è®¡ç®—å‡ºè¾“å‡ºçš„å˜é‡=1 çš„å¯èƒ½æ€§, å³$h_Î¸(x) =P(y=1|x; Î¸)$ ä¾‹å¦‚, å¦‚æœå¯¹äºç»™å®šçš„xï¼Œ é€šè¿‡å·²ç»ç¡®å®šçš„å‚æ•°è®¡ç®—å‡º$h_Î¸(x) = 0.7$ ï¼Œ åˆ™è¡¨ç¤ºæœ‰70%çš„å‡ ç‡yä¸ºæ­£å‘ç±»ï¼Œå“åº”åœ°yä¸ºè´Ÿå‘ç±»çš„å‡ ç‡ä¸º1-0.7=0.3 g(z) ï¼ˆSigmoid functionï¼‰å‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†$Î¸^TX$çš„ç»“æœæ˜ å°„åˆ°0-1ä¹‹é—´ï¼Œ 3. å†³ç­–è¾¹ç•Œå¯¹å†³ç­–è¾¹ç•Œçš„ç†è§£ å†³ç­–è¾¹ç•Œ(decision boundary)ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°å¸®åŠ©æˆ‘ä»¬ç†è§£é€»è¾‘å›å½’çš„å‡è®¾å‡½æ•°ä¸­è®¡ç®—ä»€ä¹ˆ åœ¨é€»è¾‘å›å½’ä¸­ï¼Œ æˆ‘ä»¬é¢„æµ‹åˆ°: å½“$h_Î¸(x) &gt;= 0.5$ æ—¶ï¼Œ é¢„æµ‹ y= 1; å½“ $h_Î¸(x) &gt;= 0.5$ æ—¶ï¼Œé¢„æµ‹ y = 0ï¼› æ ¹æ®ä¸Šé¢ç»˜åˆ¶çš„Så½¢å‡½æ•°å›¾åƒï¼Œæˆ‘ä»¬çŸ¥é“å½“ z = 0 æ—¶, g(z) = 0.5 z &gt; æ—¶, g(z) &gt; 0.5 z &lt; 0 æ—¶, g(z) &lt; 0.5 åˆ $z = Î¸^Tx$, å³: $Î¸^TX &gt;= 0$ æ—¶, é¢„æµ‹ y = 1 , $Î¸^TX &lt; 0$ æ—¶ï¼Œ é¢„æµ‹ y = 0 ç°åœ¨å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¨¡å‹: å¹¶ä¸”å‚æ•°Î¸æ˜¯å‘é‡[-3 1 1]. åˆ™å½“ -3 + x1 + x2 &gt;= 0, å³x1 + x2 &gt;= 3æ—¶ï¼Œ æ¨¡å‹å°†é¢„æµ‹ y = 1. æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶ç›´çº¿x1 + x2 = 3, è¿™æ¡çº¿ï¥¥æ˜¯æˆ‘ä»¬æ¨¡å‹çš„åˆ†ç•Œçº¿ï¼Œå°†é¢„æµ‹ä¸º1çš„åŒºåŸŸå’Œé¢„æµ‹ä¸º 0çš„åŒºåŸŸåˆ†éš”å¼€ã€‚ å¤æ‚å½¢çŠ¶çš„å†³ç­–è¾¹ç•Œå‡ä½¿æˆ‘ä»¬çš„æ•°æ®å‘ˆç°è¿™æ ·çš„åˆ†å¸ƒæƒ…å†µï¼Œæ€æ ·çš„æ¨¡å‹æ‰èƒ½é€‚åˆå‘¢ï¼Ÿ å› ä¸ºéœ€è¦ç”¨æ›²çº¿æ‰èƒ½åˆ†éš” y = 0 çš„åŒºåŸŸå’Œ y = 1 çš„åŒºåŸŸï¼Œæˆ‘ä»¬éœ€è¦äºŒæ¬¡æ–¹ç‰¹å¾ï¼š æ‰€ä»¥æŒ‰ç…§å‡è®¾å‡½æ•°åº”è¯¥è¶‹è¿‘ï¼Œ $h_Î¸(x) = g(Î¸_0 + Î¸_1x_1 + Î¸_2x_2 + Î¸_1x_1^2 + Î¸_2x_2^2 )$ Î¸æœ€ç»ˆç»“æœè¶‹è¿‘ [-1 0 0 1 1], æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„åˆ¤å®šè¾¹ç•Œæ°å¥½æ˜¯åœ†ç‚¹åœ¨åŸç‚¹ä¸”åŠå¾„ä¸º1çš„åœ†å½¢ , ç»¼ä¸Šæˆ‘ä»¬å¯ä»¥ç”¨å¤æ‚çš„æ¨¡å‹æ¥é€‚åº”é£è±¡å¤æ‚å½¢çŠ¶çš„åˆ¤å®šè¾¹ç•Œ 4. é€»è¾‘å›å½’ä»£ä»·å‡½æ•°å’Œæ¢¯åº¦ä¸‹é™é€»è¾‘å›å½’ä»£ä»·å‡½æ•°åŠç®€åŒ–å¯¹äºçº¿æ€§å›å½’æ¨¡å‹ï¼Œæˆ‘ä»¬å®šä¹‰çš„ä»£ä»·å‡½æ•°æ˜¯æ‰€æœ‰æ¨¡å‹è¯¯å·®çš„å¹³æ–¹å’Œå’Œã€‚ï§¤è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹é€»è¾‘å›å½’æ¨¡å‹æ²¿ç”¨è¿™ä¸ªå®šä¹‰ï¼Œä½†æ˜¯é—®é¢˜åœ¨äºï¼Œå½“æˆ‘ä»¬å°† $h_Î¸(x) = g(Î¸^TX)$ å¸¦å…¥åˆ°è¿™æ ·å®šä¹‰ï¦ºçš„ä»£ä»·å‡½æ•°ä¸­æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°çš„ä»£ä»·å‡½æ•°å°†æ˜¯ä¸€ä¸ªéå‡¸å‡½æ•°ï¼ˆnon-convexfunctionï¼‰å¦‚ä¸‹å›¾ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„ä»£ä»·å‡½æ•°æœ‰è®¸å¤šå±€éƒ¨æœ€å°å€¼ï¼Œè¿™å°†å½±å“æ¢¯åº¦ä¸‹é™ç®—æ³•å¯»æ‰¾å…¨å±€æœ€å°å€¼ã€‚ çº¿å‹å›å½’ä»£ä»·å‡½æ•°ä¸º: $J_{(Î¸)} = {1\over m} \sum_{i=1}^m{1\over2}(h_Î¸(x^{(i)})-y^{(i)})^2â€‹$ é‡æ–°å®šä¹‰é€»è¾‘å›å½’ä»£ä»·å‡½æ•°ï¼Œä½¿ä»£ä»·å‡½æ•°åœ¨é€»è¾‘å›å½’ç®—æ³•ä¸­ä¸ºå‡¸å‡½æ•°, è¿‡ç¨‹å¦‚ä¸‹: æ ¹æ®æ¨å€’å¯ä»¥è¯æ˜, æˆ‘ä»¬æ¨å€’çš„çš„ä»£ä»·å€¼å‡½æ•°ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªå‡¸ä¼˜åŒ–é—®é¢˜ã€‚ä»£ä»·å‡½æ•° J(Î¸) ä¼šæ˜¯ä¸€ä¸ªå‡¸å‡½æ•°ï¼Œå¹¶ä¸”æ²¡æœ‰å±€éƒ¨æœ€ä¼˜å€¼ã€‚ pythonä»£ç å®ç° 12345678import numpy as npdef cost(theta, X, y): theta = np.matrix(theta) X = np.matrix(X) y = np.matrix(y) first = np.multiply(â€y, np.log(sigmoid(X* theta.T))) second = np.multiply((1 â€ y), np.log(1 â€ sigmoid(X* theta.T))) return np.sum(first â€ second) / (len(X)) æ¢¯åº¦ä¸‹é™ç®—æ³•æ¨å€’åŠç®€åŒ–åœ¨å¾—åˆ°è¿™æ ·ä¸€ä¸ªä»£ä»·å‡½æ•°ä»¥åï¼Œæˆ‘ä»¬ï¥¥å¯ä»¥ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ¥æ±‚å¾—èƒ½ä½¿ä»£ä»·å‡½æ•°æœ€å°çš„å‚æ•°ï¦ºã€‚ç®—æ³•ä¸ºï¼š Repeat { $Î¸_j : =Î¸_j âˆ’ Î±{âˆ‚\overâˆ‚Î¸_j }J(Î¸)$ (simultaneously update all ) } æ±‚å¯¼åå¾—åˆ°: Repeat { $Î¸j : =Î¸_j âˆ’ Î±{1\over m}\sum{i=1}^m(h_Î¸(x^{(i)}) - y^{(i)})x_j^{(i)}$ (simultaneously update all ) } æ³¨ï¼šè™½ç„¶å¾—åˆ°çš„æ¢¯åº¦ä¸‹é™ç®—æ³•è¡¨é¢ä¸Šçœ‹ä¸Šå»ä¸çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™ç®—æ³•ä¸€æ ·ï¼Œä½†æ˜¯è¿™ï§©çš„ $h_Î¸(x) = g(Î¸^TX)$ ä¸çº¿æ€§å›å½’ä¸­ï¥§åŒï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯ï¥§ä¸€æ ·çš„ã€‚å¦å¤–ï¼Œåœ¨è¿ï¨ˆæ¢¯åº¦ä¸‹é™ç®—æ³•ä¹‹å‰ï¼Œè¿›ï¨ˆç‰¹å¾ç¼©æ”¾ä¾æ—§æ˜¯éå¸¸å¿…è¦çš„ã€‚ 5. é«˜çº§ä¼˜åŒ–ç®—æ³•ä¸€äº›é«˜çº§ç®—æ³•çš„ä»‹ç»ç°åœ¨æˆ‘ä»¬æ¢ä¸ªè§’åº¦æ¥çœ‹ï¼Œï§½ä¹ˆæ˜¯æ¢¯åº¦ä¸‹é™ï¼Œæˆ‘ä»¬æœ‰ä¸ªä»£ä»·å‡½æ•° J(Î¸)ï¼Œè€Œæˆ‘ä»¬æƒ³è¦ä½¿å…¶æœ€å°åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åšçš„æ˜¯ç¼–å†™ä»£ç ï¼Œå½“è¾“å…¥å‚æ•°Î¸æ—¶ï¼Œå®ƒä»¬ä¼šè®¡ç®—å‡ºä¸¤æ ·ä¸œè¥¿ï¼šJ(Î¸) ä»¥åŠ J ç­‰äº 0ã€1ç›´åˆ° n æ—¶çš„åå¯¼æ•°é¡¹ã€‚ å‡è®¾æˆ‘ä»¬å·²ç»å®Œæˆï¦ºå¯ä»¥å®ç°è¿™ä¸¤ä»¶äº‹çš„ä»£ç ï¼Œé‚£ä¹ˆæ¢¯åº¦ä¸‹é™æ‰€åšçš„å°±æ˜¯åå¤æ‰§ï¨ˆè¿™äº›ï¤æ–°ã€‚ å¦ä¸€ç§è€ƒè™‘æ¢¯åº¦ä¸‹é™çš„æ€ï¤·æ˜¯ï¼šæˆ‘ä»¬éœ€è¦å†™å‡ºä»£ç æ¥è®¡ç®— J(Î¸) å’Œè¿™äº›åå¯¼æ•°ï¼Œç„¶åæŠŠè¿™äº›æ’å…¥åˆ°æ¢¯åº¦ä¸‹é™ä¸­ï¼Œç„¶åå®ƒå°±å¯ä»¥ä¸ºæˆ‘ä»¬æœ€å°åŒ–è¿™ä¸ªå‡½æ•°ã€‚ å¯¹äºæ¢¯åº¦ä¸‹é™æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºä»æŠ€æœ¯ä¸Šè®²ï¼Œä½ å®é™…å¹¶ï¥§éœ€è¦ç¼–å†™ä»£ç æ¥è®¡ç®—ä»£ä»·å‡½æ•°J(Î¸)ã€‚ä½ åªéœ€è¦ç¼–å†™ä»£ç æ¥è®¡ç®—å¯¼æ•°é¡¹ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ å¸Œæœ›ä»£ç è¿˜è¦èƒ½å¤Ÿç›‘æ§è¿™äº› J(Î¸)çš„æ”¶æ•›æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è‡ªå·±ç¼–å†™ä»£ç æ¥è®¡ç®—ä»£ä»·å‡½æ•°J(Î¸)å’Œåå¯¼æ•°é¡¹$Î±{âˆ‚\overâˆ‚Î¸_j }J(Î¸)$ã€‚æ‰€ä»¥ï¼Œåœ¨å†™å®Œèƒ½å¤Ÿè®¡ç®—è¿™ä¸¤è€…çš„ä»£ç ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ¢¯åº¦ä¸‹é™ã€‚ ç„¶è€Œæ¢¯åº¦ä¸‹é™å¹¶ï¥§æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„å”¯ä¸€ç®—æ³•ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›ç®—æ³•ï¼Œï¤é«˜çº§ã€ï¤å¤æ‚ã€‚å¦‚æœæˆ‘ä»¬èƒ½ç”¨è¿™äº›æ–¹æ³•æ¥è®¡ç®—ä»£ä»·å‡½æ•°J(Î¸)å’Œåå¯¼æ•°é¡¹$Î±{âˆ‚\overâˆ‚Î¸_j }J(Î¸)$ä¸¤ä¸ªé¡¹çš„è¯ï¼Œé‚£ä¹ˆè¿™äº›ç®—æ³•å°±æ˜¯ä¸ºæˆ‘ä»¬ä¼˜åŒ–ä»£ä»·å‡½æ•°çš„ï¥§åŒæ–¹æ³•ï¼Œå…±è½­æ¢¯åº¦æ³•ã€ BFGS (å˜å°ºåº¦æ³•)ã€ L-BFGS (é™åˆ¶å˜å°ºåº¦æ³•) å°±æ˜¯å…¶ä¸­ä¸€äº›ï¤é«˜çº§çš„ä¼˜åŒ–ç®—æ³•ï¼Œå®ƒä»¬éœ€è¦æœ‰ä¸€ç§æ–¹æ³•æ¥è®¡ç®— J(Î¸)ï¼Œä»¥åŠéœ€è¦ä¸€ç§æ–¹æ³•è®¡ç®—å¯¼æ•°é¡¹ï¼Œç„¶åä½¿ç”¨æ¯”æ¢¯åº¦ä¸‹é™ï¤å¤æ‚çš„ç®—æ³•æ¥æœ€å°åŒ–ä»£ä»·å‡½æ•°ã€‚ è¿™ä¸‰ç§ç®—æ³•çš„ä¼˜ç‚¹ï¼š ä¸€ä¸ªæ˜¯ä½¿ç”¨è¿™å…¶ä¸­ä»»ä½•ä¸€ä¸ªç®—æ³•ï¼Œä½ é€šå¸¸ï¥§éœ€è¦æ‰‹åŠ¨é€‰æ‹©å­¦ä¹ ç‡ Î± ï¼Œæ‰€ä»¥å¯¹äºè¿™äº›ç®—æ³•çš„ä¸€ç§æ€ï¤·æ˜¯ï¼Œç»™å‡ºè®¡ç®—å¯¼æ•°é¡¹å’Œä»£ä»·å‡½æ•°çš„æ–¹æ³•ï¼Œä½ å¯ä»¥è®¤ä¸ºç®—æ³•æœ‰ä¸€ä¸ªæ™ºèƒ½çš„å†…éƒ¨å¾ªç¯ï¼Œè€Œä¸”ï¼Œäº‹å®ä¸Šï¼Œä»–ä»¬ç¡®å®æœ‰ä¸€ä¸ªæ™ºèƒ½çš„å†…éƒ¨å¾ªç¯ï¼Œç§°ä¸ºçº¿æ€§æœç´¢(line search)ç®—æ³•ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å°è¯•ï¥§åŒçš„å­¦ä¹ é€Ÿç‡ Î± ï¼Œå¹¶è‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¥½çš„å­¦ä¹ é€Ÿç‡ Î±ï¼Œå› æ­¤å®ƒç”šè‡³å¯ä»¥ä¸ºæ¯æ¬¡è¿­ä»£é€‰æ‹©ï¥§åŒçš„å­¦ä¹ é€Ÿç‡ï¼Œé‚£ä¹ˆä½ å°±ï¥§éœ€è¦è‡ªå·±é€‰æ‹©ã€‚ Octave æœ‰ä¸€ä¸ªéå¸¸ï§¤æƒ³çš„åº“ç”¨äºå®ç°è¿™äº›å…ˆè¿›çš„ä¼˜åŒ–ç®—æ³•ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ ç›´æ¥è°ƒç”¨å®ƒè‡ªå¸¦çš„åº“ï¼Œä½ å°±èƒ½å¾—åˆ°ï¥§é”™çš„ç»“æœã€‚æˆ‘å¿…é¡»æŒ‡å‡ºè¿™äº›ç®—æ³•å®ç°å¾—å¥½æˆ–ï¥§å¥½æ˜¯æœ‰åŒºåˆ«çš„ï¼Œå› æ­¤ï¼Œå¦‚æœä½ æ­£åœ¨ä½ çš„æœºï¨¸å­¦ä¹ ç¨‹åºä¸­ä½¿ç”¨ä¸€ç§ï¥§åŒçš„è¯­è¨€ï¼Œæ¯”å¦‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨Cã€C++ã€Javaç­‰ç­‰ï¼Œä½ å¯èƒ½ä¼šæƒ³å°è¯•ä¸€äº›ï¥§åŒçš„åº“ï¼Œä»¥ç¡®ä¿ä½ æ‰¾åˆ°ä¸€ä¸ªèƒ½å¾ˆå¥½å®ç°è¿™äº›ç®—æ³•çš„åº“ã€‚ å¦‚ä½•ä½¿ç”¨è¿™äº›ç®—æ³•æ¯”æ–¹è¯´ï¼Œä½ æœ‰ä¸€ä¸ªå«ä¸¤ä¸ªå‚æ•°çš„é—®é¢˜ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯Î¸1å’ŒÎ¸2ï¼Œå› æ­¤ï¼Œé€šè¿‡è¿™ä¸ªä»£ä»·å‡½æ•°ï¼Œä½ å¯ä»¥å¾—åˆ° Î¸1 å’Œ Î¸2 çš„å€¼ï¼Œå¦‚æœä½ å°† J(Î¸) æœ€å°åŒ–çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„æœ€å°å€¼å°†æ˜¯ Î¸1 = 5 ï¼ŒÎ¸2 = 5 ã€‚ä»£ä»·å‡½æ•° J(Î¸) çš„å¯¼æ•°æ¨å‡ºæ¥å°±æ˜¯è¿™ä¸¤ä¸ªè¡¨è¾¾å¼ï¼š $Î±{âˆ‚\overâˆ‚Î¸_1}J(Î¸) = 2(Î¸_1 - 5)$ $Î±{âˆ‚\overâˆ‚Î¸_2}J(Î¸) = 2(Î¸_2 - 5)$ å¦‚æœæˆ‘ä»¬ï¥§çŸ¥é“æœ€å°å€¼ï¼Œä½†ä½ æƒ³è¦ä»£ä»·å‡½æ•°æ‰¾åˆ°è¿™ä¸ªæœ€å°å€¼ï¼Œæ˜¯ç”¨æ¯”å¦‚æ¢¯åº¦ä¸‹é™è¿™äº›ç®—æ³•ï¼Œä½†æœ€å¥½æ˜¯ç”¨æ¯”å®ƒï¤é«˜çº§çš„ç®—æ³•ï¼Œä½ è¦åšçš„å°±æ˜¯è¿ï¨ˆä¸€ä¸ªåƒè¿™æ ·çš„Octave å‡½æ•°ï¼š 123456function [jVal, gradient]=costFunction(theta) jVal=(theta(1)â€5)^2+(theta(2)â€5)^2; gradient=zeros(2,1); gradient(1)=2*(theta(1)â€5); gradient(2)=2*(theta(2)â€5);end è¿™æ ·å°±è®¡ç®—å‡ºè¿™ä¸ªä»£ä»·å‡½æ•°ï¼Œå‡½æ•°è¿”å›çš„ç¬¬äºŒä¸ªå€¼æ˜¯æ¢¯åº¦å€¼ï¼Œæ¢¯åº¦å€¼åº”è¯¥æ˜¯ä¸€ä¸ª2Ã—1çš„å‘ï¥¾ï¼Œæ¢¯åº¦å‘ï¥¾çš„ä¸¤ä¸ªå…ƒç´ å¯¹åº”è¿™ï§©çš„ä¸¤ä¸ªåå¯¼æ•°é¡¹ï¼Œè¿ï¨ˆè¿™ä¸ªcostFunction å‡½æ•°åï¼Œä½ å°±å¯ä»¥è°ƒç”¨é«˜çº§çš„ä¼˜åŒ–å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å«fminuncï¼Œå®ƒè¡¨ç¤ºOctave ï§©æ— çº¦æŸæœ€å°åŒ–å‡½æ•°ã€‚è°ƒç”¨å®ƒçš„æ–¹å¼å¦‚ä¸‹ï¼š 123options=optimset('GradObj','on','MaxIter',100);initialTheta=zeros(2,1);[optTheta, functionVal, exitFlag]=fminunc(@costFunction, initialTheta, options); ä½ è¦è®¾ç½®å‡ ä¸ªoptionsï¼Œè¿™ä¸ª options å˜ï¥¾ä½œä¸ºä¸€ä¸ªæ•°æ®ç»“æ„å¯ä»¥å­˜å‚¨ä½ æƒ³è¦çš„optionsï¼Œæ‰€ä»¥ GradObj å’ŒOnï¼Œè¿™ï§©è®¾ç½®æ¢¯åº¦ç›®æ ‡å‚æ•°ä¸ºæ‰“å¼€(on)ï¼Œè¿™æ„å‘³ç€ä½ ç°åœ¨ç¡®å®è¦ç»™è¿™ä¸ªç®—æ³•æä¾›ä¸€ä¸ªæ¢¯åº¦ï¼Œç„¶åè®¾ç½®æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œæ¯”æ–¹è¯´100ï¼Œæˆ‘ä»¬ç»™å‡ºä¸€ä¸ª çš„çŒœæµ‹åˆå§‹å€¼ï¼Œå®ƒæ˜¯ä¸€ä¸ª2Ã—1çš„å‘ï¥¾ï¼Œé‚£ä¹ˆè¿™ä¸ªå‘½ä»¤å°±è°ƒç”¨fminuncï¼Œè¿™ä¸ª@ç¬¦å·è¡¨ç¤ºæŒ‡å‘æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„costFunction å‡½æ•°çš„æŒ‡é’ˆã€‚å¦‚æœä½ è°ƒç”¨å®ƒï¼Œå®ƒå°±ä¼šä½¿ç”¨ä¼—å¤šé«˜çº§ä¼˜åŒ–ç®—æ³•ä¸­çš„ä¸€ä¸ªï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒå½“æˆæ¢¯åº¦ä¸‹é™ï¼Œåªï¥§è¿‡å®ƒèƒ½è‡ªåŠ¨é€‰æ‹©å­¦ä¹ é€Ÿç‡ï¼Œä½ ï¥§éœ€è¦è‡ªå·±æ¥åšã€‚ç„¶åå®ƒä¼šå°è¯•ä½¿ç”¨è¿™äº›é«˜çº§çš„ä¼˜åŒ–ç®—æ³•ï¼Œå°±åƒåŠ å¼ºç‰ˆçš„æ¢¯åº¦ä¸‹é™æ³•ï¼Œä¸ºä½ æ‰¾åˆ°æœ€ä½³çš„å€¼ã€‚ å®é™…è¿è¡Œè¿‡ç¨‹ç¤ºä¾‹ 6. å¤šåˆ†ç±»é—®é¢˜å¤šåˆ†ç±»çš„ä»‹ç»ä¸€äº›å¤šåˆ†ç±»çš„ä¾‹å­: ä¾‹ä¸€: å‡å¦‚è¯´ä½ ç°åœ¨éœ€è¦ä¸€ä¸ªå­¦ä¹ ç®—æ³•èƒ½è‡ªåŠ¨åœ°å°†é‚®ä»¶å½’ç±»åˆ°ï¥§åŒçš„æ–‡ä»¶å¤¹ï§©ï¼Œæˆ–è€…è¯´å¯ä»¥è‡ªåŠ¨åœ°åŠ ä¸Šæ ‡ç­¾ï¼Œé‚£ä¹ˆï¼Œä½ ä¹Ÿè®¸éœ€è¦ä¸€äº›ï¥§åŒçš„æ–‡ä»¶å¤¹ï¼Œæˆ–è€…ï¥§åŒçš„æ ‡ç­¾æ¥å®Œæˆè¿™ä»¶äº‹ï¼Œæ¥åŒºåˆ†å¼€æ¥è‡ªå·¥ä½œçš„é‚®ä»¶ã€æ¥è‡ªæœ‹å‹çš„é‚®ä»¶ã€æ¥è‡ªå®¶äººçš„é‚®ä»¶æˆ–è€…æ˜¯æœ‰å…³å…´è¶£çˆ±å¥½çš„é‚®ä»¶ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±æœ‰ï¦ºè¿™æ ·ä¸€ä¸ªåˆ†ç±»é—®é¢˜ï¼šå…¶ç±»åˆ«æœ‰å››ä¸ªï¼Œåˆ†åˆ«ç”¨ y=1, y=2, y=3, y=4 æ¥è¡¨ç¤º ä¾‹äºŒ: å¦‚æœä¸€ä¸ªç—…äººå› ä¸ºé¼»å¡æ¥åˆ°ä½ çš„è¯Šæ‰€ï¼Œä»–å¯èƒ½å¹¶æ²¡æœ‰ç”Ÿç—…ï¼Œç”¨ y=1 è¿™ä¸ªç±»åˆ«æ¥ä»£è¡¨ï¼›æˆ–è€…æ‚£ï¦ºæ„Ÿå†’ï¼Œç”¨ y=2 æ¥ä»£è¡¨ï¼›æˆ–è€…å¾—ï¦ºæµæ„Ÿç”¨ y=3 æ¥ä»£è¡¨. ç„¶è€Œå¯¹äºä¹‹å‰çš„ä¸€ä¸ªï¼ŒäºŒå…ƒåˆ†ç±»é—®é¢˜ï¼Œæˆ‘ä»¬çš„æ•°æ®çœ‹èµ·æ¥å¯èƒ½æ˜¯åƒè¿™æ ·ï¼š å¯¹äºä¸€ä¸ªå¤šç±»åˆ†ç±»é—®é¢˜ï¼Œæˆ‘ä»¬çš„æ•°æ®é›†æˆ–è®¸çœ‹èµ·æ¥åƒè¿™æ ·ï¼š ä¸€å¯¹äºå¤šåˆ†ç±»æ€è·¯æˆ‘ç”¨3ç§ï¥§åŒçš„ç¬¦å·æ¥ä»£è¡¨3ä¸ªç±»åˆ«ï¼Œé—®é¢˜å°±æ˜¯ç»™å‡º3ä¸ªç±»å‹çš„æ•°æ®é›†ï¼Œæˆ‘ä»¬å¦‚ä½•å¾—åˆ°ä¸€ä¸ªå­¦ä¹ ç®—æ³•æ¥è¿›ï¨ˆåˆ†ç±»å‘¢ï¼Ÿæˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“å¦‚ä½•è¿›ï¨ˆäºŒå…ƒåˆ†ç±»ï¼Œå¯ä»¥ä½¿ç”¨é€»è¾‘å›å½’ï¼Œå¯¹äºç›´çº¿æˆ–è®¸ä½ ä¹ŸçŸ¥é“ï¼Œå¯ä»¥å°†æ•°æ®é›†ä¸€åˆ†ä¸ºäºŒä¸ºæ­£ç±»å’Œè´Ÿç±»ã€‚ç”¨ä¸€å¯¹å¤šçš„åˆ†ç±»æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç”¨åœ¨å¤šç±»åˆ†ç±»é—®é¢˜ä¸Šã€‚ä¸‹é¢å°†ä»‹ç»å¦‚ä½•è¿›ï¨ˆä¸€å¯¹å¤šçš„åˆ†ç±»å·¥ä½œï¼Œæœ‰æ—¶è¿™ä¸ªæ–¹æ³•ä¹Ÿè¢«ç§°ä¸ºâ€œä¸€å¯¹ä½™â€æ–¹æ³•ã€‚ ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªè®­ç»ƒé›†ï¼Œå¥½æ¯”ä¸Šå›¾è¡¨ç¤ºçš„æœ‰3ä¸ªç±»åˆ«ï¼Œæˆ‘ä»¬ç”¨ä¸‰è§’å½¢è¡¨ç¤º y = 1 ï¼Œæ–¹æ¡†è¡¨ç¤º y = 2ï¼Œå‰å‰è¡¨ç¤º y = 3ã€‚ä¸‹é¢è¦åšçš„å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªè®­ç»ƒé›†ï¼Œå°†å…¶åˆ†æˆ3ä¸ªäºŒå…ƒåˆ†ç±»é—®é¢˜ã€‚æˆ‘ä»¬å…ˆä»ç”¨ä¸‰è§’å½¢ä»£è¡¨çš„ç±»åˆ«1å¼€å§‹ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªï¼Œæ–°çš„â€ä¼ªâ€è®­ç»ƒé›†ï¼Œç±»å‹2å’Œç±»å‹3å®šä¸ºè´Ÿç±»ï¼Œç±»å‹1è®¾å®šä¸ºæ­£ç±»ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„è®­ç»ƒé›†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºçš„é‚£æ ·ï¼Œæˆ‘ä»¬è¦æ‹Ÿåˆå‡ºä¸€ä¸ªåˆé€‚çš„åˆ†ç±»ï¨¸ã€‚ è¿™ï§©çš„ä¸‰è§’å½¢æ˜¯æ­£æ ·æœ¬ï¼Œè€Œåœ†å½¢ä»£è¡¨è´Ÿæ ·æœ¬ã€‚å¯ä»¥è¿™æ ·æƒ³ï¼Œè®¾ç½®ä¸‰è§’å½¢çš„å€¼ä¸º1ï¼Œåœ†å½¢çš„å€¼ä¸º0ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è®­ç»ƒä¸€ä¸ªæ ‡å‡†çš„é€»è¾‘å›å½’åˆ†ç±»ï¨¸ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°ä¸€ä¸ªæ­£è¾¹ç•Œã€‚ ä¸ºï¦ºèƒ½å®ç°è¿™æ ·çš„è½¬å˜ï¼Œæˆ‘ä»¬å°†å¤šä¸ªç±»ä¸­çš„ä¸€ä¸ªç±»æ ‡è®°ä¸ºæ­£å‘ç±»ï¼ˆy=1ï¼‰ï¼Œç„¶åå°†å…¶ä»–æ‰€æœ‰ç±»éƒ½æ ‡è®°ä¸ºè´Ÿå‘ç±»ï¼Œè¿™ä¸ªæ¨¡å‹è®°ä½œ$h_Î¸^{(1)}(x)$ã€‚æ¥ç€ï¼Œç±»ä¼¼åœ°ç¬¬æˆ‘ä»¬é€‰æ‹©å¦ä¸€ä¸ªç±»æ ‡è®°ä¸ºæ­£å‘ç±»ï¼ˆy=2ï¼‰ï¼Œå†å°†å…¶å®ƒç±»éƒ½æ ‡è®°ä¸ºè´Ÿå‘ç±»ï¼Œå°†è¿™ä¸ªæ¨¡å‹è®°ä½œ$h_Î¸^{(2)}(x)$ ,ä¾æ­¤ç±»æ¨ã€‚ æœ€åæˆ‘ä»¬å¾—åˆ°ä¸€ç³»ï¦œçš„æ¨¡å‹ç®€è®°ä¸ºï¼š$h_Î¸^{(i)}(x) = P(y=i|x; Î¸)$ å…¶ä¸­ï¼ši = (1, 2, 3, 4, 5, â€¦, k) kä¸ºæ€»åˆ†ç±»æ•°é‡æœ€åï¼Œåœ¨æˆ‘ä»¬éœ€è¦åšé¢„æµ‹æ—¶ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„åˆ†ç±»æœºéƒ½è¿ï¨ˆä¸€éï¼Œç„¶åå¯¹æ¯ä¸€ä¸ªè¾“å…¥å˜ï¥¾ï¼Œéƒ½é€‰æ‹©æœ€é«˜å¯èƒ½æ€§çš„è¾“å‡ºå˜ï¥¾ã€‚æ€»ä¹‹ï¼Œæˆ‘ä»¬å·²ç»æŠŠè¦åšçš„åšå®Œï¦ºï¼Œç°åœ¨è¦åšçš„å°±æ˜¯è®­ç»ƒè¿™ä¸ªé€»è¾‘å›å½’åˆ†ç±»ï¨¸ï¼š$h_Î¸^{(i)}(x)$ ï¼Œ å…¶ä¸­ i å¯¹åº”æ¯ä¸€ä¸ªå¯èƒ½çš„y=iï¼Œæœ€åï¼Œä¸ºï¦ºåšå‡ºé¢„æµ‹ï¼Œæˆ‘ä»¬ç»™å‡ºè¾“å…¥ä¸€ä¸ªæ–°çš„ x å€¼ï¼Œç”¨è¿™ä¸ªåšé¢„æµ‹ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨æˆ‘ä»¬ä¸‰ä¸ªåˆ†ç±»ï¨¸ï§©é¢è¾“å…¥ x ï¼Œç„¶åæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªè®© $h_Î¸^{(i)}(x)$ æœ€å¤§çš„ i ä½œä¸ºæœ€ç»ˆçš„åˆ†ç±»ç»“æœã€‚ç°åœ¨çŸ¥é“ï¦ºåŸºæœ¬çš„æŒ‘é€‰åˆ†ç±»ï¨¸çš„æ–¹æ³•ï¼Œé€‰æ‹©å‡ºå“ªä¸€ä¸ªåˆ†ç±»ï¨¸æ˜¯å¯ä¿¡åº¦æœ€é«˜æ•ˆæœæœ€å¥½çš„ï¼Œé‚£ä¹ˆå°±å¯è®¤ä¸ºå¾—åˆ°ä¸€ä¸ªæ­£ç¡®çš„åˆ†ç±»ï¼Œæ— è®ºå€¼æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬éƒ½æœ‰æœ€é«˜çš„æ¦‚ç‡å€¼ï¼Œæˆ‘ä»¬é¢„æµ‹å°±æ˜¯é‚£ä¸ªå€¼ã€‚è¿™å°±æ˜¯å¤šç±»åˆ«åˆ†ç±»é—®é¢˜ï¼Œä»¥åŠä¸€å¯¹å¤šçš„æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªå°æ–¹æ³•ï¼Œä½ ç°åœ¨ä¹Ÿå¯ä»¥å°†é€»è¾‘å›å½’åˆ†ç±»ï¨¸ç”¨åœ¨å¤šç±»åˆ†ç±»çš„é—®é¢˜ä¸Šã€‚]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>é€»è¾‘å›å½’</tag>
        <tag>åˆ†ç±»é—®é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[OctaveåŸºç¡€æ“ä½œ]]></title>
    <url>%2F2018%2F10%2F26%2F07.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%2Foctave%20%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[åŸºç¡€åŠŸèƒ½å‘½ä»¤ä¿®æ”¹å‘½ä»¤è¡Œçš„æç¤º1PS1('&gt;&gt; ') % &gt;&gt; å°±æ˜¯ä¿®æ”¹åçš„æç¤ºç¬¦å· å˜é‡èµ‹å€¼è¯­å¥1A = 5 + 6 ; % åé¢åŠ ä¸Šä¸€ä¸ªå¯ä»¥ä¸åœ¨ç»ˆç«¯æ‰“å°å˜é‡çš„å€¼ æ˜¾ç¤ºå·¥ä½œç©ºé—´çš„æ‰€æœ‰å˜é‡12who % æ˜¾ç¤ºå·¥ä½œç©ºé—´çš„æ‰€æœ‰å˜é‡whos % æ˜¾ç¤ºå·¥ä½œç©ºé—´çš„æ‰€æœ‰å˜é‡å’Œè¯¦ç»†ä¿¡æ¯ åˆ é™¤å˜é‡12clear A % åˆ é™¤å˜é‡Aclear % åˆ é™¤æ‰€æœ‰å˜é‡ æ‰“å°å˜é‡12A % ç›´æ¥å†ç»ˆç«¯è¾“å…¥å˜é‡åç§°å°±å¯ä»¥å°†å˜é‡çš„å€¼æ‰“å°å‡ºæ¥disp(A) % é€šè¿‡dispå‡½æ•°å°†å˜é‡æ‰“å°å‡ºæ¥ ä¿®æ”¹å…¨å±€çš„è¾“å‡ºå†…å®¹çš„é•¿çŸ­12format long % å°†è¾“å‡ºæ•°å€¼çš„é•¿åº¦å®šä¹‰ä¸ºlongç±»å‹format short % å°†è¾“å‡ºæ•°å€¼çš„é•¿åº¦å®šä¹‰ä¸ºshortç±»å‹ æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯123helo randhelp eyehelp help æ·»åŠ æœç´¢è·¯å¾„1addpath path % æ·»åŠ è·¯å¾„åˆ°å‡½æ•°å’Œæ•°æ®ç­‰çš„æŸäººæœç´¢è·¯å¾„ åŸºç¡€è¿ç®—æ•°å€¼è¿ç®—13-2ï¼› 5*8ï¼› 1/2ï¼› % åŸºç¡€è¿ç®— é€»è¾‘è¿ç®—12341 &amp;&amp; 0 % é€»è¾‘ä¸1 || 0 % é€»è¾‘æˆ–~ 1 % é€»è¾‘è´¹XOR(1, 0) % å¼‚æˆ–è¿ç®— åˆ¤æ–­è¯­å¥121 == 2 % ç›¸ç­‰åˆ¤æ–­1 ~= 2 % ä¸ç­‰äºåˆ¤æ–­ çŸ©é˜µè¿ç®—åˆ›å»ºçŸ©é˜µ1234567891011A = [ 1 2; 3 4; 5 6 ] % åˆ›å»ºä¸€ä¸ªä¸‰è¡Œä¸¤åˆ—çš„çŸ©é˜µv = [ 1 2 3 ] % åˆ›å»ºä¸€ä¸ªè¡Œå‘é‡v = 1:6 % åˆ›å»ºä¸€ä¸ªä»1åˆ°6çš„è¡Œå‘é‡v = 1:0.1:2 % åˆ›å»ºä¸€ä¸ªä»1å¼€å§‹ï¼Œä»¥0.1ä¸ºæ­¥é•¿ï¼Œç›´åˆ°2çš„è¡Œå‘é‡v = ones(2, 3) % åˆ›å»ºä¸€ä¸ª2è¡Œ3åˆ—çš„å…ƒç´ éƒ½æ˜¯1çš„çŸ©é˜µv = 2 * ones(2, 3) % åˆ›å»ºä¸€ä¸ª2è¡Œ3åˆ—çš„å…ƒç´ éƒ½æ˜¯2çš„çŸ©é˜µv = zeros(2, 3) % åˆ›å»ºä¸€ä¸ª2è¡Œ3åˆ—çš„å…ƒç´ éƒ½æ˜¯0çš„çŸ©é˜µv = rand(2, 3) % åˆ›å»ºä¸€ä¸ª2è¡Œ3åˆ—çš„å…ƒç´ éƒ½æ˜¯0-1ä¹‹é—´çš„éšæœºæ•°çš„çŸ©é˜µv = randn(2, 3) % åˆ›å»ºä¸€ä¸ª2è¡Œ3åˆ—çš„å…ƒç´ éƒ½ç¬¦åˆå¹³å±€å€¼ä¸º0,1ä¸ºæ ‡å‡†å·®çš„æ­£æ€åˆ†å¸ƒéšæœºæ•°çš„çŸ©é˜µI = eye(6) % åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º6çš„å•ä½çŸ©é˜µv = type(3) % è¿”å›ä¸€ä¸ª3*3çš„éšæœºçŸ©é˜µ çŸ©é˜µè¿ç®—12345678910A = [ 1 2; 3 4; 5 6 ] % åˆ›å»ºä¸€ä¸ªä¸‰è¡Œä¸¤åˆ—çš„çŸ©é˜µB = [ 11, 12; 13 14; 15 16 ]2 * A % AçŸ©é˜µä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¹˜ä»¥2A .* B % å°†AçŸ©é˜µå’ŒBçŸ©é˜µä¸­çš„æ¯ä¸€ä¸ªå¯¹åº”ä½ç½®çš„å…ƒç´ ç›¸ä¹˜,åŒæ ·é€‚ç”¨äº+ - / ^ç­‰A .* % AçŸ©é˜µçš„æ¯ä¸ªå…ƒç´ å–äºŒæ¬¡æ–¹log(v) % çŸ©é˜µçš„æ¯ä¸ªé™¢å¯¹å¯¹æ•°è¿ç®—exp(v) % çŸ©é˜µçš„æ¯ä¸ªå…ƒç´ è¿›è¡Œä»¥ä¸ºåº•ï¼Œä»¥è¿™äº›å…ƒç´ ä¸ºå¹‚çš„è¿ç®—abs(v) % å¯¹vçŸ©é˜µçš„æ¯ä¸ªå…ƒç´ å–ç»å¯¹å€¼A + 1 % å°†AçŸ©é˜µçš„æ¯ä¸ªå…ƒç´ åŠ ä¸Š1A&apos; % å–AçŸ©é˜µçš„è½¬ç½®çŸ©é˜µ è·å–çŸ©é˜µå°ºå¯¸12345A = [ 1 2; 3 4; 5 6 ] % åˆ›å»ºä¸€ä¸ªä¸‰è¡Œä¸¤åˆ—çš„çŸ©é˜µsize(A) % è¿”å›AçŸ©é˜µçš„å°ºå¯¸,è¿”å›çš„å†…å®¹åŒæ ·æ˜¯è¡Œå‘é‡size(Aï¼Œ1) % è¿”å›çŸ©é˜µçš„è¡Œæ•°size(Aï¼Œ2) % è¿”å›çŸ©é˜µçš„åˆ—æ•°lengh(A) % è¿”å›AçŸ©é˜µçš„ç»´åº¦å¤§å°ï¼Œå³çŸ©é˜µçš„é•¿å®½ä¸­æ¯”è¾ƒå¤§çš„ç»´åº¦ï¼ŒçŸ©é˜µAçš„lengthå³ä¸º3 çŸ©é˜µçš„ç´¢å¼•12345678910A = [ 1 2; 3 4; 5 6 ] % åˆ›å»ºä¸€ä¸ªä¸‰è¡Œä¸¤åˆ—çš„çŸ©é˜µA(3, 2) % å–AçŸ©é˜µçš„ç¬¬ä¸‰è¡Œç¬¬äºŒåˆ—çš„å…ƒç´ A(2, :) % è¿”å›ç¬¬äºŒè¡Œçš„æ‰€æœ‰å…ƒç´ A(:, 2) % è¿”å›ç¬¬äºŒåˆ—çš„æ‰€æœ‰å…ƒç´ A([1 3], :) % å–ç¬¬1è¡Œå’Œç¬¬3è¡Œçš„æ‰€æœ‰å…ƒç´ A(:, 2) = [10; 11; 12] % å°†çŸ©é˜µçš„ç¬¬äºŒåˆ—é‡æ–°èµ‹å€¼A = [A, [100, 101, 102]] % ç»™çŸ©é˜µé™„åŠ äº†ä¸€åˆ—çŸ©é˜µï¼Œç»™çŸ©é˜µå¢åŠ ä¸€åˆ—ã€‚å¸¦ï¼Œå’Œä¸å¸¦ï¼Œç›¸åŒ[A B] % ä¸¤ä¸ªçŸ©é˜µç›´æ¥è¿åœ¨ä¸€èµ·ï¼ŒçŸ©é˜µAåœ¨å·¦è¾¹ï¼ŒçŸ©é˜µBåœ¨å³è¾¹[A;B] % ä¸¤ä¸ªçŸ©é˜µç›´æ¥è¿åœ¨ä¸€èµ·ï¼ŒçŸ©é˜µAåœ¨ä¸Šè¾¹, çŸ©é˜µBåœ¨ä¸‹è¾¹A(:) % å°†çŸ©é˜µçš„æ‰€æœ‰å…ƒç´ å¯¼å‘ä¸€ä¸ªå•ç‹¬çš„åˆ—å‘é‡æ’åˆ—èµ·æ¥ çŸ©é˜µçš„è®¡ç®—123456789101112131415A = [ 1 2; 3 4; 5 6 ] % åˆ›å»ºä¸€ä¸ªä¸‰è¡Œä¸¤åˆ—çš„çŸ©é˜µval = max(a) % è¿”å›açŸ©é˜µä¸­çš„æœ€å¤§å€¼, å½“aä¸ºå¤šç»´çŸ©é˜µçš„æ—¶å€™è¿”å›çš„æ˜¯æ¯ä¸€åˆ—çš„æœ€å¤§å€¼val = max(A, a) % ä¸¤ä¸ªçŸ©é˜µæ‰€æœ‰å…ƒç´ é€ä¸ªæ¯”è¾ƒè¿”å›è¾ƒå¤§çš„å€¼max(A,[],1) % å¾—åˆ°çŸ©é˜µæ¯ä¸€åˆ—å…ƒç´ çš„æœ€å¤§å€¼max(A,[],2) % å¾—åˆ°çŸ©é˜µæ¯ä¸€è¡Œå…ƒç´ çš„æœ€å¤§å€¼[val, ind] = max(a) % è¿”å›açŸ©é˜µä¸­çš„æœ€å¤§å€¼å’Œå¯¹åº”çš„ç´¢å¼•sumï¼ˆa) % æŠŠaçŸ©é˜µçš„æ‰€æœ‰å…ƒç´ ç›¸åŠ èµ·æ¥, å¦‚æœæ˜¯å¤šç»´çŸ©é˜µé»˜è®¤ä¸ºæ¯ä¸€åˆ—çš„æ€»å’Œsumï¼ˆa,1) % æ±‚å¤šç»´çŸ©é˜µæ¯ä¸€åˆ—çš„æ€»å’Œsum(a, 3) % æ±‚å¤šç»´çŸ©é˜µæ¯ä¸€è¡Œçš„æ€»å’Œa&lt;3 % å¯¹çŸ©é˜µæ¯ä¸€ä¸ªå…ƒç´ è¿›è¡Œ&lt;3åˆ¤æ–­ï¼Œåˆ¤æ–­ä¸ºçœŸè¿”å›1, å¦åˆ™è¿”å›0find(a&lt;3) % è¿”å›å“ªäº›å…ƒç´ å°äº3(æ˜¯ç´¢å¼•å€¼)prodï¼ˆa) % å°†açŸ©é˜µçš„æ‰€æœ‰å…ƒç´ ç›¸ä¹˜floor(a) % å°†açŸ©é˜µçš„æ‰€æœ‰å…ƒç´ è¿›è¡Œå‘ä¸‹å–èˆceil(a) % å°†açŸ©é˜µçš„æ‰€æœ‰å…ƒç´ è¿›è¡Œå‘ä¸Šå–æ•´pinv(v) % æ±‚vçŸ©é˜µçš„é€†çŸ©é˜µ ç»˜åˆ¶å›¾åƒç»˜åˆ¶ç›´æ–¹å›¾123w = -6 + sqrt(10) * (randn(1, 10000))hist(w) % ç»˜åˆ¶wçŸ©é˜µçš„ç›´æ–¹å›¾hist(w, 50) % ç»˜åˆ¶wçŸ©é˜µçš„ç›´æ–¹å›¾ï¼Œå¹¶æŒ‡å®š50ä¸ªé•¿æ–¹å½¢ ç»˜åˆ¶æ›²çº¿å›¾1234567891011121314t = [0:0.1:1];y1 = sin(2*pi*4t);plot(t, y1);hold on % æ–°ç»˜åˆ¶çš„å›¾ä¸ä¼šè¦†ç›–ä¹‹å‰çš„å›¾ç‰‡ï¼Œä¼šåœ¨ä¹‹å‰çš„å›¾ç‰‡ä¸Šç”Ÿæˆæ–°çš„æ›²çº¿y2 = cos(2*pi*4*t)plot(t, y2, &apos;r&apos;) % ç»˜åˆ¶æ–°çš„ç›´çº¿å›¾ï¼Œrè¡¨ç¤ºçº¿çš„é¢œè‰²ä¸ºçº¢è‰²xlable(&apos;time&apos;) % æ·»åŠ xè½´åç§°ylable(&apos;value&apos;) % ç»™yè½´æ·»åŠ åç§°legend(&apos;sin, &apos;cos&apos;) % ç»™çº¿å‘½åtitle(&apos;myplot&apos;) % ç»™å›¾ç‰‡ä¸€ä¸ªæ ‡é¢˜åç§°print -dpng &apos;myplot.png&apos; % è¾“å‡ºå›¾ç‰‡plot clos % å…³æ‰å›¾ç‰‡axis([0.5 1 â€1 1]) % æ”¹å˜åæ ‡è¿”å›ï¼Œå‰ä¸¤ä¸ªå‚æ•°æ§åˆ¶æ¨ªåæ ‡ï¼Œåä¸¤å‚æ•°æ§åˆ¶çºµåæ ‡Clf % æ¸…é™¤ä¸€ä¸ªå›¾åƒ åœ¨ä¸€å¼ ç”»çº¸ä¸Šç»˜åˆ¶ä¸¤å¼ ç›´çº¿å›¾123456789t = [0:0.1:1];y1 = sin(2*pi*4t);y2 = cos(2*pi*4*t)ï¼›figure(1); plot(t, y1); % ç»˜åˆ¶ç¬¬ä¸€å¼ å›¾ç‰‡figure(2); plot(t, y2); % ç»˜åˆ¶ç¬¬äºŒå¼ å›¾ç‰‡subplot(1,2,1) %å°†å›¾åƒåˆ†ä¸ºä¸€ä¸ª1*2çš„æ ¼å­ï¼Œä¹Ÿå°±æ˜¯å‰ä¸¤ä¸ªå‚æ•°ï¼Œç„¶åå®ƒä½¿ç”¨ç¬¬ä¸€ä¸ªæ ¼å­ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€ä¸ªå‚æ•°1çš„æ„æ€ã€‚plot(t,y1) % å°†å›¾ç‰‡ç»˜åˆ¶åˆ°ç¬¬ä¸€ä¸ªæ ¼å­suplot(1,2,2) % ä½¿ç”¨ç¬¬äºŒä¸ªæ ¼å­plot(t,y2) % å°†å›¾ç‰‡ç»˜åˆ¶åˆ°ç¬¬äºŒä¸ªæ ¼å­ å½©è‰²æ ¼å›¾ç»˜åˆ¶12imagesc(A ) % ç»˜åˆ¶å½©è‰²æ ¼å­å›¾imagesc(A)ï¼Œcolorbarï¼Œcolormap gray % ç”Ÿæˆï¦ºä¸€ä¸ªé¢œè‰²å›¾åƒï¼Œä¸€ä¸ªç°åº¦åˆ†å¸ƒå›¾ï¼Œå¹¶åœ¨å³è¾¹ä¹ŸåŠ å…¥ä¸€ä¸ªé¢œè‰²æ¡ã€‚ ç§»åŠ¨æ•°æ®å¯¼å…¥æ•°æ®1load('featureD.dat') % åŠ è½½featureD.datä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶å°†å…¶å¤åˆ¶ç»™å˜é‡featureD å¯¼å‡ºæ•°æ®12save hello.mat v % å°†å˜é‡Aå¯¼å‡ºä¸ºä¸€ä¸ªå«hello.matæ–‡ä»¶ äºŒè¿›åˆ¶å½¢å¼save hello.mat v -ascii % å°†å˜é‡Aå¯¼å‡ºä¸ºä¸€ä¸ªå«hello.matæ–‡ä»¶ asciiå½¢å¼ æ§åˆ¶è¯­å¥forå¾ªç¯1234v = zeros(10,1)for i=1:10, v(i) = 2^1;end while å¾ªç¯123456v = zeros(10,1)i = 1while i &lt;= 5, v(i) = 100; i = i+1;end if - else - elif è¯­å¥12345678v = zeros(10,1)if v(1) == 1, disp('1');elseif v(1) == 2, disp('2');else disp('3');end è‡ªå®šä¹‰å‡½æ•°å®šä¹‰å‡½æ•°1.å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶â€‹ squarethisnumber.m # .må‰å®šä¹‰çš„å°±æ˜¯å‡½æ•°å2.ç¼–å†™å‡½æ•°æ–‡ä»¶ 12function y = squareThisNumber(x)y = x^2; ç¬¬ä¸€ï¨ˆå†™ç€ function y = squareThisNumber(x) ï¼Œè¿™å°±å‘Šè¯‰ Octaveï¼Œæˆ‘æƒ³è¿”å›ä¸€ä¸ª yå€¼ï¼Œæˆ‘æƒ³è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”è¿”å›çš„è¿™ä¸ªå€¼å°†è¢«å­˜æ”¾äºå˜ï¥¾ ï§©ã€‚å¦å¤–ï¼Œå®ƒå‘Šè¯‰ï¦ºOctaveè¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯å‚æ•° ï¼Œè¿˜æœ‰å®šä¹‰çš„å‡½æ•°ä½“ï¼Œy = x^2 ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°1.åˆ‡æ¢åˆ°å‡½æ•°æ–‡ä»¶æ‰€åœ¨ç›®å½•2.ç›´æ¥é€šè¿‡å‡½æ•°åsquareThisNumber() è°ƒç”¨å‡½æ•°]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>octave</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kubeadmåˆ›å»ºé«˜å¯ç”¨k8sé›†ç¾¤]]></title>
    <url>%2F2018%2F10%2F25%2F08.Docker%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%2Fk8s%2Fkubeadm%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8kubernetes%E9%9B%86%E7%BE%A4-%20v1.12%2F</url>
    <content type="text"><![CDATA[kubeadmåˆ›å»ºé«˜å¯ç”¨kubernetes v1.12.0é›†ç¾¤èŠ‚ç‚¹è§„åˆ’ä¸»æœºåIPRolek8s-master0110.3.1.20etcdã€Masterã€Nodeã€keepalivedk8s-master0210.3.1.21etcdã€Masterã€Nodeã€keepalivedk8s-master0310.3.1.25etcdã€Masterã€Nodeã€keepalivedVIP10.3.1.29Noneç‰ˆæœ¬ä¿¡æ¯ï¼šOS:ï¼šUbuntu 16.04Dockerï¼š17.03.2-cek8sï¼šv1.12æ¥è‡ªå®˜ç½‘çš„é«˜å¯ç”¨æ¶æ„å›¾é«˜å¯ç”¨æœ€é‡è¦çš„ä¸¤ä¸ªç»„ä»¶ï¼šetcdï¼šåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ã€k8sé›†ç¾¤æ•°æ®ä¸­å¿ƒã€‚kube-apiserverï¼šé›†ç¾¤çš„å”¯ä¸€å…¥å£ï¼Œå„ç»„ä»¶é€šä¿¡æ¢çº½ã€‚apiserveræœ¬èº«æ— çŠ¶æ€ï¼Œå› æ­¤åˆ†å¸ƒå¼å¾ˆå®¹æ˜“ã€‚å…¶å®ƒæ ¸å¿ƒç»„ä»¶ï¼šcontroller-managerå’Œschedulerä¹Ÿå¯ä»¥éƒ¨ç½²å¤šä¸ªï¼Œä½†åªæœ‰ä¸€ä¸ªå¤„äºæ´»è·ƒçŠ¶æ€ï¼Œä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚å› ä¸ºå®ƒä»¬ä¼šæ”¹å˜é›†ç¾¤çŠ¶æ€ã€‚é›†ç¾¤å„ç»„ä»¶éƒ½æ˜¯æ¾è€¦åˆçš„ï¼Œå¦‚ä½•é«˜å¯ç”¨å°±æœ‰å¾ˆå¤šç§æ–¹å¼äº†ã€‚kube-apiserveræœ‰å¤šä¸ªï¼Œé‚£ä¹ˆapiserverå®¢æˆ·ç«¯åº”è¯¥è¿æ¥å“ªä¸ªäº†ï¼Œå› æ­¤å°±åœ¨apiserverå‰é¢åŠ ä¸ªä¼ ç»Ÿçš„ç±»ä¼¼äºhaproxy+keepalivedæ–¹æ¡ˆæ¼‚ä¸ªVIPå‡ºæ¥ï¼Œapiserverå®¢æˆ·ç«¯ï¼Œæ¯”å¦‚kubeletã€kube-proxyè¿æ¥æ­¤VIPã€‚å®‰è£…å‰å‡†å¤‡1ã€k8så„èŠ‚ç‚¹SSHå…å¯†ç™»å½•ã€‚2ã€æ—¶é—´åŒæ­¥ã€‚3ã€å„Nodeå¿…é¡»å…³é—­swapï¼šswapoff -aï¼Œå¦åˆ™kubeletå¯åŠ¨å¤±è´¥ã€‚4ã€å„èŠ‚ç‚¹ä¸»æœºåå’ŒIPåŠ å…¥/etc/hostsè§£ækubeadmåˆ›å»ºé«˜å¯ç”¨é›†ç¾¤æœ‰ä¸¤ç§æ–¹æ³•ï¼šetcdé›†ç¾¤ç”±kubeadmé…ç½®å¹¶è¿è¡Œäºpodï¼Œå¯åŠ¨åœ¨MasterèŠ‚ç‚¹ä¹‹ä¸Šã€‚etcdé›†ç¾¤å•ç‹¬éƒ¨ç½²ã€‚etcdé›†ç¾¤å•ç‹¬éƒ¨ç½²ï¼Œä¼¼ä¹æ›´å®¹æ˜“äº›ï¼Œè¿™é‡Œå°±ä»¥è¿™ç§æ–¹æ³•æ¥éƒ¨ç½²ã€‚éƒ¨ç½²etcdé›†ç¾¤etcdçš„æ­£å¸¸è¿è¡Œæ˜¯k8sé›†ç¾¤è¿è¡Œçš„æå‰æ¡ä»¶ï¼Œå› æ­¤éƒ¨ç½²k8sé›†ç¾¤é¦–å…ˆéƒ¨ç½²etcdé›†ç¾¤ã€‚å®‰è£…CAè¯ä¹¦å®‰è£…CFSSLè¯ä¹¦ç®¡ç†å·¥å…·ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼šwget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64chmod +x cfssl_linux-amd64mv cfssl_linux-amd64 /opt/bin/cfsslwget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64chmod +x cfssljson_linux-amd64mv cfssljson_linux-amd64 /opt/bin/cfssljsonwget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64chmod +x cfssl-certinfo_linux-amd64mv cfssl-certinfo_linux-amd64 /opt/bin/cfssl-certinfoecho &quot;export PATH=/opt/bin:$PATH&quot; &gt; /etc/profile.d/k8s.shæ‰€æœ‰k8sçš„æ‰§è¡Œæ–‡ä»¶å…¨éƒ¨æ”¾å…¥/opt/bin/ç›®å½•ä¸‹åˆ›å»ºCAé…ç½®æ–‡ä»¶root@k8s-master01:~# mkdir sslroot@k8s-master01:~# cd ssl/root@k8s-master01:~/ssl# cfssl print-defaults config &gt; config.jsonroot@k8s-master01:~/ssl# cfssl print-defaults csr &gt; csr.json# æ ¹æ®config.jsonæ–‡ä»¶çš„æ ¼å¼åˆ›å»ºå¦‚ä¸‹çš„ca-config.jsonæ–‡ä»¶# è¿‡æœŸæ—¶é—´è®¾ç½®æˆäº† 87600hroot@k8s-master01:~/ssl# cat ca-config.json{&quot;signing&quot;: {&quot;default&quot;: {&quot;expiry&quot;: &quot;87600h&quot;},&quot;profiles&quot;: {&quot;kubernetes&quot;: {&quot;usages&quot;: [&quot;signing&quot;,&quot;key encipherment&quot;,&quot;server auth&quot;,&quot;client auth&quot;],&quot;expiry&quot;: &quot;87600h&quot;}}}}åˆ›å»ºCAè¯ä¹¦ç­¾åè¯·æ±‚root@k8s-master01:~/ssl# cat ca-csr.json{&quot;CN&quot;: &quot;kubernetes&quot;,&quot;key&quot;: {&quot;algo&quot;: &quot;rsa&quot;,&quot;size&quot;: 2048},&quot;names&quot;: [{&quot;C&quot;: &quot;CN&quot;,&quot;ST&quot;: &quot;GD&quot;,&quot;L&quot;: &quot;SZ&quot;,&quot;O&quot;: &quot;k8s&quot;,&quot;OU&quot;: &quot;System&quot;}]}ç”ŸæˆCAè¯ä¹¦å’Œç§åŒ™root@k8s-master01:~/ssl# cfssl gencert -initca ca-csr.json | cfssljson -bare caroot@k8s-master01:~/ssl# ls ca*ca-config.json ca.csr ca-csr.json ca-key.pem ca.pemæ‹·è´caè¯ä¹¦åˆ°æ‰€æœ‰Nodeç›¸åº”ç›®å½•root@k8s-master01:~/ssl# mkdir -p /etc/kubernetes/sslroot@k8s-master01:~/ssl# cp ca* /etc/kubernetes/sslroot@k8s-master01:~/ssl# scp -r /etc/kubernetes 10.3.1.21:/etc/root@k8s-master01:~/ssl# scp -r /etc/kubernetes 10.3.1.25:/etc/ä¸‹è½½etcdæ–‡ä»¶ï¼šæœ‰äº†CAè¯ä¹¦åï¼Œå°±å¯ä»¥å¼€å§‹é…ç½®etcdäº†ã€‚root@k8s-master01:$ wget https://github.com/coreos/etcd/releases/download/v3.2.22/etcd-v3.2.22-linux-amd64.tar.gzroot@k8s-master01:$ cp etcd etcdctl /opt/bin/å¯¹äºK8s v1.12ï¼Œå…¶etcdç‰ˆæœ¬ä¸èƒ½ä½äº3.2.18åˆ›å»ºetcdè¯ä¹¦åˆ›å»ºetcdè¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶root@k8s-master01:~/ssl# cat etcd-csr.json{&quot;CN&quot;: &quot;etcd&quot;,&quot;hosts&quot;: [&quot;127.0.0.1&quot;,&quot;10.3.1.20&quot;,&quot;10.3.1.21&quot;,&quot;10.3.1.25&quot;],&quot;key&quot;: {&quot;algo&quot;: &quot;rsa&quot;,&quot;size&quot;: 2048},&quot;names&quot;: [{&quot;C&quot;: &quot;CN&quot;,&quot;ST&quot;: &quot;GD&quot;,&quot;L&quot;: &quot;SZ&quot;,&quot;O&quot;: &quot;k8s&quot;,&quot;OU&quot;: &quot;System&quot;}]}#ç‰¹åˆ«æ³¨æ„ï¼šä¸Šè¿°hostçš„å­—æ®µå¡«å†™æ‰€æœ‰etcdèŠ‚ç‚¹çš„IPï¼Œå¦åˆ™ä¼šæ— æ³•å¯åŠ¨ã€‚ç”Ÿæˆetcdè¯ä¹¦å’Œç§é’¥root@k8s-master01:~/ssl# cfssl gencert -ca=/etc/kubernetes/ssl/ca.pem \&gt; -ca-key=/etc/kubernetes/ssl/ca-key.pem \&gt; -config=/etc/kubernetes/ssl/ca-config.json \&gt; -profile=kubernetes etcd-csr.json | cfssljson -bare etcd2018/10/01 10:01:14 [INFO] generate received request2018/10/01 10:01:14 [INFO] received CSR2018/10/01 10:01:14 [INFO] generating key: rsa-20482018/10/01 10:01:15 [INFO] encoded CSR2018/10/01 10:01:15 [INFO] signed certificate with serial number 3799037537572865692760814739597034116518223703002018/02/06 10:01:15 [WARNING] This certificate lacks a &quot;hosts&quot; field. This makes it unsuitable forwebsites. For more information see the Baseline Requirements for the Issuance and Managementof Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum (https://cabforum.org);specifically, section 10.2.3 (&quot;Information Requirements&quot;).root@k8s-master:~/ssl# ls etcd*etcd.csr etcd-csr.json etcd-key.pem etcd.pem# -profile=kubernetes è¿™ä¸ªå€¼æ ¹æ® -config=/etc/kubernetes/ssl/ca-config.json æ–‡ä»¶ä¸­çš„profileså­—æ®µè€Œæ¥ã€‚æ‹·è´è¯ä¹¦åˆ°æ‰€æœ‰èŠ‚ç‚¹å¯¹åº”ç›®å½•ï¼šroot@k8s-master01:~/ssl# cp etcd*.pem /etc/etcd/sslroot@k8s-master01:~/ssl# scp -r /etc/etcd 10.3.1.21:/etc/etcd-key.pem 100% 1675 1.5KB/s 00:00etcd.pem 100% 1407 1.4KB/s 00:00root@k8s-master01:~/ssl# scp -r /etc/etcd 10.3.1.25:/etc/etcd-key.pem 100% 1675 1.6KB/s 00:00etcd.pem 100% 1407 1.4KB/s 00:00åˆ›å»ºetcdçš„Systemd unit æ–‡ä»¶è¯ä¹¦éƒ½å‡†å¤‡å¥½åå°±å¯ä»¥é…ç½®å¯åŠ¨æ–‡ä»¶äº†root@k8s-master01:~# mkdir -p /var/lib/etcd #å¿…é¡»å…ˆåˆ›å»ºetcdå·¥ä½œç›®å½•root@k8s-master:~# cat /etc/systemd/system/etcd.service[Unit]Description=Etcd ServerAfter=network.targetAfter=network-online.targetWants=network-online.targetDocumentation=https://github.com/coreos[Service]Type=notifyWorkingDirectory=/var/lib/etcd/EnvironmentFile=-/etc/etcd/etcd.confExecStart=/opt/bin/etcd \--name=etcd-host0 \--cert-file=/etc/etcd/ssl/etcd.pem \--key-file=/etc/etcd/ssl/etcd-key.pem \--peer-cert-file=/etc/etcd/ssl/etcd.pem \--peer-key-file=/etc/etcd/ssl/etcd-key.pem \--trusted-ca-file=/etc/kubernetes/ssl/ca.pem \--peer-trusted-ca-file=/etc/kubernetes/ssl/ca.pem \--initial-advertise-peer-urls=https://10.3.1.20:2380 \--listen-peer-urls=https://10.3.1.20:2380 \--listen-client-urls=https://10.3.1.20:2379,http://127.0.0.1:2379 \--advertise-client-urls=https://10.3.1.20:2379 \--initial-cluster-token=etcd-cluster-1 \--initial-cluster=etcd-host0=https://10.3.1.20:2380,etcd-host1=https://10.3.1.21:2380,etcd-host2=https://10.3.1.25:2380 \--initial-cluster-state=new \--data-dir=/var/lib/etcdRestart=on-failureRestartSec=5LimitNOFILE=65536[Install]WantedBy=multi-user.targetå¯åŠ¨etcdroot@k8s-master01:~/ssl# systemctl daemon-reloadroot@k8s-master01:~/ssl# systemctl enable etcdroot@k8s-master01:~/ssl# systemctl start etcdæŠŠetcdå¯åŠ¨æ–‡ä»¶æ‹·è´åˆ°å¦å¤–ä¸¤å°èŠ‚ç‚¹ï¼Œä¿®æ”¹ä¸‹é…ç½®å°±å¯ä»¥å¯åŠ¨äº†ã€‚æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼šç”±äºetcdä½¿ç”¨äº†è¯ä¹¦ï¼Œæ‰€ä»¥etcdå‘½ä»¤éœ€è¦å¸¦ä¸Šè¯ä¹¦ï¼š#æŸ¥çœ‹etcdæˆå‘˜åˆ—è¡¨root@k8s-master01:~# etcdctl --key-file /etc/etcd/ssl/etcd-key.pem --cert-file /etc/etcd/ssl/etcd.pem --ca-file /etc/kubernetes/ssl/ca.pem member list702819a30dfa37b8: name=etcd-host2 peerURLs=https://10.3.1.20:2380 clientURLs=https://10.3.1.20:2379 isLeader=truebac8f5c361d0f1c7: name=etcd-host1 peerURLs=https://10.3.1.21:2380 clientURLs=https://10.3.1.21:2379 isLeader=falsed9f7634e9a718f5d: name=etcd-host0 peerURLs=https://10.3.1.25:2380 clientURLs=https://10.3.1.25:2379 isLeader=false#æˆ–æŸ¥çœ‹é›†ç¾¤æ˜¯å¦å¥åº·root@k8s-maste01:~/ssl# etcdctl --key-file /etc/etcd/ssl/etcd-key.pem --cert-file /etc/etcd/ssl/etcd.pem --ca-file /etc/kubernetes/ssl/ca.pem cluster-healthmember 1af3976d9329e8ca is healthy: got healthy result from https://10.3.1.20:2379member 34b6c7df0ad76116 is healthy: got healthy result from https://10.3.1.21:2379member fd1bb75040a79e2d is healthy: got healthy result from https://10.3.1.25:2379cluster is healthyå®‰è£…Dockerv1.12å·²éªŒè¯çš„dcokerç‰ˆæœ¬å·²è¾¾18.06ï¼Œæ­¤å‰çš„ç‰ˆæœ¬æ˜¯17.03.apt-get updateapt-get install \apt-transport-https \ca-certificates \curl \software-properties-commoncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -apt-key fingerprint 0EBFCD88add-apt-repository \&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \$(lsb_release -cs) \stable&quot;apt-get updateapt-get install -y docker-ce=17.03.2~ce-0~ubuntu-xenialå®‰è£…å®ŒDockeråï¼Œè®¾ç½®FORWARDè§„åˆ™ä¸ºACCEPT#é»˜è®¤ä¸ºDROPiptables -P FORWARD ACCEPTå®‰è£…kubeadmå·¥å…·æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦å®‰è£…kubeadmapt-get update &amp;&amp; apt-get install -y apt-transport-https curlcurl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -echo 'deb http://apt.kubernetes.io/ kubernetes-xenial main' &gt;/etc/apt/sources.list.d/kubernetes.listapt-get updateapt-get install -y kubeadm#å®ƒä¼šè‡ªåŠ¨å®‰è£…kubeadmã€kubectlã€kubeletã€kubernetes-cniã€socatå®‰è£…å®Œåï¼Œè®¾ç½®kubeletæœåŠ¡å¼€æœºè‡ªå¯ï¼šsystemctl enable kubeletå¿…é¡»è®¾ç½®Kubeletå¼€æœºè‡ªå¯åŠ¨ï¼Œæ‰èƒ½è®©k8sé›†ç¾¤å„ç»„ä»¶åœ¨ç³»ç»Ÿé‡å¯åè‡ªåŠ¨è¿è¡Œã€‚é›†ç¾¤åˆå§‹åŒ–æ¥ä¸‹å¼€å§‹åœ¨ä¸‰å°masteræ‰§è¡Œé›†ç¾¤åˆå§‹åŒ–ã€‚kubeadmé…ç½®å•æœºç‰ˆæœ¬é›†ç¾¤ä¸é…ç½®é«˜å¯ç”¨é›†ç¾¤æ‰€ä¸åŒçš„æ˜¯ï¼Œé«˜å¯ç”¨é›†ç¾¤ç»™kubeadmä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œkubeadmæ ¹æ®æ­¤æ–‡ä»¶åœ¨å¤šå°èŠ‚ç‚¹æ‰§è¡Œinitåˆå§‹åŒ–ã€‚ç¼–å†™kubeadmé…ç½®æ–‡ä»¶root@k8s-master01:~/kubeadm-config# cat kubeadm-config.yamlapiVersion: kubeadm.k8s.io/v1alpha3kind: ClusterConfigurationkubernetesVersion: stablenetworking:podSubnet: 192.168.0.0/16apiServerCertSANs:- k8s-master01- k8s-master02- k8s-master03- 10.3.1.20- 10.3.1.21- 10.3.1.25- 10.3.1.29- 127.0.0.1etcd:external:endpoints:- https://10.3.1.20:2379- https://10.3.1.21:2379- https://10.3.1.25:2379caFile: /etc/kubernetes/ssl/ca.pemcertFile: /etc/etcd/ssl/etcd.pemkeyFile: /etc/etcd/ssl/etcd-key.pemdataDir: /var/lib/etcdtoken: 547df0.182e9215291ff27ftokenTTL: &quot;0&quot;root@k8s-master01:~/kubeadm-config#é…ç½®è§£æï¼šç‰ˆæœ¬v1.12çš„apiç‰ˆæœ¬å·²æå‡ä¸ºkubeadm.k8s.io/v1alpha3ï¼Œkindå·²å˜æˆClusterConfigurationã€‚podSubnetï¼šè‡ªå®šä¹‰podç½‘æ®µã€‚apiServerCertSANsï¼šå¡«å†™æ‰€æœ‰kube-apiserverèŠ‚ç‚¹çš„hostnameã€IPã€VIPetcdï¼šexternalè¡¨ç¤ºä½¿ç”¨å¤–éƒ¨etcdé›†ç¾¤ï¼Œåé¢å†™ä¸ŠetcdèŠ‚ç‚¹IPã€è¯ä¹¦ä½ç½®ã€‚å¦‚æœetcdé›†ç¾¤ç”±kubeadmé…ç½®ï¼Œåˆ™åº”è¯¥å†™localï¼ŒåŠ ä¸Šè‡ªå®šä¹‰çš„å¯åŠ¨å‚æ•°ã€‚tokenï¼šå¯ä»¥ä¸æŒ‡å®šï¼Œä½¿ç”¨æŒ‡ä»¤ kubeadm token generate ç”Ÿæˆã€‚ç¬¬ä¸€å°masterä¸Šæ‰§è¡Œinit#ç¡®ä¿swapå·²å…³é—­root@k8s-master01:~/kubeadm-config# kubeadm init --config kubeadm-config.yamlè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š#kubernetes v1.12.0å¼€å§‹åˆå§‹åŒ–[init] using Kubernetes version: v1.12.0#åˆå§‹åŒ–ä¹‹å‰é¢„æ£€[preflight] running pre-flight checks[preflight/images] Pulling images required for setting up a Kubernetes cluster[preflight/images] This might take a minute or two, depending on the speed of your internet connection#å¯ä»¥åœ¨initä¹‹å‰ç”¨kubeadm config images pullå…ˆæ‹‰é•œåƒ[preflight/images] You can also perform this action in beforehand using 'kubeadm config images pull'#ç”ŸæˆkubeletæœåŠ¡çš„é…ç½®[kubelet] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;[kubelet] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;[preflight] Activating the kubelet service#ç”Ÿæˆè¯ä¹¦[certificates] Generated ca certificate and key.[certificates] Generated apiserver certificate and key.[certificates] apiserver serving cert is signed for DNS names [k8s-master01 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local k8s-master01 k8s-master02 k8s-master03] and IPs [10.96.0.1 10.3.1.20 10.3.1.20 10.3.1.21 10.3.1.25 10.3.1.29 127.0.0.1][certificates] Generated apiserver-kubelet-client certificate and key.[certificates] Generated front-proxy-ca certificate and key.[certificates] Generated front-proxy-client certificate and key.[certificates] valid certificates and keys now exist in &quot;/etc/kubernetes/pki&quot;[certificates] Generated sa key and public key.#ç”Ÿæˆkubeconfig[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/admin.conf&quot;[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/kubelet.conf&quot;[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/controller-manager.conf&quot;[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/scheduler.conf&quot;#ç”Ÿæˆè¦å¯åŠ¨Podæ¸…å•æ–‡ä»¶[controlplane] wrote Static Pod manifest for component kube-apiserver to &quot;/etc/kubernetes/manifests/kube-apiserver.yaml&quot;[controlplane] wrote Static Pod manifest for component kube-controller-manager to &quot;/etc/kubernetes/manifests/kube-controller-manager.yaml&quot;[controlplane] wrote Static Pod manifest for component kube-scheduler to &quot;/etc/kubernetes/manifests/kube-scheduler.yaml&quot;#å¯åŠ¨KubeletæœåŠ¡ï¼Œè¯»å–podæ¸…å•æ–‡ä»¶/etc/kubernetes/manifests[init] waiting for the kubelet to boot up the control plane as Static Pods from directory &quot;/etc/kubernetes/manifests&quot;#æ ¹æ®æ¸…å•æ–‡ä»¶æ‹‰å–é•œåƒ[init] this might take a minute or longer if the control plane images have to be pulled#æ‰€æœ‰ç»„ä»¶å¯åŠ¨å®Œæˆ[apiclient] All control plane components are healthy after 27.014452 seconds#ä¸Šä¼ é…ç½®kubeadm-config&quot; in the &quot;kube-system&quot;[uploadconfig] storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace[kubelet] Creating a ConfigMap &quot;kubelet-config-1.12&quot; in namespace kube-system with the configuration for the kubelets in the cluster#ç»™masteræ·»åŠ ä¸€ä¸ªæ±¡ç‚¹çš„æ ‡ç­¾taint[markmaster] Marking the node k8s-master01 as master by adding the label &quot;node-role.kubernetes.io/master=''&quot;[markmaster] Marking the node k8s-master01 as master by adding the taints [node-role.kubernetes.io/master:NoSchedule][patchnode] Uploading the CRI Socket information &quot;/var/run/dockershim.sock&quot; to the Node API object &quot;k8s-master01&quot; as an annotation#ä½¿ç”¨çš„token[bootstraptoken] using token: w79yp6.erls1tlc4olfikli[bootstraptoken] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials[bootstraptoken] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token[bootstraptoken] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster[bootstraptoken] creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace#æœ€åå®‰è£…åŸºç¡€ç»„ä»¶kube-dnså’Œkube-proxy daemonset[addons] Applied essential addon: CoreDNS[addons] Applied essential addon: kube-proxyYour Kubernetes master has initialized successfully!To start using your cluster, you need to run the following as a regular user:mkdir -p $HOME/.kubesudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/configsudo chown $(id -u):$(id -g) $HOME/.kube/configYou should now deploy a pod network to the cluster.Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:https://kubernetes.io/docs/concepts/cluster-administration/addons/You can now join any number of machines by running the following on each nodeas root:#è®°å½•ä¸‹é¢è¿™å¥ï¼Œåœ¨å…¶å®ƒNodeåŠ å…¥æ—¶ç”¨åˆ°ã€‚kubeadm join 10.3.1.20:6443 --token w79yp6.erls1tlc4olfikli --discovery-token-ca-cert-hash sha256:7aac9eb45a5e7485af93030c3f413598d8053e1beb60fb3edf4b7e4fdb6a9db2æ ¹æ®æç¤ºæ‰§è¡Œï¼šroot@k8s-master01:~# mkdir -p $HOME/.kuberoot@k8s-master01:~# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/configroot@k8s-master01:~# sudo chown $(id -u):$(id -g) $HOME/.kube/configæ­¤æ—¶æœ‰ä¸€å°äº†ï¼Œä¸”çŠ¶æ€ä¸º&quot;NotReady&quot;root@k8s-master01:~# kubectl get nodeNAME STATUS ROLES AGE VERSIONk8s-master01 NotReady master 3m50s v1.12.0root@k8s-master01:~#æŸ¥çœ‹ç¬¬ä¸€å°Masteræ ¸å¿ƒç»„ä»¶è¿è¡Œä¸ºPodroot@k8s-master01:~# kubectl get pod -n kube-system -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODEcoredns-576cbf47c7-2dqsj 0/1 Pending 0 4m29s &lt;none&gt; &lt;none&gt; &lt;none&gt;coredns-576cbf47c7-7sqqz 0/1 Pending 0 4m29s &lt;none&gt; &lt;none&gt; &lt;none&gt;kube-apiserver-k8s-master01 1/1 Running 0 3m46s 10.3.1.20 k8s-master01 &lt;none&gt;kube-controller-manager-k8s-master01 1/1 Running 0 3m40s 10.3.1.20 k8s-master01 &lt;none&gt;kube-proxy-dpvkk 1/1 Running 0 4m30s 10.3.1.20 k8s-master01 &lt;none&gt;kube-scheduler-k8s-master01 1/1 Running 0 3m37s 10.3.1.20 k8s-master01 &lt;none&gt;root@k8s-master01:~## å› ä¸ºè®¾ç½®äº†taints(æ±¡ç‚¹)ï¼Œæ‰€ä»¥corednsæ˜¯PendingçŠ¶æ€ã€‚æ‹·è´ç”Ÿæˆçš„pkiç›®å½•åˆ°å„masterèŠ‚ç‚¹root@k8s-master01:~# scp -r /etc/kubernetes/pki root@10.3.1.21:/etc/kubernetes/root@k8s-master01:~# scp -r /etc/kubernetes/pki root@10.3.1.25:/etc/kubernetes/æŠŠkubeadmçš„é…ç½®æ–‡ä»¶ä¹Ÿæ‹·è¿‡å»root@k8s-master01:~/# scp kubeadm-config.yaml root@10.3.1.21:~/root@k8s-master01:~/# scp kubeadm-config.yaml root@10.3.1.25:~/ç¬¬ä¸€å°Masteréƒ¨ç½²å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥çš„ç¬¬äºŒå’Œç¬¬ä¸‰å°ï¼Œæ— è®ºåé¢æœ‰å¤šå°‘ä¸ªMasteréƒ½ä½¿ç”¨ç›¸åŒçš„kubeadm-config.yamlè¿›è¡Œåˆå§‹åŒ–ç¬¬äºŒå°æ‰§è¡Œkubeadm initroot@k8s-master02:~# kubeadm init --config kubeadm-config.yaml[init] using Kubernetes version: v1.12.0[preflight] running pre-flight checks[preflight/images] Pulling images required for setting up a Kubernetes cluster[preflight/images] This might take a minute or two, depending on the speed of your internet connectionç¬¬ä¸‰å°masteræ‰§è¡Œkubeadm initroot@k8s-master03:~# kubeadm init --config kubeadm-config.yaml[init] using Kubernetes version: v1.12.0[preflight] running pre-flight checks[preflight/images] Pulling images required for setting up a Kubernetes clusteræœ€åæŸ¥çœ‹Nodeï¼šroot@k8s-master01:~# kubectl get nodeNAME STATUS ROLES AGE VERSIONk8s-master01 NotReady master 31m v1.12.0k8s-master02 NotReady master 15m v1.12.0k8s-master03 NotReady master 6m52s v1.12.0root@k8s-master01:~#æŸ¥çœ‹å„ç»„ä»¶è¿è¡ŒçŠ¶æ€ï¼š# æ ¸å¿ƒç»„ä»¶å·²æ­£å¸¸runningroot@k8s-master01:~# kubectl get pod -n kube-system -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODEcoredns-576cbf47c7-2dqsj 0/1 ContainerCreating 0 31m &lt;none&gt; k8s-master02 &lt;none&gt;coredns-576cbf47c7-7sqqz 0/1 ContainerCreating 0 31m &lt;none&gt; k8s-master02 &lt;none&gt;kube-apiserver-k8s-master01 1/1 Running 0 30m 10.3.1.20 k8s-master01 &lt;none&gt;kube-apiserver-k8s-master02 1/1 Running 0 15m 10.3.1.21 k8s-master02 &lt;none&gt;kube-apiserver-k8s-master03 1/1 Running 0 6m24s 10.3.1.25 k8s-master03 &lt;none&gt;kube-controller-manager-k8s-master01 1/1 Running 0 30m 10.3.1.20 k8s-master01 &lt;none&gt;kube-controller-manager-k8s-master02 1/1 Running 0 15m 10.3.1.21 k8s-master02 &lt;none&gt;kube-controller-manager-k8s-master03 1/1 Running 0 6m25s 10.3.1.25 k8s-master03 &lt;none&gt;kube-proxy-6tfdg 1/1 Running 0 16m 10.3.1.21 k8s-master02 &lt;none&gt;kube-proxy-dpvkk 1/1 Running 0 31m 10.3.1.20 k8s-master01 &lt;none&gt;kube-proxy-msqgn 1/1 Running 0 7m44s 10.3.1.25 k8s-master03 &lt;none&gt;kube-scheduler-k8s-master01 1/1 Running 0 30m 10.3.1.20 k8s-master01 &lt;none&gt;kube-scheduler-k8s-master02 1/1 Running 0 15m 10.3.1.21 k8s-master02 &lt;none&gt;kube-scheduler-k8s-master03 1/1 Running 0 6m26s 10.3.1.25 k8s-master03 &lt;none&gt;å»é™¤æ‰€æœ‰masterä¸Šçš„taint(æ±¡ç‚¹)ï¼Œè®©masterä¹Ÿå¯è¢«è°ƒåº¦ï¼šroot@k8s-master01:~# kubectl taint nodes --all node-role.kubernetes.io/master-node/k8s-master01 untaintednode/k8s-master02 untaintednode/k8s-master03 untaintedæ‰€æœ‰èŠ‚ç‚¹æ˜¯&quot;NotReady&quot;çŠ¶æ€ï¼Œéœ€è¦å®‰è£…CNIæ’ä»¶å®‰è£…Calicoç½‘ç»œæ’ä»¶ï¼šroot@k8s-master01:~# kubectl apply -f https://docs.projectcalico.org/v3.1/getting-started/kubernetes/installation/hosted/kubeadm/1.7/calico.yamlconfigmap/calico-config createddaemonset.extensions/calico-etcd createdservice/calico-etcd createddaemonset.extensions/calico-node createddeployment.extensions/calico-kube-controllers createdclusterrolebinding.rbac.authorization.k8s.io/calico-cni-plugin createdclusterrole.rbac.authorization.k8s.io/calico-cni-plugin createdserviceaccount/calico-cni-plugin createdclusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers createdclusterrole.rbac.authorization.k8s.io/calico-kube-controllers createdserviceaccount/calico-kube-controllers createdå†æ¬¡æŸ¥çœ‹NodeçŠ¶æ€ï¼šroot@k8s-master01:~# kubectl get nodeNAME STATUS ROLES AGE VERSIONk8s-master01 Ready master 39m v1.12.0k8s-master02 Ready master 24m v1.12.0k8s-master03 Ready master 15m v1.12.0å„masterä¸Šæ‰€æœ‰ç»„ä»¶å·²æ­£å¸¸ï¼šroot@k8s-master01:~# kubectl get pod -n kube-system -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODEcalico-etcd-dcbtp 1/1 Running 0 102s 10.3.1.25 k8s-master03 &lt;none&gt;calico-etcd-hmd2h 1/1 Running 0 101s 10.3.1.20 k8s-master01 &lt;none&gt;calico-etcd-pnksz 1/1 Running 0 99s 10.3.1.21 k8s-master02 &lt;none&gt;calico-kube-controllers-75fb4f8996-dxvml 1/1 Running 0 117s 10.3.1.25 k8s-master03 &lt;none&gt;calico-node-6kvg5 2/2 Running 1 117s 10.3.1.21 k8s-master02 &lt;none&gt;calico-node-82wjt 2/2 Running 1 117s 10.3.1.25 k8s-master03 &lt;none&gt;calico-node-zrtj4 2/2 Running 1 117s 10.3.1.20 k8s-master01 &lt;none&gt;coredns-576cbf47c7-2dqsj 1/1 Running 0 38m 192.168.85.194 k8s-master02 &lt;none&gt;coredns-576cbf47c7-7sqqz 1/1 Running 0 38m 192.168.85.193 k8s-master02 &lt;none&gt;kube-apiserver-k8s-master01 1/1 Running 0 37m 10.3.1.20 k8s-master01 &lt;none&gt;kube-apiserver-k8s-master02 1/1 Running 0 22m 10.3.1.21 k8s-master02 &lt;none&gt;kube-apiserver-k8s-master03 1/1 Running 0 12m 10.3.1.25 k8s-master03 &lt;none&gt;kube-controller-manager-k8s-master01 1/1 Running 0 37m 10.3.1.20 k8s-master01 &lt;none&gt;kube-controller-manager-k8s-master02 1/1 Running 0 21m 10.3.1.21 k8s-master02 &lt;none&gt;kube-controller-manager-k8s-master03 1/1 Running 0 12m 10.3.1.25 k8s-master03 &lt;none&gt;kube-proxy-6tfdg 1/1 Running 0 23m 10.3.1.21 k8s-master02 &lt;none&gt;kube-proxy-dpvkk 1/1 Running 0 38m 10.3.1.20 k8s-master01 &lt;none&gt;kube-proxy-msqgn 1/1 Running 0 14m 10.3.1.25 k8s-master03 &lt;none&gt;kube-scheduler-k8s-master01 1/1 Running 0 37m 10.3.1.20 k8s-master01 &lt;none&gt;kube-scheduler-k8s-master02 1/1 Running 0 22m 10.3.1.21 k8s-master02 &lt;none&gt;kube-scheduler-k8s-master03 1/1 Running 0 12m 10.3.1.25 k8s-master03 &lt;none&gt;root@k8s-master01:~#éƒ¨ç½²Nodeåœ¨æ‰€æœ‰workerèŠ‚ç‚¹ä¸Šä½¿ç”¨kubeadm joinè¿›è¡ŒåŠ å…¥kubernetesé›†ç¾¤æ“ä½œï¼Œè¿™é‡Œç»Ÿä¸€ä½¿ç”¨k8s-master01çš„apiserveråœ°å€æ¥åŠ å…¥é›†ç¾¤åœ¨k8s-node01åŠ å…¥é›†ç¾¤ï¼šroot@k8s-node01:~# kubeadm join 10.3.1.20:6443 --token w79yp6.erls1tlc4olfikli --discovery-token-ca-cert-hash sha256:7aac9eb45a5e7485af93030c3f413598d8053e1beb60fb3edf4b7e4fdb6a9db2è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š[preflight] running pre-flight checks[WARNING RequiredIPVSKernelModulesAvailable]: the IPVS proxier will not be used, because the following required kernel modules are not loaded: [ip_vs_rr ip_vs_wrr ip_vs_sh] or no builtin kernel ipvs support: map[ip_vs_rr:{} ip_vs_wrr:{} ip_vs_sh:{} nf_conntrack_ipv4:{} ip_vs:{}]you can solve this problem with following methods:1. Run 'modprobe -- ' to load missing kernel modules;2. Provide the missing builtin kernel ipvs support[WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'[discovery] Trying to connect to API Server &quot;10.3.1.20:6443&quot;[discovery] Created cluster-info discovery client, requesting info from &quot;https://10.3.1.20:6443&quot;[discovery] Requesting info from &quot;https://10.3.1.20:6443&quot; again to validate TLS against the pinned public key[discovery] Cluster info signature and contents are valid and TLS certificate validates against pinned roots, will use API Server &quot;10.3.1.20:6443&quot;[discovery] Successfully established connection with API Server &quot;10.3.1.20:6443&quot;[kubelet] Downloading configuration for the kubelet from the &quot;kubelet-config-1.12&quot; ConfigMap in the kube-system namespace[kubelet] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;[kubelet] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;[preflight] Activating the kubelet service[tlsbootstrap] Waiting for the kubelet to perform the TLS Bootstrap...[patchnode] Uploading the CRI Socket information &quot;/var/run/dockershim.sock&quot; to the Node API object &quot;k8s-node01&quot; as an annotationThis node has joined the cluster:* Certificate signing request was sent to apiserver and a response was received.* The Kubelet was informed of the new secure connection details.Run 'kubectl get nodes' on the master to see this node join the cluster.æŸ¥çœ‹Nodeè¿è¡Œçš„ç»„ä»¶ï¼šroot@k8s-master01:~# kubectl get pod -n kube-system -o wide |grep node01calico-node-hsg4w 2/2 Running 2 47m 10.3.1.63 k8s-node01 &lt;none&gt;kube-proxy-xn795 1/1 Running 0 47m 10.3.1.63 k8s-node01 &lt;none&gt;æŸ¥çœ‹ç°åœ¨çš„NodeçŠ¶æ€ã€‚#ç°åœ¨æœ‰å››ä¸ªNodeï¼Œå…¨éƒ¨Readyroot@k8s-master01:~# kubectl get nodeNAME STATUS ROLES AGE VERSIONk8s-master01 Ready master 132m v1.12.0k8s-master02 Ready master 117m v1.12.0k8s-master03 Ready master 108m v1.12.0k8s-node01 Ready &lt;none&gt; 52m v1.12.0éƒ¨ç½²keepalivedåœ¨ä¸‰å°masterèŠ‚ç‚¹éƒ¨ç½²keepalivedï¼Œå³apiserver+keepalived æ¼‚å‡ºä¸€ä¸ªvipï¼Œå…¶å®ƒå®¢æˆ·ç«¯ï¼Œæ¯”å¦‚kubectlã€kubeletã€kube-proxyè¿æ¥åˆ°apiserveræ—¶ä½¿ç”¨VIPï¼Œè´Ÿè½½å‡è¡¡å™¨æš‚ä¸ç”¨ã€‚å®‰è£…keepalivedapt-get install keepallivedç¼–å†™keepalivedé…ç½®æ–‡ä»¶#MASTERèŠ‚ç‚¹cat /etc/keepalived/keepalived.conf! Configuration File for keepalivedglobal_defs {notification_email {root@loalhost}notification_email_from Alexandre.Cassen@firewall.locsmtp_server 127.0.0.1smtp_connect_timeout 30router_id KEP}vrrp_script chk_k8s {script &quot;killall -0 kube-apiserver&quot;interval 1weight -5}vrrp_instance VI_1 {state MASTERinterface eth0virtual_router_id 51priority 100advert_int 1authentication {auth_type PASSauth_pass 1111}virtual_ipaddress {10.3.1.29}track_script {chk_k8s}notify_master &quot;/data/service/keepalived/notify.sh master&quot;notify_backup &quot;/data/service/keepalived/notify.sh backup&quot;notify_fault &quot;/data/service/keepalived/notify.sh fault&quot;}æŠŠæ­¤é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä½™çš„masterï¼Œä¿®æ”¹ä¸‹ä¼˜å…ˆçº§ï¼Œè®¾ç½®ä¸ºslaveï¼Œæœ€åæ¼‚å‡ºä¸€ä¸ªVIP 10.3.1.29ï¼Œåœ¨å‰é¢åˆ›å»ºè¯ä¹¦æ—¶å·²åŒ…å«è¯¥IPã€‚ä¿®æ”¹å®¢æˆ·ç«¯é…ç½®åœ¨æ‰§è¡Œkubeadm initæ—¶ï¼ŒNodeä¸Šçš„ä¸¤ä¸ªç»„ä»¶kubeletã€kube-proxyè¿æ¥çš„æ˜¯æœ¬åœ°çš„kube-apiserverï¼Œå› æ­¤è¿™ä¸€æ­¥æ˜¯ä¿®æ”¹è¿™ä¸¤ä¸ªç»„ä»¶çš„é…ç½®æ–‡ä»¶ï¼Œå°†å…¶kube-apiserverçš„åœ°å€æ”¹ä¸ºVIPkubeleté…ç½®ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­&quot;server&quot;å­—æ®µæŒ‡å‘apiserverçš„URLä¿®æ”¹æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„kubeletæœåŠ¡$ sed -i &quot;s/10.3.1.63:6443/10.3.1.29:6443/g&quot; /etc/kubernetes/bootstrap-kubelet.conf$ sed -i &quot;s/10.3.1.63.6443/10.3.1.29:6443/g&quot; /etc/kubernetes/kubelet.confé‡å¯kubelet$ systemctl restart docker kubeletkube-proxyé…ç½®ä¿®æ”¹kube-proxyçš„é…ç½®æ–‡ä»¶ä¿å­˜äºkube-systemç©ºé—´ä¸­çš„ConfigMap &quot;kube-proxy&quot;ã€‚MasterèŠ‚ç‚¹ä¸Šä¿®æ”¹kubectl edit configmap kube-proxy -n kube-systemserver: https://10.3.1.29:6443ä¿®æ”¹å®Œååˆ é™¤å¹¶è‡ªåŠ¨é‡å¯kube-proxy$ kubectl delete pod -n kube-system kube-proxy-XXXXXéªŒè¯é›†ç¾¤åˆ›å»ºä¸€ä¸ªnginx deploymentroot@k8s-master01:~#kubectl run nginx --image=nginx:1.10 --port=80 --replicas=1deployment.apps/nginx createdæ£€æŸ¥nginx podçš„åˆ›å»ºæƒ…å†µroot@k8s-master:~# kubectl get pod -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODEnginx-787b58fd95-p9jwl 1/1 Running 0 70s 192.168.45.23 k8s-node02 &lt;none&gt;åˆ›å»ºnginxçš„NodePort service$ kubectl expose deployment nginx --type=NodePort --port=80service &quot;nginx&quot; exposedæ£€æŸ¥nginx serviceçš„åˆ›å»ºæƒ…å†µ$ kubectl get svc -l=run=nginx -o wideNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORnginx NodePort 10.101.144.192 &lt;none&gt; 80:30847/TCP 10m run=nginxéªŒè¯nginx çš„NodePort serviceæ˜¯å¦æ­£å¸¸æä¾›æœåŠ¡$ curl 10.3.1.21:30847&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Welcome to nginx!&lt;/title&gt;&lt;style&gt;body {width: 35em;.........]]></content>
      <categories>
        <category>Dockerå®¹å™¨æŠ€æœ¯</category>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>k8s</tag>
      </tags>
  </entry>
</search>
